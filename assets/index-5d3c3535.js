import{E as uc,V as j,M as ie,T as oe,Q as Et,S as Mi,a as ut,P as Vi,W as mc,s as re,b as vc,A as bc,C as gc,c as ae,d as fc,D as Ii,B as _c,e as Zs,f as Oi,g as wc,h as yc,i as Js,j as Di,L as Ni,k as Qs,F as Je,l as zt,m as xc,n as Cc,o as Me,p as Gt,I as Ec,O as ji,q as Ui,r as Pc,t as Ve,u as kc,v as Hi,w as Bi,R as tn,x as Lc,y as en,z as Tc,G as Ac,H as Sc,J as Ki,K as Rc,N as Mc,U as Vc,X as Ic,Y as Oc,Z as sn,_ as Dc,$ as Nc,a0 as jc,a1 as Fi,a2 as Uc,a3 as Hc,a4 as Bc,a5 as Kc,a6 as Fc,a7 as zc,a8 as Gc,a9 as qc,aa as $c,ab as Yc,ac as Xc,ad as zi,ae as Wc,af as Gi,ag as Zc,ah as Jc,ai as Qc,aj as tp,ak as ep}from"./three-b24eb87d.js";(async()=>{(function(){const w=document.createElement("link").relList;if(w&&w.supports&&w.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function i(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(o){if(o.ep)return;o.ep=!0;const a=i(o);fetch(o.href,a)}})();const nn={type:"change"},Qe={type:"start"},on={type:"end"};class qi extends uc{constructor(i,r){super(),this.object=i,this.domElement=r,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new j,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:ie.ROTATE,MIDDLE:ie.DOLLY,RIGHT:ie.PAN},this.touches={ONE:oe.ROTATE,TWO:oe.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return d.phi},this.getAzimuthalAngle=function(){return d.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(b){b.addEventListener("keydown",He),this._domElementKeyEvents=b},this.saveState=function(){o.target0.copy(o.target),o.position0.copy(o.object.position),o.zoom0=o.object.zoom},this.reset=function(){o.target.copy(o.target0),o.object.position.copy(o.position0),o.object.zoom=o.zoom0,o.object.updateProjectionMatrix(),o.dispatchEvent(nn),o.update(),c=a.NONE},this.update=function(){const b=new j,k=new Et().setFromUnitVectors(i.up,new j(0,1,0)),G=k.clone().invert(),Z=new j,lt=new Et,bt=2*Math.PI;return function(){const _t=o.object.position;b.copy(_t).sub(o.target),b.applyQuaternion(k),d.setFromVector3(b),o.autoRotate&&c===a.NONE&&nt(B()),o.enableDamping?(d.theta+=u.theta*o.dampingFactor,d.phi+=u.phi*o.dampingFactor):(d.theta+=u.theta,d.phi+=u.phi);let et=o.minAzimuthAngle,st=o.maxAzimuthAngle;return isFinite(et)&&isFinite(st)&&(et<-Math.PI?et+=bt:et>Math.PI&&(et-=bt),st<-Math.PI?st+=bt:st>Math.PI&&(st-=bt),et<=st?d.theta=Math.max(et,Math.min(st,d.theta)):d.theta=d.theta>(et+st)/2?Math.max(et,d.theta):Math.min(st,d.theta)),d.phi=Math.max(o.minPolarAngle,Math.min(o.maxPolarAngle,d.phi)),d.makeSafe(),d.radius*=g,d.radius=Math.max(o.minDistance,Math.min(o.maxDistance,d.radius)),o.enableDamping===!0?o.target.addScaledVector(f,o.dampingFactor):o.target.add(f),b.setFromSpherical(d),b.applyQuaternion(G),_t.copy(o.target).add(b),o.object.lookAt(o.target),o.enableDamping===!0?(u.theta*=1-o.dampingFactor,u.phi*=1-o.dampingFactor,f.multiplyScalar(1-o.dampingFactor)):(u.set(0,0,0),f.set(0,0,0)),g=1,m||Z.distanceToSquared(o.object.position)>p||8*(1-lt.dot(o.object.quaternion))>p?(o.dispatchEvent(nn),Z.copy(o.object.position),lt.copy(o.object.quaternion),m=!1,!0):!1}}(),this.dispose=function(){o.domElement.removeEventListener("contextmenu",Dt),o.domElement.removeEventListener("pointerdown",he),o.domElement.removeEventListener("pointercancel",Ot),o.domElement.removeEventListener("wheel",Ue),o.domElement.removeEventListener("pointermove",ft),o.domElement.removeEventListener("pointerup",it),o._domElementKeyEvents!==null&&o._domElementKeyEvents.removeEventListener("keydown",He)};const o=this,a={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let c=a.NONE;const p=1e-6,d=new Mi,u=new Mi;let g=1;const f=new j;let m=!1;const _=new ut,x=new ut,L=new ut,C=new ut,E=new ut,R=new ut,P=new ut,I=new ut,T=new ut,V=[],X={};function B(){return 2*Math.PI/60/60*o.autoRotateSpeed}function z(){return Math.pow(.95,o.zoomSpeed)}function nt(b){u.theta-=b}function Q(b){u.phi-=b}const rt=function(){const b=new j;return function(k,G){b.setFromMatrixColumn(G,0),b.multiplyScalar(-k),f.add(b)}}(),W=function(){const b=new j;return function(k,G){o.screenSpacePanning===!0?b.setFromMatrixColumn(G,1):(b.setFromMatrixColumn(G,0),b.crossVectors(o.object.up,b)),b.multiplyScalar(k),f.add(b)}}(),at=function(){const b=new j;return function(k,G){const Z=o.domElement;if(o.object.isPerspectiveCamera){const lt=o.object.position;b.copy(lt).sub(o.target);let bt=b.length();bt*=Math.tan(o.object.fov/2*Math.PI/180),rt(2*k*bt/Z.clientHeight,o.object.matrix),W(2*G*bt/Z.clientHeight,o.object.matrix)}else o.object.isOrthographicCamera?(rt(k*(o.object.right-o.object.left)/o.object.zoom/Z.clientWidth,o.object.matrix),W(G*(o.object.top-o.object.bottom)/o.object.zoom/Z.clientHeight,o.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),o.enablePan=!1)}}();function tt(b){o.object.isPerspectiveCamera?g/=b:o.object.isOrthographicCamera?(o.object.zoom=Math.max(o.minZoom,Math.min(o.maxZoom,o.object.zoom*b)),o.object.updateProjectionMatrix(),m=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),o.enableZoom=!1)}function Lt(b){o.object.isPerspectiveCamera?g*=b:o.object.isOrthographicCamera?(o.object.zoom=Math.max(o.minZoom,Math.min(o.maxZoom,o.object.zoom/b)),o.object.updateProjectionMatrix(),m=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),o.enableZoom=!1)}function $t(b){_.set(b.clientX,b.clientY)}function $(b){P.set(b.clientX,b.clientY)}function M(b){C.set(b.clientX,b.clientY)}function cs(b){x.set(b.clientX,b.clientY),L.subVectors(x,_).multiplyScalar(o.rotateSpeed);const k=o.domElement;nt(2*Math.PI*L.x/k.clientHeight),Q(2*Math.PI*L.y/k.clientHeight),_.copy(x),o.update()}function ps(b){I.set(b.clientX,b.clientY),T.subVectors(I,P),T.y>0?tt(z()):T.y<0&&Lt(z()),P.copy(I),o.update()}function ds(b){E.set(b.clientX,b.clientY),R.subVectors(E,C).multiplyScalar(o.panSpeed),at(R.x,R.y),C.copy(E),o.update()}function vt(b){b.deltaY<0?Lt(z()):b.deltaY>0&&tt(z()),o.update()}function De(b){let k=!1;switch(b.code){case o.keys.UP:b.ctrlKey||b.metaKey||b.shiftKey?Q(2*Math.PI*o.rotateSpeed/o.domElement.clientHeight):at(0,o.keyPanSpeed),k=!0;break;case o.keys.BOTTOM:b.ctrlKey||b.metaKey||b.shiftKey?Q(-2*Math.PI*o.rotateSpeed/o.domElement.clientHeight):at(0,-o.keyPanSpeed),k=!0;break;case o.keys.LEFT:b.ctrlKey||b.metaKey||b.shiftKey?nt(2*Math.PI*o.rotateSpeed/o.domElement.clientHeight):at(o.keyPanSpeed,0),k=!0;break;case o.keys.RIGHT:b.ctrlKey||b.metaKey||b.shiftKey?nt(-2*Math.PI*o.rotateSpeed/o.domElement.clientHeight):at(-o.keyPanSpeed,0),k=!0;break}k&&(b.preventDefault(),o.update())}function H(){if(V.length===1)_.set(V[0].pageX,V[0].pageY);else{const b=.5*(V[0].pageX+V[1].pageX),k=.5*(V[0].pageY+V[1].pageY);_.set(b,k)}}function q(){if(V.length===1)C.set(V[0].pageX,V[0].pageY);else{const b=.5*(V[0].pageX+V[1].pageX),k=.5*(V[0].pageY+V[1].pageY);C.set(b,k)}}function Yt(){const b=V[0].pageX-V[1].pageX,k=V[0].pageY-V[1].pageY,G=Math.sqrt(b*b+k*k);P.set(0,G)}function hs(){o.enableZoom&&Yt(),o.enablePan&&q()}function pe(){o.enableZoom&&Yt(),o.enableRotate&&H()}function Ne(b){if(V.length==1)x.set(b.pageX,b.pageY);else{const G=be(b),Z=.5*(b.pageX+G.x),lt=.5*(b.pageY+G.y);x.set(Z,lt)}L.subVectors(x,_).multiplyScalar(o.rotateSpeed);const k=o.domElement;nt(2*Math.PI*L.x/k.clientHeight),Q(2*Math.PI*L.y/k.clientHeight),_.copy(x)}function de(b){if(V.length===1)E.set(b.pageX,b.pageY);else{const k=be(b),G=.5*(b.pageX+k.x),Z=.5*(b.pageY+k.y);E.set(G,Z)}R.subVectors(E,C).multiplyScalar(o.panSpeed),at(R.x,R.y),C.copy(E)}function pt(b){const k=be(b),G=b.pageX-k.x,Z=b.pageY-k.y,lt=Math.sqrt(G*G+Z*Z);I.set(0,lt),T.set(0,Math.pow(I.y/P.y,o.zoomSpeed)),tt(T.y),P.copy(I)}function us(b){o.enableZoom&&pt(b),o.enablePan&&de(b)}function je(b){o.enableZoom&&pt(b),o.enableRotate&&Ne(b)}function he(b){o.enabled!==!1&&(V.length===0&&(o.domElement.setPointerCapture(b.pointerId),o.domElement.addEventListener("pointermove",ft),o.domElement.addEventListener("pointerup",it)),Be(b),b.pointerType==="touch"?vs(b):ms(b))}function ft(b){o.enabled!==!1&&(b.pointerType==="touch"?bs(b):ue(b))}function it(b){me(b),V.length===0&&(o.domElement.releasePointerCapture(b.pointerId),o.domElement.removeEventListener("pointermove",ft),o.domElement.removeEventListener("pointerup",it)),o.dispatchEvent(on),c=a.NONE}function Ot(b){me(b)}function ms(b){let k;switch(b.button){case 0:k=o.mouseButtons.LEFT;break;case 1:k=o.mouseButtons.MIDDLE;break;case 2:k=o.mouseButtons.RIGHT;break;default:k=-1}switch(k){case ie.DOLLY:if(o.enableZoom===!1)return;$(b),c=a.DOLLY;break;case ie.ROTATE:if(b.ctrlKey||b.metaKey||b.shiftKey){if(o.enablePan===!1)return;M(b),c=a.PAN}else{if(o.enableRotate===!1)return;$t(b),c=a.ROTATE}break;case ie.PAN:if(b.ctrlKey||b.metaKey||b.shiftKey){if(o.enableRotate===!1)return;$t(b),c=a.ROTATE}else{if(o.enablePan===!1)return;M(b),c=a.PAN}break;default:c=a.NONE}c!==a.NONE&&o.dispatchEvent(Qe)}function ue(b){switch(c){case a.ROTATE:if(o.enableRotate===!1)return;cs(b);break;case a.DOLLY:if(o.enableZoom===!1)return;ps(b);break;case a.PAN:if(o.enablePan===!1)return;ds(b);break}}function Ue(b){o.enabled===!1||o.enableZoom===!1||c!==a.NONE||(b.preventDefault(),o.dispatchEvent(Qe),vt(b),o.dispatchEvent(on))}function He(b){o.enabled===!1||o.enablePan===!1||De(b)}function vs(b){switch(ve(b),V.length){case 1:switch(o.touches.ONE){case oe.ROTATE:if(o.enableRotate===!1)return;H(),c=a.TOUCH_ROTATE;break;case oe.PAN:if(o.enablePan===!1)return;q(),c=a.TOUCH_PAN;break;default:c=a.NONE}break;case 2:switch(o.touches.TWO){case oe.DOLLY_PAN:if(o.enableZoom===!1&&o.enablePan===!1)return;hs(),c=a.TOUCH_DOLLY_PAN;break;case oe.DOLLY_ROTATE:if(o.enableZoom===!1&&o.enableRotate===!1)return;pe(),c=a.TOUCH_DOLLY_ROTATE;break;default:c=a.NONE}break;default:c=a.NONE}c!==a.NONE&&o.dispatchEvent(Qe)}function bs(b){switch(ve(b),c){case a.TOUCH_ROTATE:if(o.enableRotate===!1)return;Ne(b),o.update();break;case a.TOUCH_PAN:if(o.enablePan===!1)return;de(b),o.update();break;case a.TOUCH_DOLLY_PAN:if(o.enableZoom===!1&&o.enablePan===!1)return;us(b),o.update();break;case a.TOUCH_DOLLY_ROTATE:if(o.enableZoom===!1&&o.enableRotate===!1)return;je(b),o.update();break;default:c=a.NONE}}function Dt(b){o.enabled!==!1&&b.preventDefault()}function Be(b){V.push(b)}function me(b){delete X[b.pointerId];for(let k=0;k<V.length;k++)if(V[k].pointerId==b.pointerId){V.splice(k,1);return}}function ve(b){let k=X[b.pointerId];k===void 0&&(k=new ut,X[b.pointerId]=k),k.set(b.pageX,b.pageY)}function be(b){const k=b.pointerId===V[0].pointerId?V[1]:V[0];return X[k.pointerId]}o.domElement.addEventListener("contextmenu",Dt),o.domElement.addEventListener("pointerdown",he),o.domElement.addEventListener("pointercancel",Ot),o.domElement.addEventListener("wheel",Ue,{passive:!1}),this.update()}}const rn=w=>{let i;const r=new Set,o=(p,d)=>{const u=typeof p=="function"?p(i):p;if(!Object.is(u,i)){const g=i;i=d??(typeof u!="object"||u===null)?u:Object.assign({},i,u),r.forEach(f=>f(i,g))}},a=()=>i,c={setState:o,getState:a,subscribe:p=>(r.add(p),()=>r.delete(p)),destroy:()=>{r.clear()}};return i=w(o,a,c),c},Ie=w=>w?rn(w):rn,ts=Ie(()=>({width:window.innerWidth,height:window.innerHeight,pixelRatio:Math.min(window.devicePixelRatio,2)})),es=Ie(()=>({physicsReady:!1,assetsReady:!1})),F=Ie(()=>({forward:!1,backward:!1,left:!1,right:!1}));class $i{constructor(){this.app=new mt,this.canvas=this.app.canvas,this.sizesStore=ts,this.sizes=this.sizesStore.getState(),this.setInstance(),this.setControls(),this.setResizeLister()}setInstance(){this.instance=new Vi(35,this.sizes.width/this.sizes.height,.1,1e3),this.instance.position.set(0,20,100)}setControls(){this.controls=new qi(this.instance,this.canvas),this.controls.enableDamping=!0}setResizeLister(){this.sizesStore.subscribe(i=>{this.instance.aspect=i.width/i.height,this.instance.updateProjectionMatrix()})}loop(){var i;if(this.controls.update(),this.characterController=(i=this.app.world.characterController)==null?void 0:i.rigidBody,this.characterController){const r=this.characterController.translation(),o=this.characterController.rotation(),a=new j(0,20,25);a.applyQuaternion(o),a.add(r);const c=new j(0,5,0);c.applyQuaternion(o),c.add(r),this.instance.position.lerp(a,.1),this.controls.target.lerp(c,.1)}}}class Yi{constructor(){this.app=new mt,this.canvas=this.app.canvas,this.camera=this.app.camera,this.scene=this.app.scene,this.sizesStore=ts,this.sizes=this.sizesStore.getState(),this.setInstance(),this.setResizeLister()}setInstance(){this.instance=new mc({canvas:this.canvas,antialias:!0}),this.instance.setSize(this.sizes.width,this.sizes.height),this.instance.setPixelRatio(this.sizes.pixelRatio),this.instance.outputEncoding=re,this.instance.shadowMap.enabled=!0,this.instance.shadowMap.type=vc,this.instance.toneMapping=bc,this.instance.toneMappingExposure=.8}setResizeLister(){this.sizesStore.subscribe(i=>{this.instance.setSize(i.width,i.height),this.instance.setPixelRatio(i.pixelRatio)})}loop(){this.instance.render(this.scene,this.camera.instance)}}class Xi{constructor(){this.app=new mt,this.camera=this.app.camera,this.renderer=this.app.renderer,this.world=this.app.world,this.clock=new gc,this.previousElapsedTime=0,this.loop()}loop(){const i=this.clock.getElapsedTime(),r=i-this.previousElapsedTime;this.previousElapsedTime=i,this.world.loop(r,i),this.camera.loop(r),this.renderer.loop(),window.requestAnimationFrame(()=>this.loop())}}var Wi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},ss={exports:{}};(function(w,i){(function(r,o){o(i)})(Wi,function(r){class o{constructor(t){const[e,n]=t.split("-"),l=e.split(".");this.major=parseInt(l[0],10),this.minor=parseInt(l[1],10),this.patch=parseInt(l[2],10),this.prerelease=n??null}toString(){const t=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[t,this.prerelease].join("-"):t}}class a{constructor(t){this.controller_=t}get element(){return this.controller_.view.element}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(t){this.controller_.viewProps.set("disabled",t)}get hidden(){return this.controller_.viewProps.get("hidden")}set hidden(t){this.controller_.viewProps.set("hidden",t)}dispose(){this.controller_.viewProps.set("disposed",!0)}}class c{constructor(t){this.target=t}}class p extends c{constructor(t,e,n,l){super(t),this.value=e,this.presetKey=n,this.last=l??!0}}class d extends c{constructor(t,e,n){super(t),this.value=e,this.presetKey=n}}class u extends c{constructor(t,e){super(t),this.expanded=e}}class g extends c{constructor(t,e){super(t),this.index=e}}function f(s){return s}function m(s){return s==null}function _(s,t){if(s.length!==t.length)return!1;for(let e=0;e<s.length;e++)if(s[e]!==t[e])return!1;return!0}function x(s,t){let e=s;do{const n=Object.getOwnPropertyDescriptor(e,t);if(n&&(n.set!==void 0||n.writable===!0))return!0;e=Object.getPrototypeOf(e)}while(e!==null);return!1}const L={alreadydisposed:()=>"View has been already disposed",invalidparams:s=>`Invalid parameters for '${s.name}'`,nomatchingcontroller:s=>`No matching controller for '${s.key}'`,nomatchingview:s=>`No matching view for '${JSON.stringify(s.params)}'`,notbindable:()=>"Value is not bindable",propertynotfound:s=>`Property '${s.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class C{static alreadyDisposed(){return new C({type:"alreadydisposed"})}static notBindable(){return new C({type:"notbindable"})}static propertyNotFound(t){return new C({type:"propertynotfound",context:{name:t}})}static shouldNeverHappen(){return new C({type:"shouldneverhappen"})}constructor(t){var e;this.message=(e=L[t.type](t.context))!==null&&e!==void 0?e:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=t.type}}class E{constructor(t,e,n){this.obj_=t,this.key_=e,this.presetKey_=n??e}static isBindable(t){return!(t===null||typeof t!="object"&&typeof t!="function")}get key(){return this.key_}get presetKey(){return this.presetKey_}read(){return this.obj_[this.key_]}write(t){this.obj_[this.key_]=t}writeProperty(t,e){const n=this.read();if(!E.isBindable(n))throw C.notBindable();if(!(t in n))throw C.propertyNotFound(t);n[t]=e}}class R extends a{get label(){return this.controller_.props.get("label")}set label(t){this.controller_.props.set("label",t)}get title(){var t;return(t=this.controller_.valueController.props.get("title"))!==null&&t!==void 0?t:""}set title(t){this.controller_.valueController.props.set("title",t)}on(t,e){const n=e.bind(this);return this.controller_.valueController.emitter.on(t,()=>{n(new c(this))}),this}}class P{constructor(){this.observers_={}}on(t,e){let n=this.observers_[t];return n||(n=this.observers_[t]=[]),n.push({handler:e}),this}off(t,e){const n=this.observers_[t];return n&&(this.observers_[t]=n.filter(l=>l.handler!==e)),this}emit(t,e){const n=this.observers_[t];n&&n.forEach(l=>{l.handler(e)})}}const I="tp";function T(s){return(t,e)=>[I,"-",s,"v",t?`_${t}`:"",e?`-${e}`:""].join("")}function V(s,t){return e=>t(s(e))}function X(s){return s.rawValue}function B(s,t){s.emitter.on("change",V(X,t)),t(s.rawValue)}function z(s,t,e){B(s.value(t),e)}function nt(s,t,e){e?s.classList.add(t):s.classList.remove(t)}function Q(s,t){return e=>{nt(s,t,e)}}function rt(s,t){B(s,e=>{t.textContent=e??""})}const W=T("btn");class at{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(W()),e.viewProps.bindClassModifiers(this.element);const n=t.createElement("button");n.classList.add(W("b")),e.viewProps.bindDisabled(n),this.element.appendChild(n),this.buttonElement=n;const l=t.createElement("div");l.classList.add(W("t")),rt(e.props.value("title"),l),this.buttonElement.appendChild(l)}}class tt{constructor(t,e){this.emitter=new P,this.onClick_=this.onClick_.bind(this),this.props=e.props,this.viewProps=e.viewProps,this.view=new at(t,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class Lt{constructor(t,e){var n;this.constraint_=e==null?void 0:e.constraint,this.equals_=(n=e==null?void 0:e.equals)!==null&&n!==void 0?n:(l,h)=>l===h,this.emitter=new P,this.rawValue_=t}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(t){this.setRawValue(t,{forceEmit:!1,last:!0})}setRawValue(t,e){const n=e??{forceEmit:!1,last:!0},l=this.constraint_?this.constraint_.constrain(t):t,h=this.rawValue_;this.equals_(h,l)&&!n.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=l,this.emitter.emit("change",{options:n,previousRawValue:h,rawValue:l,sender:this}))}}class $t{constructor(t){this.emitter=new P,this.value_=t}get rawValue(){return this.value_}set rawValue(t){this.setRawValue(t,{forceEmit:!1,last:!0})}setRawValue(t,e){const n=e??{forceEmit:!1,last:!0},l=this.value_;l===t&&!n.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.value_=t,this.emitter.emit("change",{options:n,previousRawValue:l,rawValue:this.value_,sender:this}))}}function $(s,t){const e=t==null?void 0:t.constraint,n=t==null?void 0:t.equals;return!e&&!n?new $t(s):new Lt(s,t)}class M{constructor(t){this.emitter=new P,this.valMap_=t;for(const e in this.valMap_)this.valMap_[e].emitter.on("change",()=>{this.emitter.emit("change",{key:e,sender:this})})}static createCore(t){return Object.keys(t).reduce((e,n)=>Object.assign(e,{[n]:$(t[n])}),{})}static fromObject(t){const e=this.createCore(t);return new M(e)}get(t){return this.valMap_[t].rawValue}set(t,e){this.valMap_[t].rawValue=e}value(t){return this.valMap_[t]}}function cs(s,t){return Object.keys(t).reduce((n,l)=>{if(n===void 0)return;const h=t[l],v=h(s[l]);return v.succeeded?Object.assign(Object.assign({},n),{[l]:v.value}):void 0},{})}function ps(s,t){return s.reduce((e,n)=>{if(e===void 0)return;const l=t(n);if(!(!l.succeeded||l.value===void 0))return[...e,l.value]},[])}function ds(s){return s===null?!1:typeof s=="object"}function vt(s){return t=>e=>{if(!t&&e===void 0)return{succeeded:!1,value:void 0};if(t&&e===void 0)return{succeeded:!0,value:void 0};const n=s(e);return n!==void 0?{succeeded:!0,value:n}:{succeeded:!1,value:void 0}}}function De(s){return{custom:t=>vt(t)(s),boolean:vt(t=>typeof t=="boolean"?t:void 0)(s),number:vt(t=>typeof t=="number"?t:void 0)(s),string:vt(t=>typeof t=="string"?t:void 0)(s),function:vt(t=>typeof t=="function"?t:void 0)(s),constant:t=>vt(e=>e===t?t:void 0)(s),raw:vt(t=>t)(s),object:t=>vt(e=>{if(ds(e))return cs(e,t)})(s),array:t=>vt(e=>{if(Array.isArray(e))return ps(e,t)})(s)}}const H={optional:De(!0),required:De(!1)};function q(s,t){const e=H.required.object(t)(s);return e.succeeded?e.value:void 0}function Yt(s){console.warn([`Missing '${s.key}' of ${s.target} in ${s.place}.`,"Please rebuild plugins with the latest core package."].join(" "))}function hs(s){return s&&s.parentElement&&s.parentElement.removeChild(s),null}class pe{constructor(t){this.value_=t}static create(t){return[new pe(t),(e,n)=>{t.setRawValue(e,n)}]}get emitter(){return this.value_.emitter}get rawValue(){return this.value_.rawValue}}const Ne=T("");function de(s,t){return Q(s,Ne(void 0,t))}class pt extends M{constructor(t){var e;super(t),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=pe.create($(this.getGlobalDisabled_())),this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),(e=this.get("parent"))===null||e===void 0||e.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(t){var e,n,l;const h=t??{};return new pt(M.createCore({disabled:(e=h.disabled)!==null&&e!==void 0?e:!1,disposed:!1,hidden:(n=h.hidden)!==null&&n!==void 0?n:!1,parent:(l=h.parent)!==null&&l!==void 0?l:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(t){B(this.globalDisabled_,de(t,"disabled")),z(this,"hidden",de(t,"hidden"))}bindDisabled(t){B(this.globalDisabled_,e=>{t.disabled=e})}bindTabIndex(t){B(this.globalDisabled_,e=>{t.tabIndex=e?-1:0})}handleDispose(t){this.value("disposed").emitter.on("change",e=>{e&&t()})}getGlobalDisabled_(){const t=this.get("parent");return(t?t.globalDisabled.rawValue:!1)||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(t){var e;const n=t.previousRawValue;n==null||n.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),(e=this.get("parent"))===null||e===void 0||e.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}}function us(){return["veryfirst","first","last","verylast"]}const je=T(""),he={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class ft{constructor(t){this.parent_=null,this.blade=t.blade,this.view=t.view,this.viewProps=t.viewProps;const e=this.view.element;this.blade.value("positions").emitter.on("change",()=>{us().forEach(n=>{e.classList.remove(je(void 0,he[n]))}),this.blade.get("positions").forEach(n=>{e.classList.add(je(void 0,he[n]))})}),this.viewProps.handleDispose(()=>{hs(e)})}get parent(){return this.parent_}set parent(t){if(this.parent_=t,!("parent"in this.viewProps.valMap_)){Yt({key:"parent",target:pt.name,place:"BladeController.parent"});return}this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null)}}const it="http://www.w3.org/2000/svg";function Ot(s){s.offsetHeight}function ms(s,t){const e=s.style.transition;s.style.transition="none",t(),s.style.transition=e}function ue(s){return s.ontouchstart!==void 0}function Ue(){return globalThis}function He(){return Ue().document}function vs(s){const t=s.ownerDocument.defaultView;return t&&"document"in t?s.getContext("2d",{willReadFrequently:!0}):null}const bs={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function Dt(s,t){const e=s.createElementNS(it,"svg");return e.innerHTML=bs[t],e}function Be(s,t,e){s.insertBefore(t,s.children[e])}function me(s){s.parentElement&&s.parentElement.removeChild(s)}function ve(s){for(;s.children.length>0;)s.removeChild(s.children[0])}function be(s){for(;s.childNodes.length>0;)s.removeChild(s.childNodes[0])}function b(s){return s.relatedTarget?s.relatedTarget:"explicitOriginalTarget"in s?s.explicitOriginalTarget:null}const k=T("lbl");function G(s,t){const e=s.createDocumentFragment();return t.split(`
`).map(n=>s.createTextNode(n)).forEach((n,l)=>{l>0&&e.appendChild(s.createElement("br")),e.appendChild(n)}),e}class Z{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(k()),e.viewProps.bindClassModifiers(this.element);const n=t.createElement("div");n.classList.add(k("l")),z(e.props,"label",h=>{m(h)?this.element.classList.add(k(void 0,"nol")):(this.element.classList.remove(k(void 0,"nol")),be(n),n.appendChild(G(t,h)))}),this.element.appendChild(n),this.labelElement=n;const l=t.createElement("div");l.classList.add(k("v")),this.element.appendChild(l),this.valueElement=l}}class lt extends ft{constructor(t,e){const n=e.valueController.viewProps;super(Object.assign(Object.assign({},e),{view:new Z(t,{props:e.props,viewProps:n}),viewProps:n})),this.props=e.props,this.valueController=e.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}const bt={id:"button",type:"blade",accept(s){const t=H,e=q(s,{title:t.required.string,view:t.required.constant("button"),label:t.optional.string});return e?{params:e}:null},controller(s){return new lt(s.document,{blade:s.blade,props:M.fromObject({label:s.params.label}),valueController:new tt(s.document,{props:M.fromObject({title:s.params.title}),viewProps:s.viewProps})})},api(s){return!(s.controller instanceof lt)||!(s.controller.valueController instanceof tt)?null:new R(s.controller)}};class _t extends ft{constructor(t){super(t),this.value=t.value}}function et(){return new M({positions:$([],{equals:_})})}class st extends M{constructor(t){super(t)}static create(t){const e={completed:!0,expanded:t,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},n=M.createCore(e);return new st(n)}get styleExpanded(){var t;return(t=this.get("temporaryExpanded"))!==null&&t!==void 0?t:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const t=this.get("expandedHeight");return this.get("shouldFixHeight")&&!m(t)?`${t}px`:"auto"}bindExpandedClass(t,e){const n=()=>{this.styleExpanded?t.classList.add(e):t.classList.remove(e)};z(this,"expanded",n),z(this,"temporaryExpanded",n)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function Xo(s,t){let e=0;return ms(t,()=>{s.set("expandedHeight",null),s.set("temporaryExpanded",!0),Ot(t),e=t.clientHeight,s.set("temporaryExpanded",null),Ot(t)}),e}function bn(s,t){t.style.height=s.styleHeight}function gs(s,t){s.value("expanded").emitter.on("beforechange",()=>{if(s.set("completed",!1),m(s.get("expandedHeight"))){const e=Xo(s,t);e>0&&s.set("expandedHeight",e)}s.set("shouldFixHeight",!0),Ot(t)}),s.emitter.on("change",()=>{bn(s,t)}),bn(s,t),t.addEventListener("transitionend",e=>{e.propertyName==="height"&&s.cleanUpTransition()})}class fs extends a{constructor(t,e){super(t),this.rackApi_=e}}function Wo(s,t){return s.addBlade(Object.assign(Object.assign({},t),{view:"button"}))}function Zo(s,t){return s.addBlade(Object.assign(Object.assign({},t),{view:"folder"}))}function Jo(s,t){const e=t??{};return s.addBlade(Object.assign(Object.assign({},e),{view:"separator"}))}function Qo(s,t){return s.addBlade(Object.assign(Object.assign({},t),{view:"tab"}))}class _s{constructor(t){this.emitter=new P,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=t}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(t){for(const e of this.allItems())if(t(e))return e;return null}includes(t){return this.cache_.has(t)}add(t,e){if(this.includes(t))throw C.shouldNeverHappen();const n=e!==void 0?e:this.items_.length;this.items_.splice(n,0,t),this.cache_.add(t);const l=this.extract_(t);l&&(l.emitter.on("add",this.onSubListAdd_),l.emitter.on("remove",this.onSubListRemove_),l.allItems().forEach(h=>{this.cache_.add(h)})),this.emitter.emit("add",{index:n,item:t,root:this,target:this})}remove(t){const e=this.items_.indexOf(t);if(e<0)return;this.items_.splice(e,1),this.cache_.delete(t);const n=this.extract_(t);n&&(n.emitter.off("add",this.onSubListAdd_),n.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:e,item:t,root:this,target:this})}onSubListAdd_(t){this.cache_.add(t.item),this.emitter.emit("add",{index:t.index,item:t.item,root:this,target:t.target})}onSubListRemove_(t){this.cache_.delete(t.item),this.emitter.emit("remove",{index:t.index,item:t.item,root:this,target:t.target})}}class ws extends a{constructor(t){super(t),this.onBindingChange_=this.onBindingChange_.bind(this),this.emitter_=new P,this.controller_.binding.emitter.on("change",this.onBindingChange_)}get label(){return this.controller_.props.get("label")}set label(t){this.controller_.props.set("label",t)}on(t,e){const n=e.bind(this);return this.emitter_.on(t,l=>{n(l.event)}),this}refresh(){this.controller_.binding.read()}onBindingChange_(t){const e=t.sender.target.read();this.emitter_.emit("change",{event:new p(this,e,this.controller_.binding.target.presetKey,t.options.last)})}}class gt extends lt{constructor(t,e){super(t,e),this.binding=e.binding}}class ys extends a{constructor(t){super(t),this.onBindingUpdate_=this.onBindingUpdate_.bind(this),this.emitter_=new P,this.controller_.binding.emitter.on("update",this.onBindingUpdate_)}get label(){return this.controller_.props.get("label")}set label(t){this.controller_.props.set("label",t)}on(t,e){const n=e.bind(this);return this.emitter_.on(t,l=>{n(l.event)}),this}refresh(){this.controller_.binding.read()}onBindingUpdate_(t){const e=t.sender.target.read();this.emitter_.emit("update",{event:new d(this,e,this.controller_.binding.target.presetKey)})}}class Tt extends lt{constructor(t,e){super(t,e),this.binding=e.binding,this.viewProps.bindDisabled(this.binding.ticker),this.viewProps.handleDispose(()=>{this.binding.dispose()})}}function tr(s){return s instanceof Ke?s.apiSet_:s instanceof fs?s.rackApi_.apiSet_:null}function ge(s,t){const e=s.find(n=>n.controller_===t);if(!e)throw C.shouldNeverHappen();return e}function gn(s,t,e){if(!E.isBindable(s))throw C.notBindable();return new E(s,t,e)}class Ke extends a{constructor(t,e){super(t),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.onRackInputChange_=this.onRackInputChange_.bind(this),this.onRackMonitorUpdate_=this.onRackMonitorUpdate_.bind(this),this.emitter_=new P,this.apiSet_=new _s(tr),this.pool_=e;const n=this.controller_.rack;n.emitter.on("add",this.onRackAdd_),n.emitter.on("remove",this.onRackRemove_),n.emitter.on("inputchange",this.onRackInputChange_),n.emitter.on("monitorupdate",this.onRackMonitorUpdate_),n.children.forEach(l=>{this.setUpApi_(l)})}get children(){return this.controller_.rack.children.map(t=>ge(this.apiSet_,t))}addInput(t,e,n){const l=n??{},h=this.controller_.view.element.ownerDocument,v=this.pool_.createInput(h,gn(t,e,l.presetKey),l),y=new ws(v);return this.add(y,l.index)}addMonitor(t,e,n){const l=n??{},h=this.controller_.view.element.ownerDocument,v=this.pool_.createMonitor(h,gn(t,e),l),y=new ys(v);return this.add(y,l.index)}addFolder(t){return Zo(this,t)}addButton(t){return Wo(this,t)}addSeparator(t){return Jo(this,t)}addTab(t){return Qo(this,t)}add(t,e){this.controller_.rack.add(t.controller_,e);const n=this.apiSet_.find(l=>l.controller_===t.controller_);return n&&this.apiSet_.remove(n),this.apiSet_.add(t),t}remove(t){this.controller_.rack.remove(t.controller_)}addBlade(t){const e=this.controller_.view.element.ownerDocument,n=this.pool_.createBlade(e,t),l=this.pool_.createBladeApi(n);return this.add(l,t.index)}on(t,e){const n=e.bind(this);return this.emitter_.on(t,l=>{n(l.event)}),this}setUpApi_(t){this.apiSet_.find(e=>e.controller_===t)||this.apiSet_.add(this.pool_.createBladeApi(t))}onRackAdd_(t){this.setUpApi_(t.bladeController)}onRackRemove_(t){if(t.isRoot){const e=ge(this.apiSet_,t.bladeController);this.apiSet_.remove(e)}}onRackInputChange_(t){const e=t.bladeController;if(e instanceof gt){const n=ge(this.apiSet_,e),l=e.binding;this.emitter_.emit("change",{event:new p(n,l.target.read(),l.target.presetKey,t.options.last)})}else if(e instanceof _t){const n=ge(this.apiSet_,e);this.emitter_.emit("change",{event:new p(n,e.value.rawValue,void 0,t.options.last)})}}onRackMonitorUpdate_(t){if(!(t.bladeController instanceof Tt))throw C.shouldNeverHappen();const e=ge(this.apiSet_,t.bladeController),n=t.bladeController.binding;this.emitter_.emit("update",{event:new d(e,n.target.read(),n.target.presetKey)})}}class xs extends fs{constructor(t,e){super(t,new Ke(t.rackController,e)),this.emitter_=new P,this.controller_.foldable.value("expanded").emitter.on("change",n=>{this.emitter_.emit("fold",{event:new u(this,n.sender.rawValue)})}),this.rackApi_.on("change",n=>{this.emitter_.emit("change",{event:n})}),this.rackApi_.on("update",n=>{this.emitter_.emit("update",{event:n})})}get expanded(){return this.controller_.foldable.get("expanded")}set expanded(t){this.controller_.foldable.set("expanded",t)}get title(){return this.controller_.props.get("title")}set title(t){this.controller_.props.set("title",t)}get children(){return this.rackApi_.children}addInput(t,e,n){return this.rackApi_.addInput(t,e,n)}addMonitor(t,e,n){return this.rackApi_.addMonitor(t,e,n)}addFolder(t){return this.rackApi_.addFolder(t)}addButton(t){return this.rackApi_.addButton(t)}addSeparator(t){return this.rackApi_.addSeparator(t)}addTab(t){return this.rackApi_.addTab(t)}add(t,e){return this.rackApi_.add(t,e)}remove(t){this.rackApi_.remove(t)}addBlade(t){return this.rackApi_.addBlade(t)}on(t,e){const n=e.bind(this);return this.emitter_.on(t,l=>{n(l.event)}),this}}class Cs extends ft{constructor(t){super({blade:t.blade,view:t.view,viewProps:t.rackController.viewProps}),this.rackController=t.rackController}}class er{constructor(t,e){const n=T(e.viewName);this.element=t.createElement("div"),this.element.classList.add(n()),e.viewProps.bindClassModifiers(this.element)}}function sr(s,t){for(let e=0;e<s.length;e++){const n=s[e];if(n instanceof gt&&n.binding===t)return n}return null}function nr(s,t){for(let e=0;e<s.length;e++){const n=s[e];if(n instanceof Tt&&n.binding===t)return n}return null}function ir(s,t){for(let e=0;e<s.length;e++){const n=s[e];if(n instanceof _t&&n.value===t)return n}return null}function Es(s){return s instanceof fe?s.rack:s instanceof Cs?s.rackController.rack:null}function or(s){const t=Es(s);return t?t.bcSet_:null}class rr{constructor(t){var e,n;this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildInputChange_=this.onChildInputChange_.bind(this),this.onChildMonitorUpdate_=this.onChildMonitorUpdate_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onDescendantLayout_=this.onDescendantLayout_.bind(this),this.onDescendantInputChange_=this.onDescendantInputChange_.bind(this),this.onDescendantMonitorUpdate_=this.onDescendantMonitorUpdate_.bind(this),this.emitter=new P,this.blade_=(e=t.blade)!==null&&e!==void 0?e:null,(n=this.blade_)===null||n===void 0||n.value("positions").emitter.on("change",this.onBladePositionsChange_),this.viewProps=t.viewProps,this.bcSet_=new _s(or),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(t,e){var n;(n=t.parent)===null||n===void 0||n.remove(t),x(t,"parent")?t.parent=this:(t.parent_=this,Yt({key:"parent",target:"BladeController",place:"BladeRack.add"})),this.bcSet_.add(t,e)}remove(t){x(t,"parent")?t.parent=null:(t.parent_=null,Yt({key:"parent",target:"BladeController",place:"BladeRack.remove"})),this.bcSet_.remove(t)}find(t){return this.bcSet_.allItems().filter(e=>e instanceof t)}onSetAdd_(t){this.updatePositions_();const e=t.target===t.root;if(this.emitter.emit("add",{bladeController:t.item,index:t.index,isRoot:e,sender:this}),!e)return;const n=t.item;if(n.viewProps.emitter.on("change",this.onChildViewPropsChange_),n.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),n.viewProps.handleDispose(this.onChildDispose_),n instanceof gt)n.binding.emitter.on("change",this.onChildInputChange_);else if(n instanceof Tt)n.binding.emitter.on("update",this.onChildMonitorUpdate_);else if(n instanceof _t)n.value.emitter.on("change",this.onChildValueChange_);else{const l=Es(n);if(l){const h=l.emitter;h.on("layout",this.onDescendantLayout_),h.on("inputchange",this.onDescendantInputChange_),h.on("monitorupdate",this.onDescendantMonitorUpdate_)}}}onSetRemove_(t){this.updatePositions_();const e=t.target===t.root;if(this.emitter.emit("remove",{bladeController:t.item,isRoot:e,sender:this}),!e)return;const n=t.item;if(n instanceof gt)n.binding.emitter.off("change",this.onChildInputChange_);else if(n instanceof Tt)n.binding.emitter.off("update",this.onChildMonitorUpdate_);else if(n instanceof _t)n.value.emitter.off("change",this.onChildValueChange_);else{const l=Es(n);if(l){const h=l.emitter;h.off("layout",this.onDescendantLayout_),h.off("inputchange",this.onDescendantInputChange_),h.off("monitorupdate",this.onDescendantMonitorUpdate_)}}}updatePositions_(){const t=this.bcSet_.items.filter(l=>!l.viewProps.get("hidden")),e=t[0],n=t[t.length-1];this.bcSet_.items.forEach(l=>{const h=[];l===e&&(h.push("first"),(!this.blade_||this.blade_.get("positions").includes("veryfirst"))&&h.push("veryfirst")),l===n&&(h.push("last"),(!this.blade_||this.blade_.get("positions").includes("verylast"))&&h.push("verylast")),l.blade.set("positions",h)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(t){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(t=>t.viewProps.get("disposed")).forEach(t=>{this.bcSet_.remove(t)})}onChildInputChange_(t){const e=sr(this.find(gt),t.sender);if(!e)throw C.alreadyDisposed();this.emitter.emit("inputchange",{bladeController:e,options:t.options,sender:this})}onChildMonitorUpdate_(t){const e=nr(this.find(Tt),t.sender);if(!e)throw C.alreadyDisposed();this.emitter.emit("monitorupdate",{bladeController:e,sender:this})}onChildValueChange_(t){const e=ir(this.find(_t),t.sender);if(!e)throw C.alreadyDisposed();this.emitter.emit("inputchange",{bladeController:e,options:t.options,sender:this})}onDescendantLayout_(t){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onDescendantInputChange_(t){this.emitter.emit("inputchange",{bladeController:t.bladeController,options:t.options,sender:this})}onDescendantMonitorUpdate_(t){this.emitter.emit("monitorupdate",{bladeController:t.bladeController,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class fe extends ft{constructor(t,e){super(Object.assign(Object.assign({},e),{view:new er(t,{viewName:"brk",viewProps:e.viewProps})})),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const n=new rr({blade:e.root?void 0:e.blade,viewProps:e.viewProps});n.emitter.on("add",this.onRackAdd_),n.emitter.on("remove",this.onRackRemove_),this.rack=n,this.viewProps.handleDispose(()=>{for(let l=this.rack.children.length-1;l>=0;l--)this.rack.children[l].viewProps.set("disposed",!0)})}onRackAdd_(t){t.isRoot&&Be(this.view.element,t.bladeController.view.element,t.index)}onRackRemove_(t){t.isRoot&&me(t.bladeController.view.element)}}const fn=T("cnt");class ar{constructor(t,e){var n;this.className_=T((n=e.viewName)!==null&&n!==void 0?n:"fld"),this.element=t.createElement("div"),this.element.classList.add(this.className_(),fn()),e.viewProps.bindClassModifiers(this.element),this.foldable_=e.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),z(this.foldable_,"completed",Q(this.element,this.className_(void 0,"cpl")));const l=t.createElement("button");l.classList.add(this.className_("b")),z(e.props,"title",A=>{m(A)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),e.viewProps.bindDisabled(l),this.element.appendChild(l),this.buttonElement=l;const h=t.createElement("div");h.classList.add(this.className_("i")),this.element.appendChild(h);const v=t.createElement("div");v.classList.add(this.className_("t")),rt(e.props.value("title"),v),this.buttonElement.appendChild(v),this.titleElement=v;const y=t.createElement("div");y.classList.add(this.className_("m")),this.buttonElement.appendChild(y);const S=e.containerElement;S.classList.add(this.className_("c")),this.element.appendChild(S),this.containerElement=S}}class Ps extends Cs{constructor(t,e){var n;const l=st.create((n=e.expanded)!==null&&n!==void 0?n:!0),h=new fe(t,{blade:e.blade,root:e.root,viewProps:e.viewProps});super(Object.assign(Object.assign({},e),{rackController:h,view:new ar(t,{containerElement:h.view.element,foldable:l,props:e.props,viewName:e.root?"rot":void 0,viewProps:e.viewProps})})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=e.props,this.foldable=l,gs(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}const lr={id:"folder",type:"blade",accept(s){const t=H,e=q(s,{title:t.required.string,view:t.required.constant("folder"),expanded:t.optional.boolean});return e?{params:e}:null},controller(s){return new Ps(s.document,{blade:s.blade,expanded:s.params.expanded,props:M.fromObject({title:s.params.title}),viewProps:s.viewProps})},api(s){return s.controller instanceof Ps?new xs(s.controller,s.pool):null}};class Xt extends _t{constructor(t,e){const n=e.valueController.viewProps;super(Object.assign(Object.assign({},e),{value:e.valueController.value,view:new Z(t,{props:e.props,viewProps:n}),viewProps:n})),this.props=e.props,this.valueController=e.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}class _n extends a{}const wn=T("spr");class cr{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(wn()),e.viewProps.bindClassModifiers(this.element);const n=t.createElement("hr");n.classList.add(wn("r")),this.element.appendChild(n)}}class yn extends ft{constructor(t,e){super(Object.assign(Object.assign({},e),{view:new cr(t,{viewProps:e.viewProps})}))}}const pr={id:"separator",type:"blade",accept(s){const t=q(s,{view:H.required.constant("separator")});return t?{params:t}:null},controller(s){return new yn(s.document,{blade:s.blade,viewProps:s.viewProps})},api(s){return s.controller instanceof yn?new _n(s.controller):null}},_e=T("tbi");class dr{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(_e()),e.viewProps.bindClassModifiers(this.element),z(e.props,"selected",h=>{h?this.element.classList.add(_e(void 0,"sel")):this.element.classList.remove(_e(void 0,"sel"))});const n=t.createElement("button");n.classList.add(_e("b")),e.viewProps.bindDisabled(n),this.element.appendChild(n),this.buttonElement=n;const l=t.createElement("div");l.classList.add(_e("t")),rt(e.props.value("title"),l),this.buttonElement.appendChild(l),this.titleElement=l}}class hr{constructor(t,e){this.emitter=new P,this.onClick_=this.onClick_.bind(this),this.props=e.props,this.viewProps=e.viewProps,this.view=new dr(t,{props:e.props,viewProps:e.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class xn{constructor(t,e){this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new hr(t,{props:e.itemProps,viewProps:pt.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.cc_=new fe(t,{blade:et(),viewProps:pt.create()}),this.props=e.props,z(this.props,"selected",n=>{this.itemController.props.set("selected",n),this.contentController.viewProps.set("hidden",!n)})}get itemController(){return this.ic_}get contentController(){return this.cc_}onItemClick_(){this.props.set("selected",!0)}}class Cn{constructor(t,e){this.controller_=t,this.rackApi_=e}get title(){var t;return(t=this.controller_.itemController.props.get("title"))!==null&&t!==void 0?t:""}set title(t){this.controller_.itemController.props.set("title",t)}get selected(){return this.controller_.props.get("selected")}set selected(t){this.controller_.props.set("selected",t)}get children(){return this.rackApi_.children}addButton(t){return this.rackApi_.addButton(t)}addFolder(t){return this.rackApi_.addFolder(t)}addSeparator(t){return this.rackApi_.addSeparator(t)}addTab(t){return this.rackApi_.addTab(t)}add(t,e){this.rackApi_.add(t,e)}remove(t){this.rackApi_.remove(t)}addInput(t,e,n){return this.rackApi_.addInput(t,e,n)}addMonitor(t,e,n){return this.rackApi_.addMonitor(t,e,n)}addBlade(t){return this.rackApi_.addBlade(t)}}class En extends fs{constructor(t,e){super(t,new Ke(t.rackController,e)),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.onSelect_=this.onSelect_.bind(this),this.emitter_=new P,this.pageApiMap_=new Map,this.rackApi_.on("change",n=>{this.emitter_.emit("change",{event:n})}),this.rackApi_.on("update",n=>{this.emitter_.emit("update",{event:n})}),this.controller_.tab.selectedIndex.emitter.on("change",this.onSelect_),this.controller_.pageSet.emitter.on("add",this.onPageAdd_),this.controller_.pageSet.emitter.on("remove",this.onPageRemove_),this.controller_.pageSet.items.forEach(n=>{this.setUpPageApi_(n)})}get pages(){return this.controller_.pageSet.items.map(t=>{const e=this.pageApiMap_.get(t);if(!e)throw C.shouldNeverHappen();return e})}addPage(t){const e=this.controller_.view.element.ownerDocument,n=new xn(e,{itemProps:M.fromObject({selected:!1,title:t.title}),props:M.fromObject({selected:!1})});this.controller_.add(n,t.index);const l=this.pageApiMap_.get(n);if(!l)throw C.shouldNeverHappen();return l}removePage(t){this.controller_.remove(t)}on(t,e){const n=e.bind(this);return this.emitter_.on(t,l=>{n(l.event)}),this}setUpPageApi_(t){const e=this.rackApi_.apiSet_.find(l=>l.controller_===t.contentController);if(!e)throw C.shouldNeverHappen();const n=new Cn(t,e);this.pageApiMap_.set(t,n)}onPageAdd_(t){this.setUpPageApi_(t.item)}onPageRemove_(t){if(!this.pageApiMap_.get(t.item))throw C.shouldNeverHappen();this.pageApiMap_.delete(t.item)}onSelect_(t){this.emitter_.emit("select",{event:new g(this,t.rawValue)})}}const Pn=-1;class ur{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=$(!0),this.selectedIndex=$(Pn),this.items_=[]}add(t,e){const n=e??this.items_.length;this.items_.splice(n,0,t),t.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(t){const e=this.items_.indexOf(t);e<0||(this.items_.splice(e,1),t.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(this.items_.length===0){this.selectedIndex.rawValue=Pn,this.empty.rawValue=!0;return}const t=this.items_.findIndex(e=>e.rawValue);t<0?(this.items_.forEach((e,n)=>{e.rawValue=n===0}),this.selectedIndex.rawValue=0):(this.items_.forEach((e,n)=>{e.rawValue=n===t}),this.selectedIndex.rawValue=t),this.empty.rawValue=!1}onItemSelectedChange_(t){if(t.rawValue){const e=this.items_.findIndex(n=>n===t.sender);this.items_.forEach((n,l)=>{n.rawValue=l===e}),this.selectedIndex.rawValue=e}else this.keepSelection_()}}const we=T("tab");class mr{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(we(),fn()),e.viewProps.bindClassModifiers(this.element),B(e.empty,Q(this.element,we(void 0,"nop")));const n=t.createElement("div");n.classList.add(we("t")),this.element.appendChild(n),this.itemsElement=n;const l=t.createElement("div");l.classList.add(we("i")),this.element.appendChild(l);const h=e.contentsElement;h.classList.add(we("c")),this.element.appendChild(h),this.contentsElement=h}}class kn extends Cs{constructor(t,e){const n=new fe(t,{blade:e.blade,viewProps:e.viewProps}),l=new ur;super({blade:e.blade,rackController:n,view:new mr(t,{contentsElement:n.view.element,empty:l.empty,viewProps:e.viewProps})}),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.pageSet_=new _s(()=>null),this.pageSet_.emitter.on("add",this.onPageAdd_),this.pageSet_.emitter.on("remove",this.onPageRemove_),this.tab=l}get pageSet(){return this.pageSet_}add(t,e){this.pageSet_.add(t,e)}remove(t){this.pageSet_.remove(this.pageSet_.items[t])}onPageAdd_(t){const e=t.item;Be(this.view.itemsElement,e.itemController.view.element,t.index),e.itemController.viewProps.set("parent",this.viewProps),this.rackController.rack.add(e.contentController,t.index),this.tab.add(e.props.value("selected"))}onPageRemove_(t){const e=t.item;me(e.itemController.view.element),e.itemController.viewProps.set("parent",null),this.rackController.rack.remove(e.contentController),this.tab.remove(e.props.value("selected"))}}const Ln={id:"tab",type:"blade",accept(s){const t=H,e=q(s,{pages:t.required.array(t.required.object({title:t.required.string})),view:t.required.constant("tab")});return!e||e.pages.length===0?null:{params:e}},controller(s){const t=new kn(s.document,{blade:s.blade,viewProps:s.viewProps});return s.params.pages.forEach(e=>{const n=new xn(s.document,{itemProps:M.fromObject({selected:!1,title:e.title}),props:M.fromObject({selected:!1})});t.add(n)}),t},api(s){return s.controller instanceof kn?new En(s.controller,s.pool):null}};function vr(s,t){const e=s.accept(t.params);if(!e)return null;const n=H.optional.boolean(t.params.disabled).value,l=H.optional.boolean(t.params.hidden).value;return s.controller({blade:et(),document:t.document,params:Object.assign(Object.assign({},e.params),{disabled:n,hidden:l}),viewProps:pt.create({disabled:n,hidden:l})})}class br{constructor(){this.disabled=!1,this.emitter=new P}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class gr{constructor(t,e){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=t,this.emitter=new P,this.interval_=e,this.setTimer_()}get disabled(){return this.disabled_}set disabled(t){this.disabled_=t,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(this.timerId_===null)return;const t=this.doc_.defaultView;t&&t.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const t=this.doc_.defaultView;t&&(this.timerId_=t.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class fr{constructor(t){this.onValueChange_=this.onValueChange_.bind(this),this.reader=t.reader,this.writer=t.writer,this.emitter=new P,this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.target=t.target,this.read()}read(){const t=this.target.read();t!==void 0&&(this.value.rawValue=this.reader(t))}write_(t){this.writer(this.target,t)}onValueChange_(t){this.write_(t.rawValue),this.emitter.emit("change",{options:t.options,rawValue:t.rawValue,sender:this})}}function Tn(s,t){for(;s.length<t;)s.push(void 0)}function _r(s){const t=[];return Tn(t,s),$(t)}function wr(s){const t=s.indexOf(void 0);return t<0?s:s.slice(0,t)}function yr(s,t){const e=[...wr(s),t];return e.length>s.length?e.splice(0,e.length-s.length):Tn(e,s.length),e}class xr{constructor(t){this.onTick_=this.onTick_.bind(this),this.reader_=t.reader,this.target=t.target,this.emitter=new P,this.value=t.value,this.ticker=t.ticker,this.ticker.emitter.on("tick",this.onTick_),this.read()}dispose(){this.ticker.dispose()}read(){const t=this.target.read();if(t===void 0)return;const e=this.value.rawValue,n=this.reader_(t);this.value.rawValue=yr(e,n),this.emitter.emit("update",{rawValue:n,sender:this})}onTick_(t){this.read()}}class ye{constructor(t){this.constraints=t}constrain(t){return this.constraints.reduce((e,n)=>n.constrain(e),t)}}function wt(s,t){if(s instanceof t)return s;if(s instanceof ye){const e=s.constraints.reduce((n,l)=>n||(l instanceof t?l:null),null);if(e)return e}return null}class Wt{constructor(t){this.values=M.fromObject({max:t.max,min:t.min})}constrain(t){const e=this.values.get("max"),n=this.values.get("min");return Math.min(Math.max(t,n),e)}}class xe{constructor(t){this.values=M.fromObject({options:t})}get options(){return this.values.get("options")}constrain(t){const e=this.values.get("options");return e.length===0||e.filter(n=>n.value===t).length>0?t:e[0].value}}class An{constructor(t){this.values=M.fromObject({max:t.max,min:t.min})}get maxValue(){return this.values.get("max")}get minValue(){return this.values.get("min")}constrain(t){const e=this.values.get("max"),n=this.values.get("min");let l=t;return m(n)||(l=Math.max(l,n)),m(e)||(l=Math.min(l,e)),l}}class Fe{constructor(t,e=0){this.step=t,this.origin=e}constrain(t){const e=this.origin%this.step,n=Math.round((t-e)/this.step);return e+n*this.step}}const ks=T("lst");class Cr{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.props_=e.props,this.element=t.createElement("div"),this.element.classList.add(ks()),e.viewProps.bindClassModifiers(this.element);const n=t.createElement("select");n.classList.add(ks("s")),e.viewProps.bindDisabled(n),this.element.appendChild(n),this.selectElement=n;const l=t.createElement("div");l.classList.add(ks("m")),l.appendChild(Dt(t,"dropdown")),this.element.appendChild(l),e.value.emitter.on("change",this.onValueChange_),this.value_=e.value,z(this.props_,"options",h=>{ve(this.selectElement),h.forEach(v=>{const y=t.createElement("option");y.textContent=v.text,this.selectElement.appendChild(y)}),this.update_()})}update_(){const t=this.props_.get("options").map(e=>e.value);this.selectElement.selectedIndex=t.indexOf(this.value_.rawValue)}onValueChange_(){this.update_()}}class Ce{constructor(t,e){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=e.props,this.value=e.value,this.viewProps=e.viewProps,this.view=new Cr(t,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(t){const e=t.currentTarget;this.value.rawValue=this.props.get("options")[e.selectedIndex].value}}const Sn=T("pop");class Er{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Sn()),e.viewProps.bindClassModifiers(this.element),B(e.shows,Q(this.element,Sn(void 0,"v")))}}class Rn{constructor(t,e){this.shows=$(!1),this.viewProps=e.viewProps,this.view=new Er(t,{shows:this.shows,viewProps:this.viewProps})}}const Mn=T("txt");class Pr{constructor(t,e){this.onChange_=this.onChange_.bind(this),this.element=t.createElement("div"),this.element.classList.add(Mn()),e.viewProps.bindClassModifiers(this.element),this.props_=e.props,this.props_.emitter.on("change",this.onChange_);const n=t.createElement("input");n.classList.add(Mn("i")),n.type="text",e.viewProps.bindDisabled(n),this.element.appendChild(n),this.inputElement=n,e.value.emitter.on("change",this.onChange_),this.value_=e.value,this.refresh()}refresh(){const t=this.props_.get("formatter");this.inputElement.value=t(this.value_.rawValue)}onChange_(){this.refresh()}}class ze{constructor(t,e){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=e.parser,this.props=e.props,this.value=e.value,this.viewProps=e.viewProps,this.view=new Pr(t,{props:e.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(t){const e=t.currentTarget.value,n=this.parser_(e);m(n)||(this.value.rawValue=n),this.view.refresh()}}function kr(s){return String(s)}function Vn(s){return s==="false"?!1:!!s}function In(s){return kr(s)}class Lr{constructor(t){this.text=t}evaluate(){return Number(this.text)}toString(){return this.text}}const Tr={"**":(s,t)=>Math.pow(s,t),"*":(s,t)=>s*t,"/":(s,t)=>s/t,"%":(s,t)=>s%t,"+":(s,t)=>s+t,"-":(s,t)=>s-t,"<<":(s,t)=>s<<t,">>":(s,t)=>s>>t,">>>":(s,t)=>s>>>t,"&":(s,t)=>s&t,"^":(s,t)=>s^t,"|":(s,t)=>s|t};class Ar{constructor(t,e,n){this.left=e,this.operator=t,this.right=n}evaluate(){const t=Tr[this.operator];if(!t)throw new Error(`unexpected binary operator: '${this.operator}`);return t(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const Sr={"+":s=>s,"-":s=>-s,"~":s=>~s};class Rr{constructor(t,e){this.operator=t,this.expression=e}evaluate(){const t=Sr[this.operator];if(!t)throw new Error(`unexpected unary operator: '${this.operator}`);return t(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function Ls(s){return(t,e)=>{for(let n=0;n<s.length;n++){const l=s[n](t,e);if(l!=="")return l}return""}}function Ee(s,t){var e;const n=s.substr(t).match(/^\s+/);return(e=n&&n[0])!==null&&e!==void 0?e:""}function Mr(s,t){const e=s.substr(t,1);return e.match(/^[1-9]$/)?e:""}function Pe(s,t){var e;const n=s.substr(t).match(/^[0-9]+/);return(e=n&&n[0])!==null&&e!==void 0?e:""}function Vr(s,t){const e=Pe(s,t);if(e!=="")return e;const n=s.substr(t,1);if(t+=1,n!=="-"&&n!=="+")return"";const l=Pe(s,t);return l===""?"":n+l}function Ts(s,t){const e=s.substr(t,1);if(t+=1,e.toLowerCase()!=="e")return"";const n=Vr(s,t);return n===""?"":e+n}function On(s,t){const e=s.substr(t,1);if(e==="0")return e;const n=Mr(s,t);return t+=n.length,n===""?"":n+Pe(s,t)}function Ir(s,t){const e=On(s,t);if(t+=e.length,e==="")return"";const n=s.substr(t,1);if(t+=n.length,n!==".")return"";const l=Pe(s,t);return t+=l.length,e+n+l+Ts(s,t)}function Or(s,t){const e=s.substr(t,1);if(t+=e.length,e!==".")return"";const n=Pe(s,t);return t+=n.length,n===""?"":e+n+Ts(s,t)}function Dr(s,t){const e=On(s,t);return t+=e.length,e===""?"":e+Ts(s,t)}const Nr=Ls([Ir,Or,Dr]);function jr(s,t){var e;const n=s.substr(t).match(/^[01]+/);return(e=n&&n[0])!==null&&e!==void 0?e:""}function Ur(s,t){const e=s.substr(t,2);if(t+=e.length,e.toLowerCase()!=="0b")return"";const n=jr(s,t);return n===""?"":e+n}function Hr(s,t){var e;const n=s.substr(t).match(/^[0-7]+/);return(e=n&&n[0])!==null&&e!==void 0?e:""}function Br(s,t){const e=s.substr(t,2);if(t+=e.length,e.toLowerCase()!=="0o")return"";const n=Hr(s,t);return n===""?"":e+n}function Kr(s,t){var e;const n=s.substr(t).match(/^[0-9a-f]+/i);return(e=n&&n[0])!==null&&e!==void 0?e:""}function Fr(s,t){const e=s.substr(t,2);if(t+=e.length,e.toLowerCase()!=="0x")return"";const n=Kr(s,t);return n===""?"":e+n}const zr=Ls([Ur,Br,Fr]),Gr=Ls([zr,Nr]);function qr(s,t){const e=Gr(s,t);return t+=e.length,e===""?null:{evaluable:new Lr(e),cursor:t}}function $r(s,t){const e=s.substr(t,1);if(t+=e.length,e!=="(")return null;const n=Nn(s,t);if(!n)return null;t=n.cursor,t+=Ee(s,t).length;const l=s.substr(t,1);return t+=l.length,l!==")"?null:{evaluable:n.evaluable,cursor:t}}function Yr(s,t){var e;return(e=qr(s,t))!==null&&e!==void 0?e:$r(s,t)}function Dn(s,t){const e=Yr(s,t);if(e)return e;const n=s.substr(t,1);if(t+=n.length,n!=="+"&&n!=="-"&&n!=="~")return null;const l=Dn(s,t);return l?(t=l.cursor,{cursor:t,evaluable:new Rr(n,l.evaluable)}):null}function Xr(s,t,e){e+=Ee(t,e).length;const n=s.filter(l=>t.startsWith(l,e))[0];return n?(e+=n.length,e+=Ee(t,e).length,{cursor:e,operator:n}):null}function Wr(s,t){return(e,n)=>{const l=s(e,n);if(!l)return null;n=l.cursor;let h=l.evaluable;for(;;){const v=Xr(t,e,n);if(!v)break;n=v.cursor;const y=s(e,n);if(!y)return null;n=y.cursor,h=new Ar(v.operator,h,y.evaluable)}return h?{cursor:n,evaluable:h}:null}}const Zr=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((s,t)=>Wr(s,t),Dn);function Nn(s,t){return t+=Ee(s,t).length,Zr(s,t)}function Jr(s){const t=Nn(s,0);return!t||t.cursor+Ee(s,t.cursor).length!==s.length?null:t.evaluable}function yt(s){var t;const e=Jr(s);return(t=e==null?void 0:e.evaluate())!==null&&t!==void 0?t:null}function jn(s){if(typeof s=="number")return s;if(typeof s=="string"){const t=yt(s);if(!m(t))return t}return 0}function Qr(s){return String(s)}function J(s){return t=>t.toFixed(Math.max(Math.min(s,20),0))}const ta=J(0);function Ge(s){return ta(s)+"%"}function Un(s){return String(s)}function As(s){return s}function ke({primary:s,secondary:t,forward:e,backward:n}){let l=!1;function h(v){l||(l=!0,v(),l=!1)}s.emitter.on("change",v=>{h(()=>{t.setRawValue(e(s,t),v.options)})}),t.emitter.on("change",v=>{h(()=>{s.setRawValue(n(s,t),v.options)}),h(()=>{t.setRawValue(e(s,t),v.options)})}),h(()=>{t.setRawValue(e(s,t),{forceEmit:!1,last:!0})})}function ot(s,t){const e=s*(t.altKey?.1:1)*(t.shiftKey?10:1);return t.upKey?+e:t.downKey?-e:0}function Le(s){return{altKey:s.altKey,downKey:s.key==="ArrowDown",shiftKey:s.shiftKey,upKey:s.key==="ArrowUp"}}function xt(s){return{altKey:s.altKey,downKey:s.key==="ArrowLeft",shiftKey:s.shiftKey,upKey:s.key==="ArrowRight"}}function ea(s){return s==="ArrowUp"||s==="ArrowDown"}function Hn(s){return ea(s)||s==="ArrowLeft"||s==="ArrowRight"}function Ss(s,t){var e,n;const l=t.ownerDocument.defaultView,h=t.getBoundingClientRect();return{x:s.pageX-(((e=l&&l.scrollX)!==null&&e!==void 0?e:0)+h.left),y:s.pageY-(((n=l&&l.scrollY)!==null&&n!==void 0?n:0)+h.top)}}class Nt{constructor(t){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=t,this.emitter=new P,t.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),t.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),t.addEventListener("touchend",this.onTouchEnd_),t.addEventListener("mousedown",this.onMouseDown_)}computePosition_(t){const e=this.elem_.getBoundingClientRect();return{bounds:{width:e.width,height:e.height},point:t?{x:t.x,y:t.y}:null}}onMouseDown_(t){var e;t.preventDefault(),(e=t.currentTarget)===null||e===void 0||e.focus();const n=this.elem_.ownerDocument;n.addEventListener("mousemove",this.onDocumentMouseMove_),n.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:t.altKey,data:this.computePosition_(Ss(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onDocumentMouseMove_(t){this.emitter.emit("move",{altKey:t.altKey,data:this.computePosition_(Ss(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onDocumentMouseUp_(t){const e=this.elem_.ownerDocument;e.removeEventListener("mousemove",this.onDocumentMouseMove_),e.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:t.altKey,data:this.computePosition_(Ss(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onTouchStart_(t){t.preventDefault();const e=t.targetTouches.item(0),n=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:t.altKey,data:this.computePosition_(e?{x:e.clientX-n.left,y:e.clientY-n.top}:void 0),sender:this,shiftKey:t.shiftKey}),this.lastTouch_=e}onTouchMove_(t){const e=t.targetTouches.item(0),n=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:t.altKey,data:this.computePosition_(e?{x:e.clientX-n.left,y:e.clientY-n.top}:void 0),sender:this,shiftKey:t.shiftKey}),this.lastTouch_=e}onTouchEnd_(t){var e;const n=(e=t.targetTouches.item(0))!==null&&e!==void 0?e:this.lastTouch_,l=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:t.altKey,data:this.computePosition_(n?{x:n.clientX-l.left,y:n.clientY-l.top}:void 0),sender:this,shiftKey:t.shiftKey})}}function K(s,t,e,n,l){const h=(s-t)/(e-t);return n+h*(l-n)}function Bn(s){return String(s.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function Y(s,t,e){return Math.min(Math.max(s,t),e)}function Kn(s,t){return(s%t+t)%t}const dt=T("txt");class sa{constructor(t,e){this.onChange_=this.onChange_.bind(this),this.props_=e.props,this.props_.emitter.on("change",this.onChange_),this.element=t.createElement("div"),this.element.classList.add(dt(),dt(void 0,"num")),e.arrayPosition&&this.element.classList.add(dt(void 0,e.arrayPosition)),e.viewProps.bindClassModifiers(this.element);const n=t.createElement("input");n.classList.add(dt("i")),n.type="text",e.viewProps.bindDisabled(n),this.element.appendChild(n),this.inputElement=n,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=e.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(dt()),this.inputElement.classList.add(dt("i"));const l=t.createElement("div");l.classList.add(dt("k")),this.element.appendChild(l),this.knobElement=l;const h=t.createElementNS(it,"svg");h.classList.add(dt("g")),this.knobElement.appendChild(h);const v=t.createElementNS(it,"path");v.classList.add(dt("gb")),h.appendChild(v),this.guideBodyElem_=v;const y=t.createElementNS(it,"path");y.classList.add(dt("gh")),h.appendChild(y),this.guideHeadElem_=y;const S=t.createElement("div");S.classList.add(T("tt")()),this.knobElement.appendChild(S),this.tooltipElem_=S,e.value.emitter.on("change",this.onChange_),this.value=e.value,this.refresh()}onDraggingChange_(t){if(t.rawValue===null){this.element.classList.remove(dt(void 0,"drg"));return}this.element.classList.add(dt(void 0,"drg"));const e=t.rawValue/this.props_.get("draggingScale"),n=e+(e>0?-1:e<0?1:0),l=Y(-n,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${n+l},0 L${n},4 L${n+l},8`,`M ${e},-1 L${e},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${e},4`);const h=this.props_.get("formatter");this.tooltipElem_.textContent=h(this.value.rawValue),this.tooltipElem_.style.left=`${e}px`}refresh(){const t=this.props_.get("formatter");this.inputElement.value=t(this.value.rawValue)}onChange_(){this.refresh()}}class Te{constructor(t,e){var n;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=e.baseStep,this.parser_=e.parser,this.props=e.props,this.sliderProps_=(n=e.sliderProps)!==null&&n!==void 0?n:null,this.value=e.value,this.viewProps=e.viewProps,this.dragging_=$(null),this.view=new sa(t,{arrayPosition:e.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const l=new Nt(this.view.knobElement);l.emitter.on("down",this.onPointerDown_),l.emitter.on("move",this.onPointerMove_),l.emitter.on("up",this.onPointerUp_)}constrainValue_(t){var e,n;const l=(e=this.sliderProps_)===null||e===void 0?void 0:e.get("minValue"),h=(n=this.sliderProps_)===null||n===void 0?void 0:n.get("maxValue");let v=t;return l!==void 0&&(v=Math.max(v,l)),h!==void 0&&(v=Math.min(v,h)),v}onInputChange_(t){const e=t.currentTarget.value,n=this.parser_(e);m(n)||(this.value.rawValue=this.constrainValue_(n)),this.view.refresh()}onInputKeyDown_(t){const e=ot(this.baseStep_,Le(t));e!==0&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+e),{forceEmit:!1,last:!1})}onInputKeyUp_(t){ot(this.baseStep_,Le(t))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(t){if(!t.point)return null;const e=t.point.x-t.bounds.width/2;return this.constrainValue_(this.originRawValue_+e*this.props.get("draggingScale"))}onPointerMove_(t){const e=this.computeDraggingValue_(t.data);e!==null&&(this.value.setRawValue(e,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(t){const e=this.computeDraggingValue_(t.data);e!==null&&(this.value.setRawValue(e,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const Rs=T("sld");class na{constructor(t,e){this.onChange_=this.onChange_.bind(this),this.props_=e.props,this.props_.emitter.on("change",this.onChange_),this.element=t.createElement("div"),this.element.classList.add(Rs()),e.viewProps.bindClassModifiers(this.element);const n=t.createElement("div");n.classList.add(Rs("t")),e.viewProps.bindTabIndex(n),this.element.appendChild(n),this.trackElement=n;const l=t.createElement("div");l.classList.add(Rs("k")),this.trackElement.appendChild(l),this.knobElement=l,e.value.emitter.on("change",this.onChange_),this.value=e.value,this.update_()}update_(){const t=Y(K(this.value.rawValue,this.props_.get("minValue"),this.props_.get("maxValue"),0,100),0,100);this.knobElement.style.width=`${t}%`}onChange_(){this.update_()}}class ia{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=e.baseStep,this.value=e.value,this.viewProps=e.viewProps,this.props=e.props,this.view=new na(t,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Nt(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){t.point&&this.value.setRawValue(K(Y(t.point.x,0,t.bounds.width),0,t.bounds.width,this.props.get("minValue"),this.props.get("maxValue")),e)}onPointerDownOrMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){const e=ot(this.baseStep_,xt(t));e!==0&&this.value.setRawValue(this.value.rawValue+e,{forceEmit:!1,last:!1})}onKeyUp_(t){ot(this.baseStep_,xt(t))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Ms=T("sldtxt");class oa{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Ms());const n=t.createElement("div");n.classList.add(Ms("s")),this.sliderView_=e.sliderView,n.appendChild(this.sliderView_.element),this.element.appendChild(n);const l=t.createElement("div");l.classList.add(Ms("t")),this.textView_=e.textView,l.appendChild(this.textView_.element),this.element.appendChild(l)}}class Vs{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.sliderC_=new ia(t,{baseStep:e.baseStep,props:e.sliderProps,value:e.value,viewProps:this.viewProps}),this.textC_=new Te(t,{baseStep:e.baseStep,parser:e.parser,props:e.textProps,sliderProps:e.sliderProps,value:e.value,viewProps:e.viewProps}),this.view=new oa(t,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}}function Ae(s,t){s.write(t)}function qe(s){const t=H;if(Array.isArray(s))return t.required.array(t.required.object({text:t.required.string,value:t.required.raw}))(s).value;if(typeof s=="object")return t.required.raw(s).value}function Fn(s){if(s==="inline"||s==="popup")return s}function At(s){const t=H;return t.required.object({max:t.optional.number,min:t.optional.number,step:t.optional.number})(s).value}function zn(s){if(Array.isArray(s))return s;const t=[];return Object.keys(s).forEach(e=>{t.push({text:e,value:s[e]})}),t}function Is(s){return m(s)?null:new xe(zn(s))}function ra(s){const t=s?wt(s,Fe):null;return t?t.step:null}function $e(s,t){const e=s&&wt(s,Fe);return e?Bn(e.step):Math.max(Bn(t),2)}function Zt(s){return ra(s)??1}function Jt(s,t){var e;const n=s&&wt(s,Fe),l=Math.abs((e=n==null?void 0:n.step)!==null&&e!==void 0?e:t);return l===0?.1:Math.pow(10,Math.floor(Math.log10(l))-1)}const Ye=T("ckb");class aa{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.element=t.createElement("div"),this.element.classList.add(Ye()),e.viewProps.bindClassModifiers(this.element);const n=t.createElement("label");n.classList.add(Ye("l")),this.element.appendChild(n);const l=t.createElement("input");l.classList.add(Ye("i")),l.type="checkbox",n.appendChild(l),this.inputElement=l,e.viewProps.bindDisabled(this.inputElement);const h=t.createElement("div");h.classList.add(Ye("w")),n.appendChild(h);const v=Dt(t,"check");h.appendChild(v),e.value.emitter.on("change",this.onValueChange_),this.value=e.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class la{constructor(t,e){this.onInputChange_=this.onInputChange_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new aa(t,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(t){const e=t.currentTarget;this.value.rawValue=e.checked}}function ca(s){const t=[],e=Is(s.options);return e&&t.push(e),new ye(t)}const pa={id:"input-bool",type:"input",accept:(s,t)=>{if(typeof s!="boolean")return null;const e=q(t,{options:H.optional.custom(qe)});return e?{initialValue:s,params:e}:null},binding:{reader:s=>Vn,constraint:s=>ca(s.params),writer:s=>Ae},controller:s=>{const t=s.document,e=s.value,n=s.constraint,l=n&&wt(n,xe);return l?new Ce(t,{props:new M({options:l.values.value("options")}),value:e,viewProps:s.viewProps}):new la(t,{value:e,viewProps:s.viewProps})}},jt=T("col");class da{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(jt()),e.foldable.bindExpandedClass(this.element,jt(void 0,"expanded")),z(e.foldable,"completed",Q(this.element,jt(void 0,"cpl")));const n=t.createElement("div");n.classList.add(jt("h")),this.element.appendChild(n);const l=t.createElement("div");l.classList.add(jt("s")),n.appendChild(l),this.swatchElement=l;const h=t.createElement("div");if(h.classList.add(jt("t")),n.appendChild(h),this.textElement=h,e.pickerLayout==="inline"){const v=t.createElement("div");v.classList.add(jt("p")),this.element.appendChild(v),this.pickerElement=v}else this.pickerElement=null}}function ha(s,t,e){const n=Y(s/255,0,1),l=Y(t/255,0,1),h=Y(e/255,0,1),v=Math.max(n,l,h),y=Math.min(n,l,h),S=v-y;let A=0,N=0;const U=(y+v)/2;return S!==0&&(N=S/(1-Math.abs(v+y-1)),n===v?A=(l-h)/S:l===v?A=2+(h-n)/S:A=4+(n-l)/S,A=A/6+(A<0?1:0)),[A*360,N*100,U*100]}function ua(s,t,e){const n=(s%360+360)%360,l=Y(t/100,0,1),h=Y(e/100,0,1),v=(1-Math.abs(2*h-1))*l,y=v*(1-Math.abs(n/60%2-1)),S=h-v/2;let A,N,U;return n>=0&&n<60?[A,N,U]=[v,y,0]:n>=60&&n<120?[A,N,U]=[y,v,0]:n>=120&&n<180?[A,N,U]=[0,v,y]:n>=180&&n<240?[A,N,U]=[0,y,v]:n>=240&&n<300?[A,N,U]=[y,0,v]:[A,N,U]=[v,0,y],[(A+S)*255,(N+S)*255,(U+S)*255]}function ma(s,t,e){const n=Y(s/255,0,1),l=Y(t/255,0,1),h=Y(e/255,0,1),v=Math.max(n,l,h),y=Math.min(n,l,h),S=v-y;let A;S===0?A=0:v===n?A=60*(((l-h)/S%6+6)%6):v===l?A=60*((h-n)/S+2):A=60*((n-l)/S+4);const N=v===0?0:S/v,U=v;return[A,N*100,U*100]}function Gn(s,t,e){const n=Kn(s,360),l=Y(t/100,0,1),h=Y(e/100,0,1),v=h*l,y=v*(1-Math.abs(n/60%2-1)),S=h-v;let A,N,U;return n>=0&&n<60?[A,N,U]=[v,y,0]:n>=60&&n<120?[A,N,U]=[y,v,0]:n>=120&&n<180?[A,N,U]=[0,v,y]:n>=180&&n<240?[A,N,U]=[0,y,v]:n>=240&&n<300?[A,N,U]=[y,0,v]:[A,N,U]=[v,0,y],[(A+S)*255,(N+S)*255,(U+S)*255]}function va(s,t,e){const n=e+t*(100-Math.abs(2*e-100))/200;return[s,n!==0?t*(100-Math.abs(2*e-100))/n:0,e+t*(100-Math.abs(2*e-100))/(2*100)]}function ba(s,t,e){const n=100-Math.abs(e*(200-t)/100-100);return[s,n!==0?t*e/n:0,e*(200-t)/(2*100)]}function Ut(s){return[s[0],s[1],s[2]]}function qn(s,t){return[s[0],s[1],s[2],t]}const ga={hsl:{hsl:(s,t,e)=>[s,t,e],hsv:va,rgb:ua},hsv:{hsl:ba,hsv:(s,t,e)=>[s,t,e],rgb:Gn},rgb:{hsl:ha,hsv:ma,rgb:(s,t,e)=>[s,t,e]}};function Xe(s,t){return[t==="float"?1:s==="rgb"?255:360,t==="float"?1:s==="rgb"?255:100,t==="float"?1:s==="rgb"?255:100]}function fa(s,t){return s===t?t:Kn(s,t)}function _a(s,t,e){var n;const l=Xe(t,e);return[t==="rgb"?Y(s[0],0,l[0]):fa(s[0],l[0]),Y(s[1],0,l[1]),Y(s[2],0,l[2]),Y((n=s[3])!==null&&n!==void 0?n:1,0,1)]}function $n(s,t,e,n){const l=Xe(t,e),h=Xe(t,n);return s.map((v,y)=>v/l[y]*h[y])}function wa(s,t,e){const n=$n(s,t.mode,t.type,"int"),l=ga[t.mode][e.mode](...n);return $n(l,e.mode,"int",e.type)}function We(s,t){return typeof s!="object"||m(s)?!1:t in s&&typeof s[t]=="number"}class O{static black(t="int"){return new O([0,0,0],"rgb",t)}static fromObject(t,e="int"){const n="a"in t?[t.r,t.g,t.b,t.a]:[t.r,t.g,t.b];return new O(n,"rgb",e)}static toRgbaObject(t,e="int"){return t.toRgbaObject(e)}static isRgbColorObject(t){return We(t,"r")&&We(t,"g")&&We(t,"b")}static isRgbaColorObject(t){return this.isRgbColorObject(t)&&We(t,"a")}static isColorObject(t){return this.isRgbColorObject(t)}static equals(t,e){if(t.mode!==e.mode)return!1;const n=t.comps_,l=e.comps_;for(let h=0;h<n.length;h++)if(n[h]!==l[h])return!1;return!0}constructor(t,e,n="int"){this.mode=e,this.type=n,this.comps_=_a(t,e,n)}getComponents(t,e="int"){return qn(wa(Ut(this.comps_),{mode:this.mode,type:this.type},{mode:t??this.mode,type:e}),this.comps_[3])}toRgbaObject(t="int"){const e=this.getComponents("rgb",t);return{r:e[0],g:e[1],b:e[2],a:e[3]}}}const St=T("colp");class ya{constructor(t,e){this.alphaViews_=null,this.element=t.createElement("div"),this.element.classList.add(St()),e.viewProps.bindClassModifiers(this.element);const n=t.createElement("div");n.classList.add(St("hsv"));const l=t.createElement("div");l.classList.add(St("sv")),this.svPaletteView_=e.svPaletteView,l.appendChild(this.svPaletteView_.element),n.appendChild(l);const h=t.createElement("div");h.classList.add(St("h")),this.hPaletteView_=e.hPaletteView,h.appendChild(this.hPaletteView_.element),n.appendChild(h),this.element.appendChild(n);const v=t.createElement("div");if(v.classList.add(St("rgb")),this.textView_=e.textView,v.appendChild(this.textView_.element),this.element.appendChild(v),e.alphaViews){this.alphaViews_={palette:e.alphaViews.palette,text:e.alphaViews.text};const y=t.createElement("div");y.classList.add(St("a"));const S=t.createElement("div");S.classList.add(St("ap")),S.appendChild(this.alphaViews_.palette.element),y.appendChild(S);const A=t.createElement("div");A.classList.add(St("at")),A.appendChild(this.alphaViews_.text.element),y.appendChild(A),this.element.appendChild(y)}}get allFocusableElements(){const t=[this.svPaletteView_.element,this.hPaletteView_.element,this.textView_.modeSelectElement,...this.textView_.textViews.map(e=>e.inputElement)];return this.alphaViews_&&t.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),t}}function xa(s){return s==="int"?"int":s==="float"?"float":void 0}function Os(s){const t=H;return q(s,{alpha:t.optional.boolean,color:t.optional.object({alpha:t.optional.boolean,type:t.optional.custom(xa)}),expanded:t.optional.boolean,picker:t.optional.custom(Fn)})}function Ht(s){return s?.1:1}function Bt(s){var t;return(t=s.color)===null||t===void 0?void 0:t.type}function Ca(s,t){return s.alpha===t.alpha&&s.mode===t.mode&&s.notation===t.notation&&s.type===t.type}function ht(s,t){const e=s.match(/^(.+)%$/);return Math.min(e?parseFloat(e[1])*.01*t:parseFloat(s),t)}const Ea={deg:s=>s,grad:s=>s*360/400,rad:s=>s*360/(2*Math.PI),turn:s=>s*360};function Yn(s){const t=s.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!t)return parseFloat(s);const e=parseFloat(t[1]),n=t[2];return Ea[n](e)}function Xn(s){const t=s.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const e=[ht(t[1],255),ht(t[2],255),ht(t[3],255)];return isNaN(e[0])||isNaN(e[1])||isNaN(e[2])?null:e}function Wn(s){return t=>{const e=Xn(t);return e?new O(e,"rgb",s):null}}function Zn(s){const t=s.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const e=[ht(t[1],255),ht(t[2],255),ht(t[3],255),ht(t[4],1)];return isNaN(e[0])||isNaN(e[1])||isNaN(e[2])||isNaN(e[3])?null:e}function Jn(s){return t=>{const e=Zn(t);return e?new O(e,"rgb",s):null}}function Qn(s){const t=s.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const e=[Yn(t[1]),ht(t[2],100),ht(t[3],100)];return isNaN(e[0])||isNaN(e[1])||isNaN(e[2])?null:e}function ti(s){return t=>{const e=Qn(t);return e?new O(e,"hsl",s):null}}function ei(s){const t=s.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const e=[Yn(t[1]),ht(t[2],100),ht(t[3],100),ht(t[4],1)];return isNaN(e[0])||isNaN(e[1])||isNaN(e[2])||isNaN(e[3])?null:e}function si(s){return t=>{const e=ei(t);return e?new O(e,"hsl",s):null}}function ni(s){const t=s.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(t)return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)];const e=s.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return e?[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]:null}function Pa(s){const t=ni(s);return t?new O(t,"rgb","int"):null}function ii(s){const t=s.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(t)return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16),K(parseInt(t[4]+t[4],16),0,255,0,1)];const e=s.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return e?[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16),K(parseInt(e[4],16),0,255,0,1)]:null}function ka(s){const t=ii(s);return t?new O(t,"rgb","int"):null}function oi(s){const t=s.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!t)return null;const e=[parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3])];return isNaN(e[0])||isNaN(e[1])||isNaN(e[2])?null:e}function ri(s){return t=>{const e=oi(t);return e?new O(e,"rgb",s):null}}function ai(s){const t=s.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!t)return null;const e=[parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3]),parseFloat(t[4])];return isNaN(e[0])||isNaN(e[1])||isNaN(e[2])||isNaN(e[3])?null:e}function li(s){return t=>{const e=ai(t);return e?new O(e,"rgb",s):null}}const La=[{parser:ni,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:ii,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:Xn,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:Zn,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:Qn,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:ei,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:oi,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:ai,result:{alpha:!0,mode:"rgb",notation:"object"}}];function Ta(s){return La.reduce((t,{parser:e,result:n})=>t||(e(s)?n:null),null)}function Ds(s,t="int"){const e=Ta(s);return e?e.notation==="hex"&&t!=="float"?Object.assign(Object.assign({},e),{type:"int"}):e.notation==="func"?Object.assign(Object.assign({},e),{type:t}):null:null}const ci={int:[Pa,ka,Wn("int"),Jn("int"),ti("int"),si("int"),ri("int"),li("int")],float:[Wn("float"),Jn("float"),ti("float"),si("float"),ri("float"),li("float")]};function Aa(s){const t=ci[s];return e=>typeof e!="string"?O.black(s):t.reduce((l,h)=>l||h(e),null)??O.black(s)}function Ns(s){const t=ci[s];return e=>t.reduce((n,l)=>n||l(e),null)}function pi(s){const t=Y(Math.floor(s),0,255).toString(16);return t.length===1?`0${t}`:t}function di(s,t="#"){const e=Ut(s.getComponents("rgb")).map(pi).join("");return`${t}${e}`}function js(s,t="#"){const e=s.getComponents("rgb"),n=[e[0],e[1],e[2],e[3]*255].map(pi).join("");return`${t}${n}`}function hi(s,t){const e=J(t==="float"?2:0);return`rgb(${Ut(s.getComponents("rgb",t)).map(n=>e(n)).join(", ")})`}function Sa(s){return t=>hi(t,s)}function Ze(s,t){const e=J(2),n=J(t==="float"?2:0);return`rgba(${s.getComponents("rgb",t).map((l,h)=>(h===3?e:n)(l)).join(", ")})`}function Ra(s){return t=>Ze(t,s)}function Ma(s){const t=[J(0),Ge,Ge];return`hsl(${Ut(s.getComponents("hsl")).map((e,n)=>t[n](e)).join(", ")})`}function Va(s){const t=[J(0),Ge,Ge,J(2)];return`hsla(${s.getComponents("hsl").map((e,n)=>t[n](e)).join(", ")})`}function ui(s,t){const e=J(t==="float"?2:0),n=["r","g","b"];return`{${Ut(s.getComponents("rgb",t)).map((l,h)=>`${n[h]}: ${e(l)}`).join(", ")}}`}function Ia(s){return t=>ui(t,s)}function mi(s,t){const e=J(2),n=J(t==="float"?2:0),l=["r","g","b","a"];return`{${s.getComponents("rgb",t).map((h,v)=>{const y=v===3?e:n;return`${l[v]}: ${y(h)}`}).join(", ")}}`}function Oa(s){return t=>mi(t,s)}const Da=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:di},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:js},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:Ma},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:Va},...["int","float"].reduce((s,t)=>[...s,{format:{alpha:!1,mode:"rgb",notation:"func",type:t},stringifier:Sa(t)},{format:{alpha:!0,mode:"rgb",notation:"func",type:t},stringifier:Ra(t)},{format:{alpha:!1,mode:"rgb",notation:"object",type:t},stringifier:Ia(t)},{format:{alpha:!0,mode:"rgb",notation:"object",type:t},stringifier:Oa(t)}],[])];function Us(s){return Da.reduce((t,e)=>t||(Ca(e.format,s)?e.stringifier:null),null)}const Se=T("apl");class Na{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add(Se()),e.viewProps.bindClassModifiers(this.element),e.viewProps.bindTabIndex(this.element);const n=t.createElement("div");n.classList.add(Se("b")),this.element.appendChild(n);const l=t.createElement("div");l.classList.add(Se("c")),n.appendChild(l),this.colorElem_=l;const h=t.createElement("div");h.classList.add(Se("m")),this.element.appendChild(h),this.markerElem_=h;const v=t.createElement("div");v.classList.add(Se("p")),this.markerElem_.appendChild(v),this.previewElem_=v,this.update_()}update_(){const t=this.value.rawValue,e=t.getComponents("rgb"),n=new O([e[0],e[1],e[2],0],"rgb"),l=new O([e[0],e[1],e[2],255],"rgb"),h=["to right",Ze(n),Ze(l)];this.colorElem_.style.background=`linear-gradient(${h.join(",")})`,this.previewElem_.style.backgroundColor=Ze(t);const v=K(e[3],0,1,0,100);this.markerElem_.style.left=`${v}%`}onValueChange_(){this.update_()}}class ja{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new Na(t,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Nt(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;const n=t.point.x/t.bounds.width,l=this.value.rawValue,[h,v,y]=l.getComponents("hsv");this.value.setRawValue(new O([h,v,y,n],"hsv"),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){const e=ot(Ht(!0),xt(t));if(e===0)return;const n=this.value.rawValue,[l,h,v,y]=n.getComponents("hsv");this.value.setRawValue(new O([l,h,v,y+e],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(t){ot(Ht(!0),xt(t))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Qt=T("coltxt");function Ua(s){const t=s.createElement("select"),e=[{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"}];return t.appendChild(e.reduce((n,l)=>{const h=s.createElement("option");return h.textContent=l.text,h.value=l.value,n.appendChild(h),n},s.createDocumentFragment())),t}class Ha{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Qt()),e.viewProps.bindClassModifiers(this.element);const n=t.createElement("div");n.classList.add(Qt("m")),this.modeElem_=Ua(t),this.modeElem_.classList.add(Qt("ms")),n.appendChild(this.modeSelectElement),e.viewProps.bindDisabled(this.modeElem_);const l=t.createElement("div");l.classList.add(Qt("mm")),l.appendChild(Dt(t,"dropdown")),n.appendChild(l),this.element.appendChild(n);const h=t.createElement("div");h.classList.add(Qt("w")),this.element.appendChild(h),this.textsElem_=h,this.textViews_=e.textViews,this.applyTextViews_(),B(e.colorMode,v=>{this.modeElem_.value=v})}get modeSelectElement(){return this.modeElem_}get textViews(){return this.textViews_}set textViews(t){this.textViews_=t,this.applyTextViews_()}applyTextViews_(){ve(this.textsElem_);const t=this.element.ownerDocument;this.textViews_.forEach(e=>{const n=t.createElement("div");n.classList.add(Qt("c")),n.appendChild(e.element),this.textsElem_.appendChild(n)})}}function Ba(s){return J(s==="float"?2:0)}function Ka(s,t,e){const n=Xe(s,t)[e];return new Wt({min:0,max:n})}function Hs(s,t,e){return new Te(s,{arrayPosition:e===0?"fst":e===3-1?"lst":"mid",baseStep:Ht(!1),parser:t.parser,props:M.fromObject({draggingScale:t.colorType==="float"?.01:1,formatter:Ba(t.colorType)}),value:$(0,{constraint:Ka(t.colorMode,t.colorType,e)}),viewProps:t.viewProps})}class Fa{constructor(t,e){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=e.colorType,this.parser_=e.parser,this.value=e.value,this.viewProps=e.viewProps,this.colorMode=$(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(t),this.view=new Ha(t,{colorMode:this.colorMode,textViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view],viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(t){const e={colorMode:this.colorMode.rawValue,colorType:this.colorType_,parser:this.parser_,viewProps:this.viewProps},n=[Hs(t,e,0),Hs(t,e,1),Hs(t,e,2)];return n.forEach((l,h)=>{ke({primary:this.value,secondary:l.value,forward:v=>v.rawValue.getComponents(this.colorMode.rawValue,this.colorType_)[h],backward:(v,y)=>{const S=this.colorMode.rawValue,A=v.rawValue.getComponents(S,this.colorType_);return A[h]=y.rawValue,new O(qn(Ut(A),A[3]),S,this.colorType_)}})}),n}onModeSelectChange_(t){const e=t.currentTarget;this.colorMode.rawValue=e.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.textViews=[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}}const Bs=T("hpl");class za{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add(Bs()),e.viewProps.bindClassModifiers(this.element),e.viewProps.bindTabIndex(this.element);const n=t.createElement("div");n.classList.add(Bs("c")),this.element.appendChild(n);const l=t.createElement("div");l.classList.add(Bs("m")),this.element.appendChild(l),this.markerElem_=l,this.update_()}update_(){const t=this.value.rawValue,[e]=t.getComponents("hsv");this.markerElem_.style.backgroundColor=hi(new O([e,100,100],"hsv"));const n=K(e,0,360,0,100);this.markerElem_.style.left=`${n}%`}onValueChange_(){this.update_()}}class Ga{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new za(t,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Nt(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;const n=K(Y(t.point.x,0,t.bounds.width),0,t.bounds.width,0,360),l=this.value.rawValue,[,h,v,y]=l.getComponents("hsv");this.value.setRawValue(new O([n,h,v,y],"hsv"),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){const e=ot(Ht(!1),xt(t));if(e===0)return;const n=this.value.rawValue,[l,h,v,y]=n.getComponents("hsv");this.value.setRawValue(new O([l+e,h,v,y],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(t){ot(Ht(!1),xt(t))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Ks=T("svp"),vi=64;class qa{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add(Ks()),e.viewProps.bindClassModifiers(this.element),e.viewProps.bindTabIndex(this.element);const n=t.createElement("canvas");n.height=vi,n.width=vi,n.classList.add(Ks("c")),this.element.appendChild(n),this.canvasElement=n;const l=t.createElement("div");l.classList.add(Ks("m")),this.element.appendChild(l),this.markerElem_=l,this.update_()}update_(){const t=vs(this.canvasElement);if(!t)return;const e=this.value.rawValue.getComponents("hsv"),n=this.canvasElement.width,l=this.canvasElement.height,h=t.getImageData(0,0,n,l),v=h.data;for(let A=0;A<l;A++)for(let N=0;N<n;N++){const U=K(N,0,n,0,100),Kt=K(A,0,l,100,0),Ft=Gn(e[0],U,Kt),ne=(A*n+N)*4;v[ne]=Ft[0],v[ne+1]=Ft[1],v[ne+2]=Ft[2],v[ne+3]=255}t.putImageData(h,0,0);const y=K(e[1],0,100,0,100);this.markerElem_.style.left=`${y}%`;const S=K(e[2],0,100,100,0);this.markerElem_.style.top=`${S}%`}onValueChange_(){this.update_()}}class $a{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new qa(t,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Nt(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;const n=K(t.point.x,0,t.bounds.width,0,100),l=K(t.point.y,0,t.bounds.height,100,0),[h,,,v]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new O([h,n,l,v],"hsv"),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){Hn(t.key)&&t.preventDefault();const[e,n,l,h]=this.value.rawValue.getComponents("hsv"),v=Ht(!1),y=ot(v,xt(t)),S=ot(v,Le(t));y===0&&S===0||this.value.setRawValue(new O([e,n+y,l+S,h],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(t){const e=Ht(!1),n=ot(e,xt(t)),l=ot(e,Le(t));n===0&&l===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class Ya{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.hPaletteC_=new Ga(t,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new $a(t,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=e.supportsAlpha?{palette:new ja(t,{value:this.value,viewProps:this.viewProps}),text:new Te(t,{parser:yt,baseStep:.1,props:M.fromObject({draggingScale:.01,formatter:J(2)}),value:$(0,{constraint:new Wt({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&ke({primary:this.value,secondary:this.alphaIcs_.text.value,forward:n=>n.rawValue.getComponents()[3],backward:(n,l)=>{const h=n.rawValue.getComponents();return h[3]=l.rawValue,new O(h,n.rawValue.mode)}}),this.textC_=new Fa(t,{colorType:e.colorType,parser:yt,value:this.value,viewProps:this.viewProps}),this.view=new ya(t,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:e.supportsAlpha,svPaletteView:this.svPaletteC_.view,textView:this.textC_.view,viewProps:this.viewProps})}get textController(){return this.textC_}}const Fs=T("colsw");class Xa{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),e.value.emitter.on("change",this.onValueChange_),this.value=e.value,this.element=t.createElement("div"),this.element.classList.add(Fs()),e.viewProps.bindClassModifiers(this.element);const n=t.createElement("div");n.classList.add(Fs("sw")),this.element.appendChild(n),this.swatchElem_=n;const l=t.createElement("button");l.classList.add(Fs("b")),e.viewProps.bindDisabled(l),this.element.appendChild(l),this.buttonElement=l,this.update_()}update_(){const t=this.value.rawValue;this.swatchElem_.style.backgroundColor=js(t)}onValueChange_(){this.update_()}}class Wa{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.view=new Xa(t,{value:this.value,viewProps:this.viewProps})}}class zs{constructor(t,e){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.foldable_=st.create(e.expanded),this.swatchC_=new Wa(t,{value:this.value,viewProps:this.viewProps});const n=this.swatchC_.view.buttonElement;n.addEventListener("blur",this.onButtonBlur_),n.addEventListener("click",this.onButtonClick_),this.textC_=new ze(t,{parser:e.parser,props:M.fromObject({formatter:e.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new da(t,{foldable:this.foldable_,pickerLayout:e.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=e.pickerLayout==="popup"?new Rn(t,{viewProps:this.viewProps}):null;const l=new Ya(t,{colorType:e.colorType,supportsAlpha:e.supportsAlpha,value:this.value,viewProps:this.viewProps});l.view.allFocusableElements.forEach(h=>{h.addEventListener("blur",this.onPopupChildBlur_),h.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=l,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(l.view.element),ke({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:h=>h.rawValue,backward:(h,v)=>v.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),gs(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(t){if(!this.popC_)return;const e=this.view.element,n=t.relatedTarget;(!n||!e.contains(n))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(t){if(!this.popC_)return;const e=this.popC_.view.element,n=b(t);n&&e.contains(n)||n&&n===this.swatchC_.view.buttonElement&&!ue(e.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(t){this.popC_?t.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&t.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}}function Za(s,t){return O.isColorObject(s)?O.fromObject(s,t):O.black(t)}function Ja(s){return Ut(s.getComponents("rgb")).reduce((t,e)=>t<<8|Math.floor(e)&255,0)}function Qa(s){return s.getComponents("rgb").reduce((t,e,n)=>{const l=Math.floor(n===3?e*255:e)&255;return t<<8|l},0)>>>0}function tl(s){return new O([s>>16&255,s>>8&255,s&255],"rgb")}function el(s){return new O([s>>24&255,s>>16&255,s>>8&255,K(s&255,0,255,0,1)],"rgb")}function sl(s){return typeof s!="number"?O.black():tl(s)}function nl(s){return typeof s!="number"?O.black():el(s)}function il(s){const t=Us(s);return t?(e,n)=>{Ae(e,t(n))}:null}function ol(s){const t=s?Qa:Ja;return(e,n)=>{Ae(e,t(n))}}function rl(s,t,e){const n=t.toRgbaObject(e);s.writeProperty("r",n.r),s.writeProperty("g",n.g),s.writeProperty("b",n.b),s.writeProperty("a",n.a)}function al(s,t,e){const n=t.toRgbaObject(e);s.writeProperty("r",n.r),s.writeProperty("g",n.g),s.writeProperty("b",n.b)}function ll(s,t){return(e,n)=>{s?rl(e,n,t):al(e,n,t)}}function Gs(s){var t;return!!(s!=null&&s.alpha||!((t=s==null?void 0:s.color)===null||t===void 0)&&t.alpha)}function cl(s){return s?t=>js(t,"0x"):t=>di(t,"0x")}function pl(s){return"color"in s||"view"in s&&s.view==="color"}const dl={id:"input-color-number",type:"input",accept:(s,t)=>{if(typeof s!="number"||!pl(t))return null;const e=Os(t);return e?{initialValue:s,params:e}:null},binding:{reader:s=>Gs(s.params)?nl:sl,equals:O.equals,writer:s=>ol(Gs(s.params))},controller:s=>{const t=Gs(s.params),e="expanded"in s.params?s.params.expanded:void 0,n="picker"in s.params?s.params.picker:void 0;return new zs(s.document,{colorType:"int",expanded:e??!1,formatter:cl(t),parser:Ns("int"),pickerLayout:n??"popup",supportsAlpha:t,value:s.value,viewProps:s.viewProps})}};function hl(s){return O.isRgbaColorObject(s)}function ul(s){return t=>Za(t,s)}function ml(s,t){return e=>s?mi(e,t):ui(e,t)}const vl={id:"input-color-object",type:"input",accept:(s,t)=>{if(!O.isColorObject(s))return null;const e=Os(t);return e?{initialValue:s,params:e}:null},binding:{reader:s=>ul(Bt(s.params)),equals:O.equals,writer:s=>ll(hl(s.initialValue),Bt(s.params))},controller:s=>{var t;const e=O.isRgbaColorObject(s.initialValue),n="expanded"in s.params?s.params.expanded:void 0,l="picker"in s.params?s.params.picker:void 0,h=(t=Bt(s.params))!==null&&t!==void 0?t:"int";return new zs(s.document,{colorType:h,expanded:n??!1,formatter:ml(e,h),parser:Ns(h),pickerLayout:l??"popup",supportsAlpha:e,value:s.value,viewProps:s.viewProps})}},bl={id:"input-color-string",type:"input",accept:(s,t)=>{if(typeof s!="string"||"view"in t&&t.view==="text")return null;const e=Ds(s,Bt(t));if(!e||!Us(e))return null;const n=Os(t);return n?{initialValue:s,params:n}:null},binding:{reader:s=>{var t;return Aa((t=Bt(s.params))!==null&&t!==void 0?t:"int")},equals:O.equals,writer:s=>{const t=Ds(s.initialValue,Bt(s.params));if(!t)throw C.shouldNeverHappen();const e=il(t);if(!e)throw C.notBindable();return e}},controller:s=>{const t=Ds(s.initialValue,Bt(s.params));if(!t)throw C.shouldNeverHappen();const e=Us(t);if(!e)throw C.shouldNeverHappen();const n="expanded"in s.params?s.params.expanded:void 0,l="picker"in s.params?s.params.picker:void 0;return new zs(s.document,{colorType:t.type,expanded:n??!1,formatter:e,parser:Ns(t.type),pickerLayout:l??"popup",supportsAlpha:t.alpha,value:s.value,viewProps:s.viewProps})}};class Rt{constructor(t){this.components=t.components,this.asm_=t.assembly}constrain(t){const e=this.asm_.toComponents(t).map((n,l)=>{var h,v;return(v=(h=this.components[l])===null||h===void 0?void 0:h.constrain(n))!==null&&v!==void 0?v:n});return this.asm_.fromComponents(e)}}const bi=T("pndtxt");class gl{constructor(t,e){this.textViews=e.textViews,this.element=t.createElement("div"),this.element.classList.add(bi()),this.textViews.forEach(n=>{const l=t.createElement("div");l.classList.add(bi("a")),l.appendChild(n.element),this.element.appendChild(l)})}}function fl(s,t,e){return new Te(s,{arrayPosition:e===0?"fst":e===t.axes.length-1?"lst":"mid",baseStep:t.axes[e].baseStep,parser:t.parser,props:t.axes[e].textProps,value:$(0,{constraint:t.axes[e].constraint}),viewProps:t.viewProps})}class qs{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.acs_=e.axes.map((n,l)=>fl(t,e,l)),this.acs_.forEach((n,l)=>{ke({primary:this.value,secondary:n.value,forward:h=>e.assembly.toComponents(h.rawValue)[l],backward:(h,v)=>{const y=e.assembly.toComponents(h.rawValue);return y[l]=v.rawValue,e.assembly.fromComponents(y)}})}),this.view=new gl(t,{textViews:this.acs_.map(n=>n.view)})}}function gi(s,t){return"step"in s&&!m(s.step)?new Fe(s.step,t):null}function fi(s){return!m(s.max)&&!m(s.min)?new Wt({max:s.max,min:s.min}):!m(s.max)||!m(s.min)?new An({max:s.max,min:s.min}):null}function _l(s){const t=wt(s,Wt);if(t)return[t.values.get("min"),t.values.get("max")];const e=wt(s,An);return e?[e.minValue,e.maxValue]:[void 0,void 0]}function wl(s,t){const e=[],n=gi(s,t);n&&e.push(n);const l=fi(s);l&&e.push(l);const h=Is(s.options);return h&&e.push(h),new ye(e)}const yl={id:"input-number",type:"input",accept:(s,t)=>{if(typeof s!="number")return null;const e=H,n=q(t,{format:e.optional.function,max:e.optional.number,min:e.optional.number,options:e.optional.custom(qe),step:e.optional.number});return n?{initialValue:s,params:n}:null},binding:{reader:s=>jn,constraint:s=>wl(s.params,s.initialValue),writer:s=>Ae},controller:s=>{var t;const e=s.value,n=s.constraint,l=n&&wt(n,xe);if(l)return new Ce(s.document,{props:new M({options:l.values.value("options")}),value:e,viewProps:s.viewProps});const h=(t="format"in s.params?s.params.format:void 0)!==null&&t!==void 0?t:J($e(n,e.rawValue)),v=n&&wt(n,Wt);return v?new Vs(s.document,{baseStep:Zt(n),parser:yt,sliderProps:new M({maxValue:v.values.value("max"),minValue:v.values.value("min")}),textProps:M.fromObject({draggingScale:Jt(n,e.rawValue),formatter:h}),value:e,viewProps:s.viewProps}):new Te(s.document,{baseStep:Zt(n),parser:yt,props:M.fromObject({draggingScale:Jt(n,e.rawValue),formatter:h}),value:e,viewProps:s.viewProps})}};class Mt{constructor(t=0,e=0){this.x=t,this.y=e}getComponents(){return[this.x,this.y]}static isObject(t){if(m(t))return!1;const e=t.x,n=t.y;return!(typeof e!="number"||typeof n!="number")}static equals(t,e){return t.x===e.x&&t.y===e.y}toObject(){return{x:this.x,y:this.y}}}const _i={toComponents:s=>s.getComponents(),fromComponents:s=>new Mt(...s)},te=T("p2d");class xl{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(te()),e.viewProps.bindClassModifiers(this.element),B(e.expanded,Q(this.element,te(void 0,"expanded")));const n=t.createElement("div");n.classList.add(te("h")),this.element.appendChild(n);const l=t.createElement("button");l.classList.add(te("b")),l.appendChild(Dt(t,"p2dpad")),e.viewProps.bindDisabled(l),n.appendChild(l),this.buttonElement=l;const h=t.createElement("div");if(h.classList.add(te("t")),n.appendChild(h),this.textElement=h,e.pickerLayout==="inline"){const v=t.createElement("div");v.classList.add(te("p")),this.element.appendChild(v),this.pickerElement=v}else this.pickerElement=null}}const Vt=T("p2dp");class Cl{constructor(t,e){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.invertsY_=e.invertsY,this.maxValue_=e.maxValue,this.element=t.createElement("div"),this.element.classList.add(Vt()),e.layout==="popup"&&this.element.classList.add(Vt(void 0,"p")),e.viewProps.bindClassModifiers(this.element);const n=t.createElement("div");n.classList.add(Vt("p")),e.viewProps.bindTabIndex(n),this.element.appendChild(n),this.padElement=n;const l=t.createElementNS(it,"svg");l.classList.add(Vt("g")),this.padElement.appendChild(l),this.svgElem_=l;const h=t.createElementNS(it,"line");h.classList.add(Vt("ax")),h.setAttributeNS(null,"x1","0"),h.setAttributeNS(null,"y1","50%"),h.setAttributeNS(null,"x2","100%"),h.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(h);const v=t.createElementNS(it,"line");v.classList.add(Vt("ax")),v.setAttributeNS(null,"x1","50%"),v.setAttributeNS(null,"y1","0"),v.setAttributeNS(null,"x2","50%"),v.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(v);const y=t.createElementNS(it,"line");y.classList.add(Vt("l")),y.setAttributeNS(null,"x1","50%"),y.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(y),this.lineElem_=y;const S=t.createElement("div");S.classList.add(Vt("m")),this.padElement.appendChild(S),this.markerElem_=S,e.value.emitter.on("change",this.onValueChange_),this.value=e.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[t,e]=this.value.rawValue.getComponents(),n=this.maxValue_,l=K(t,-n,+n,0,100),h=K(e,-n,+n,0,100),v=this.invertsY_?100-h:h;this.lineElem_.setAttributeNS(null,"x2",`${l}%`),this.lineElem_.setAttributeNS(null,"y2",`${v}%`),this.markerElem_.style.left=`${l}%`,this.markerElem_.style.top=`${v}%`}onValueChange_(){this.update_()}onFoldableChange_(){this.update_()}}function wi(s,t,e){return[ot(t[0],xt(s)),ot(t[1],Le(s))*(e?1:-1)]}class El{constructor(t,e){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.baseSteps_=e.baseSteps,this.maxValue_=e.maxValue,this.invertsY_=e.invertsY,this.view=new Cl(t,{invertsY:this.invertsY_,layout:e.layout,maxValue:this.maxValue_,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Nt(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;const n=this.maxValue_,l=K(t.point.x,0,t.bounds.width,-n,+n),h=K(this.invertsY_?t.bounds.height-t.point.y:t.point.y,0,t.bounds.height,-n,+n);this.value.setRawValue(new Mt(l,h),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onPadKeyDown_(t){Hn(t.key)&&t.preventDefault();const[e,n]=wi(t,this.baseSteps_,this.invertsY_);e===0&&n===0||this.value.setRawValue(new Mt(this.value.rawValue.x+e,this.value.rawValue.y+n),{forceEmit:!1,last:!1})}onPadKeyUp_(t){const[e,n]=wi(t,this.baseSteps_,this.invertsY_);e===0&&n===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class Pl{constructor(t,e){var n,l;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.foldable_=st.create(e.expanded),this.popC_=e.pickerLayout==="popup"?new Rn(t,{viewProps:this.viewProps}):null;const h=new El(t,{baseSteps:[e.axes[0].baseStep,e.axes[1].baseStep],invertsY:e.invertsY,layout:e.pickerLayout,maxValue:e.maxValue,value:this.value,viewProps:this.viewProps});h.view.allFocusableElements.forEach(v=>{v.addEventListener("blur",this.onPopupChildBlur_),v.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=h,this.textC_=new qs(t,{assembly:_i,axes:e.axes,parser:e.parser,value:this.value,viewProps:this.viewProps}),this.view=new xl(t,{expanded:this.foldable_.value("expanded"),pickerLayout:e.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(n=this.view.buttonElement)===null||n===void 0||n.addEventListener("blur",this.onPadButtonBlur_),(l=this.view.buttonElement)===null||l===void 0||l.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),ke({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:v=>v.rawValue,backward:(v,y)=>y.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),gs(this.foldable_,this.view.pickerElement))}onPadButtonBlur_(t){if(!this.popC_)return;const e=this.view.element,n=t.relatedTarget;(!n||!e.contains(n))&&(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(t){if(!this.popC_)return;const e=this.popC_.view.element,n=b(t);n&&e.contains(n)||n&&n===this.view.buttonElement&&!ue(e.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(t){this.popC_?t.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&t.key==="Escape"&&this.view.buttonElement.focus()}}class ee{constructor(t=0,e=0,n=0){this.x=t,this.y=e,this.z=n}getComponents(){return[this.x,this.y,this.z]}static isObject(t){if(m(t))return!1;const e=t.x,n=t.y,l=t.z;return!(typeof e!="number"||typeof n!="number"||typeof l!="number")}static equals(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const yi={toComponents:s=>s.getComponents(),fromComponents:s=>new ee(...s)};function kl(s){return ee.isObject(s)?new ee(s.x,s.y,s.z):new ee}function Ll(s,t){s.writeProperty("x",t.x),s.writeProperty("y",t.y),s.writeProperty("z",t.z)}function Tl(s,t){return new Rt({assembly:yi,components:[Ct("x"in s?s.x:void 0,t.x),Ct("y"in s?s.y:void 0,t.y),Ct("z"in s?s.z:void 0,t.z)]})}function $s(s,t){return{baseStep:Zt(t),constraint:t,textProps:M.fromObject({draggingScale:Jt(t,s),formatter:J($e(t,s))})}}const Al={id:"input-point3d",type:"input",accept:(s,t)=>{if(!ee.isObject(s))return null;const e=H,n=q(t,{x:e.optional.custom(At),y:e.optional.custom(At),z:e.optional.custom(At)});return n?{initialValue:s,params:n}:null},binding:{reader:s=>kl,constraint:s=>Tl(s.params,s.initialValue),equals:ee.equals,writer:s=>Ll},controller:s=>{const t=s.value,e=s.constraint;if(!(e instanceof Rt))throw C.shouldNeverHappen();return new qs(s.document,{assembly:yi,axes:[$s(t.rawValue.x,e.components[0]),$s(t.rawValue.y,e.components[1]),$s(t.rawValue.z,e.components[2])],parser:yt,value:t,viewProps:s.viewProps})}};class se{constructor(t=0,e=0,n=0,l=0){this.x=t,this.y=e,this.z=n,this.w=l}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(t){if(m(t))return!1;const e=t.x,n=t.y,l=t.z,h=t.w;return!(typeof e!="number"||typeof n!="number"||typeof l!="number"||typeof h!="number")}static equals(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z&&t.w===e.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const xi={toComponents:s=>s.getComponents(),fromComponents:s=>new se(...s)};function Sl(s){return se.isObject(s)?new se(s.x,s.y,s.z,s.w):new se}function Rl(s,t){s.writeProperty("x",t.x),s.writeProperty("y",t.y),s.writeProperty("z",t.z),s.writeProperty("w",t.w)}function Ml(s,t){return new Rt({assembly:xi,components:[Ct("x"in s?s.x:void 0,t.x),Ct("y"in s?s.y:void 0,t.y),Ct("z"in s?s.z:void 0,t.z),Ct("w"in s?s.w:void 0,t.w)]})}function Vl(s,t){return{baseStep:Zt(t),constraint:t,textProps:M.fromObject({draggingScale:Jt(t,s),formatter:J($e(t,s))})}}const Il={id:"input-point4d",type:"input",accept:(s,t)=>{if(!se.isObject(s))return null;const e=H,n=q(t,{x:e.optional.custom(At),y:e.optional.custom(At),z:e.optional.custom(At),w:e.optional.custom(At)});return n?{initialValue:s,params:n}:null},binding:{reader:s=>Sl,constraint:s=>Ml(s.params,s.initialValue),equals:se.equals,writer:s=>Rl},controller:s=>{const t=s.value,e=s.constraint;if(!(e instanceof Rt))throw C.shouldNeverHappen();return new qs(s.document,{assembly:xi,axes:t.rawValue.getComponents().map((n,l)=>Vl(n,e.components[l])),parser:yt,value:t,viewProps:s.viewProps})}};function Ol(s){const t=[],e=Is(s.options);return e&&t.push(e),new ye(t)}const Dl={id:"input-string",type:"input",accept:(s,t)=>{if(typeof s!="string")return null;const e=q(t,{options:H.optional.custom(qe)});return e?{initialValue:s,params:e}:null},binding:{reader:s=>Un,constraint:s=>Ol(s.params),writer:s=>Ae},controller:s=>{const t=s.document,e=s.value,n=s.constraint,l=n&&wt(n,xe);return l?new Ce(t,{props:new M({options:l.values.value("options")}),value:e,viewProps:s.viewProps}):new ze(t,{parser:h=>h,props:M.fromObject({formatter:As}),value:e,viewProps:s.viewProps})}},Re={monitor:{defaultInterval:200,defaultLineCount:3}},Ci=T("mll");class Nl{constructor(t,e){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=e.formatter,this.element=t.createElement("div"),this.element.classList.add(Ci()),e.viewProps.bindClassModifiers(this.element);const n=t.createElement("textarea");n.classList.add(Ci("i")),n.style.height=`calc(var(--bld-us) * ${e.lineCount})`,n.readOnly=!0,e.viewProps.bindDisabled(n),this.element.appendChild(n),this.textareaElem_=n,e.value.emitter.on("change",this.onValueUpdate_),this.value=e.value,this.update_()}update_(){const t=this.textareaElem_,e=t.scrollTop===t.scrollHeight-t.clientHeight,n=[];this.value.rawValue.forEach(l=>{l!==void 0&&n.push(this.formatter_(l))}),t.textContent=n.join(`
`),e&&(t.scrollTop=t.scrollHeight)}onValueUpdate_(){this.update_()}}class Ys{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.view=new Nl(t,{formatter:e.formatter,lineCount:e.lineCount,value:this.value,viewProps:this.viewProps})}}const Ei=T("sgl");class jl{constructor(t,e){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=e.formatter,this.element=t.createElement("div"),this.element.classList.add(Ei()),e.viewProps.bindClassModifiers(this.element);const n=t.createElement("input");n.classList.add(Ei("i")),n.readOnly=!0,n.type="text",e.viewProps.bindDisabled(n),this.element.appendChild(n),this.inputElement=n,e.value.emitter.on("change",this.onValueUpdate_),this.value=e.value,this.update_()}update_(){const t=this.value.rawValue,e=t[t.length-1];this.inputElement.value=e!==void 0?this.formatter_(e):""}onValueUpdate_(){this.update_()}}class Xs{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.view=new jl(t,{formatter:e.formatter,value:this.value,viewProps:this.viewProps})}}const Ul={id:"monitor-bool",type:"monitor",accept:(s,t)=>{if(typeof s!="boolean")return null;const e=q(t,{lineCount:H.optional.number});return e?{initialValue:s,params:e}:null},binding:{reader:s=>Vn},controller:s=>{var t;return s.value.rawValue.length===1?new Xs(s.document,{formatter:In,value:s.value,viewProps:s.viewProps}):new Ys(s.document,{formatter:In,lineCount:(t=s.params.lineCount)!==null&&t!==void 0?t:Re.monitor.defaultLineCount,value:s.value,viewProps:s.viewProps})}},It=T("grl");class Hl{constructor(t,e){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=t.createElement("div"),this.element.classList.add(It()),e.viewProps.bindClassModifiers(this.element),this.formatter_=e.formatter,this.props_=e.props,this.cursor_=e.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const n=t.createElementNS(it,"svg");n.classList.add(It("g")),n.style.height=`calc(var(--bld-us) * ${e.lineCount})`,this.element.appendChild(n),this.svgElem_=n;const l=t.createElementNS(it,"polyline");this.svgElem_.appendChild(l),this.lineElem_=l;const h=t.createElement("div");h.classList.add(It("t"),T("tt")()),this.element.appendChild(h),this.tooltipElem_=h,e.value.emitter.on("change",this.onValueUpdate_),this.value=e.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const t=this.svgElem_.getBoundingClientRect(),e=this.value.rawValue.length-1,n=this.props_.get("minValue"),l=this.props_.get("maxValue"),h=[];this.value.rawValue.forEach((N,U)=>{if(N===void 0)return;const Kt=K(U,0,e,0,t.width),Ft=K(N,n,l,t.height,0);h.push([Kt,Ft].join(","))}),this.lineElem_.setAttributeNS(null,"points",h.join(" "));const v=this.tooltipElem_,y=this.value.rawValue[this.cursor_.rawValue];if(y===void 0){v.classList.remove(It("t","a"));return}const S=K(this.cursor_.rawValue,0,e,0,t.width),A=K(y,n,l,t.height,0);v.style.left=`${S}px`,v.style.top=`${A}px`,v.textContent=`${this.formatter_(y)}`,v.classList.contains(It("t","a"))||(v.classList.add(It("t","a"),It("t","in")),Ot(v),v.classList.remove(It("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class Bl{constructor(t,e){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props_=e.props,this.value=e.value,this.viewProps=e.viewProps,this.cursor_=$(-1),this.view=new Hl(t,{cursor:this.cursor_,formatter:e.formatter,lineCount:e.lineCount,props:this.props_,value:this.value,viewProps:this.viewProps}),!ue(t))this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_);else{const n=new Nt(this.view.element);n.emitter.on("down",this.onGraphPointerDown_),n.emitter.on("move",this.onGraphPointerMove_),n.emitter.on("up",this.onGraphPointerUp_)}}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(t){const e=this.view.element.getBoundingClientRect();this.cursor_.rawValue=Math.floor(K(t.offsetX,0,e.width,0,this.value.rawValue.length))}onGraphPointerDown_(t){this.onGraphPointerMove_(t)}onGraphPointerMove_(t){if(!t.data.point){this.cursor_.rawValue=-1;return}this.cursor_.rawValue=Math.floor(K(t.data.point.x,0,t.data.bounds.width,0,this.value.rawValue.length))}onGraphPointerUp_(){this.cursor_.rawValue=-1}}function Ws(s){return"format"in s&&!m(s.format)?s.format:J(2)}function Kl(s){var t;return s.value.rawValue.length===1?new Xs(s.document,{formatter:Ws(s.params),value:s.value,viewProps:s.viewProps}):new Ys(s.document,{formatter:Ws(s.params),lineCount:(t=s.params.lineCount)!==null&&t!==void 0?t:Re.monitor.defaultLineCount,value:s.value,viewProps:s.viewProps})}function Fl(s){var t,e,n;return new Bl(s.document,{formatter:Ws(s.params),lineCount:(t=s.params.lineCount)!==null&&t!==void 0?t:Re.monitor.defaultLineCount,props:M.fromObject({maxValue:(e="max"in s.params?s.params.max:null)!==null&&e!==void 0?e:100,minValue:(n="min"in s.params?s.params.min:null)!==null&&n!==void 0?n:0}),value:s.value,viewProps:s.viewProps})}function Pi(s){return"view"in s&&s.view==="graph"}const zl={id:"monitor-number",type:"monitor",accept:(s,t)=>{if(typeof s!="number")return null;const e=H,n=q(t,{format:e.optional.function,lineCount:e.optional.number,max:e.optional.number,min:e.optional.number,view:e.optional.string});return n?{initialValue:s,params:n}:null},binding:{defaultBufferSize:s=>Pi(s)?64:1,reader:s=>jn},controller:s=>Pi(s.params)?Fl(s):Kl(s)},Gl={id:"monitor-string",type:"monitor",accept:(s,t)=>{if(typeof s!="string")return null;const e=H,n=q(t,{lineCount:e.optional.number,multiline:e.optional.boolean});return n?{initialValue:s,params:n}:null},binding:{reader:s=>Un},controller:s=>{var t;const e=s.value;return e.rawValue.length>1||"multiline"in s.params&&s.params.multiline?new Ys(s.document,{formatter:As,lineCount:(t=s.params.lineCount)!==null&&t!==void 0?t:Re.monitor.defaultLineCount,value:e,viewProps:s.viewProps}):new Xs(s.document,{formatter:As,value:e,viewProps:s.viewProps})}};function ql(s,t){var e;const n=s.accept(t.target.read(),t.params);if(m(n))return null;const l=H,h={target:t.target,initialValue:n.initialValue,params:n.params},v=s.binding.reader(h),y=s.binding.constraint?s.binding.constraint(h):void 0,S=$(v(n.initialValue),{constraint:y,equals:s.binding.equals}),A=new fr({reader:v,target:t.target,value:S,writer:s.binding.writer(h)}),N=l.optional.boolean(t.params.disabled).value,U=l.optional.boolean(t.params.hidden).value,Kt=s.controller({constraint:y,document:t.document,initialValue:n.initialValue,params:n.params,value:A.value,viewProps:pt.create({disabled:N,hidden:U})});return new gt(t.document,{binding:A,blade:et(),props:M.fromObject({label:"label"in t.params?(e=l.optional.string(t.params.label).value)!==null&&e!==void 0?e:null:t.target.key}),valueController:Kt})}function $l(s,t){return t===0?new br:new gr(s,t??Re.monitor.defaultInterval)}function Yl(s,t){var e,n,l;const h=H,v=s.accept(t.target.read(),t.params);if(m(v))return null;const y={target:t.target,initialValue:v.initialValue,params:v.params},S=s.binding.reader(y),A=(n=(e=h.optional.number(t.params.bufferSize).value)!==null&&e!==void 0?e:s.binding.defaultBufferSize&&s.binding.defaultBufferSize(v.params))!==null&&n!==void 0?n:1,N=h.optional.number(t.params.interval).value,U=new xr({reader:S,target:t.target,ticker:$l(t.document,N),value:_r(A)}),Kt=h.optional.boolean(t.params.disabled).value,Ft=h.optional.boolean(t.params.hidden).value,ne=s.controller({document:t.document,params:v.params,value:U.value,viewProps:pt.create({disabled:Kt,hidden:Ft})});return new Tt(t.document,{binding:U,blade:et(),props:M.fromObject({label:"label"in t.params?(l=h.optional.string(t.params.label).value)!==null&&l!==void 0?l:null:t.target.key}),valueController:ne})}class Xl{constructor(){this.pluginsMap_={blades:[],inputs:[],monitors:[]}}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(t){t.type==="blade"?this.pluginsMap_.blades.unshift(t):t.type==="input"?this.pluginsMap_.inputs.unshift(t):t.type==="monitor"&&this.pluginsMap_.monitors.unshift(t)}createInput(t,e,n){const l=e.read();if(m(l))throw new C({context:{key:e.key},type:"nomatchingcontroller"});const h=this.pluginsMap_.inputs.reduce((v,y)=>v??ql(y,{document:t,target:e,params:n}),null);if(h)return h;throw new C({context:{key:e.key},type:"nomatchingcontroller"})}createMonitor(t,e,n){const l=this.pluginsMap_.monitors.reduce((h,v)=>h??Yl(v,{document:t,params:n,target:e}),null);if(l)return l;throw new C({context:{key:e.key},type:"nomatchingcontroller"})}createBlade(t,e){const n=this.pluginsMap_.blades.reduce((l,h)=>l??vr(h,{document:t,params:e}),null);if(!n)throw new C({type:"nomatchingview",context:{params:e}});return n}createBladeApi(t){if(t instanceof gt)return new ws(t);if(t instanceof Tt)return new ys(t);if(t instanceof fe)return new Ke(t,this);const e=this.pluginsMap_.blades.reduce((n,l)=>n??l.api({controller:t,pool:this}),null);if(!e)throw C.shouldNeverHappen();return e}}function Wl(){const s=new Xl;return[sc,Al,Il,Dl,yl,bl,vl,dl,pa,Ul,Gl,zl,bt,lr,pr,Ln].forEach(t=>{s.register(t)}),s}function Zl(s){return Mt.isObject(s)?new Mt(s.x,s.y):new Mt}function Jl(s,t){s.writeProperty("x",t.x),s.writeProperty("y",t.y)}function Ct(s,t){if(!s)return;const e=[],n=gi(s,t);n&&e.push(n);const l=fi(s);return l&&e.push(l),new ye(e)}function Ql(s,t){return new Rt({assembly:_i,components:[Ct("x"in s?s.x:void 0,t.x),Ct("y"in s?s.y:void 0,t.y)]})}function ki(s,t){const[e,n]=s?_l(s):[];if(!m(e)||!m(n))return Math.max(Math.abs(e??0),Math.abs(n??0));const l=Zt(s);return Math.max(Math.abs(l)*10,Math.abs(t)*10)}function tc(s,t){const e=t instanceof Rt?t.components[0]:void 0,n=t instanceof Rt?t.components[1]:void 0,l=ki(e,s.x),h=ki(n,s.y);return Math.max(l,h)}function Li(s,t){return{baseStep:Zt(t),constraint:t,textProps:M.fromObject({draggingScale:Jt(t,s),formatter:J($e(t,s))})}}function ec(s){if(!("y"in s))return!1;const t=s.y;return t&&"inverted"in t?!!t.inverted:!1}const sc={id:"input-point2d",type:"input",accept:(s,t)=>{if(!Mt.isObject(s))return null;const e=H,n=q(t,{expanded:e.optional.boolean,picker:e.optional.custom(Fn),x:e.optional.custom(At),y:e.optional.object({inverted:e.optional.boolean,max:e.optional.number,min:e.optional.number,step:e.optional.number})});return n?{initialValue:s,params:n}:null},binding:{reader:s=>Zl,constraint:s=>Ql(s.params,s.initialValue),equals:Mt.equals,writer:s=>Jl},controller:s=>{const t=s.document,e=s.value,n=s.constraint;if(!(n instanceof Rt))throw C.shouldNeverHappen();const l="expanded"in s.params?s.params.expanded:void 0,h="picker"in s.params?s.params.picker:void 0;return new Pl(t,{axes:[Li(e.rawValue.x,n.components[0]),Li(e.rawValue.y,n.components[1])],expanded:l??!1,invertsY:ec(s.params),maxValue:tc(e.rawValue,n),parser:yt,pickerLayout:h??"popup",value:e,viewProps:s.viewProps})}};class Ti extends a{constructor(t){super(t),this.emitter_=new P,this.controller_.valueController.value.emitter.on("change",e=>{this.emitter_.emit("change",{event:new p(this,e.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(t){this.controller_.props.set("label",t)}get options(){return this.controller_.valueController.props.get("options")}set options(t){this.controller_.valueController.props.set("options",t)}get value(){return this.controller_.valueController.value.rawValue}set value(t){this.controller_.valueController.value.rawValue=t}on(t,e){const n=e.bind(this);return this.emitter_.on(t,l=>{n(l.event)}),this}}class Ai extends a{constructor(t){super(t),this.emitter_=new P,this.controller_.valueController.value.emitter.on("change",e=>{this.emitter_.emit("change",{event:new p(this,e.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(t){this.controller_.props.set("label",t)}get maxValue(){return this.controller_.valueController.sliderController.props.get("maxValue")}set maxValue(t){this.controller_.valueController.sliderController.props.set("maxValue",t)}get minValue(){return this.controller_.valueController.sliderController.props.get("minValue")}set minValue(t){this.controller_.valueController.sliderController.props.set("minValue",t)}get value(){return this.controller_.valueController.value.rawValue}set value(t){this.controller_.valueController.value.rawValue=t}on(t,e){const n=e.bind(this);return this.emitter_.on(t,l=>{n(l.event)}),this}}class Si extends a{constructor(t){super(t),this.emitter_=new P,this.controller_.valueController.value.emitter.on("change",e=>{this.emitter_.emit("change",{event:new p(this,e.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(t){this.controller_.props.set("label",t)}get formatter(){return this.controller_.valueController.props.get("formatter")}set formatter(t){this.controller_.valueController.props.set("formatter",t)}get value(){return this.controller_.valueController.value.rawValue}set value(t){this.controller_.valueController.value.rawValue=t}on(t,e){const n=e.bind(this);return this.emitter_.on(t,l=>{n(l.event)}),this}}const nc=function(){return{id:"list",type:"blade",accept(s){const t=H,e=q(s,{options:t.required.custom(qe),value:t.required.raw,view:t.required.constant("list"),label:t.optional.string});return e?{params:e}:null},controller(s){const t=new xe(zn(s.params.options)),e=$(s.params.value,{constraint:t}),n=new Ce(s.document,{props:new M({options:t.values.value("options")}),value:e,viewProps:s.viewProps});return new Xt(s.document,{blade:s.blade,props:M.fromObject({label:s.params.label}),valueController:n})},api(s){return!(s.controller instanceof Xt)||!(s.controller.valueController instanceof Ce)?null:new Ti(s.controller)}}}();function ic(s){return s.reduce((t,e)=>Object.assign(t,{[e.presetKey]:e.read()}),{})}function oc(s,t){s.forEach(e=>{const n=t[e.target.presetKey];n!==void 0&&e.writer(e.target,e.reader(n))})}class rc extends xs{constructor(t,e){super(t,e)}get element(){return this.controller_.view.element}importPreset(t){const e=this.controller_.rackController.rack.find(gt).map(n=>n.binding);oc(e,t),this.refresh()}exportPreset(){const t=this.controller_.rackController.rack.find(gt).map(e=>e.binding.target);return ic(t)}refresh(){this.controller_.rackController.rack.find(gt).forEach(t=>{t.binding.read()}),this.controller_.rackController.rack.find(Tt).forEach(t=>{t.binding.read()})}}class ac extends Ps{constructor(t,e){super(t,{expanded:e.expanded,blade:e.blade,props:e.props,root:!0,viewProps:e.viewProps})}}const lc={id:"slider",type:"blade",accept(s){const t=H,e=q(s,{max:t.required.number,min:t.required.number,view:t.required.constant("slider"),format:t.optional.function,label:t.optional.string,value:t.optional.number});return e?{params:e}:null},controller(s){var t,e;const n=(t=s.params.value)!==null&&t!==void 0?t:0,l=new Wt({max:s.params.max,min:s.params.min}),h=new Vs(s.document,{baseStep:1,parser:yt,sliderProps:new M({maxValue:l.values.value("max"),minValue:l.values.value("min")}),textProps:M.fromObject({draggingScale:Jt(void 0,n),formatter:(e=s.params.format)!==null&&e!==void 0?e:Qr}),value:$(n,{constraint:l}),viewProps:s.viewProps});return new Xt(s.document,{blade:s.blade,props:M.fromObject({label:s.params.label}),valueController:h})},api(s){return!(s.controller instanceof Xt)||!(s.controller.valueController instanceof Vs)?null:new Ai(s.controller)}},cc=function(){return{id:"text",type:"blade",accept(s){const t=H,e=q(s,{parse:t.required.function,value:t.required.raw,view:t.required.constant("text"),format:t.optional.function,label:t.optional.string});return e?{params:e}:null},controller(s){var t;const e=new ze(s.document,{parser:s.params.parse,props:M.fromObject({formatter:(t=s.params.format)!==null&&t!==void 0?t:n=>String(n)}),value:$(s.params.value),viewProps:s.viewProps});return new Xt(s.document,{blade:s.blade,props:M.fromObject({label:s.params.label}),valueController:e})},api(s){return!(s.controller instanceof Xt)||!(s.controller.valueController instanceof ze)?null:new Si(s.controller)}}}();function pc(s){const t=s.createElement("div");return t.classList.add(T("dfw")()),s.body&&s.body.appendChild(t),t}function Ri(s,t,e){if(s.querySelector(`style[data-tp-style=${t}]`))return;const n=s.createElement("style");n.dataset.tpStyle=t,n.textContent=e,s.head.appendChild(n)}class dc extends rc{constructor(t){var e,n;const l=t??{},h=(e=l.document)!==null&&e!==void 0?e:He(),v=Wl(),y=new ac(h,{expanded:l.expanded,blade:et(),props:M.fromObject({title:l.title}),viewProps:pt.create()});super(y,v),this.pool_=v,this.containerElem_=(n=l.container)!==null&&n!==void 0?n:pc(h),this.containerElem_.appendChild(this.element),this.doc_=h,this.usesDefaultWrapper_=!l.container,this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw C.alreadyDisposed();return this.doc_}dispose(){const t=this.containerElem_;if(!t)throw C.alreadyDisposed();if(this.usesDefaultWrapper_){const e=t.parentElement;e&&e.removeChild(t)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(t){("plugin"in t?[t.plugin]:"plugins"in t?t.plugins:[]).forEach(e=>{this.pool_.register(e),this.embedPluginStyle_(e)})}embedPluginStyle_(t){t.css&&Ri(this.document,`plugin-${t.id}`,t.css)}setUpDefaultPlugins_(){Ri(this.document,"default",'.tp-tbiv_b,.tp-coltxtv_ms,.tp-ckbv_i,.tp-rotv_b,.tp-fldv_b,.tp-mllv_i,.tp-sglv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-mllv_i,.tp-sglv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--mo-fg);height:var(--bld-us);scrollbar-color:currentColor rgba(0,0,0,0);scrollbar-width:thin;width:100%}.tp-mllv_i::-webkit-scrollbar,.tp-sglv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-mllv_i::-webkit-scrollbar-corner,.tp-sglv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:rgba(0,0,0,0)}.tp-mllv_i::-webkit-scrollbar-thumb,.tp-sglv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:rgba(0,0,0,0) solid 2px;border-radius:4px}.tp-rotv{--font-family: var(--tp-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-br: var(--tp-base-border-radius, 6px);--cnt-h-p: var(--tp-container-horizontal-padding, 4px);--cnt-v-p: var(--tp-container-vertical-padding, 4px);--elm-br: var(--tp-element-border-radius, 2px);--bld-s: var(--tp-blade-spacing, 4px);--bld-us: var(--tp-blade-unit-size, 20px);--bs-bg: var(--tp-base-background-color, hsl(230, 7%, 17%));--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--btn-bg: var(--tp-button-background-color, hsl(230, 7%, 70%));--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, hsl(230, 7%, 17%));--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, hsl(230, 7%, 75%));--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, hsl(230, 7%, 75%));--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tabv_c .tp-brkv>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-v-p))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tabv_c .tp-brkv>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--bld-s)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tabv_c .tp-brkv>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tabv_c .tp-brkv>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--elm-br);border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tabv_c .tp-brkv .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-cntv+.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-cntv+.tp-fldv>.tp-fldv_b{border-top-left-radius:0}.tp-tabv_c .tp-brkv>.tp-cntv+.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-cntv+.tp-tabv>.tp-tabv_t{border-top-left-radius:0}.tp-tabv_c .tp-brkv>.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-tabv>.tp-tabv_t{border-top-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--elm-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);overflow:hidden;padding-left:var(--cnt-h-p);padding-right:calc(4px + var(--bld-us) + var(--cnt-h-p));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:"";display:block;height:6px;right:calc(var(--cnt-h-p) + (var(--bld-us) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--elm-br);cursor:pointer;display:block;height:var(--bld-us);position:relative;width:var(--bld-us)}.tp-ckbv_w svg{bottom:0;display:block;height:16px;left:0;margin:auto;opacity:0;position:absolute;right:0;top:0;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--bld-us)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-expanded.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--bld-s);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--bld-s)}.tp-colpv_rgb{display:flex;margin-top:var(--bld-s);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-v-p);padding-top:calc(var(--cnt-v-p) + 2px);position:relative}.tp-colpv_a::before{background-color:var(--grv-fg);content:"";height:2px;left:calc(-1*var(--cnt-h-p));position:absolute;right:calc(-1*var(--cnt-h-p));top:0}.tp-colpv.tp-v-disabled .tp-colpv_a::before{opacity:.5}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--elm-br);outline:none;overflow:hidden;position:relative}.tp-svpv.tp-v-disabled{opacity:.5}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--bld-us)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative}.tp-hplv.tp-v-disabled{opacity:.5}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative;width:100%}.tp-aplv.tp-v-disabled{opacity:.5}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--elm-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--elm-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;cursor:pointer;display:block;height:var(--bld-us);left:0;margin:0;outline:none;padding:0;position:absolute;top:0;width:var(--bld-us)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--elm-br);bottom:0;content:"";display:block;left:0;position:absolute;right:0;top:0}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--elm-br);color:var(--lbl-fg);cursor:pointer;height:var(--bld-us);line-height:var(--bld-us);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv.tp-v-disabled .tp-coltxtv_mm{opacity:.5}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv{position:relative}.tp-fldv.tp-fldv-not .tp-fldv_b{display:none}.tp-fldv_t{padding-left:4px}.tp-fldv_b:disabled .tp-fldv_m{display:none}.tp-fldv_c{padding-left:4px}.tp-fldv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--bld-us) + 4px);width:var(--bs-br)}.tp-fldv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-fldv_b:hover+.tp-fldv_i{color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_i{color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_i{color:var(--cnt-bg-a)}.tp-fldv.tp-v-disabled>.tp-fldv_i{opacity:.5}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--bld-us)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-h-p);padding-right:var(--cnt-h-p)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:160px}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding:0 4px}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--bld-us)*3);line-height:var(--bld-us);padding:0 4px;resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--bld-us);margin-right:4px;position:relative;width:var(--bld-us)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--bld-s);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-p2dpv{padding-left:calc(var(--bld-us) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv.tp-v-disabled .tp-p2dpv_p{opacity:.5}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:6px;box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:168px;padding:var(--cnt-v-p) var(--cnt-h-p);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sprv.tp-v-disabled .tp-sprv_r{opacity:.5}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--bld-us);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin-bottom:auto;margin-top:auto;position:absolute;right:0;top:0}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--elm-br);bottom:0;content:"";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv{position:relative}.tp-tabv_t{align-items:flex-end;color:var(--cnt-bg);display:flex;overflow:hidden;position:relative}.tp-tabv_t:hover{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus){color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active){color:var(--cnt-bg-a)}.tp-tabv_t::before{background-color:currentColor;bottom:0;content:"";height:2px;left:0;pointer-events:none;position:absolute;right:0}.tp-tabv.tp-v-disabled .tp-tabv_t::before{opacity:.5}.tp-tabv.tp-tabv-nop .tp-tabv_t{height:calc(var(--bld-us) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_t::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:0;position:absolute;right:0}.tp-tabv_c{padding-bottom:var(--cnt-v-p);padding-left:4px;padding-top:var(--cnt-v-p)}.tp-tabv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--bld-us) + 4px);width:var(--bs-br)}.tp-tabv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-tabv_t:hover+.tp-tabv_i{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus)+.tp-tabv_i{color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active)+.tp-tabv_i{color:var(--cnt-bg-a)}.tp-tabv.tp-v-disabled>.tp-tabv_i{opacity:.5}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv.tp-v-disabled::before{opacity:.5}.tp-tbiv_b{display:block;padding-left:calc(var(--cnt-h-p) + 4px);padding-right:calc(var(--cnt-h-p) + 4px);position:relative;width:100%}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_b::before{background-color:var(--cnt-bg);bottom:2px;content:"";left:0;pointer-events:none;position:absolute;right:0;top:0}.tp-tbiv_b:hover::before{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus::before{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active::before{background-color:var(--cnt-bg-a)}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);opacity:.5;overflow:hidden;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-txtv{position:relative}.tp-txtv_i{padding:0 4px}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:-3px;position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";height:calc(var(--bld-us) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--elm-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) rgba(0,0,0,0) rgba(0,0,0,0) rgba(0,0,0,0);border-style:solid;border-width:2px;box-sizing:border-box;content:"";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--font-family);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--bld-us) + var(--cnt-h-p));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0}.tp-rotv.tp-rotv-not .tp-rotv_b{display:none}.tp-rotv_b:disabled .tp-rotv_m{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_t{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}'),this.pool_.getAll().forEach(t=>{this.embedPluginStyle_(t)}),this.registerPlugin({plugins:[lc,nc,Ln,cc]})}}const hc=new o("3.1.10");r.BladeApi=a,r.ButtonApi=R,r.FolderApi=xs,r.InputBindingApi=ws,r.ListApi=Ti,r.MonitorBindingApi=ys,r.Pane=dc,r.SeparatorApi=_n,r.SliderApi=Ai,r.TabApi=En,r.TabPageApi=Cn,r.TextApi=Si,r.TpChangeEvent=p,r.VERSION=hc,Object.defineProperty(r,"__esModule",{value:!0})})})(ss,ss.exports);var Zi=ss.exports;class Ji{constructor(){this.pane=new Zi.Pane}}const Qi="modulepreload",to=function(w){return"/folio_3js/"+w},an={},eo=function(w,i,r){if(!i||i.length===0)return w();const o=document.getElementsByTagName("link");return Promise.all(i.map(a=>{if(a=to(a),a in an)return;an[a]=!0;const c=a.endsWith(".css"),p=c?'[rel="stylesheet"]':"";if(r)for(let u=o.length-1;u>=0;u--){const g=o[u];if(g.href===a&&(!c||g.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${a}"]${p}`))return;const d=document.createElement("link");if(d.rel=c?"stylesheet":Qi,c||(d.as="script",d.crossOrigin=""),d.href=a,document.head.appendChild(d),c)return new Promise((u,g)=>{d.addEventListener("load",u),d.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${a}`)))})})).then(()=>w()).catch(a=>{const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=a,window.dispatchEvent(c),!c.defaultPrevented)throw a})};class so{constructor(){this.app=new mt,this.scene=this.app.scene,this.meshMap=new Map,eo(()=>import("./rapier-2686a024.js").then(async i=>(await i.__tla,i)),[]).then(i=>{const r={x:0,y:-9.81,z:0};this.world=new i.World(r),this.rapier=i,this.rapierLoaded=!0,es.setState({physicsReady:!0})})}add(i,r,o){let a;switch(r){case"dynamic":a=this.rapier.RigidBodyDesc.dynamic();break;case"fixed":a=this.rapier.RigidBodyDesc.fixed();break;case"kinematic":a=this.rapier.RigidBodyDesc.kinematicPositionBased();break}this.rigidBody=this.world.createRigidBody(a);let c;switch(o){case"cuboid":const u=this.computeCuboidDimensions(i);c=this.rapier.ColliderDesc.cuboid(u.x/2,u.y/2,u.z/2),this.world.createCollider(c,this.rigidBody);break;case"ball":const g=this.computeBallDimensions(i);c=this.rapier.ColliderDesc.ball(g),this.world.createCollider(c,this.rigidBody);break;case"trimesh":const{scaledVertices:f,indices:m}=this.computeTrimeshDimensions(i);c=this.rapier.ColliderDesc.trimesh(f,m),this.world.createCollider(c,this.rigidBody);break}const p=i.getWorldPosition(new j),d=i.getWorldQuaternion(new Et);return this.rigidBody.setTranslation(p),this.rigidBody.setRotation(d),this.meshMap.set(i,this.rigidBody),this.rigidBody}computeCuboidDimensions(i){i.geometry.computeBoundingBox();const r=i.geometry.boundingBox.getSize(new j),o=i.getWorldScale(new j);return r.multiply(o),r}computeBallDimensions(i){i.geometry.computeBoundingSphere();const r=i.geometry.boundingSphere.radius,o=i.getWorldScale(new j),a=Math.max(o.x,o.y,o.z);return r*a}computeTrimeshDimensions(i){const r=i.geometry.attributes.position.array,o=i.geometry.index.array,a=i.getWorldScale(new j);return{scaledVertices:r.map((c,p)=>c*a.getComponent(p%3)),indices:o}}loop(){this.rapierLoaded&&(this.world.step(),this.meshMap.forEach((i,r)=>{const o=new j().copy(i.translation()),a=new Et().copy(i.rotation());o.applyMatrix4(new ae().copy(r.parent.matrixWorld).invert());const c=new ae().extractRotation(r.parent.matrixWorld).invert(),p=new Et().setFromRotationMatrix(c);a.premultiply(p),r.position.copy(o),r.quaternion.copy(a)}))}}const no=[{id:"avatar",path:"/models/avatar.glb",type:"model"},{id:"environment",path:"/models/environment.glb",type:"model"}],Oe=Ie(w=>({assetsToLoad:no,loadedAssets:{},addLoadedAsset:(i,r)=>w(o=>({loadedAssets:{...o.loadedAssets,[r]:i}}))}));class io{constructor(){this.app=new mt,this.scene=this.app.scene,this.physics=this.app.world.physics,this.pane=this.app.gui.pane,this.assetStore=Oe.getState(),this.environment=this.assetStore.loadedAssets.environment,this.loadEnvironment(),this.addLights()}loadEnvironment(){const i=this.environment.scene;this.scene.add(i),i.position.set(-4.8,0,-7.4),i.rotation.set(0,-.6,0),i.scale.setScalar(1.3);const r=["trees","terrain","rocks","stairs","gates","floor","bushes"],o=["trees","terrain","rocks","stairs","gates","bushes"],a=["floor","terrain"];for(const c of i.children)c.traverse(p=>{p.isMesh&&(p.castShadow=o.some(d=>c.name.includes(d)),p.receiveShadow=a.some(d=>c.name.includes(d)),r.some(d=>c.name.includes(d))&&this.physics.add(p,"fixed","cuboid"))})}addLights(){const i=new fc(16777215,.5);this.scene.add(i),this.directionalLight=new Ii(16777215,.5),this.directionalLight.position.set(1,1,1),this.directionalLight.castShadow=!0,this.directionalLight.shadow.camera.top=30,this.directionalLight.shadow.camera.right=30,this.directionalLight.shadow.camera.left=-30,this.directionalLight.shadow.camera.bottom=-30,this.directionalLight.shadow.bias=-.002,this.directionalLight.shadow.normalBias=.072,this.scene.add(this.directionalLight)}}class oo{constructor(){this.app=new mt,this.scene=this.app.scene,this.assetStore=Oe.getState(),this.avatar=this.assetStore.loadedAssets.avatar,this.instantiateCharacter()}instantiateCharacter(){const i=new _c(.6,2,.6),r=new Zs({color:65280,wireframe:!0,visible:!1});this.instance=new Oi(i,r),this.instance.position.set(0,4,0),this.scene.add(this.instance);const o=this.avatar.scene;o.rotation.y=Math.PI,o.position.y=-1,this.instance.add(o)}}class ro{constructor(){this.app=new mt,this.scene=this.app.scene,this.physics=this.app.world.physics,this.character=this.app.world.character.instance,F.subscribe(i=>{this.forward=i.forward,this.backward=i.backward,this.left=i.left,this.right=i.right}),this.instantiateController()}instantiateController(){this.rigidBodyType=this.physics.rapier.RigidBodyDesc.kinematicPositionBased(),this.rigidBody=this.physics.world.createRigidBody(this.rigidBodyType),this.colliderType=this.physics.rapier.ColliderDesc.cuboid(.3,1,.3),this.collider=this.physics.world.createCollider(this.colliderType,this.rigidBody);const i=this.character.getWorldPosition(new j),r=this.character.getWorldQuaternion(new Et);this.rigidBody.setTranslation(i),this.rigidBody.setRotation(r),this.characterController=this.physics.world.createCharacterController(.01),this.characterController.setApplyImpulsesToDynamicBodies(!0),this.characterController.enableAutostep(1,.1,!1),this.characterController.enableSnapToGround(1)}loop(){const i=new j;if(this.forward&&(i.z-=1),this.backward&&(i.z+=1),this.left&&(i.x-=1),this.right&&(i.x+=1),i.length()!==0){const o=Math.atan2(i.x,i.z),a=new Et().setFromAxisAngle(new j(0,1,0),o+Math.PI),c=F.getState().diagonal?.2:.1;this.character.quaternion.slerp(a,c)}i.normalize().multiplyScalar(.18),i.y=-1,this.characterController.computeColliderMovement(this.collider,i);const r=new j().copy(this.rigidBody.translation()).add(this.characterController.computedMovement());this.rigidBody.setNextKinematicTranslation(r),this.character.position.lerp(this.rigidBody.translation(),.1)}}class ao{constructor(){this.app=new mt,this.scene=this.app.scene,this.avatar=this.app.world.character.avatar,F.subscribe(i=>this.onInput(i)),this.instantiatedAnimations()}instantiatedAnimations(){this.avatar.animations[0],this.mixer=new wc(this.avatar.scene),this.animations=new Map,this.avatar.animations.forEach(i=>{this.animations.set(i.name,this.mixer.clipAction(i))}),this.currentAction=this.animations.get("Idle"),this.currentAction.play()}playAnimation(i){if(this.currentAction===this.animations.get(i))return;const r=this.animations.get(i);r.reset(),r.play(),r.crossFadeFrom(this.currentAction,.2),this.currentAction=r}onInput(i){i.forward||i.backward||i.left||i.right?this.playAnimation("Run"):this.playAnimation("Idle")}loop(i){this.mixer.update(i)}}class lo{constructor(i,r){this.app=new mt,this.scene=this.app.scene,this.physics=this.app.world.physics,this.title=r.title,this.description=r.description,this.color=r.color,this.position=i,this.createTriggerZone(),this.playerInTrigger=!1,this.cooldown=!1}createTriggerZone(){const i=this.physics.rapier.ColliderDesc.cuboid(1.5,2,.1).setTranslation(this.position.x,this.position.y,this.position.z).setSensor(!0).setActiveEvents(this.physics.rapier.ActiveEvents.COLLISION_EVENTS);this.triggerCollider=this.physics.world.createCollider(i),this.triggerCollider.parent=this}update(){if(this.app.world.characterController&&!this.cooldown){const i=this.app.world.characterController.rigidBody.translation(),r=this.position,o=Math.sqrt(Math.pow(r.x-i.x,2)+Math.pow(r.z-i.z,2));o<1.2&&!this.playerInTrigger?this.handlePlayerEnter(this.app.modalManager):o>=1.8&&this.playerInTrigger&&this.handlePlayerExit()}}handlePlayerEnter(i){!this.cooldown&&!this.playerInTrigger&&(this.playerInTrigger=!0,i==null||i.openModal(this.title,this.description),this.cooldown=!0,setTimeout(()=>{this.cooldown=!1},1e3))}handlePlayerExit(){this.playerInTrigger=!1}dispose(){this.triggerCollider&&this.physics.world.removeCollider(this.triggerCollider)}}class co{constructor(){this.app=new mt,this.scene=this.app.scene,this.physics=new so,this.portalData=[{position:new j(-1.52,3.04-.61,-12.12-.33),data:{title:"Welcome to My World",description:"<div class='intro'><h2>Hi, I'm William Curry</h2><p>Full-stack developer specializing in React and modern JavaScript, with expertise in AI/LLM integration. I combine technical precision with innovative problem-solving to build efficient, scalable applications.</p><p>My development approach leverages cutting-edge tools and techniques \u2013 from AI-assisted workflows to modern frontend frameworks. This interactive portfolio, built with Three.js, demonstrates my passion for creating engaging user experiences.</p><p>My unique background as an EMT has instilled crucial skills in rapid decision-making and calm problem-solving under pressure, qualities that translate perfectly to handling complex technical challenges in fast-paced development environments.</p><p>Navigate through the portals above to explore my professional journey and projects!</p></div>",color:65280}},{position:new j(-5.65,15-10.3,-22.01-4.67),data:{title:"Professional Journey",description:"<div class='work-history'><div class='work-entry'><h3>Web Developer at Tree Three</h3><p class='company'>Mar 2023 - Sep 2023</p><p>Spearheaded development of an e-commerce platform utilizing advanced LLM prompt engineering techniques. Implemented AI-driven design workflows and custom UI optimizations, demonstrating strong problem-solving and technical innovation.</p></div><div class='work-entry'><h3>Frontend Developer at Guaranteed Rate</h3><p class='company'>Jan 2022 - Apr 2022</p><p>Built critical components for loan processing system using React, GraphQL, and Tailwind CSS. Notable achievements include resolving complex UI bugs and maintaining 95% test coverage across components.</p></div><div class='work-entry'><h3>Software Developer at Virtual Service Operations</h3><p class='company'>Sep 2020 - Feb 2021</p><p>Enhanced Kaiser Permanente's Operations Manager platform serving 10,000+ daily users. Utilized Angular, NestJS, and GraphQL in a microservices architecture, achieving 98% code review approval rate.</p></div>",color:255}},{position:new j(8.48,12.17-8.72,-21.25-.54),data:{title:"Featured Projects",description:"<div class='projects-grid'><div class='project-card'><h3>Interactive 3D Portfolio</h3><p>Engineered an immersive showcase utilizing Three.js and Rapier physics engine. Features custom character controller, dynamic lighting, and interactive information portals, demonstrating advanced JavaScript and 3D web technologies.</p><div class='tech-stack'>Three.js \u2022 Rapier Physics \u2022 Advanced JavaScript</div></div><div class='project-card'><h3>AI-Integrated E-commerce Platform</h3><p>Developed custom e-commerce solution utilizing advanced LLM prompt engineering and AI image generation (Midjourney, Leonardo.ai). Implemented comprehensive product design workflow with Adobe Creative Suite integration.</p><div class='tech-stack'>LLM Integration \u2022 AI Tools \u2022 Shopify Development</div></div><div class='project-card'><h3>Loan Assessment System</h3><p>Built critical components for credit assessment tool processing 500+ daily evaluations. Implemented responsive UI with comprehensive testing protocols.</p><div class='tech-stack'>React \u2022 GraphQL \u2022 Tailwind CSS</div></div>",color:16711680}}];const i=es.subscribe(r=>{r.physicsReady&&r.assetsReady&&(this.environment=new io,this.character=new oo,this.characterController=new ro,this.animationController=new ao,this.physics.rapierLoaded&&this.createPortals(),i())});this.loop()}createPortals(){try{this.portals=[],this.portalData.forEach(({position:i,data:r})=>{try{const o=new lo(i,r);this.portals.push(o)}catch(o){console.error("Error creating portal:",o)}})}catch(i){console.error("Error in createPortals:",i)}}loop(i,r){this.physics&&this.physics.loop(),this.characterController&&this.characterController.loop(),this.animationController&&this.animationController.loop(i),this.portals&&this.portals.length>0&&this.portals.forEach(o=>o.update())}}class po{constructor(){const{setState:i}=ts;window.addEventListener("resize",()=>{i({width:window.innerWidth,height:window.innerHeight,pixelRatio:Math.min(window.devicePixelRatio,2)})})}}function ln(w,i){if(i===yc)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),w;if(i===Js||i===Di){let r=w.getIndex();if(r===null){const p=[],d=w.getAttribute("position");if(d!==void 0){for(let u=0;u<d.count;u++)p.push(u);w.setIndex(p),r=w.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),w}const o=r.count-2,a=[];if(i===Js)for(let p=1;p<=o;p++)a.push(r.getX(0)),a.push(r.getX(p)),a.push(r.getX(p+1));else for(let p=0;p<o;p++)p%2===0?(a.push(r.getX(p)),a.push(r.getX(p+1)),a.push(r.getX(p+2))):(a.push(r.getX(p+2)),a.push(r.getX(p+1)),a.push(r.getX(p)));a.length/3!==o&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const c=w.clone();return c.setIndex(a),c.clearGroups(),c}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",i),w}class ho extends Ni{constructor(i){super(i),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(r){return new go(r)}),this.register(function(r){return new Eo(r)}),this.register(function(r){return new Po(r)}),this.register(function(r){return new _o(r)}),this.register(function(r){return new wo(r)}),this.register(function(r){return new yo(r)}),this.register(function(r){return new xo(r)}),this.register(function(r){return new bo(r)}),this.register(function(r){return new Co(r)}),this.register(function(r){return new fo(r)}),this.register(function(r){return new mo(r)}),this.register(function(r){return new ko(r)}),this.register(function(r){return new Lo(r)})}load(i,r,o,a){const c=this;let p;this.resourcePath!==""?p=this.resourcePath:this.path!==""?p=this.path:p=Qs.extractUrlBase(i),this.manager.itemStart(i);const d=function(g){a?a(g):console.error(g),c.manager.itemError(i),c.manager.itemEnd(i)},u=new Je(this.manager);u.setPath(this.path),u.setResponseType("arraybuffer"),u.setRequestHeader(this.requestHeader),u.setWithCredentials(this.withCredentials),u.load(i,function(g){try{c.parse(g,p,function(f){r(f),c.manager.itemEnd(i)},d)}catch(f){d(f)}},o,d)}setDRACOLoader(i){return this.dracoLoader=i,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(i){return this.ktx2Loader=i,this}setMeshoptDecoder(i){return this.meshoptDecoder=i,this}register(i){return this.pluginCallbacks.indexOf(i)===-1&&this.pluginCallbacks.push(i),this}unregister(i){return this.pluginCallbacks.indexOf(i)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(i),1),this}parse(i,r,o,a){let c;const p={},d={},u=new TextDecoder;if(typeof i=="string")c=JSON.parse(i);else if(i instanceof ArrayBuffer)if(u.decode(new Uint8Array(i,0,4))===cn){try{p[D.KHR_BINARY_GLTF]=new To(i)}catch(f){a&&a(f);return}c=JSON.parse(p[D.KHR_BINARY_GLTF].content)}else c=JSON.parse(u.decode(i));else c=i;if(c.asset===void 0||c.asset.version[0]<2){a&&a(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const g=new Bo(c,{path:r||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});g.fileLoader.setRequestHeader(this.requestHeader);for(let f=0;f<this.pluginCallbacks.length;f++){const m=this.pluginCallbacks[f](g);d[m.name]=m,p[m.name]=!0}if(c.extensionsUsed)for(let f=0;f<c.extensionsUsed.length;++f){const m=c.extensionsUsed[f],_=c.extensionsRequired||[];switch(m){case D.KHR_MATERIALS_UNLIT:p[m]=new vo;break;case D.KHR_DRACO_MESH_COMPRESSION:p[m]=new Ao(c,this.dracoLoader);break;case D.KHR_TEXTURE_TRANSFORM:p[m]=new So;break;case D.KHR_MESH_QUANTIZATION:p[m]=new Ro;break;default:_.indexOf(m)>=0&&d[m]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+m+'".')}}g.setExtensions(p),g.setPlugins(d),g.parse(o,a)}parseAsync(i,r){const o=this;return new Promise(function(a,c){o.parse(i,r,a,c)})}}function uo(){let w={};return{get:function(i){return w[i]},add:function(i,r){w[i]=r},remove:function(i){delete w[i]},removeAll:function(){w={}}}}const D={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class mo{constructor(i){this.parser=i,this.name=D.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const i=this.parser,r=this.parser.json.nodes||[];for(let o=0,a=r.length;o<a;o++){const c=r[o];c.extensions&&c.extensions[this.name]&&c.extensions[this.name].light!==void 0&&i._addNodeRef(this.cache,c.extensions[this.name].light)}}_loadLight(i){const r=this.parser,o="light:"+i;let a=r.cache.get(o);if(a)return a;const c=r.json,p=((c.extensions&&c.extensions[this.name]||{}).lights||[])[i];let d;const u=new zt(16777215);p.color!==void 0&&u.fromArray(p.color);const g=p.range!==void 0?p.range:0;switch(p.type){case"directional":d=new Ii(u),d.target.position.set(0,0,-1),d.add(d.target);break;case"point":d=new Cc(u),d.distance=g;break;case"spot":d=new xc(u),d.distance=g,p.spot=p.spot||{},p.spot.innerConeAngle=p.spot.innerConeAngle!==void 0?p.spot.innerConeAngle:0,p.spot.outerConeAngle=p.spot.outerConeAngle!==void 0?p.spot.outerConeAngle:Math.PI/4,d.angle=p.spot.outerConeAngle,d.penumbra=1-p.spot.innerConeAngle/p.spot.outerConeAngle,d.target.position.set(0,0,-1),d.add(d.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+p.type)}return d.position.set(0,0,0),d.decay=2,kt(d,p),p.intensity!==void 0&&(d.intensity=p.intensity),d.name=r.createUniqueName(p.name||"light_"+i),a=Promise.resolve(d),r.cache.add(o,a),a}getDependency(i,r){if(i==="light")return this._loadLight(r)}createNodeAttachment(i){const r=this,o=this.parser,a=o.json.nodes[i],c=(a.extensions&&a.extensions[this.name]||{}).light;return c===void 0?null:this._loadLight(c).then(function(p){return o._getNodeRef(r.cache,c,p)})}}class vo{constructor(){this.name=D.KHR_MATERIALS_UNLIT}getMaterialType(){return Me}extendParams(i,r,o){const a=[];i.color=new zt(1,1,1),i.opacity=1;const c=r.pbrMetallicRoughness;if(c){if(Array.isArray(c.baseColorFactor)){const p=c.baseColorFactor;i.color.fromArray(p),i.opacity=p[3]}c.baseColorTexture!==void 0&&a.push(o.assignTexture(i,"map",c.baseColorTexture,re))}return Promise.all(a)}}class bo{constructor(i){this.parser=i,this.name=D.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(i,r){const o=this.parser.json.materials[i];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const a=o.extensions[this.name].emissiveStrength;return a!==void 0&&(r.emissiveIntensity=a),Promise.resolve()}}class go{constructor(i){this.parser=i,this.name=D.KHR_MATERIALS_CLEARCOAT}getMaterialType(i){const r=this.parser.json.materials[i];return!r.extensions||!r.extensions[this.name]?null:Gt}extendMaterialParams(i,r){const o=this.parser,a=o.json.materials[i];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const c=[],p=a.extensions[this.name];if(p.clearcoatFactor!==void 0&&(r.clearcoat=p.clearcoatFactor),p.clearcoatTexture!==void 0&&c.push(o.assignTexture(r,"clearcoatMap",p.clearcoatTexture)),p.clearcoatRoughnessFactor!==void 0&&(r.clearcoatRoughness=p.clearcoatRoughnessFactor),p.clearcoatRoughnessTexture!==void 0&&c.push(o.assignTexture(r,"clearcoatRoughnessMap",p.clearcoatRoughnessTexture)),p.clearcoatNormalTexture!==void 0&&(c.push(o.assignTexture(r,"clearcoatNormalMap",p.clearcoatNormalTexture)),p.clearcoatNormalTexture.scale!==void 0)){const d=p.clearcoatNormalTexture.scale;r.clearcoatNormalScale=new ut(d,d)}return Promise.all(c)}}class fo{constructor(i){this.parser=i,this.name=D.KHR_MATERIALS_IRIDESCENCE}getMaterialType(i){const r=this.parser.json.materials[i];return!r.extensions||!r.extensions[this.name]?null:Gt}extendMaterialParams(i,r){const o=this.parser,a=o.json.materials[i];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const c=[],p=a.extensions[this.name];return p.iridescenceFactor!==void 0&&(r.iridescence=p.iridescenceFactor),p.iridescenceTexture!==void 0&&c.push(o.assignTexture(r,"iridescenceMap",p.iridescenceTexture)),p.iridescenceIor!==void 0&&(r.iridescenceIOR=p.iridescenceIor),r.iridescenceThicknessRange===void 0&&(r.iridescenceThicknessRange=[100,400]),p.iridescenceThicknessMinimum!==void 0&&(r.iridescenceThicknessRange[0]=p.iridescenceThicknessMinimum),p.iridescenceThicknessMaximum!==void 0&&(r.iridescenceThicknessRange[1]=p.iridescenceThicknessMaximum),p.iridescenceThicknessTexture!==void 0&&c.push(o.assignTexture(r,"iridescenceThicknessMap",p.iridescenceThicknessTexture)),Promise.all(c)}}class _o{constructor(i){this.parser=i,this.name=D.KHR_MATERIALS_SHEEN}getMaterialType(i){const r=this.parser.json.materials[i];return!r.extensions||!r.extensions[this.name]?null:Gt}extendMaterialParams(i,r){const o=this.parser,a=o.json.materials[i];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const c=[];r.sheenColor=new zt(0,0,0),r.sheenRoughness=0,r.sheen=1;const p=a.extensions[this.name];return p.sheenColorFactor!==void 0&&r.sheenColor.fromArray(p.sheenColorFactor),p.sheenRoughnessFactor!==void 0&&(r.sheenRoughness=p.sheenRoughnessFactor),p.sheenColorTexture!==void 0&&c.push(o.assignTexture(r,"sheenColorMap",p.sheenColorTexture,re)),p.sheenRoughnessTexture!==void 0&&c.push(o.assignTexture(r,"sheenRoughnessMap",p.sheenRoughnessTexture)),Promise.all(c)}}class wo{constructor(i){this.parser=i,this.name=D.KHR_MATERIALS_TRANSMISSION}getMaterialType(i){const r=this.parser.json.materials[i];return!r.extensions||!r.extensions[this.name]?null:Gt}extendMaterialParams(i,r){const o=this.parser,a=o.json.materials[i];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const c=[],p=a.extensions[this.name];return p.transmissionFactor!==void 0&&(r.transmission=p.transmissionFactor),p.transmissionTexture!==void 0&&c.push(o.assignTexture(r,"transmissionMap",p.transmissionTexture)),Promise.all(c)}}class yo{constructor(i){this.parser=i,this.name=D.KHR_MATERIALS_VOLUME}getMaterialType(i){const r=this.parser.json.materials[i];return!r.extensions||!r.extensions[this.name]?null:Gt}extendMaterialParams(i,r){const o=this.parser,a=o.json.materials[i];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const c=[],p=a.extensions[this.name];r.thickness=p.thicknessFactor!==void 0?p.thicknessFactor:0,p.thicknessTexture!==void 0&&c.push(o.assignTexture(r,"thicknessMap",p.thicknessTexture)),r.attenuationDistance=p.attenuationDistance||1/0;const d=p.attenuationColor||[1,1,1];return r.attenuationColor=new zt(d[0],d[1],d[2]),Promise.all(c)}}class xo{constructor(i){this.parser=i,this.name=D.KHR_MATERIALS_IOR}getMaterialType(i){const r=this.parser.json.materials[i];return!r.extensions||!r.extensions[this.name]?null:Gt}extendMaterialParams(i,r){const o=this.parser.json.materials[i];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const a=o.extensions[this.name];return r.ior=a.ior!==void 0?a.ior:1.5,Promise.resolve()}}class Co{constructor(i){this.parser=i,this.name=D.KHR_MATERIALS_SPECULAR}getMaterialType(i){const r=this.parser.json.materials[i];return!r.extensions||!r.extensions[this.name]?null:Gt}extendMaterialParams(i,r){const o=this.parser,a=o.json.materials[i];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const c=[],p=a.extensions[this.name];r.specularIntensity=p.specularFactor!==void 0?p.specularFactor:1,p.specularTexture!==void 0&&c.push(o.assignTexture(r,"specularIntensityMap",p.specularTexture));const d=p.specularColorFactor||[1,1,1];return r.specularColor=new zt(d[0],d[1],d[2]),p.specularColorTexture!==void 0&&c.push(o.assignTexture(r,"specularColorMap",p.specularColorTexture,re)),Promise.all(c)}}class Eo{constructor(i){this.parser=i,this.name=D.KHR_TEXTURE_BASISU}loadTexture(i){const r=this.parser,o=r.json,a=o.textures[i];if(!a.extensions||!a.extensions[this.name])return null;const c=a.extensions[this.name],p=r.options.ktx2Loader;if(!p){if(o.extensionsRequired&&o.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return r.loadTextureImage(i,c.source,p)}}class Po{constructor(i){this.parser=i,this.name=D.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(i){const r=this.name,o=this.parser,a=o.json,c=a.textures[i];if(!c.extensions||!c.extensions[r])return null;const p=c.extensions[r],d=a.images[p.source];let u=o.textureLoader;if(d.uri){const g=o.options.manager.getHandler(d.uri);g!==null&&(u=g)}return this.detectSupport().then(function(g){if(g)return o.loadTextureImage(i,p.source,u);if(a.extensionsRequired&&a.extensionsRequired.indexOf(r)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return o.loadTexture(i)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(i){const r=new Image;r.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",r.onload=r.onerror=function(){i(r.height===1)}})),this.isSupported}}class ko{constructor(i){this.name=D.EXT_MESHOPT_COMPRESSION,this.parser=i}loadBufferView(i){const r=this.parser.json,o=r.bufferViews[i];if(o.extensions&&o.extensions[this.name]){const a=o.extensions[this.name],c=this.parser.getDependency("buffer",a.buffer),p=this.parser.options.meshoptDecoder;if(!p||!p.supported){if(r.extensionsRequired&&r.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return c.then(function(d){const u=a.byteOffset||0,g=a.byteLength||0,f=a.count,m=a.byteStride,_=new Uint8Array(d,u,g);return p.decodeGltfBufferAsync?p.decodeGltfBufferAsync(f,m,_,a.mode,a.filter).then(function(x){return x.buffer}):p.ready.then(function(){const x=new ArrayBuffer(f*m);return p.decodeGltfBuffer(new Uint8Array(x),f,m,_,a.mode,a.filter),x})})}else return null}}class Lo{constructor(i){this.name=D.EXT_MESH_GPU_INSTANCING,this.parser=i}createNodeMesh(i){const r=this.parser.json,o=r.nodes[i];if(!o.extensions||!o.extensions[this.name]||o.mesh===void 0)return null;const a=r.meshes[o.mesh];for(const u of a.primitives)if(u.mode!==ct.TRIANGLES&&u.mode!==ct.TRIANGLE_STRIP&&u.mode!==ct.TRIANGLE_FAN&&u.mode!==void 0)return null;const c=o.extensions[this.name].attributes,p=[],d={};for(const u in c)p.push(this.parser.getDependency("accessor",c[u]).then(g=>(d[u]=g,d[u])));return p.length<1?null:(p.push(this.parser.createNodeMesh(i)),Promise.all(p).then(u=>{const g=u.pop(),f=g.isGroup?g.children:[g],m=u[0].count,_=[];for(const x of f){const L=new ae,C=new j,E=new Et,R=new j(1,1,1),P=new Ec(x.geometry,x.material,m);for(let I=0;I<m;I++)d.TRANSLATION&&C.fromBufferAttribute(d.TRANSLATION,I),d.ROTATION&&E.fromBufferAttribute(d.ROTATION,I),d.SCALE&&R.fromBufferAttribute(d.SCALE,I),P.setMatrixAt(I,L.compose(C,E,R));for(const I in d)I!=="TRANSLATION"&&I!=="ROTATION"&&I!=="SCALE"&&x.geometry.setAttribute(I,d[I]);ji.prototype.copy.call(P,x),P.frustumCulled=!1,this.parser.assignFinalMaterial(P),_.push(P)}return g.isGroup?(g.clear(),g.add(..._),g):_[0]}))}}const cn="glTF",le=12,pn={JSON:1313821514,BIN:5130562};class To{constructor(i){this.name=D.KHR_BINARY_GLTF,this.content=null,this.body=null;const r=new DataView(i,0,le),o=new TextDecoder;if(this.header={magic:o.decode(new Uint8Array(i.slice(0,4))),version:r.getUint32(4,!0),length:r.getUint32(8,!0)},this.header.magic!==cn)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const a=this.header.length-le,c=new DataView(i,le);let p=0;for(;p<a;){const d=c.getUint32(p,!0);p+=4;const u=c.getUint32(p,!0);if(p+=4,u===pn.JSON){const g=new Uint8Array(i,le+p,d);this.content=o.decode(g)}else if(u===pn.BIN){const g=le+p;this.body=i.slice(g,g+d)}p+=d}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Ao{constructor(i,r){if(!r)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=D.KHR_DRACO_MESH_COMPRESSION,this.json=i,this.dracoLoader=r,this.dracoLoader.preload()}decodePrimitive(i,r){const o=this.json,a=this.dracoLoader,c=i.extensions[this.name].bufferView,p=i.extensions[this.name].attributes,d={},u={},g={};for(const f in p){const m=is[f]||f.toLowerCase();d[m]=p[f]}for(const f in i.attributes){const m=is[f]||f.toLowerCase();if(p[f]!==void 0){const _=o.accessors[i.attributes[f]],x=qt[_.componentType];g[m]=x.name,u[m]=_.normalized===!0}}return r.getDependency("bufferView",c).then(function(f){return new Promise(function(m){a.decodeDracoFile(f,function(_){for(const x in _.attributes){const L=_.attributes[x],C=u[x];C!==void 0&&(L.normalized=C)}m(_)},d,g)})})}}class So{constructor(){this.name=D.KHR_TEXTURE_TRANSFORM}extendTexture(i,r){return r.texCoord!==void 0&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),r.offset===void 0&&r.rotation===void 0&&r.scale===void 0||(i=i.clone(),r.offset!==void 0&&i.offset.fromArray(r.offset),r.rotation!==void 0&&(i.rotation=r.rotation),r.scale!==void 0&&i.repeat.fromArray(r.scale),i.needsUpdate=!0),i}}class Ro{constructor(){this.name=D.KHR_MESH_QUANTIZATION}}class dn extends tp{constructor(i,r,o,a){super(i,r,o,a)}copySampleValue_(i){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,c=i*a*3+a;for(let p=0;p!==a;p++)r[p]=o[c+p];return r}interpolate_(i,r,o,a){const c=this.resultBuffer,p=this.sampleValues,d=this.valueSize,u=d*2,g=d*3,f=a-r,m=(o-r)/f,_=m*m,x=_*m,L=i*g,C=L-g,E=-2*x+3*_,R=x-_,P=1-E,I=R-_+m;for(let T=0;T!==d;T++){const V=p[C+T+d],X=p[C+T+u]*f,B=p[L+T+d],z=p[L+T]*f;c[T]=P*V+I*X+E*B+R*z}return c}}const Mo=new Et;class Vo extends dn{interpolate_(i,r,o,a){const c=super.interpolate_(i,r,o,a);return Mo.fromArray(c).normalize().toArray(c),c}}const ct={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},qt={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},hn={9728:Bc,9729:Hi,9984:Kc,9985:Fc,9986:zc,9987:Bi},un={33071:Gc,33648:qc,10497:tn},ns={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},is={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Pt={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Io={CUBICSPLINE:void 0,LINEAR:Fi,STEP:$c},os={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function Oo(w){return w.DefaultMaterial===void 0&&(w.DefaultMaterial=new Zs({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Yc})),w.DefaultMaterial}function ce(w,i,r){for(const o in r.extensions)w[o]===void 0&&(i.userData.gltfExtensions=i.userData.gltfExtensions||{},i.userData.gltfExtensions[o]=r.extensions[o])}function kt(w,i){i.extras!==void 0&&(typeof i.extras=="object"?Object.assign(w.userData,i.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+i.extras))}function Do(w,i,r){let o=!1,a=!1,c=!1;for(let g=0,f=i.length;g<f;g++){const m=i[g];if(m.POSITION!==void 0&&(o=!0),m.NORMAL!==void 0&&(a=!0),m.COLOR_0!==void 0&&(c=!0),o&&a&&c)break}if(!o&&!a&&!c)return Promise.resolve(w);const p=[],d=[],u=[];for(let g=0,f=i.length;g<f;g++){const m=i[g];if(o){const _=m.POSITION!==void 0?r.getDependency("accessor",m.POSITION):w.attributes.position;p.push(_)}if(a){const _=m.NORMAL!==void 0?r.getDependency("accessor",m.NORMAL):w.attributes.normal;d.push(_)}if(c){const _=m.COLOR_0!==void 0?r.getDependency("accessor",m.COLOR_0):w.attributes.color;u.push(_)}}return Promise.all([Promise.all(p),Promise.all(d),Promise.all(u)]).then(function(g){const f=g[0],m=g[1],_=g[2];return o&&(w.morphAttributes.position=f),a&&(w.morphAttributes.normal=m),c&&(w.morphAttributes.color=_),w.morphTargetsRelative=!0,w})}function No(w,i){if(w.updateMorphTargets(),i.weights!==void 0)for(let r=0,o=i.weights.length;r<o;r++)w.morphTargetInfluences[r]=i.weights[r];if(i.extras&&Array.isArray(i.extras.targetNames)){const r=i.extras.targetNames;if(w.morphTargetInfluences.length===r.length){w.morphTargetDictionary={};for(let o=0,a=r.length;o<a;o++)w.morphTargetDictionary[r[o]]=o}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function jo(w){const i=w.extensions&&w.extensions[D.KHR_DRACO_MESH_COMPRESSION];let r;return i?r="draco:"+i.bufferView+":"+i.indices+":"+mn(i.attributes):r=w.indices+":"+mn(w.attributes)+":"+w.mode,r}function mn(w){let i="";const r=Object.keys(w).sort();for(let o=0,a=r.length;o<a;o++)i+=r[o]+":"+w[r[o]]+";";return i}function rs(w){switch(w){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function Uo(w){return w.search(/\.jpe?g($|\?)/i)>0||w.search(/^data\:image\/jpeg/)===0?"image/jpeg":w.search(/\.webp($|\?)/i)>0||w.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const Ho=new ae;class Bo{constructor(i={},r={}){this.json=i,this.extensions={},this.plugins={},this.options=r,this.cache=new uo,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let o=!1,a=!1,c=-1;typeof navigator<"u"&&(o=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,a=navigator.userAgent.indexOf("Firefox")>-1,c=a?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||o||a&&c<98?this.textureLoader=new Ui(this.options.manager):this.textureLoader=new Pc(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Je(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(i){this.extensions=i}setPlugins(i){this.plugins=i}parse(i,r){const o=this,a=this.json,c=this.extensions;this.cache.removeAll(),this._invokeAll(function(p){return p._markDefs&&p._markDefs()}),Promise.all(this._invokeAll(function(p){return p.beforeRoot&&p.beforeRoot()})).then(function(){return Promise.all([o.getDependencies("scene"),o.getDependencies("animation"),o.getDependencies("camera")])}).then(function(p){const d={scene:p[0][a.scene||0],scenes:p[0],animations:p[1],cameras:p[2],asset:a.asset,parser:o,userData:{}};ce(c,d,a),kt(d,a),Promise.all(o._invokeAll(function(u){return u.afterRoot&&u.afterRoot(d)})).then(function(){i(d)})}).catch(r)}_markDefs(){const i=this.json.nodes||[],r=this.json.skins||[],o=this.json.meshes||[];for(let a=0,c=r.length;a<c;a++){const p=r[a].joints;for(let d=0,u=p.length;d<u;d++)i[p[d]].isBone=!0}for(let a=0,c=i.length;a<c;a++){const p=i[a];p.mesh!==void 0&&(this._addNodeRef(this.meshCache,p.mesh),p.skin!==void 0&&(o[p.mesh].isSkinnedMesh=!0)),p.camera!==void 0&&this._addNodeRef(this.cameraCache,p.camera)}}_addNodeRef(i,r){r!==void 0&&(i.refs[r]===void 0&&(i.refs[r]=i.uses[r]=0),i.refs[r]++)}_getNodeRef(i,r,o){if(i.refs[r]<=1)return o;const a=o.clone(),c=(p,d)=>{const u=this.associations.get(p);u!=null&&this.associations.set(d,u);for(const[g,f]of p.children.entries())c(f,d.children[g])};return c(o,a),a.name+="_instance_"+i.uses[r]++,a}_invokeOne(i){const r=Object.values(this.plugins);r.push(this);for(let o=0;o<r.length;o++){const a=i(r[o]);if(a)return a}return null}_invokeAll(i){const r=Object.values(this.plugins);r.unshift(this);const o=[];for(let a=0;a<r.length;a++){const c=i(r[a]);c&&o.push(c)}return o}getDependency(i,r){const o=i+":"+r;let a=this.cache.get(o);if(!a){switch(i){case"scene":a=this.loadScene(r);break;case"node":a=this._invokeOne(function(c){return c.loadNode&&c.loadNode(r)});break;case"mesh":a=this._invokeOne(function(c){return c.loadMesh&&c.loadMesh(r)});break;case"accessor":a=this.loadAccessor(r);break;case"bufferView":a=this._invokeOne(function(c){return c.loadBufferView&&c.loadBufferView(r)});break;case"buffer":a=this.loadBuffer(r);break;case"material":a=this._invokeOne(function(c){return c.loadMaterial&&c.loadMaterial(r)});break;case"texture":a=this._invokeOne(function(c){return c.loadTexture&&c.loadTexture(r)});break;case"skin":a=this.loadSkin(r);break;case"animation":a=this._invokeOne(function(c){return c.loadAnimation&&c.loadAnimation(r)});break;case"camera":a=this.loadCamera(r);break;default:if(a=this._invokeOne(function(c){return c!=this&&c.getDependency&&c.getDependency(i,r)}),!a)throw new Error("Unknown type: "+i);break}this.cache.add(o,a)}return a}getDependencies(i){let r=this.cache.get(i);if(!r){const o=this,a=this.json[i+(i==="mesh"?"es":"s")]||[];r=Promise.all(a.map(function(c,p){return o.getDependency(i,p)})),this.cache.add(i,r)}return r}loadBuffer(i){const r=this.json.buffers[i],o=this.fileLoader;if(r.type&&r.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+r.type+" buffer type is not supported.");if(r.uri===void 0&&i===0)return Promise.resolve(this.extensions[D.KHR_BINARY_GLTF].body);const a=this.options;return new Promise(function(c,p){o.load(Qs.resolveURL(r.uri,a.path),c,void 0,function(){p(new Error('THREE.GLTFLoader: Failed to load buffer "'+r.uri+'".'))})})}loadBufferView(i){const r=this.json.bufferViews[i];return this.getDependency("buffer",r.buffer).then(function(o){const a=r.byteLength||0,c=r.byteOffset||0;return o.slice(c,c+a)})}loadAccessor(i){const r=this,o=this.json,a=this.json.accessors[i];if(a.bufferView===void 0&&a.sparse===void 0){const p=ns[a.type],d=qt[a.componentType],u=a.normalized===!0,g=new d(a.count*p);return Promise.resolve(new Ve(g,p,u))}const c=[];return a.bufferView!==void 0?c.push(this.getDependency("bufferView",a.bufferView)):c.push(null),a.sparse!==void 0&&(c.push(this.getDependency("bufferView",a.sparse.indices.bufferView)),c.push(this.getDependency("bufferView",a.sparse.values.bufferView))),Promise.all(c).then(function(p){const d=p[0],u=ns[a.type],g=qt[a.componentType],f=g.BYTES_PER_ELEMENT,m=f*u,_=a.byteOffset||0,x=a.bufferView!==void 0?o.bufferViews[a.bufferView].byteStride:void 0,L=a.normalized===!0;let C,E;if(x&&x!==m){const R=Math.floor(_/x),P="InterleavedBuffer:"+a.bufferView+":"+a.componentType+":"+R+":"+a.count;let I=r.cache.get(P);I||(C=new g(d,R*x,a.count*x/f),I=new kc(C,x/f),r.cache.add(P,I)),E=new Xc(I,u,_%x/f,L)}else d===null?C=new g(a.count*u):C=new g(d,_,a.count*u),E=new Ve(C,u,L);if(a.sparse!==void 0){const R=ns.SCALAR,P=qt[a.sparse.indices.componentType],I=a.sparse.indices.byteOffset||0,T=a.sparse.values.byteOffset||0,V=new P(p[1],I,a.sparse.count*R),X=new g(p[2],T,a.sparse.count*u);d!==null&&(E=new Ve(E.array.slice(),E.itemSize,E.normalized));for(let B=0,z=V.length;B<z;B++){const nt=V[B];if(E.setX(nt,X[B*u]),u>=2&&E.setY(nt,X[B*u+1]),u>=3&&E.setZ(nt,X[B*u+2]),u>=4&&E.setW(nt,X[B*u+3]),u>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return E})}loadTexture(i){const r=this.json,o=this.options,a=r.textures[i].source,c=r.images[a];let p=this.textureLoader;if(c.uri){const d=o.manager.getHandler(c.uri);d!==null&&(p=d)}return this.loadTextureImage(i,a,p)}loadTextureImage(i,r,o){const a=this,c=this.json,p=c.textures[i],d=c.images[r],u=(d.uri||d.bufferView)+":"+p.sampler;if(this.textureCache[u])return this.textureCache[u];const g=this.loadImageSource(r,o).then(function(f){f.flipY=!1,f.name=p.name||d.name||"";const m=(c.samplers||{})[p.sampler]||{};return f.magFilter=hn[m.magFilter]||Hi,f.minFilter=hn[m.minFilter]||Bi,f.wrapS=un[m.wrapS]||tn,f.wrapT=un[m.wrapT]||tn,a.associations.set(f,{textures:i}),f}).catch(function(){return null});return this.textureCache[u]=g,g}loadImageSource(i,r){const o=this,a=this.json,c=this.options;if(this.sourceCache[i]!==void 0)return this.sourceCache[i].then(m=>m.clone());const p=a.images[i],d=self.URL||self.webkitURL;let u=p.uri||"",g=!1;if(p.bufferView!==void 0)u=o.getDependency("bufferView",p.bufferView).then(function(m){g=!0;const _=new Blob([m],{type:p.mimeType});return u=d.createObjectURL(_),u});else if(p.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+i+" is missing URI and bufferView");const f=Promise.resolve(u).then(function(m){return new Promise(function(_,x){let L=_;r.isImageBitmapLoader===!0&&(L=function(C){const E=new zi(C);E.needsUpdate=!0,_(E)}),r.load(Qs.resolveURL(m,c.path),L,void 0,x)})}).then(function(m){return g===!0&&d.revokeObjectURL(u),m.userData.mimeType=p.mimeType||Uo(p.uri),m}).catch(function(m){throw console.error("THREE.GLTFLoader: Couldn't load texture",u),m});return this.sourceCache[i]=f,f}assignTexture(i,r,o,a){const c=this;return this.getDependency("texture",o.index).then(function(p){if(!p)return null;if(o.texCoord!==void 0&&o.texCoord!=0&&!(r==="aoMap"&&o.texCoord==1)&&console.warn("THREE.GLTFLoader: Custom UV set "+o.texCoord+" for texture "+r+" not yet supported."),c.extensions[D.KHR_TEXTURE_TRANSFORM]){const d=o.extensions!==void 0?o.extensions[D.KHR_TEXTURE_TRANSFORM]:void 0;if(d){const u=c.associations.get(p);p=c.extensions[D.KHR_TEXTURE_TRANSFORM].extendTexture(p,d),c.associations.set(p,u)}}return a!==void 0&&(p.encoding=a),i[r]=p,p})}assignFinalMaterial(i){const r=i.geometry;let o=i.material;const a=r.attributes.tangent===void 0,c=r.attributes.color!==void 0,p=r.attributes.normal===void 0;if(i.isPoints){const d="PointsMaterial:"+o.uuid;let u=this.cache.get(d);u||(u=new Lc,en.prototype.copy.call(u,o),u.color.copy(o.color),u.map=o.map,u.sizeAttenuation=!1,this.cache.add(d,u)),o=u}else if(i.isLine){const d="LineBasicMaterial:"+o.uuid;let u=this.cache.get(d);u||(u=new Tc,en.prototype.copy.call(u,o),u.color.copy(o.color),this.cache.add(d,u)),o=u}if(a||c||p){let d="ClonedMaterial:"+o.uuid+":";a&&(d+="derivative-tangents:"),c&&(d+="vertex-colors:"),p&&(d+="flat-shading:");let u=this.cache.get(d);u||(u=o.clone(),c&&(u.vertexColors=!0),p&&(u.flatShading=!0),a&&(u.normalScale&&(u.normalScale.y*=-1),u.clearcoatNormalScale&&(u.clearcoatNormalScale.y*=-1)),this.cache.add(d,u),this.associations.set(u,this.associations.get(o))),o=u}o.aoMap&&r.attributes.uv2===void 0&&r.attributes.uv!==void 0&&r.setAttribute("uv2",r.attributes.uv),i.material=o}getMaterialType(){return Zs}loadMaterial(i){const r=this,o=this.json,a=this.extensions,c=o.materials[i];let p;const d={},u=c.extensions||{},g=[];if(u[D.KHR_MATERIALS_UNLIT]){const m=a[D.KHR_MATERIALS_UNLIT];p=m.getMaterialType(),g.push(m.extendParams(d,c,r))}else{const m=c.pbrMetallicRoughness||{};if(d.color=new zt(1,1,1),d.opacity=1,Array.isArray(m.baseColorFactor)){const _=m.baseColorFactor;d.color.fromArray(_),d.opacity=_[3]}m.baseColorTexture!==void 0&&g.push(r.assignTexture(d,"map",m.baseColorTexture,re)),d.metalness=m.metallicFactor!==void 0?m.metallicFactor:1,d.roughness=m.roughnessFactor!==void 0?m.roughnessFactor:1,m.metallicRoughnessTexture!==void 0&&(g.push(r.assignTexture(d,"metalnessMap",m.metallicRoughnessTexture)),g.push(r.assignTexture(d,"roughnessMap",m.metallicRoughnessTexture))),p=this._invokeOne(function(_){return _.getMaterialType&&_.getMaterialType(i)}),g.push(Promise.all(this._invokeAll(function(_){return _.extendMaterialParams&&_.extendMaterialParams(i,d)})))}c.doubleSided===!0&&(d.side=Ac);const f=c.alphaMode||os.OPAQUE;if(f===os.BLEND?(d.transparent=!0,d.depthWrite=!1):(d.transparent=!1,f===os.MASK&&(d.alphaTest=c.alphaCutoff!==void 0?c.alphaCutoff:.5)),c.normalTexture!==void 0&&p!==Me&&(g.push(r.assignTexture(d,"normalMap",c.normalTexture)),d.normalScale=new ut(1,1),c.normalTexture.scale!==void 0)){const m=c.normalTexture.scale;d.normalScale.set(m,m)}return c.occlusionTexture!==void 0&&p!==Me&&(g.push(r.assignTexture(d,"aoMap",c.occlusionTexture)),c.occlusionTexture.strength!==void 0&&(d.aoMapIntensity=c.occlusionTexture.strength)),c.emissiveFactor!==void 0&&p!==Me&&(d.emissive=new zt().fromArray(c.emissiveFactor)),c.emissiveTexture!==void 0&&p!==Me&&g.push(r.assignTexture(d,"emissiveMap",c.emissiveTexture,re)),Promise.all(g).then(function(){const m=new p(d);return c.name&&(m.name=c.name),kt(m,c),r.associations.set(m,{materials:i}),c.extensions&&ce(a,m,c),m})}createUniqueName(i){const r=Sc.sanitizeNodeName(i||"");let o=r;for(let a=1;this.nodeNamesUsed[o];++a)o=r+"_"+a;return this.nodeNamesUsed[o]=!0,o}loadGeometries(i){const r=this,o=this.extensions,a=this.primitiveCache;function c(d){return o[D.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(d,r).then(function(u){return vn(u,d,r)})}const p=[];for(let d=0,u=i.length;d<u;d++){const g=i[d],f=jo(g),m=a[f];if(m)p.push(m.promise);else{let _;g.extensions&&g.extensions[D.KHR_DRACO_MESH_COMPRESSION]?_=c(g):_=vn(new Ki,g,r),a[f]={primitive:g,promise:_},p.push(_)}}return Promise.all(p)}loadMesh(i){const r=this,o=this.json,a=this.extensions,c=o.meshes[i],p=c.primitives,d=[];for(let u=0,g=p.length;u<g;u++){const f=p[u].material===void 0?Oo(this.cache):this.getDependency("material",p[u].material);d.push(f)}return d.push(r.loadGeometries(p)),Promise.all(d).then(function(u){const g=u.slice(0,u.length-1),f=u[u.length-1],m=[];for(let x=0,L=f.length;x<L;x++){const C=f[x],E=p[x];let R;const P=g[x];if(E.mode===ct.TRIANGLES||E.mode===ct.TRIANGLE_STRIP||E.mode===ct.TRIANGLE_FAN||E.mode===void 0)R=c.isSkinnedMesh===!0?new Rc(C,P):new Oi(C,P),R.isSkinnedMesh===!0&&!R.geometry.attributes.skinWeight.normalized&&R.normalizeSkinWeights(),E.mode===ct.TRIANGLE_STRIP?R.geometry=ln(R.geometry,Di):E.mode===ct.TRIANGLE_FAN&&(R.geometry=ln(R.geometry,Js));else if(E.mode===ct.LINES)R=new Mc(C,P);else if(E.mode===ct.LINE_STRIP)R=new Vc(C,P);else if(E.mode===ct.LINE_LOOP)R=new Ic(C,P);else if(E.mode===ct.POINTS)R=new Oc(C,P);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+E.mode);Object.keys(R.geometry.morphAttributes).length>0&&No(R,c),R.name=r.createUniqueName(c.name||"mesh_"+i),kt(R,c),E.extensions&&ce(a,R,E),r.assignFinalMaterial(R),m.push(R)}for(let x=0,L=m.length;x<L;x++)r.associations.set(m[x],{meshes:i,primitives:x});if(m.length===1)return m[0];const _=new sn;r.associations.set(_,{meshes:i});for(let x=0,L=m.length;x<L;x++)_.add(m[x]);return _})}loadCamera(i){let r;const o=this.json.cameras[i],a=o[o.type];if(!a){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return o.type==="perspective"?r=new Vi(Dc.radToDeg(a.yfov),a.aspectRatio||1,a.znear||1,a.zfar||2e6):o.type==="orthographic"&&(r=new Nc(-a.xmag,a.xmag,a.ymag,-a.ymag,a.znear,a.zfar)),o.name&&(r.name=this.createUniqueName(o.name)),kt(r,o),Promise.resolve(r)}loadSkin(i){const r=this.json.skins[i],o=[];for(let a=0,c=r.joints.length;a<c;a++)o.push(this.getDependency("node",r.joints[a]));return r.inverseBindMatrices!==void 0?o.push(this.getDependency("accessor",r.inverseBindMatrices)):o.push(null),Promise.all(o).then(function(a){const c=a.pop(),p=a,d=[],u=[];for(let g=0,f=p.length;g<f;g++){const m=p[g];if(m){d.push(m);const _=new ae;c!==null&&_.fromArray(c.array,g*16),u.push(_)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',r.joints[g])}return new jc(d,u)})}loadAnimation(i){const r=this.json.animations[i],o=[],a=[],c=[],p=[],d=[];for(let u=0,g=r.channels.length;u<g;u++){const f=r.channels[u],m=r.samplers[f.sampler],_=f.target,x=_.node,L=r.parameters!==void 0?r.parameters[m.input]:m.input,C=r.parameters!==void 0?r.parameters[m.output]:m.output;o.push(this.getDependency("node",x)),a.push(this.getDependency("accessor",L)),c.push(this.getDependency("accessor",C)),p.push(m),d.push(_)}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(c),Promise.all(p),Promise.all(d)]).then(function(u){const g=u[0],f=u[1],m=u[2],_=u[3],x=u[4],L=[];for(let E=0,R=g.length;E<R;E++){const P=g[E],I=f[E],T=m[E],V=_[E],X=x[E];if(P===void 0)continue;P.updateMatrix();let B;switch(Pt[X.path]){case Pt.weights:B=Zc;break;case Pt.rotation:B=Gi;break;case Pt.position:case Pt.scale:default:B=Wc;break}const z=P.name?P.name:P.uuid,nt=V.interpolation!==void 0?Io[V.interpolation]:Fi,Q=[];Pt[X.path]===Pt.weights?P.traverse(function(W){W.morphTargetInfluences&&Q.push(W.name?W.name:W.uuid)}):Q.push(z);let rt=T.array;if(T.normalized){const W=rs(rt.constructor),at=new Float32Array(rt.length);for(let tt=0,Lt=rt.length;tt<Lt;tt++)at[tt]=rt[tt]*W;rt=at}for(let W=0,at=Q.length;W<at;W++){const tt=new B(Q[W]+"."+Pt[X.path],I.array,rt,nt);V.interpolation==="CUBICSPLINE"&&(tt.createInterpolant=function(Lt){const $t=this instanceof Gi?Vo:dn;return new $t(this.times,this.values,this.getValueSize()/3,Lt)},tt.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),L.push(tt)}}const C=r.name?r.name:"animation_"+i;return new Uc(C,void 0,L)})}createNodeMesh(i){const r=this.json,o=this,a=r.nodes[i];return a.mesh===void 0?null:o.getDependency("mesh",a.mesh).then(function(c){const p=o._getNodeRef(o.meshCache,a.mesh,c);return a.weights!==void 0&&p.traverse(function(d){if(d.isMesh)for(let u=0,g=a.weights.length;u<g;u++)d.morphTargetInfluences[u]=a.weights[u]}),p})}loadNode(i){const r=this.json,o=this.extensions,a=this,c=r.nodes[i],p=c.name?a.createUniqueName(c.name):"";return function(){const d=[],u=a._invokeOne(function(_){return _.createNodeMesh&&_.createNodeMesh(i)});u&&d.push(u),c.camera!==void 0&&d.push(a.getDependency("camera",c.camera).then(function(_){return a._getNodeRef(a.cameraCache,c.camera,_)})),a._invokeAll(function(_){return _.createNodeAttachment&&_.createNodeAttachment(i)}).forEach(function(_){d.push(_)});const g=[],f=c.children||[];for(let _=0,x=f.length;_<x;_++)g.push(a.getDependency("node",f[_]));const m=c.skin===void 0?Promise.resolve(null):a.getDependency("skin",c.skin);return Promise.all([Promise.all(d),Promise.all(g),m])}().then(function(d){const u=d[0],g=d[1],f=d[2];let m;if(c.isBone===!0?m=new Hc:u.length>1?m=new sn:u.length===1?m=u[0]:m=new ji,m!==u[0])for(let _=0,x=u.length;_<x;_++)m.add(u[_]);if(c.name&&(m.userData.name=c.name,m.name=p),kt(m,c),c.extensions&&ce(o,m,c),c.matrix!==void 0){const _=new ae;_.fromArray(c.matrix),m.applyMatrix4(_)}else c.translation!==void 0&&m.position.fromArray(c.translation),c.rotation!==void 0&&m.quaternion.fromArray(c.rotation),c.scale!==void 0&&m.scale.fromArray(c.scale);a.associations.has(m)||a.associations.set(m,{}),a.associations.get(m).nodes=i,f!==null&&m.traverse(function(_){_.isSkinnedMesh&&_.bind(f,Ho)});for(let _=0,x=g.length;_<x;_++)m.add(g[_]);return m})}loadScene(i){const r=this.extensions,o=this.json.scenes[i],a=this,c=new sn;o.name&&(c.name=a.createUniqueName(o.name)),kt(c,o),o.extensions&&ce(r,c,o);const p=o.nodes||[],d=[];for(let u=0,g=p.length;u<g;u++)d.push(a.getDependency("node",p[u]));return Promise.all(d).then(function(u){for(let f=0,m=u.length;f<m;f++)c.add(u[f]);const g=f=>{const m=new Map;for(const[_,x]of a.associations)(_ instanceof en||_ instanceof zi)&&m.set(_,x);return f.traverse(_=>{const x=a.associations.get(_);x!=null&&m.set(_,x)}),m};return a.associations=g(c),c})}}function Ko(w,i,r){const o=i.attributes,a=new Jc;if(o.POSITION!==void 0){const d=r.json.accessors[o.POSITION],u=d.min,g=d.max;if(u!==void 0&&g!==void 0){if(a.set(new j(u[0],u[1],u[2]),new j(g[0],g[1],g[2])),d.normalized){const f=rs(qt[d.componentType]);a.min.multiplyScalar(f),a.max.multiplyScalar(f)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const c=i.targets;if(c!==void 0){const d=new j,u=new j;for(let g=0,f=c.length;g<f;g++){const m=c[g];if(m.POSITION!==void 0){const _=r.json.accessors[m.POSITION],x=_.min,L=_.max;if(x!==void 0&&L!==void 0){if(u.setX(Math.max(Math.abs(x[0]),Math.abs(L[0]))),u.setY(Math.max(Math.abs(x[1]),Math.abs(L[1]))),u.setZ(Math.max(Math.abs(x[2]),Math.abs(L[2]))),_.normalized){const C=rs(qt[_.componentType]);u.multiplyScalar(C)}d.max(u)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}a.expandByVector(d)}w.boundingBox=a;const p=new Qc;a.getCenter(p.center),p.radius=a.min.distanceTo(a.max)/2,w.boundingSphere=p}function vn(w,i,r){const o=i.attributes,a=[];function c(p,d){return r.getDependency("accessor",p).then(function(u){w.setAttribute(d,u)})}for(const p in o){const d=is[p]||p.toLowerCase();d in w.attributes||a.push(c(o[p],d))}if(i.indices!==void 0&&!w.index){const p=r.getDependency("accessor",i.indices).then(function(d){w.setIndex(d)});a.push(p)}return kt(w,i),Ko(w,i,r),Promise.all(a).then(function(){return i.targets!==void 0?Do(w,i.targets,r):w})}const as=new WeakMap;class Fo extends Ni{constructor(i){super(i),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(i){return this.decoderPath=i,this}setDecoderConfig(i){return this.decoderConfig=i,this}setWorkerLimit(i){return this.workerLimit=i,this}load(i,r,o,a){const c=new Je(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(i,p=>{this.decodeDracoFile(p,r).catch(a)},o,a)}decodeDracoFile(i,r,o,a){const c={attributeIDs:o||this.defaultAttributeIDs,attributeTypes:a||this.defaultAttributeTypes,useUniqueIDs:!!o};return this.decodeGeometry(i,c).then(r)}decodeGeometry(i,r){const o=JSON.stringify(r);if(as.has(i)){const u=as.get(i);if(u.key===o)return u.promise;if(i.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let a;const c=this.workerNextTaskID++,p=i.byteLength,d=this._getWorker(c,p).then(u=>(a=u,new Promise((g,f)=>{a._callbacks[c]={resolve:g,reject:f},a.postMessage({type:"decode",id:c,taskConfig:r,buffer:i},[i])}))).then(u=>this._createGeometry(u.geometry));return d.catch(()=>!0).then(()=>{a&&c&&this._releaseTask(a,c)}),as.set(i,{key:o,promise:d}),d}_createGeometry(i){const r=new Ki;i.index&&r.setIndex(new Ve(i.index.array,1));for(let o=0;o<i.attributes.length;o++){const a=i.attributes[o],c=a.name,p=a.array,d=a.itemSize;r.setAttribute(c,new Ve(p,d))}return r}_loadLibrary(i,r){const o=new Je(this.manager);return o.setPath(this.decoderPath),o.setResponseType(r),o.setWithCredentials(this.withCredentials),new Promise((a,c)=>{o.load(i,a,void 0,c)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const i=typeof WebAssembly!="object"||this.decoderConfig.type==="js",r=[];return i?r.push(this._loadLibrary("draco_decoder.js","text")):(r.push(this._loadLibrary("draco_wasm_wrapper.js","text")),r.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(r).then(o=>{const a=o[0];i||(this.decoderConfig.wasmBinary=o[1]);const c=zo.toString(),p=["/* draco decoder */",a,"","/* worker */",c.substring(c.indexOf("{")+1,c.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([p]))}),this.decoderPending}_getWorker(i,r){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const a=new Worker(this.workerSourceURL);a._callbacks={},a._taskCosts={},a._taskLoad=0,a.postMessage({type:"init",decoderConfig:this.decoderConfig}),a.onmessage=function(c){const p=c.data;switch(p.type){case"decode":a._callbacks[p.id].resolve(p);break;case"error":a._callbacks[p.id].reject(p);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+p.type+'"')}},this.workerPool.push(a)}else this.workerPool.sort(function(a,c){return a._taskLoad>c._taskLoad?-1:1});const o=this.workerPool[this.workerPool.length-1];return o._taskCosts[i]=r,o._taskLoad+=r,o})}_releaseTask(i,r){i._taskLoad-=i._taskCosts[r],delete i._callbacks[r],delete i._taskCosts[r]}debug(){console.log("Task load: ",this.workerPool.map(i=>i._taskLoad))}dispose(){for(let i=0;i<this.workerPool.length;++i)this.workerPool[i].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}function zo(){let w,i;onmessage=function(p){const d=p.data;switch(d.type){case"init":w=d.decoderConfig,i=new Promise(function(f){w.onModuleLoaded=function(m){f({draco:m})},DracoDecoderModule(w)});break;case"decode":const u=d.buffer,g=d.taskConfig;i.then(f=>{const m=f.draco,_=new m.Decoder,x=new m.DecoderBuffer;x.Init(new Int8Array(u),u.byteLength);try{const L=r(m,_,x,g),C=L.attributes.map(E=>E.array.buffer);L.index&&C.push(L.index.array.buffer),self.postMessage({type:"decode",id:d.id,geometry:L},C)}catch(L){console.error(L),self.postMessage({type:"error",id:d.id,error:L.message})}finally{m.destroy(x),m.destroy(_)}});break}};function r(p,d,u,g){const f=g.attributeIDs,m=g.attributeTypes;let _,x;const L=d.GetEncodedGeometryType(u);if(L===p.TRIANGULAR_MESH)_=new p.Mesh,x=d.DecodeBufferToMesh(u,_);else if(L===p.POINT_CLOUD)_=new p.PointCloud,x=d.DecodeBufferToPointCloud(u,_);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!x.ok()||_.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+x.error_msg());const C={index:null,attributes:[]};for(const E in f){const R=self[m[E]];let P,I;if(g.useUniqueIDs)I=f[E],P=d.GetAttributeByUniqueId(_,I);else{if(I=d.GetAttributeId(_,p[f[E]]),I===-1)continue;P=d.GetAttribute(_,I)}C.attributes.push(a(p,d,_,E,R,P))}return L===p.TRIANGULAR_MESH&&(C.index=o(p,d,_)),p.destroy(_),C}function o(p,d,u){const g=u.num_faces()*3,f=g*4,m=p._malloc(f);d.GetTrianglesUInt32Array(u,f,m);const _=new Uint32Array(p.HEAPF32.buffer,m,g).slice();return p._free(m),{array:_,itemSize:1}}function a(p,d,u,g,f,m){const _=m.num_components(),x=u.num_points()*_,L=x*f.BYTES_PER_ELEMENT,C=c(p,f),E=p._malloc(L);d.GetAttributeDataArrayForAllPoints(u,m,C,L,E);const R=new f(p.HEAPF32.buffer,E,x).slice();return p._free(E),{name:g,array:R,itemSize:_}}function c(p,d){switch(d){case Float32Array:return p.DT_FLOAT32;case Int8Array:return p.DT_INT8;case Int16Array:return p.DT_INT16;case Int32Array:return p.DT_INT32;case Uint8Array:return p.DT_UINT8;case Uint16Array:return p.DT_UINT16;case Uint32Array:return p.DT_UINT32}}}class Go{constructor(){this.assetStore=Oe.getState(),this.assetsToLoad=this.assetStore.assetsToLoad,this.addLoadedAsset=this.assetStore.addLoadedAsset,this.loadingProgress={},this.instantiateLoaders(),this.startLoading()}instantiateLoaders(){const i=new Fo,r="/folio_3js/draco/";i.setDecoderPath(r),this.gltfLoader=new ho,this.gltfLoader.setDRACOLoader(i),this.textureLoader=new Ui}updateLoadingProgress(i,r){this.loadingProgress[i]=r,Object.values(this.loadingProgress).reduce((o,a)=>o+a,0)/this.assetsToLoad.length}getAssetPath(i){return`/folio_3js${i}`}startLoading(){this.assetsToLoad.forEach(i=>{const r=this.getAssetPath(i.path),o=c=>{console.error(`Error loading asset ${i.id}:`,c),this.assetStore.setLoadingError&&this.assetStore.setLoadingError(i.id,c)},a=c=>{if(c.lengthComputable){const p=c.loaded/c.total*100;this.updateLoadingProgress(i.id,p)}};i.type==="texture"&&this.textureLoader.load(r,c=>{this.addLoadedAsset(c,i.id),this.updateLoadingProgress(i.id,100)},a,o),i.type==="model"&&this.gltfLoader.load(r,c=>{this.addLoadedAsset(c,i.id),this.updateLoadingProgress(i.id,100)},a,o)})}areAllAssetsLoaded(){return Object.keys(this.assetStore.loadedAssets).length===this.assetsToLoad.length}getLoadingStatus(){return{totalAssets:this.assetsToLoad.length,loadedAssets:Object.keys(this.assetStore.loadedAssets).length,progress:this.loadingProgress,isComplete:this.areAllAssetsLoaded()}}}class qo{constructor(){this.assetStore=Oe,this.overlay=document.querySelector(".overlay"),this.loading=document.querySelector(".loading"),this.startButton=document.querySelector(".start"),this.assetStore.subscribe(i=>{this.numberOfLoadedAssets=Object.keys(i.loadedAssets).length,this.numberOfAssetsToLoad=i.assetsToLoad.length,this.progress=this.numberOfLoadedAssets/this.numberOfAssetsToLoad,this.progress=Math.trunc(this.progress*100),document.getElementById("progressPercentage").innerHTML=this.progress,this.progress===100&&(es.setState({assetsReady:!0}),this.loading.classList.add("fade"),window.setTimeout(()=>this.ready(),1200))})}ready(){this.loading.remove(),this.startButton.style.display="inline",this.startButton.classList.add("fadeIn"),this.startButton.addEventListener("click",()=>{this.overlay.classList.add("fade"),this.startButton.classList.add("fadeOut"),document.querySelector(".permanent-controls").classList.add("show"),window.setTimeout(()=>{this.overlay.remove(),this.startButton.remove()},2e3)},{once:!0})}}class $o{constructor(){this.inputStore=F,this.keyPressed={},this.touchActive=!1,this.startListening(),this.setupTouchControls()}startListening(){window.addEventListener("keydown",i=>this.onKeyDown(i)),window.addEventListener("keyup",i=>this.onKeyUp(i))}setupTouchControls(){const i=document.querySelector(".dpad"),r={x:75,y:75},o=20,a=c=>{c.preventDefault();const p=c.touches[0];if(!p)return;const d=i.getBoundingClientRect(),u=p.clientX-d.left-r.x,g=p.clientY-d.top-r.y;if(Math.sqrt(u*u+g*g)<o){this.resetDirections();return}const f=Math.atan2(g,u)*(180/Math.PI);this.resetDirections();const m={up:document.querySelector(".up-arrow"),right:document.querySelector(".right-arrow"),down:document.querySelector(".down-arrow"),left:document.querySelector(".left-arrow")};f>-112.5&&f<=-67.5?(F.setState({forward:!0}),m.up.classList.add("active")):f>-67.5&&f<=-22.5?(F.setState({forward:!0,right:!0}),m.up.classList.add("active"),m.right.classList.add("active")):f>-22.5&&f<=22.5?(F.setState({right:!0}),m.right.classList.add("active")):f>22.5&&f<=67.5?(F.setState({backward:!0,right:!0}),m.down.classList.add("active"),m.right.classList.add("active")):f>67.5&&f<=112.5?(F.setState({backward:!0}),m.down.classList.add("active")):f>112.5&&f<=157.5?(F.setState({backward:!0,left:!0}),m.down.classList.add("active"),m.left.classList.add("active")):f>157.5&&f<=180||f<=-157.5&&f>=-180?(F.setState({left:!0}),m.left.classList.add("active")):f>-157.5&&f<=-112.5&&(F.setState({forward:!0,left:!0}),m.up.classList.add("active"),m.left.classList.add("active"))};i.addEventListener("touchstart",a),i.addEventListener("touchmove",a),i.addEventListener("touchend",()=>{this.resetDirections(),document.querySelectorAll(".dpad-arrow").forEach(c=>{c.classList.remove("active")})})}resetDirections(){F.setState({forward:!1,backward:!1,left:!1,right:!1})}onKeyDown(i){if(!this.keyPressed[i.code]){switch(i.code){case"KeyW":case"ArrowUp":F.setState({forward:!0});break;case"KeyA":case"ArrowLeft":F.setState({left:!0});break;case"KeyS":case"ArrowDown":F.setState({backward:!0});break;case"KeyD":case"ArrowRight":F.setState({right:!0});break}this.keyPressed[i.code]=!0}}onKeyUp(i){switch(i.code){case"KeyW":case"ArrowUp":F.setState({forward:!1});break;case"KeyA":case"ArrowLeft":F.setState({left:!1});break;case"KeyS":case"ArrowDown":F.setState({backward:!1});break;case"KeyD":case"ArrowRight":F.setState({right:!1});break}this.keyPressed[i.code]=!1}}class Yo{constructor(){this.modal=document.getElementById("myModal"),this.modalWrapper=document.querySelector(".modal-wrapper"),this.close=document.querySelector(".close"),this.title=document.getElementById("modalTitle"),this.description=document.getElementById("modalDescription"),this.isOpen=!1,this.close.onclick=()=>this.closeModal(),this.modal.onclick=i=>{i.target===this.modal&&this.closeModal()},document.addEventListener("keydown",i=>{i.key==="Escape"&&this.isOpen&&this.closeModal()}),this.cooldown=!1}openModal(i,r){this.cooldown||(this.title.innerHTML=i,this.description.innerHTML=r,this.modal.style.display="block",this.modal.offsetHeight,this.modal.classList.remove("fadeOut"),this.modal.classList.add("fadeIn"),this.isOpen=!0,this.cooldown=!0,setTimeout(()=>{this.cooldown=!1},1e3))}closeModal(){this.isOpen&&(this.modal.classList.remove("fadeIn"),this.modal.classList.add("fadeOut"),setTimeout(()=>{this.modal.style.display="none",this.modal.classList.remove("fadeOut")},600),this.isOpen=!1)}}let ls=null;class mt{constructor(){if(ls)return ls;ls=this,this.canvas=document.querySelector("canvas.threejs"),this.scene=new ep,this.gui=new Ji,this.assetLoader=new Go,this.preloader=new qo,this.inputController=new $o,this.modalManager=new Yo,this.world=new co,this.camera=new $i,this.renderer=new Yi,this.loop=new Xi,this.resize=new po}}new mt})();
