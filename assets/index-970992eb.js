import{E as dc,V as B,M as ne,T as oe,Q as Et,S as Mn,a as ht,P as Vn,W as hc,s as re,b as uc,A as mc,C as vc,c as ae,d as gc,D as In,B as bc,e as Zs,f as On,g as fc,h as _c,i as Qs,j as Dn,L as Nn,k as Js,F as Qe,l as zt,m as wc,n as yc,o as Me,p as Gt,I as xc,O as jn,q as Un,r as Cc,t as Ve,u as Ec,v as Hn,w as Bn,R as ti,x as Pc,y as ei,z as kc,G as Tc,H as Ac,J as Kn,K as Lc,N as Sc,U as Rc,X as Mc,Y as Vc,Z as si,_ as Ic,$ as Oc,a0 as Dc,a1 as Fn,a2 as Nc,a3 as jc,a4 as Uc,a5 as Hc,a6 as Bc,a7 as Kc,a8 as Fc,a9 as zc,aa as Gc,ab as qc,ac as $c,ad as zn,ae as Yc,af as Gn,ag as Xc,ah as Wc,ai as Zc,aj as Qc,ak as Jc}from"./three-b24eb87d.js";(async()=>{(function(){const _=document.createElement("link").relList;if(_&&_.supports&&_.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function n(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(o){if(o.ep)return;o.ep=!0;const a=n(o);fetch(o.href,a)}})();const ii={type:"change"},Je={type:"start"},ni={type:"end"};class qn extends dc{constructor(n,r){super(),this.object=n,this.domElement=r,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new B,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:ne.ROTATE,MIDDLE:ne.DOLLY,RIGHT:ne.PAN},this.touches={ONE:oe.ROTATE,TWO:oe.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return d.phi},this.getAzimuthalAngle=function(){return d.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(g){g.addEventListener("keydown",He),this._domElementKeyEvents=g},this.saveState=function(){o.target0.copy(o.target),o.position0.copy(o.object.position),o.zoom0=o.object.zoom},this.reset=function(){o.target.copy(o.target0),o.object.position.copy(o.position0),o.object.zoom=o.zoom0,o.object.updateProjectionMatrix(),o.dispatchEvent(ii),o.update(),c=a.NONE},this.update=function(){const g=new B,k=new Et().setFromUnitVectors(n.up,new B(0,1,0)),z=k.clone().invert(),W=new B,at=new Et,gt=2*Math.PI;return function(){const _t=o.object.position;g.copy(_t).sub(o.target),g.applyQuaternion(k),d.setFromVector3(g),o.autoRotate&&c===a.NONE&&st(H()),o.enableDamping?(d.theta+=u.theta*o.dampingFactor,d.phi+=u.phi*o.dampingFactor):(d.theta+=u.theta,d.phi+=u.phi);let tt=o.minAzimuthAngle,et=o.maxAzimuthAngle;return isFinite(tt)&&isFinite(et)&&(tt<-Math.PI?tt+=gt:tt>Math.PI&&(tt-=gt),et<-Math.PI?et+=gt:et>Math.PI&&(et-=gt),tt<=et?d.theta=Math.max(tt,Math.min(et,d.theta)):d.theta=d.theta>(tt+et)/2?Math.max(tt,d.theta):Math.min(et,d.theta)),d.phi=Math.max(o.minPolarAngle,Math.min(o.maxPolarAngle,d.phi)),d.makeSafe(),d.radius*=b,d.radius=Math.max(o.minDistance,Math.min(o.maxDistance,d.radius)),o.enableDamping===!0?o.target.addScaledVector(w,o.dampingFactor):o.target.add(w),g.setFromSpherical(d),g.applyQuaternion(z),_t.copy(o.target).add(g),o.object.lookAt(o.target),o.enableDamping===!0?(u.theta*=1-o.dampingFactor,u.phi*=1-o.dampingFactor,w.multiplyScalar(1-o.dampingFactor)):(u.set(0,0,0),w.set(0,0,0)),b=1,m||W.distanceToSquared(o.object.position)>p||8*(1-at.dot(o.object.quaternion))>p?(o.dispatchEvent(ii),W.copy(o.object.position),at.copy(o.object.quaternion),m=!1,!0):!1}}(),this.dispose=function(){o.domElement.removeEventListener("contextmenu",Dt),o.domElement.removeEventListener("pointerdown",he),o.domElement.removeEventListener("pointercancel",Ot),o.domElement.removeEventListener("wheel",Ue),o.domElement.removeEventListener("pointermove",ft),o.domElement.removeEventListener("pointerup",it),o._domElementKeyEvents!==null&&o._domElementKeyEvents.removeEventListener("keydown",He)};const o=this,a={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let c=a.NONE;const p=1e-6,d=new Mn,u=new Mn;let b=1;const w=new B;let m=!1;const f=new ht,x=new ht,T=new ht,C=new ht,E=new ht,R=new ht,P=new ht,I=new ht,A=new ht,V=[],Y={};function H(){return 2*Math.PI/60/60*o.autoRotateSpeed}function F(){return Math.pow(.95,o.zoomSpeed)}function st(g){u.theta-=g}function Q(g){u.phi-=g}const ot=function(){const g=new B;return function(k,z){g.setFromMatrixColumn(z,0),g.multiplyScalar(-k),w.add(g)}}(),X=function(){const g=new B;return function(k,z){o.screenSpacePanning===!0?g.setFromMatrixColumn(z,1):(g.setFromMatrixColumn(z,0),g.crossVectors(o.object.up,g)),g.multiplyScalar(k),w.add(g)}}(),rt=function(){const g=new B;return function(k,z){const W=o.domElement;if(o.object.isPerspectiveCamera){const at=o.object.position;g.copy(at).sub(o.target);let gt=g.length();gt*=Math.tan(o.object.fov/2*Math.PI/180),ot(2*k*gt/W.clientHeight,o.object.matrix),X(2*z*gt/W.clientHeight,o.object.matrix)}else o.object.isOrthographicCamera?(ot(k*(o.object.right-o.object.left)/o.object.zoom/W.clientWidth,o.object.matrix),X(z*(o.object.top-o.object.bottom)/o.object.zoom/W.clientHeight,o.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),o.enablePan=!1)}}();function J(g){o.object.isPerspectiveCamera?b/=g:o.object.isOrthographicCamera?(o.object.zoom=Math.max(o.minZoom,Math.min(o.maxZoom,o.object.zoom*g)),o.object.updateProjectionMatrix(),m=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),o.enableZoom=!1)}function Tt(g){o.object.isPerspectiveCamera?b*=g:o.object.isOrthographicCamera?(o.object.zoom=Math.max(o.minZoom,Math.min(o.maxZoom,o.object.zoom/g)),o.object.updateProjectionMatrix(),m=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),o.enableZoom=!1)}function $t(g){f.set(g.clientX,g.clientY)}function q(g){P.set(g.clientX,g.clientY)}function M(g){C.set(g.clientX,g.clientY)}function cs(g){x.set(g.clientX,g.clientY),T.subVectors(x,f).multiplyScalar(o.rotateSpeed);const k=o.domElement;st(2*Math.PI*T.x/k.clientHeight),Q(2*Math.PI*T.y/k.clientHeight),f.copy(x),o.update()}function ps(g){I.set(g.clientX,g.clientY),A.subVectors(I,P),A.y>0?J(F()):A.y<0&&Tt(F()),P.copy(I),o.update()}function ds(g){E.set(g.clientX,g.clientY),R.subVectors(E,C).multiplyScalar(o.panSpeed),rt(R.x,R.y),C.copy(E),o.update()}function mt(g){g.deltaY<0?Tt(F()):g.deltaY>0&&J(F()),o.update()}function De(g){let k=!1;switch(g.code){case o.keys.UP:g.ctrlKey||g.metaKey||g.shiftKey?Q(2*Math.PI*o.rotateSpeed/o.domElement.clientHeight):rt(0,o.keyPanSpeed),k=!0;break;case o.keys.BOTTOM:g.ctrlKey||g.metaKey||g.shiftKey?Q(-2*Math.PI*o.rotateSpeed/o.domElement.clientHeight):rt(0,-o.keyPanSpeed),k=!0;break;case o.keys.LEFT:g.ctrlKey||g.metaKey||g.shiftKey?st(2*Math.PI*o.rotateSpeed/o.domElement.clientHeight):rt(o.keyPanSpeed,0),k=!0;break;case o.keys.RIGHT:g.ctrlKey||g.metaKey||g.shiftKey?st(-2*Math.PI*o.rotateSpeed/o.domElement.clientHeight):rt(-o.keyPanSpeed,0),k=!0;break}k&&(g.preventDefault(),o.update())}function U(){if(V.length===1)f.set(V[0].pageX,V[0].pageY);else{const g=.5*(V[0].pageX+V[1].pageX),k=.5*(V[0].pageY+V[1].pageY);f.set(g,k)}}function G(){if(V.length===1)C.set(V[0].pageX,V[0].pageY);else{const g=.5*(V[0].pageX+V[1].pageX),k=.5*(V[0].pageY+V[1].pageY);C.set(g,k)}}function Yt(){const g=V[0].pageX-V[1].pageX,k=V[0].pageY-V[1].pageY,z=Math.sqrt(g*g+k*k);P.set(0,z)}function hs(){o.enableZoom&&Yt(),o.enablePan&&G()}function pe(){o.enableZoom&&Yt(),o.enableRotate&&U()}function Ne(g){if(V.length==1)x.set(g.pageX,g.pageY);else{const z=ge(g),W=.5*(g.pageX+z.x),at=.5*(g.pageY+z.y);x.set(W,at)}T.subVectors(x,f).multiplyScalar(o.rotateSpeed);const k=o.domElement;st(2*Math.PI*T.x/k.clientHeight),Q(2*Math.PI*T.y/k.clientHeight),f.copy(x)}function de(g){if(V.length===1)E.set(g.pageX,g.pageY);else{const k=ge(g),z=.5*(g.pageX+k.x),W=.5*(g.pageY+k.y);E.set(z,W)}R.subVectors(E,C).multiplyScalar(o.panSpeed),rt(R.x,R.y),C.copy(E)}function ct(g){const k=ge(g),z=g.pageX-k.x,W=g.pageY-k.y,at=Math.sqrt(z*z+W*W);I.set(0,at),A.set(0,Math.pow(I.y/P.y,o.zoomSpeed)),J(A.y),P.copy(I)}function us(g){o.enableZoom&&ct(g),o.enablePan&&de(g)}function je(g){o.enableZoom&&ct(g),o.enableRotate&&Ne(g)}function he(g){o.enabled!==!1&&(V.length===0&&(o.domElement.setPointerCapture(g.pointerId),o.domElement.addEventListener("pointermove",ft),o.domElement.addEventListener("pointerup",it)),Be(g),g.pointerType==="touch"?vs(g):ms(g))}function ft(g){o.enabled!==!1&&(g.pointerType==="touch"?gs(g):ue(g))}function it(g){me(g),V.length===0&&(o.domElement.releasePointerCapture(g.pointerId),o.domElement.removeEventListener("pointermove",ft),o.domElement.removeEventListener("pointerup",it)),o.dispatchEvent(ni),c=a.NONE}function Ot(g){me(g)}function ms(g){let k;switch(g.button){case 0:k=o.mouseButtons.LEFT;break;case 1:k=o.mouseButtons.MIDDLE;break;case 2:k=o.mouseButtons.RIGHT;break;default:k=-1}switch(k){case ne.DOLLY:if(o.enableZoom===!1)return;q(g),c=a.DOLLY;break;case ne.ROTATE:if(g.ctrlKey||g.metaKey||g.shiftKey){if(o.enablePan===!1)return;M(g),c=a.PAN}else{if(o.enableRotate===!1)return;$t(g),c=a.ROTATE}break;case ne.PAN:if(g.ctrlKey||g.metaKey||g.shiftKey){if(o.enableRotate===!1)return;$t(g),c=a.ROTATE}else{if(o.enablePan===!1)return;M(g),c=a.PAN}break;default:c=a.NONE}c!==a.NONE&&o.dispatchEvent(Je)}function ue(g){switch(c){case a.ROTATE:if(o.enableRotate===!1)return;cs(g);break;case a.DOLLY:if(o.enableZoom===!1)return;ps(g);break;case a.PAN:if(o.enablePan===!1)return;ds(g);break}}function Ue(g){o.enabled===!1||o.enableZoom===!1||c!==a.NONE||(g.preventDefault(),o.dispatchEvent(Je),mt(g),o.dispatchEvent(ni))}function He(g){o.enabled===!1||o.enablePan===!1||De(g)}function vs(g){switch(ve(g),V.length){case 1:switch(o.touches.ONE){case oe.ROTATE:if(o.enableRotate===!1)return;U(),c=a.TOUCH_ROTATE;break;case oe.PAN:if(o.enablePan===!1)return;G(),c=a.TOUCH_PAN;break;default:c=a.NONE}break;case 2:switch(o.touches.TWO){case oe.DOLLY_PAN:if(o.enableZoom===!1&&o.enablePan===!1)return;hs(),c=a.TOUCH_DOLLY_PAN;break;case oe.DOLLY_ROTATE:if(o.enableZoom===!1&&o.enableRotate===!1)return;pe(),c=a.TOUCH_DOLLY_ROTATE;break;default:c=a.NONE}break;default:c=a.NONE}c!==a.NONE&&o.dispatchEvent(Je)}function gs(g){switch(ve(g),c){case a.TOUCH_ROTATE:if(o.enableRotate===!1)return;Ne(g),o.update();break;case a.TOUCH_PAN:if(o.enablePan===!1)return;de(g),o.update();break;case a.TOUCH_DOLLY_PAN:if(o.enableZoom===!1&&o.enablePan===!1)return;us(g),o.update();break;case a.TOUCH_DOLLY_ROTATE:if(o.enableZoom===!1&&o.enableRotate===!1)return;je(g),o.update();break;default:c=a.NONE}}function Dt(g){o.enabled!==!1&&g.preventDefault()}function Be(g){V.push(g)}function me(g){delete Y[g.pointerId];for(let k=0;k<V.length;k++)if(V[k].pointerId==g.pointerId){V.splice(k,1);return}}function ve(g){let k=Y[g.pointerId];k===void 0&&(k=new ht,Y[g.pointerId]=k),k.set(g.pageX,g.pageY)}function ge(g){const k=g.pointerId===V[0].pointerId?V[1]:V[0];return Y[k.pointerId]}o.domElement.addEventListener("contextmenu",Dt),o.domElement.addEventListener("pointerdown",he),o.domElement.addEventListener("pointercancel",Ot),o.domElement.addEventListener("wheel",Ue,{passive:!1}),this.update()}}const oi=_=>{let n;const r=new Set,o=(p,d)=>{const u=typeof p=="function"?p(n):p;if(!Object.is(u,n)){const b=n;n=d??(typeof u!="object"||u===null)?u:Object.assign({},n,u),r.forEach(w=>w(n,b))}},a=()=>n,c={setState:o,getState:a,subscribe:p=>(r.add(p),()=>r.delete(p)),destroy:()=>{r.clear()}};return n=_(o,a,c),c},Ie=_=>_?oi(_):oi,ts=Ie(()=>({width:window.innerWidth,height:window.innerHeight,pixelRatio:Math.min(window.devicePixelRatio,2)})),es=Ie(()=>({physicsReady:!1,assetsReady:!1})),ut=Ie(()=>({forward:!1,backward:!1,left:!1,right:!1}));class $n{constructor(){this.app=new vt,this.canvas=this.app.canvas,this.sizesStore=ts,this.sizes=this.sizesStore.getState(),this.setInstance(),this.setControls(),this.setResizeLister()}setInstance(){this.instance=new Vn(35,this.sizes.width/this.sizes.height,1,600),this.instance.position.z=100,this.instance.position.y=20}setControls(){this.controls=new qn(this.instance,this.canvas),this.controls.enableDamping=!0}setResizeLister(){this.sizesStore.subscribe(n=>{this.instance.aspect=n.width/n.height,this.instance.updateProjectionMatrix()})}loop(){var n;if(this.controls.update(),this.characterController=(n=this.app.world.characterController)==null?void 0:n.rigidBody,this.characterController){const r=this.characterController.translation(),o=this.characterController.rotation(),a=new B(0,28,35);a.applyQuaternion(o),a.add(r);const c=new B(0,8,0);c.applyQuaternion(o),c.add(r),this.instance.position.lerp(a,.1),this.controls.target.lerp(c,.1)}}}class Yn{constructor(){this.app=new vt,this.canvas=this.app.canvas,this.camera=this.app.camera,this.scene=this.app.scene,this.sizesStore=ts,this.sizes=this.sizesStore.getState(),this.setInstance(),this.setResizeLister()}setInstance(){this.instance=new hc({canvas:this.canvas,antialias:!0}),this.instance.setSize(this.sizes.width,this.sizes.height),this.instance.setPixelRatio(this.sizes.pixelRatio),this.instance.outputEncoding=re,this.instance.shadowMap.enabled=!0,this.instance.shadowMap.type=uc,this.instance.toneMapping=mc,this.instance.toneMappingExposure=.8}setResizeLister(){this.sizesStore.subscribe(n=>{this.instance.setSize(n.width,n.height),this.instance.setPixelRatio(n.pixelRatio)})}loop(){this.instance.render(this.scene,this.camera.instance)}}class Xn{constructor(){this.app=new vt,this.camera=this.app.camera,this.renderer=this.app.renderer,this.world=this.app.world,this.clock=new vc,this.previousElapsedTime=0,this.loop()}loop(){const n=this.clock.getElapsedTime(),r=n-this.previousElapsedTime;this.previousElapsedTime=n,this.world.loop(r,n),this.camera.loop(r),this.renderer.loop(),window.requestAnimationFrame(()=>this.loop())}}var Wn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},ss={exports:{}};(function(_,n){(function(r,o){o(n)})(Wn,function(r){class o{constructor(t){const[e,i]=t.split("-"),l=e.split(".");this.major=parseInt(l[0],10),this.minor=parseInt(l[1],10),this.patch=parseInt(l[2],10),this.prerelease=i??null}toString(){const t=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[t,this.prerelease].join("-"):t}}class a{constructor(t){this.controller_=t}get element(){return this.controller_.view.element}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(t){this.controller_.viewProps.set("disabled",t)}get hidden(){return this.controller_.viewProps.get("hidden")}set hidden(t){this.controller_.viewProps.set("hidden",t)}dispose(){this.controller_.viewProps.set("disposed",!0)}}class c{constructor(t){this.target=t}}class p extends c{constructor(t,e,i,l){super(t),this.value=e,this.presetKey=i,this.last=l??!0}}class d extends c{constructor(t,e,i){super(t),this.value=e,this.presetKey=i}}class u extends c{constructor(t,e){super(t),this.expanded=e}}class b extends c{constructor(t,e){super(t),this.index=e}}function w(s){return s}function m(s){return s==null}function f(s,t){if(s.length!==t.length)return!1;for(let e=0;e<s.length;e++)if(s[e]!==t[e])return!1;return!0}function x(s,t){let e=s;do{const i=Object.getOwnPropertyDescriptor(e,t);if(i&&(i.set!==void 0||i.writable===!0))return!0;e=Object.getPrototypeOf(e)}while(e!==null);return!1}const T={alreadydisposed:()=>"View has been already disposed",invalidparams:s=>`Invalid parameters for '${s.name}'`,nomatchingcontroller:s=>`No matching controller for '${s.key}'`,nomatchingview:s=>`No matching view for '${JSON.stringify(s.params)}'`,notbindable:()=>"Value is not bindable",propertynotfound:s=>`Property '${s.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class C{static alreadyDisposed(){return new C({type:"alreadydisposed"})}static notBindable(){return new C({type:"notbindable"})}static propertyNotFound(t){return new C({type:"propertynotfound",context:{name:t}})}static shouldNeverHappen(){return new C({type:"shouldneverhappen"})}constructor(t){var e;this.message=(e=T[t.type](t.context))!==null&&e!==void 0?e:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=t.type}}class E{constructor(t,e,i){this.obj_=t,this.key_=e,this.presetKey_=i??e}static isBindable(t){return!(t===null||typeof t!="object"&&typeof t!="function")}get key(){return this.key_}get presetKey(){return this.presetKey_}read(){return this.obj_[this.key_]}write(t){this.obj_[this.key_]=t}writeProperty(t,e){const i=this.read();if(!E.isBindable(i))throw C.notBindable();if(!(t in i))throw C.propertyNotFound(t);i[t]=e}}class R extends a{get label(){return this.controller_.props.get("label")}set label(t){this.controller_.props.set("label",t)}get title(){var t;return(t=this.controller_.valueController.props.get("title"))!==null&&t!==void 0?t:""}set title(t){this.controller_.valueController.props.set("title",t)}on(t,e){const i=e.bind(this);return this.controller_.valueController.emitter.on(t,()=>{i(new c(this))}),this}}class P{constructor(){this.observers_={}}on(t,e){let i=this.observers_[t];return i||(i=this.observers_[t]=[]),i.push({handler:e}),this}off(t,e){const i=this.observers_[t];return i&&(this.observers_[t]=i.filter(l=>l.handler!==e)),this}emit(t,e){const i=this.observers_[t];i&&i.forEach(l=>{l.handler(e)})}}const I="tp";function A(s){return(t,e)=>[I,"-",s,"v",t?`_${t}`:"",e?`-${e}`:""].join("")}function V(s,t){return e=>t(s(e))}function Y(s){return s.rawValue}function H(s,t){s.emitter.on("change",V(Y,t)),t(s.rawValue)}function F(s,t,e){H(s.value(t),e)}function st(s,t,e){e?s.classList.add(t):s.classList.remove(t)}function Q(s,t){return e=>{st(s,t,e)}}function ot(s,t){H(s,e=>{t.textContent=e??""})}const X=A("btn");class rt{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(X()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("button");i.classList.add(X("b")),e.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const l=t.createElement("div");l.classList.add(X("t")),ot(e.props.value("title"),l),this.buttonElement.appendChild(l)}}class J{constructor(t,e){this.emitter=new P,this.onClick_=this.onClick_.bind(this),this.props=e.props,this.viewProps=e.viewProps,this.view=new rt(t,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class Tt{constructor(t,e){var i;this.constraint_=e==null?void 0:e.constraint,this.equals_=(i=e==null?void 0:e.equals)!==null&&i!==void 0?i:(l,h)=>l===h,this.emitter=new P,this.rawValue_=t}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(t){this.setRawValue(t,{forceEmit:!1,last:!0})}setRawValue(t,e){const i=e??{forceEmit:!1,last:!0},l=this.constraint_?this.constraint_.constrain(t):t,h=this.rawValue_;this.equals_(h,l)&&!i.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=l,this.emitter.emit("change",{options:i,previousRawValue:h,rawValue:l,sender:this}))}}class $t{constructor(t){this.emitter=new P,this.value_=t}get rawValue(){return this.value_}set rawValue(t){this.setRawValue(t,{forceEmit:!1,last:!0})}setRawValue(t,e){const i=e??{forceEmit:!1,last:!0},l=this.value_;l===t&&!i.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.value_=t,this.emitter.emit("change",{options:i,previousRawValue:l,rawValue:this.value_,sender:this}))}}function q(s,t){const e=t==null?void 0:t.constraint,i=t==null?void 0:t.equals;return!e&&!i?new $t(s):new Tt(s,t)}class M{constructor(t){this.emitter=new P,this.valMap_=t;for(const e in this.valMap_)this.valMap_[e].emitter.on("change",()=>{this.emitter.emit("change",{key:e,sender:this})})}static createCore(t){return Object.keys(t).reduce((e,i)=>Object.assign(e,{[i]:q(t[i])}),{})}static fromObject(t){const e=this.createCore(t);return new M(e)}get(t){return this.valMap_[t].rawValue}set(t,e){this.valMap_[t].rawValue=e}value(t){return this.valMap_[t]}}function cs(s,t){return Object.keys(t).reduce((i,l)=>{if(i===void 0)return;const h=t[l],v=h(s[l]);return v.succeeded?Object.assign(Object.assign({},i),{[l]:v.value}):void 0},{})}function ps(s,t){return s.reduce((e,i)=>{if(e===void 0)return;const l=t(i);if(!(!l.succeeded||l.value===void 0))return[...e,l.value]},[])}function ds(s){return s===null?!1:typeof s=="object"}function mt(s){return t=>e=>{if(!t&&e===void 0)return{succeeded:!1,value:void 0};if(t&&e===void 0)return{succeeded:!0,value:void 0};const i=s(e);return i!==void 0?{succeeded:!0,value:i}:{succeeded:!1,value:void 0}}}function De(s){return{custom:t=>mt(t)(s),boolean:mt(t=>typeof t=="boolean"?t:void 0)(s),number:mt(t=>typeof t=="number"?t:void 0)(s),string:mt(t=>typeof t=="string"?t:void 0)(s),function:mt(t=>typeof t=="function"?t:void 0)(s),constant:t=>mt(e=>e===t?t:void 0)(s),raw:mt(t=>t)(s),object:t=>mt(e=>{if(ds(e))return cs(e,t)})(s),array:t=>mt(e=>{if(Array.isArray(e))return ps(e,t)})(s)}}const U={optional:De(!0),required:De(!1)};function G(s,t){const e=U.required.object(t)(s);return e.succeeded?e.value:void 0}function Yt(s){console.warn([`Missing '${s.key}' of ${s.target} in ${s.place}.`,"Please rebuild plugins with the latest core package."].join(" "))}function hs(s){return s&&s.parentElement&&s.parentElement.removeChild(s),null}class pe{constructor(t){this.value_=t}static create(t){return[new pe(t),(e,i)=>{t.setRawValue(e,i)}]}get emitter(){return this.value_.emitter}get rawValue(){return this.value_.rawValue}}const Ne=A("");function de(s,t){return Q(s,Ne(void 0,t))}class ct extends M{constructor(t){var e;super(t),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=pe.create(q(this.getGlobalDisabled_())),this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),(e=this.get("parent"))===null||e===void 0||e.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(t){var e,i,l;const h=t??{};return new ct(M.createCore({disabled:(e=h.disabled)!==null&&e!==void 0?e:!1,disposed:!1,hidden:(i=h.hidden)!==null&&i!==void 0?i:!1,parent:(l=h.parent)!==null&&l!==void 0?l:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(t){H(this.globalDisabled_,de(t,"disabled")),F(this,"hidden",de(t,"hidden"))}bindDisabled(t){H(this.globalDisabled_,e=>{t.disabled=e})}bindTabIndex(t){H(this.globalDisabled_,e=>{t.tabIndex=e?-1:0})}handleDispose(t){this.value("disposed").emitter.on("change",e=>{e&&t()})}getGlobalDisabled_(){const t=this.get("parent");return(t?t.globalDisabled.rawValue:!1)||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(t){var e;const i=t.previousRawValue;i==null||i.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),(e=this.get("parent"))===null||e===void 0||e.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}}function us(){return["veryfirst","first","last","verylast"]}const je=A(""),he={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class ft{constructor(t){this.parent_=null,this.blade=t.blade,this.view=t.view,this.viewProps=t.viewProps;const e=this.view.element;this.blade.value("positions").emitter.on("change",()=>{us().forEach(i=>{e.classList.remove(je(void 0,he[i]))}),this.blade.get("positions").forEach(i=>{e.classList.add(je(void 0,he[i]))})}),this.viewProps.handleDispose(()=>{hs(e)})}get parent(){return this.parent_}set parent(t){if(this.parent_=t,!("parent"in this.viewProps.valMap_)){Yt({key:"parent",target:ct.name,place:"BladeController.parent"});return}this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null)}}const it="http://www.w3.org/2000/svg";function Ot(s){s.offsetHeight}function ms(s,t){const e=s.style.transition;s.style.transition="none",t(),s.style.transition=e}function ue(s){return s.ontouchstart!==void 0}function Ue(){return globalThis}function He(){return Ue().document}function vs(s){const t=s.ownerDocument.defaultView;return t&&"document"in t?s.getContext("2d",{willReadFrequently:!0}):null}const gs={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function Dt(s,t){const e=s.createElementNS(it,"svg");return e.innerHTML=gs[t],e}function Be(s,t,e){s.insertBefore(t,s.children[e])}function me(s){s.parentElement&&s.parentElement.removeChild(s)}function ve(s){for(;s.children.length>0;)s.removeChild(s.children[0])}function ge(s){for(;s.childNodes.length>0;)s.removeChild(s.childNodes[0])}function g(s){return s.relatedTarget?s.relatedTarget:"explicitOriginalTarget"in s?s.explicitOriginalTarget:null}const k=A("lbl");function z(s,t){const e=s.createDocumentFragment();return t.split(`
`).map(i=>s.createTextNode(i)).forEach((i,l)=>{l>0&&e.appendChild(s.createElement("br")),e.appendChild(i)}),e}class W{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(k()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("div");i.classList.add(k("l")),F(e.props,"label",h=>{m(h)?this.element.classList.add(k(void 0,"nol")):(this.element.classList.remove(k(void 0,"nol")),ge(i),i.appendChild(z(t,h)))}),this.element.appendChild(i),this.labelElement=i;const l=t.createElement("div");l.classList.add(k("v")),this.element.appendChild(l),this.valueElement=l}}class at extends ft{constructor(t,e){const i=e.valueController.viewProps;super(Object.assign(Object.assign({},e),{view:new W(t,{props:e.props,viewProps:i}),viewProps:i})),this.props=e.props,this.valueController=e.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}const gt={id:"button",type:"blade",accept(s){const t=U,e=G(s,{title:t.required.string,view:t.required.constant("button"),label:t.optional.string});return e?{params:e}:null},controller(s){return new at(s.document,{blade:s.blade,props:M.fromObject({label:s.params.label}),valueController:new J(s.document,{props:M.fromObject({title:s.params.title}),viewProps:s.viewProps})})},api(s){return!(s.controller instanceof at)||!(s.controller.valueController instanceof J)?null:new R(s.controller)}};class _t extends ft{constructor(t){super(t),this.value=t.value}}function tt(){return new M({positions:q([],{equals:f})})}class et extends M{constructor(t){super(t)}static create(t){const e={completed:!0,expanded:t,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},i=M.createCore(e);return new et(i)}get styleExpanded(){var t;return(t=this.get("temporaryExpanded"))!==null&&t!==void 0?t:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const t=this.get("expandedHeight");return this.get("shouldFixHeight")&&!m(t)?`${t}px`:"auto"}bindExpandedClass(t,e){const i=()=>{this.styleExpanded?t.classList.add(e):t.classList.remove(e)};F(this,"expanded",i),F(this,"temporaryExpanded",i)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function $o(s,t){let e=0;return ms(t,()=>{s.set("expandedHeight",null),s.set("temporaryExpanded",!0),Ot(t),e=t.clientHeight,s.set("temporaryExpanded",null),Ot(t)}),e}function vi(s,t){t.style.height=s.styleHeight}function bs(s,t){s.value("expanded").emitter.on("beforechange",()=>{if(s.set("completed",!1),m(s.get("expandedHeight"))){const e=$o(s,t);e>0&&s.set("expandedHeight",e)}s.set("shouldFixHeight",!0),Ot(t)}),s.emitter.on("change",()=>{vi(s,t)}),vi(s,t),t.addEventListener("transitionend",e=>{e.propertyName==="height"&&s.cleanUpTransition()})}class fs extends a{constructor(t,e){super(t),this.rackApi_=e}}function Yo(s,t){return s.addBlade(Object.assign(Object.assign({},t),{view:"button"}))}function Xo(s,t){return s.addBlade(Object.assign(Object.assign({},t),{view:"folder"}))}function Wo(s,t){const e=t??{};return s.addBlade(Object.assign(Object.assign({},e),{view:"separator"}))}function Zo(s,t){return s.addBlade(Object.assign(Object.assign({},t),{view:"tab"}))}class _s{constructor(t){this.emitter=new P,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=t}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(t){for(const e of this.allItems())if(t(e))return e;return null}includes(t){return this.cache_.has(t)}add(t,e){if(this.includes(t))throw C.shouldNeverHappen();const i=e!==void 0?e:this.items_.length;this.items_.splice(i,0,t),this.cache_.add(t);const l=this.extract_(t);l&&(l.emitter.on("add",this.onSubListAdd_),l.emitter.on("remove",this.onSubListRemove_),l.allItems().forEach(h=>{this.cache_.add(h)})),this.emitter.emit("add",{index:i,item:t,root:this,target:this})}remove(t){const e=this.items_.indexOf(t);if(e<0)return;this.items_.splice(e,1),this.cache_.delete(t);const i=this.extract_(t);i&&(i.emitter.off("add",this.onSubListAdd_),i.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:e,item:t,root:this,target:this})}onSubListAdd_(t){this.cache_.add(t.item),this.emitter.emit("add",{index:t.index,item:t.item,root:this,target:t.target})}onSubListRemove_(t){this.cache_.delete(t.item),this.emitter.emit("remove",{index:t.index,item:t.item,root:this,target:t.target})}}class ws extends a{constructor(t){super(t),this.onBindingChange_=this.onBindingChange_.bind(this),this.emitter_=new P,this.controller_.binding.emitter.on("change",this.onBindingChange_)}get label(){return this.controller_.props.get("label")}set label(t){this.controller_.props.set("label",t)}on(t,e){const i=e.bind(this);return this.emitter_.on(t,l=>{i(l.event)}),this}refresh(){this.controller_.binding.read()}onBindingChange_(t){const e=t.sender.target.read();this.emitter_.emit("change",{event:new p(this,e,this.controller_.binding.target.presetKey,t.options.last)})}}class bt extends at{constructor(t,e){super(t,e),this.binding=e.binding}}class ys extends a{constructor(t){super(t),this.onBindingUpdate_=this.onBindingUpdate_.bind(this),this.emitter_=new P,this.controller_.binding.emitter.on("update",this.onBindingUpdate_)}get label(){return this.controller_.props.get("label")}set label(t){this.controller_.props.set("label",t)}on(t,e){const i=e.bind(this);return this.emitter_.on(t,l=>{i(l.event)}),this}refresh(){this.controller_.binding.read()}onBindingUpdate_(t){const e=t.sender.target.read();this.emitter_.emit("update",{event:new d(this,e,this.controller_.binding.target.presetKey)})}}class At extends at{constructor(t,e){super(t,e),this.binding=e.binding,this.viewProps.bindDisabled(this.binding.ticker),this.viewProps.handleDispose(()=>{this.binding.dispose()})}}function Qo(s){return s instanceof Ke?s.apiSet_:s instanceof fs?s.rackApi_.apiSet_:null}function be(s,t){const e=s.find(i=>i.controller_===t);if(!e)throw C.shouldNeverHappen();return e}function gi(s,t,e){if(!E.isBindable(s))throw C.notBindable();return new E(s,t,e)}class Ke extends a{constructor(t,e){super(t),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.onRackInputChange_=this.onRackInputChange_.bind(this),this.onRackMonitorUpdate_=this.onRackMonitorUpdate_.bind(this),this.emitter_=new P,this.apiSet_=new _s(Qo),this.pool_=e;const i=this.controller_.rack;i.emitter.on("add",this.onRackAdd_),i.emitter.on("remove",this.onRackRemove_),i.emitter.on("inputchange",this.onRackInputChange_),i.emitter.on("monitorupdate",this.onRackMonitorUpdate_),i.children.forEach(l=>{this.setUpApi_(l)})}get children(){return this.controller_.rack.children.map(t=>be(this.apiSet_,t))}addInput(t,e,i){const l=i??{},h=this.controller_.view.element.ownerDocument,v=this.pool_.createInput(h,gi(t,e,l.presetKey),l),y=new ws(v);return this.add(y,l.index)}addMonitor(t,e,i){const l=i??{},h=this.controller_.view.element.ownerDocument,v=this.pool_.createMonitor(h,gi(t,e),l),y=new ys(v);return this.add(y,l.index)}addFolder(t){return Xo(this,t)}addButton(t){return Yo(this,t)}addSeparator(t){return Wo(this,t)}addTab(t){return Zo(this,t)}add(t,e){this.controller_.rack.add(t.controller_,e);const i=this.apiSet_.find(l=>l.controller_===t.controller_);return i&&this.apiSet_.remove(i),this.apiSet_.add(t),t}remove(t){this.controller_.rack.remove(t.controller_)}addBlade(t){const e=this.controller_.view.element.ownerDocument,i=this.pool_.createBlade(e,t),l=this.pool_.createBladeApi(i);return this.add(l,t.index)}on(t,e){const i=e.bind(this);return this.emitter_.on(t,l=>{i(l.event)}),this}setUpApi_(t){this.apiSet_.find(e=>e.controller_===t)||this.apiSet_.add(this.pool_.createBladeApi(t))}onRackAdd_(t){this.setUpApi_(t.bladeController)}onRackRemove_(t){if(t.isRoot){const e=be(this.apiSet_,t.bladeController);this.apiSet_.remove(e)}}onRackInputChange_(t){const e=t.bladeController;if(e instanceof bt){const i=be(this.apiSet_,e),l=e.binding;this.emitter_.emit("change",{event:new p(i,l.target.read(),l.target.presetKey,t.options.last)})}else if(e instanceof _t){const i=be(this.apiSet_,e);this.emitter_.emit("change",{event:new p(i,e.value.rawValue,void 0,t.options.last)})}}onRackMonitorUpdate_(t){if(!(t.bladeController instanceof At))throw C.shouldNeverHappen();const e=be(this.apiSet_,t.bladeController),i=t.bladeController.binding;this.emitter_.emit("update",{event:new d(e,i.target.read(),i.target.presetKey)})}}class xs extends fs{constructor(t,e){super(t,new Ke(t.rackController,e)),this.emitter_=new P,this.controller_.foldable.value("expanded").emitter.on("change",i=>{this.emitter_.emit("fold",{event:new u(this,i.sender.rawValue)})}),this.rackApi_.on("change",i=>{this.emitter_.emit("change",{event:i})}),this.rackApi_.on("update",i=>{this.emitter_.emit("update",{event:i})})}get expanded(){return this.controller_.foldable.get("expanded")}set expanded(t){this.controller_.foldable.set("expanded",t)}get title(){return this.controller_.props.get("title")}set title(t){this.controller_.props.set("title",t)}get children(){return this.rackApi_.children}addInput(t,e,i){return this.rackApi_.addInput(t,e,i)}addMonitor(t,e,i){return this.rackApi_.addMonitor(t,e,i)}addFolder(t){return this.rackApi_.addFolder(t)}addButton(t){return this.rackApi_.addButton(t)}addSeparator(t){return this.rackApi_.addSeparator(t)}addTab(t){return this.rackApi_.addTab(t)}add(t,e){return this.rackApi_.add(t,e)}remove(t){this.rackApi_.remove(t)}addBlade(t){return this.rackApi_.addBlade(t)}on(t,e){const i=e.bind(this);return this.emitter_.on(t,l=>{i(l.event)}),this}}class Cs extends ft{constructor(t){super({blade:t.blade,view:t.view,viewProps:t.rackController.viewProps}),this.rackController=t.rackController}}class Jo{constructor(t,e){const i=A(e.viewName);this.element=t.createElement("div"),this.element.classList.add(i()),e.viewProps.bindClassModifiers(this.element)}}function tr(s,t){for(let e=0;e<s.length;e++){const i=s[e];if(i instanceof bt&&i.binding===t)return i}return null}function er(s,t){for(let e=0;e<s.length;e++){const i=s[e];if(i instanceof At&&i.binding===t)return i}return null}function sr(s,t){for(let e=0;e<s.length;e++){const i=s[e];if(i instanceof _t&&i.value===t)return i}return null}function Es(s){return s instanceof fe?s.rack:s instanceof Cs?s.rackController.rack:null}function ir(s){const t=Es(s);return t?t.bcSet_:null}class nr{constructor(t){var e,i;this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildInputChange_=this.onChildInputChange_.bind(this),this.onChildMonitorUpdate_=this.onChildMonitorUpdate_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onDescendantLayout_=this.onDescendantLayout_.bind(this),this.onDescendantInputChange_=this.onDescendantInputChange_.bind(this),this.onDescendantMonitorUpdate_=this.onDescendantMonitorUpdate_.bind(this),this.emitter=new P,this.blade_=(e=t.blade)!==null&&e!==void 0?e:null,(i=this.blade_)===null||i===void 0||i.value("positions").emitter.on("change",this.onBladePositionsChange_),this.viewProps=t.viewProps,this.bcSet_=new _s(ir),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(t,e){var i;(i=t.parent)===null||i===void 0||i.remove(t),x(t,"parent")?t.parent=this:(t.parent_=this,Yt({key:"parent",target:"BladeController",place:"BladeRack.add"})),this.bcSet_.add(t,e)}remove(t){x(t,"parent")?t.parent=null:(t.parent_=null,Yt({key:"parent",target:"BladeController",place:"BladeRack.remove"})),this.bcSet_.remove(t)}find(t){return this.bcSet_.allItems().filter(e=>e instanceof t)}onSetAdd_(t){this.updatePositions_();const e=t.target===t.root;if(this.emitter.emit("add",{bladeController:t.item,index:t.index,isRoot:e,sender:this}),!e)return;const i=t.item;if(i.viewProps.emitter.on("change",this.onChildViewPropsChange_),i.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),i.viewProps.handleDispose(this.onChildDispose_),i instanceof bt)i.binding.emitter.on("change",this.onChildInputChange_);else if(i instanceof At)i.binding.emitter.on("update",this.onChildMonitorUpdate_);else if(i instanceof _t)i.value.emitter.on("change",this.onChildValueChange_);else{const l=Es(i);if(l){const h=l.emitter;h.on("layout",this.onDescendantLayout_),h.on("inputchange",this.onDescendantInputChange_),h.on("monitorupdate",this.onDescendantMonitorUpdate_)}}}onSetRemove_(t){this.updatePositions_();const e=t.target===t.root;if(this.emitter.emit("remove",{bladeController:t.item,isRoot:e,sender:this}),!e)return;const i=t.item;if(i instanceof bt)i.binding.emitter.off("change",this.onChildInputChange_);else if(i instanceof At)i.binding.emitter.off("update",this.onChildMonitorUpdate_);else if(i instanceof _t)i.value.emitter.off("change",this.onChildValueChange_);else{const l=Es(i);if(l){const h=l.emitter;h.off("layout",this.onDescendantLayout_),h.off("inputchange",this.onDescendantInputChange_),h.off("monitorupdate",this.onDescendantMonitorUpdate_)}}}updatePositions_(){const t=this.bcSet_.items.filter(l=>!l.viewProps.get("hidden")),e=t[0],i=t[t.length-1];this.bcSet_.items.forEach(l=>{const h=[];l===e&&(h.push("first"),(!this.blade_||this.blade_.get("positions").includes("veryfirst"))&&h.push("veryfirst")),l===i&&(h.push("last"),(!this.blade_||this.blade_.get("positions").includes("verylast"))&&h.push("verylast")),l.blade.set("positions",h)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(t){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(t=>t.viewProps.get("disposed")).forEach(t=>{this.bcSet_.remove(t)})}onChildInputChange_(t){const e=tr(this.find(bt),t.sender);if(!e)throw C.alreadyDisposed();this.emitter.emit("inputchange",{bladeController:e,options:t.options,sender:this})}onChildMonitorUpdate_(t){const e=er(this.find(At),t.sender);if(!e)throw C.alreadyDisposed();this.emitter.emit("monitorupdate",{bladeController:e,sender:this})}onChildValueChange_(t){const e=sr(this.find(_t),t.sender);if(!e)throw C.alreadyDisposed();this.emitter.emit("inputchange",{bladeController:e,options:t.options,sender:this})}onDescendantLayout_(t){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onDescendantInputChange_(t){this.emitter.emit("inputchange",{bladeController:t.bladeController,options:t.options,sender:this})}onDescendantMonitorUpdate_(t){this.emitter.emit("monitorupdate",{bladeController:t.bladeController,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class fe extends ft{constructor(t,e){super(Object.assign(Object.assign({},e),{view:new Jo(t,{viewName:"brk",viewProps:e.viewProps})})),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const i=new nr({blade:e.root?void 0:e.blade,viewProps:e.viewProps});i.emitter.on("add",this.onRackAdd_),i.emitter.on("remove",this.onRackRemove_),this.rack=i,this.viewProps.handleDispose(()=>{for(let l=this.rack.children.length-1;l>=0;l--)this.rack.children[l].viewProps.set("disposed",!0)})}onRackAdd_(t){t.isRoot&&Be(this.view.element,t.bladeController.view.element,t.index)}onRackRemove_(t){t.isRoot&&me(t.bladeController.view.element)}}const bi=A("cnt");class or{constructor(t,e){var i;this.className_=A((i=e.viewName)!==null&&i!==void 0?i:"fld"),this.element=t.createElement("div"),this.element.classList.add(this.className_(),bi()),e.viewProps.bindClassModifiers(this.element),this.foldable_=e.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),F(this.foldable_,"completed",Q(this.element,this.className_(void 0,"cpl")));const l=t.createElement("button");l.classList.add(this.className_("b")),F(e.props,"title",L=>{m(L)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),e.viewProps.bindDisabled(l),this.element.appendChild(l),this.buttonElement=l;const h=t.createElement("div");h.classList.add(this.className_("i")),this.element.appendChild(h);const v=t.createElement("div");v.classList.add(this.className_("t")),ot(e.props.value("title"),v),this.buttonElement.appendChild(v),this.titleElement=v;const y=t.createElement("div");y.classList.add(this.className_("m")),this.buttonElement.appendChild(y);const S=e.containerElement;S.classList.add(this.className_("c")),this.element.appendChild(S),this.containerElement=S}}class Ps extends Cs{constructor(t,e){var i;const l=et.create((i=e.expanded)!==null&&i!==void 0?i:!0),h=new fe(t,{blade:e.blade,root:e.root,viewProps:e.viewProps});super(Object.assign(Object.assign({},e),{rackController:h,view:new or(t,{containerElement:h.view.element,foldable:l,props:e.props,viewName:e.root?"rot":void 0,viewProps:e.viewProps})})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=e.props,this.foldable=l,bs(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}const rr={id:"folder",type:"blade",accept(s){const t=U,e=G(s,{title:t.required.string,view:t.required.constant("folder"),expanded:t.optional.boolean});return e?{params:e}:null},controller(s){return new Ps(s.document,{blade:s.blade,expanded:s.params.expanded,props:M.fromObject({title:s.params.title}),viewProps:s.viewProps})},api(s){return s.controller instanceof Ps?new xs(s.controller,s.pool):null}};class Xt extends _t{constructor(t,e){const i=e.valueController.viewProps;super(Object.assign(Object.assign({},e),{value:e.valueController.value,view:new W(t,{props:e.props,viewProps:i}),viewProps:i})),this.props=e.props,this.valueController=e.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}class fi extends a{}const _i=A("spr");class ar{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(_i()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("hr");i.classList.add(_i("r")),this.element.appendChild(i)}}class wi extends ft{constructor(t,e){super(Object.assign(Object.assign({},e),{view:new ar(t,{viewProps:e.viewProps})}))}}const lr={id:"separator",type:"blade",accept(s){const t=G(s,{view:U.required.constant("separator")});return t?{params:t}:null},controller(s){return new wi(s.document,{blade:s.blade,viewProps:s.viewProps})},api(s){return s.controller instanceof wi?new fi(s.controller):null}},_e=A("tbi");class cr{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(_e()),e.viewProps.bindClassModifiers(this.element),F(e.props,"selected",h=>{h?this.element.classList.add(_e(void 0,"sel")):this.element.classList.remove(_e(void 0,"sel"))});const i=t.createElement("button");i.classList.add(_e("b")),e.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const l=t.createElement("div");l.classList.add(_e("t")),ot(e.props.value("title"),l),this.buttonElement.appendChild(l),this.titleElement=l}}class pr{constructor(t,e){this.emitter=new P,this.onClick_=this.onClick_.bind(this),this.props=e.props,this.viewProps=e.viewProps,this.view=new cr(t,{props:e.props,viewProps:e.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class yi{constructor(t,e){this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new pr(t,{props:e.itemProps,viewProps:ct.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.cc_=new fe(t,{blade:tt(),viewProps:ct.create()}),this.props=e.props,F(this.props,"selected",i=>{this.itemController.props.set("selected",i),this.contentController.viewProps.set("hidden",!i)})}get itemController(){return this.ic_}get contentController(){return this.cc_}onItemClick_(){this.props.set("selected",!0)}}class xi{constructor(t,e){this.controller_=t,this.rackApi_=e}get title(){var t;return(t=this.controller_.itemController.props.get("title"))!==null&&t!==void 0?t:""}set title(t){this.controller_.itemController.props.set("title",t)}get selected(){return this.controller_.props.get("selected")}set selected(t){this.controller_.props.set("selected",t)}get children(){return this.rackApi_.children}addButton(t){return this.rackApi_.addButton(t)}addFolder(t){return this.rackApi_.addFolder(t)}addSeparator(t){return this.rackApi_.addSeparator(t)}addTab(t){return this.rackApi_.addTab(t)}add(t,e){this.rackApi_.add(t,e)}remove(t){this.rackApi_.remove(t)}addInput(t,e,i){return this.rackApi_.addInput(t,e,i)}addMonitor(t,e,i){return this.rackApi_.addMonitor(t,e,i)}addBlade(t){return this.rackApi_.addBlade(t)}}class Ci extends fs{constructor(t,e){super(t,new Ke(t.rackController,e)),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.onSelect_=this.onSelect_.bind(this),this.emitter_=new P,this.pageApiMap_=new Map,this.rackApi_.on("change",i=>{this.emitter_.emit("change",{event:i})}),this.rackApi_.on("update",i=>{this.emitter_.emit("update",{event:i})}),this.controller_.tab.selectedIndex.emitter.on("change",this.onSelect_),this.controller_.pageSet.emitter.on("add",this.onPageAdd_),this.controller_.pageSet.emitter.on("remove",this.onPageRemove_),this.controller_.pageSet.items.forEach(i=>{this.setUpPageApi_(i)})}get pages(){return this.controller_.pageSet.items.map(t=>{const e=this.pageApiMap_.get(t);if(!e)throw C.shouldNeverHappen();return e})}addPage(t){const e=this.controller_.view.element.ownerDocument,i=new yi(e,{itemProps:M.fromObject({selected:!1,title:t.title}),props:M.fromObject({selected:!1})});this.controller_.add(i,t.index);const l=this.pageApiMap_.get(i);if(!l)throw C.shouldNeverHappen();return l}removePage(t){this.controller_.remove(t)}on(t,e){const i=e.bind(this);return this.emitter_.on(t,l=>{i(l.event)}),this}setUpPageApi_(t){const e=this.rackApi_.apiSet_.find(l=>l.controller_===t.contentController);if(!e)throw C.shouldNeverHappen();const i=new xi(t,e);this.pageApiMap_.set(t,i)}onPageAdd_(t){this.setUpPageApi_(t.item)}onPageRemove_(t){if(!this.pageApiMap_.get(t.item))throw C.shouldNeverHappen();this.pageApiMap_.delete(t.item)}onSelect_(t){this.emitter_.emit("select",{event:new b(this,t.rawValue)})}}const Ei=-1;class dr{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=q(!0),this.selectedIndex=q(Ei),this.items_=[]}add(t,e){const i=e??this.items_.length;this.items_.splice(i,0,t),t.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(t){const e=this.items_.indexOf(t);e<0||(this.items_.splice(e,1),t.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(this.items_.length===0){this.selectedIndex.rawValue=Ei,this.empty.rawValue=!0;return}const t=this.items_.findIndex(e=>e.rawValue);t<0?(this.items_.forEach((e,i)=>{e.rawValue=i===0}),this.selectedIndex.rawValue=0):(this.items_.forEach((e,i)=>{e.rawValue=i===t}),this.selectedIndex.rawValue=t),this.empty.rawValue=!1}onItemSelectedChange_(t){if(t.rawValue){const e=this.items_.findIndex(i=>i===t.sender);this.items_.forEach((i,l)=>{i.rawValue=l===e}),this.selectedIndex.rawValue=e}else this.keepSelection_()}}const we=A("tab");class hr{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(we(),bi()),e.viewProps.bindClassModifiers(this.element),H(e.empty,Q(this.element,we(void 0,"nop")));const i=t.createElement("div");i.classList.add(we("t")),this.element.appendChild(i),this.itemsElement=i;const l=t.createElement("div");l.classList.add(we("i")),this.element.appendChild(l);const h=e.contentsElement;h.classList.add(we("c")),this.element.appendChild(h),this.contentsElement=h}}class Pi extends Cs{constructor(t,e){const i=new fe(t,{blade:e.blade,viewProps:e.viewProps}),l=new dr;super({blade:e.blade,rackController:i,view:new hr(t,{contentsElement:i.view.element,empty:l.empty,viewProps:e.viewProps})}),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.pageSet_=new _s(()=>null),this.pageSet_.emitter.on("add",this.onPageAdd_),this.pageSet_.emitter.on("remove",this.onPageRemove_),this.tab=l}get pageSet(){return this.pageSet_}add(t,e){this.pageSet_.add(t,e)}remove(t){this.pageSet_.remove(this.pageSet_.items[t])}onPageAdd_(t){const e=t.item;Be(this.view.itemsElement,e.itemController.view.element,t.index),e.itemController.viewProps.set("parent",this.viewProps),this.rackController.rack.add(e.contentController,t.index),this.tab.add(e.props.value("selected"))}onPageRemove_(t){const e=t.item;me(e.itemController.view.element),e.itemController.viewProps.set("parent",null),this.rackController.rack.remove(e.contentController),this.tab.remove(e.props.value("selected"))}}const ki={id:"tab",type:"blade",accept(s){const t=U,e=G(s,{pages:t.required.array(t.required.object({title:t.required.string})),view:t.required.constant("tab")});return!e||e.pages.length===0?null:{params:e}},controller(s){const t=new Pi(s.document,{blade:s.blade,viewProps:s.viewProps});return s.params.pages.forEach(e=>{const i=new yi(s.document,{itemProps:M.fromObject({selected:!1,title:e.title}),props:M.fromObject({selected:!1})});t.add(i)}),t},api(s){return s.controller instanceof Pi?new Ci(s.controller,s.pool):null}};function ur(s,t){const e=s.accept(t.params);if(!e)return null;const i=U.optional.boolean(t.params.disabled).value,l=U.optional.boolean(t.params.hidden).value;return s.controller({blade:tt(),document:t.document,params:Object.assign(Object.assign({},e.params),{disabled:i,hidden:l}),viewProps:ct.create({disabled:i,hidden:l})})}class mr{constructor(){this.disabled=!1,this.emitter=new P}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class vr{constructor(t,e){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=t,this.emitter=new P,this.interval_=e,this.setTimer_()}get disabled(){return this.disabled_}set disabled(t){this.disabled_=t,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(this.timerId_===null)return;const t=this.doc_.defaultView;t&&t.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const t=this.doc_.defaultView;t&&(this.timerId_=t.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class gr{constructor(t){this.onValueChange_=this.onValueChange_.bind(this),this.reader=t.reader,this.writer=t.writer,this.emitter=new P,this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.target=t.target,this.read()}read(){const t=this.target.read();t!==void 0&&(this.value.rawValue=this.reader(t))}write_(t){this.writer(this.target,t)}onValueChange_(t){this.write_(t.rawValue),this.emitter.emit("change",{options:t.options,rawValue:t.rawValue,sender:this})}}function Ti(s,t){for(;s.length<t;)s.push(void 0)}function br(s){const t=[];return Ti(t,s),q(t)}function fr(s){const t=s.indexOf(void 0);return t<0?s:s.slice(0,t)}function _r(s,t){const e=[...fr(s),t];return e.length>s.length?e.splice(0,e.length-s.length):Ti(e,s.length),e}class wr{constructor(t){this.onTick_=this.onTick_.bind(this),this.reader_=t.reader,this.target=t.target,this.emitter=new P,this.value=t.value,this.ticker=t.ticker,this.ticker.emitter.on("tick",this.onTick_),this.read()}dispose(){this.ticker.dispose()}read(){const t=this.target.read();if(t===void 0)return;const e=this.value.rawValue,i=this.reader_(t);this.value.rawValue=_r(e,i),this.emitter.emit("update",{rawValue:i,sender:this})}onTick_(t){this.read()}}class ye{constructor(t){this.constraints=t}constrain(t){return this.constraints.reduce((e,i)=>i.constrain(e),t)}}function wt(s,t){if(s instanceof t)return s;if(s instanceof ye){const e=s.constraints.reduce((i,l)=>i||(l instanceof t?l:null),null);if(e)return e}return null}class Wt{constructor(t){this.values=M.fromObject({max:t.max,min:t.min})}constrain(t){const e=this.values.get("max"),i=this.values.get("min");return Math.min(Math.max(t,i),e)}}class xe{constructor(t){this.values=M.fromObject({options:t})}get options(){return this.values.get("options")}constrain(t){const e=this.values.get("options");return e.length===0||e.filter(i=>i.value===t).length>0?t:e[0].value}}class Ai{constructor(t){this.values=M.fromObject({max:t.max,min:t.min})}get maxValue(){return this.values.get("max")}get minValue(){return this.values.get("min")}constrain(t){const e=this.values.get("max"),i=this.values.get("min");let l=t;return m(i)||(l=Math.max(l,i)),m(e)||(l=Math.min(l,e)),l}}class Fe{constructor(t,e=0){this.step=t,this.origin=e}constrain(t){const e=this.origin%this.step,i=Math.round((t-e)/this.step);return e+i*this.step}}const ks=A("lst");class yr{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.props_=e.props,this.element=t.createElement("div"),this.element.classList.add(ks()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("select");i.classList.add(ks("s")),e.viewProps.bindDisabled(i),this.element.appendChild(i),this.selectElement=i;const l=t.createElement("div");l.classList.add(ks("m")),l.appendChild(Dt(t,"dropdown")),this.element.appendChild(l),e.value.emitter.on("change",this.onValueChange_),this.value_=e.value,F(this.props_,"options",h=>{ve(this.selectElement),h.forEach(v=>{const y=t.createElement("option");y.textContent=v.text,this.selectElement.appendChild(y)}),this.update_()})}update_(){const t=this.props_.get("options").map(e=>e.value);this.selectElement.selectedIndex=t.indexOf(this.value_.rawValue)}onValueChange_(){this.update_()}}class Ce{constructor(t,e){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=e.props,this.value=e.value,this.viewProps=e.viewProps,this.view=new yr(t,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(t){const e=t.currentTarget;this.value.rawValue=this.props.get("options")[e.selectedIndex].value}}const Li=A("pop");class xr{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Li()),e.viewProps.bindClassModifiers(this.element),H(e.shows,Q(this.element,Li(void 0,"v")))}}class Si{constructor(t,e){this.shows=q(!1),this.viewProps=e.viewProps,this.view=new xr(t,{shows:this.shows,viewProps:this.viewProps})}}const Ri=A("txt");class Cr{constructor(t,e){this.onChange_=this.onChange_.bind(this),this.element=t.createElement("div"),this.element.classList.add(Ri()),e.viewProps.bindClassModifiers(this.element),this.props_=e.props,this.props_.emitter.on("change",this.onChange_);const i=t.createElement("input");i.classList.add(Ri("i")),i.type="text",e.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,e.value.emitter.on("change",this.onChange_),this.value_=e.value,this.refresh()}refresh(){const t=this.props_.get("formatter");this.inputElement.value=t(this.value_.rawValue)}onChange_(){this.refresh()}}class ze{constructor(t,e){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=e.parser,this.props=e.props,this.value=e.value,this.viewProps=e.viewProps,this.view=new Cr(t,{props:e.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(t){const e=t.currentTarget.value,i=this.parser_(e);m(i)||(this.value.rawValue=i),this.view.refresh()}}function Er(s){return String(s)}function Mi(s){return s==="false"?!1:!!s}function Vi(s){return Er(s)}class Pr{constructor(t){this.text=t}evaluate(){return Number(this.text)}toString(){return this.text}}const kr={"**":(s,t)=>Math.pow(s,t),"*":(s,t)=>s*t,"/":(s,t)=>s/t,"%":(s,t)=>s%t,"+":(s,t)=>s+t,"-":(s,t)=>s-t,"<<":(s,t)=>s<<t,">>":(s,t)=>s>>t,">>>":(s,t)=>s>>>t,"&":(s,t)=>s&t,"^":(s,t)=>s^t,"|":(s,t)=>s|t};class Tr{constructor(t,e,i){this.left=e,this.operator=t,this.right=i}evaluate(){const t=kr[this.operator];if(!t)throw new Error(`unexpected binary operator: '${this.operator}`);return t(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const Ar={"+":s=>s,"-":s=>-s,"~":s=>~s};class Lr{constructor(t,e){this.operator=t,this.expression=e}evaluate(){const t=Ar[this.operator];if(!t)throw new Error(`unexpected unary operator: '${this.operator}`);return t(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function Ts(s){return(t,e)=>{for(let i=0;i<s.length;i++){const l=s[i](t,e);if(l!=="")return l}return""}}function Ee(s,t){var e;const i=s.substr(t).match(/^\s+/);return(e=i&&i[0])!==null&&e!==void 0?e:""}function Sr(s,t){const e=s.substr(t,1);return e.match(/^[1-9]$/)?e:""}function Pe(s,t){var e;const i=s.substr(t).match(/^[0-9]+/);return(e=i&&i[0])!==null&&e!==void 0?e:""}function Rr(s,t){const e=Pe(s,t);if(e!=="")return e;const i=s.substr(t,1);if(t+=1,i!=="-"&&i!=="+")return"";const l=Pe(s,t);return l===""?"":i+l}function As(s,t){const e=s.substr(t,1);if(t+=1,e.toLowerCase()!=="e")return"";const i=Rr(s,t);return i===""?"":e+i}function Ii(s,t){const e=s.substr(t,1);if(e==="0")return e;const i=Sr(s,t);return t+=i.length,i===""?"":i+Pe(s,t)}function Mr(s,t){const e=Ii(s,t);if(t+=e.length,e==="")return"";const i=s.substr(t,1);if(t+=i.length,i!==".")return"";const l=Pe(s,t);return t+=l.length,e+i+l+As(s,t)}function Vr(s,t){const e=s.substr(t,1);if(t+=e.length,e!==".")return"";const i=Pe(s,t);return t+=i.length,i===""?"":e+i+As(s,t)}function Ir(s,t){const e=Ii(s,t);return t+=e.length,e===""?"":e+As(s,t)}const Or=Ts([Mr,Vr,Ir]);function Dr(s,t){var e;const i=s.substr(t).match(/^[01]+/);return(e=i&&i[0])!==null&&e!==void 0?e:""}function Nr(s,t){const e=s.substr(t,2);if(t+=e.length,e.toLowerCase()!=="0b")return"";const i=Dr(s,t);return i===""?"":e+i}function jr(s,t){var e;const i=s.substr(t).match(/^[0-7]+/);return(e=i&&i[0])!==null&&e!==void 0?e:""}function Ur(s,t){const e=s.substr(t,2);if(t+=e.length,e.toLowerCase()!=="0o")return"";const i=jr(s,t);return i===""?"":e+i}function Hr(s,t){var e;const i=s.substr(t).match(/^[0-9a-f]+/i);return(e=i&&i[0])!==null&&e!==void 0?e:""}function Br(s,t){const e=s.substr(t,2);if(t+=e.length,e.toLowerCase()!=="0x")return"";const i=Hr(s,t);return i===""?"":e+i}const Kr=Ts([Nr,Ur,Br]),Fr=Ts([Kr,Or]);function zr(s,t){const e=Fr(s,t);return t+=e.length,e===""?null:{evaluable:new Pr(e),cursor:t}}function Gr(s,t){const e=s.substr(t,1);if(t+=e.length,e!=="(")return null;const i=Di(s,t);if(!i)return null;t=i.cursor,t+=Ee(s,t).length;const l=s.substr(t,1);return t+=l.length,l!==")"?null:{evaluable:i.evaluable,cursor:t}}function qr(s,t){var e;return(e=zr(s,t))!==null&&e!==void 0?e:Gr(s,t)}function Oi(s,t){const e=qr(s,t);if(e)return e;const i=s.substr(t,1);if(t+=i.length,i!=="+"&&i!=="-"&&i!=="~")return null;const l=Oi(s,t);return l?(t=l.cursor,{cursor:t,evaluable:new Lr(i,l.evaluable)}):null}function $r(s,t,e){e+=Ee(t,e).length;const i=s.filter(l=>t.startsWith(l,e))[0];return i?(e+=i.length,e+=Ee(t,e).length,{cursor:e,operator:i}):null}function Yr(s,t){return(e,i)=>{const l=s(e,i);if(!l)return null;i=l.cursor;let h=l.evaluable;for(;;){const v=$r(t,e,i);if(!v)break;i=v.cursor;const y=s(e,i);if(!y)return null;i=y.cursor,h=new Tr(v.operator,h,y.evaluable)}return h?{cursor:i,evaluable:h}:null}}const Xr=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((s,t)=>Yr(s,t),Oi);function Di(s,t){return t+=Ee(s,t).length,Xr(s,t)}function Wr(s){const t=Di(s,0);return!t||t.cursor+Ee(s,t.cursor).length!==s.length?null:t.evaluable}function yt(s){var t;const e=Wr(s);return(t=e==null?void 0:e.evaluate())!==null&&t!==void 0?t:null}function Ni(s){if(typeof s=="number")return s;if(typeof s=="string"){const t=yt(s);if(!m(t))return t}return 0}function Zr(s){return String(s)}function Z(s){return t=>t.toFixed(Math.max(Math.min(s,20),0))}const Qr=Z(0);function Ge(s){return Qr(s)+"%"}function ji(s){return String(s)}function Ls(s){return s}function ke({primary:s,secondary:t,forward:e,backward:i}){let l=!1;function h(v){l||(l=!0,v(),l=!1)}s.emitter.on("change",v=>{h(()=>{t.setRawValue(e(s,t),v.options)})}),t.emitter.on("change",v=>{h(()=>{s.setRawValue(i(s,t),v.options)}),h(()=>{t.setRawValue(e(s,t),v.options)})}),h(()=>{t.setRawValue(e(s,t),{forceEmit:!1,last:!0})})}function nt(s,t){const e=s*(t.altKey?.1:1)*(t.shiftKey?10:1);return t.upKey?+e:t.downKey?-e:0}function Te(s){return{altKey:s.altKey,downKey:s.key==="ArrowDown",shiftKey:s.shiftKey,upKey:s.key==="ArrowUp"}}function xt(s){return{altKey:s.altKey,downKey:s.key==="ArrowLeft",shiftKey:s.shiftKey,upKey:s.key==="ArrowRight"}}function Jr(s){return s==="ArrowUp"||s==="ArrowDown"}function Ui(s){return Jr(s)||s==="ArrowLeft"||s==="ArrowRight"}function Ss(s,t){var e,i;const l=t.ownerDocument.defaultView,h=t.getBoundingClientRect();return{x:s.pageX-(((e=l&&l.scrollX)!==null&&e!==void 0?e:0)+h.left),y:s.pageY-(((i=l&&l.scrollY)!==null&&i!==void 0?i:0)+h.top)}}class Nt{constructor(t){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=t,this.emitter=new P,t.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),t.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),t.addEventListener("touchend",this.onTouchEnd_),t.addEventListener("mousedown",this.onMouseDown_)}computePosition_(t){const e=this.elem_.getBoundingClientRect();return{bounds:{width:e.width,height:e.height},point:t?{x:t.x,y:t.y}:null}}onMouseDown_(t){var e;t.preventDefault(),(e=t.currentTarget)===null||e===void 0||e.focus();const i=this.elem_.ownerDocument;i.addEventListener("mousemove",this.onDocumentMouseMove_),i.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:t.altKey,data:this.computePosition_(Ss(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onDocumentMouseMove_(t){this.emitter.emit("move",{altKey:t.altKey,data:this.computePosition_(Ss(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onDocumentMouseUp_(t){const e=this.elem_.ownerDocument;e.removeEventListener("mousemove",this.onDocumentMouseMove_),e.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:t.altKey,data:this.computePosition_(Ss(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onTouchStart_(t){t.preventDefault();const e=t.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:t.altKey,data:this.computePosition_(e?{x:e.clientX-i.left,y:e.clientY-i.top}:void 0),sender:this,shiftKey:t.shiftKey}),this.lastTouch_=e}onTouchMove_(t){const e=t.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:t.altKey,data:this.computePosition_(e?{x:e.clientX-i.left,y:e.clientY-i.top}:void 0),sender:this,shiftKey:t.shiftKey}),this.lastTouch_=e}onTouchEnd_(t){var e;const i=(e=t.targetTouches.item(0))!==null&&e!==void 0?e:this.lastTouch_,l=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:t.altKey,data:this.computePosition_(i?{x:i.clientX-l.left,y:i.clientY-l.top}:void 0),sender:this,shiftKey:t.shiftKey})}}function K(s,t,e,i,l){const h=(s-t)/(e-t);return i+h*(l-i)}function Hi(s){return String(s.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function $(s,t,e){return Math.min(Math.max(s,t),e)}function Bi(s,t){return(s%t+t)%t}const pt=A("txt");class ta{constructor(t,e){this.onChange_=this.onChange_.bind(this),this.props_=e.props,this.props_.emitter.on("change",this.onChange_),this.element=t.createElement("div"),this.element.classList.add(pt(),pt(void 0,"num")),e.arrayPosition&&this.element.classList.add(pt(void 0,e.arrayPosition)),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("input");i.classList.add(pt("i")),i.type="text",e.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=e.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(pt()),this.inputElement.classList.add(pt("i"));const l=t.createElement("div");l.classList.add(pt("k")),this.element.appendChild(l),this.knobElement=l;const h=t.createElementNS(it,"svg");h.classList.add(pt("g")),this.knobElement.appendChild(h);const v=t.createElementNS(it,"path");v.classList.add(pt("gb")),h.appendChild(v),this.guideBodyElem_=v;const y=t.createElementNS(it,"path");y.classList.add(pt("gh")),h.appendChild(y),this.guideHeadElem_=y;const S=t.createElement("div");S.classList.add(A("tt")()),this.knobElement.appendChild(S),this.tooltipElem_=S,e.value.emitter.on("change",this.onChange_),this.value=e.value,this.refresh()}onDraggingChange_(t){if(t.rawValue===null){this.element.classList.remove(pt(void 0,"drg"));return}this.element.classList.add(pt(void 0,"drg"));const e=t.rawValue/this.props_.get("draggingScale"),i=e+(e>0?-1:e<0?1:0),l=$(-i,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${i+l},0 L${i},4 L${i+l},8`,`M ${e},-1 L${e},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${e},4`);const h=this.props_.get("formatter");this.tooltipElem_.textContent=h(this.value.rawValue),this.tooltipElem_.style.left=`${e}px`}refresh(){const t=this.props_.get("formatter");this.inputElement.value=t(this.value.rawValue)}onChange_(){this.refresh()}}class Ae{constructor(t,e){var i;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=e.baseStep,this.parser_=e.parser,this.props=e.props,this.sliderProps_=(i=e.sliderProps)!==null&&i!==void 0?i:null,this.value=e.value,this.viewProps=e.viewProps,this.dragging_=q(null),this.view=new ta(t,{arrayPosition:e.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const l=new Nt(this.view.knobElement);l.emitter.on("down",this.onPointerDown_),l.emitter.on("move",this.onPointerMove_),l.emitter.on("up",this.onPointerUp_)}constrainValue_(t){var e,i;const l=(e=this.sliderProps_)===null||e===void 0?void 0:e.get("minValue"),h=(i=this.sliderProps_)===null||i===void 0?void 0:i.get("maxValue");let v=t;return l!==void 0&&(v=Math.max(v,l)),h!==void 0&&(v=Math.min(v,h)),v}onInputChange_(t){const e=t.currentTarget.value,i=this.parser_(e);m(i)||(this.value.rawValue=this.constrainValue_(i)),this.view.refresh()}onInputKeyDown_(t){const e=nt(this.baseStep_,Te(t));e!==0&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+e),{forceEmit:!1,last:!1})}onInputKeyUp_(t){nt(this.baseStep_,Te(t))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(t){if(!t.point)return null;const e=t.point.x-t.bounds.width/2;return this.constrainValue_(this.originRawValue_+e*this.props.get("draggingScale"))}onPointerMove_(t){const e=this.computeDraggingValue_(t.data);e!==null&&(this.value.setRawValue(e,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(t){const e=this.computeDraggingValue_(t.data);e!==null&&(this.value.setRawValue(e,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const Rs=A("sld");class ea{constructor(t,e){this.onChange_=this.onChange_.bind(this),this.props_=e.props,this.props_.emitter.on("change",this.onChange_),this.element=t.createElement("div"),this.element.classList.add(Rs()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("div");i.classList.add(Rs("t")),e.viewProps.bindTabIndex(i),this.element.appendChild(i),this.trackElement=i;const l=t.createElement("div");l.classList.add(Rs("k")),this.trackElement.appendChild(l),this.knobElement=l,e.value.emitter.on("change",this.onChange_),this.value=e.value,this.update_()}update_(){const t=$(K(this.value.rawValue,this.props_.get("minValue"),this.props_.get("maxValue"),0,100),0,100);this.knobElement.style.width=`${t}%`}onChange_(){this.update_()}}class sa{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=e.baseStep,this.value=e.value,this.viewProps=e.viewProps,this.props=e.props,this.view=new ea(t,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Nt(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){t.point&&this.value.setRawValue(K($(t.point.x,0,t.bounds.width),0,t.bounds.width,this.props.get("minValue"),this.props.get("maxValue")),e)}onPointerDownOrMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){const e=nt(this.baseStep_,xt(t));e!==0&&this.value.setRawValue(this.value.rawValue+e,{forceEmit:!1,last:!1})}onKeyUp_(t){nt(this.baseStep_,xt(t))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Ms=A("sldtxt");class ia{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Ms());const i=t.createElement("div");i.classList.add(Ms("s")),this.sliderView_=e.sliderView,i.appendChild(this.sliderView_.element),this.element.appendChild(i);const l=t.createElement("div");l.classList.add(Ms("t")),this.textView_=e.textView,l.appendChild(this.textView_.element),this.element.appendChild(l)}}class Vs{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.sliderC_=new sa(t,{baseStep:e.baseStep,props:e.sliderProps,value:e.value,viewProps:this.viewProps}),this.textC_=new Ae(t,{baseStep:e.baseStep,parser:e.parser,props:e.textProps,sliderProps:e.sliderProps,value:e.value,viewProps:e.viewProps}),this.view=new ia(t,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}}function Le(s,t){s.write(t)}function qe(s){const t=U;if(Array.isArray(s))return t.required.array(t.required.object({text:t.required.string,value:t.required.raw}))(s).value;if(typeof s=="object")return t.required.raw(s).value}function Ki(s){if(s==="inline"||s==="popup")return s}function Lt(s){const t=U;return t.required.object({max:t.optional.number,min:t.optional.number,step:t.optional.number})(s).value}function Fi(s){if(Array.isArray(s))return s;const t=[];return Object.keys(s).forEach(e=>{t.push({text:e,value:s[e]})}),t}function Is(s){return m(s)?null:new xe(Fi(s))}function na(s){const t=s?wt(s,Fe):null;return t?t.step:null}function $e(s,t){const e=s&&wt(s,Fe);return e?Hi(e.step):Math.max(Hi(t),2)}function Zt(s){return na(s)??1}function Qt(s,t){var e;const i=s&&wt(s,Fe),l=Math.abs((e=i==null?void 0:i.step)!==null&&e!==void 0?e:t);return l===0?.1:Math.pow(10,Math.floor(Math.log10(l))-1)}const Ye=A("ckb");class oa{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.element=t.createElement("div"),this.element.classList.add(Ye()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("label");i.classList.add(Ye("l")),this.element.appendChild(i);const l=t.createElement("input");l.classList.add(Ye("i")),l.type="checkbox",i.appendChild(l),this.inputElement=l,e.viewProps.bindDisabled(this.inputElement);const h=t.createElement("div");h.classList.add(Ye("w")),i.appendChild(h);const v=Dt(t,"check");h.appendChild(v),e.value.emitter.on("change",this.onValueChange_),this.value=e.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class ra{constructor(t,e){this.onInputChange_=this.onInputChange_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new oa(t,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(t){const e=t.currentTarget;this.value.rawValue=e.checked}}function aa(s){const t=[],e=Is(s.options);return e&&t.push(e),new ye(t)}const la={id:"input-bool",type:"input",accept:(s,t)=>{if(typeof s!="boolean")return null;const e=G(t,{options:U.optional.custom(qe)});return e?{initialValue:s,params:e}:null},binding:{reader:s=>Mi,constraint:s=>aa(s.params),writer:s=>Le},controller:s=>{const t=s.document,e=s.value,i=s.constraint,l=i&&wt(i,xe);return l?new Ce(t,{props:new M({options:l.values.value("options")}),value:e,viewProps:s.viewProps}):new ra(t,{value:e,viewProps:s.viewProps})}},jt=A("col");class ca{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(jt()),e.foldable.bindExpandedClass(this.element,jt(void 0,"expanded")),F(e.foldable,"completed",Q(this.element,jt(void 0,"cpl")));const i=t.createElement("div");i.classList.add(jt("h")),this.element.appendChild(i);const l=t.createElement("div");l.classList.add(jt("s")),i.appendChild(l),this.swatchElement=l;const h=t.createElement("div");if(h.classList.add(jt("t")),i.appendChild(h),this.textElement=h,e.pickerLayout==="inline"){const v=t.createElement("div");v.classList.add(jt("p")),this.element.appendChild(v),this.pickerElement=v}else this.pickerElement=null}}function pa(s,t,e){const i=$(s/255,0,1),l=$(t/255,0,1),h=$(e/255,0,1),v=Math.max(i,l,h),y=Math.min(i,l,h),S=v-y;let L=0,N=0;const j=(y+v)/2;return S!==0&&(N=S/(1-Math.abs(v+y-1)),i===v?L=(l-h)/S:l===v?L=2+(h-i)/S:L=4+(i-l)/S,L=L/6+(L<0?1:0)),[L*360,N*100,j*100]}function da(s,t,e){const i=(s%360+360)%360,l=$(t/100,0,1),h=$(e/100,0,1),v=(1-Math.abs(2*h-1))*l,y=v*(1-Math.abs(i/60%2-1)),S=h-v/2;let L,N,j;return i>=0&&i<60?[L,N,j]=[v,y,0]:i>=60&&i<120?[L,N,j]=[y,v,0]:i>=120&&i<180?[L,N,j]=[0,v,y]:i>=180&&i<240?[L,N,j]=[0,y,v]:i>=240&&i<300?[L,N,j]=[y,0,v]:[L,N,j]=[v,0,y],[(L+S)*255,(N+S)*255,(j+S)*255]}function ha(s,t,e){const i=$(s/255,0,1),l=$(t/255,0,1),h=$(e/255,0,1),v=Math.max(i,l,h),y=Math.min(i,l,h),S=v-y;let L;S===0?L=0:v===i?L=60*(((l-h)/S%6+6)%6):v===l?L=60*((h-i)/S+2):L=60*((i-l)/S+4);const N=v===0?0:S/v,j=v;return[L,N*100,j*100]}function zi(s,t,e){const i=Bi(s,360),l=$(t/100,0,1),h=$(e/100,0,1),v=h*l,y=v*(1-Math.abs(i/60%2-1)),S=h-v;let L,N,j;return i>=0&&i<60?[L,N,j]=[v,y,0]:i>=60&&i<120?[L,N,j]=[y,v,0]:i>=120&&i<180?[L,N,j]=[0,v,y]:i>=180&&i<240?[L,N,j]=[0,y,v]:i>=240&&i<300?[L,N,j]=[y,0,v]:[L,N,j]=[v,0,y],[(L+S)*255,(N+S)*255,(j+S)*255]}function ua(s,t,e){const i=e+t*(100-Math.abs(2*e-100))/200;return[s,i!==0?t*(100-Math.abs(2*e-100))/i:0,e+t*(100-Math.abs(2*e-100))/(2*100)]}function ma(s,t,e){const i=100-Math.abs(e*(200-t)/100-100);return[s,i!==0?t*e/i:0,e*(200-t)/(2*100)]}function Ut(s){return[s[0],s[1],s[2]]}function Gi(s,t){return[s[0],s[1],s[2],t]}const va={hsl:{hsl:(s,t,e)=>[s,t,e],hsv:ua,rgb:da},hsv:{hsl:ma,hsv:(s,t,e)=>[s,t,e],rgb:zi},rgb:{hsl:pa,hsv:ha,rgb:(s,t,e)=>[s,t,e]}};function Xe(s,t){return[t==="float"?1:s==="rgb"?255:360,t==="float"?1:s==="rgb"?255:100,t==="float"?1:s==="rgb"?255:100]}function ga(s,t){return s===t?t:Bi(s,t)}function ba(s,t,e){var i;const l=Xe(t,e);return[t==="rgb"?$(s[0],0,l[0]):ga(s[0],l[0]),$(s[1],0,l[1]),$(s[2],0,l[2]),$((i=s[3])!==null&&i!==void 0?i:1,0,1)]}function qi(s,t,e,i){const l=Xe(t,e),h=Xe(t,i);return s.map((v,y)=>v/l[y]*h[y])}function fa(s,t,e){const i=qi(s,t.mode,t.type,"int"),l=va[t.mode][e.mode](...i);return qi(l,e.mode,"int",e.type)}function We(s,t){return typeof s!="object"||m(s)?!1:t in s&&typeof s[t]=="number"}class O{static black(t="int"){return new O([0,0,0],"rgb",t)}static fromObject(t,e="int"){const i="a"in t?[t.r,t.g,t.b,t.a]:[t.r,t.g,t.b];return new O(i,"rgb",e)}static toRgbaObject(t,e="int"){return t.toRgbaObject(e)}static isRgbColorObject(t){return We(t,"r")&&We(t,"g")&&We(t,"b")}static isRgbaColorObject(t){return this.isRgbColorObject(t)&&We(t,"a")}static isColorObject(t){return this.isRgbColorObject(t)}static equals(t,e){if(t.mode!==e.mode)return!1;const i=t.comps_,l=e.comps_;for(let h=0;h<i.length;h++)if(i[h]!==l[h])return!1;return!0}constructor(t,e,i="int"){this.mode=e,this.type=i,this.comps_=ba(t,e,i)}getComponents(t,e="int"){return Gi(fa(Ut(this.comps_),{mode:this.mode,type:this.type},{mode:t??this.mode,type:e}),this.comps_[3])}toRgbaObject(t="int"){const e=this.getComponents("rgb",t);return{r:e[0],g:e[1],b:e[2],a:e[3]}}}const St=A("colp");class _a{constructor(t,e){this.alphaViews_=null,this.element=t.createElement("div"),this.element.classList.add(St()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("div");i.classList.add(St("hsv"));const l=t.createElement("div");l.classList.add(St("sv")),this.svPaletteView_=e.svPaletteView,l.appendChild(this.svPaletteView_.element),i.appendChild(l);const h=t.createElement("div");h.classList.add(St("h")),this.hPaletteView_=e.hPaletteView,h.appendChild(this.hPaletteView_.element),i.appendChild(h),this.element.appendChild(i);const v=t.createElement("div");if(v.classList.add(St("rgb")),this.textView_=e.textView,v.appendChild(this.textView_.element),this.element.appendChild(v),e.alphaViews){this.alphaViews_={palette:e.alphaViews.palette,text:e.alphaViews.text};const y=t.createElement("div");y.classList.add(St("a"));const S=t.createElement("div");S.classList.add(St("ap")),S.appendChild(this.alphaViews_.palette.element),y.appendChild(S);const L=t.createElement("div");L.classList.add(St("at")),L.appendChild(this.alphaViews_.text.element),y.appendChild(L),this.element.appendChild(y)}}get allFocusableElements(){const t=[this.svPaletteView_.element,this.hPaletteView_.element,this.textView_.modeSelectElement,...this.textView_.textViews.map(e=>e.inputElement)];return this.alphaViews_&&t.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),t}}function wa(s){return s==="int"?"int":s==="float"?"float":void 0}function Os(s){const t=U;return G(s,{alpha:t.optional.boolean,color:t.optional.object({alpha:t.optional.boolean,type:t.optional.custom(wa)}),expanded:t.optional.boolean,picker:t.optional.custom(Ki)})}function Ht(s){return s?.1:1}function Bt(s){var t;return(t=s.color)===null||t===void 0?void 0:t.type}function ya(s,t){return s.alpha===t.alpha&&s.mode===t.mode&&s.notation===t.notation&&s.type===t.type}function dt(s,t){const e=s.match(/^(.+)%$/);return Math.min(e?parseFloat(e[1])*.01*t:parseFloat(s),t)}const xa={deg:s=>s,grad:s=>s*360/400,rad:s=>s*360/(2*Math.PI),turn:s=>s*360};function $i(s){const t=s.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!t)return parseFloat(s);const e=parseFloat(t[1]),i=t[2];return xa[i](e)}function Yi(s){const t=s.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const e=[dt(t[1],255),dt(t[2],255),dt(t[3],255)];return isNaN(e[0])||isNaN(e[1])||isNaN(e[2])?null:e}function Xi(s){return t=>{const e=Yi(t);return e?new O(e,"rgb",s):null}}function Wi(s){const t=s.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const e=[dt(t[1],255),dt(t[2],255),dt(t[3],255),dt(t[4],1)];return isNaN(e[0])||isNaN(e[1])||isNaN(e[2])||isNaN(e[3])?null:e}function Zi(s){return t=>{const e=Wi(t);return e?new O(e,"rgb",s):null}}function Qi(s){const t=s.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const e=[$i(t[1]),dt(t[2],100),dt(t[3],100)];return isNaN(e[0])||isNaN(e[1])||isNaN(e[2])?null:e}function Ji(s){return t=>{const e=Qi(t);return e?new O(e,"hsl",s):null}}function tn(s){const t=s.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const e=[$i(t[1]),dt(t[2],100),dt(t[3],100),dt(t[4],1)];return isNaN(e[0])||isNaN(e[1])||isNaN(e[2])||isNaN(e[3])?null:e}function en(s){return t=>{const e=tn(t);return e?new O(e,"hsl",s):null}}function sn(s){const t=s.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(t)return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)];const e=s.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return e?[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]:null}function Ca(s){const t=sn(s);return t?new O(t,"rgb","int"):null}function nn(s){const t=s.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(t)return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16),K(parseInt(t[4]+t[4],16),0,255,0,1)];const e=s.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return e?[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16),K(parseInt(e[4],16),0,255,0,1)]:null}function Ea(s){const t=nn(s);return t?new O(t,"rgb","int"):null}function on(s){const t=s.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!t)return null;const e=[parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3])];return isNaN(e[0])||isNaN(e[1])||isNaN(e[2])?null:e}function rn(s){return t=>{const e=on(t);return e?new O(e,"rgb",s):null}}function an(s){const t=s.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!t)return null;const e=[parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3]),parseFloat(t[4])];return isNaN(e[0])||isNaN(e[1])||isNaN(e[2])||isNaN(e[3])?null:e}function ln(s){return t=>{const e=an(t);return e?new O(e,"rgb",s):null}}const Pa=[{parser:sn,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:nn,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:Yi,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:Wi,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:Qi,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:tn,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:on,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:an,result:{alpha:!0,mode:"rgb",notation:"object"}}];function ka(s){return Pa.reduce((t,{parser:e,result:i})=>t||(e(s)?i:null),null)}function Ds(s,t="int"){const e=ka(s);return e?e.notation==="hex"&&t!=="float"?Object.assign(Object.assign({},e),{type:"int"}):e.notation==="func"?Object.assign(Object.assign({},e),{type:t}):null:null}const cn={int:[Ca,Ea,Xi("int"),Zi("int"),Ji("int"),en("int"),rn("int"),ln("int")],float:[Xi("float"),Zi("float"),Ji("float"),en("float"),rn("float"),ln("float")]};function Ta(s){const t=cn[s];return e=>typeof e!="string"?O.black(s):t.reduce((l,h)=>l||h(e),null)??O.black(s)}function Ns(s){const t=cn[s];return e=>t.reduce((i,l)=>i||l(e),null)}function pn(s){const t=$(Math.floor(s),0,255).toString(16);return t.length===1?`0${t}`:t}function dn(s,t="#"){const e=Ut(s.getComponents("rgb")).map(pn).join("");return`${t}${e}`}function js(s,t="#"){const e=s.getComponents("rgb"),i=[e[0],e[1],e[2],e[3]*255].map(pn).join("");return`${t}${i}`}function hn(s,t){const e=Z(t==="float"?2:0);return`rgb(${Ut(s.getComponents("rgb",t)).map(i=>e(i)).join(", ")})`}function Aa(s){return t=>hn(t,s)}function Ze(s,t){const e=Z(2),i=Z(t==="float"?2:0);return`rgba(${s.getComponents("rgb",t).map((l,h)=>(h===3?e:i)(l)).join(", ")})`}function La(s){return t=>Ze(t,s)}function Sa(s){const t=[Z(0),Ge,Ge];return`hsl(${Ut(s.getComponents("hsl")).map((e,i)=>t[i](e)).join(", ")})`}function Ra(s){const t=[Z(0),Ge,Ge,Z(2)];return`hsla(${s.getComponents("hsl").map((e,i)=>t[i](e)).join(", ")})`}function un(s,t){const e=Z(t==="float"?2:0),i=["r","g","b"];return`{${Ut(s.getComponents("rgb",t)).map((l,h)=>`${i[h]}: ${e(l)}`).join(", ")}}`}function Ma(s){return t=>un(t,s)}function mn(s,t){const e=Z(2),i=Z(t==="float"?2:0),l=["r","g","b","a"];return`{${s.getComponents("rgb",t).map((h,v)=>{const y=v===3?e:i;return`${l[v]}: ${y(h)}`}).join(", ")}}`}function Va(s){return t=>mn(t,s)}const Ia=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:dn},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:js},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:Sa},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:Ra},...["int","float"].reduce((s,t)=>[...s,{format:{alpha:!1,mode:"rgb",notation:"func",type:t},stringifier:Aa(t)},{format:{alpha:!0,mode:"rgb",notation:"func",type:t},stringifier:La(t)},{format:{alpha:!1,mode:"rgb",notation:"object",type:t},stringifier:Ma(t)},{format:{alpha:!0,mode:"rgb",notation:"object",type:t},stringifier:Va(t)}],[])];function Us(s){return Ia.reduce((t,e)=>t||(ya(e.format,s)?e.stringifier:null),null)}const Se=A("apl");class Oa{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add(Se()),e.viewProps.bindClassModifiers(this.element),e.viewProps.bindTabIndex(this.element);const i=t.createElement("div");i.classList.add(Se("b")),this.element.appendChild(i);const l=t.createElement("div");l.classList.add(Se("c")),i.appendChild(l),this.colorElem_=l;const h=t.createElement("div");h.classList.add(Se("m")),this.element.appendChild(h),this.markerElem_=h;const v=t.createElement("div");v.classList.add(Se("p")),this.markerElem_.appendChild(v),this.previewElem_=v,this.update_()}update_(){const t=this.value.rawValue,e=t.getComponents("rgb"),i=new O([e[0],e[1],e[2],0],"rgb"),l=new O([e[0],e[1],e[2],255],"rgb"),h=["to right",Ze(i),Ze(l)];this.colorElem_.style.background=`linear-gradient(${h.join(",")})`,this.previewElem_.style.backgroundColor=Ze(t);const v=K(e[3],0,1,0,100);this.markerElem_.style.left=`${v}%`}onValueChange_(){this.update_()}}class Da{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new Oa(t,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Nt(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;const i=t.point.x/t.bounds.width,l=this.value.rawValue,[h,v,y]=l.getComponents("hsv");this.value.setRawValue(new O([h,v,y,i],"hsv"),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){const e=nt(Ht(!0),xt(t));if(e===0)return;const i=this.value.rawValue,[l,h,v,y]=i.getComponents("hsv");this.value.setRawValue(new O([l,h,v,y+e],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(t){nt(Ht(!0),xt(t))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Jt=A("coltxt");function Na(s){const t=s.createElement("select"),e=[{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"}];return t.appendChild(e.reduce((i,l)=>{const h=s.createElement("option");return h.textContent=l.text,h.value=l.value,i.appendChild(h),i},s.createDocumentFragment())),t}class ja{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Jt()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("div");i.classList.add(Jt("m")),this.modeElem_=Na(t),this.modeElem_.classList.add(Jt("ms")),i.appendChild(this.modeSelectElement),e.viewProps.bindDisabled(this.modeElem_);const l=t.createElement("div");l.classList.add(Jt("mm")),l.appendChild(Dt(t,"dropdown")),i.appendChild(l),this.element.appendChild(i);const h=t.createElement("div");h.classList.add(Jt("w")),this.element.appendChild(h),this.textsElem_=h,this.textViews_=e.textViews,this.applyTextViews_(),H(e.colorMode,v=>{this.modeElem_.value=v})}get modeSelectElement(){return this.modeElem_}get textViews(){return this.textViews_}set textViews(t){this.textViews_=t,this.applyTextViews_()}applyTextViews_(){ve(this.textsElem_);const t=this.element.ownerDocument;this.textViews_.forEach(e=>{const i=t.createElement("div");i.classList.add(Jt("c")),i.appendChild(e.element),this.textsElem_.appendChild(i)})}}function Ua(s){return Z(s==="float"?2:0)}function Ha(s,t,e){const i=Xe(s,t)[e];return new Wt({min:0,max:i})}function Hs(s,t,e){return new Ae(s,{arrayPosition:e===0?"fst":e===3-1?"lst":"mid",baseStep:Ht(!1),parser:t.parser,props:M.fromObject({draggingScale:t.colorType==="float"?.01:1,formatter:Ua(t.colorType)}),value:q(0,{constraint:Ha(t.colorMode,t.colorType,e)}),viewProps:t.viewProps})}class Ba{constructor(t,e){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=e.colorType,this.parser_=e.parser,this.value=e.value,this.viewProps=e.viewProps,this.colorMode=q(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(t),this.view=new ja(t,{colorMode:this.colorMode,textViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view],viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(t){const e={colorMode:this.colorMode.rawValue,colorType:this.colorType_,parser:this.parser_,viewProps:this.viewProps},i=[Hs(t,e,0),Hs(t,e,1),Hs(t,e,2)];return i.forEach((l,h)=>{ke({primary:this.value,secondary:l.value,forward:v=>v.rawValue.getComponents(this.colorMode.rawValue,this.colorType_)[h],backward:(v,y)=>{const S=this.colorMode.rawValue,L=v.rawValue.getComponents(S,this.colorType_);return L[h]=y.rawValue,new O(Gi(Ut(L),L[3]),S,this.colorType_)}})}),i}onModeSelectChange_(t){const e=t.currentTarget;this.colorMode.rawValue=e.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.textViews=[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}}const Bs=A("hpl");class Ka{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add(Bs()),e.viewProps.bindClassModifiers(this.element),e.viewProps.bindTabIndex(this.element);const i=t.createElement("div");i.classList.add(Bs("c")),this.element.appendChild(i);const l=t.createElement("div");l.classList.add(Bs("m")),this.element.appendChild(l),this.markerElem_=l,this.update_()}update_(){const t=this.value.rawValue,[e]=t.getComponents("hsv");this.markerElem_.style.backgroundColor=hn(new O([e,100,100],"hsv"));const i=K(e,0,360,0,100);this.markerElem_.style.left=`${i}%`}onValueChange_(){this.update_()}}class Fa{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new Ka(t,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Nt(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;const i=K($(t.point.x,0,t.bounds.width),0,t.bounds.width,0,360),l=this.value.rawValue,[,h,v,y]=l.getComponents("hsv");this.value.setRawValue(new O([i,h,v,y],"hsv"),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){const e=nt(Ht(!1),xt(t));if(e===0)return;const i=this.value.rawValue,[l,h,v,y]=i.getComponents("hsv");this.value.setRawValue(new O([l+e,h,v,y],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(t){nt(Ht(!1),xt(t))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Ks=A("svp"),vn=64;class za{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add(Ks()),e.viewProps.bindClassModifiers(this.element),e.viewProps.bindTabIndex(this.element);const i=t.createElement("canvas");i.height=vn,i.width=vn,i.classList.add(Ks("c")),this.element.appendChild(i),this.canvasElement=i;const l=t.createElement("div");l.classList.add(Ks("m")),this.element.appendChild(l),this.markerElem_=l,this.update_()}update_(){const t=vs(this.canvasElement);if(!t)return;const e=this.value.rawValue.getComponents("hsv"),i=this.canvasElement.width,l=this.canvasElement.height,h=t.getImageData(0,0,i,l),v=h.data;for(let L=0;L<l;L++)for(let N=0;N<i;N++){const j=K(N,0,i,0,100),Kt=K(L,0,l,100,0),Ft=zi(e[0],j,Kt),ie=(L*i+N)*4;v[ie]=Ft[0],v[ie+1]=Ft[1],v[ie+2]=Ft[2],v[ie+3]=255}t.putImageData(h,0,0);const y=K(e[1],0,100,0,100);this.markerElem_.style.left=`${y}%`;const S=K(e[2],0,100,100,0);this.markerElem_.style.top=`${S}%`}onValueChange_(){this.update_()}}class Ga{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new za(t,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Nt(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;const i=K(t.point.x,0,t.bounds.width,0,100),l=K(t.point.y,0,t.bounds.height,100,0),[h,,,v]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new O([h,i,l,v],"hsv"),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){Ui(t.key)&&t.preventDefault();const[e,i,l,h]=this.value.rawValue.getComponents("hsv"),v=Ht(!1),y=nt(v,xt(t)),S=nt(v,Te(t));y===0&&S===0||this.value.setRawValue(new O([e,i+y,l+S,h],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(t){const e=Ht(!1),i=nt(e,xt(t)),l=nt(e,Te(t));i===0&&l===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class qa{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.hPaletteC_=new Fa(t,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new Ga(t,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=e.supportsAlpha?{palette:new Da(t,{value:this.value,viewProps:this.viewProps}),text:new Ae(t,{parser:yt,baseStep:.1,props:M.fromObject({draggingScale:.01,formatter:Z(2)}),value:q(0,{constraint:new Wt({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&ke({primary:this.value,secondary:this.alphaIcs_.text.value,forward:i=>i.rawValue.getComponents()[3],backward:(i,l)=>{const h=i.rawValue.getComponents();return h[3]=l.rawValue,new O(h,i.rawValue.mode)}}),this.textC_=new Ba(t,{colorType:e.colorType,parser:yt,value:this.value,viewProps:this.viewProps}),this.view=new _a(t,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:e.supportsAlpha,svPaletteView:this.svPaletteC_.view,textView:this.textC_.view,viewProps:this.viewProps})}get textController(){return this.textC_}}const Fs=A("colsw");class $a{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),e.value.emitter.on("change",this.onValueChange_),this.value=e.value,this.element=t.createElement("div"),this.element.classList.add(Fs()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("div");i.classList.add(Fs("sw")),this.element.appendChild(i),this.swatchElem_=i;const l=t.createElement("button");l.classList.add(Fs("b")),e.viewProps.bindDisabled(l),this.element.appendChild(l),this.buttonElement=l,this.update_()}update_(){const t=this.value.rawValue;this.swatchElem_.style.backgroundColor=js(t)}onValueChange_(){this.update_()}}class Ya{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.view=new $a(t,{value:this.value,viewProps:this.viewProps})}}class zs{constructor(t,e){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.foldable_=et.create(e.expanded),this.swatchC_=new Ya(t,{value:this.value,viewProps:this.viewProps});const i=this.swatchC_.view.buttonElement;i.addEventListener("blur",this.onButtonBlur_),i.addEventListener("click",this.onButtonClick_),this.textC_=new ze(t,{parser:e.parser,props:M.fromObject({formatter:e.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new ca(t,{foldable:this.foldable_,pickerLayout:e.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=e.pickerLayout==="popup"?new Si(t,{viewProps:this.viewProps}):null;const l=new qa(t,{colorType:e.colorType,supportsAlpha:e.supportsAlpha,value:this.value,viewProps:this.viewProps});l.view.allFocusableElements.forEach(h=>{h.addEventListener("blur",this.onPopupChildBlur_),h.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=l,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(l.view.element),ke({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:h=>h.rawValue,backward:(h,v)=>v.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),bs(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(t){if(!this.popC_)return;const e=this.view.element,i=t.relatedTarget;(!i||!e.contains(i))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(t){if(!this.popC_)return;const e=this.popC_.view.element,i=g(t);i&&e.contains(i)||i&&i===this.swatchC_.view.buttonElement&&!ue(e.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(t){this.popC_?t.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&t.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}}function Xa(s,t){return O.isColorObject(s)?O.fromObject(s,t):O.black(t)}function Wa(s){return Ut(s.getComponents("rgb")).reduce((t,e)=>t<<8|Math.floor(e)&255,0)}function Za(s){return s.getComponents("rgb").reduce((t,e,i)=>{const l=Math.floor(i===3?e*255:e)&255;return t<<8|l},0)>>>0}function Qa(s){return new O([s>>16&255,s>>8&255,s&255],"rgb")}function Ja(s){return new O([s>>24&255,s>>16&255,s>>8&255,K(s&255,0,255,0,1)],"rgb")}function tl(s){return typeof s!="number"?O.black():Qa(s)}function el(s){return typeof s!="number"?O.black():Ja(s)}function sl(s){const t=Us(s);return t?(e,i)=>{Le(e,t(i))}:null}function il(s){const t=s?Za:Wa;return(e,i)=>{Le(e,t(i))}}function nl(s,t,e){const i=t.toRgbaObject(e);s.writeProperty("r",i.r),s.writeProperty("g",i.g),s.writeProperty("b",i.b),s.writeProperty("a",i.a)}function ol(s,t,e){const i=t.toRgbaObject(e);s.writeProperty("r",i.r),s.writeProperty("g",i.g),s.writeProperty("b",i.b)}function rl(s,t){return(e,i)=>{s?nl(e,i,t):ol(e,i,t)}}function Gs(s){var t;return!!(s!=null&&s.alpha||!((t=s==null?void 0:s.color)===null||t===void 0)&&t.alpha)}function al(s){return s?t=>js(t,"0x"):t=>dn(t,"0x")}function ll(s){return"color"in s||"view"in s&&s.view==="color"}const cl={id:"input-color-number",type:"input",accept:(s,t)=>{if(typeof s!="number"||!ll(t))return null;const e=Os(t);return e?{initialValue:s,params:e}:null},binding:{reader:s=>Gs(s.params)?el:tl,equals:O.equals,writer:s=>il(Gs(s.params))},controller:s=>{const t=Gs(s.params),e="expanded"in s.params?s.params.expanded:void 0,i="picker"in s.params?s.params.picker:void 0;return new zs(s.document,{colorType:"int",expanded:e??!1,formatter:al(t),parser:Ns("int"),pickerLayout:i??"popup",supportsAlpha:t,value:s.value,viewProps:s.viewProps})}};function pl(s){return O.isRgbaColorObject(s)}function dl(s){return t=>Xa(t,s)}function hl(s,t){return e=>s?mn(e,t):un(e,t)}const ul={id:"input-color-object",type:"input",accept:(s,t)=>{if(!O.isColorObject(s))return null;const e=Os(t);return e?{initialValue:s,params:e}:null},binding:{reader:s=>dl(Bt(s.params)),equals:O.equals,writer:s=>rl(pl(s.initialValue),Bt(s.params))},controller:s=>{var t;const e=O.isRgbaColorObject(s.initialValue),i="expanded"in s.params?s.params.expanded:void 0,l="picker"in s.params?s.params.picker:void 0,h=(t=Bt(s.params))!==null&&t!==void 0?t:"int";return new zs(s.document,{colorType:h,expanded:i??!1,formatter:hl(e,h),parser:Ns(h),pickerLayout:l??"popup",supportsAlpha:e,value:s.value,viewProps:s.viewProps})}},ml={id:"input-color-string",type:"input",accept:(s,t)=>{if(typeof s!="string"||"view"in t&&t.view==="text")return null;const e=Ds(s,Bt(t));if(!e||!Us(e))return null;const i=Os(t);return i?{initialValue:s,params:i}:null},binding:{reader:s=>{var t;return Ta((t=Bt(s.params))!==null&&t!==void 0?t:"int")},equals:O.equals,writer:s=>{const t=Ds(s.initialValue,Bt(s.params));if(!t)throw C.shouldNeverHappen();const e=sl(t);if(!e)throw C.notBindable();return e}},controller:s=>{const t=Ds(s.initialValue,Bt(s.params));if(!t)throw C.shouldNeverHappen();const e=Us(t);if(!e)throw C.shouldNeverHappen();const i="expanded"in s.params?s.params.expanded:void 0,l="picker"in s.params?s.params.picker:void 0;return new zs(s.document,{colorType:t.type,expanded:i??!1,formatter:e,parser:Ns(t.type),pickerLayout:l??"popup",supportsAlpha:t.alpha,value:s.value,viewProps:s.viewProps})}};class Rt{constructor(t){this.components=t.components,this.asm_=t.assembly}constrain(t){const e=this.asm_.toComponents(t).map((i,l)=>{var h,v;return(v=(h=this.components[l])===null||h===void 0?void 0:h.constrain(i))!==null&&v!==void 0?v:i});return this.asm_.fromComponents(e)}}const gn=A("pndtxt");class vl{constructor(t,e){this.textViews=e.textViews,this.element=t.createElement("div"),this.element.classList.add(gn()),this.textViews.forEach(i=>{const l=t.createElement("div");l.classList.add(gn("a")),l.appendChild(i.element),this.element.appendChild(l)})}}function gl(s,t,e){return new Ae(s,{arrayPosition:e===0?"fst":e===t.axes.length-1?"lst":"mid",baseStep:t.axes[e].baseStep,parser:t.parser,props:t.axes[e].textProps,value:q(0,{constraint:t.axes[e].constraint}),viewProps:t.viewProps})}class qs{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.acs_=e.axes.map((i,l)=>gl(t,e,l)),this.acs_.forEach((i,l)=>{ke({primary:this.value,secondary:i.value,forward:h=>e.assembly.toComponents(h.rawValue)[l],backward:(h,v)=>{const y=e.assembly.toComponents(h.rawValue);return y[l]=v.rawValue,e.assembly.fromComponents(y)}})}),this.view=new vl(t,{textViews:this.acs_.map(i=>i.view)})}}function bn(s,t){return"step"in s&&!m(s.step)?new Fe(s.step,t):null}function fn(s){return!m(s.max)&&!m(s.min)?new Wt({max:s.max,min:s.min}):!m(s.max)||!m(s.min)?new Ai({max:s.max,min:s.min}):null}function bl(s){const t=wt(s,Wt);if(t)return[t.values.get("min"),t.values.get("max")];const e=wt(s,Ai);return e?[e.minValue,e.maxValue]:[void 0,void 0]}function fl(s,t){const e=[],i=bn(s,t);i&&e.push(i);const l=fn(s);l&&e.push(l);const h=Is(s.options);return h&&e.push(h),new ye(e)}const _l={id:"input-number",type:"input",accept:(s,t)=>{if(typeof s!="number")return null;const e=U,i=G(t,{format:e.optional.function,max:e.optional.number,min:e.optional.number,options:e.optional.custom(qe),step:e.optional.number});return i?{initialValue:s,params:i}:null},binding:{reader:s=>Ni,constraint:s=>fl(s.params,s.initialValue),writer:s=>Le},controller:s=>{var t;const e=s.value,i=s.constraint,l=i&&wt(i,xe);if(l)return new Ce(s.document,{props:new M({options:l.values.value("options")}),value:e,viewProps:s.viewProps});const h=(t="format"in s.params?s.params.format:void 0)!==null&&t!==void 0?t:Z($e(i,e.rawValue)),v=i&&wt(i,Wt);return v?new Vs(s.document,{baseStep:Zt(i),parser:yt,sliderProps:new M({maxValue:v.values.value("max"),minValue:v.values.value("min")}),textProps:M.fromObject({draggingScale:Qt(i,e.rawValue),formatter:h}),value:e,viewProps:s.viewProps}):new Ae(s.document,{baseStep:Zt(i),parser:yt,props:M.fromObject({draggingScale:Qt(i,e.rawValue),formatter:h}),value:e,viewProps:s.viewProps})}};class Mt{constructor(t=0,e=0){this.x=t,this.y=e}getComponents(){return[this.x,this.y]}static isObject(t){if(m(t))return!1;const e=t.x,i=t.y;return!(typeof e!="number"||typeof i!="number")}static equals(t,e){return t.x===e.x&&t.y===e.y}toObject(){return{x:this.x,y:this.y}}}const _n={toComponents:s=>s.getComponents(),fromComponents:s=>new Mt(...s)},te=A("p2d");class wl{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(te()),e.viewProps.bindClassModifiers(this.element),H(e.expanded,Q(this.element,te(void 0,"expanded")));const i=t.createElement("div");i.classList.add(te("h")),this.element.appendChild(i);const l=t.createElement("button");l.classList.add(te("b")),l.appendChild(Dt(t,"p2dpad")),e.viewProps.bindDisabled(l),i.appendChild(l),this.buttonElement=l;const h=t.createElement("div");if(h.classList.add(te("t")),i.appendChild(h),this.textElement=h,e.pickerLayout==="inline"){const v=t.createElement("div");v.classList.add(te("p")),this.element.appendChild(v),this.pickerElement=v}else this.pickerElement=null}}const Vt=A("p2dp");class yl{constructor(t,e){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.invertsY_=e.invertsY,this.maxValue_=e.maxValue,this.element=t.createElement("div"),this.element.classList.add(Vt()),e.layout==="popup"&&this.element.classList.add(Vt(void 0,"p")),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("div");i.classList.add(Vt("p")),e.viewProps.bindTabIndex(i),this.element.appendChild(i),this.padElement=i;const l=t.createElementNS(it,"svg");l.classList.add(Vt("g")),this.padElement.appendChild(l),this.svgElem_=l;const h=t.createElementNS(it,"line");h.classList.add(Vt("ax")),h.setAttributeNS(null,"x1","0"),h.setAttributeNS(null,"y1","50%"),h.setAttributeNS(null,"x2","100%"),h.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(h);const v=t.createElementNS(it,"line");v.classList.add(Vt("ax")),v.setAttributeNS(null,"x1","50%"),v.setAttributeNS(null,"y1","0"),v.setAttributeNS(null,"x2","50%"),v.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(v);const y=t.createElementNS(it,"line");y.classList.add(Vt("l")),y.setAttributeNS(null,"x1","50%"),y.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(y),this.lineElem_=y;const S=t.createElement("div");S.classList.add(Vt("m")),this.padElement.appendChild(S),this.markerElem_=S,e.value.emitter.on("change",this.onValueChange_),this.value=e.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[t,e]=this.value.rawValue.getComponents(),i=this.maxValue_,l=K(t,-i,+i,0,100),h=K(e,-i,+i,0,100),v=this.invertsY_?100-h:h;this.lineElem_.setAttributeNS(null,"x2",`${l}%`),this.lineElem_.setAttributeNS(null,"y2",`${v}%`),this.markerElem_.style.left=`${l}%`,this.markerElem_.style.top=`${v}%`}onValueChange_(){this.update_()}onFoldableChange_(){this.update_()}}function wn(s,t,e){return[nt(t[0],xt(s)),nt(t[1],Te(s))*(e?1:-1)]}class xl{constructor(t,e){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.baseSteps_=e.baseSteps,this.maxValue_=e.maxValue,this.invertsY_=e.invertsY,this.view=new yl(t,{invertsY:this.invertsY_,layout:e.layout,maxValue:this.maxValue_,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Nt(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;const i=this.maxValue_,l=K(t.point.x,0,t.bounds.width,-i,+i),h=K(this.invertsY_?t.bounds.height-t.point.y:t.point.y,0,t.bounds.height,-i,+i);this.value.setRawValue(new Mt(l,h),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onPadKeyDown_(t){Ui(t.key)&&t.preventDefault();const[e,i]=wn(t,this.baseSteps_,this.invertsY_);e===0&&i===0||this.value.setRawValue(new Mt(this.value.rawValue.x+e,this.value.rawValue.y+i),{forceEmit:!1,last:!1})}onPadKeyUp_(t){const[e,i]=wn(t,this.baseSteps_,this.invertsY_);e===0&&i===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class Cl{constructor(t,e){var i,l;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.foldable_=et.create(e.expanded),this.popC_=e.pickerLayout==="popup"?new Si(t,{viewProps:this.viewProps}):null;const h=new xl(t,{baseSteps:[e.axes[0].baseStep,e.axes[1].baseStep],invertsY:e.invertsY,layout:e.pickerLayout,maxValue:e.maxValue,value:this.value,viewProps:this.viewProps});h.view.allFocusableElements.forEach(v=>{v.addEventListener("blur",this.onPopupChildBlur_),v.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=h,this.textC_=new qs(t,{assembly:_n,axes:e.axes,parser:e.parser,value:this.value,viewProps:this.viewProps}),this.view=new wl(t,{expanded:this.foldable_.value("expanded"),pickerLayout:e.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(i=this.view.buttonElement)===null||i===void 0||i.addEventListener("blur",this.onPadButtonBlur_),(l=this.view.buttonElement)===null||l===void 0||l.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),ke({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:v=>v.rawValue,backward:(v,y)=>y.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),bs(this.foldable_,this.view.pickerElement))}onPadButtonBlur_(t){if(!this.popC_)return;const e=this.view.element,i=t.relatedTarget;(!i||!e.contains(i))&&(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(t){if(!this.popC_)return;const e=this.popC_.view.element,i=g(t);i&&e.contains(i)||i&&i===this.view.buttonElement&&!ue(e.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(t){this.popC_?t.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&t.key==="Escape"&&this.view.buttonElement.focus()}}class ee{constructor(t=0,e=0,i=0){this.x=t,this.y=e,this.z=i}getComponents(){return[this.x,this.y,this.z]}static isObject(t){if(m(t))return!1;const e=t.x,i=t.y,l=t.z;return!(typeof e!="number"||typeof i!="number"||typeof l!="number")}static equals(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const yn={toComponents:s=>s.getComponents(),fromComponents:s=>new ee(...s)};function El(s){return ee.isObject(s)?new ee(s.x,s.y,s.z):new ee}function Pl(s,t){s.writeProperty("x",t.x),s.writeProperty("y",t.y),s.writeProperty("z",t.z)}function kl(s,t){return new Rt({assembly:yn,components:[Ct("x"in s?s.x:void 0,t.x),Ct("y"in s?s.y:void 0,t.y),Ct("z"in s?s.z:void 0,t.z)]})}function $s(s,t){return{baseStep:Zt(t),constraint:t,textProps:M.fromObject({draggingScale:Qt(t,s),formatter:Z($e(t,s))})}}const Tl={id:"input-point3d",type:"input",accept:(s,t)=>{if(!ee.isObject(s))return null;const e=U,i=G(t,{x:e.optional.custom(Lt),y:e.optional.custom(Lt),z:e.optional.custom(Lt)});return i?{initialValue:s,params:i}:null},binding:{reader:s=>El,constraint:s=>kl(s.params,s.initialValue),equals:ee.equals,writer:s=>Pl},controller:s=>{const t=s.value,e=s.constraint;if(!(e instanceof Rt))throw C.shouldNeverHappen();return new qs(s.document,{assembly:yn,axes:[$s(t.rawValue.x,e.components[0]),$s(t.rawValue.y,e.components[1]),$s(t.rawValue.z,e.components[2])],parser:yt,value:t,viewProps:s.viewProps})}};class se{constructor(t=0,e=0,i=0,l=0){this.x=t,this.y=e,this.z=i,this.w=l}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(t){if(m(t))return!1;const e=t.x,i=t.y,l=t.z,h=t.w;return!(typeof e!="number"||typeof i!="number"||typeof l!="number"||typeof h!="number")}static equals(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z&&t.w===e.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const xn={toComponents:s=>s.getComponents(),fromComponents:s=>new se(...s)};function Al(s){return se.isObject(s)?new se(s.x,s.y,s.z,s.w):new se}function Ll(s,t){s.writeProperty("x",t.x),s.writeProperty("y",t.y),s.writeProperty("z",t.z),s.writeProperty("w",t.w)}function Sl(s,t){return new Rt({assembly:xn,components:[Ct("x"in s?s.x:void 0,t.x),Ct("y"in s?s.y:void 0,t.y),Ct("z"in s?s.z:void 0,t.z),Ct("w"in s?s.w:void 0,t.w)]})}function Rl(s,t){return{baseStep:Zt(t),constraint:t,textProps:M.fromObject({draggingScale:Qt(t,s),formatter:Z($e(t,s))})}}const Ml={id:"input-point4d",type:"input",accept:(s,t)=>{if(!se.isObject(s))return null;const e=U,i=G(t,{x:e.optional.custom(Lt),y:e.optional.custom(Lt),z:e.optional.custom(Lt),w:e.optional.custom(Lt)});return i?{initialValue:s,params:i}:null},binding:{reader:s=>Al,constraint:s=>Sl(s.params,s.initialValue),equals:se.equals,writer:s=>Ll},controller:s=>{const t=s.value,e=s.constraint;if(!(e instanceof Rt))throw C.shouldNeverHappen();return new qs(s.document,{assembly:xn,axes:t.rawValue.getComponents().map((i,l)=>Rl(i,e.components[l])),parser:yt,value:t,viewProps:s.viewProps})}};function Vl(s){const t=[],e=Is(s.options);return e&&t.push(e),new ye(t)}const Il={id:"input-string",type:"input",accept:(s,t)=>{if(typeof s!="string")return null;const e=G(t,{options:U.optional.custom(qe)});return e?{initialValue:s,params:e}:null},binding:{reader:s=>ji,constraint:s=>Vl(s.params),writer:s=>Le},controller:s=>{const t=s.document,e=s.value,i=s.constraint,l=i&&wt(i,xe);return l?new Ce(t,{props:new M({options:l.values.value("options")}),value:e,viewProps:s.viewProps}):new ze(t,{parser:h=>h,props:M.fromObject({formatter:Ls}),value:e,viewProps:s.viewProps})}},Re={monitor:{defaultInterval:200,defaultLineCount:3}},Cn=A("mll");class Ol{constructor(t,e){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=e.formatter,this.element=t.createElement("div"),this.element.classList.add(Cn()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("textarea");i.classList.add(Cn("i")),i.style.height=`calc(var(--bld-us) * ${e.lineCount})`,i.readOnly=!0,e.viewProps.bindDisabled(i),this.element.appendChild(i),this.textareaElem_=i,e.value.emitter.on("change",this.onValueUpdate_),this.value=e.value,this.update_()}update_(){const t=this.textareaElem_,e=t.scrollTop===t.scrollHeight-t.clientHeight,i=[];this.value.rawValue.forEach(l=>{l!==void 0&&i.push(this.formatter_(l))}),t.textContent=i.join(`
`),e&&(t.scrollTop=t.scrollHeight)}onValueUpdate_(){this.update_()}}class Ys{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.view=new Ol(t,{formatter:e.formatter,lineCount:e.lineCount,value:this.value,viewProps:this.viewProps})}}const En=A("sgl");class Dl{constructor(t,e){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=e.formatter,this.element=t.createElement("div"),this.element.classList.add(En()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("input");i.classList.add(En("i")),i.readOnly=!0,i.type="text",e.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,e.value.emitter.on("change",this.onValueUpdate_),this.value=e.value,this.update_()}update_(){const t=this.value.rawValue,e=t[t.length-1];this.inputElement.value=e!==void 0?this.formatter_(e):""}onValueUpdate_(){this.update_()}}class Xs{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.view=new Dl(t,{formatter:e.formatter,value:this.value,viewProps:this.viewProps})}}const Nl={id:"monitor-bool",type:"monitor",accept:(s,t)=>{if(typeof s!="boolean")return null;const e=G(t,{lineCount:U.optional.number});return e?{initialValue:s,params:e}:null},binding:{reader:s=>Mi},controller:s=>{var t;return s.value.rawValue.length===1?new Xs(s.document,{formatter:Vi,value:s.value,viewProps:s.viewProps}):new Ys(s.document,{formatter:Vi,lineCount:(t=s.params.lineCount)!==null&&t!==void 0?t:Re.monitor.defaultLineCount,value:s.value,viewProps:s.viewProps})}},It=A("grl");class jl{constructor(t,e){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=t.createElement("div"),this.element.classList.add(It()),e.viewProps.bindClassModifiers(this.element),this.formatter_=e.formatter,this.props_=e.props,this.cursor_=e.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const i=t.createElementNS(it,"svg");i.classList.add(It("g")),i.style.height=`calc(var(--bld-us) * ${e.lineCount})`,this.element.appendChild(i),this.svgElem_=i;const l=t.createElementNS(it,"polyline");this.svgElem_.appendChild(l),this.lineElem_=l;const h=t.createElement("div");h.classList.add(It("t"),A("tt")()),this.element.appendChild(h),this.tooltipElem_=h,e.value.emitter.on("change",this.onValueUpdate_),this.value=e.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const t=this.svgElem_.getBoundingClientRect(),e=this.value.rawValue.length-1,i=this.props_.get("minValue"),l=this.props_.get("maxValue"),h=[];this.value.rawValue.forEach((N,j)=>{if(N===void 0)return;const Kt=K(j,0,e,0,t.width),Ft=K(N,i,l,t.height,0);h.push([Kt,Ft].join(","))}),this.lineElem_.setAttributeNS(null,"points",h.join(" "));const v=this.tooltipElem_,y=this.value.rawValue[this.cursor_.rawValue];if(y===void 0){v.classList.remove(It("t","a"));return}const S=K(this.cursor_.rawValue,0,e,0,t.width),L=K(y,i,l,t.height,0);v.style.left=`${S}px`,v.style.top=`${L}px`,v.textContent=`${this.formatter_(y)}`,v.classList.contains(It("t","a"))||(v.classList.add(It("t","a"),It("t","in")),Ot(v),v.classList.remove(It("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class Ul{constructor(t,e){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props_=e.props,this.value=e.value,this.viewProps=e.viewProps,this.cursor_=q(-1),this.view=new jl(t,{cursor:this.cursor_,formatter:e.formatter,lineCount:e.lineCount,props:this.props_,value:this.value,viewProps:this.viewProps}),!ue(t))this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_);else{const i=new Nt(this.view.element);i.emitter.on("down",this.onGraphPointerDown_),i.emitter.on("move",this.onGraphPointerMove_),i.emitter.on("up",this.onGraphPointerUp_)}}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(t){const e=this.view.element.getBoundingClientRect();this.cursor_.rawValue=Math.floor(K(t.offsetX,0,e.width,0,this.value.rawValue.length))}onGraphPointerDown_(t){this.onGraphPointerMove_(t)}onGraphPointerMove_(t){if(!t.data.point){this.cursor_.rawValue=-1;return}this.cursor_.rawValue=Math.floor(K(t.data.point.x,0,t.data.bounds.width,0,this.value.rawValue.length))}onGraphPointerUp_(){this.cursor_.rawValue=-1}}function Ws(s){return"format"in s&&!m(s.format)?s.format:Z(2)}function Hl(s){var t;return s.value.rawValue.length===1?new Xs(s.document,{formatter:Ws(s.params),value:s.value,viewProps:s.viewProps}):new Ys(s.document,{formatter:Ws(s.params),lineCount:(t=s.params.lineCount)!==null&&t!==void 0?t:Re.monitor.defaultLineCount,value:s.value,viewProps:s.viewProps})}function Bl(s){var t,e,i;return new Ul(s.document,{formatter:Ws(s.params),lineCount:(t=s.params.lineCount)!==null&&t!==void 0?t:Re.monitor.defaultLineCount,props:M.fromObject({maxValue:(e="max"in s.params?s.params.max:null)!==null&&e!==void 0?e:100,minValue:(i="min"in s.params?s.params.min:null)!==null&&i!==void 0?i:0}),value:s.value,viewProps:s.viewProps})}function Pn(s){return"view"in s&&s.view==="graph"}const Kl={id:"monitor-number",type:"monitor",accept:(s,t)=>{if(typeof s!="number")return null;const e=U,i=G(t,{format:e.optional.function,lineCount:e.optional.number,max:e.optional.number,min:e.optional.number,view:e.optional.string});return i?{initialValue:s,params:i}:null},binding:{defaultBufferSize:s=>Pn(s)?64:1,reader:s=>Ni},controller:s=>Pn(s.params)?Bl(s):Hl(s)},Fl={id:"monitor-string",type:"monitor",accept:(s,t)=>{if(typeof s!="string")return null;const e=U,i=G(t,{lineCount:e.optional.number,multiline:e.optional.boolean});return i?{initialValue:s,params:i}:null},binding:{reader:s=>ji},controller:s=>{var t;const e=s.value;return e.rawValue.length>1||"multiline"in s.params&&s.params.multiline?new Ys(s.document,{formatter:Ls,lineCount:(t=s.params.lineCount)!==null&&t!==void 0?t:Re.monitor.defaultLineCount,value:e,viewProps:s.viewProps}):new Xs(s.document,{formatter:Ls,value:e,viewProps:s.viewProps})}};function zl(s,t){var e;const i=s.accept(t.target.read(),t.params);if(m(i))return null;const l=U,h={target:t.target,initialValue:i.initialValue,params:i.params},v=s.binding.reader(h),y=s.binding.constraint?s.binding.constraint(h):void 0,S=q(v(i.initialValue),{constraint:y,equals:s.binding.equals}),L=new gr({reader:v,target:t.target,value:S,writer:s.binding.writer(h)}),N=l.optional.boolean(t.params.disabled).value,j=l.optional.boolean(t.params.hidden).value,Kt=s.controller({constraint:y,document:t.document,initialValue:i.initialValue,params:i.params,value:L.value,viewProps:ct.create({disabled:N,hidden:j})});return new bt(t.document,{binding:L,blade:tt(),props:M.fromObject({label:"label"in t.params?(e=l.optional.string(t.params.label).value)!==null&&e!==void 0?e:null:t.target.key}),valueController:Kt})}function Gl(s,t){return t===0?new mr:new vr(s,t??Re.monitor.defaultInterval)}function ql(s,t){var e,i,l;const h=U,v=s.accept(t.target.read(),t.params);if(m(v))return null;const y={target:t.target,initialValue:v.initialValue,params:v.params},S=s.binding.reader(y),L=(i=(e=h.optional.number(t.params.bufferSize).value)!==null&&e!==void 0?e:s.binding.defaultBufferSize&&s.binding.defaultBufferSize(v.params))!==null&&i!==void 0?i:1,N=h.optional.number(t.params.interval).value,j=new wr({reader:S,target:t.target,ticker:Gl(t.document,N),value:br(L)}),Kt=h.optional.boolean(t.params.disabled).value,Ft=h.optional.boolean(t.params.hidden).value,ie=s.controller({document:t.document,params:v.params,value:j.value,viewProps:ct.create({disabled:Kt,hidden:Ft})});return new At(t.document,{binding:j,blade:tt(),props:M.fromObject({label:"label"in t.params?(l=h.optional.string(t.params.label).value)!==null&&l!==void 0?l:null:t.target.key}),valueController:ie})}class $l{constructor(){this.pluginsMap_={blades:[],inputs:[],monitors:[]}}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(t){t.type==="blade"?this.pluginsMap_.blades.unshift(t):t.type==="input"?this.pluginsMap_.inputs.unshift(t):t.type==="monitor"&&this.pluginsMap_.monitors.unshift(t)}createInput(t,e,i){const l=e.read();if(m(l))throw new C({context:{key:e.key},type:"nomatchingcontroller"});const h=this.pluginsMap_.inputs.reduce((v,y)=>v??zl(y,{document:t,target:e,params:i}),null);if(h)return h;throw new C({context:{key:e.key},type:"nomatchingcontroller"})}createMonitor(t,e,i){const l=this.pluginsMap_.monitors.reduce((h,v)=>h??ql(v,{document:t,params:i,target:e}),null);if(l)return l;throw new C({context:{key:e.key},type:"nomatchingcontroller"})}createBlade(t,e){const i=this.pluginsMap_.blades.reduce((l,h)=>l??ur(h,{document:t,params:e}),null);if(!i)throw new C({type:"nomatchingview",context:{params:e}});return i}createBladeApi(t){if(t instanceof bt)return new ws(t);if(t instanceof At)return new ys(t);if(t instanceof fe)return new Ke(t,this);const e=this.pluginsMap_.blades.reduce((i,l)=>i??l.api({controller:t,pool:this}),null);if(!e)throw C.shouldNeverHappen();return e}}function Yl(){const s=new $l;return[tc,Tl,Ml,Il,_l,ml,ul,cl,la,Nl,Fl,Kl,gt,rr,lr,ki].forEach(t=>{s.register(t)}),s}function Xl(s){return Mt.isObject(s)?new Mt(s.x,s.y):new Mt}function Wl(s,t){s.writeProperty("x",t.x),s.writeProperty("y",t.y)}function Ct(s,t){if(!s)return;const e=[],i=bn(s,t);i&&e.push(i);const l=fn(s);return l&&e.push(l),new ye(e)}function Zl(s,t){return new Rt({assembly:_n,components:[Ct("x"in s?s.x:void 0,t.x),Ct("y"in s?s.y:void 0,t.y)]})}function kn(s,t){const[e,i]=s?bl(s):[];if(!m(e)||!m(i))return Math.max(Math.abs(e??0),Math.abs(i??0));const l=Zt(s);return Math.max(Math.abs(l)*10,Math.abs(t)*10)}function Ql(s,t){const e=t instanceof Rt?t.components[0]:void 0,i=t instanceof Rt?t.components[1]:void 0,l=kn(e,s.x),h=kn(i,s.y);return Math.max(l,h)}function Tn(s,t){return{baseStep:Zt(t),constraint:t,textProps:M.fromObject({draggingScale:Qt(t,s),formatter:Z($e(t,s))})}}function Jl(s){if(!("y"in s))return!1;const t=s.y;return t&&"inverted"in t?!!t.inverted:!1}const tc={id:"input-point2d",type:"input",accept:(s,t)=>{if(!Mt.isObject(s))return null;const e=U,i=G(t,{expanded:e.optional.boolean,picker:e.optional.custom(Ki),x:e.optional.custom(Lt),y:e.optional.object({inverted:e.optional.boolean,max:e.optional.number,min:e.optional.number,step:e.optional.number})});return i?{initialValue:s,params:i}:null},binding:{reader:s=>Xl,constraint:s=>Zl(s.params,s.initialValue),equals:Mt.equals,writer:s=>Wl},controller:s=>{const t=s.document,e=s.value,i=s.constraint;if(!(i instanceof Rt))throw C.shouldNeverHappen();const l="expanded"in s.params?s.params.expanded:void 0,h="picker"in s.params?s.params.picker:void 0;return new Cl(t,{axes:[Tn(e.rawValue.x,i.components[0]),Tn(e.rawValue.y,i.components[1])],expanded:l??!1,invertsY:Jl(s.params),maxValue:Ql(e.rawValue,i),parser:yt,pickerLayout:h??"popup",value:e,viewProps:s.viewProps})}};class An extends a{constructor(t){super(t),this.emitter_=new P,this.controller_.valueController.value.emitter.on("change",e=>{this.emitter_.emit("change",{event:new p(this,e.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(t){this.controller_.props.set("label",t)}get options(){return this.controller_.valueController.props.get("options")}set options(t){this.controller_.valueController.props.set("options",t)}get value(){return this.controller_.valueController.value.rawValue}set value(t){this.controller_.valueController.value.rawValue=t}on(t,e){const i=e.bind(this);return this.emitter_.on(t,l=>{i(l.event)}),this}}class Ln extends a{constructor(t){super(t),this.emitter_=new P,this.controller_.valueController.value.emitter.on("change",e=>{this.emitter_.emit("change",{event:new p(this,e.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(t){this.controller_.props.set("label",t)}get maxValue(){return this.controller_.valueController.sliderController.props.get("maxValue")}set maxValue(t){this.controller_.valueController.sliderController.props.set("maxValue",t)}get minValue(){return this.controller_.valueController.sliderController.props.get("minValue")}set minValue(t){this.controller_.valueController.sliderController.props.set("minValue",t)}get value(){return this.controller_.valueController.value.rawValue}set value(t){this.controller_.valueController.value.rawValue=t}on(t,e){const i=e.bind(this);return this.emitter_.on(t,l=>{i(l.event)}),this}}class Sn extends a{constructor(t){super(t),this.emitter_=new P,this.controller_.valueController.value.emitter.on("change",e=>{this.emitter_.emit("change",{event:new p(this,e.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(t){this.controller_.props.set("label",t)}get formatter(){return this.controller_.valueController.props.get("formatter")}set formatter(t){this.controller_.valueController.props.set("formatter",t)}get value(){return this.controller_.valueController.value.rawValue}set value(t){this.controller_.valueController.value.rawValue=t}on(t,e){const i=e.bind(this);return this.emitter_.on(t,l=>{i(l.event)}),this}}const ec=function(){return{id:"list",type:"blade",accept(s){const t=U,e=G(s,{options:t.required.custom(qe),value:t.required.raw,view:t.required.constant("list"),label:t.optional.string});return e?{params:e}:null},controller(s){const t=new xe(Fi(s.params.options)),e=q(s.params.value,{constraint:t}),i=new Ce(s.document,{props:new M({options:t.values.value("options")}),value:e,viewProps:s.viewProps});return new Xt(s.document,{blade:s.blade,props:M.fromObject({label:s.params.label}),valueController:i})},api(s){return!(s.controller instanceof Xt)||!(s.controller.valueController instanceof Ce)?null:new An(s.controller)}}}();function sc(s){return s.reduce((t,e)=>Object.assign(t,{[e.presetKey]:e.read()}),{})}function ic(s,t){s.forEach(e=>{const i=t[e.target.presetKey];i!==void 0&&e.writer(e.target,e.reader(i))})}class nc extends xs{constructor(t,e){super(t,e)}get element(){return this.controller_.view.element}importPreset(t){const e=this.controller_.rackController.rack.find(bt).map(i=>i.binding);ic(e,t),this.refresh()}exportPreset(){const t=this.controller_.rackController.rack.find(bt).map(e=>e.binding.target);return sc(t)}refresh(){this.controller_.rackController.rack.find(bt).forEach(t=>{t.binding.read()}),this.controller_.rackController.rack.find(At).forEach(t=>{t.binding.read()})}}class oc extends Ps{constructor(t,e){super(t,{expanded:e.expanded,blade:e.blade,props:e.props,root:!0,viewProps:e.viewProps})}}const rc={id:"slider",type:"blade",accept(s){const t=U,e=G(s,{max:t.required.number,min:t.required.number,view:t.required.constant("slider"),format:t.optional.function,label:t.optional.string,value:t.optional.number});return e?{params:e}:null},controller(s){var t,e;const i=(t=s.params.value)!==null&&t!==void 0?t:0,l=new Wt({max:s.params.max,min:s.params.min}),h=new Vs(s.document,{baseStep:1,parser:yt,sliderProps:new M({maxValue:l.values.value("max"),minValue:l.values.value("min")}),textProps:M.fromObject({draggingScale:Qt(void 0,i),formatter:(e=s.params.format)!==null&&e!==void 0?e:Zr}),value:q(i,{constraint:l}),viewProps:s.viewProps});return new Xt(s.document,{blade:s.blade,props:M.fromObject({label:s.params.label}),valueController:h})},api(s){return!(s.controller instanceof Xt)||!(s.controller.valueController instanceof Vs)?null:new Ln(s.controller)}},ac=function(){return{id:"text",type:"blade",accept(s){const t=U,e=G(s,{parse:t.required.function,value:t.required.raw,view:t.required.constant("text"),format:t.optional.function,label:t.optional.string});return e?{params:e}:null},controller(s){var t;const e=new ze(s.document,{parser:s.params.parse,props:M.fromObject({formatter:(t=s.params.format)!==null&&t!==void 0?t:i=>String(i)}),value:q(s.params.value),viewProps:s.viewProps});return new Xt(s.document,{blade:s.blade,props:M.fromObject({label:s.params.label}),valueController:e})},api(s){return!(s.controller instanceof Xt)||!(s.controller.valueController instanceof ze)?null:new Sn(s.controller)}}}();function lc(s){const t=s.createElement("div");return t.classList.add(A("dfw")()),s.body&&s.body.appendChild(t),t}function Rn(s,t,e){if(s.querySelector(`style[data-tp-style=${t}]`))return;const i=s.createElement("style");i.dataset.tpStyle=t,i.textContent=e,s.head.appendChild(i)}class cc extends nc{constructor(t){var e,i;const l=t??{},h=(e=l.document)!==null&&e!==void 0?e:He(),v=Yl(),y=new oc(h,{expanded:l.expanded,blade:tt(),props:M.fromObject({title:l.title}),viewProps:ct.create()});super(y,v),this.pool_=v,this.containerElem_=(i=l.container)!==null&&i!==void 0?i:lc(h),this.containerElem_.appendChild(this.element),this.doc_=h,this.usesDefaultWrapper_=!l.container,this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw C.alreadyDisposed();return this.doc_}dispose(){const t=this.containerElem_;if(!t)throw C.alreadyDisposed();if(this.usesDefaultWrapper_){const e=t.parentElement;e&&e.removeChild(t)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(t){("plugin"in t?[t.plugin]:"plugins"in t?t.plugins:[]).forEach(e=>{this.pool_.register(e),this.embedPluginStyle_(e)})}embedPluginStyle_(t){t.css&&Rn(this.document,`plugin-${t.id}`,t.css)}setUpDefaultPlugins_(){Rn(this.document,"default",'.tp-tbiv_b,.tp-coltxtv_ms,.tp-ckbv_i,.tp-rotv_b,.tp-fldv_b,.tp-mllv_i,.tp-sglv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-mllv_i,.tp-sglv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--mo-fg);height:var(--bld-us);scrollbar-color:currentColor rgba(0,0,0,0);scrollbar-width:thin;width:100%}.tp-mllv_i::-webkit-scrollbar,.tp-sglv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-mllv_i::-webkit-scrollbar-corner,.tp-sglv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:rgba(0,0,0,0)}.tp-mllv_i::-webkit-scrollbar-thumb,.tp-sglv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:rgba(0,0,0,0) solid 2px;border-radius:4px}.tp-rotv{--font-family: var(--tp-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-br: var(--tp-base-border-radius, 6px);--cnt-h-p: var(--tp-container-horizontal-padding, 4px);--cnt-v-p: var(--tp-container-vertical-padding, 4px);--elm-br: var(--tp-element-border-radius, 2px);--bld-s: var(--tp-blade-spacing, 4px);--bld-us: var(--tp-blade-unit-size, 20px);--bs-bg: var(--tp-base-background-color, hsl(230, 7%, 17%));--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--btn-bg: var(--tp-button-background-color, hsl(230, 7%, 70%));--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, hsl(230, 7%, 17%));--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, hsl(230, 7%, 75%));--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, hsl(230, 7%, 75%));--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tabv_c .tp-brkv>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-v-p))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tabv_c .tp-brkv>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--bld-s)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tabv_c .tp-brkv>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tabv_c .tp-brkv>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--elm-br);border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tabv_c .tp-brkv .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-cntv+.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-cntv+.tp-fldv>.tp-fldv_b{border-top-left-radius:0}.tp-tabv_c .tp-brkv>.tp-cntv+.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-cntv+.tp-tabv>.tp-tabv_t{border-top-left-radius:0}.tp-tabv_c .tp-brkv>.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-tabv>.tp-tabv_t{border-top-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--elm-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);overflow:hidden;padding-left:var(--cnt-h-p);padding-right:calc(4px + var(--bld-us) + var(--cnt-h-p));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:"";display:block;height:6px;right:calc(var(--cnt-h-p) + (var(--bld-us) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--elm-br);cursor:pointer;display:block;height:var(--bld-us);position:relative;width:var(--bld-us)}.tp-ckbv_w svg{bottom:0;display:block;height:16px;left:0;margin:auto;opacity:0;position:absolute;right:0;top:0;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--bld-us)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-expanded.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--bld-s);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--bld-s)}.tp-colpv_rgb{display:flex;margin-top:var(--bld-s);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-v-p);padding-top:calc(var(--cnt-v-p) + 2px);position:relative}.tp-colpv_a::before{background-color:var(--grv-fg);content:"";height:2px;left:calc(-1*var(--cnt-h-p));position:absolute;right:calc(-1*var(--cnt-h-p));top:0}.tp-colpv.tp-v-disabled .tp-colpv_a::before{opacity:.5}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--elm-br);outline:none;overflow:hidden;position:relative}.tp-svpv.tp-v-disabled{opacity:.5}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--bld-us)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative}.tp-hplv.tp-v-disabled{opacity:.5}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative;width:100%}.tp-aplv.tp-v-disabled{opacity:.5}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--elm-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--elm-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;cursor:pointer;display:block;height:var(--bld-us);left:0;margin:0;outline:none;padding:0;position:absolute;top:0;width:var(--bld-us)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--elm-br);bottom:0;content:"";display:block;left:0;position:absolute;right:0;top:0}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--elm-br);color:var(--lbl-fg);cursor:pointer;height:var(--bld-us);line-height:var(--bld-us);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv.tp-v-disabled .tp-coltxtv_mm{opacity:.5}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv{position:relative}.tp-fldv.tp-fldv-not .tp-fldv_b{display:none}.tp-fldv_t{padding-left:4px}.tp-fldv_b:disabled .tp-fldv_m{display:none}.tp-fldv_c{padding-left:4px}.tp-fldv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--bld-us) + 4px);width:var(--bs-br)}.tp-fldv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-fldv_b:hover+.tp-fldv_i{color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_i{color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_i{color:var(--cnt-bg-a)}.tp-fldv.tp-v-disabled>.tp-fldv_i{opacity:.5}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--bld-us)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-h-p);padding-right:var(--cnt-h-p)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:160px}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding:0 4px}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--bld-us)*3);line-height:var(--bld-us);padding:0 4px;resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--bld-us);margin-right:4px;position:relative;width:var(--bld-us)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--bld-s);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-p2dpv{padding-left:calc(var(--bld-us) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv.tp-v-disabled .tp-p2dpv_p{opacity:.5}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:6px;box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:168px;padding:var(--cnt-v-p) var(--cnt-h-p);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sprv.tp-v-disabled .tp-sprv_r{opacity:.5}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--bld-us);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin-bottom:auto;margin-top:auto;position:absolute;right:0;top:0}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--elm-br);bottom:0;content:"";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv{position:relative}.tp-tabv_t{align-items:flex-end;color:var(--cnt-bg);display:flex;overflow:hidden;position:relative}.tp-tabv_t:hover{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus){color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active){color:var(--cnt-bg-a)}.tp-tabv_t::before{background-color:currentColor;bottom:0;content:"";height:2px;left:0;pointer-events:none;position:absolute;right:0}.tp-tabv.tp-v-disabled .tp-tabv_t::before{opacity:.5}.tp-tabv.tp-tabv-nop .tp-tabv_t{height:calc(var(--bld-us) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_t::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:0;position:absolute;right:0}.tp-tabv_c{padding-bottom:var(--cnt-v-p);padding-left:4px;padding-top:var(--cnt-v-p)}.tp-tabv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--bld-us) + 4px);width:var(--bs-br)}.tp-tabv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-tabv_t:hover+.tp-tabv_i{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus)+.tp-tabv_i{color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active)+.tp-tabv_i{color:var(--cnt-bg-a)}.tp-tabv.tp-v-disabled>.tp-tabv_i{opacity:.5}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv.tp-v-disabled::before{opacity:.5}.tp-tbiv_b{display:block;padding-left:calc(var(--cnt-h-p) + 4px);padding-right:calc(var(--cnt-h-p) + 4px);position:relative;width:100%}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_b::before{background-color:var(--cnt-bg);bottom:2px;content:"";left:0;pointer-events:none;position:absolute;right:0;top:0}.tp-tbiv_b:hover::before{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus::before{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active::before{background-color:var(--cnt-bg-a)}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);opacity:.5;overflow:hidden;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-txtv{position:relative}.tp-txtv_i{padding:0 4px}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:-3px;position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";height:calc(var(--bld-us) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--elm-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) rgba(0,0,0,0) rgba(0,0,0,0) rgba(0,0,0,0);border-style:solid;border-width:2px;box-sizing:border-box;content:"";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--font-family);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--bld-us) + var(--cnt-h-p));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0}.tp-rotv.tp-rotv-not .tp-rotv_b{display:none}.tp-rotv_b:disabled .tp-rotv_m{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_t{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}'),this.pool_.getAll().forEach(t=>{this.embedPluginStyle_(t)}),this.registerPlugin({plugins:[rc,ec,ki,ac]})}}const pc=new o("3.1.10");r.BladeApi=a,r.ButtonApi=R,r.FolderApi=xs,r.InputBindingApi=ws,r.ListApi=An,r.MonitorBindingApi=ys,r.Pane=cc,r.SeparatorApi=fi,r.SliderApi=Ln,r.TabApi=Ci,r.TabPageApi=xi,r.TextApi=Sn,r.TpChangeEvent=p,r.VERSION=pc,Object.defineProperty(r,"__esModule",{value:!0})})})(ss,ss.exports);var Zn=ss.exports;class Qn{constructor(){this.pane=new Zn.Pane}}const Jn="modulepreload",to=function(_){return"/folio_3js/"+_},ri={},eo=function(_,n,r){if(!n||n.length===0)return _();const o=document.getElementsByTagName("link");return Promise.all(n.map(a=>{if(a=to(a),a in ri)return;ri[a]=!0;const c=a.endsWith(".css"),p=c?'[rel="stylesheet"]':"";if(r)for(let u=o.length-1;u>=0;u--){const b=o[u];if(b.href===a&&(!c||b.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${a}"]${p}`))return;const d=document.createElement("link");if(d.rel=c?"stylesheet":Jn,c||(d.as="script",d.crossOrigin=""),d.href=a,document.head.appendChild(d),c)return new Promise((u,b)=>{d.addEventListener("load",u),d.addEventListener("error",()=>b(new Error(`Unable to preload CSS for ${a}`)))})})).then(()=>_()).catch(a=>{const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=a,window.dispatchEvent(c),!c.defaultPrevented)throw a})};class so{constructor(){this.app=new vt,this.scene=this.app.scene,this.meshMap=new Map,eo(()=>import("./rapier-2686a024.js").then(async n=>(await n.__tla,n)),[]).then(n=>{const r={x:0,y:-9.81,z:0};this.world=new n.World(r),this.rapier=n,this.rapierLoaded=!0,es.setState({physicsReady:!0})})}add(n,r,o){let a;switch(r){case"dynamic":a=this.rapier.RigidBodyDesc.dynamic();break;case"fixed":a=this.rapier.RigidBodyDesc.fixed();break;case"kinematic":a=this.rapier.RigidBodyDesc.kinematicPositionBased();break}this.rigidBody=this.world.createRigidBody(a);let c;switch(o){case"cuboid":const u=this.computeCuboidDimensions(n);c=this.rapier.ColliderDesc.cuboid(u.x/2,u.y/2,u.z/2),this.world.createCollider(c,this.rigidBody);break;case"ball":const b=this.computeBallDimensions(n);c=this.rapier.ColliderDesc.ball(b),this.world.createCollider(c,this.rigidBody);break;case"trimesh":const{scaledVertices:w,indices:m}=this.computeTrimeshDimensions(n);c=this.rapier.ColliderDesc.trimesh(w,m),this.world.createCollider(c,this.rigidBody);break}const p=n.getWorldPosition(new B),d=n.getWorldQuaternion(new Et);return this.rigidBody.setTranslation(p),this.rigidBody.setRotation(d),this.meshMap.set(n,this.rigidBody),this.rigidBody}computeCuboidDimensions(n){n.geometry.computeBoundingBox();const r=n.geometry.boundingBox.getSize(new B),o=n.getWorldScale(new B);return r.multiply(o),r}computeBallDimensions(n){n.geometry.computeBoundingSphere();const r=n.geometry.boundingSphere.radius,o=n.getWorldScale(new B),a=Math.max(o.x,o.y,o.z);return r*a}computeTrimeshDimensions(n){const r=n.geometry.attributes.position.array,o=n.geometry.index.array,a=n.getWorldScale(new B);return{scaledVertices:r.map((c,p)=>c*a.getComponent(p%3)),indices:o}}loop(){this.rapierLoaded&&(this.world.step(),this.meshMap.forEach((n,r)=>{const o=new B().copy(n.translation()),a=new Et().copy(n.rotation());o.applyMatrix4(new ae().copy(r.parent.matrixWorld).invert());const c=new ae().extractRotation(r.parent.matrixWorld).invert(),p=new Et().setFromRotationMatrix(c);a.premultiply(p),r.position.copy(o),r.quaternion.copy(a)}))}}const io=[{id:"avatar",path:"/models/avatar.glb",type:"model"},{id:"environment",path:"/models/environment.glb",type:"model"}],Oe=Ie(_=>({assetsToLoad:io,loadedAssets:{},addLoadedAsset:(n,r)=>_(o=>({loadedAssets:{...o.loadedAssets,[r]:n}}))}));class no{constructor(){this.app=new vt,this.scene=this.app.scene,this.physics=this.app.world.physics,this.pane=this.app.gui.pane,this.assetStore=Oe.getState(),this.environment=this.assetStore.loadedAssets.environment,this.loadEnvironment(),this.addLights()}loadEnvironment(){const n=this.environment.scene;this.scene.add(n),n.position.set(-4.8,0,-7.4),n.rotation.set(0,-.6,0),n.scale.setScalar(1.3);const r=["trees","terrain","rocks","stairs","gates","floor","bushes"],o=["trees","terrain","rocks","stairs","gates","bushes"],a=["floor","terrain"];for(const c of n.children)c.traverse(p=>{p.isMesh&&(p.castShadow=o.some(d=>c.name.includes(d)),p.receiveShadow=a.some(d=>c.name.includes(d)),r.some(d=>c.name.includes(d))&&this.physics.add(p,"fixed","cuboid"))})}addLights(){const n=new gc(16777215,.5);this.scene.add(n),this.directionalLight=new In(16777215,.5),this.directionalLight.position.set(1,1,1),this.directionalLight.castShadow=!0,this.directionalLight.shadow.camera.top=30,this.directionalLight.shadow.camera.right=30,this.directionalLight.shadow.camera.left=-30,this.directionalLight.shadow.camera.bottom=-30,this.directionalLight.shadow.bias=-.002,this.directionalLight.shadow.normalBias=.072,this.scene.add(this.directionalLight)}}class oo{constructor(){this.app=new vt,this.scene=this.app.scene,this.assetStore=Oe.getState(),this.avatar=this.assetStore.loadedAssets.avatar,this.instantiateCharacter()}instantiateCharacter(){const n=new bc(.6,2,.6),r=new Zs({color:65280,wireframe:!0,visible:!1});this.instance=new On(n,r),this.instance.position.set(0,4,0),this.scene.add(this.instance);const o=this.avatar.scene;o.rotation.y=Math.PI,o.position.y=-1,this.instance.add(o)}}class ro{constructor(){this.app=new vt,this.scene=this.app.scene,this.physics=this.app.world.physics,this.character=this.app.world.character.instance,ut.subscribe(n=>{this.forward=n.forward,this.backward=n.backward,this.left=n.left,this.right=n.right}),this.instantiateController()}instantiateController(){this.rigidBodyType=this.physics.rapier.RigidBodyDesc.kinematicPositionBased(),this.rigidBody=this.physics.world.createRigidBody(this.rigidBodyType),this.colliderType=this.physics.rapier.ColliderDesc.cuboid(.3,1,.3),this.collider=this.physics.world.createCollider(this.colliderType,this.rigidBody);const n=this.character.getWorldPosition(new B),r=this.character.getWorldQuaternion(new Et);this.rigidBody.setTranslation(n),this.rigidBody.setRotation(r),this.characterController=this.physics.world.createCharacterController(.01),this.characterController.setApplyImpulsesToDynamicBodies(!0),this.characterController.enableAutostep(1,.1,!1),this.characterController.enableSnapToGround(1)}loop(){const n=new B;if(this.forward&&(n.z-=1),this.backward&&(n.z+=1),this.left&&(n.x-=1),this.right&&(n.x+=1),n.length()!==0){const o=Math.atan2(n.x,n.z)+Math.PI,a=new Et().setFromAxisAngle(new B(0,1,0),o);this.character.quaternion.slerp(a,.1)}n.normalize().multiplyScalar(.1),n.y=-1,this.characterController.computeColliderMovement(this.collider,n);const r=new B().copy(this.rigidBody.translation()).add(this.characterController.computedMovement());this.rigidBody.setNextKinematicTranslation(r),this.character.position.lerp(this.rigidBody.translation(),.1)}}class ao{constructor(){this.app=new vt,this.scene=this.app.scene,this.avatar=this.app.world.character.avatar,ut.subscribe(n=>this.onInput(n)),this.instantiatedAnimations()}instantiatedAnimations(){this.avatar.animations[0],this.mixer=new fc(this.avatar.scene),this.animations=new Map,this.avatar.animations.forEach(n=>{this.animations.set(n.name,this.mixer.clipAction(n))}),this.currentAction=this.animations.get("Idle"),this.currentAction.play()}playAnimation(n){if(this.currentAction===this.animations.get(n))return;const r=this.animations.get(n);r.reset(),r.play(),r.crossFadeFrom(this.currentAction,.2),this.currentAction=r}onInput(n){n.forward||n.backward||n.left||n.right?this.playAnimation("Run"):this.playAnimation("Idle")}loop(n){this.mixer.update(n)}}class lo{constructor(){this.app=new vt,this.scene=this.app.scene,this.physics=new so;const n=es.subscribe(r=>{r.physicsReady&&r.assetsReady&&(this.environment=new no,this.character=new oo,this.characterController=new ro,this.animationController=new ao,n())});this.loop()}loop(n,r){this.physics.loop(),this.characterController&&this.characterController.loop(),this.animationController&&this.animationController.loop(n)}}class co{constructor(){const{setState:n}=ts;window.addEventListener("resize",()=>{n({width:window.innerWidth,height:window.innerHeight,pixelRatio:Math.min(window.devicePixelRatio,2)})})}}function ai(_,n){if(n===_c)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),_;if(n===Qs||n===Dn){let r=_.getIndex();if(r===null){const p=[],d=_.getAttribute("position");if(d!==void 0){for(let u=0;u<d.count;u++)p.push(u);_.setIndex(p),r=_.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),_}const o=r.count-2,a=[];if(n===Qs)for(let p=1;p<=o;p++)a.push(r.getX(0)),a.push(r.getX(p)),a.push(r.getX(p+1));else for(let p=0;p<o;p++)p%2===0?(a.push(r.getX(p)),a.push(r.getX(p+1)),a.push(r.getX(p+2))):(a.push(r.getX(p+2)),a.push(r.getX(p+1)),a.push(r.getX(p)));a.length/3!==o&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const c=_.clone();return c.setIndex(a),c.clearGroups(),c}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",n),_}class po extends Nn{constructor(n){super(n),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(r){return new go(r)}),this.register(function(r){return new Co(r)}),this.register(function(r){return new Eo(r)}),this.register(function(r){return new fo(r)}),this.register(function(r){return new _o(r)}),this.register(function(r){return new wo(r)}),this.register(function(r){return new yo(r)}),this.register(function(r){return new vo(r)}),this.register(function(r){return new xo(r)}),this.register(function(r){return new bo(r)}),this.register(function(r){return new uo(r)}),this.register(function(r){return new Po(r)}),this.register(function(r){return new ko(r)})}load(n,r,o,a){const c=this;let p;this.resourcePath!==""?p=this.resourcePath:this.path!==""?p=this.path:p=Js.extractUrlBase(n),this.manager.itemStart(n);const d=function(b){a?a(b):console.error(b),c.manager.itemError(n),c.manager.itemEnd(n)},u=new Qe(this.manager);u.setPath(this.path),u.setResponseType("arraybuffer"),u.setRequestHeader(this.requestHeader),u.setWithCredentials(this.withCredentials),u.load(n,function(b){try{c.parse(b,p,function(w){r(w),c.manager.itemEnd(n)},d)}catch(w){d(w)}},o,d)}setDRACOLoader(n){return this.dracoLoader=n,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(n){return this.ktx2Loader=n,this}setMeshoptDecoder(n){return this.meshoptDecoder=n,this}register(n){return this.pluginCallbacks.indexOf(n)===-1&&this.pluginCallbacks.push(n),this}unregister(n){return this.pluginCallbacks.indexOf(n)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(n),1),this}parse(n,r,o,a){let c;const p={},d={},u=new TextDecoder;if(typeof n=="string")c=JSON.parse(n);else if(n instanceof ArrayBuffer)if(u.decode(new Uint8Array(n,0,4))===li){try{p[D.KHR_BINARY_GLTF]=new To(n)}catch(w){a&&a(w);return}c=JSON.parse(p[D.KHR_BINARY_GLTF].content)}else c=JSON.parse(u.decode(n));else c=n;if(c.asset===void 0||c.asset.version[0]<2){a&&a(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const b=new Ho(c,{path:r||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});b.fileLoader.setRequestHeader(this.requestHeader);for(let w=0;w<this.pluginCallbacks.length;w++){const m=this.pluginCallbacks[w](b);d[m.name]=m,p[m.name]=!0}if(c.extensionsUsed)for(let w=0;w<c.extensionsUsed.length;++w){const m=c.extensionsUsed[w],f=c.extensionsRequired||[];switch(m){case D.KHR_MATERIALS_UNLIT:p[m]=new mo;break;case D.KHR_DRACO_MESH_COMPRESSION:p[m]=new Ao(c,this.dracoLoader);break;case D.KHR_TEXTURE_TRANSFORM:p[m]=new Lo;break;case D.KHR_MESH_QUANTIZATION:p[m]=new So;break;default:f.indexOf(m)>=0&&d[m]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+m+'".')}}b.setExtensions(p),b.setPlugins(d),b.parse(o,a)}parseAsync(n,r){const o=this;return new Promise(function(a,c){o.parse(n,r,a,c)})}}function ho(){let _={};return{get:function(n){return _[n]},add:function(n,r){_[n]=r},remove:function(n){delete _[n]},removeAll:function(){_={}}}}const D={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class uo{constructor(n){this.parser=n,this.name=D.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const n=this.parser,r=this.parser.json.nodes||[];for(let o=0,a=r.length;o<a;o++){const c=r[o];c.extensions&&c.extensions[this.name]&&c.extensions[this.name].light!==void 0&&n._addNodeRef(this.cache,c.extensions[this.name].light)}}_loadLight(n){const r=this.parser,o="light:"+n;let a=r.cache.get(o);if(a)return a;const c=r.json,p=((c.extensions&&c.extensions[this.name]||{}).lights||[])[n];let d;const u=new zt(16777215);p.color!==void 0&&u.fromArray(p.color);const b=p.range!==void 0?p.range:0;switch(p.type){case"directional":d=new In(u),d.target.position.set(0,0,-1),d.add(d.target);break;case"point":d=new yc(u),d.distance=b;break;case"spot":d=new wc(u),d.distance=b,p.spot=p.spot||{},p.spot.innerConeAngle=p.spot.innerConeAngle!==void 0?p.spot.innerConeAngle:0,p.spot.outerConeAngle=p.spot.outerConeAngle!==void 0?p.spot.outerConeAngle:Math.PI/4,d.angle=p.spot.outerConeAngle,d.penumbra=1-p.spot.innerConeAngle/p.spot.outerConeAngle,d.target.position.set(0,0,-1),d.add(d.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+p.type)}return d.position.set(0,0,0),d.decay=2,kt(d,p),p.intensity!==void 0&&(d.intensity=p.intensity),d.name=r.createUniqueName(p.name||"light_"+n),a=Promise.resolve(d),r.cache.add(o,a),a}getDependency(n,r){if(n==="light")return this._loadLight(r)}createNodeAttachment(n){const r=this,o=this.parser,a=o.json.nodes[n],c=(a.extensions&&a.extensions[this.name]||{}).light;return c===void 0?null:this._loadLight(c).then(function(p){return o._getNodeRef(r.cache,c,p)})}}class mo{constructor(){this.name=D.KHR_MATERIALS_UNLIT}getMaterialType(){return Me}extendParams(n,r,o){const a=[];n.color=new zt(1,1,1),n.opacity=1;const c=r.pbrMetallicRoughness;if(c){if(Array.isArray(c.baseColorFactor)){const p=c.baseColorFactor;n.color.fromArray(p),n.opacity=p[3]}c.baseColorTexture!==void 0&&a.push(o.assignTexture(n,"map",c.baseColorTexture,re))}return Promise.all(a)}}class vo{constructor(n){this.parser=n,this.name=D.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(n,r){const o=this.parser.json.materials[n];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const a=o.extensions[this.name].emissiveStrength;return a!==void 0&&(r.emissiveIntensity=a),Promise.resolve()}}class go{constructor(n){this.parser=n,this.name=D.KHR_MATERIALS_CLEARCOAT}getMaterialType(n){const r=this.parser.json.materials[n];return!r.extensions||!r.extensions[this.name]?null:Gt}extendMaterialParams(n,r){const o=this.parser,a=o.json.materials[n];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const c=[],p=a.extensions[this.name];if(p.clearcoatFactor!==void 0&&(r.clearcoat=p.clearcoatFactor),p.clearcoatTexture!==void 0&&c.push(o.assignTexture(r,"clearcoatMap",p.clearcoatTexture)),p.clearcoatRoughnessFactor!==void 0&&(r.clearcoatRoughness=p.clearcoatRoughnessFactor),p.clearcoatRoughnessTexture!==void 0&&c.push(o.assignTexture(r,"clearcoatRoughnessMap",p.clearcoatRoughnessTexture)),p.clearcoatNormalTexture!==void 0&&(c.push(o.assignTexture(r,"clearcoatNormalMap",p.clearcoatNormalTexture)),p.clearcoatNormalTexture.scale!==void 0)){const d=p.clearcoatNormalTexture.scale;r.clearcoatNormalScale=new ht(d,d)}return Promise.all(c)}}class bo{constructor(n){this.parser=n,this.name=D.KHR_MATERIALS_IRIDESCENCE}getMaterialType(n){const r=this.parser.json.materials[n];return!r.extensions||!r.extensions[this.name]?null:Gt}extendMaterialParams(n,r){const o=this.parser,a=o.json.materials[n];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const c=[],p=a.extensions[this.name];return p.iridescenceFactor!==void 0&&(r.iridescence=p.iridescenceFactor),p.iridescenceTexture!==void 0&&c.push(o.assignTexture(r,"iridescenceMap",p.iridescenceTexture)),p.iridescenceIor!==void 0&&(r.iridescenceIOR=p.iridescenceIor),r.iridescenceThicknessRange===void 0&&(r.iridescenceThicknessRange=[100,400]),p.iridescenceThicknessMinimum!==void 0&&(r.iridescenceThicknessRange[0]=p.iridescenceThicknessMinimum),p.iridescenceThicknessMaximum!==void 0&&(r.iridescenceThicknessRange[1]=p.iridescenceThicknessMaximum),p.iridescenceThicknessTexture!==void 0&&c.push(o.assignTexture(r,"iridescenceThicknessMap",p.iridescenceThicknessTexture)),Promise.all(c)}}class fo{constructor(n){this.parser=n,this.name=D.KHR_MATERIALS_SHEEN}getMaterialType(n){const r=this.parser.json.materials[n];return!r.extensions||!r.extensions[this.name]?null:Gt}extendMaterialParams(n,r){const o=this.parser,a=o.json.materials[n];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const c=[];r.sheenColor=new zt(0,0,0),r.sheenRoughness=0,r.sheen=1;const p=a.extensions[this.name];return p.sheenColorFactor!==void 0&&r.sheenColor.fromArray(p.sheenColorFactor),p.sheenRoughnessFactor!==void 0&&(r.sheenRoughness=p.sheenRoughnessFactor),p.sheenColorTexture!==void 0&&c.push(o.assignTexture(r,"sheenColorMap",p.sheenColorTexture,re)),p.sheenRoughnessTexture!==void 0&&c.push(o.assignTexture(r,"sheenRoughnessMap",p.sheenRoughnessTexture)),Promise.all(c)}}class _o{constructor(n){this.parser=n,this.name=D.KHR_MATERIALS_TRANSMISSION}getMaterialType(n){const r=this.parser.json.materials[n];return!r.extensions||!r.extensions[this.name]?null:Gt}extendMaterialParams(n,r){const o=this.parser,a=o.json.materials[n];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const c=[],p=a.extensions[this.name];return p.transmissionFactor!==void 0&&(r.transmission=p.transmissionFactor),p.transmissionTexture!==void 0&&c.push(o.assignTexture(r,"transmissionMap",p.transmissionTexture)),Promise.all(c)}}class wo{constructor(n){this.parser=n,this.name=D.KHR_MATERIALS_VOLUME}getMaterialType(n){const r=this.parser.json.materials[n];return!r.extensions||!r.extensions[this.name]?null:Gt}extendMaterialParams(n,r){const o=this.parser,a=o.json.materials[n];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const c=[],p=a.extensions[this.name];r.thickness=p.thicknessFactor!==void 0?p.thicknessFactor:0,p.thicknessTexture!==void 0&&c.push(o.assignTexture(r,"thicknessMap",p.thicknessTexture)),r.attenuationDistance=p.attenuationDistance||1/0;const d=p.attenuationColor||[1,1,1];return r.attenuationColor=new zt(d[0],d[1],d[2]),Promise.all(c)}}class yo{constructor(n){this.parser=n,this.name=D.KHR_MATERIALS_IOR}getMaterialType(n){const r=this.parser.json.materials[n];return!r.extensions||!r.extensions[this.name]?null:Gt}extendMaterialParams(n,r){const o=this.parser.json.materials[n];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const a=o.extensions[this.name];return r.ior=a.ior!==void 0?a.ior:1.5,Promise.resolve()}}class xo{constructor(n){this.parser=n,this.name=D.KHR_MATERIALS_SPECULAR}getMaterialType(n){const r=this.parser.json.materials[n];return!r.extensions||!r.extensions[this.name]?null:Gt}extendMaterialParams(n,r){const o=this.parser,a=o.json.materials[n];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const c=[],p=a.extensions[this.name];r.specularIntensity=p.specularFactor!==void 0?p.specularFactor:1,p.specularTexture!==void 0&&c.push(o.assignTexture(r,"specularIntensityMap",p.specularTexture));const d=p.specularColorFactor||[1,1,1];return r.specularColor=new zt(d[0],d[1],d[2]),p.specularColorTexture!==void 0&&c.push(o.assignTexture(r,"specularColorMap",p.specularColorTexture,re)),Promise.all(c)}}class Co{constructor(n){this.parser=n,this.name=D.KHR_TEXTURE_BASISU}loadTexture(n){const r=this.parser,o=r.json,a=o.textures[n];if(!a.extensions||!a.extensions[this.name])return null;const c=a.extensions[this.name],p=r.options.ktx2Loader;if(!p){if(o.extensionsRequired&&o.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return r.loadTextureImage(n,c.source,p)}}class Eo{constructor(n){this.parser=n,this.name=D.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(n){const r=this.name,o=this.parser,a=o.json,c=a.textures[n];if(!c.extensions||!c.extensions[r])return null;const p=c.extensions[r],d=a.images[p.source];let u=o.textureLoader;if(d.uri){const b=o.options.manager.getHandler(d.uri);b!==null&&(u=b)}return this.detectSupport().then(function(b){if(b)return o.loadTextureImage(n,p.source,u);if(a.extensionsRequired&&a.extensionsRequired.indexOf(r)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return o.loadTexture(n)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(n){const r=new Image;r.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",r.onload=r.onerror=function(){n(r.height===1)}})),this.isSupported}}class Po{constructor(n){this.name=D.EXT_MESHOPT_COMPRESSION,this.parser=n}loadBufferView(n){const r=this.parser.json,o=r.bufferViews[n];if(o.extensions&&o.extensions[this.name]){const a=o.extensions[this.name],c=this.parser.getDependency("buffer",a.buffer),p=this.parser.options.meshoptDecoder;if(!p||!p.supported){if(r.extensionsRequired&&r.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return c.then(function(d){const u=a.byteOffset||0,b=a.byteLength||0,w=a.count,m=a.byteStride,f=new Uint8Array(d,u,b);return p.decodeGltfBufferAsync?p.decodeGltfBufferAsync(w,m,f,a.mode,a.filter).then(function(x){return x.buffer}):p.ready.then(function(){const x=new ArrayBuffer(w*m);return p.decodeGltfBuffer(new Uint8Array(x),w,m,f,a.mode,a.filter),x})})}else return null}}class ko{constructor(n){this.name=D.EXT_MESH_GPU_INSTANCING,this.parser=n}createNodeMesh(n){const r=this.parser.json,o=r.nodes[n];if(!o.extensions||!o.extensions[this.name]||o.mesh===void 0)return null;const a=r.meshes[o.mesh];for(const u of a.primitives)if(u.mode!==lt.TRIANGLES&&u.mode!==lt.TRIANGLE_STRIP&&u.mode!==lt.TRIANGLE_FAN&&u.mode!==void 0)return null;const c=o.extensions[this.name].attributes,p=[],d={};for(const u in c)p.push(this.parser.getDependency("accessor",c[u]).then(b=>(d[u]=b,d[u])));return p.length<1?null:(p.push(this.parser.createNodeMesh(n)),Promise.all(p).then(u=>{const b=u.pop(),w=b.isGroup?b.children:[b],m=u[0].count,f=[];for(const x of w){const T=new ae,C=new B,E=new Et,R=new B(1,1,1),P=new xc(x.geometry,x.material,m);for(let I=0;I<m;I++)d.TRANSLATION&&C.fromBufferAttribute(d.TRANSLATION,I),d.ROTATION&&E.fromBufferAttribute(d.ROTATION,I),d.SCALE&&R.fromBufferAttribute(d.SCALE,I),P.setMatrixAt(I,T.compose(C,E,R));for(const I in d)I!=="TRANSLATION"&&I!=="ROTATION"&&I!=="SCALE"&&x.geometry.setAttribute(I,d[I]);jn.prototype.copy.call(P,x),P.frustumCulled=!1,this.parser.assignFinalMaterial(P),f.push(P)}return b.isGroup?(b.clear(),b.add(...f),b):f[0]}))}}const li="glTF",le=12,ci={JSON:1313821514,BIN:5130562};class To{constructor(n){this.name=D.KHR_BINARY_GLTF,this.content=null,this.body=null;const r=new DataView(n,0,le),o=new TextDecoder;if(this.header={magic:o.decode(new Uint8Array(n.slice(0,4))),version:r.getUint32(4,!0),length:r.getUint32(8,!0)},this.header.magic!==li)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const a=this.header.length-le,c=new DataView(n,le);let p=0;for(;p<a;){const d=c.getUint32(p,!0);p+=4;const u=c.getUint32(p,!0);if(p+=4,u===ci.JSON){const b=new Uint8Array(n,le+p,d);this.content=o.decode(b)}else if(u===ci.BIN){const b=le+p;this.body=n.slice(b,b+d)}p+=d}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Ao{constructor(n,r){if(!r)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=D.KHR_DRACO_MESH_COMPRESSION,this.json=n,this.dracoLoader=r,this.dracoLoader.preload()}decodePrimitive(n,r){const o=this.json,a=this.dracoLoader,c=n.extensions[this.name].bufferView,p=n.extensions[this.name].attributes,d={},u={},b={};for(const w in p){const m=ns[w]||w.toLowerCase();d[m]=p[w]}for(const w in n.attributes){const m=ns[w]||w.toLowerCase();if(p[w]!==void 0){const f=o.accessors[n.attributes[w]],x=qt[f.componentType];b[m]=x.name,u[m]=f.normalized===!0}}return r.getDependency("bufferView",c).then(function(w){return new Promise(function(m){a.decodeDracoFile(w,function(f){for(const x in f.attributes){const T=f.attributes[x],C=u[x];C!==void 0&&(T.normalized=C)}m(f)},d,b)})})}}class Lo{constructor(){this.name=D.KHR_TEXTURE_TRANSFORM}extendTexture(n,r){return r.texCoord!==void 0&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),r.offset===void 0&&r.rotation===void 0&&r.scale===void 0||(n=n.clone(),r.offset!==void 0&&n.offset.fromArray(r.offset),r.rotation!==void 0&&(n.rotation=r.rotation),r.scale!==void 0&&n.repeat.fromArray(r.scale),n.needsUpdate=!0),n}}class So{constructor(){this.name=D.KHR_MESH_QUANTIZATION}}class pi extends Qc{constructor(n,r,o,a){super(n,r,o,a)}copySampleValue_(n){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,c=n*a*3+a;for(let p=0;p!==a;p++)r[p]=o[c+p];return r}interpolate_(n,r,o,a){const c=this.resultBuffer,p=this.sampleValues,d=this.valueSize,u=d*2,b=d*3,w=a-r,m=(o-r)/w,f=m*m,x=f*m,T=n*b,C=T-b,E=-2*x+3*f,R=x-f,P=1-E,I=R-f+m;for(let A=0;A!==d;A++){const V=p[C+A+d],Y=p[C+A+u]*w,H=p[T+A+d],F=p[T+A]*w;c[A]=P*V+I*Y+E*H+R*F}return c}}const Ro=new Et;class Mo extends pi{interpolate_(n,r,o,a){const c=super.interpolate_(n,r,o,a);return Ro.fromArray(c).normalize().toArray(c),c}}const lt={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},qt={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},di={9728:Uc,9729:Hn,9984:Hc,9985:Bc,9986:Kc,9987:Bn},hi={33071:Fc,33648:zc,10497:ti},is={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ns={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Pt={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Vo={CUBICSPLINE:void 0,LINEAR:Fn,STEP:Gc},os={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function Io(_){return _.DefaultMaterial===void 0&&(_.DefaultMaterial=new Zs({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:qc})),_.DefaultMaterial}function ce(_,n,r){for(const o in r.extensions)_[o]===void 0&&(n.userData.gltfExtensions=n.userData.gltfExtensions||{},n.userData.gltfExtensions[o]=r.extensions[o])}function kt(_,n){n.extras!==void 0&&(typeof n.extras=="object"?Object.assign(_.userData,n.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+n.extras))}function Oo(_,n,r){let o=!1,a=!1,c=!1;for(let b=0,w=n.length;b<w;b++){const m=n[b];if(m.POSITION!==void 0&&(o=!0),m.NORMAL!==void 0&&(a=!0),m.COLOR_0!==void 0&&(c=!0),o&&a&&c)break}if(!o&&!a&&!c)return Promise.resolve(_);const p=[],d=[],u=[];for(let b=0,w=n.length;b<w;b++){const m=n[b];if(o){const f=m.POSITION!==void 0?r.getDependency("accessor",m.POSITION):_.attributes.position;p.push(f)}if(a){const f=m.NORMAL!==void 0?r.getDependency("accessor",m.NORMAL):_.attributes.normal;d.push(f)}if(c){const f=m.COLOR_0!==void 0?r.getDependency("accessor",m.COLOR_0):_.attributes.color;u.push(f)}}return Promise.all([Promise.all(p),Promise.all(d),Promise.all(u)]).then(function(b){const w=b[0],m=b[1],f=b[2];return o&&(_.morphAttributes.position=w),a&&(_.morphAttributes.normal=m),c&&(_.morphAttributes.color=f),_.morphTargetsRelative=!0,_})}function Do(_,n){if(_.updateMorphTargets(),n.weights!==void 0)for(let r=0,o=n.weights.length;r<o;r++)_.morphTargetInfluences[r]=n.weights[r];if(n.extras&&Array.isArray(n.extras.targetNames)){const r=n.extras.targetNames;if(_.morphTargetInfluences.length===r.length){_.morphTargetDictionary={};for(let o=0,a=r.length;o<a;o++)_.morphTargetDictionary[r[o]]=o}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function No(_){const n=_.extensions&&_.extensions[D.KHR_DRACO_MESH_COMPRESSION];let r;return n?r="draco:"+n.bufferView+":"+n.indices+":"+ui(n.attributes):r=_.indices+":"+ui(_.attributes)+":"+_.mode,r}function ui(_){let n="";const r=Object.keys(_).sort();for(let o=0,a=r.length;o<a;o++)n+=r[o]+":"+_[r[o]]+";";return n}function rs(_){switch(_){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function jo(_){return _.search(/\.jpe?g($|\?)/i)>0||_.search(/^data\:image\/jpeg/)===0?"image/jpeg":_.search(/\.webp($|\?)/i)>0||_.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const Uo=new ae;class Ho{constructor(n={},r={}){this.json=n,this.extensions={},this.plugins={},this.options=r,this.cache=new ho,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let o=!1,a=!1,c=-1;typeof navigator<"u"&&(o=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,a=navigator.userAgent.indexOf("Firefox")>-1,c=a?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||o||a&&c<98?this.textureLoader=new Un(this.options.manager):this.textureLoader=new Cc(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Qe(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(n){this.extensions=n}setPlugins(n){this.plugins=n}parse(n,r){const o=this,a=this.json,c=this.extensions;this.cache.removeAll(),this._invokeAll(function(p){return p._markDefs&&p._markDefs()}),Promise.all(this._invokeAll(function(p){return p.beforeRoot&&p.beforeRoot()})).then(function(){return Promise.all([o.getDependencies("scene"),o.getDependencies("animation"),o.getDependencies("camera")])}).then(function(p){const d={scene:p[0][a.scene||0],scenes:p[0],animations:p[1],cameras:p[2],asset:a.asset,parser:o,userData:{}};ce(c,d,a),kt(d,a),Promise.all(o._invokeAll(function(u){return u.afterRoot&&u.afterRoot(d)})).then(function(){n(d)})}).catch(r)}_markDefs(){const n=this.json.nodes||[],r=this.json.skins||[],o=this.json.meshes||[];for(let a=0,c=r.length;a<c;a++){const p=r[a].joints;for(let d=0,u=p.length;d<u;d++)n[p[d]].isBone=!0}for(let a=0,c=n.length;a<c;a++){const p=n[a];p.mesh!==void 0&&(this._addNodeRef(this.meshCache,p.mesh),p.skin!==void 0&&(o[p.mesh].isSkinnedMesh=!0)),p.camera!==void 0&&this._addNodeRef(this.cameraCache,p.camera)}}_addNodeRef(n,r){r!==void 0&&(n.refs[r]===void 0&&(n.refs[r]=n.uses[r]=0),n.refs[r]++)}_getNodeRef(n,r,o){if(n.refs[r]<=1)return o;const a=o.clone(),c=(p,d)=>{const u=this.associations.get(p);u!=null&&this.associations.set(d,u);for(const[b,w]of p.children.entries())c(w,d.children[b])};return c(o,a),a.name+="_instance_"+n.uses[r]++,a}_invokeOne(n){const r=Object.values(this.plugins);r.push(this);for(let o=0;o<r.length;o++){const a=n(r[o]);if(a)return a}return null}_invokeAll(n){const r=Object.values(this.plugins);r.unshift(this);const o=[];for(let a=0;a<r.length;a++){const c=n(r[a]);c&&o.push(c)}return o}getDependency(n,r){const o=n+":"+r;let a=this.cache.get(o);if(!a){switch(n){case"scene":a=this.loadScene(r);break;case"node":a=this._invokeOne(function(c){return c.loadNode&&c.loadNode(r)});break;case"mesh":a=this._invokeOne(function(c){return c.loadMesh&&c.loadMesh(r)});break;case"accessor":a=this.loadAccessor(r);break;case"bufferView":a=this._invokeOne(function(c){return c.loadBufferView&&c.loadBufferView(r)});break;case"buffer":a=this.loadBuffer(r);break;case"material":a=this._invokeOne(function(c){return c.loadMaterial&&c.loadMaterial(r)});break;case"texture":a=this._invokeOne(function(c){return c.loadTexture&&c.loadTexture(r)});break;case"skin":a=this.loadSkin(r);break;case"animation":a=this._invokeOne(function(c){return c.loadAnimation&&c.loadAnimation(r)});break;case"camera":a=this.loadCamera(r);break;default:if(a=this._invokeOne(function(c){return c!=this&&c.getDependency&&c.getDependency(n,r)}),!a)throw new Error("Unknown type: "+n);break}this.cache.add(o,a)}return a}getDependencies(n){let r=this.cache.get(n);if(!r){const o=this,a=this.json[n+(n==="mesh"?"es":"s")]||[];r=Promise.all(a.map(function(c,p){return o.getDependency(n,p)})),this.cache.add(n,r)}return r}loadBuffer(n){const r=this.json.buffers[n],o=this.fileLoader;if(r.type&&r.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+r.type+" buffer type is not supported.");if(r.uri===void 0&&n===0)return Promise.resolve(this.extensions[D.KHR_BINARY_GLTF].body);const a=this.options;return new Promise(function(c,p){o.load(Js.resolveURL(r.uri,a.path),c,void 0,function(){p(new Error('THREE.GLTFLoader: Failed to load buffer "'+r.uri+'".'))})})}loadBufferView(n){const r=this.json.bufferViews[n];return this.getDependency("buffer",r.buffer).then(function(o){const a=r.byteLength||0,c=r.byteOffset||0;return o.slice(c,c+a)})}loadAccessor(n){const r=this,o=this.json,a=this.json.accessors[n];if(a.bufferView===void 0&&a.sparse===void 0){const p=is[a.type],d=qt[a.componentType],u=a.normalized===!0,b=new d(a.count*p);return Promise.resolve(new Ve(b,p,u))}const c=[];return a.bufferView!==void 0?c.push(this.getDependency("bufferView",a.bufferView)):c.push(null),a.sparse!==void 0&&(c.push(this.getDependency("bufferView",a.sparse.indices.bufferView)),c.push(this.getDependency("bufferView",a.sparse.values.bufferView))),Promise.all(c).then(function(p){const d=p[0],u=is[a.type],b=qt[a.componentType],w=b.BYTES_PER_ELEMENT,m=w*u,f=a.byteOffset||0,x=a.bufferView!==void 0?o.bufferViews[a.bufferView].byteStride:void 0,T=a.normalized===!0;let C,E;if(x&&x!==m){const R=Math.floor(f/x),P="InterleavedBuffer:"+a.bufferView+":"+a.componentType+":"+R+":"+a.count;let I=r.cache.get(P);I||(C=new b(d,R*x,a.count*x/w),I=new Ec(C,x/w),r.cache.add(P,I)),E=new $c(I,u,f%x/w,T)}else d===null?C=new b(a.count*u):C=new b(d,f,a.count*u),E=new Ve(C,u,T);if(a.sparse!==void 0){const R=is.SCALAR,P=qt[a.sparse.indices.componentType],I=a.sparse.indices.byteOffset||0,A=a.sparse.values.byteOffset||0,V=new P(p[1],I,a.sparse.count*R),Y=new b(p[2],A,a.sparse.count*u);d!==null&&(E=new Ve(E.array.slice(),E.itemSize,E.normalized));for(let H=0,F=V.length;H<F;H++){const st=V[H];if(E.setX(st,Y[H*u]),u>=2&&E.setY(st,Y[H*u+1]),u>=3&&E.setZ(st,Y[H*u+2]),u>=4&&E.setW(st,Y[H*u+3]),u>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return E})}loadTexture(n){const r=this.json,o=this.options,a=r.textures[n].source,c=r.images[a];let p=this.textureLoader;if(c.uri){const d=o.manager.getHandler(c.uri);d!==null&&(p=d)}return this.loadTextureImage(n,a,p)}loadTextureImage(n,r,o){const a=this,c=this.json,p=c.textures[n],d=c.images[r],u=(d.uri||d.bufferView)+":"+p.sampler;if(this.textureCache[u])return this.textureCache[u];const b=this.loadImageSource(r,o).then(function(w){w.flipY=!1,w.name=p.name||d.name||"";const m=(c.samplers||{})[p.sampler]||{};return w.magFilter=di[m.magFilter]||Hn,w.minFilter=di[m.minFilter]||Bn,w.wrapS=hi[m.wrapS]||ti,w.wrapT=hi[m.wrapT]||ti,a.associations.set(w,{textures:n}),w}).catch(function(){return null});return this.textureCache[u]=b,b}loadImageSource(n,r){const o=this,a=this.json,c=this.options;if(this.sourceCache[n]!==void 0)return this.sourceCache[n].then(m=>m.clone());const p=a.images[n],d=self.URL||self.webkitURL;let u=p.uri||"",b=!1;if(p.bufferView!==void 0)u=o.getDependency("bufferView",p.bufferView).then(function(m){b=!0;const f=new Blob([m],{type:p.mimeType});return u=d.createObjectURL(f),u});else if(p.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+n+" is missing URI and bufferView");const w=Promise.resolve(u).then(function(m){return new Promise(function(f,x){let T=f;r.isImageBitmapLoader===!0&&(T=function(C){const E=new zn(C);E.needsUpdate=!0,f(E)}),r.load(Js.resolveURL(m,c.path),T,void 0,x)})}).then(function(m){return b===!0&&d.revokeObjectURL(u),m.userData.mimeType=p.mimeType||jo(p.uri),m}).catch(function(m){throw console.error("THREE.GLTFLoader: Couldn't load texture",u),m});return this.sourceCache[n]=w,w}assignTexture(n,r,o,a){const c=this;return this.getDependency("texture",o.index).then(function(p){if(!p)return null;if(o.texCoord!==void 0&&o.texCoord!=0&&!(r==="aoMap"&&o.texCoord==1)&&console.warn("THREE.GLTFLoader: Custom UV set "+o.texCoord+" for texture "+r+" not yet supported."),c.extensions[D.KHR_TEXTURE_TRANSFORM]){const d=o.extensions!==void 0?o.extensions[D.KHR_TEXTURE_TRANSFORM]:void 0;if(d){const u=c.associations.get(p);p=c.extensions[D.KHR_TEXTURE_TRANSFORM].extendTexture(p,d),c.associations.set(p,u)}}return a!==void 0&&(p.encoding=a),n[r]=p,p})}assignFinalMaterial(n){const r=n.geometry;let o=n.material;const a=r.attributes.tangent===void 0,c=r.attributes.color!==void 0,p=r.attributes.normal===void 0;if(n.isPoints){const d="PointsMaterial:"+o.uuid;let u=this.cache.get(d);u||(u=new Pc,ei.prototype.copy.call(u,o),u.color.copy(o.color),u.map=o.map,u.sizeAttenuation=!1,this.cache.add(d,u)),o=u}else if(n.isLine){const d="LineBasicMaterial:"+o.uuid;let u=this.cache.get(d);u||(u=new kc,ei.prototype.copy.call(u,o),u.color.copy(o.color),this.cache.add(d,u)),o=u}if(a||c||p){let d="ClonedMaterial:"+o.uuid+":";a&&(d+="derivative-tangents:"),c&&(d+="vertex-colors:"),p&&(d+="flat-shading:");let u=this.cache.get(d);u||(u=o.clone(),c&&(u.vertexColors=!0),p&&(u.flatShading=!0),a&&(u.normalScale&&(u.normalScale.y*=-1),u.clearcoatNormalScale&&(u.clearcoatNormalScale.y*=-1)),this.cache.add(d,u),this.associations.set(u,this.associations.get(o))),o=u}o.aoMap&&r.attributes.uv2===void 0&&r.attributes.uv!==void 0&&r.setAttribute("uv2",r.attributes.uv),n.material=o}getMaterialType(){return Zs}loadMaterial(n){const r=this,o=this.json,a=this.extensions,c=o.materials[n];let p;const d={},u=c.extensions||{},b=[];if(u[D.KHR_MATERIALS_UNLIT]){const m=a[D.KHR_MATERIALS_UNLIT];p=m.getMaterialType(),b.push(m.extendParams(d,c,r))}else{const m=c.pbrMetallicRoughness||{};if(d.color=new zt(1,1,1),d.opacity=1,Array.isArray(m.baseColorFactor)){const f=m.baseColorFactor;d.color.fromArray(f),d.opacity=f[3]}m.baseColorTexture!==void 0&&b.push(r.assignTexture(d,"map",m.baseColorTexture,re)),d.metalness=m.metallicFactor!==void 0?m.metallicFactor:1,d.roughness=m.roughnessFactor!==void 0?m.roughnessFactor:1,m.metallicRoughnessTexture!==void 0&&(b.push(r.assignTexture(d,"metalnessMap",m.metallicRoughnessTexture)),b.push(r.assignTexture(d,"roughnessMap",m.metallicRoughnessTexture))),p=this._invokeOne(function(f){return f.getMaterialType&&f.getMaterialType(n)}),b.push(Promise.all(this._invokeAll(function(f){return f.extendMaterialParams&&f.extendMaterialParams(n,d)})))}c.doubleSided===!0&&(d.side=Tc);const w=c.alphaMode||os.OPAQUE;if(w===os.BLEND?(d.transparent=!0,d.depthWrite=!1):(d.transparent=!1,w===os.MASK&&(d.alphaTest=c.alphaCutoff!==void 0?c.alphaCutoff:.5)),c.normalTexture!==void 0&&p!==Me&&(b.push(r.assignTexture(d,"normalMap",c.normalTexture)),d.normalScale=new ht(1,1),c.normalTexture.scale!==void 0)){const m=c.normalTexture.scale;d.normalScale.set(m,m)}return c.occlusionTexture!==void 0&&p!==Me&&(b.push(r.assignTexture(d,"aoMap",c.occlusionTexture)),c.occlusionTexture.strength!==void 0&&(d.aoMapIntensity=c.occlusionTexture.strength)),c.emissiveFactor!==void 0&&p!==Me&&(d.emissive=new zt().fromArray(c.emissiveFactor)),c.emissiveTexture!==void 0&&p!==Me&&b.push(r.assignTexture(d,"emissiveMap",c.emissiveTexture,re)),Promise.all(b).then(function(){const m=new p(d);return c.name&&(m.name=c.name),kt(m,c),r.associations.set(m,{materials:n}),c.extensions&&ce(a,m,c),m})}createUniqueName(n){const r=Ac.sanitizeNodeName(n||"");let o=r;for(let a=1;this.nodeNamesUsed[o];++a)o=r+"_"+a;return this.nodeNamesUsed[o]=!0,o}loadGeometries(n){const r=this,o=this.extensions,a=this.primitiveCache;function c(d){return o[D.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(d,r).then(function(u){return mi(u,d,r)})}const p=[];for(let d=0,u=n.length;d<u;d++){const b=n[d],w=No(b),m=a[w];if(m)p.push(m.promise);else{let f;b.extensions&&b.extensions[D.KHR_DRACO_MESH_COMPRESSION]?f=c(b):f=mi(new Kn,b,r),a[w]={primitive:b,promise:f},p.push(f)}}return Promise.all(p)}loadMesh(n){const r=this,o=this.json,a=this.extensions,c=o.meshes[n],p=c.primitives,d=[];for(let u=0,b=p.length;u<b;u++){const w=p[u].material===void 0?Io(this.cache):this.getDependency("material",p[u].material);d.push(w)}return d.push(r.loadGeometries(p)),Promise.all(d).then(function(u){const b=u.slice(0,u.length-1),w=u[u.length-1],m=[];for(let x=0,T=w.length;x<T;x++){const C=w[x],E=p[x];let R;const P=b[x];if(E.mode===lt.TRIANGLES||E.mode===lt.TRIANGLE_STRIP||E.mode===lt.TRIANGLE_FAN||E.mode===void 0)R=c.isSkinnedMesh===!0?new Lc(C,P):new On(C,P),R.isSkinnedMesh===!0&&!R.geometry.attributes.skinWeight.normalized&&R.normalizeSkinWeights(),E.mode===lt.TRIANGLE_STRIP?R.geometry=ai(R.geometry,Dn):E.mode===lt.TRIANGLE_FAN&&(R.geometry=ai(R.geometry,Qs));else if(E.mode===lt.LINES)R=new Sc(C,P);else if(E.mode===lt.LINE_STRIP)R=new Rc(C,P);else if(E.mode===lt.LINE_LOOP)R=new Mc(C,P);else if(E.mode===lt.POINTS)R=new Vc(C,P);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+E.mode);Object.keys(R.geometry.morphAttributes).length>0&&Do(R,c),R.name=r.createUniqueName(c.name||"mesh_"+n),kt(R,c),E.extensions&&ce(a,R,E),r.assignFinalMaterial(R),m.push(R)}for(let x=0,T=m.length;x<T;x++)r.associations.set(m[x],{meshes:n,primitives:x});if(m.length===1)return m[0];const f=new si;r.associations.set(f,{meshes:n});for(let x=0,T=m.length;x<T;x++)f.add(m[x]);return f})}loadCamera(n){let r;const o=this.json.cameras[n],a=o[o.type];if(!a){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return o.type==="perspective"?r=new Vn(Ic.radToDeg(a.yfov),a.aspectRatio||1,a.znear||1,a.zfar||2e6):o.type==="orthographic"&&(r=new Oc(-a.xmag,a.xmag,a.ymag,-a.ymag,a.znear,a.zfar)),o.name&&(r.name=this.createUniqueName(o.name)),kt(r,o),Promise.resolve(r)}loadSkin(n){const r=this.json.skins[n],o=[];for(let a=0,c=r.joints.length;a<c;a++)o.push(this.getDependency("node",r.joints[a]));return r.inverseBindMatrices!==void 0?o.push(this.getDependency("accessor",r.inverseBindMatrices)):o.push(null),Promise.all(o).then(function(a){const c=a.pop(),p=a,d=[],u=[];for(let b=0,w=p.length;b<w;b++){const m=p[b];if(m){d.push(m);const f=new ae;c!==null&&f.fromArray(c.array,b*16),u.push(f)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',r.joints[b])}return new Dc(d,u)})}loadAnimation(n){const r=this.json.animations[n],o=[],a=[],c=[],p=[],d=[];for(let u=0,b=r.channels.length;u<b;u++){const w=r.channels[u],m=r.samplers[w.sampler],f=w.target,x=f.node,T=r.parameters!==void 0?r.parameters[m.input]:m.input,C=r.parameters!==void 0?r.parameters[m.output]:m.output;o.push(this.getDependency("node",x)),a.push(this.getDependency("accessor",T)),c.push(this.getDependency("accessor",C)),p.push(m),d.push(f)}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(c),Promise.all(p),Promise.all(d)]).then(function(u){const b=u[0],w=u[1],m=u[2],f=u[3],x=u[4],T=[];for(let E=0,R=b.length;E<R;E++){const P=b[E],I=w[E],A=m[E],V=f[E],Y=x[E];if(P===void 0)continue;P.updateMatrix();let H;switch(Pt[Y.path]){case Pt.weights:H=Xc;break;case Pt.rotation:H=Gn;break;case Pt.position:case Pt.scale:default:H=Yc;break}const F=P.name?P.name:P.uuid,st=V.interpolation!==void 0?Vo[V.interpolation]:Fn,Q=[];Pt[Y.path]===Pt.weights?P.traverse(function(X){X.morphTargetInfluences&&Q.push(X.name?X.name:X.uuid)}):Q.push(F);let ot=A.array;if(A.normalized){const X=rs(ot.constructor),rt=new Float32Array(ot.length);for(let J=0,Tt=ot.length;J<Tt;J++)rt[J]=ot[J]*X;ot=rt}for(let X=0,rt=Q.length;X<rt;X++){const J=new H(Q[X]+"."+Pt[Y.path],I.array,ot,st);V.interpolation==="CUBICSPLINE"&&(J.createInterpolant=function(Tt){const $t=this instanceof Gn?Mo:pi;return new $t(this.times,this.values,this.getValueSize()/3,Tt)},J.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),T.push(J)}}const C=r.name?r.name:"animation_"+n;return new Nc(C,void 0,T)})}createNodeMesh(n){const r=this.json,o=this,a=r.nodes[n];return a.mesh===void 0?null:o.getDependency("mesh",a.mesh).then(function(c){const p=o._getNodeRef(o.meshCache,a.mesh,c);return a.weights!==void 0&&p.traverse(function(d){if(d.isMesh)for(let u=0,b=a.weights.length;u<b;u++)d.morphTargetInfluences[u]=a.weights[u]}),p})}loadNode(n){const r=this.json,o=this.extensions,a=this,c=r.nodes[n],p=c.name?a.createUniqueName(c.name):"";return function(){const d=[],u=a._invokeOne(function(f){return f.createNodeMesh&&f.createNodeMesh(n)});u&&d.push(u),c.camera!==void 0&&d.push(a.getDependency("camera",c.camera).then(function(f){return a._getNodeRef(a.cameraCache,c.camera,f)})),a._invokeAll(function(f){return f.createNodeAttachment&&f.createNodeAttachment(n)}).forEach(function(f){d.push(f)});const b=[],w=c.children||[];for(let f=0,x=w.length;f<x;f++)b.push(a.getDependency("node",w[f]));const m=c.skin===void 0?Promise.resolve(null):a.getDependency("skin",c.skin);return Promise.all([Promise.all(d),Promise.all(b),m])}().then(function(d){const u=d[0],b=d[1],w=d[2];let m;if(c.isBone===!0?m=new jc:u.length>1?m=new si:u.length===1?m=u[0]:m=new jn,m!==u[0])for(let f=0,x=u.length;f<x;f++)m.add(u[f]);if(c.name&&(m.userData.name=c.name,m.name=p),kt(m,c),c.extensions&&ce(o,m,c),c.matrix!==void 0){const f=new ae;f.fromArray(c.matrix),m.applyMatrix4(f)}else c.translation!==void 0&&m.position.fromArray(c.translation),c.rotation!==void 0&&m.quaternion.fromArray(c.rotation),c.scale!==void 0&&m.scale.fromArray(c.scale);a.associations.has(m)||a.associations.set(m,{}),a.associations.get(m).nodes=n,w!==null&&m.traverse(function(f){f.isSkinnedMesh&&f.bind(w,Uo)});for(let f=0,x=b.length;f<x;f++)m.add(b[f]);return m})}loadScene(n){const r=this.extensions,o=this.json.scenes[n],a=this,c=new si;o.name&&(c.name=a.createUniqueName(o.name)),kt(c,o),o.extensions&&ce(r,c,o);const p=o.nodes||[],d=[];for(let u=0,b=p.length;u<b;u++)d.push(a.getDependency("node",p[u]));return Promise.all(d).then(function(u){for(let w=0,m=u.length;w<m;w++)c.add(u[w]);const b=w=>{const m=new Map;for(const[f,x]of a.associations)(f instanceof ei||f instanceof zn)&&m.set(f,x);return w.traverse(f=>{const x=a.associations.get(f);x!=null&&m.set(f,x)}),m};return a.associations=b(c),c})}}function Bo(_,n,r){const o=n.attributes,a=new Wc;if(o.POSITION!==void 0){const d=r.json.accessors[o.POSITION],u=d.min,b=d.max;if(u!==void 0&&b!==void 0){if(a.set(new B(u[0],u[1],u[2]),new B(b[0],b[1],b[2])),d.normalized){const w=rs(qt[d.componentType]);a.min.multiplyScalar(w),a.max.multiplyScalar(w)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const c=n.targets;if(c!==void 0){const d=new B,u=new B;for(let b=0,w=c.length;b<w;b++){const m=c[b];if(m.POSITION!==void 0){const f=r.json.accessors[m.POSITION],x=f.min,T=f.max;if(x!==void 0&&T!==void 0){if(u.setX(Math.max(Math.abs(x[0]),Math.abs(T[0]))),u.setY(Math.max(Math.abs(x[1]),Math.abs(T[1]))),u.setZ(Math.max(Math.abs(x[2]),Math.abs(T[2]))),f.normalized){const C=rs(qt[f.componentType]);u.multiplyScalar(C)}d.max(u)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}a.expandByVector(d)}_.boundingBox=a;const p=new Zc;a.getCenter(p.center),p.radius=a.min.distanceTo(a.max)/2,_.boundingSphere=p}function mi(_,n,r){const o=n.attributes,a=[];function c(p,d){return r.getDependency("accessor",p).then(function(u){_.setAttribute(d,u)})}for(const p in o){const d=ns[p]||p.toLowerCase();d in _.attributes||a.push(c(o[p],d))}if(n.indices!==void 0&&!_.index){const p=r.getDependency("accessor",n.indices).then(function(d){_.setIndex(d)});a.push(p)}return kt(_,n),Bo(_,n,r),Promise.all(a).then(function(){return n.targets!==void 0?Oo(_,n.targets,r):_})}const as=new WeakMap;class Ko extends Nn{constructor(n){super(n),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(n){return this.decoderPath=n,this}setDecoderConfig(n){return this.decoderConfig=n,this}setWorkerLimit(n){return this.workerLimit=n,this}load(n,r,o,a){const c=new Qe(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(n,p=>{this.decodeDracoFile(p,r).catch(a)},o,a)}decodeDracoFile(n,r,o,a){const c={attributeIDs:o||this.defaultAttributeIDs,attributeTypes:a||this.defaultAttributeTypes,useUniqueIDs:!!o};return this.decodeGeometry(n,c).then(r)}decodeGeometry(n,r){const o=JSON.stringify(r);if(as.has(n)){const u=as.get(n);if(u.key===o)return u.promise;if(n.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let a;const c=this.workerNextTaskID++,p=n.byteLength,d=this._getWorker(c,p).then(u=>(a=u,new Promise((b,w)=>{a._callbacks[c]={resolve:b,reject:w},a.postMessage({type:"decode",id:c,taskConfig:r,buffer:n},[n])}))).then(u=>this._createGeometry(u.geometry));return d.catch(()=>!0).then(()=>{a&&c&&this._releaseTask(a,c)}),as.set(n,{key:o,promise:d}),d}_createGeometry(n){const r=new Kn;n.index&&r.setIndex(new Ve(n.index.array,1));for(let o=0;o<n.attributes.length;o++){const a=n.attributes[o],c=a.name,p=a.array,d=a.itemSize;r.setAttribute(c,new Ve(p,d))}return r}_loadLibrary(n,r){const o=new Qe(this.manager);return o.setPath(this.decoderPath),o.setResponseType(r),o.setWithCredentials(this.withCredentials),new Promise((a,c)=>{o.load(n,a,void 0,c)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const n=typeof WebAssembly!="object"||this.decoderConfig.type==="js",r=[];return n?r.push(this._loadLibrary("draco_decoder.js","text")):(r.push(this._loadLibrary("draco_wasm_wrapper.js","text")),r.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(r).then(o=>{const a=o[0];n||(this.decoderConfig.wasmBinary=o[1]);const c=Fo.toString(),p=["/* draco decoder */",a,"","/* worker */",c.substring(c.indexOf("{")+1,c.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([p]))}),this.decoderPending}_getWorker(n,r){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const a=new Worker(this.workerSourceURL);a._callbacks={},a._taskCosts={},a._taskLoad=0,a.postMessage({type:"init",decoderConfig:this.decoderConfig}),a.onmessage=function(c){const p=c.data;switch(p.type){case"decode":a._callbacks[p.id].resolve(p);break;case"error":a._callbacks[p.id].reject(p);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+p.type+'"')}},this.workerPool.push(a)}else this.workerPool.sort(function(a,c){return a._taskLoad>c._taskLoad?-1:1});const o=this.workerPool[this.workerPool.length-1];return o._taskCosts[n]=r,o._taskLoad+=r,o})}_releaseTask(n,r){n._taskLoad-=n._taskCosts[r],delete n._callbacks[r],delete n._taskCosts[r]}debug(){console.log("Task load: ",this.workerPool.map(n=>n._taskLoad))}dispose(){for(let n=0;n<this.workerPool.length;++n)this.workerPool[n].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}function Fo(){let _,n;onmessage=function(p){const d=p.data;switch(d.type){case"init":_=d.decoderConfig,n=new Promise(function(w){_.onModuleLoaded=function(m){w({draco:m})},DracoDecoderModule(_)});break;case"decode":const u=d.buffer,b=d.taskConfig;n.then(w=>{const m=w.draco,f=new m.Decoder,x=new m.DecoderBuffer;x.Init(new Int8Array(u),u.byteLength);try{const T=r(m,f,x,b),C=T.attributes.map(E=>E.array.buffer);T.index&&C.push(T.index.array.buffer),self.postMessage({type:"decode",id:d.id,geometry:T},C)}catch(T){console.error(T),self.postMessage({type:"error",id:d.id,error:T.message})}finally{m.destroy(x),m.destroy(f)}});break}};function r(p,d,u,b){const w=b.attributeIDs,m=b.attributeTypes;let f,x;const T=d.GetEncodedGeometryType(u);if(T===p.TRIANGULAR_MESH)f=new p.Mesh,x=d.DecodeBufferToMesh(u,f);else if(T===p.POINT_CLOUD)f=new p.PointCloud,x=d.DecodeBufferToPointCloud(u,f);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!x.ok()||f.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+x.error_msg());const C={index:null,attributes:[]};for(const E in w){const R=self[m[E]];let P,I;if(b.useUniqueIDs)I=w[E],P=d.GetAttributeByUniqueId(f,I);else{if(I=d.GetAttributeId(f,p[w[E]]),I===-1)continue;P=d.GetAttribute(f,I)}C.attributes.push(a(p,d,f,E,R,P))}return T===p.TRIANGULAR_MESH&&(C.index=o(p,d,f)),p.destroy(f),C}function o(p,d,u){const b=u.num_faces()*3,w=b*4,m=p._malloc(w);d.GetTrianglesUInt32Array(u,w,m);const f=new Uint32Array(p.HEAPF32.buffer,m,b).slice();return p._free(m),{array:f,itemSize:1}}function a(p,d,u,b,w,m){const f=m.num_components(),x=u.num_points()*f,T=x*w.BYTES_PER_ELEMENT,C=c(p,w),E=p._malloc(T);d.GetAttributeDataArrayForAllPoints(u,m,C,T,E);const R=new w(p.HEAPF32.buffer,E,x).slice();return p._free(E),{name:b,array:R,itemSize:f}}function c(p,d){switch(d){case Float32Array:return p.DT_FLOAT32;case Int8Array:return p.DT_INT8;case Int16Array:return p.DT_INT16;case Int32Array:return p.DT_INT32;case Uint8Array:return p.DT_UINT8;case Uint16Array:return p.DT_UINT16;case Uint32Array:return p.DT_UINT32}}}class zo{constructor(){this.assetStore=Oe.getState(),this.assetsToLoad=this.assetStore.assetsToLoad,this.addLoadedAsset=this.assetStore.addLoadedAsset,this.loadingProgress={},this.instantiateLoaders(),this.startLoading()}instantiateLoaders(){const n=new Ko,r="/folio_3js/draco/";n.setDecoderPath(r),this.gltfLoader=new po,this.gltfLoader.setDRACOLoader(n),this.textureLoader=new Un}updateLoadingProgress(n,r){this.loadingProgress[n]=r,Object.values(this.loadingProgress).reduce((o,a)=>o+a,0)/this.assetsToLoad.length}getAssetPath(n){return`/folio_3js${n}`}startLoading(){this.assetsToLoad.forEach(n=>{const r=this.getAssetPath(n.path),o=c=>{console.error(`Error loading asset ${n.id}:`,c),this.assetStore.setLoadingError&&this.assetStore.setLoadingError(n.id,c)},a=c=>{if(c.lengthComputable){const p=c.loaded/c.total*100;this.updateLoadingProgress(n.id,p)}};n.type==="texture"&&this.textureLoader.load(r,c=>{this.addLoadedAsset(c,n.id),this.updateLoadingProgress(n.id,100)},a,o),n.type==="model"&&this.gltfLoader.load(r,c=>{this.addLoadedAsset(c,n.id),this.updateLoadingProgress(n.id,100)},a,o)})}areAllAssetsLoaded(){return Object.keys(this.assetStore.loadedAssets).length===this.assetsToLoad.length}getLoadingStatus(){return{totalAssets:this.assetsToLoad.length,loadedAssets:Object.keys(this.assetStore.loadedAssets).length,progress:this.loadingProgress,isComplete:this.areAllAssetsLoaded()}}}class Go{constructor(){this.assetStore=Oe,this.overlay=document.querySelector(".overlay"),this.loading=document.querySelector(".loading"),this.startButton=document.querySelector(".start"),this.assetStore.subscribe(n=>{this.numberOfLoadedAssets=Object.keys(n.loadedAssets).length,this.numberOfAssetsToLoad=n.assetsToLoad.length,this.progress=this.numberOfLoadedAssets/this.numberOfAssetsToLoad,this.progress=Math.trunc(this.progress*100),document.getElementById("progressPercentage").innerHTML=this.progress,this.progress===100&&(es.setState({assetsReady:!0}),this.loading.classList.add("fade"),window.setTimeout(()=>this.ready(),1200))})}ready(){this.loading.remove(),this.startButton.style.display="inline",this.startButton.classList.add("fadeIn"),this.startButton.addEventListener("click",()=>{console.log("started"),this.overlay.classList.add("fade"),this.startButton.classList.add("fadeOut"),window.setTimeout(()=>{this.overlay.remove(),this.startButton.remove()},2e3)},{once:!0})}}class qo{constructor(){this.startListening(),this.inputStore=ut,this.keyPressed={}}startListening(){window.addEventListener("keydown",n=>this.onKeyDown(n)),window.addEventListener("keyup",n=>this.onKeyUp(n))}onKeyDown(n){if(!this.keyPressed[n.code]){switch(n.code){case"KeyW":case"ArrowUp":console.log("forward"),ut.setState({forward:!0});break;case"KeyA":case"ArrowLeft":ut.setState({left:!0});break;case"KeyS":case"ArrowDown":ut.setState({backward:!0});break;case"KeyD":case"ArrowRight":ut.setState({right:!0});break}this.keyPressed[n.code]=!0}}onKeyUp(n){switch(n.code){case"KeyW":case"ArrowUp":ut.setState({forward:!1});break;case"KeyA":case"ArrowLeft":ut.setState({left:!1});break;case"KeyS":case"ArrowDown":ut.setState({backward:!1});break;case"KeyD":case"ArrowRight":ut.setState({right:!1});break}this.keyPressed[n.code]=!1}}let ls=null;class vt{constructor(){if(ls)return ls;ls=this,this.canvas=document.querySelector("canvas.threejs"),this.scene=new Jc,this.gui=new Qn,this.assetLoader=new zo,this.preloader=new Go,this.inputController=new qo,this.world=new lo,this.camera=new $n,this.renderer=new Yn,this.loop=new Xn,this.resize=new co}}new vt})();
