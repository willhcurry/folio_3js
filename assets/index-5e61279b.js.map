{"version":3,"mappings":"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","names":["_changeEvent","_startEvent","_endEvent","OrbitControls","EventDispatcher","domElement","Vector3","TOUCH","spherical","onKeyDown","scope","state","STATE","Quaternion","quatInverse","quat","lastPosition","lastQuaternion","twoPI","offset","rotateLeft","getAutoRotationAngle","sphericalDelta","min","max","scale","panOffset","zoomChanged","EPS","onContextMenu","onPointerDown","onPointerMove","onPointerUp","Spherical","Vector2","rotateDelta","panStart","panEnd","panDelta","dollyStart","dollyEnd","dollyDelta","pointers","pointerPositions","angle","rotateUp","panLeft","objectMatrix","panUp","v","pan","deltaY","element","targetDistance","deltaX","dollyOut","dollyIn","handleMouseDownRotate","event","handleMouseDownDolly","handleMouseDownPan","handleMouseMoveRotate","rotateEnd","handleMouseMoveDolly","getZoomScale","handleMouseMovePan","handleMouseWheel","handleKeyDown","needsUpdate","handleTouchStartRotate","rotateStart","x","y","handleTouchStartPan","handleTouchStartDolly","dx","dy","distance","handleTouchStartDollyPan","handleTouchStartDollyRotate","handleTouchMoveRotate","position","getSecondPointerPosition","handleTouchMovePan","handleTouchMoveDolly","handleTouchMoveDollyPan","handleTouchMoveDollyRotate","addPointer","onMouseDown","onMouseMove","removePointer","onPointerCancel","mouseAction","MOUSE","onMouseWheel","onTouchStart","i","trackPointer","pointer","createStoreImpl","listeners","setState","replace","nextState","partial","previousState","listener","api","getState","createStore","createState","sizesStore","App","sizes","characterRotation","cameraOffset","targetOffset","THREE.Vector3","characterPosition","Renderer","THREE.sRGBEncoding","THREE.PCFSoftShadowMap","Loop","THREE.Clock","elapsedTime","deltaTime","global","factory","this","exports","core","text","coreComps","prerelease","controller","disabled","hidden","TpEvent","target","TpChangeEvent","value","presetKey","TpUpdateEvent","TpFoldEvent","expanded","TpTabSelectEvent","isEmpty","a2","a1","isPropertyWritable","d","CREATE_MESSAGE_MAP","context","name","config","_a","BindingTarget","key","opt_id","obj","valueObj","ButtonApi","title","eventName","Emitter","observers","observer","handler","PREFIX","ClassName","viewName","opt_elementName","opt_modifier","compose","h1","h2","input","extractValue","ev","bindValue","applyValue","bindValueMap","valueMap","applyClass","active","elem","className","bindValueToTextContent","className$q","ButtonView","doc","buttonElem","titleElem","ButtonController","initialValue","v1","v2","rawValue","options","constrainedValue","prevValue","createValue","constraint","equals","BoundValue","ValueMap","o","parseObject","keyToParserMap","tmp","parser","result","parseArray","item","isObject","createParamsParserBuilder","optional","parse","createParamsParserBuilders","itemParser","ParamsParsers","parseParams","warnMissing","info","disposeElement","ReadonlyValue","valueToModifier","valueToClassName","modifier","ViewProps","_b","_c","opt_initialValue","disposed","callback","parent","prevParent","className$o","POS_TO_CLASS_NAME_MAP","getAllBladePositions","pos","getGlobalObject","getCanvasContext","win","canvasElement","ICON_ID_TO_INNER_HTML_MAP","createSvgIconElement","document","iconId","SVG_NS","insertElementAt","parentElement","index","createLabelNode","line","lineNode","frag","LabelView","className$n","labelElem","removeChildNodes","valueElem","LabelController","BladeController","viewProps","ButtonBladePlugin","params","p","args","ValueBladeController","createBlade","Foldable","exHeight","expandedClassName","computeExpandedFolderHeight","folder","containerElement","disableTransitionTemporarily","forceReflow","height","applyHeight","foldable","bindFoldable","h","RackLikeApi","rackApi","addButtonAsBlade","addFolderAsBlade","addSeparatorAsBlade","opt_params","addTabAsBlade","opt_index","subList","InputBindingApi","bh","InputBindingController","MonitorBindingApi","MonitorBindingController","apiSet","RackApi","NestedOrderedSet","findSubBladeApiSet","rack","bc","getApiByController","createBindingTarget","object","a","binding","FolderApi","RackLikeController","bcs","b","findSubRack","findSubBladeControllerSet","controllerClass","isRoot","firstVisibleItem","visibleItems","lastVisibleItem","ps","findInputBindingController","findMonitorBindingController","findValueBladeController","RackController","PlainView","BladeRack","bladeContainerClassName","indentElem","markElem","FolderController","rc","FolderView","LabeledValueController","SeparatorApi","className$m","hrElem","SeparatorController","SeparatorView","className$l","selected","TabItemView","TabItemController","contentRackApi","TabApi","pool","pc","TabPageController","TabPageApi","INDEX_NOT_SELECTED","s","firstSelIndex","className$k","TabController","tab","Tab","TabView","removeElement","TabBladePlugin","c","createBladeController","plugin","ac","interval","targetValue","fillBuffer","buffer","bufferSize","initializeBuffer","createTrimmedBuffer","createPushedBuffer","newValue","newBuffer","findConstraint","constraintClass","CompositeConstraint","tmpResult","sc","opts","origin","r","className$j","selectElem","removeChildElements","optionElem","ListView","className$i","PopupController","PopupView","className$h","TextView","inputElem","formatter","TextController","parsedValue","boolToString","boolFromUnknown","BooleanFormatter","NumberLiteralNode","BINARY_OPERATION_MAP","BinaryOperationNode","operator","left","right","op","UNARY_OPERATION_MAP","UnaryOperationNode","expr","combineReader","parsers","cursor","readWhitespace","m","readNonZeroDigit","ch","readDecimalDigits","readSignedInteger","ds","sign","sds","readExponentPart","e","si","readDecimalIntegerLiteral","nzd","readDecimalLiteral1","dil","dot","dds","readDecimalLiteral2","readDecimalLiteral3","readDecimalLiteral","parseBinaryDigits","readBinaryIntegerLiteral","prefix","bds","readOctalDigits","readOctalIntegerLiteral","ods","readHexDigits","readHexIntegerLiteral","hds","readNonDecimalIntegerLiteral","readNumericLiteral","parseLiteral","num","parseParenthesizedExpression","parseExpression","cl","parsePrimaryExpression","parseUnaryExpression","readBinaryOperator","ops","createBinaryOperationExpressionParser","exprParser","firstExpr","nextExpr","parseBinaryOperationExpression","parseEcmaNumberExpression","parseNumber","numberFromUnknown","pv","digits","innerFormatter","createNumberFormatter","formatPercentage","stringFromUnknown","preventFeedback","changing","primary","forward","secondary","backward","getStepForKey","baseStep","keys","step","getVerticalStepKeys","isVerticalArrowKey","rect","PointerHandler","touch","start1","end1","start2","end2","getDecimalDigits","constrainRange","loopRange","className$g","NumberTextView","knobElem","guideElem","bodyElem","headElem","aox","adx","ph","className$f","SliderView","trackElem","getHorizontalStepKeys","SliderTextView","className$e","sliderElem","SliderController","NumberTextController","parsePickerLayout","normalizeListOptions","items","createListConstraint","ListConstraint","findStep","StepConstraint","getSuitableDecimalDigits","getBaseStep","base","className$d","CheckboxView","wrapperElem","createConstraint$6","lc","constraints","BooleanInputPlugin","parseListOptions","_args","writePrimitive","ListController","CheckboxController","ColorView","className$c","swatchElem","textElem","pickerElem","g","bp","cmax","gp","cmin","rp","l","hslToRgbInt","hp","sp","lp","rgbToHsvInt","hsvToRgbInt","vp","hslToHsvInt","sd","hsvToHslInt","removeAlphaComponent","comps","appendAlphaComponent","alpha","MODE_CONVERTER_MAP","rgbToHslInt","getColorMaxComponents","mode","type","loopHueRange","hue","constrainColorComponents","components","ms","convertColorType","from","to","fms","tms","convertColor","intComps","isRgbColorComponent","Color","color","comps2","comps1","opt_mode","rgbComps","className$b","ColorPickerView","svElem","apElem","aElem","elems","parseColorInputParams","parseColorType","forAlpha","extractColorType","equalsStringColorFormat","f1","f2","parseCssNumberOrPercentage","maxValue","parseCssNumberOrAngle","unit","ANGLE_TO_DEG_MAP","parseFunctionalRgbColorComponents","createFunctionalRgbColorParser","parseFunctionalRgbaColorComponents","createFunctionalRgbaColorParser","parseHslColorComponents","createHslColorParser","parseHslaColorComponents","createHslaColorParser","parseHexRgbColorComponents","mRgb","mRrggbb","parseHexRgbColor","parseHexRgbaColorComponents","mapRange","parseHexRgbaColor","parseObjectRgbColorComponents","createObjectRgbColorParser","parseObjectRgbaColorComponents","createObjectRgbaColorParser","PARSER_AND_RESULT","prev","detection","detectStringColorFormat","detectStringColor","TYPE_TO_PARSERS","createColorStringBindingReader","createColorStringParser","zerofill","comp","hex","colorToHexRgbString","colorToHexRgbaString","hexes","rgbaComps","opt_type","createFunctionalRgbColorFormatter","aFormatter","rgbFormatter","createFunctionalRgbaColorFormatter","colorToFunctionalHslString","formatters","colorToFunctionalHslaString","names","createObjectRgbColorFormatter","createObjectRgbaColorFormatter","FORMAT_AND_STRINGIFIERS","findColorStringifier","format","fas","className$a","barElem","colorElem","markerElem","previewElem","leftColor","rightColor","colorToFunctionalRgbaString","gradientComps","APaletteView","getBaseStepForColor","className$9","createModeSelectElement","optElem","modeElem","modeMarkerElem","textsElem","compElem","createFormatter$2","createConstraint$5","DefiniteRangeConstraint","createComponentController","ccs","cc","cs","connectValues","className$8","colorToFunctionalRgbString","HPaletteView","className$7","CANVAS_RESOL","canvasElem","ctx","imgData","iy","ix","width","hsvComps","data","SvPaletteView","saturation","isArrowKey","dv","HPaletteController","SvPaletteController","APaletteController","className$6","ColorSwatchView","ColorSwatchController","pickerC","nextTarget","colorFromObject","colorToRgbNumber","colorToRgbaNumber","numberToRgbColor","numberToRgbaColor","colorFromRgbNumber","colorFromRgbaNumber","createColorStringWriter","stringify","createColorNumberWriter","supportsAlpha","createColorObjectWriter","inValue","writeRgbaColorObject","shouldSupportAlpha$1","createFormatter$1","isForColor","NumberColorInputPlugin","shouldSupportAlpha","createColorObjectReader","createColorObjectFormatter","colorToObjectRgbString","ObjectColorInputPlugin","TpError","writer","stringifier","PointNdConstraint","className$5","PointNdTextView","axisElem","createAxisController","PointNdTextController","_","createStepConstraint","createRangeConstraint","RangeConstraint","findNumberRange","drc","createConstraint$4","NumberInputPlugin","Point2d","Point2dAssembly","className$4","Point2dView","className$3","Point2dPickerView","padElem","svgElem","xAxisElem","yAxisElem","lineElem","py","ipy","px","computeOffset","invertsY","baseSteps","Point2dPickerController","Point2dController","padC","Point3d","z","Point3dAssembly","point3dFromUnknown","writePoint3d","createConstraint$3","createDimensionConstraint","createAxis$2","Point3dInputPlugin","parsePointDimensionParams","Point4d","w","Point4dAssembly","point4dFromUnknown","writePoint4d","createConstraint$2","createAxis$1","Point4dInputPlugin","createConstraint$1","StringInputPlugin","MultiLogView","textareaElem","lines","shouldScroll","MultiLogController","className$1","SingleLogView","values","lastValue","SingleLogController","BooleanMonitorPlugin","Constants","GraphLogView","tooltipElem","bounds","maxIndex","points","tx","ty","GraphLogController","supportsTouch","createFormatter","createTextMonitor","createGraphMonitor","shouldShowGraph","NumberMonitorPlugin","StringMonitorPlugin","formatString","createInputBindingController","valueArgs","reader","InputBinding","createTicker","ManualTicker","IntervalTicker","createMonitorBindingController","bindingArgs","MonitorBinding","PluginPool","createDefaultPluginPool","Point2dInputPlugin","StringColorInputPlugin","FolderBladePlugin","SeparatorBladePlugin","point2dFromUnknown","writePoint2d","rs","createConstraint","getSuitableMaxDimensionValue","getSuitableMaxValue","xc","yc","xr","yr","createAxis","getSuitableDraggingScale","shouldInvertY","yParams","picker","ListApi","BladeApi","label","SliderApi","minValue","TextApi","ListBladePlugin","ic","exportPresetJson","targets","importPresetJson","bindings","preset","RootApi","ibc","mbc","RootController","SliderBladePlugin","vc","SliderTextController","numberToString","TextBladePlugin","createDefaultWrapperElement","embedStyle","id","css","styleElem","Pane","opt_config","getWindowDocument","rootController","containerElem","parentElem","bundle","VERSION","Semver","GUI","Physics","__vitePreload","RAPIER","gravity","appStateStore","collider","rigidBodyType","colliderType","dimensions","mesh","radius","scaledVertices","indices","worldPosition","THREE.Quaternion","worldRotation","size","worldScale","maxScale","vertices","vertex","rigidBody","rotation","THREE.Matrix4","inverseParentMatrix","inverseParentRotation","assetsToLoad","assetStore","environmentScene","physicalObjects","child","keyword","shadowReceivers","ambientLight","THREE.AmbientLight","THREE.DirectionalLight","Character","geometry","THREE.MeshStandardMaterial","THREE.Mesh","avatar","CharacterController","inputStore","movement","THREE.AnimationMixer","clip","action","Portal","portalData","colliderDesc","portalPos","Environment","portal","error","toTrianglesDrawMode","drawMode","TriangleFanDrawMode","newIndices","numberOfTriangles","GLTFLoader","url","onLoad","onProgress","resourcePath","LoaderUtils","_onError","onError","loader","FileLoader","gltf","ktx2Loader","extensions","plugins","textDecoder","BINARY_EXTENSION_HEADER_MAGIC","EXTENSIONS","json","extensionName","GLTFMaterialsUnlitExtension","GLTFTextureTransformExtension","extensionsRequired","path","resolve","reject","objects","nodeIndex","nodeLength","nodeDef","cacheKey","dependency","lightDef","lightIndex","lightNode","range","DirectionalLight","PointLight","SpotLight","assignExtrasToUserData","self","light","MeshBasicMaterial","materialParams","pending","metallicRoughness","materialDef","array","materialIndex","emissiveStrength","extension","colorArray","GLTFMaterialsIorExtension","GLTFMaterialsSpecularExtension","textureIndex","textureDef","source","image","GLTFMeshoptCompression","bufferView","extensionDef","decoder","count","res","meshDef","primitive","WEBGL_CONSTANTS","attributes","attributesDef","accessor","results","nodeObject","instancedMeshes","Matrix4","q","InstancedMesh","attributeName","instancedMesh","BINARY_EXTENSION_HEADER_LENGTH","BINARY_EXTENSION_CHUNK_TYPES","GLTFBinaryExtension","headerView","chunkContentsLength","chunkView","chunkIndex","chunkType","contentArray","chunkLength","byteOffset","GLTFDracoMeshCompressionExtension","gltfAttributeMap","threeAttributeMap","threeAttributeName","ATTRIBUTES","accessorDef","componentType","WEBGL_COMPONENT_TYPES","attributeTypeMap","attributeNormalizedMap","bufferViewIndex","normalized","attribute","texture","transform","GLTFMeshQuantizationExtension","GLTFCubicSplineInterpolant","sampleSize","resultBuffer","parameterPositions","sampleValues","valueSize","t1","stride2","stride","stride3","t0","pp","i1","ppp","s3","s2","s1","p0","offset0","m0","td","p1","offset1","m1","s0","_q","GLTFCubicSplineQuaternionInterpolant","t","NearestFilter","NearestMipmapNearestFilter","NearestMipmapLinearFilter","WEBGL_WRAPPINGS","MirroredRepeatWrapping","RepeatWrapping","WEBGL_TYPE_SIZES","InterpolateDiscrete","cache","MeshStandardMaterial","objectDef","gltfDef","addMorphTargets","hasMorphNormal","il","hasMorphPosition","hasMorphColor","pendingNormalAccessors","pendingColorAccessors","pendingAccessor","pendingPositionAccessors","accessors","morphColors","morphNormals","updateMorphTargets","targetNames","geometryKey","dracoExtension","primitiveDef","createAttributesKey","attributesKey","getNormalizedComponentScale","constructor","getImageURIMimeType","uri","_identityMatrix","GLTFParser","GLTFRegistry","isFirefox","firefoxVersion","TextureLoader","ImageBitmapLoader","ext","dependencies","skinDefs","meshDefs","skinIndex","skinLength","nodeDefs","joints","ref","updateMappings","clone","original","mappings","func","defs","bufferIndex","bufferDef","bufferViewDef","byteLength","accessorIndex","itemSize","pendingBufferViews","bufferViews","TypedArray","elementBytes","itemBytes","byteStride","bufferAttribute","ibCacheKey","ib","ibSlice","InterleavedBuffer","InterleavedBufferAttribute","BufferAttribute","TypedArrayIndices","byteOffsetIndices","byteOffsetValues","sparseIndices","sparseValues","sourceDef","sourceIndex","promise","WEBGL_FILTERS","sampler","LinearMipmapLinearFilter","URL","sourceURI","isObjectURL","blob","imageBitmap","mapDef","encoding","mapName","material","useDerivativeTangents","useVertexColors","pointsMaterial","Material","lineMaterial","LineBasicMaterial","cachedMaterial","useFlatShading","materialExtensions","kmuExtension","materialType","alphaMode","ALPHA_MODES","sRGBEncoding","addUnknownExtensionsToUserData","PropertyBinding","originalName","sanitizedName","addPrimitiveAttributes","primitives","cached","BufferGeometry","meshIndex","materials","geometries","Mesh","Line","LineLoop","Points","meshes","Group","group","camera","cameraDef","cameraIndex","PerspectiveCamera","OrthographicCamera","skinDef","inverseBindMatrices","boneInverses","jointNodes","jointNode","bones","mat","Skeleton","animationIndex","animationDef","pendingNodes","pendingOutputAccessors","pendingSamplers","pendingTargets","channel","output","nodes","outputAccessors","node","inputAccessor","inputAccessors","outputAccessor","samplers","TypedKeyframeTrack","PATH_PROPERTIES","NumberKeyframeTrack","QuaternionKeyframeTrack","interpolation","InterpolateLinear","targetName","outputArray","scaled","j","jl","track","tracks","nodeName","meshPromise","objectPending","childrenDef","childPending","skeletonPending","Bone","Object3D","matrix","children","sceneIndex","scene","sceneDef","nodeIds","reduceAssociations","Texture","reducedAssociations","computeBounds","Box3","boxScale","box","maxDisplacement","vector","Sphere","sphere","assignAttributeAccessor","gltfAttributeName","_taskCache","DRACOLoader","Loader","manager","attributeTypes","taskKey","taskConfig","cachedTask","taskID","taskCost","_worker","worker","message","geometryPending","geometryData","responseType","useJS","librariesPending","libraries","fn","DRACOWorker","body","decoderConfig","decoderPending","draco","module","decoderBuffer","decodeGeometry","buffers","attr","attributeIDs","dracoGeometry","decodingStatus","geometryType","attributeType","attributeID","decodeAttribute","decodeIndex","numIndices","ptr","numComponents","numValues","dataType","getDracoDataType","AssetLoader","dracoLoader","basePath","THREE.TextureLoader","assetId","progress","asset","assetPath","percentComplete","loadedAsset","Preloader","InputController","dpad","center","deadzone","handleTouch","degrees","arrows","arrow","ModalManager","description","instance","THREE.Scene","World","Camera","Resize"],"sources":["../../node_modules/three/examples/jsm/controls/OrbitControls.js","../../node_modules/zustand/esm/vanilla.mjs","../../src/App/Utils/Store.js","../../src/App/Camera.js","../../src/App/Renderer.js","../../src/App/Utils/Loop.js","../../node_modules/tweakpane/dist/tweakpane.js","../../src/App/Utils/GUI.js","../../src/App/World/Physics.js","../../src/App/Utils/AssetStore.js","../../src/App/World/Environment.js","../../src/App/World/Character.js","../../src/App/World/CharacterController.js","../../src/App/World/AnimationController.js","../../src/App/World/Portal.js","../../src/App/World/World.js","../../src/App/Utils/Resize.js","../../node_modules/three/examples/jsm/utils/BufferGeometryUtils.js","../../node_modules/three/examples/jsm/loaders/GLTFLoader.js","../../node_modules/three/examples/jsm/loaders/DRACOLoader.js","../../src/App/Utils/AssetLoader.js","../../src/App/UI/Preloader.js","../../src/App/UI/InputController.js","../../src/App/UI/ModalManager.js","../../src/App/App.js","../../src/index.js"],"sourcesContent":["import {\n\tEventDispatcher,\n\tMOUSE,\n\tQuaternion,\n\tSpherical,\n\tTOUCH,\n\tVector2,\n\tVector3\n} from 'three';\n\n// This set of controls performs orbiting, dollying (zooming), and panning.\n// Unlike TrackballControls, it maintains the \"up\" direction object.up (+Y by default).\n//\n//    Orbit - left mouse / touch: one-finger move\n//    Zoom - middle mouse, or mousewheel / touch: two-finger spread or squish\n//    Pan - right mouse, or left mouse + ctrl/meta/shiftKey, or arrow keys / touch: two-finger move\n\nconst _changeEvent = { type: 'change' };\nconst _startEvent = { type: 'start' };\nconst _endEvent = { type: 'end' };\n\nclass OrbitControls extends EventDispatcher {\n\n\tconstructor( object, domElement ) {\n\n\t\tsuper();\n\n\t\tthis.object = object;\n\t\tthis.domElement = domElement;\n\t\tthis.domElement.style.touchAction = 'none'; // disable touch scroll\n\n\t\t// Set to false to disable this control\n\t\tthis.enabled = true;\n\n\t\t// \"target\" sets the location of focus, where the object orbits around\n\t\tthis.target = new Vector3();\n\n\t\t// How far you can dolly in and out ( PerspectiveCamera only )\n\t\tthis.minDistance = 0;\n\t\tthis.maxDistance = Infinity;\n\n\t\t// How far you can zoom in and out ( OrthographicCamera only )\n\t\tthis.minZoom = 0;\n\t\tthis.maxZoom = Infinity;\n\n\t\t// How far you can orbit vertically, upper and lower limits.\n\t\t// Range is 0 to Math.PI radians.\n\t\tthis.minPolarAngle = 0; // radians\n\t\tthis.maxPolarAngle = Math.PI; // radians\n\n\t\t// How far you can orbit horizontally, upper and lower limits.\n\t\t// If set, the interval [ min, max ] must be a sub-interval of [ - 2 PI, 2 PI ], with ( max - min < 2 PI )\n\t\tthis.minAzimuthAngle = - Infinity; // radians\n\t\tthis.maxAzimuthAngle = Infinity; // radians\n\n\t\t// Set to true to enable damping (inertia)\n\t\t// If damping is enabled, you must call controls.update() in your animation loop\n\t\tthis.enableDamping = false;\n\t\tthis.dampingFactor = 0.05;\n\n\t\t// This option actually enables dollying in and out; left as \"zoom\" for backwards compatibility.\n\t\t// Set to false to disable zooming\n\t\tthis.enableZoom = true;\n\t\tthis.zoomSpeed = 1.0;\n\n\t\t// Set to false to disable rotating\n\t\tthis.enableRotate = true;\n\t\tthis.rotateSpeed = 1.0;\n\n\t\t// Set to false to disable panning\n\t\tthis.enablePan = true;\n\t\tthis.panSpeed = 1.0;\n\t\tthis.screenSpacePanning = true; // if false, pan orthogonal to world-space direction camera.up\n\t\tthis.keyPanSpeed = 7.0;\t// pixels moved per arrow key push\n\n\t\t// Set to true to automatically rotate around the target\n\t\t// If auto-rotate is enabled, you must call controls.update() in your animation loop\n\t\tthis.autoRotate = false;\n\t\tthis.autoRotateSpeed = 2.0; // 30 seconds per orbit when fps is 60\n\n\t\t// The four arrow keys\n\t\tthis.keys = { LEFT: 'ArrowLeft', UP: 'ArrowUp', RIGHT: 'ArrowRight', BOTTOM: 'ArrowDown' };\n\n\t\t// Mouse buttons\n\t\tthis.mouseButtons = { LEFT: MOUSE.ROTATE, MIDDLE: MOUSE.DOLLY, RIGHT: MOUSE.PAN };\n\n\t\t// Touch fingers\n\t\tthis.touches = { ONE: TOUCH.ROTATE, TWO: TOUCH.DOLLY_PAN };\n\n\t\t// for reset\n\t\tthis.target0 = this.target.clone();\n\t\tthis.position0 = this.object.position.clone();\n\t\tthis.zoom0 = this.object.zoom;\n\n\t\t// the target DOM element for key events\n\t\tthis._domElementKeyEvents = null;\n\n\t\t//\n\t\t// public methods\n\t\t//\n\n\t\tthis.getPolarAngle = function () {\n\n\t\t\treturn spherical.phi;\n\n\t\t};\n\n\t\tthis.getAzimuthalAngle = function () {\n\n\t\t\treturn spherical.theta;\n\n\t\t};\n\n\t\tthis.getDistance = function () {\n\n\t\t\treturn this.object.position.distanceTo( this.target );\n\n\t\t};\n\n\t\tthis.listenToKeyEvents = function ( domElement ) {\n\n\t\t\tdomElement.addEventListener( 'keydown', onKeyDown );\n\t\t\tthis._domElementKeyEvents = domElement;\n\n\t\t};\n\n\t\tthis.saveState = function () {\n\n\t\t\tscope.target0.copy( scope.target );\n\t\t\tscope.position0.copy( scope.object.position );\n\t\t\tscope.zoom0 = scope.object.zoom;\n\n\t\t};\n\n\t\tthis.reset = function () {\n\n\t\t\tscope.target.copy( scope.target0 );\n\t\t\tscope.object.position.copy( scope.position0 );\n\t\t\tscope.object.zoom = scope.zoom0;\n\n\t\t\tscope.object.updateProjectionMatrix();\n\t\t\tscope.dispatchEvent( _changeEvent );\n\n\t\t\tscope.update();\n\n\t\t\tstate = STATE.NONE;\n\n\t\t};\n\n\t\t// this method is exposed, but perhaps it would be better if we can make it private...\n\t\tthis.update = function () {\n\n\t\t\tconst offset = new Vector3();\n\n\t\t\t// so camera.up is the orbit axis\n\t\t\tconst quat = new Quaternion().setFromUnitVectors( object.up, new Vector3( 0, 1, 0 ) );\n\t\t\tconst quatInverse = quat.clone().invert();\n\n\t\t\tconst lastPosition = new Vector3();\n\t\t\tconst lastQuaternion = new Quaternion();\n\n\t\t\tconst twoPI = 2 * Math.PI;\n\n\t\t\treturn function update() {\n\n\t\t\t\tconst position = scope.object.position;\n\n\t\t\t\toffset.copy( position ).sub( scope.target );\n\n\t\t\t\t// rotate offset to \"y-axis-is-up\" space\n\t\t\t\toffset.applyQuaternion( quat );\n\n\t\t\t\t// angle from z-axis around y-axis\n\t\t\t\tspherical.setFromVector3( offset );\n\n\t\t\t\tif ( scope.autoRotate && state === STATE.NONE ) {\n\n\t\t\t\t\trotateLeft( getAutoRotationAngle() );\n\n\t\t\t\t}\n\n\t\t\t\tif ( scope.enableDamping ) {\n\n\t\t\t\t\tspherical.theta += sphericalDelta.theta * scope.dampingFactor;\n\t\t\t\t\tspherical.phi += sphericalDelta.phi * scope.dampingFactor;\n\n\t\t\t\t} else {\n\n\t\t\t\t\tspherical.theta += sphericalDelta.theta;\n\t\t\t\t\tspherical.phi += sphericalDelta.phi;\n\n\t\t\t\t}\n\n\t\t\t\t// restrict theta to be between desired limits\n\n\t\t\t\tlet min = scope.minAzimuthAngle;\n\t\t\t\tlet max = scope.maxAzimuthAngle;\n\n\t\t\t\tif ( isFinite( min ) && isFinite( max ) ) {\n\n\t\t\t\t\tif ( min < - Math.PI ) min += twoPI; else if ( min > Math.PI ) min -= twoPI;\n\n\t\t\t\t\tif ( max < - Math.PI ) max += twoPI; else if ( max > Math.PI ) max -= twoPI;\n\n\t\t\t\t\tif ( min <= max ) {\n\n\t\t\t\t\t\tspherical.theta = Math.max( min, Math.min( max, spherical.theta ) );\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tspherical.theta = ( spherical.theta > ( min + max ) / 2 ) ?\n\t\t\t\t\t\t\tMath.max( min, spherical.theta ) :\n\t\t\t\t\t\t\tMath.min( max, spherical.theta );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\t// restrict phi to be between desired limits\n\t\t\t\tspherical.phi = Math.max( scope.minPolarAngle, Math.min( scope.maxPolarAngle, spherical.phi ) );\n\n\t\t\t\tspherical.makeSafe();\n\n\n\t\t\t\tspherical.radius *= scale;\n\n\t\t\t\t// restrict radius to be between desired limits\n\t\t\t\tspherical.radius = Math.max( scope.minDistance, Math.min( scope.maxDistance, spherical.radius ) );\n\n\t\t\t\t// move target to panned location\n\n\t\t\t\tif ( scope.enableDamping === true ) {\n\n\t\t\t\t\tscope.target.addScaledVector( panOffset, scope.dampingFactor );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tscope.target.add( panOffset );\n\n\t\t\t\t}\n\n\t\t\t\toffset.setFromSpherical( spherical );\n\n\t\t\t\t// rotate offset back to \"camera-up-vector-is-up\" space\n\t\t\t\toffset.applyQuaternion( quatInverse );\n\n\t\t\t\tposition.copy( scope.target ).add( offset );\n\n\t\t\t\tscope.object.lookAt( scope.target );\n\n\t\t\t\tif ( scope.enableDamping === true ) {\n\n\t\t\t\t\tsphericalDelta.theta *= ( 1 - scope.dampingFactor );\n\t\t\t\t\tsphericalDelta.phi *= ( 1 - scope.dampingFactor );\n\n\t\t\t\t\tpanOffset.multiplyScalar( 1 - scope.dampingFactor );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tsphericalDelta.set( 0, 0, 0 );\n\n\t\t\t\t\tpanOffset.set( 0, 0, 0 );\n\n\t\t\t\t}\n\n\t\t\t\tscale = 1;\n\n\t\t\t\t// update condition is:\n\t\t\t\t// min(camera displacement, camera rotation in radians)^2 > EPS\n\t\t\t\t// using small-angle approximation cos(x/2) = 1 - x^2 / 8\n\n\t\t\t\tif ( zoomChanged ||\n\t\t\t\t\tlastPosition.distanceToSquared( scope.object.position ) > EPS ||\n\t\t\t\t\t8 * ( 1 - lastQuaternion.dot( scope.object.quaternion ) ) > EPS ) {\n\n\t\t\t\t\tscope.dispatchEvent( _changeEvent );\n\n\t\t\t\t\tlastPosition.copy( scope.object.position );\n\t\t\t\t\tlastQuaternion.copy( scope.object.quaternion );\n\t\t\t\t\tzoomChanged = false;\n\n\t\t\t\t\treturn true;\n\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\n\t\t\t};\n\n\t\t}();\n\n\t\tthis.dispose = function () {\n\n\t\t\tscope.domElement.removeEventListener( 'contextmenu', onContextMenu );\n\n\t\t\tscope.domElement.removeEventListener( 'pointerdown', onPointerDown );\n\t\t\tscope.domElement.removeEventListener( 'pointercancel', onPointerCancel );\n\t\t\tscope.domElement.removeEventListener( 'wheel', onMouseWheel );\n\n\t\t\tscope.domElement.removeEventListener( 'pointermove', onPointerMove );\n\t\t\tscope.domElement.removeEventListener( 'pointerup', onPointerUp );\n\n\n\t\t\tif ( scope._domElementKeyEvents !== null ) {\n\n\t\t\t\tscope._domElementKeyEvents.removeEventListener( 'keydown', onKeyDown );\n\n\t\t\t}\n\n\t\t\t//scope.dispatchEvent( { type: 'dispose' } ); // should this be added here?\n\n\t\t};\n\n\t\t//\n\t\t// internals\n\t\t//\n\n\t\tconst scope = this;\n\n\t\tconst STATE = {\n\t\t\tNONE: - 1,\n\t\t\tROTATE: 0,\n\t\t\tDOLLY: 1,\n\t\t\tPAN: 2,\n\t\t\tTOUCH_ROTATE: 3,\n\t\t\tTOUCH_PAN: 4,\n\t\t\tTOUCH_DOLLY_PAN: 5,\n\t\t\tTOUCH_DOLLY_ROTATE: 6\n\t\t};\n\n\t\tlet state = STATE.NONE;\n\n\t\tconst EPS = 0.000001;\n\n\t\t// current position in spherical coordinates\n\t\tconst spherical = new Spherical();\n\t\tconst sphericalDelta = new Spherical();\n\n\t\tlet scale = 1;\n\t\tconst panOffset = new Vector3();\n\t\tlet zoomChanged = false;\n\n\t\tconst rotateStart = new Vector2();\n\t\tconst rotateEnd = new Vector2();\n\t\tconst rotateDelta = new Vector2();\n\n\t\tconst panStart = new Vector2();\n\t\tconst panEnd = new Vector2();\n\t\tconst panDelta = new Vector2();\n\n\t\tconst dollyStart = new Vector2();\n\t\tconst dollyEnd = new Vector2();\n\t\tconst dollyDelta = new Vector2();\n\n\t\tconst pointers = [];\n\t\tconst pointerPositions = {};\n\n\t\tfunction getAutoRotationAngle() {\n\n\t\t\treturn 2 * Math.PI / 60 / 60 * scope.autoRotateSpeed;\n\n\t\t}\n\n\t\tfunction getZoomScale() {\n\n\t\t\treturn Math.pow( 0.95, scope.zoomSpeed );\n\n\t\t}\n\n\t\tfunction rotateLeft( angle ) {\n\n\t\t\tsphericalDelta.theta -= angle;\n\n\t\t}\n\n\t\tfunction rotateUp( angle ) {\n\n\t\t\tsphericalDelta.phi -= angle;\n\n\t\t}\n\n\t\tconst panLeft = function () {\n\n\t\t\tconst v = new Vector3();\n\n\t\t\treturn function panLeft( distance, objectMatrix ) {\n\n\t\t\t\tv.setFromMatrixColumn( objectMatrix, 0 ); // get X column of objectMatrix\n\t\t\t\tv.multiplyScalar( - distance );\n\n\t\t\t\tpanOffset.add( v );\n\n\t\t\t};\n\n\t\t}();\n\n\t\tconst panUp = function () {\n\n\t\t\tconst v = new Vector3();\n\n\t\t\treturn function panUp( distance, objectMatrix ) {\n\n\t\t\t\tif ( scope.screenSpacePanning === true ) {\n\n\t\t\t\t\tv.setFromMatrixColumn( objectMatrix, 1 );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tv.setFromMatrixColumn( objectMatrix, 0 );\n\t\t\t\t\tv.crossVectors( scope.object.up, v );\n\n\t\t\t\t}\n\n\t\t\t\tv.multiplyScalar( distance );\n\n\t\t\t\tpanOffset.add( v );\n\n\t\t\t};\n\n\t\t}();\n\n\t\t// deltaX and deltaY are in pixels; right and down are positive\n\t\tconst pan = function () {\n\n\t\t\tconst offset = new Vector3();\n\n\t\t\treturn function pan( deltaX, deltaY ) {\n\n\t\t\t\tconst element = scope.domElement;\n\n\t\t\t\tif ( scope.object.isPerspectiveCamera ) {\n\n\t\t\t\t\t// perspective\n\t\t\t\t\tconst position = scope.object.position;\n\t\t\t\t\toffset.copy( position ).sub( scope.target );\n\t\t\t\t\tlet targetDistance = offset.length();\n\n\t\t\t\t\t// half of the fov is center to top of screen\n\t\t\t\t\ttargetDistance *= Math.tan( ( scope.object.fov / 2 ) * Math.PI / 180.0 );\n\n\t\t\t\t\t// we use only clientHeight here so aspect ratio does not distort speed\n\t\t\t\t\tpanLeft( 2 * deltaX * targetDistance / element.clientHeight, scope.object.matrix );\n\t\t\t\t\tpanUp( 2 * deltaY * targetDistance / element.clientHeight, scope.object.matrix );\n\n\t\t\t\t} else if ( scope.object.isOrthographicCamera ) {\n\n\t\t\t\t\t// orthographic\n\t\t\t\t\tpanLeft( deltaX * ( scope.object.right - scope.object.left ) / scope.object.zoom / element.clientWidth, scope.object.matrix );\n\t\t\t\t\tpanUp( deltaY * ( scope.object.top - scope.object.bottom ) / scope.object.zoom / element.clientHeight, scope.object.matrix );\n\n\t\t\t\t} else {\n\n\t\t\t\t\t// camera neither orthographic nor perspective\n\t\t\t\t\tconsole.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.' );\n\t\t\t\t\tscope.enablePan = false;\n\n\t\t\t\t}\n\n\t\t\t};\n\n\t\t}();\n\n\t\tfunction dollyOut( dollyScale ) {\n\n\t\t\tif ( scope.object.isPerspectiveCamera ) {\n\n\t\t\t\tscale /= dollyScale;\n\n\t\t\t} else if ( scope.object.isOrthographicCamera ) {\n\n\t\t\t\tscope.object.zoom = Math.max( scope.minZoom, Math.min( scope.maxZoom, scope.object.zoom * dollyScale ) );\n\t\t\t\tscope.object.updateProjectionMatrix();\n\t\t\t\tzoomChanged = true;\n\n\t\t\t} else {\n\n\t\t\t\tconsole.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.' );\n\t\t\t\tscope.enableZoom = false;\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction dollyIn( dollyScale ) {\n\n\t\t\tif ( scope.object.isPerspectiveCamera ) {\n\n\t\t\t\tscale *= dollyScale;\n\n\t\t\t} else if ( scope.object.isOrthographicCamera ) {\n\n\t\t\t\tscope.object.zoom = Math.max( scope.minZoom, Math.min( scope.maxZoom, scope.object.zoom / dollyScale ) );\n\t\t\t\tscope.object.updateProjectionMatrix();\n\t\t\t\tzoomChanged = true;\n\n\t\t\t} else {\n\n\t\t\t\tconsole.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.' );\n\t\t\t\tscope.enableZoom = false;\n\n\t\t\t}\n\n\t\t}\n\n\t\t//\n\t\t// event callbacks - update the object state\n\t\t//\n\n\t\tfunction handleMouseDownRotate( event ) {\n\n\t\t\trotateStart.set( event.clientX, event.clientY );\n\n\t\t}\n\n\t\tfunction handleMouseDownDolly( event ) {\n\n\t\t\tdollyStart.set( event.clientX, event.clientY );\n\n\t\t}\n\n\t\tfunction handleMouseDownPan( event ) {\n\n\t\t\tpanStart.set( event.clientX, event.clientY );\n\n\t\t}\n\n\t\tfunction handleMouseMoveRotate( event ) {\n\n\t\t\trotateEnd.set( event.clientX, event.clientY );\n\n\t\t\trotateDelta.subVectors( rotateEnd, rotateStart ).multiplyScalar( scope.rotateSpeed );\n\n\t\t\tconst element = scope.domElement;\n\n\t\t\trotateLeft( 2 * Math.PI * rotateDelta.x / element.clientHeight ); // yes, height\n\n\t\t\trotateUp( 2 * Math.PI * rotateDelta.y / element.clientHeight );\n\n\t\t\trotateStart.copy( rotateEnd );\n\n\t\t\tscope.update();\n\n\t\t}\n\n\t\tfunction handleMouseMoveDolly( event ) {\n\n\t\t\tdollyEnd.set( event.clientX, event.clientY );\n\n\t\t\tdollyDelta.subVectors( dollyEnd, dollyStart );\n\n\t\t\tif ( dollyDelta.y > 0 ) {\n\n\t\t\t\tdollyOut( getZoomScale() );\n\n\t\t\t} else if ( dollyDelta.y < 0 ) {\n\n\t\t\t\tdollyIn( getZoomScale() );\n\n\t\t\t}\n\n\t\t\tdollyStart.copy( dollyEnd );\n\n\t\t\tscope.update();\n\n\t\t}\n\n\t\tfunction handleMouseMovePan( event ) {\n\n\t\t\tpanEnd.set( event.clientX, event.clientY );\n\n\t\t\tpanDelta.subVectors( panEnd, panStart ).multiplyScalar( scope.panSpeed );\n\n\t\t\tpan( panDelta.x, panDelta.y );\n\n\t\t\tpanStart.copy( panEnd );\n\n\t\t\tscope.update();\n\n\t\t}\n\n\t\tfunction handleMouseWheel( event ) {\n\n\t\t\tif ( event.deltaY < 0 ) {\n\n\t\t\t\tdollyIn( getZoomScale() );\n\n\t\t\t} else if ( event.deltaY > 0 ) {\n\n\t\t\t\tdollyOut( getZoomScale() );\n\n\t\t\t}\n\n\t\t\tscope.update();\n\n\t\t}\n\n\t\tfunction handleKeyDown( event ) {\n\n\t\t\tlet needsUpdate = false;\n\n\t\t\tswitch ( event.code ) {\n\n\t\t\t\tcase scope.keys.UP:\n\n\t\t\t\t\tif ( event.ctrlKey || event.metaKey || event.shiftKey ) {\n\n\t\t\t\t\t\trotateUp( 2 * Math.PI * scope.rotateSpeed / scope.domElement.clientHeight );\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tpan( 0, scope.keyPanSpeed );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tneedsUpdate = true;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase scope.keys.BOTTOM:\n\n\t\t\t\t\tif ( event.ctrlKey || event.metaKey || event.shiftKey ) {\n\n\t\t\t\t\t\trotateUp( - 2 * Math.PI * scope.rotateSpeed / scope.domElement.clientHeight );\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tpan( 0, - scope.keyPanSpeed );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tneedsUpdate = true;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase scope.keys.LEFT:\n\n\t\t\t\t\tif ( event.ctrlKey || event.metaKey || event.shiftKey ) {\n\n\t\t\t\t\t\trotateLeft( 2 * Math.PI * scope.rotateSpeed / scope.domElement.clientHeight );\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tpan( scope.keyPanSpeed, 0 );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tneedsUpdate = true;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase scope.keys.RIGHT:\n\n\t\t\t\t\tif ( event.ctrlKey || event.metaKey || event.shiftKey ) {\n\n\t\t\t\t\t\trotateLeft( - 2 * Math.PI * scope.rotateSpeed / scope.domElement.clientHeight );\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tpan( - scope.keyPanSpeed, 0 );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tneedsUpdate = true;\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t\tif ( needsUpdate ) {\n\n\t\t\t\t// prevent the browser from scrolling on cursor keys\n\t\t\t\tevent.preventDefault();\n\n\t\t\t\tscope.update();\n\n\t\t\t}\n\n\n\t\t}\n\n\t\tfunction handleTouchStartRotate() {\n\n\t\t\tif ( pointers.length === 1 ) {\n\n\t\t\t\trotateStart.set( pointers[ 0 ].pageX, pointers[ 0 ].pageY );\n\n\t\t\t} else {\n\n\t\t\t\tconst x = 0.5 * ( pointers[ 0 ].pageX + pointers[ 1 ].pageX );\n\t\t\t\tconst y = 0.5 * ( pointers[ 0 ].pageY + pointers[ 1 ].pageY );\n\n\t\t\t\trotateStart.set( x, y );\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction handleTouchStartPan() {\n\n\t\t\tif ( pointers.length === 1 ) {\n\n\t\t\t\tpanStart.set( pointers[ 0 ].pageX, pointers[ 0 ].pageY );\n\n\t\t\t} else {\n\n\t\t\t\tconst x = 0.5 * ( pointers[ 0 ].pageX + pointers[ 1 ].pageX );\n\t\t\t\tconst y = 0.5 * ( pointers[ 0 ].pageY + pointers[ 1 ].pageY );\n\n\t\t\t\tpanStart.set( x, y );\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction handleTouchStartDolly() {\n\n\t\t\tconst dx = pointers[ 0 ].pageX - pointers[ 1 ].pageX;\n\t\t\tconst dy = pointers[ 0 ].pageY - pointers[ 1 ].pageY;\n\n\t\t\tconst distance = Math.sqrt( dx * dx + dy * dy );\n\n\t\t\tdollyStart.set( 0, distance );\n\n\t\t}\n\n\t\tfunction handleTouchStartDollyPan() {\n\n\t\t\tif ( scope.enableZoom ) handleTouchStartDolly();\n\n\t\t\tif ( scope.enablePan ) handleTouchStartPan();\n\n\t\t}\n\n\t\tfunction handleTouchStartDollyRotate() {\n\n\t\t\tif ( scope.enableZoom ) handleTouchStartDolly();\n\n\t\t\tif ( scope.enableRotate ) handleTouchStartRotate();\n\n\t\t}\n\n\t\tfunction handleTouchMoveRotate( event ) {\n\n\t\t\tif ( pointers.length == 1 ) {\n\n\t\t\t\trotateEnd.set( event.pageX, event.pageY );\n\n\t\t\t} else {\n\n\t\t\t\tconst position = getSecondPointerPosition( event );\n\n\t\t\t\tconst x = 0.5 * ( event.pageX + position.x );\n\t\t\t\tconst y = 0.5 * ( event.pageY + position.y );\n\n\t\t\t\trotateEnd.set( x, y );\n\n\t\t\t}\n\n\t\t\trotateDelta.subVectors( rotateEnd, rotateStart ).multiplyScalar( scope.rotateSpeed );\n\n\t\t\tconst element = scope.domElement;\n\n\t\t\trotateLeft( 2 * Math.PI * rotateDelta.x / element.clientHeight ); // yes, height\n\n\t\t\trotateUp( 2 * Math.PI * rotateDelta.y / element.clientHeight );\n\n\t\t\trotateStart.copy( rotateEnd );\n\n\t\t}\n\n\t\tfunction handleTouchMovePan( event ) {\n\n\t\t\tif ( pointers.length === 1 ) {\n\n\t\t\t\tpanEnd.set( event.pageX, event.pageY );\n\n\t\t\t} else {\n\n\t\t\t\tconst position = getSecondPointerPosition( event );\n\n\t\t\t\tconst x = 0.5 * ( event.pageX + position.x );\n\t\t\t\tconst y = 0.5 * ( event.pageY + position.y );\n\n\t\t\t\tpanEnd.set( x, y );\n\n\t\t\t}\n\n\t\t\tpanDelta.subVectors( panEnd, panStart ).multiplyScalar( scope.panSpeed );\n\n\t\t\tpan( panDelta.x, panDelta.y );\n\n\t\t\tpanStart.copy( panEnd );\n\n\t\t}\n\n\t\tfunction handleTouchMoveDolly( event ) {\n\n\t\t\tconst position = getSecondPointerPosition( event );\n\n\t\t\tconst dx = event.pageX - position.x;\n\t\t\tconst dy = event.pageY - position.y;\n\n\t\t\tconst distance = Math.sqrt( dx * dx + dy * dy );\n\n\t\t\tdollyEnd.set( 0, distance );\n\n\t\t\tdollyDelta.set( 0, Math.pow( dollyEnd.y / dollyStart.y, scope.zoomSpeed ) );\n\n\t\t\tdollyOut( dollyDelta.y );\n\n\t\t\tdollyStart.copy( dollyEnd );\n\n\t\t}\n\n\t\tfunction handleTouchMoveDollyPan( event ) {\n\n\t\t\tif ( scope.enableZoom ) handleTouchMoveDolly( event );\n\n\t\t\tif ( scope.enablePan ) handleTouchMovePan( event );\n\n\t\t}\n\n\t\tfunction handleTouchMoveDollyRotate( event ) {\n\n\t\t\tif ( scope.enableZoom ) handleTouchMoveDolly( event );\n\n\t\t\tif ( scope.enableRotate ) handleTouchMoveRotate( event );\n\n\t\t}\n\n\t\t//\n\t\t// event handlers - FSM: listen for events and reset state\n\t\t//\n\n\t\tfunction onPointerDown( event ) {\n\n\t\t\tif ( scope.enabled === false ) return;\n\n\t\t\tif ( pointers.length === 0 ) {\n\n\t\t\t\tscope.domElement.setPointerCapture( event.pointerId );\n\n\t\t\t\tscope.domElement.addEventListener( 'pointermove', onPointerMove );\n\t\t\t\tscope.domElement.addEventListener( 'pointerup', onPointerUp );\n\n\t\t\t}\n\n\t\t\t//\n\n\t\t\taddPointer( event );\n\n\t\t\tif ( event.pointerType === 'touch' ) {\n\n\t\t\t\tonTouchStart( event );\n\n\t\t\t} else {\n\n\t\t\t\tonMouseDown( event );\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction onPointerMove( event ) {\n\n\t\t\tif ( scope.enabled === false ) return;\n\n\t\t\tif ( event.pointerType === 'touch' ) {\n\n\t\t\t\tonTouchMove( event );\n\n\t\t\t} else {\n\n\t\t\t\tonMouseMove( event );\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction onPointerUp( event ) {\n\n\t\t    removePointer( event );\n\n\t\t    if ( pointers.length === 0 ) {\n\n\t\t        scope.domElement.releasePointerCapture( event.pointerId );\n\n\t\t        scope.domElement.removeEventListener( 'pointermove', onPointerMove );\n\t\t        scope.domElement.removeEventListener( 'pointerup', onPointerUp );\n\n\t\t    }\n\n\t\t    scope.dispatchEvent( _endEvent );\n\n\t\t    state = STATE.NONE;\n\n\t\t}\n\n\t\tfunction onPointerCancel( event ) {\n\n\t\t\tremovePointer( event );\n\n\t\t}\n\n\t\tfunction onMouseDown( event ) {\n\n\t\t\tlet mouseAction;\n\n\t\t\tswitch ( event.button ) {\n\n\t\t\t\tcase 0:\n\n\t\t\t\t\tmouseAction = scope.mouseButtons.LEFT;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 1:\n\n\t\t\t\t\tmouseAction = scope.mouseButtons.MIDDLE;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 2:\n\n\t\t\t\t\tmouseAction = scope.mouseButtons.RIGHT;\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\n\t\t\t\t\tmouseAction = - 1;\n\n\t\t\t}\n\n\t\t\tswitch ( mouseAction ) {\n\n\t\t\t\tcase MOUSE.DOLLY:\n\n\t\t\t\t\tif ( scope.enableZoom === false ) return;\n\n\t\t\t\t\thandleMouseDownDolly( event );\n\n\t\t\t\t\tstate = STATE.DOLLY;\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase MOUSE.ROTATE:\n\n\t\t\t\t\tif ( event.ctrlKey || event.metaKey || event.shiftKey ) {\n\n\t\t\t\t\t\tif ( scope.enablePan === false ) return;\n\n\t\t\t\t\t\thandleMouseDownPan( event );\n\n\t\t\t\t\t\tstate = STATE.PAN;\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tif ( scope.enableRotate === false ) return;\n\n\t\t\t\t\t\thandleMouseDownRotate( event );\n\n\t\t\t\t\t\tstate = STATE.ROTATE;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase MOUSE.PAN:\n\n\t\t\t\t\tif ( event.ctrlKey || event.metaKey || event.shiftKey ) {\n\n\t\t\t\t\t\tif ( scope.enableRotate === false ) return;\n\n\t\t\t\t\t\thandleMouseDownRotate( event );\n\n\t\t\t\t\t\tstate = STATE.ROTATE;\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tif ( scope.enablePan === false ) return;\n\n\t\t\t\t\t\thandleMouseDownPan( event );\n\n\t\t\t\t\t\tstate = STATE.PAN;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\n\t\t\t\t\tstate = STATE.NONE;\n\n\t\t\t}\n\n\t\t\tif ( state !== STATE.NONE ) {\n\n\t\t\t\tscope.dispatchEvent( _startEvent );\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction onMouseMove( event ) {\n\n\t\t\tswitch ( state ) {\n\n\t\t\t\tcase STATE.ROTATE:\n\n\t\t\t\t\tif ( scope.enableRotate === false ) return;\n\n\t\t\t\t\thandleMouseMoveRotate( event );\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase STATE.DOLLY:\n\n\t\t\t\t\tif ( scope.enableZoom === false ) return;\n\n\t\t\t\t\thandleMouseMoveDolly( event );\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase STATE.PAN:\n\n\t\t\t\t\tif ( scope.enablePan === false ) return;\n\n\t\t\t\t\thandleMouseMovePan( event );\n\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction onMouseWheel( event ) {\n\n\t\t\tif ( scope.enabled === false || scope.enableZoom === false || state !== STATE.NONE ) return;\n\n\t\t\tevent.preventDefault();\n\n\t\t\tscope.dispatchEvent( _startEvent );\n\n\t\t\thandleMouseWheel( event );\n\n\t\t\tscope.dispatchEvent( _endEvent );\n\n\t\t}\n\n\t\tfunction onKeyDown( event ) {\n\n\t\t\tif ( scope.enabled === false || scope.enablePan === false ) return;\n\n\t\t\thandleKeyDown( event );\n\n\t\t}\n\n\t\tfunction onTouchStart( event ) {\n\n\t\t\ttrackPointer( event );\n\n\t\t\tswitch ( pointers.length ) {\n\n\t\t\t\tcase 1:\n\n\t\t\t\t\tswitch ( scope.touches.ONE ) {\n\n\t\t\t\t\t\tcase TOUCH.ROTATE:\n\n\t\t\t\t\t\t\tif ( scope.enableRotate === false ) return;\n\n\t\t\t\t\t\t\thandleTouchStartRotate();\n\n\t\t\t\t\t\t\tstate = STATE.TOUCH_ROTATE;\n\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase TOUCH.PAN:\n\n\t\t\t\t\t\t\tif ( scope.enablePan === false ) return;\n\n\t\t\t\t\t\t\thandleTouchStartPan();\n\n\t\t\t\t\t\t\tstate = STATE.TOUCH_PAN;\n\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tdefault:\n\n\t\t\t\t\t\t\tstate = STATE.NONE;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 2:\n\n\t\t\t\t\tswitch ( scope.touches.TWO ) {\n\n\t\t\t\t\t\tcase TOUCH.DOLLY_PAN:\n\n\t\t\t\t\t\t\tif ( scope.enableZoom === false && scope.enablePan === false ) return;\n\n\t\t\t\t\t\t\thandleTouchStartDollyPan();\n\n\t\t\t\t\t\t\tstate = STATE.TOUCH_DOLLY_PAN;\n\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase TOUCH.DOLLY_ROTATE:\n\n\t\t\t\t\t\t\tif ( scope.enableZoom === false && scope.enableRotate === false ) return;\n\n\t\t\t\t\t\t\thandleTouchStartDollyRotate();\n\n\t\t\t\t\t\t\tstate = STATE.TOUCH_DOLLY_ROTATE;\n\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tdefault:\n\n\t\t\t\t\t\t\tstate = STATE.NONE;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\n\t\t\t\t\tstate = STATE.NONE;\n\n\t\t\t}\n\n\t\t\tif ( state !== STATE.NONE ) {\n\n\t\t\t\tscope.dispatchEvent( _startEvent );\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction onTouchMove( event ) {\n\n\t\t\ttrackPointer( event );\n\n\t\t\tswitch ( state ) {\n\n\t\t\t\tcase STATE.TOUCH_ROTATE:\n\n\t\t\t\t\tif ( scope.enableRotate === false ) return;\n\n\t\t\t\t\thandleTouchMoveRotate( event );\n\n\t\t\t\t\tscope.update();\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase STATE.TOUCH_PAN:\n\n\t\t\t\t\tif ( scope.enablePan === false ) return;\n\n\t\t\t\t\thandleTouchMovePan( event );\n\n\t\t\t\t\tscope.update();\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase STATE.TOUCH_DOLLY_PAN:\n\n\t\t\t\t\tif ( scope.enableZoom === false && scope.enablePan === false ) return;\n\n\t\t\t\t\thandleTouchMoveDollyPan( event );\n\n\t\t\t\t\tscope.update();\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase STATE.TOUCH_DOLLY_ROTATE:\n\n\t\t\t\t\tif ( scope.enableZoom === false && scope.enableRotate === false ) return;\n\n\t\t\t\t\thandleTouchMoveDollyRotate( event );\n\n\t\t\t\t\tscope.update();\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\n\t\t\t\t\tstate = STATE.NONE;\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction onContextMenu( event ) {\n\n\t\t\tif ( scope.enabled === false ) return;\n\n\t\t\tevent.preventDefault();\n\n\t\t}\n\n\t\tfunction addPointer( event ) {\n\n\t\t\tpointers.push( event );\n\n\t\t}\n\n\t\tfunction removePointer( event ) {\n\n\t\t\tdelete pointerPositions[ event.pointerId ];\n\n\t\t\tfor ( let i = 0; i < pointers.length; i ++ ) {\n\n\t\t\t\tif ( pointers[ i ].pointerId == event.pointerId ) {\n\n\t\t\t\t\tpointers.splice( i, 1 );\n\t\t\t\t\treturn;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction trackPointer( event ) {\n\n\t\t\tlet position = pointerPositions[ event.pointerId ];\n\n\t\t\tif ( position === undefined ) {\n\n\t\t\t\tposition = new Vector2();\n\t\t\t\tpointerPositions[ event.pointerId ] = position;\n\n\t\t\t}\n\n\t\t\tposition.set( event.pageX, event.pageY );\n\n\t\t}\n\n\t\tfunction getSecondPointerPosition( event ) {\n\n\t\t\tconst pointer = ( event.pointerId === pointers[ 0 ].pointerId ) ? pointers[ 1 ] : pointers[ 0 ];\n\n\t\t\treturn pointerPositions[ pointer.pointerId ];\n\n\t\t}\n\n\t\t//\n\n\t\tscope.domElement.addEventListener( 'contextmenu', onContextMenu );\n\n\t\tscope.domElement.addEventListener( 'pointerdown', onPointerDown );\n\t\tscope.domElement.addEventListener( 'pointercancel', onPointerCancel );\n\t\tscope.domElement.addEventListener( 'wheel', onMouseWheel, { passive: false } );\n\n\t\t// force an update at start\n\n\t\tthis.update();\n\n\t}\n\n}\n\n\n// This set of controls performs orbiting, dollying (zooming), and panning.\n// Unlike TrackballControls, it maintains the \"up\" direction object.up (+Y by default).\n// This is very similar to OrbitControls, another set of touch behavior\n//\n//    Orbit - right mouse, or left mouse + ctrl/meta/shiftKey / touch: two-finger rotate\n//    Zoom - middle mouse, or mousewheel / touch: two-finger spread or squish\n//    Pan - left mouse, or arrow keys / touch: one-finger move\n\nclass MapControls extends OrbitControls {\n\n\tconstructor( object, domElement ) {\n\n\t\tsuper( object, domElement );\n\n\t\tthis.screenSpacePanning = false; // pan orthogonal to world-space direction camera.up\n\n\t\tthis.mouseButtons.LEFT = MOUSE.PAN;\n\t\tthis.mouseButtons.RIGHT = MOUSE.ROTATE;\n\n\t\tthis.touches.ONE = TOUCH.PAN;\n\t\tthis.touches.TWO = TOUCH.DOLLY_ROTATE;\n\n\t}\n\n}\n\nexport { OrbitControls, MapControls };\n","const createStoreImpl = (createState) => {\n  let state;\n  const listeners = /* @__PURE__ */ new Set();\n  const setState = (partial, replace) => {\n    const nextState = typeof partial === \"function\" ? partial(state) : partial;\n    if (!Object.is(nextState, state)) {\n      const previousState = state;\n      state = (replace != null ? replace : typeof nextState !== \"object\" || nextState === null) ? nextState : Object.assign({}, state, nextState);\n      listeners.forEach((listener) => listener(state, previousState));\n    }\n  };\n  const getState = () => state;\n  const subscribe = (listener) => {\n    listeners.add(listener);\n    return () => listeners.delete(listener);\n  };\n  const destroy = () => {\n    if ((import.meta.env ? import.meta.env.MODE : void 0) !== \"production\") {\n      console.warn(\n        \"[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected.\"\n      );\n    }\n    listeners.clear();\n  };\n  const api = { setState, getState, subscribe, destroy };\n  state = createState(setState, getState, api);\n  return api;\n};\nconst createStore = (createState) => createState ? createStoreImpl(createState) : createStoreImpl;\nvar vanilla = (createState) => {\n  if ((import.meta.env ? import.meta.env.MODE : void 0) !== \"production\") {\n    console.warn(\n      \"[DEPRECATED] Default export is deprecated. Instead use import { createStore } from 'zustand/vanilla'.\"\n    );\n  }\n  return createStore(createState);\n};\n\nexport { createStore, vanilla as default };\n","import { createStore } from \"zustand/vanilla\";\n\nexport const sizesStore = createStore(() => ({\n    width: window.innerWidth,\n    height: window.innerHeight,\n    pixelRatio: Math.min(window.devicePixelRatio, 2),\n}));\n\nexport const appStateStore = createStore(() => ({\n    physicsReady: false,\n    assetsReady: false,\n}));\n\nexport const inputStore = createStore(() => ({\n    forward: false,\n    backward: false,\n    left: false,\n    right: false,\n}));","import * as THREE from 'three'\nimport { OrbitControls } from \"three/addons/controls/OrbitControls.js\";\nimport { sizesStore } from './Utils/Store.js';\n\n\nimport App from './App.js'\n\nexport default class Camera{\n    constructor() {\n        this.app = new App()\n        this.canvas = this.app.canvas\n\n        this.sizesStore = sizesStore\n\n        this.sizes = this.sizesStore.getState()\n\n        this.setInstance()\n        this.setControls()\n        this.setResizeLister()\n    }\n\n    setInstance() {\n        this.instance = new THREE.PerspectiveCamera(\n            35,\n            this.sizes.width / this.sizes.height,\n            0.1,\n            1000\n        );\n        this.instance.position.set(0, 20, 100);\n    }\n\n    setControls() {\n        this.controls = new OrbitControls(this.instance, this.canvas);\n        this.controls.enableDamping = true;\n    }\n\n    setResizeLister() {\n        this.sizesStore.subscribe((sizes)=>{\n            this.instance.aspect = sizes.width / sizes.height\n            this.instance.updateProjectionMatrix()\n        })\n    }\n\n    loop() {\n        this.controls.update()\n        this.characterController = this.app.world.characterController?.rigidBody\n        if(this.characterController) {\n            const characterPosition = this.characterController.translation()\n            const characterRotation = this.characterController.rotation()\n\n            const cameraOffset = new THREE.Vector3(0, 20, 25)  // Further reduced from (0, 22, 28)\n            cameraOffset.applyQuaternion(characterRotation)\n            cameraOffset.add(characterPosition)\n\n            const targetOffset = new THREE.Vector3(0, 5, 0)  // Slightly lowered from 6\n            targetOffset.applyQuaternion(characterRotation)\n            targetOffset.add(characterPosition)\n\n            this.instance.position.lerp(cameraOffset, 0.1)\n            this.controls.target.lerp(targetOffset, 0.1)\n        }\n    }\n}","import * as THREE from 'three'\nimport App from './App.js'\nimport { sizesStore } from './Utils/Store.js';\n\nexport default class Renderer{\n    constructor() {\n        this.app = new App()\n        this.canvas = this.app.canvas\n        this.camera = this.app.camera\n        this.scene = this.app.scene\n        this.sizesStore = sizesStore\n        this.sizes = this.sizesStore.getState()\n\n        this.setInstance()\n        this.setResizeLister()\n    }\n\n    setInstance() {\n        this.instance = new THREE.WebGLRenderer({\n            canvas: this.canvas,\n            antialias: true,\n          });\n          this.instance.setSize(this.sizes.width, this.sizes.height);\n          this.instance.setPixelRatio(this.sizes.pixelRatio);\n          this.instance.outputEncoding = THREE.sRGBEncoding;\n          this.instance.shadowMap.enabled = true;\n          this.instance.shadowMap.type = THREE.PCFSoftShadowMap;\n\n          this.instance.toneMapping = THREE.ACESFilmicToneMapping\n        this.instance.toneMappingExposure = 0.8\n\n    }\n\n    setResizeLister() {\n        this.sizesStore.subscribe((sizes)=>{\n            this.instance.setSize(sizes.width, sizes.height)\n            this.instance.setPixelRatio(sizes.pixelRatio)\n        })\n    }\n\n    loop() {\n        this.instance.render(this.scene, this.camera.instance)\n    }\n}"," import * as THREE from 'three'\n import App from '../App.js'\n\n export default class Loop {\n    constructor() {\n        this.app = new App()\n        this.camera = this.app.camera\n        this.renderer = this.app.renderer\n        this.world = this.app.world\n\n        this.clock = new THREE.Clock()\n        this.previousElapsedTime = 0\n        this.loop()\n    }\n\n    loop() {\n        const elapsedTime = this.clock.getElapsedTime()\n        const deltaTime = elapsedTime - this.previousElapsedTime\n        this.previousElapsedTime = elapsedTime\n\n        this.world.loop(deltaTime, elapsedTime)\n        this.camera.loop(deltaTime)\n        this.renderer.loop()\n        window.requestAnimationFrame(() => this.loop())\n    }\n}","/*! Tweakpane 3.1.10 (c) 2016 cocopon, licensed under the MIT license. */\n(function (global, factory) {\n    typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :\n    typeof define === 'function' && define.amd ? define(['exports'], factory) :\n    (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global.Tweakpane = {}));\n})(this, (function (exports) { 'use strict';\n\n    /***\n     * A simple semantic versioning perser.\n     */\n    class Semver {\n        /**\n         * @hidden\n         */\n        constructor(text) {\n            const [core, prerelease] = text.split('-');\n            const coreComps = core.split('.');\n            this.major = parseInt(coreComps[0], 10);\n            this.minor = parseInt(coreComps[1], 10);\n            this.patch = parseInt(coreComps[2], 10);\n            this.prerelease = prerelease !== null && prerelease !== void 0 ? prerelease : null;\n        }\n        toString() {\n            const core = [this.major, this.minor, this.patch].join('.');\n            return this.prerelease !== null ? [core, this.prerelease].join('-') : core;\n        }\n    }\n\n    class BladeApi {\n        constructor(controller) {\n            this.controller_ = controller;\n        }\n        get element() {\n            return this.controller_.view.element;\n        }\n        get disabled() {\n            return this.controller_.viewProps.get('disabled');\n        }\n        set disabled(disabled) {\n            this.controller_.viewProps.set('disabled', disabled);\n        }\n        get hidden() {\n            return this.controller_.viewProps.get('hidden');\n        }\n        set hidden(hidden) {\n            this.controller_.viewProps.set('hidden', hidden);\n        }\n        dispose() {\n            this.controller_.viewProps.set('disposed', true);\n        }\n    }\n\n    class TpEvent {\n        constructor(target) {\n            this.target = target;\n        }\n    }\n    class TpChangeEvent extends TpEvent {\n        constructor(target, value, presetKey, last) {\n            super(target);\n            this.value = value;\n            this.presetKey = presetKey;\n            this.last = last !== null && last !== void 0 ? last : true;\n        }\n    }\n    class TpUpdateEvent extends TpEvent {\n        constructor(target, value, presetKey) {\n            super(target);\n            this.value = value;\n            this.presetKey = presetKey;\n        }\n    }\n    class TpFoldEvent extends TpEvent {\n        constructor(target, expanded) {\n            super(target);\n            this.expanded = expanded;\n        }\n    }\n    class TpTabSelectEvent extends TpEvent {\n        constructor(target, index) {\n            super(target);\n            this.index = index;\n        }\n    }\n\n    function forceCast(v) {\n        return v;\n    }\n    function isEmpty(value) {\n        return value === null || value === undefined;\n    }\n    function deepEqualsArray(a1, a2) {\n        if (a1.length !== a2.length) {\n            return false;\n        }\n        for (let i = 0; i < a1.length; i++) {\n            if (a1[i] !== a2[i]) {\n                return false;\n            }\n        }\n        return true;\n    }\n    function isPropertyWritable(obj, key) {\n        let target = obj;\n        do {\n            const d = Object.getOwnPropertyDescriptor(target, key);\n            if (d && (d.set !== undefined || d.writable === true)) {\n                return true;\n            }\n            target = Object.getPrototypeOf(target);\n        } while (target !== null);\n        return false;\n    }\n\n    const CREATE_MESSAGE_MAP = {\n        alreadydisposed: () => 'View has been already disposed',\n        invalidparams: (context) => `Invalid parameters for '${context.name}'`,\n        nomatchingcontroller: (context) => `No matching controller for '${context.key}'`,\n        nomatchingview: (context) => `No matching view for '${JSON.stringify(context.params)}'`,\n        notbindable: () => `Value is not bindable`,\n        propertynotfound: (context) => `Property '${context.name}' not found`,\n        shouldneverhappen: () => 'This error should never happen',\n    };\n    class TpError {\n        static alreadyDisposed() {\n            return new TpError({ type: 'alreadydisposed' });\n        }\n        static notBindable() {\n            return new TpError({\n                type: 'notbindable',\n            });\n        }\n        static propertyNotFound(name) {\n            return new TpError({\n                type: 'propertynotfound',\n                context: {\n                    name: name,\n                },\n            });\n        }\n        static shouldNeverHappen() {\n            return new TpError({ type: 'shouldneverhappen' });\n        }\n        constructor(config) {\n            var _a;\n            this.message =\n                (_a = CREATE_MESSAGE_MAP[config.type](forceCast(config.context))) !== null && _a !== void 0 ? _a : 'Unexpected error';\n            this.name = this.constructor.name;\n            this.stack = new Error(this.message).stack;\n            this.type = config.type;\n        }\n    }\n\n    class BindingTarget {\n        constructor(obj, key, opt_id) {\n            this.obj_ = obj;\n            this.key_ = key;\n            this.presetKey_ = opt_id !== null && opt_id !== void 0 ? opt_id : key;\n        }\n        static isBindable(obj) {\n            if (obj === null) {\n                return false;\n            }\n            if (typeof obj !== 'object' && typeof obj !== 'function') {\n                return false;\n            }\n            return true;\n        }\n        get key() {\n            return this.key_;\n        }\n        get presetKey() {\n            return this.presetKey_;\n        }\n        read() {\n            return this.obj_[this.key_];\n        }\n        write(value) {\n            this.obj_[this.key_] = value;\n        }\n        writeProperty(name, value) {\n            const valueObj = this.read();\n            if (!BindingTarget.isBindable(valueObj)) {\n                throw TpError.notBindable();\n            }\n            if (!(name in valueObj)) {\n                throw TpError.propertyNotFound(name);\n            }\n            valueObj[name] = value;\n        }\n    }\n\n    class ButtonApi extends BladeApi {\n        get label() {\n            return this.controller_.props.get('label');\n        }\n        set label(label) {\n            this.controller_.props.set('label', label);\n        }\n        get title() {\n            var _a;\n            return (_a = this.controller_.valueController.props.get('title')) !== null && _a !== void 0 ? _a : '';\n        }\n        set title(title) {\n            this.controller_.valueController.props.set('title', title);\n        }\n        on(eventName, handler) {\n            const bh = handler.bind(this);\n            const emitter = this.controller_.valueController.emitter;\n            emitter.on(eventName, () => {\n                bh(new TpEvent(this));\n            });\n            return this;\n        }\n    }\n\n    class Emitter {\n        constructor() {\n            this.observers_ = {};\n        }\n        on(eventName, handler) {\n            let observers = this.observers_[eventName];\n            if (!observers) {\n                observers = this.observers_[eventName] = [];\n            }\n            observers.push({\n                handler: handler,\n            });\n            return this;\n        }\n        off(eventName, handler) {\n            const observers = this.observers_[eventName];\n            if (observers) {\n                this.observers_[eventName] = observers.filter((observer) => {\n                    return observer.handler !== handler;\n                });\n            }\n            return this;\n        }\n        emit(eventName, event) {\n            const observers = this.observers_[eventName];\n            if (!observers) {\n                return;\n            }\n            observers.forEach((observer) => {\n                observer.handler(event);\n            });\n        }\n    }\n\n    const PREFIX = 'tp';\n    function ClassName(viewName) {\n        const fn = (opt_elementName, opt_modifier) => {\n            return [\n                PREFIX,\n                '-',\n                viewName,\n                'v',\n                opt_elementName ? `_${opt_elementName}` : '',\n                opt_modifier ? `-${opt_modifier}` : '',\n            ].join('');\n        };\n        return fn;\n    }\n\n    function compose(h1, h2) {\n        return (input) => h2(h1(input));\n    }\n    function extractValue(ev) {\n        return ev.rawValue;\n    }\n    function bindValue(value, applyValue) {\n        value.emitter.on('change', compose(extractValue, applyValue));\n        applyValue(value.rawValue);\n    }\n    function bindValueMap(valueMap, key, applyValue) {\n        bindValue(valueMap.value(key), applyValue);\n    }\n\n    function applyClass(elem, className, active) {\n        if (active) {\n            elem.classList.add(className);\n        }\n        else {\n            elem.classList.remove(className);\n        }\n    }\n    function valueToClassName(elem, className) {\n        return (value) => {\n            applyClass(elem, className, value);\n        };\n    }\n    function bindValueToTextContent(value, elem) {\n        bindValue(value, (text) => {\n            elem.textContent = text !== null && text !== void 0 ? text : '';\n        });\n    }\n\n    const className$q = ClassName('btn');\n    class ButtonView {\n        constructor(doc, config) {\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$q());\n            config.viewProps.bindClassModifiers(this.element);\n            const buttonElem = doc.createElement('button');\n            buttonElem.classList.add(className$q('b'));\n            config.viewProps.bindDisabled(buttonElem);\n            this.element.appendChild(buttonElem);\n            this.buttonElement = buttonElem;\n            const titleElem = doc.createElement('div');\n            titleElem.classList.add(className$q('t'));\n            bindValueToTextContent(config.props.value('title'), titleElem);\n            this.buttonElement.appendChild(titleElem);\n        }\n    }\n\n    class ButtonController {\n        constructor(doc, config) {\n            this.emitter = new Emitter();\n            this.onClick_ = this.onClick_.bind(this);\n            this.props = config.props;\n            this.viewProps = config.viewProps;\n            this.view = new ButtonView(doc, {\n                props: this.props,\n                viewProps: this.viewProps,\n            });\n            this.view.buttonElement.addEventListener('click', this.onClick_);\n        }\n        onClick_() {\n            this.emitter.emit('click', {\n                sender: this,\n            });\n        }\n    }\n\n    class BoundValue {\n        constructor(initialValue, config) {\n            var _a;\n            this.constraint_ = config === null || config === void 0 ? void 0 : config.constraint;\n            this.equals_ = (_a = config === null || config === void 0 ? void 0 : config.equals) !== null && _a !== void 0 ? _a : ((v1, v2) => v1 === v2);\n            this.emitter = new Emitter();\n            this.rawValue_ = initialValue;\n        }\n        get constraint() {\n            return this.constraint_;\n        }\n        get rawValue() {\n            return this.rawValue_;\n        }\n        set rawValue(rawValue) {\n            this.setRawValue(rawValue, {\n                forceEmit: false,\n                last: true,\n            });\n        }\n        setRawValue(rawValue, options) {\n            const opts = options !== null && options !== void 0 ? options : {\n                forceEmit: false,\n                last: true,\n            };\n            const constrainedValue = this.constraint_\n                ? this.constraint_.constrain(rawValue)\n                : rawValue;\n            const prevValue = this.rawValue_;\n            const changed = !this.equals_(prevValue, constrainedValue);\n            if (!changed && !opts.forceEmit) {\n                return;\n            }\n            this.emitter.emit('beforechange', {\n                sender: this,\n            });\n            this.rawValue_ = constrainedValue;\n            this.emitter.emit('change', {\n                options: opts,\n                previousRawValue: prevValue,\n                rawValue: constrainedValue,\n                sender: this,\n            });\n        }\n    }\n\n    class PrimitiveValue {\n        constructor(initialValue) {\n            this.emitter = new Emitter();\n            this.value_ = initialValue;\n        }\n        get rawValue() {\n            return this.value_;\n        }\n        set rawValue(value) {\n            this.setRawValue(value, {\n                forceEmit: false,\n                last: true,\n            });\n        }\n        setRawValue(value, options) {\n            const opts = options !== null && options !== void 0 ? options : {\n                forceEmit: false,\n                last: true,\n            };\n            const prevValue = this.value_;\n            if (prevValue === value && !opts.forceEmit) {\n                return;\n            }\n            this.emitter.emit('beforechange', {\n                sender: this,\n            });\n            this.value_ = value;\n            this.emitter.emit('change', {\n                options: opts,\n                previousRawValue: prevValue,\n                rawValue: this.value_,\n                sender: this,\n            });\n        }\n    }\n\n    function createValue(initialValue, config) {\n        const constraint = config === null || config === void 0 ? void 0 : config.constraint;\n        const equals = config === null || config === void 0 ? void 0 : config.equals;\n        if (!constraint && !equals) {\n            return new PrimitiveValue(initialValue);\n        }\n        return new BoundValue(initialValue, config);\n    }\n\n    class ValueMap {\n        constructor(valueMap) {\n            this.emitter = new Emitter();\n            this.valMap_ = valueMap;\n            for (const key in this.valMap_) {\n                const v = this.valMap_[key];\n                v.emitter.on('change', () => {\n                    this.emitter.emit('change', {\n                        key: key,\n                        sender: this,\n                    });\n                });\n            }\n        }\n        static createCore(initialValue) {\n            const keys = Object.keys(initialValue);\n            return keys.reduce((o, key) => {\n                return Object.assign(o, {\n                    [key]: createValue(initialValue[key]),\n                });\n            }, {});\n        }\n        static fromObject(initialValue) {\n            const core = this.createCore(initialValue);\n            return new ValueMap(core);\n        }\n        get(key) {\n            return this.valMap_[key].rawValue;\n        }\n        set(key, value) {\n            this.valMap_[key].rawValue = value;\n        }\n        value(key) {\n            return this.valMap_[key];\n        }\n    }\n\n    function parseObject(value, keyToParserMap) {\n        const keys = Object.keys(keyToParserMap);\n        const result = keys.reduce((tmp, key) => {\n            if (tmp === undefined) {\n                return undefined;\n            }\n            const parser = keyToParserMap[key];\n            const result = parser(value[key]);\n            return result.succeeded\n                ? Object.assign(Object.assign({}, tmp), { [key]: result.value }) : undefined;\n        }, {});\n        return forceCast(result);\n    }\n    function parseArray(value, parseItem) {\n        return value.reduce((tmp, item) => {\n            if (tmp === undefined) {\n                return undefined;\n            }\n            const result = parseItem(item);\n            if (!result.succeeded || result.value === undefined) {\n                return undefined;\n            }\n            return [...tmp, result.value];\n        }, []);\n    }\n    function isObject(value) {\n        if (value === null) {\n            return false;\n        }\n        return typeof value === 'object';\n    }\n    function createParamsParserBuilder(parse) {\n        return (optional) => (v) => {\n            if (!optional && v === undefined) {\n                return {\n                    succeeded: false,\n                    value: undefined,\n                };\n            }\n            if (optional && v === undefined) {\n                return {\n                    succeeded: true,\n                    value: undefined,\n                };\n            }\n            const result = parse(v);\n            return result !== undefined\n                ? {\n                    succeeded: true,\n                    value: result,\n                }\n                : {\n                    succeeded: false,\n                    value: undefined,\n                };\n        };\n    }\n    function createParamsParserBuilders(optional) {\n        return {\n            custom: (parse) => createParamsParserBuilder(parse)(optional),\n            boolean: createParamsParserBuilder((v) => typeof v === 'boolean' ? v : undefined)(optional),\n            number: createParamsParserBuilder((v) => typeof v === 'number' ? v : undefined)(optional),\n            string: createParamsParserBuilder((v) => typeof v === 'string' ? v : undefined)(optional),\n            function: createParamsParserBuilder((v) =>\n            typeof v === 'function' ? v : undefined)(optional),\n            constant: (value) => createParamsParserBuilder((v) => (v === value ? value : undefined))(optional),\n            raw: createParamsParserBuilder((v) => v)(optional),\n            object: (keyToParserMap) => createParamsParserBuilder((v) => {\n                if (!isObject(v)) {\n                    return undefined;\n                }\n                return parseObject(v, keyToParserMap);\n            })(optional),\n            array: (itemParser) => createParamsParserBuilder((v) => {\n                if (!Array.isArray(v)) {\n                    return undefined;\n                }\n                return parseArray(v, itemParser);\n            })(optional),\n        };\n    }\n    const ParamsParsers = {\n        optional: createParamsParserBuilders(true),\n        required: createParamsParserBuilders(false),\n    };\n    function parseParams(value, keyToParserMap) {\n        const result = ParamsParsers.required.object(keyToParserMap)(value);\n        return result.succeeded ? result.value : undefined;\n    }\n\n    function warnMissing(info) {\n        console.warn([\n            `Missing '${info.key}' of ${info.target} in ${info.place}.`,\n            'Please rebuild plugins with the latest core package.',\n        ].join(' '));\n    }\n\n    function disposeElement(elem) {\n        if (elem && elem.parentElement) {\n            elem.parentElement.removeChild(elem);\n        }\n        return null;\n    }\n\n    class ReadonlyValue {\n        constructor(value) {\n            this.value_ = value;\n        }\n        static create(value) {\n            return [\n                new ReadonlyValue(value),\n                (rawValue, options) => {\n                    value.setRawValue(rawValue, options);\n                },\n            ];\n        }\n        get emitter() {\n            return this.value_.emitter;\n        }\n        get rawValue() {\n            return this.value_.rawValue;\n        }\n    }\n\n    const className$p = ClassName('');\n    function valueToModifier(elem, modifier) {\n        return valueToClassName(elem, className$p(undefined, modifier));\n    }\n    class ViewProps extends ValueMap {\n        constructor(valueMap) {\n            var _a;\n            super(valueMap);\n            this.onDisabledChange_ = this.onDisabledChange_.bind(this);\n            this.onParentChange_ = this.onParentChange_.bind(this);\n            this.onParentGlobalDisabledChange_ =\n                this.onParentGlobalDisabledChange_.bind(this);\n            [this.globalDisabled_, this.setGlobalDisabled_] = ReadonlyValue.create(createValue(this.getGlobalDisabled_()));\n            this.value('disabled').emitter.on('change', this.onDisabledChange_);\n            this.value('parent').emitter.on('change', this.onParentChange_);\n            (_a = this.get('parent')) === null || _a === void 0 ? void 0 : _a.globalDisabled.emitter.on('change', this.onParentGlobalDisabledChange_);\n        }\n        static create(opt_initialValue) {\n            var _a, _b, _c;\n            const initialValue = opt_initialValue !== null && opt_initialValue !== void 0 ? opt_initialValue : {};\n            return new ViewProps(ValueMap.createCore({\n                disabled: (_a = initialValue.disabled) !== null && _a !== void 0 ? _a : false,\n                disposed: false,\n                hidden: (_b = initialValue.hidden) !== null && _b !== void 0 ? _b : false,\n                parent: (_c = initialValue.parent) !== null && _c !== void 0 ? _c : null,\n            }));\n        }\n        get globalDisabled() {\n            return this.globalDisabled_;\n        }\n        bindClassModifiers(elem) {\n            bindValue(this.globalDisabled_, valueToModifier(elem, 'disabled'));\n            bindValueMap(this, 'hidden', valueToModifier(elem, 'hidden'));\n        }\n        bindDisabled(target) {\n            bindValue(this.globalDisabled_, (disabled) => {\n                target.disabled = disabled;\n            });\n        }\n        bindTabIndex(elem) {\n            bindValue(this.globalDisabled_, (disabled) => {\n                elem.tabIndex = disabled ? -1 : 0;\n            });\n        }\n        handleDispose(callback) {\n            this.value('disposed').emitter.on('change', (disposed) => {\n                if (disposed) {\n                    callback();\n                }\n            });\n        }\n        getGlobalDisabled_() {\n            const parent = this.get('parent');\n            const parentDisabled = parent ? parent.globalDisabled.rawValue : false;\n            return parentDisabled || this.get('disabled');\n        }\n        updateGlobalDisabled_() {\n            this.setGlobalDisabled_(this.getGlobalDisabled_());\n        }\n        onDisabledChange_() {\n            this.updateGlobalDisabled_();\n        }\n        onParentGlobalDisabledChange_() {\n            this.updateGlobalDisabled_();\n        }\n        onParentChange_(ev) {\n            var _a;\n            const prevParent = ev.previousRawValue;\n            prevParent === null || prevParent === void 0 ? void 0 : prevParent.globalDisabled.emitter.off('change', this.onParentGlobalDisabledChange_);\n            (_a = this.get('parent')) === null || _a === void 0 ? void 0 : _a.globalDisabled.emitter.on('change', this.onParentGlobalDisabledChange_);\n            this.updateGlobalDisabled_();\n        }\n    }\n\n    function getAllBladePositions() {\n        return ['veryfirst', 'first', 'last', 'verylast'];\n    }\n\n    const className$o = ClassName('');\n    const POS_TO_CLASS_NAME_MAP = {\n        veryfirst: 'vfst',\n        first: 'fst',\n        last: 'lst',\n        verylast: 'vlst',\n    };\n    class BladeController {\n        constructor(config) {\n            this.parent_ = null;\n            this.blade = config.blade;\n            this.view = config.view;\n            this.viewProps = config.viewProps;\n            const elem = this.view.element;\n            this.blade.value('positions').emitter.on('change', () => {\n                getAllBladePositions().forEach((pos) => {\n                    elem.classList.remove(className$o(undefined, POS_TO_CLASS_NAME_MAP[pos]));\n                });\n                this.blade.get('positions').forEach((pos) => {\n                    elem.classList.add(className$o(undefined, POS_TO_CLASS_NAME_MAP[pos]));\n                });\n            });\n            this.viewProps.handleDispose(() => {\n                disposeElement(elem);\n            });\n        }\n        get parent() {\n            return this.parent_;\n        }\n        set parent(parent) {\n            this.parent_ = parent;\n            if (!('parent' in this.viewProps.valMap_)) {\n                warnMissing({\n                    key: 'parent',\n                    target: ViewProps.name,\n                    place: 'BladeController.parent',\n                });\n                return;\n            }\n            this.viewProps.set('parent', this.parent_ ? this.parent_.viewProps : null);\n        }\n    }\n\n    const SVG_NS = 'http://www.w3.org/2000/svg';\n    function forceReflow(element) {\n        element.offsetHeight;\n    }\n    function disableTransitionTemporarily(element, callback) {\n        const t = element.style.transition;\n        element.style.transition = 'none';\n        callback();\n        element.style.transition = t;\n    }\n    function supportsTouch(doc) {\n        return doc.ontouchstart !== undefined;\n    }\n    function getGlobalObject() {\n        return globalThis;\n    }\n    function getWindowDocument() {\n        const globalObj = forceCast(getGlobalObject());\n        return globalObj.document;\n    }\n    function getCanvasContext(canvasElement) {\n        const win = canvasElement.ownerDocument.defaultView;\n        if (!win) {\n            return null;\n        }\n        const isBrowser = 'document' in win;\n        return isBrowser\n            ? canvasElement.getContext('2d', {\n                willReadFrequently: true,\n            })\n            : null;\n    }\n    const ICON_ID_TO_INNER_HTML_MAP = {\n        check: '<path d=\"M2 8l4 4l8 -8\"/>',\n        dropdown: '<path d=\"M5 7h6l-3 3 z\"/>',\n        p2dpad: '<path d=\"M8 4v8\"/><path d=\"M4 8h8\"/><circle cx=\"12\" cy=\"12\" r=\"1.2\"/>',\n    };\n    function createSvgIconElement(document, iconId) {\n        const elem = document.createElementNS(SVG_NS, 'svg');\n        elem.innerHTML = ICON_ID_TO_INNER_HTML_MAP[iconId];\n        return elem;\n    }\n    function insertElementAt(parentElement, element, index) {\n        parentElement.insertBefore(element, parentElement.children[index]);\n    }\n    function removeElement(element) {\n        if (element.parentElement) {\n            element.parentElement.removeChild(element);\n        }\n    }\n    function removeChildElements(element) {\n        while (element.children.length > 0) {\n            element.removeChild(element.children[0]);\n        }\n    }\n    function removeChildNodes(element) {\n        while (element.childNodes.length > 0) {\n            element.removeChild(element.childNodes[0]);\n        }\n    }\n    function findNextTarget(ev) {\n        if (ev.relatedTarget) {\n            return forceCast(ev.relatedTarget);\n        }\n        if ('explicitOriginalTarget' in ev) {\n            return ev.explicitOriginalTarget;\n        }\n        return null;\n    }\n\n    const className$n = ClassName('lbl');\n    function createLabelNode(doc, label) {\n        const frag = doc.createDocumentFragment();\n        const lineNodes = label.split('\\n').map((line) => {\n            return doc.createTextNode(line);\n        });\n        lineNodes.forEach((lineNode, index) => {\n            if (index > 0) {\n                frag.appendChild(doc.createElement('br'));\n            }\n            frag.appendChild(lineNode);\n        });\n        return frag;\n    }\n    class LabelView {\n        constructor(doc, config) {\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$n());\n            config.viewProps.bindClassModifiers(this.element);\n            const labelElem = doc.createElement('div');\n            labelElem.classList.add(className$n('l'));\n            bindValueMap(config.props, 'label', (value) => {\n                if (isEmpty(value)) {\n                    this.element.classList.add(className$n(undefined, 'nol'));\n                }\n                else {\n                    this.element.classList.remove(className$n(undefined, 'nol'));\n                    removeChildNodes(labelElem);\n                    labelElem.appendChild(createLabelNode(doc, value));\n                }\n            });\n            this.element.appendChild(labelElem);\n            this.labelElement = labelElem;\n            const valueElem = doc.createElement('div');\n            valueElem.classList.add(className$n('v'));\n            this.element.appendChild(valueElem);\n            this.valueElement = valueElem;\n        }\n    }\n\n    class LabelController extends BladeController {\n        constructor(doc, config) {\n            const viewProps = config.valueController.viewProps;\n            super(Object.assign(Object.assign({}, config), { view: new LabelView(doc, {\n                    props: config.props,\n                    viewProps: viewProps,\n                }), viewProps: viewProps }));\n            this.props = config.props;\n            this.valueController = config.valueController;\n            this.view.valueElement.appendChild(this.valueController.view.element);\n        }\n    }\n\n    const ButtonBladePlugin = {\n        id: 'button',\n        type: 'blade',\n        accept(params) {\n            const p = ParamsParsers;\n            const result = parseParams(params, {\n                title: p.required.string,\n                view: p.required.constant('button'),\n                label: p.optional.string,\n            });\n            return result ? { params: result } : null;\n        },\n        controller(args) {\n            return new LabelController(args.document, {\n                blade: args.blade,\n                props: ValueMap.fromObject({\n                    label: args.params.label,\n                }),\n                valueController: new ButtonController(args.document, {\n                    props: ValueMap.fromObject({\n                        title: args.params.title,\n                    }),\n                    viewProps: args.viewProps,\n                }),\n            });\n        },\n        api(args) {\n            if (!(args.controller instanceof LabelController)) {\n                return null;\n            }\n            if (!(args.controller.valueController instanceof ButtonController)) {\n                return null;\n            }\n            return new ButtonApi(args.controller);\n        },\n    };\n\n    class ValueBladeController extends BladeController {\n        constructor(config) {\n            super(config);\n            this.value = config.value;\n        }\n    }\n\n    function createBlade() {\n        return new ValueMap({\n            positions: createValue([], {\n                equals: deepEqualsArray,\n            }),\n        });\n    }\n\n    class Foldable extends ValueMap {\n        constructor(valueMap) {\n            super(valueMap);\n        }\n        static create(expanded) {\n            const coreObj = {\n                completed: true,\n                expanded: expanded,\n                expandedHeight: null,\n                shouldFixHeight: false,\n                temporaryExpanded: null,\n            };\n            const core = ValueMap.createCore(coreObj);\n            return new Foldable(core);\n        }\n        get styleExpanded() {\n            var _a;\n            return (_a = this.get('temporaryExpanded')) !== null && _a !== void 0 ? _a : this.get('expanded');\n        }\n        get styleHeight() {\n            if (!this.styleExpanded) {\n                return '0';\n            }\n            const exHeight = this.get('expandedHeight');\n            if (this.get('shouldFixHeight') && !isEmpty(exHeight)) {\n                return `${exHeight}px`;\n            }\n            return 'auto';\n        }\n        bindExpandedClass(elem, expandedClassName) {\n            const onExpand = () => {\n                const expanded = this.styleExpanded;\n                if (expanded) {\n                    elem.classList.add(expandedClassName);\n                }\n                else {\n                    elem.classList.remove(expandedClassName);\n                }\n            };\n            bindValueMap(this, 'expanded', onExpand);\n            bindValueMap(this, 'temporaryExpanded', onExpand);\n        }\n        cleanUpTransition() {\n            this.set('shouldFixHeight', false);\n            this.set('expandedHeight', null);\n            this.set('completed', true);\n        }\n    }\n    function computeExpandedFolderHeight(folder, containerElement) {\n        let height = 0;\n        disableTransitionTemporarily(containerElement, () => {\n            folder.set('expandedHeight', null);\n            folder.set('temporaryExpanded', true);\n            forceReflow(containerElement);\n            height = containerElement.clientHeight;\n            folder.set('temporaryExpanded', null);\n            forceReflow(containerElement);\n        });\n        return height;\n    }\n    function applyHeight(foldable, elem) {\n        elem.style.height = foldable.styleHeight;\n    }\n    function bindFoldable(foldable, elem) {\n        foldable.value('expanded').emitter.on('beforechange', () => {\n            foldable.set('completed', false);\n            if (isEmpty(foldable.get('expandedHeight'))) {\n                const h = computeExpandedFolderHeight(foldable, elem);\n                if (h > 0) {\n                    foldable.set('expandedHeight', h);\n                }\n            }\n            foldable.set('shouldFixHeight', true);\n            forceReflow(elem);\n        });\n        foldable.emitter.on('change', () => {\n            applyHeight(foldable, elem);\n        });\n        applyHeight(foldable, elem);\n        elem.addEventListener('transitionend', (ev) => {\n            if (ev.propertyName !== 'height') {\n                return;\n            }\n            foldable.cleanUpTransition();\n        });\n    }\n\n    class RackLikeApi extends BladeApi {\n        constructor(controller, rackApi) {\n            super(controller);\n            this.rackApi_ = rackApi;\n        }\n    }\n\n    function addButtonAsBlade(api, params) {\n        return api.addBlade(Object.assign(Object.assign({}, params), { view: 'button' }));\n    }\n    function addFolderAsBlade(api, params) {\n        return api.addBlade(Object.assign(Object.assign({}, params), { view: 'folder' }));\n    }\n    function addSeparatorAsBlade(api, opt_params) {\n        const params = opt_params !== null && opt_params !== void 0 ? opt_params : {};\n        return api.addBlade(Object.assign(Object.assign({}, params), { view: 'separator' }));\n    }\n    function addTabAsBlade(api, params) {\n        return api.addBlade(Object.assign(Object.assign({}, params), { view: 'tab' }));\n    }\n\n    class NestedOrderedSet {\n        constructor(extract) {\n            this.emitter = new Emitter();\n            this.items_ = [];\n            this.cache_ = new Set();\n            this.onSubListAdd_ = this.onSubListAdd_.bind(this);\n            this.onSubListRemove_ = this.onSubListRemove_.bind(this);\n            this.extract_ = extract;\n        }\n        get items() {\n            return this.items_;\n        }\n        allItems() {\n            return Array.from(this.cache_);\n        }\n        find(callback) {\n            for (const item of this.allItems()) {\n                if (callback(item)) {\n                    return item;\n                }\n            }\n            return null;\n        }\n        includes(item) {\n            return this.cache_.has(item);\n        }\n        add(item, opt_index) {\n            if (this.includes(item)) {\n                throw TpError.shouldNeverHappen();\n            }\n            const index = opt_index !== undefined ? opt_index : this.items_.length;\n            this.items_.splice(index, 0, item);\n            this.cache_.add(item);\n            const subList = this.extract_(item);\n            if (subList) {\n                subList.emitter.on('add', this.onSubListAdd_);\n                subList.emitter.on('remove', this.onSubListRemove_);\n                subList.allItems().forEach((item) => {\n                    this.cache_.add(item);\n                });\n            }\n            this.emitter.emit('add', {\n                index: index,\n                item: item,\n                root: this,\n                target: this,\n            });\n        }\n        remove(item) {\n            const index = this.items_.indexOf(item);\n            if (index < 0) {\n                return;\n            }\n            this.items_.splice(index, 1);\n            this.cache_.delete(item);\n            const subList = this.extract_(item);\n            if (subList) {\n                subList.emitter.off('add', this.onSubListAdd_);\n                subList.emitter.off('remove', this.onSubListRemove_);\n            }\n            this.emitter.emit('remove', {\n                index: index,\n                item: item,\n                root: this,\n                target: this,\n            });\n        }\n        onSubListAdd_(ev) {\n            this.cache_.add(ev.item);\n            this.emitter.emit('add', {\n                index: ev.index,\n                item: ev.item,\n                root: this,\n                target: ev.target,\n            });\n        }\n        onSubListRemove_(ev) {\n            this.cache_.delete(ev.item);\n            this.emitter.emit('remove', {\n                index: ev.index,\n                item: ev.item,\n                root: this,\n                target: ev.target,\n            });\n        }\n    }\n\n    class InputBindingApi extends BladeApi {\n        constructor(controller) {\n            super(controller);\n            this.onBindingChange_ = this.onBindingChange_.bind(this);\n            this.emitter_ = new Emitter();\n            this.controller_.binding.emitter.on('change', this.onBindingChange_);\n        }\n        get label() {\n            return this.controller_.props.get('label');\n        }\n        set label(label) {\n            this.controller_.props.set('label', label);\n        }\n        on(eventName, handler) {\n            const bh = handler.bind(this);\n            this.emitter_.on(eventName, (ev) => {\n                bh(ev.event);\n            });\n            return this;\n        }\n        refresh() {\n            this.controller_.binding.read();\n        }\n        onBindingChange_(ev) {\n            const value = ev.sender.target.read();\n            this.emitter_.emit('change', {\n                event: new TpChangeEvent(this, forceCast(value), this.controller_.binding.target.presetKey, ev.options.last),\n            });\n        }\n    }\n\n    class InputBindingController extends LabelController {\n        constructor(doc, config) {\n            super(doc, config);\n            this.binding = config.binding;\n        }\n    }\n\n    class MonitorBindingApi extends BladeApi {\n        constructor(controller) {\n            super(controller);\n            this.onBindingUpdate_ = this.onBindingUpdate_.bind(this);\n            this.emitter_ = new Emitter();\n            this.controller_.binding.emitter.on('update', this.onBindingUpdate_);\n        }\n        get label() {\n            return this.controller_.props.get('label');\n        }\n        set label(label) {\n            this.controller_.props.set('label', label);\n        }\n        on(eventName, handler) {\n            const bh = handler.bind(this);\n            this.emitter_.on(eventName, (ev) => {\n                bh(ev.event);\n            });\n            return this;\n        }\n        refresh() {\n            this.controller_.binding.read();\n        }\n        onBindingUpdate_(ev) {\n            const value = ev.sender.target.read();\n            this.emitter_.emit('update', {\n                event: new TpUpdateEvent(this, forceCast(value), this.controller_.binding.target.presetKey),\n            });\n        }\n    }\n\n    class MonitorBindingController extends LabelController {\n        constructor(doc, config) {\n            super(doc, config);\n            this.binding = config.binding;\n            this.viewProps.bindDisabled(this.binding.ticker);\n            this.viewProps.handleDispose(() => {\n                this.binding.dispose();\n            });\n        }\n    }\n\n    function findSubBladeApiSet(api) {\n        if (api instanceof RackApi) {\n            return api['apiSet_'];\n        }\n        if (api instanceof RackLikeApi) {\n            return api['rackApi_']['apiSet_'];\n        }\n        return null;\n    }\n    function getApiByController(apiSet, controller) {\n        const api = apiSet.find((api) => api.controller_ === controller);\n        if (!api) {\n            throw TpError.shouldNeverHappen();\n        }\n        return api;\n    }\n    function createBindingTarget(obj, key, opt_id) {\n        if (!BindingTarget.isBindable(obj)) {\n            throw TpError.notBindable();\n        }\n        return new BindingTarget(obj, key, opt_id);\n    }\n    class RackApi extends BladeApi {\n        constructor(controller, pool) {\n            super(controller);\n            this.onRackAdd_ = this.onRackAdd_.bind(this);\n            this.onRackRemove_ = this.onRackRemove_.bind(this);\n            this.onRackInputChange_ = this.onRackInputChange_.bind(this);\n            this.onRackMonitorUpdate_ = this.onRackMonitorUpdate_.bind(this);\n            this.emitter_ = new Emitter();\n            this.apiSet_ = new NestedOrderedSet(findSubBladeApiSet);\n            this.pool_ = pool;\n            const rack = this.controller_.rack;\n            rack.emitter.on('add', this.onRackAdd_);\n            rack.emitter.on('remove', this.onRackRemove_);\n            rack.emitter.on('inputchange', this.onRackInputChange_);\n            rack.emitter.on('monitorupdate', this.onRackMonitorUpdate_);\n            rack.children.forEach((bc) => {\n                this.setUpApi_(bc);\n            });\n        }\n        get children() {\n            return this.controller_.rack.children.map((bc) => getApiByController(this.apiSet_, bc));\n        }\n        addInput(object, key, opt_params) {\n            const params = opt_params !== null && opt_params !== void 0 ? opt_params : {};\n            const doc = this.controller_.view.element.ownerDocument;\n            const bc = this.pool_.createInput(doc, createBindingTarget(object, key, params.presetKey), params);\n            const api = new InputBindingApi(bc);\n            return this.add(api, params.index);\n        }\n        addMonitor(object, key, opt_params) {\n            const params = opt_params !== null && opt_params !== void 0 ? opt_params : {};\n            const doc = this.controller_.view.element.ownerDocument;\n            const bc = this.pool_.createMonitor(doc, createBindingTarget(object, key), params);\n            const api = new MonitorBindingApi(bc);\n            return forceCast(this.add(api, params.index));\n        }\n        addFolder(params) {\n            return addFolderAsBlade(this, params);\n        }\n        addButton(params) {\n            return addButtonAsBlade(this, params);\n        }\n        addSeparator(opt_params) {\n            return addSeparatorAsBlade(this, opt_params);\n        }\n        addTab(params) {\n            return addTabAsBlade(this, params);\n        }\n        add(api, opt_index) {\n            this.controller_.rack.add(api.controller_, opt_index);\n            const gapi = this.apiSet_.find((a) => a.controller_ === api.controller_);\n            if (gapi) {\n                this.apiSet_.remove(gapi);\n            }\n            this.apiSet_.add(api);\n            return api;\n        }\n        remove(api) {\n            this.controller_.rack.remove(api.controller_);\n        }\n        addBlade(params) {\n            const doc = this.controller_.view.element.ownerDocument;\n            const bc = this.pool_.createBlade(doc, params);\n            const api = this.pool_.createBladeApi(bc);\n            return this.add(api, params.index);\n        }\n        on(eventName, handler) {\n            const bh = handler.bind(this);\n            this.emitter_.on(eventName, (ev) => {\n                bh(ev.event);\n            });\n            return this;\n        }\n        setUpApi_(bc) {\n            const api = this.apiSet_.find((api) => api.controller_ === bc);\n            if (!api) {\n                this.apiSet_.add(this.pool_.createBladeApi(bc));\n            }\n        }\n        onRackAdd_(ev) {\n            this.setUpApi_(ev.bladeController);\n        }\n        onRackRemove_(ev) {\n            if (ev.isRoot) {\n                const api = getApiByController(this.apiSet_, ev.bladeController);\n                this.apiSet_.remove(api);\n            }\n        }\n        onRackInputChange_(ev) {\n            const bc = ev.bladeController;\n            if (bc instanceof InputBindingController) {\n                const api = getApiByController(this.apiSet_, bc);\n                const binding = bc.binding;\n                this.emitter_.emit('change', {\n                    event: new TpChangeEvent(api, forceCast(binding.target.read()), binding.target.presetKey, ev.options.last),\n                });\n            }\n            else if (bc instanceof ValueBladeController) {\n                const api = getApiByController(this.apiSet_, bc);\n                this.emitter_.emit('change', {\n                    event: new TpChangeEvent(api, bc.value.rawValue, undefined, ev.options.last),\n                });\n            }\n        }\n        onRackMonitorUpdate_(ev) {\n            if (!(ev.bladeController instanceof MonitorBindingController)) {\n                throw TpError.shouldNeverHappen();\n            }\n            const api = getApiByController(this.apiSet_, ev.bladeController);\n            const binding = ev.bladeController.binding;\n            this.emitter_.emit('update', {\n                event: new TpUpdateEvent(api, forceCast(binding.target.read()), binding.target.presetKey),\n            });\n        }\n    }\n\n    class FolderApi extends RackLikeApi {\n        constructor(controller, pool) {\n            super(controller, new RackApi(controller.rackController, pool));\n            this.emitter_ = new Emitter();\n            this.controller_.foldable\n                .value('expanded')\n                .emitter.on('change', (ev) => {\n                this.emitter_.emit('fold', {\n                    event: new TpFoldEvent(this, ev.sender.rawValue),\n                });\n            });\n            this.rackApi_.on('change', (ev) => {\n                this.emitter_.emit('change', {\n                    event: ev,\n                });\n            });\n            this.rackApi_.on('update', (ev) => {\n                this.emitter_.emit('update', {\n                    event: ev,\n                });\n            });\n        }\n        get expanded() {\n            return this.controller_.foldable.get('expanded');\n        }\n        set expanded(expanded) {\n            this.controller_.foldable.set('expanded', expanded);\n        }\n        get title() {\n            return this.controller_.props.get('title');\n        }\n        set title(title) {\n            this.controller_.props.set('title', title);\n        }\n        get children() {\n            return this.rackApi_.children;\n        }\n        addInput(object, key, opt_params) {\n            return this.rackApi_.addInput(object, key, opt_params);\n        }\n        addMonitor(object, key, opt_params) {\n            return this.rackApi_.addMonitor(object, key, opt_params);\n        }\n        addFolder(params) {\n            return this.rackApi_.addFolder(params);\n        }\n        addButton(params) {\n            return this.rackApi_.addButton(params);\n        }\n        addSeparator(opt_params) {\n            return this.rackApi_.addSeparator(opt_params);\n        }\n        addTab(params) {\n            return this.rackApi_.addTab(params);\n        }\n        add(api, opt_index) {\n            return this.rackApi_.add(api, opt_index);\n        }\n        remove(api) {\n            this.rackApi_.remove(api);\n        }\n        addBlade(params) {\n            return this.rackApi_.addBlade(params);\n        }\n        on(eventName, handler) {\n            const bh = handler.bind(this);\n            this.emitter_.on(eventName, (ev) => {\n                bh(ev.event);\n            });\n            return this;\n        }\n    }\n\n    class RackLikeController extends BladeController {\n        constructor(config) {\n            super({\n                blade: config.blade,\n                view: config.view,\n                viewProps: config.rackController.viewProps,\n            });\n            this.rackController = config.rackController;\n        }\n    }\n\n    class PlainView {\n        constructor(doc, config) {\n            const className = ClassName(config.viewName);\n            this.element = doc.createElement('div');\n            this.element.classList.add(className());\n            config.viewProps.bindClassModifiers(this.element);\n        }\n    }\n\n    function findInputBindingController(bcs, b) {\n        for (let i = 0; i < bcs.length; i++) {\n            const bc = bcs[i];\n            if (bc instanceof InputBindingController && bc.binding === b) {\n                return bc;\n            }\n        }\n        return null;\n    }\n    function findMonitorBindingController(bcs, b) {\n        for (let i = 0; i < bcs.length; i++) {\n            const bc = bcs[i];\n            if (bc instanceof MonitorBindingController && bc.binding === b) {\n                return bc;\n            }\n        }\n        return null;\n    }\n    function findValueBladeController(bcs, v) {\n        for (let i = 0; i < bcs.length; i++) {\n            const bc = bcs[i];\n            if (bc instanceof ValueBladeController && bc.value === v) {\n                return bc;\n            }\n        }\n        return null;\n    }\n    function findSubRack(bc) {\n        if (bc instanceof RackController) {\n            return bc.rack;\n        }\n        if (bc instanceof RackLikeController) {\n            return bc.rackController.rack;\n        }\n        return null;\n    }\n    function findSubBladeControllerSet(bc) {\n        const rack = findSubRack(bc);\n        return rack ? rack['bcSet_'] : null;\n    }\n    class BladeRack {\n        constructor(config) {\n            var _a, _b;\n            this.onBladePositionsChange_ = this.onBladePositionsChange_.bind(this);\n            this.onSetAdd_ = this.onSetAdd_.bind(this);\n            this.onSetRemove_ = this.onSetRemove_.bind(this);\n            this.onChildDispose_ = this.onChildDispose_.bind(this);\n            this.onChildPositionsChange_ = this.onChildPositionsChange_.bind(this);\n            this.onChildInputChange_ = this.onChildInputChange_.bind(this);\n            this.onChildMonitorUpdate_ = this.onChildMonitorUpdate_.bind(this);\n            this.onChildValueChange_ = this.onChildValueChange_.bind(this);\n            this.onChildViewPropsChange_ = this.onChildViewPropsChange_.bind(this);\n            this.onDescendantLayout_ = this.onDescendantLayout_.bind(this);\n            this.onDescendantInputChange_ = this.onDescendantInputChange_.bind(this);\n            this.onDescendantMonitorUpdate_ =\n                this.onDescendantMonitorUpdate_.bind(this);\n            this.emitter = new Emitter();\n            this.blade_ = (_a = config.blade) !== null && _a !== void 0 ? _a : null;\n            (_b = this.blade_) === null || _b === void 0 ? void 0 : _b.value('positions').emitter.on('change', this.onBladePositionsChange_);\n            this.viewProps = config.viewProps;\n            this.bcSet_ = new NestedOrderedSet(findSubBladeControllerSet);\n            this.bcSet_.emitter.on('add', this.onSetAdd_);\n            this.bcSet_.emitter.on('remove', this.onSetRemove_);\n        }\n        get children() {\n            return this.bcSet_.items;\n        }\n        add(bc, opt_index) {\n            var _a;\n            (_a = bc.parent) === null || _a === void 0 ? void 0 : _a.remove(bc);\n            if (isPropertyWritable(bc, 'parent')) {\n                bc.parent = this;\n            }\n            else {\n                bc['parent_'] = this;\n                warnMissing({\n                    key: 'parent',\n                    target: 'BladeController',\n                    place: 'BladeRack.add',\n                });\n            }\n            this.bcSet_.add(bc, opt_index);\n        }\n        remove(bc) {\n            if (isPropertyWritable(bc, 'parent')) {\n                bc.parent = null;\n            }\n            else {\n                bc['parent_'] = null;\n                warnMissing({\n                    key: 'parent',\n                    target: 'BladeController',\n                    place: 'BladeRack.remove',\n                });\n            }\n            this.bcSet_.remove(bc);\n        }\n        find(controllerClass) {\n            return forceCast(this.bcSet_.allItems().filter((bc) => {\n                return bc instanceof controllerClass;\n            }));\n        }\n        onSetAdd_(ev) {\n            this.updatePositions_();\n            const isRoot = ev.target === ev.root;\n            this.emitter.emit('add', {\n                bladeController: ev.item,\n                index: ev.index,\n                isRoot: isRoot,\n                sender: this,\n            });\n            if (!isRoot) {\n                return;\n            }\n            const bc = ev.item;\n            bc.viewProps.emitter.on('change', this.onChildViewPropsChange_);\n            bc.blade\n                .value('positions')\n                .emitter.on('change', this.onChildPositionsChange_);\n            bc.viewProps.handleDispose(this.onChildDispose_);\n            if (bc instanceof InputBindingController) {\n                bc.binding.emitter.on('change', this.onChildInputChange_);\n            }\n            else if (bc instanceof MonitorBindingController) {\n                bc.binding.emitter.on('update', this.onChildMonitorUpdate_);\n            }\n            else if (bc instanceof ValueBladeController) {\n                bc.value.emitter.on('change', this.onChildValueChange_);\n            }\n            else {\n                const rack = findSubRack(bc);\n                if (rack) {\n                    const emitter = rack.emitter;\n                    emitter.on('layout', this.onDescendantLayout_);\n                    emitter.on('inputchange', this.onDescendantInputChange_);\n                    emitter.on('monitorupdate', this.onDescendantMonitorUpdate_);\n                }\n            }\n        }\n        onSetRemove_(ev) {\n            this.updatePositions_();\n            const isRoot = ev.target === ev.root;\n            this.emitter.emit('remove', {\n                bladeController: ev.item,\n                isRoot: isRoot,\n                sender: this,\n            });\n            if (!isRoot) {\n                return;\n            }\n            const bc = ev.item;\n            if (bc instanceof InputBindingController) {\n                bc.binding.emitter.off('change', this.onChildInputChange_);\n            }\n            else if (bc instanceof MonitorBindingController) {\n                bc.binding.emitter.off('update', this.onChildMonitorUpdate_);\n            }\n            else if (bc instanceof ValueBladeController) {\n                bc.value.emitter.off('change', this.onChildValueChange_);\n            }\n            else {\n                const rack = findSubRack(bc);\n                if (rack) {\n                    const emitter = rack.emitter;\n                    emitter.off('layout', this.onDescendantLayout_);\n                    emitter.off('inputchange', this.onDescendantInputChange_);\n                    emitter.off('monitorupdate', this.onDescendantMonitorUpdate_);\n                }\n            }\n        }\n        updatePositions_() {\n            const visibleItems = this.bcSet_.items.filter((bc) => !bc.viewProps.get('hidden'));\n            const firstVisibleItem = visibleItems[0];\n            const lastVisibleItem = visibleItems[visibleItems.length - 1];\n            this.bcSet_.items.forEach((bc) => {\n                const ps = [];\n                if (bc === firstVisibleItem) {\n                    ps.push('first');\n                    if (!this.blade_ ||\n                        this.blade_.get('positions').includes('veryfirst')) {\n                        ps.push('veryfirst');\n                    }\n                }\n                if (bc === lastVisibleItem) {\n                    ps.push('last');\n                    if (!this.blade_ || this.blade_.get('positions').includes('verylast')) {\n                        ps.push('verylast');\n                    }\n                }\n                bc.blade.set('positions', ps);\n            });\n        }\n        onChildPositionsChange_() {\n            this.updatePositions_();\n            this.emitter.emit('layout', {\n                sender: this,\n            });\n        }\n        onChildViewPropsChange_(_ev) {\n            this.updatePositions_();\n            this.emitter.emit('layout', {\n                sender: this,\n            });\n        }\n        onChildDispose_() {\n            const disposedUcs = this.bcSet_.items.filter((bc) => {\n                return bc.viewProps.get('disposed');\n            });\n            disposedUcs.forEach((bc) => {\n                this.bcSet_.remove(bc);\n            });\n        }\n        onChildInputChange_(ev) {\n            const bc = findInputBindingController(this.find(InputBindingController), ev.sender);\n            if (!bc) {\n                throw TpError.alreadyDisposed();\n            }\n            this.emitter.emit('inputchange', {\n                bladeController: bc,\n                options: ev.options,\n                sender: this,\n            });\n        }\n        onChildMonitorUpdate_(ev) {\n            const bc = findMonitorBindingController(this.find(MonitorBindingController), ev.sender);\n            if (!bc) {\n                throw TpError.alreadyDisposed();\n            }\n            this.emitter.emit('monitorupdate', {\n                bladeController: bc,\n                sender: this,\n            });\n        }\n        onChildValueChange_(ev) {\n            const bc = findValueBladeController(this.find(ValueBladeController), ev.sender);\n            if (!bc) {\n                throw TpError.alreadyDisposed();\n            }\n            this.emitter.emit('inputchange', {\n                bladeController: bc,\n                options: ev.options,\n                sender: this,\n            });\n        }\n        onDescendantLayout_(_) {\n            this.updatePositions_();\n            this.emitter.emit('layout', {\n                sender: this,\n            });\n        }\n        onDescendantInputChange_(ev) {\n            this.emitter.emit('inputchange', {\n                bladeController: ev.bladeController,\n                options: ev.options,\n                sender: this,\n            });\n        }\n        onDescendantMonitorUpdate_(ev) {\n            this.emitter.emit('monitorupdate', {\n                bladeController: ev.bladeController,\n                sender: this,\n            });\n        }\n        onBladePositionsChange_() {\n            this.updatePositions_();\n        }\n    }\n\n    class RackController extends BladeController {\n        constructor(doc, config) {\n            super(Object.assign(Object.assign({}, config), { view: new PlainView(doc, {\n                    viewName: 'brk',\n                    viewProps: config.viewProps,\n                }) }));\n            this.onRackAdd_ = this.onRackAdd_.bind(this);\n            this.onRackRemove_ = this.onRackRemove_.bind(this);\n            const rack = new BladeRack({\n                blade: config.root ? undefined : config.blade,\n                viewProps: config.viewProps,\n            });\n            rack.emitter.on('add', this.onRackAdd_);\n            rack.emitter.on('remove', this.onRackRemove_);\n            this.rack = rack;\n            this.viewProps.handleDispose(() => {\n                for (let i = this.rack.children.length - 1; i >= 0; i--) {\n                    const bc = this.rack.children[i];\n                    bc.viewProps.set('disposed', true);\n                }\n            });\n        }\n        onRackAdd_(ev) {\n            if (!ev.isRoot) {\n                return;\n            }\n            insertElementAt(this.view.element, ev.bladeController.view.element, ev.index);\n        }\n        onRackRemove_(ev) {\n            if (!ev.isRoot) {\n                return;\n            }\n            removeElement(ev.bladeController.view.element);\n        }\n    }\n\n    const bladeContainerClassName = ClassName('cnt');\n\n    class FolderView {\n        constructor(doc, config) {\n            var _a;\n            this.className_ = ClassName((_a = config.viewName) !== null && _a !== void 0 ? _a : 'fld');\n            this.element = doc.createElement('div');\n            this.element.classList.add(this.className_(), bladeContainerClassName());\n            config.viewProps.bindClassModifiers(this.element);\n            this.foldable_ = config.foldable;\n            this.foldable_.bindExpandedClass(this.element, this.className_(undefined, 'expanded'));\n            bindValueMap(this.foldable_, 'completed', valueToClassName(this.element, this.className_(undefined, 'cpl')));\n            const buttonElem = doc.createElement('button');\n            buttonElem.classList.add(this.className_('b'));\n            bindValueMap(config.props, 'title', (title) => {\n                if (isEmpty(title)) {\n                    this.element.classList.add(this.className_(undefined, 'not'));\n                }\n                else {\n                    this.element.classList.remove(this.className_(undefined, 'not'));\n                }\n            });\n            config.viewProps.bindDisabled(buttonElem);\n            this.element.appendChild(buttonElem);\n            this.buttonElement = buttonElem;\n            const indentElem = doc.createElement('div');\n            indentElem.classList.add(this.className_('i'));\n            this.element.appendChild(indentElem);\n            const titleElem = doc.createElement('div');\n            titleElem.classList.add(this.className_('t'));\n            bindValueToTextContent(config.props.value('title'), titleElem);\n            this.buttonElement.appendChild(titleElem);\n            this.titleElement = titleElem;\n            const markElem = doc.createElement('div');\n            markElem.classList.add(this.className_('m'));\n            this.buttonElement.appendChild(markElem);\n            const containerElem = config.containerElement;\n            containerElem.classList.add(this.className_('c'));\n            this.element.appendChild(containerElem);\n            this.containerElement = containerElem;\n        }\n    }\n\n    class FolderController extends RackLikeController {\n        constructor(doc, config) {\n            var _a;\n            const foldable = Foldable.create((_a = config.expanded) !== null && _a !== void 0 ? _a : true);\n            const rc = new RackController(doc, {\n                blade: config.blade,\n                root: config.root,\n                viewProps: config.viewProps,\n            });\n            super(Object.assign(Object.assign({}, config), { rackController: rc, view: new FolderView(doc, {\n                    containerElement: rc.view.element,\n                    foldable: foldable,\n                    props: config.props,\n                    viewName: config.root ? 'rot' : undefined,\n                    viewProps: config.viewProps,\n                }) }));\n            this.onTitleClick_ = this.onTitleClick_.bind(this);\n            this.props = config.props;\n            this.foldable = foldable;\n            bindFoldable(this.foldable, this.view.containerElement);\n            this.rackController.rack.emitter.on('add', () => {\n                this.foldable.cleanUpTransition();\n            });\n            this.rackController.rack.emitter.on('remove', () => {\n                this.foldable.cleanUpTransition();\n            });\n            this.view.buttonElement.addEventListener('click', this.onTitleClick_);\n        }\n        get document() {\n            return this.view.element.ownerDocument;\n        }\n        onTitleClick_() {\n            this.foldable.set('expanded', !this.foldable.get('expanded'));\n        }\n    }\n\n    const FolderBladePlugin = {\n        id: 'folder',\n        type: 'blade',\n        accept(params) {\n            const p = ParamsParsers;\n            const result = parseParams(params, {\n                title: p.required.string,\n                view: p.required.constant('folder'),\n                expanded: p.optional.boolean,\n            });\n            return result ? { params: result } : null;\n        },\n        controller(args) {\n            return new FolderController(args.document, {\n                blade: args.blade,\n                expanded: args.params.expanded,\n                props: ValueMap.fromObject({\n                    title: args.params.title,\n                }),\n                viewProps: args.viewProps,\n            });\n        },\n        api(args) {\n            if (!(args.controller instanceof FolderController)) {\n                return null;\n            }\n            return new FolderApi(args.controller, args.pool);\n        },\n    };\n\n    class LabeledValueController extends ValueBladeController {\n        constructor(doc, config) {\n            const viewProps = config.valueController.viewProps;\n            super(Object.assign(Object.assign({}, config), { value: config.valueController.value, view: new LabelView(doc, {\n                    props: config.props,\n                    viewProps: viewProps,\n                }), viewProps: viewProps }));\n            this.props = config.props;\n            this.valueController = config.valueController;\n            this.view.valueElement.appendChild(this.valueController.view.element);\n        }\n    }\n\n    class SeparatorApi extends BladeApi {\n    }\n\n    const className$m = ClassName('spr');\n    class SeparatorView {\n        constructor(doc, config) {\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$m());\n            config.viewProps.bindClassModifiers(this.element);\n            const hrElem = doc.createElement('hr');\n            hrElem.classList.add(className$m('r'));\n            this.element.appendChild(hrElem);\n        }\n    }\n\n    class SeparatorController extends BladeController {\n        constructor(doc, config) {\n            super(Object.assign(Object.assign({}, config), { view: new SeparatorView(doc, {\n                    viewProps: config.viewProps,\n                }) }));\n        }\n    }\n\n    const SeparatorBladePlugin = {\n        id: 'separator',\n        type: 'blade',\n        accept(params) {\n            const p = ParamsParsers;\n            const result = parseParams(params, {\n                view: p.required.constant('separator'),\n            });\n            return result ? { params: result } : null;\n        },\n        controller(args) {\n            return new SeparatorController(args.document, {\n                blade: args.blade,\n                viewProps: args.viewProps,\n            });\n        },\n        api(args) {\n            if (!(args.controller instanceof SeparatorController)) {\n                return null;\n            }\n            return new SeparatorApi(args.controller);\n        },\n    };\n\n    const className$l = ClassName('tbi');\n    class TabItemView {\n        constructor(doc, config) {\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$l());\n            config.viewProps.bindClassModifiers(this.element);\n            bindValueMap(config.props, 'selected', (selected) => {\n                if (selected) {\n                    this.element.classList.add(className$l(undefined, 'sel'));\n                }\n                else {\n                    this.element.classList.remove(className$l(undefined, 'sel'));\n                }\n            });\n            const buttonElem = doc.createElement('button');\n            buttonElem.classList.add(className$l('b'));\n            config.viewProps.bindDisabled(buttonElem);\n            this.element.appendChild(buttonElem);\n            this.buttonElement = buttonElem;\n            const titleElem = doc.createElement('div');\n            titleElem.classList.add(className$l('t'));\n            bindValueToTextContent(config.props.value('title'), titleElem);\n            this.buttonElement.appendChild(titleElem);\n            this.titleElement = titleElem;\n        }\n    }\n\n    class TabItemController {\n        constructor(doc, config) {\n            this.emitter = new Emitter();\n            this.onClick_ = this.onClick_.bind(this);\n            this.props = config.props;\n            this.viewProps = config.viewProps;\n            this.view = new TabItemView(doc, {\n                props: config.props,\n                viewProps: config.viewProps,\n            });\n            this.view.buttonElement.addEventListener('click', this.onClick_);\n        }\n        onClick_() {\n            this.emitter.emit('click', {\n                sender: this,\n            });\n        }\n    }\n\n    class TabPageController {\n        constructor(doc, config) {\n            this.onItemClick_ = this.onItemClick_.bind(this);\n            this.ic_ = new TabItemController(doc, {\n                props: config.itemProps,\n                viewProps: ViewProps.create(),\n            });\n            this.ic_.emitter.on('click', this.onItemClick_);\n            this.cc_ = new RackController(doc, {\n                blade: createBlade(),\n                viewProps: ViewProps.create(),\n            });\n            this.props = config.props;\n            bindValueMap(this.props, 'selected', (selected) => {\n                this.itemController.props.set('selected', selected);\n                this.contentController.viewProps.set('hidden', !selected);\n            });\n        }\n        get itemController() {\n            return this.ic_;\n        }\n        get contentController() {\n            return this.cc_;\n        }\n        onItemClick_() {\n            this.props.set('selected', true);\n        }\n    }\n\n    class TabPageApi {\n        constructor(controller, contentRackApi) {\n            this.controller_ = controller;\n            this.rackApi_ = contentRackApi;\n        }\n        get title() {\n            var _a;\n            return (_a = this.controller_.itemController.props.get('title')) !== null && _a !== void 0 ? _a : '';\n        }\n        set title(title) {\n            this.controller_.itemController.props.set('title', title);\n        }\n        get selected() {\n            return this.controller_.props.get('selected');\n        }\n        set selected(selected) {\n            this.controller_.props.set('selected', selected);\n        }\n        get children() {\n            return this.rackApi_.children;\n        }\n        addButton(params) {\n            return this.rackApi_.addButton(params);\n        }\n        addFolder(params) {\n            return this.rackApi_.addFolder(params);\n        }\n        addSeparator(opt_params) {\n            return this.rackApi_.addSeparator(opt_params);\n        }\n        addTab(params) {\n            return this.rackApi_.addTab(params);\n        }\n        add(api, opt_index) {\n            this.rackApi_.add(api, opt_index);\n        }\n        remove(api) {\n            this.rackApi_.remove(api);\n        }\n        addInput(object, key, opt_params) {\n            return this.rackApi_.addInput(object, key, opt_params);\n        }\n        addMonitor(object, key, opt_params) {\n            return this.rackApi_.addMonitor(object, key, opt_params);\n        }\n        addBlade(params) {\n            return this.rackApi_.addBlade(params);\n        }\n    }\n\n    class TabApi extends RackLikeApi {\n        constructor(controller, pool) {\n            super(controller, new RackApi(controller.rackController, pool));\n            this.onPageAdd_ = this.onPageAdd_.bind(this);\n            this.onPageRemove_ = this.onPageRemove_.bind(this);\n            this.onSelect_ = this.onSelect_.bind(this);\n            this.emitter_ = new Emitter();\n            this.pageApiMap_ = new Map();\n            this.rackApi_.on('change', (ev) => {\n                this.emitter_.emit('change', {\n                    event: ev,\n                });\n            });\n            this.rackApi_.on('update', (ev) => {\n                this.emitter_.emit('update', {\n                    event: ev,\n                });\n            });\n            this.controller_.tab.selectedIndex.emitter.on('change', this.onSelect_);\n            this.controller_.pageSet.emitter.on('add', this.onPageAdd_);\n            this.controller_.pageSet.emitter.on('remove', this.onPageRemove_);\n            this.controller_.pageSet.items.forEach((pc) => {\n                this.setUpPageApi_(pc);\n            });\n        }\n        get pages() {\n            return this.controller_.pageSet.items.map((pc) => {\n                const api = this.pageApiMap_.get(pc);\n                if (!api) {\n                    throw TpError.shouldNeverHappen();\n                }\n                return api;\n            });\n        }\n        addPage(params) {\n            const doc = this.controller_.view.element.ownerDocument;\n            const pc = new TabPageController(doc, {\n                itemProps: ValueMap.fromObject({\n                    selected: false,\n                    title: params.title,\n                }),\n                props: ValueMap.fromObject({\n                    selected: false,\n                }),\n            });\n            this.controller_.add(pc, params.index);\n            const api = this.pageApiMap_.get(pc);\n            if (!api) {\n                throw TpError.shouldNeverHappen();\n            }\n            return api;\n        }\n        removePage(index) {\n            this.controller_.remove(index);\n        }\n        on(eventName, handler) {\n            const bh = handler.bind(this);\n            this.emitter_.on(eventName, (ev) => {\n                bh(ev.event);\n            });\n            return this;\n        }\n        setUpPageApi_(pc) {\n            const rackApi = this.rackApi_['apiSet_'].find((api) => api.controller_ === pc.contentController);\n            if (!rackApi) {\n                throw TpError.shouldNeverHappen();\n            }\n            const api = new TabPageApi(pc, rackApi);\n            this.pageApiMap_.set(pc, api);\n        }\n        onPageAdd_(ev) {\n            this.setUpPageApi_(ev.item);\n        }\n        onPageRemove_(ev) {\n            const api = this.pageApiMap_.get(ev.item);\n            if (!api) {\n                throw TpError.shouldNeverHappen();\n            }\n            this.pageApiMap_.delete(ev.item);\n        }\n        onSelect_(ev) {\n            this.emitter_.emit('select', {\n                event: new TpTabSelectEvent(this, ev.rawValue),\n            });\n        }\n    }\n\n    const INDEX_NOT_SELECTED = -1;\n    class Tab {\n        constructor() {\n            this.onItemSelectedChange_ = this.onItemSelectedChange_.bind(this);\n            this.empty = createValue(true);\n            this.selectedIndex = createValue(INDEX_NOT_SELECTED);\n            this.items_ = [];\n        }\n        add(item, opt_index) {\n            const index = opt_index !== null && opt_index !== void 0 ? opt_index : this.items_.length;\n            this.items_.splice(index, 0, item);\n            item.emitter.on('change', this.onItemSelectedChange_);\n            this.keepSelection_();\n        }\n        remove(item) {\n            const index = this.items_.indexOf(item);\n            if (index < 0) {\n                return;\n            }\n            this.items_.splice(index, 1);\n            item.emitter.off('change', this.onItemSelectedChange_);\n            this.keepSelection_();\n        }\n        keepSelection_() {\n            if (this.items_.length === 0) {\n                this.selectedIndex.rawValue = INDEX_NOT_SELECTED;\n                this.empty.rawValue = true;\n                return;\n            }\n            const firstSelIndex = this.items_.findIndex((s) => s.rawValue);\n            if (firstSelIndex < 0) {\n                this.items_.forEach((s, i) => {\n                    s.rawValue = i === 0;\n                });\n                this.selectedIndex.rawValue = 0;\n            }\n            else {\n                this.items_.forEach((s, i) => {\n                    s.rawValue = i === firstSelIndex;\n                });\n                this.selectedIndex.rawValue = firstSelIndex;\n            }\n            this.empty.rawValue = false;\n        }\n        onItemSelectedChange_(ev) {\n            if (ev.rawValue) {\n                const index = this.items_.findIndex((s) => s === ev.sender);\n                this.items_.forEach((s, i) => {\n                    s.rawValue = i === index;\n                });\n                this.selectedIndex.rawValue = index;\n            }\n            else {\n                this.keepSelection_();\n            }\n        }\n    }\n\n    const className$k = ClassName('tab');\n    class TabView {\n        constructor(doc, config) {\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$k(), bladeContainerClassName());\n            config.viewProps.bindClassModifiers(this.element);\n            bindValue(config.empty, valueToClassName(this.element, className$k(undefined, 'nop')));\n            const titleElem = doc.createElement('div');\n            titleElem.classList.add(className$k('t'));\n            this.element.appendChild(titleElem);\n            this.itemsElement = titleElem;\n            const indentElem = doc.createElement('div');\n            indentElem.classList.add(className$k('i'));\n            this.element.appendChild(indentElem);\n            const contentsElem = config.contentsElement;\n            contentsElem.classList.add(className$k('c'));\n            this.element.appendChild(contentsElem);\n            this.contentsElement = contentsElem;\n        }\n    }\n\n    class TabController extends RackLikeController {\n        constructor(doc, config) {\n            const cr = new RackController(doc, {\n                blade: config.blade,\n                viewProps: config.viewProps,\n            });\n            const tab = new Tab();\n            super({\n                blade: config.blade,\n                rackController: cr,\n                view: new TabView(doc, {\n                    contentsElement: cr.view.element,\n                    empty: tab.empty,\n                    viewProps: config.viewProps,\n                }),\n            });\n            this.onPageAdd_ = this.onPageAdd_.bind(this);\n            this.onPageRemove_ = this.onPageRemove_.bind(this);\n            this.pageSet_ = new NestedOrderedSet(() => null);\n            this.pageSet_.emitter.on('add', this.onPageAdd_);\n            this.pageSet_.emitter.on('remove', this.onPageRemove_);\n            this.tab = tab;\n        }\n        get pageSet() {\n            return this.pageSet_;\n        }\n        add(pc, opt_index) {\n            this.pageSet_.add(pc, opt_index);\n        }\n        remove(index) {\n            this.pageSet_.remove(this.pageSet_.items[index]);\n        }\n        onPageAdd_(ev) {\n            const pc = ev.item;\n            insertElementAt(this.view.itemsElement, pc.itemController.view.element, ev.index);\n            pc.itemController.viewProps.set('parent', this.viewProps);\n            this.rackController.rack.add(pc.contentController, ev.index);\n            this.tab.add(pc.props.value('selected'));\n        }\n        onPageRemove_(ev) {\n            const pc = ev.item;\n            removeElement(pc.itemController.view.element);\n            pc.itemController.viewProps.set('parent', null);\n            this.rackController.rack.remove(pc.contentController);\n            this.tab.remove(pc.props.value('selected'));\n        }\n    }\n\n    const TabBladePlugin = {\n        id: 'tab',\n        type: 'blade',\n        accept(params) {\n            const p = ParamsParsers;\n            const result = parseParams(params, {\n                pages: p.required.array(p.required.object({ title: p.required.string })),\n                view: p.required.constant('tab'),\n            });\n            if (!result || result.pages.length === 0) {\n                return null;\n            }\n            return { params: result };\n        },\n        controller(args) {\n            const c = new TabController(args.document, {\n                blade: args.blade,\n                viewProps: args.viewProps,\n            });\n            args.params.pages.forEach((p) => {\n                const pc = new TabPageController(args.document, {\n                    itemProps: ValueMap.fromObject({\n                        selected: false,\n                        title: p.title,\n                    }),\n                    props: ValueMap.fromObject({\n                        selected: false,\n                    }),\n                });\n                c.add(pc);\n            });\n            return c;\n        },\n        api(args) {\n            if (!(args.controller instanceof TabController)) {\n                return null;\n            }\n            return new TabApi(args.controller, args.pool);\n        },\n    };\n\n    function createBladeController(plugin, args) {\n        const ac = plugin.accept(args.params);\n        if (!ac) {\n            return null;\n        }\n        const disabled = ParamsParsers.optional.boolean(args.params['disabled']).value;\n        const hidden = ParamsParsers.optional.boolean(args.params['hidden']).value;\n        return plugin.controller({\n            blade: createBlade(),\n            document: args.document,\n            params: forceCast(Object.assign(Object.assign({}, ac.params), { disabled: disabled, hidden: hidden })),\n            viewProps: ViewProps.create({\n                disabled: disabled,\n                hidden: hidden,\n            }),\n        });\n    }\n\n    class ManualTicker {\n        constructor() {\n            this.disabled = false;\n            this.emitter = new Emitter();\n        }\n        dispose() { }\n        tick() {\n            if (this.disabled) {\n                return;\n            }\n            this.emitter.emit('tick', {\n                sender: this,\n            });\n        }\n    }\n\n    class IntervalTicker {\n        constructor(doc, interval) {\n            this.disabled_ = false;\n            this.timerId_ = null;\n            this.onTick_ = this.onTick_.bind(this);\n            this.doc_ = doc;\n            this.emitter = new Emitter();\n            this.interval_ = interval;\n            this.setTimer_();\n        }\n        get disabled() {\n            return this.disabled_;\n        }\n        set disabled(inactive) {\n            this.disabled_ = inactive;\n            if (this.disabled_) {\n                this.clearTimer_();\n            }\n            else {\n                this.setTimer_();\n            }\n        }\n        dispose() {\n            this.clearTimer_();\n        }\n        clearTimer_() {\n            if (this.timerId_ === null) {\n                return;\n            }\n            const win = this.doc_.defaultView;\n            if (win) {\n                win.clearInterval(this.timerId_);\n            }\n            this.timerId_ = null;\n        }\n        setTimer_() {\n            this.clearTimer_();\n            if (this.interval_ <= 0) {\n                return;\n            }\n            const win = this.doc_.defaultView;\n            if (win) {\n                this.timerId_ = win.setInterval(this.onTick_, this.interval_);\n            }\n        }\n        onTick_() {\n            if (this.disabled_) {\n                return;\n            }\n            this.emitter.emit('tick', {\n                sender: this,\n            });\n        }\n    }\n\n    class InputBinding {\n        constructor(config) {\n            this.onValueChange_ = this.onValueChange_.bind(this);\n            this.reader = config.reader;\n            this.writer = config.writer;\n            this.emitter = new Emitter();\n            this.value = config.value;\n            this.value.emitter.on('change', this.onValueChange_);\n            this.target = config.target;\n            this.read();\n        }\n        read() {\n            const targetValue = this.target.read();\n            if (targetValue !== undefined) {\n                this.value.rawValue = this.reader(targetValue);\n            }\n        }\n        write_(rawValue) {\n            this.writer(this.target, rawValue);\n        }\n        onValueChange_(ev) {\n            this.write_(ev.rawValue);\n            this.emitter.emit('change', {\n                options: ev.options,\n                rawValue: ev.rawValue,\n                sender: this,\n            });\n        }\n    }\n\n    function fillBuffer(buffer, bufferSize) {\n        while (buffer.length < bufferSize) {\n            buffer.push(undefined);\n        }\n    }\n    function initializeBuffer(bufferSize) {\n        const buffer = [];\n        fillBuffer(buffer, bufferSize);\n        return createValue(buffer);\n    }\n    function createTrimmedBuffer(buffer) {\n        const index = buffer.indexOf(undefined);\n        return forceCast(index < 0 ? buffer : buffer.slice(0, index));\n    }\n    function createPushedBuffer(buffer, newValue) {\n        const newBuffer = [...createTrimmedBuffer(buffer), newValue];\n        if (newBuffer.length > buffer.length) {\n            newBuffer.splice(0, newBuffer.length - buffer.length);\n        }\n        else {\n            fillBuffer(newBuffer, buffer.length);\n        }\n        return newBuffer;\n    }\n\n    class MonitorBinding {\n        constructor(config) {\n            this.onTick_ = this.onTick_.bind(this);\n            this.reader_ = config.reader;\n            this.target = config.target;\n            this.emitter = new Emitter();\n            this.value = config.value;\n            this.ticker = config.ticker;\n            this.ticker.emitter.on('tick', this.onTick_);\n            this.read();\n        }\n        dispose() {\n            this.ticker.dispose();\n        }\n        read() {\n            const targetValue = this.target.read();\n            if (targetValue === undefined) {\n                return;\n            }\n            const buffer = this.value.rawValue;\n            const newValue = this.reader_(targetValue);\n            this.value.rawValue = createPushedBuffer(buffer, newValue);\n            this.emitter.emit('update', {\n                rawValue: newValue,\n                sender: this,\n            });\n        }\n        onTick_(_) {\n            this.read();\n        }\n    }\n\n    class CompositeConstraint {\n        constructor(constraints) {\n            this.constraints = constraints;\n        }\n        constrain(value) {\n            return this.constraints.reduce((result, c) => {\n                return c.constrain(result);\n            }, value);\n        }\n    }\n    function findConstraint(c, constraintClass) {\n        if (c instanceof constraintClass) {\n            return c;\n        }\n        if (c instanceof CompositeConstraint) {\n            const result = c.constraints.reduce((tmpResult, sc) => {\n                if (tmpResult) {\n                    return tmpResult;\n                }\n                return sc instanceof constraintClass ? sc : null;\n            }, null);\n            if (result) {\n                return result;\n            }\n        }\n        return null;\n    }\n\n    class DefiniteRangeConstraint {\n        constructor(config) {\n            this.values = ValueMap.fromObject({\n                max: config.max,\n                min: config.min,\n            });\n        }\n        constrain(value) {\n            const max = this.values.get('max');\n            const min = this.values.get('min');\n            return Math.min(Math.max(value, min), max);\n        }\n    }\n\n    class ListConstraint {\n        constructor(options) {\n            this.values = ValueMap.fromObject({\n                options: options,\n            });\n        }\n        get options() {\n            return this.values.get('options');\n        }\n        constrain(value) {\n            const opts = this.values.get('options');\n            if (opts.length === 0) {\n                return value;\n            }\n            const matched = opts.filter((item) => {\n                return item.value === value;\n            }).length > 0;\n            return matched ? value : opts[0].value;\n        }\n    }\n\n    class RangeConstraint {\n        constructor(config) {\n            this.values = ValueMap.fromObject({\n                max: config.max,\n                min: config.min,\n            });\n        }\n        get maxValue() {\n            return this.values.get('max');\n        }\n        get minValue() {\n            return this.values.get('min');\n        }\n        constrain(value) {\n            const max = this.values.get('max');\n            const min = this.values.get('min');\n            let result = value;\n            if (!isEmpty(min)) {\n                result = Math.max(result, min);\n            }\n            if (!isEmpty(max)) {\n                result = Math.min(result, max);\n            }\n            return result;\n        }\n    }\n\n    class StepConstraint {\n        constructor(step, origin = 0) {\n            this.step = step;\n            this.origin = origin;\n        }\n        constrain(value) {\n            const o = this.origin % this.step;\n            const r = Math.round((value - o) / this.step);\n            return o + r * this.step;\n        }\n    }\n\n    const className$j = ClassName('lst');\n    class ListView {\n        constructor(doc, config) {\n            this.onValueChange_ = this.onValueChange_.bind(this);\n            this.props_ = config.props;\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$j());\n            config.viewProps.bindClassModifiers(this.element);\n            const selectElem = doc.createElement('select');\n            selectElem.classList.add(className$j('s'));\n            config.viewProps.bindDisabled(selectElem);\n            this.element.appendChild(selectElem);\n            this.selectElement = selectElem;\n            const markElem = doc.createElement('div');\n            markElem.classList.add(className$j('m'));\n            markElem.appendChild(createSvgIconElement(doc, 'dropdown'));\n            this.element.appendChild(markElem);\n            config.value.emitter.on('change', this.onValueChange_);\n            this.value_ = config.value;\n            bindValueMap(this.props_, 'options', (opts) => {\n                removeChildElements(this.selectElement);\n                opts.forEach((item) => {\n                    const optionElem = doc.createElement('option');\n                    optionElem.textContent = item.text;\n                    this.selectElement.appendChild(optionElem);\n                });\n                this.update_();\n            });\n        }\n        update_() {\n            const values = this.props_.get('options').map((o) => o.value);\n            this.selectElement.selectedIndex = values.indexOf(this.value_.rawValue);\n        }\n        onValueChange_() {\n            this.update_();\n        }\n    }\n\n    class ListController {\n        constructor(doc, config) {\n            this.onSelectChange_ = this.onSelectChange_.bind(this);\n            this.props = config.props;\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.view = new ListView(doc, {\n                props: this.props,\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            this.view.selectElement.addEventListener('change', this.onSelectChange_);\n        }\n        onSelectChange_(e) {\n            const selectElem = forceCast(e.currentTarget);\n            this.value.rawValue =\n                this.props.get('options')[selectElem.selectedIndex].value;\n        }\n    }\n\n    const className$i = ClassName('pop');\n    class PopupView {\n        constructor(doc, config) {\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$i());\n            config.viewProps.bindClassModifiers(this.element);\n            bindValue(config.shows, valueToClassName(this.element, className$i(undefined, 'v')));\n        }\n    }\n\n    class PopupController {\n        constructor(doc, config) {\n            this.shows = createValue(false);\n            this.viewProps = config.viewProps;\n            this.view = new PopupView(doc, {\n                shows: this.shows,\n                viewProps: this.viewProps,\n            });\n        }\n    }\n\n    const className$h = ClassName('txt');\n    class TextView {\n        constructor(doc, config) {\n            this.onChange_ = this.onChange_.bind(this);\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$h());\n            config.viewProps.bindClassModifiers(this.element);\n            this.props_ = config.props;\n            this.props_.emitter.on('change', this.onChange_);\n            const inputElem = doc.createElement('input');\n            inputElem.classList.add(className$h('i'));\n            inputElem.type = 'text';\n            config.viewProps.bindDisabled(inputElem);\n            this.element.appendChild(inputElem);\n            this.inputElement = inputElem;\n            config.value.emitter.on('change', this.onChange_);\n            this.value_ = config.value;\n            this.refresh();\n        }\n        refresh() {\n            const formatter = this.props_.get('formatter');\n            this.inputElement.value = formatter(this.value_.rawValue);\n        }\n        onChange_() {\n            this.refresh();\n        }\n    }\n\n    class TextController {\n        constructor(doc, config) {\n            this.onInputChange_ = this.onInputChange_.bind(this);\n            this.parser_ = config.parser;\n            this.props = config.props;\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.view = new TextView(doc, {\n                props: config.props,\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            this.view.inputElement.addEventListener('change', this.onInputChange_);\n        }\n        onInputChange_(e) {\n            const inputElem = forceCast(e.currentTarget);\n            const value = inputElem.value;\n            const parsedValue = this.parser_(value);\n            if (!isEmpty(parsedValue)) {\n                this.value.rawValue = parsedValue;\n            }\n            this.view.refresh();\n        }\n    }\n\n    function boolToString(value) {\n        return String(value);\n    }\n    function boolFromUnknown(value) {\n        if (value === 'false') {\n            return false;\n        }\n        return !!value;\n    }\n    function BooleanFormatter(value) {\n        return boolToString(value);\n    }\n\n    class NumberLiteralNode {\n        constructor(text) {\n            this.text = text;\n        }\n        evaluate() {\n            return Number(this.text);\n        }\n        toString() {\n            return this.text;\n        }\n    }\n    const BINARY_OPERATION_MAP = {\n        '**': (v1, v2) => Math.pow(v1, v2),\n        '*': (v1, v2) => v1 * v2,\n        '/': (v1, v2) => v1 / v2,\n        '%': (v1, v2) => v1 % v2,\n        '+': (v1, v2) => v1 + v2,\n        '-': (v1, v2) => v1 - v2,\n        '<<': (v1, v2) => v1 << v2,\n        '>>': (v1, v2) => v1 >> v2,\n        '>>>': (v1, v2) => v1 >>> v2,\n        '&': (v1, v2) => v1 & v2,\n        '^': (v1, v2) => v1 ^ v2,\n        '|': (v1, v2) => v1 | v2,\n    };\n    class BinaryOperationNode {\n        constructor(operator, left, right) {\n            this.left = left;\n            this.operator = operator;\n            this.right = right;\n        }\n        evaluate() {\n            const op = BINARY_OPERATION_MAP[this.operator];\n            if (!op) {\n                throw new Error(`unexpected binary operator: '${this.operator}`);\n            }\n            return op(this.left.evaluate(), this.right.evaluate());\n        }\n        toString() {\n            return [\n                'b(',\n                this.left.toString(),\n                this.operator,\n                this.right.toString(),\n                ')',\n            ].join(' ');\n        }\n    }\n    const UNARY_OPERATION_MAP = {\n        '+': (v) => v,\n        '-': (v) => -v,\n        '~': (v) => ~v,\n    };\n    class UnaryOperationNode {\n        constructor(operator, expr) {\n            this.operator = operator;\n            this.expression = expr;\n        }\n        evaluate() {\n            const op = UNARY_OPERATION_MAP[this.operator];\n            if (!op) {\n                throw new Error(`unexpected unary operator: '${this.operator}`);\n            }\n            return op(this.expression.evaluate());\n        }\n        toString() {\n            return ['u(', this.operator, this.expression.toString(), ')'].join(' ');\n        }\n    }\n\n    function combineReader(parsers) {\n        return (text, cursor) => {\n            for (let i = 0; i < parsers.length; i++) {\n                const result = parsers[i](text, cursor);\n                if (result !== '') {\n                    return result;\n                }\n            }\n            return '';\n        };\n    }\n    function readWhitespace(text, cursor) {\n        var _a;\n        const m = text.substr(cursor).match(/^\\s+/);\n        return (_a = (m && m[0])) !== null && _a !== void 0 ? _a : '';\n    }\n    function readNonZeroDigit(text, cursor) {\n        const ch = text.substr(cursor, 1);\n        return ch.match(/^[1-9]$/) ? ch : '';\n    }\n    function readDecimalDigits(text, cursor) {\n        var _a;\n        const m = text.substr(cursor).match(/^[0-9]+/);\n        return (_a = (m && m[0])) !== null && _a !== void 0 ? _a : '';\n    }\n    function readSignedInteger(text, cursor) {\n        const ds = readDecimalDigits(text, cursor);\n        if (ds !== '') {\n            return ds;\n        }\n        const sign = text.substr(cursor, 1);\n        cursor += 1;\n        if (sign !== '-' && sign !== '+') {\n            return '';\n        }\n        const sds = readDecimalDigits(text, cursor);\n        if (sds === '') {\n            return '';\n        }\n        return sign + sds;\n    }\n    function readExponentPart(text, cursor) {\n        const e = text.substr(cursor, 1);\n        cursor += 1;\n        if (e.toLowerCase() !== 'e') {\n            return '';\n        }\n        const si = readSignedInteger(text, cursor);\n        if (si === '') {\n            return '';\n        }\n        return e + si;\n    }\n    function readDecimalIntegerLiteral(text, cursor) {\n        const ch = text.substr(cursor, 1);\n        if (ch === '0') {\n            return ch;\n        }\n        const nzd = readNonZeroDigit(text, cursor);\n        cursor += nzd.length;\n        if (nzd === '') {\n            return '';\n        }\n        return nzd + readDecimalDigits(text, cursor);\n    }\n    function readDecimalLiteral1(text, cursor) {\n        const dil = readDecimalIntegerLiteral(text, cursor);\n        cursor += dil.length;\n        if (dil === '') {\n            return '';\n        }\n        const dot = text.substr(cursor, 1);\n        cursor += dot.length;\n        if (dot !== '.') {\n            return '';\n        }\n        const dds = readDecimalDigits(text, cursor);\n        cursor += dds.length;\n        return dil + dot + dds + readExponentPart(text, cursor);\n    }\n    function readDecimalLiteral2(text, cursor) {\n        const dot = text.substr(cursor, 1);\n        cursor += dot.length;\n        if (dot !== '.') {\n            return '';\n        }\n        const dds = readDecimalDigits(text, cursor);\n        cursor += dds.length;\n        if (dds === '') {\n            return '';\n        }\n        return dot + dds + readExponentPart(text, cursor);\n    }\n    function readDecimalLiteral3(text, cursor) {\n        const dil = readDecimalIntegerLiteral(text, cursor);\n        cursor += dil.length;\n        if (dil === '') {\n            return '';\n        }\n        return dil + readExponentPart(text, cursor);\n    }\n    const readDecimalLiteral = combineReader([\n        readDecimalLiteral1,\n        readDecimalLiteral2,\n        readDecimalLiteral3,\n    ]);\n    function parseBinaryDigits(text, cursor) {\n        var _a;\n        const m = text.substr(cursor).match(/^[01]+/);\n        return (_a = (m && m[0])) !== null && _a !== void 0 ? _a : '';\n    }\n    function readBinaryIntegerLiteral(text, cursor) {\n        const prefix = text.substr(cursor, 2);\n        cursor += prefix.length;\n        if (prefix.toLowerCase() !== '0b') {\n            return '';\n        }\n        const bds = parseBinaryDigits(text, cursor);\n        if (bds === '') {\n            return '';\n        }\n        return prefix + bds;\n    }\n    function readOctalDigits(text, cursor) {\n        var _a;\n        const m = text.substr(cursor).match(/^[0-7]+/);\n        return (_a = (m && m[0])) !== null && _a !== void 0 ? _a : '';\n    }\n    function readOctalIntegerLiteral(text, cursor) {\n        const prefix = text.substr(cursor, 2);\n        cursor += prefix.length;\n        if (prefix.toLowerCase() !== '0o') {\n            return '';\n        }\n        const ods = readOctalDigits(text, cursor);\n        if (ods === '') {\n            return '';\n        }\n        return prefix + ods;\n    }\n    function readHexDigits(text, cursor) {\n        var _a;\n        const m = text.substr(cursor).match(/^[0-9a-f]+/i);\n        return (_a = (m && m[0])) !== null && _a !== void 0 ? _a : '';\n    }\n    function readHexIntegerLiteral(text, cursor) {\n        const prefix = text.substr(cursor, 2);\n        cursor += prefix.length;\n        if (prefix.toLowerCase() !== '0x') {\n            return '';\n        }\n        const hds = readHexDigits(text, cursor);\n        if (hds === '') {\n            return '';\n        }\n        return prefix + hds;\n    }\n    const readNonDecimalIntegerLiteral = combineReader([\n        readBinaryIntegerLiteral,\n        readOctalIntegerLiteral,\n        readHexIntegerLiteral,\n    ]);\n    const readNumericLiteral = combineReader([\n        readNonDecimalIntegerLiteral,\n        readDecimalLiteral,\n    ]);\n\n    function parseLiteral(text, cursor) {\n        const num = readNumericLiteral(text, cursor);\n        cursor += num.length;\n        if (num === '') {\n            return null;\n        }\n        return {\n            evaluable: new NumberLiteralNode(num),\n            cursor: cursor,\n        };\n    }\n    function parseParenthesizedExpression(text, cursor) {\n        const op = text.substr(cursor, 1);\n        cursor += op.length;\n        if (op !== '(') {\n            return null;\n        }\n        const expr = parseExpression(text, cursor);\n        if (!expr) {\n            return null;\n        }\n        cursor = expr.cursor;\n        cursor += readWhitespace(text, cursor).length;\n        const cl = text.substr(cursor, 1);\n        cursor += cl.length;\n        if (cl !== ')') {\n            return null;\n        }\n        return {\n            evaluable: expr.evaluable,\n            cursor: cursor,\n        };\n    }\n    function parsePrimaryExpression(text, cursor) {\n        var _a;\n        return ((_a = parseLiteral(text, cursor)) !== null && _a !== void 0 ? _a : parseParenthesizedExpression(text, cursor));\n    }\n    function parseUnaryExpression(text, cursor) {\n        const expr = parsePrimaryExpression(text, cursor);\n        if (expr) {\n            return expr;\n        }\n        const op = text.substr(cursor, 1);\n        cursor += op.length;\n        if (op !== '+' && op !== '-' && op !== '~') {\n            return null;\n        }\n        const num = parseUnaryExpression(text, cursor);\n        if (!num) {\n            return null;\n        }\n        cursor = num.cursor;\n        return {\n            cursor: cursor,\n            evaluable: new UnaryOperationNode(op, num.evaluable),\n        };\n    }\n    function readBinaryOperator(ops, text, cursor) {\n        cursor += readWhitespace(text, cursor).length;\n        const op = ops.filter((op) => text.startsWith(op, cursor))[0];\n        if (!op) {\n            return null;\n        }\n        cursor += op.length;\n        cursor += readWhitespace(text, cursor).length;\n        return {\n            cursor: cursor,\n            operator: op,\n        };\n    }\n    function createBinaryOperationExpressionParser(exprParser, ops) {\n        return (text, cursor) => {\n            const firstExpr = exprParser(text, cursor);\n            if (!firstExpr) {\n                return null;\n            }\n            cursor = firstExpr.cursor;\n            let expr = firstExpr.evaluable;\n            for (;;) {\n                const op = readBinaryOperator(ops, text, cursor);\n                if (!op) {\n                    break;\n                }\n                cursor = op.cursor;\n                const nextExpr = exprParser(text, cursor);\n                if (!nextExpr) {\n                    return null;\n                }\n                cursor = nextExpr.cursor;\n                expr = new BinaryOperationNode(op.operator, expr, nextExpr.evaluable);\n            }\n            return expr\n                ? {\n                    cursor: cursor,\n                    evaluable: expr,\n                }\n                : null;\n        };\n    }\n    const parseBinaryOperationExpression = [\n        ['**'],\n        ['*', '/', '%'],\n        ['+', '-'],\n        ['<<', '>>>', '>>'],\n        ['&'],\n        ['^'],\n        ['|'],\n    ].reduce((parser, ops) => {\n        return createBinaryOperationExpressionParser(parser, ops);\n    }, parseUnaryExpression);\n    function parseExpression(text, cursor) {\n        cursor += readWhitespace(text, cursor).length;\n        return parseBinaryOperationExpression(text, cursor);\n    }\n    function parseEcmaNumberExpression(text) {\n        const expr = parseExpression(text, 0);\n        if (!expr) {\n            return null;\n        }\n        const cursor = expr.cursor + readWhitespace(text, expr.cursor).length;\n        if (cursor !== text.length) {\n            return null;\n        }\n        return expr.evaluable;\n    }\n\n    function parseNumber(text) {\n        var _a;\n        const r = parseEcmaNumberExpression(text);\n        return (_a = r === null || r === void 0 ? void 0 : r.evaluate()) !== null && _a !== void 0 ? _a : null;\n    }\n    function numberFromUnknown(value) {\n        if (typeof value === 'number') {\n            return value;\n        }\n        if (typeof value === 'string') {\n            const pv = parseNumber(value);\n            if (!isEmpty(pv)) {\n                return pv;\n            }\n        }\n        return 0;\n    }\n    function numberToString(value) {\n        return String(value);\n    }\n    function createNumberFormatter(digits) {\n        return (value) => {\n            return value.toFixed(Math.max(Math.min(digits, 20), 0));\n        };\n    }\n\n    const innerFormatter = createNumberFormatter(0);\n    function formatPercentage(value) {\n        return innerFormatter(value) + '%';\n    }\n\n    function stringFromUnknown(value) {\n        return String(value);\n    }\n    function formatString(value) {\n        return value;\n    }\n\n    function connectValues({ primary, secondary, forward, backward, }) {\n        let changing = false;\n        function preventFeedback(callback) {\n            if (changing) {\n                return;\n            }\n            changing = true;\n            callback();\n            changing = false;\n        }\n        primary.emitter.on('change', (ev) => {\n            preventFeedback(() => {\n                secondary.setRawValue(forward(primary, secondary), ev.options);\n            });\n        });\n        secondary.emitter.on('change', (ev) => {\n            preventFeedback(() => {\n                primary.setRawValue(backward(primary, secondary), ev.options);\n            });\n            preventFeedback(() => {\n                secondary.setRawValue(forward(primary, secondary), ev.options);\n            });\n        });\n        preventFeedback(() => {\n            secondary.setRawValue(forward(primary, secondary), {\n                forceEmit: false,\n                last: true,\n            });\n        });\n    }\n\n    function getStepForKey(baseStep, keys) {\n        const step = baseStep * (keys.altKey ? 0.1 : 1) * (keys.shiftKey ? 10 : 1);\n        if (keys.upKey) {\n            return +step;\n        }\n        else if (keys.downKey) {\n            return -step;\n        }\n        return 0;\n    }\n    function getVerticalStepKeys(ev) {\n        return {\n            altKey: ev.altKey,\n            downKey: ev.key === 'ArrowDown',\n            shiftKey: ev.shiftKey,\n            upKey: ev.key === 'ArrowUp',\n        };\n    }\n    function getHorizontalStepKeys(ev) {\n        return {\n            altKey: ev.altKey,\n            downKey: ev.key === 'ArrowLeft',\n            shiftKey: ev.shiftKey,\n            upKey: ev.key === 'ArrowRight',\n        };\n    }\n    function isVerticalArrowKey(key) {\n        return key === 'ArrowUp' || key === 'ArrowDown';\n    }\n    function isArrowKey(key) {\n        return isVerticalArrowKey(key) || key === 'ArrowLeft' || key === 'ArrowRight';\n    }\n\n    function computeOffset$1(ev, elem) {\n        var _a, _b;\n        const win = elem.ownerDocument.defaultView;\n        const rect = elem.getBoundingClientRect();\n        return {\n            x: ev.pageX - (((_a = (win && win.scrollX)) !== null && _a !== void 0 ? _a : 0) + rect.left),\n            y: ev.pageY - (((_b = (win && win.scrollY)) !== null && _b !== void 0 ? _b : 0) + rect.top),\n        };\n    }\n    class PointerHandler {\n        constructor(element) {\n            this.lastTouch_ = null;\n            this.onDocumentMouseMove_ = this.onDocumentMouseMove_.bind(this);\n            this.onDocumentMouseUp_ = this.onDocumentMouseUp_.bind(this);\n            this.onMouseDown_ = this.onMouseDown_.bind(this);\n            this.onTouchEnd_ = this.onTouchEnd_.bind(this);\n            this.onTouchMove_ = this.onTouchMove_.bind(this);\n            this.onTouchStart_ = this.onTouchStart_.bind(this);\n            this.elem_ = element;\n            this.emitter = new Emitter();\n            element.addEventListener('touchstart', this.onTouchStart_, {\n                passive: false,\n            });\n            element.addEventListener('touchmove', this.onTouchMove_, {\n                passive: true,\n            });\n            element.addEventListener('touchend', this.onTouchEnd_);\n            element.addEventListener('mousedown', this.onMouseDown_);\n        }\n        computePosition_(offset) {\n            const rect = this.elem_.getBoundingClientRect();\n            return {\n                bounds: {\n                    width: rect.width,\n                    height: rect.height,\n                },\n                point: offset\n                    ? {\n                        x: offset.x,\n                        y: offset.y,\n                    }\n                    : null,\n            };\n        }\n        onMouseDown_(ev) {\n            var _a;\n            ev.preventDefault();\n            (_a = ev.currentTarget) === null || _a === void 0 ? void 0 : _a.focus();\n            const doc = this.elem_.ownerDocument;\n            doc.addEventListener('mousemove', this.onDocumentMouseMove_);\n            doc.addEventListener('mouseup', this.onDocumentMouseUp_);\n            this.emitter.emit('down', {\n                altKey: ev.altKey,\n                data: this.computePosition_(computeOffset$1(ev, this.elem_)),\n                sender: this,\n                shiftKey: ev.shiftKey,\n            });\n        }\n        onDocumentMouseMove_(ev) {\n            this.emitter.emit('move', {\n                altKey: ev.altKey,\n                data: this.computePosition_(computeOffset$1(ev, this.elem_)),\n                sender: this,\n                shiftKey: ev.shiftKey,\n            });\n        }\n        onDocumentMouseUp_(ev) {\n            const doc = this.elem_.ownerDocument;\n            doc.removeEventListener('mousemove', this.onDocumentMouseMove_);\n            doc.removeEventListener('mouseup', this.onDocumentMouseUp_);\n            this.emitter.emit('up', {\n                altKey: ev.altKey,\n                data: this.computePosition_(computeOffset$1(ev, this.elem_)),\n                sender: this,\n                shiftKey: ev.shiftKey,\n            });\n        }\n        onTouchStart_(ev) {\n            ev.preventDefault();\n            const touch = ev.targetTouches.item(0);\n            const rect = this.elem_.getBoundingClientRect();\n            this.emitter.emit('down', {\n                altKey: ev.altKey,\n                data: this.computePosition_(touch\n                    ? {\n                        x: touch.clientX - rect.left,\n                        y: touch.clientY - rect.top,\n                    }\n                    : undefined),\n                sender: this,\n                shiftKey: ev.shiftKey,\n            });\n            this.lastTouch_ = touch;\n        }\n        onTouchMove_(ev) {\n            const touch = ev.targetTouches.item(0);\n            const rect = this.elem_.getBoundingClientRect();\n            this.emitter.emit('move', {\n                altKey: ev.altKey,\n                data: this.computePosition_(touch\n                    ? {\n                        x: touch.clientX - rect.left,\n                        y: touch.clientY - rect.top,\n                    }\n                    : undefined),\n                sender: this,\n                shiftKey: ev.shiftKey,\n            });\n            this.lastTouch_ = touch;\n        }\n        onTouchEnd_(ev) {\n            var _a;\n            const touch = (_a = ev.targetTouches.item(0)) !== null && _a !== void 0 ? _a : this.lastTouch_;\n            const rect = this.elem_.getBoundingClientRect();\n            this.emitter.emit('up', {\n                altKey: ev.altKey,\n                data: this.computePosition_(touch\n                    ? {\n                        x: touch.clientX - rect.left,\n                        y: touch.clientY - rect.top,\n                    }\n                    : undefined),\n                sender: this,\n                shiftKey: ev.shiftKey,\n            });\n        }\n    }\n\n    function mapRange(value, start1, end1, start2, end2) {\n        const p = (value - start1) / (end1 - start1);\n        return start2 + p * (end2 - start2);\n    }\n    function getDecimalDigits(value) {\n        const text = String(value.toFixed(10));\n        const frac = text.split('.')[1];\n        return frac.replace(/0+$/, '').length;\n    }\n    function constrainRange(value, min, max) {\n        return Math.min(Math.max(value, min), max);\n    }\n    function loopRange(value, max) {\n        return ((value % max) + max) % max;\n    }\n\n    const className$g = ClassName('txt');\n    class NumberTextView {\n        constructor(doc, config) {\n            this.onChange_ = this.onChange_.bind(this);\n            this.props_ = config.props;\n            this.props_.emitter.on('change', this.onChange_);\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$g(), className$g(undefined, 'num'));\n            if (config.arrayPosition) {\n                this.element.classList.add(className$g(undefined, config.arrayPosition));\n            }\n            config.viewProps.bindClassModifiers(this.element);\n            const inputElem = doc.createElement('input');\n            inputElem.classList.add(className$g('i'));\n            inputElem.type = 'text';\n            config.viewProps.bindDisabled(inputElem);\n            this.element.appendChild(inputElem);\n            this.inputElement = inputElem;\n            this.onDraggingChange_ = this.onDraggingChange_.bind(this);\n            this.dragging_ = config.dragging;\n            this.dragging_.emitter.on('change', this.onDraggingChange_);\n            this.element.classList.add(className$g());\n            this.inputElement.classList.add(className$g('i'));\n            const knobElem = doc.createElement('div');\n            knobElem.classList.add(className$g('k'));\n            this.element.appendChild(knobElem);\n            this.knobElement = knobElem;\n            const guideElem = doc.createElementNS(SVG_NS, 'svg');\n            guideElem.classList.add(className$g('g'));\n            this.knobElement.appendChild(guideElem);\n            const bodyElem = doc.createElementNS(SVG_NS, 'path');\n            bodyElem.classList.add(className$g('gb'));\n            guideElem.appendChild(bodyElem);\n            this.guideBodyElem_ = bodyElem;\n            const headElem = doc.createElementNS(SVG_NS, 'path');\n            headElem.classList.add(className$g('gh'));\n            guideElem.appendChild(headElem);\n            this.guideHeadElem_ = headElem;\n            const tooltipElem = doc.createElement('div');\n            tooltipElem.classList.add(ClassName('tt')());\n            this.knobElement.appendChild(tooltipElem);\n            this.tooltipElem_ = tooltipElem;\n            config.value.emitter.on('change', this.onChange_);\n            this.value = config.value;\n            this.refresh();\n        }\n        onDraggingChange_(ev) {\n            if (ev.rawValue === null) {\n                this.element.classList.remove(className$g(undefined, 'drg'));\n                return;\n            }\n            this.element.classList.add(className$g(undefined, 'drg'));\n            const x = ev.rawValue / this.props_.get('draggingScale');\n            const aox = x + (x > 0 ? -1 : x < 0 ? +1 : 0);\n            const adx = constrainRange(-aox, -4, +4);\n            this.guideHeadElem_.setAttributeNS(null, 'd', [`M ${aox + adx},0 L${aox},4 L${aox + adx},8`, `M ${x},-1 L${x},9`].join(' '));\n            this.guideBodyElem_.setAttributeNS(null, 'd', `M 0,4 L${x},4`);\n            const formatter = this.props_.get('formatter');\n            this.tooltipElem_.textContent = formatter(this.value.rawValue);\n            this.tooltipElem_.style.left = `${x}px`;\n        }\n        refresh() {\n            const formatter = this.props_.get('formatter');\n            this.inputElement.value = formatter(this.value.rawValue);\n        }\n        onChange_() {\n            this.refresh();\n        }\n    }\n\n    class NumberTextController {\n        constructor(doc, config) {\n            var _a;\n            this.originRawValue_ = 0;\n            this.onInputChange_ = this.onInputChange_.bind(this);\n            this.onInputKeyDown_ = this.onInputKeyDown_.bind(this);\n            this.onInputKeyUp_ = this.onInputKeyUp_.bind(this);\n            this.onPointerDown_ = this.onPointerDown_.bind(this);\n            this.onPointerMove_ = this.onPointerMove_.bind(this);\n            this.onPointerUp_ = this.onPointerUp_.bind(this);\n            this.baseStep_ = config.baseStep;\n            this.parser_ = config.parser;\n            this.props = config.props;\n            this.sliderProps_ = (_a = config.sliderProps) !== null && _a !== void 0 ? _a : null;\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.dragging_ = createValue(null);\n            this.view = new NumberTextView(doc, {\n                arrayPosition: config.arrayPosition,\n                dragging: this.dragging_,\n                props: this.props,\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            this.view.inputElement.addEventListener('change', this.onInputChange_);\n            this.view.inputElement.addEventListener('keydown', this.onInputKeyDown_);\n            this.view.inputElement.addEventListener('keyup', this.onInputKeyUp_);\n            const ph = new PointerHandler(this.view.knobElement);\n            ph.emitter.on('down', this.onPointerDown_);\n            ph.emitter.on('move', this.onPointerMove_);\n            ph.emitter.on('up', this.onPointerUp_);\n        }\n        constrainValue_(value) {\n            var _a, _b;\n            const min = (_a = this.sliderProps_) === null || _a === void 0 ? void 0 : _a.get('minValue');\n            const max = (_b = this.sliderProps_) === null || _b === void 0 ? void 0 : _b.get('maxValue');\n            let v = value;\n            if (min !== undefined) {\n                v = Math.max(v, min);\n            }\n            if (max !== undefined) {\n                v = Math.min(v, max);\n            }\n            return v;\n        }\n        onInputChange_(e) {\n            const inputElem = forceCast(e.currentTarget);\n            const value = inputElem.value;\n            const parsedValue = this.parser_(value);\n            if (!isEmpty(parsedValue)) {\n                this.value.rawValue = this.constrainValue_(parsedValue);\n            }\n            this.view.refresh();\n        }\n        onInputKeyDown_(ev) {\n            const step = getStepForKey(this.baseStep_, getVerticalStepKeys(ev));\n            if (step === 0) {\n                return;\n            }\n            this.value.setRawValue(this.constrainValue_(this.value.rawValue + step), {\n                forceEmit: false,\n                last: false,\n            });\n        }\n        onInputKeyUp_(ev) {\n            const step = getStepForKey(this.baseStep_, getVerticalStepKeys(ev));\n            if (step === 0) {\n                return;\n            }\n            this.value.setRawValue(this.value.rawValue, {\n                forceEmit: true,\n                last: true,\n            });\n        }\n        onPointerDown_() {\n            this.originRawValue_ = this.value.rawValue;\n            this.dragging_.rawValue = 0;\n        }\n        computeDraggingValue_(data) {\n            if (!data.point) {\n                return null;\n            }\n            const dx = data.point.x - data.bounds.width / 2;\n            return this.constrainValue_(this.originRawValue_ + dx * this.props.get('draggingScale'));\n        }\n        onPointerMove_(ev) {\n            const v = this.computeDraggingValue_(ev.data);\n            if (v === null) {\n                return;\n            }\n            this.value.setRawValue(v, {\n                forceEmit: false,\n                last: false,\n            });\n            this.dragging_.rawValue = this.value.rawValue - this.originRawValue_;\n        }\n        onPointerUp_(ev) {\n            const v = this.computeDraggingValue_(ev.data);\n            if (v === null) {\n                return;\n            }\n            this.value.setRawValue(v, {\n                forceEmit: true,\n                last: true,\n            });\n            this.dragging_.rawValue = null;\n        }\n    }\n\n    const className$f = ClassName('sld');\n    class SliderView {\n        constructor(doc, config) {\n            this.onChange_ = this.onChange_.bind(this);\n            this.props_ = config.props;\n            this.props_.emitter.on('change', this.onChange_);\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$f());\n            config.viewProps.bindClassModifiers(this.element);\n            const trackElem = doc.createElement('div');\n            trackElem.classList.add(className$f('t'));\n            config.viewProps.bindTabIndex(trackElem);\n            this.element.appendChild(trackElem);\n            this.trackElement = trackElem;\n            const knobElem = doc.createElement('div');\n            knobElem.classList.add(className$f('k'));\n            this.trackElement.appendChild(knobElem);\n            this.knobElement = knobElem;\n            config.value.emitter.on('change', this.onChange_);\n            this.value = config.value;\n            this.update_();\n        }\n        update_() {\n            const p = constrainRange(mapRange(this.value.rawValue, this.props_.get('minValue'), this.props_.get('maxValue'), 0, 100), 0, 100);\n            this.knobElement.style.width = `${p}%`;\n        }\n        onChange_() {\n            this.update_();\n        }\n    }\n\n    class SliderController {\n        constructor(doc, config) {\n            this.onKeyDown_ = this.onKeyDown_.bind(this);\n            this.onKeyUp_ = this.onKeyUp_.bind(this);\n            this.onPointerDownOrMove_ = this.onPointerDownOrMove_.bind(this);\n            this.onPointerUp_ = this.onPointerUp_.bind(this);\n            this.baseStep_ = config.baseStep;\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.props = config.props;\n            this.view = new SliderView(doc, {\n                props: this.props,\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            this.ptHandler_ = new PointerHandler(this.view.trackElement);\n            this.ptHandler_.emitter.on('down', this.onPointerDownOrMove_);\n            this.ptHandler_.emitter.on('move', this.onPointerDownOrMove_);\n            this.ptHandler_.emitter.on('up', this.onPointerUp_);\n            this.view.trackElement.addEventListener('keydown', this.onKeyDown_);\n            this.view.trackElement.addEventListener('keyup', this.onKeyUp_);\n        }\n        handlePointerEvent_(d, opts) {\n            if (!d.point) {\n                return;\n            }\n            this.value.setRawValue(mapRange(constrainRange(d.point.x, 0, d.bounds.width), 0, d.bounds.width, this.props.get('minValue'), this.props.get('maxValue')), opts);\n        }\n        onPointerDownOrMove_(ev) {\n            this.handlePointerEvent_(ev.data, {\n                forceEmit: false,\n                last: false,\n            });\n        }\n        onPointerUp_(ev) {\n            this.handlePointerEvent_(ev.data, {\n                forceEmit: true,\n                last: true,\n            });\n        }\n        onKeyDown_(ev) {\n            const step = getStepForKey(this.baseStep_, getHorizontalStepKeys(ev));\n            if (step === 0) {\n                return;\n            }\n            this.value.setRawValue(this.value.rawValue + step, {\n                forceEmit: false,\n                last: false,\n            });\n        }\n        onKeyUp_(ev) {\n            const step = getStepForKey(this.baseStep_, getHorizontalStepKeys(ev));\n            if (step === 0) {\n                return;\n            }\n            this.value.setRawValue(this.value.rawValue, {\n                forceEmit: true,\n                last: true,\n            });\n        }\n    }\n\n    const className$e = ClassName('sldtxt');\n    class SliderTextView {\n        constructor(doc, config) {\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$e());\n            const sliderElem = doc.createElement('div');\n            sliderElem.classList.add(className$e('s'));\n            this.sliderView_ = config.sliderView;\n            sliderElem.appendChild(this.sliderView_.element);\n            this.element.appendChild(sliderElem);\n            const textElem = doc.createElement('div');\n            textElem.classList.add(className$e('t'));\n            this.textView_ = config.textView;\n            textElem.appendChild(this.textView_.element);\n            this.element.appendChild(textElem);\n        }\n    }\n\n    class SliderTextController {\n        constructor(doc, config) {\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.sliderC_ = new SliderController(doc, {\n                baseStep: config.baseStep,\n                props: config.sliderProps,\n                value: config.value,\n                viewProps: this.viewProps,\n            });\n            this.textC_ = new NumberTextController(doc, {\n                baseStep: config.baseStep,\n                parser: config.parser,\n                props: config.textProps,\n                sliderProps: config.sliderProps,\n                value: config.value,\n                viewProps: config.viewProps,\n            });\n            this.view = new SliderTextView(doc, {\n                sliderView: this.sliderC_.view,\n                textView: this.textC_.view,\n            });\n        }\n        get sliderController() {\n            return this.sliderC_;\n        }\n        get textController() {\n            return this.textC_;\n        }\n    }\n\n    function writePrimitive(target, value) {\n        target.write(value);\n    }\n\n    function parseListOptions(value) {\n        const p = ParamsParsers;\n        if (Array.isArray(value)) {\n            return p.required.array(p.required.object({\n                text: p.required.string,\n                value: p.required.raw,\n            }))(value).value;\n        }\n        if (typeof value === 'object') {\n            return p.required.raw(value)\n                .value;\n        }\n        return undefined;\n    }\n    function parsePickerLayout(value) {\n        if (value === 'inline' || value === 'popup') {\n            return value;\n        }\n        return undefined;\n    }\n    function parsePointDimensionParams(value) {\n        const p = ParamsParsers;\n        return p.required.object({\n            max: p.optional.number,\n            min: p.optional.number,\n            step: p.optional.number,\n        })(value).value;\n    }\n    function normalizeListOptions(options) {\n        if (Array.isArray(options)) {\n            return options;\n        }\n        const items = [];\n        Object.keys(options).forEach((text) => {\n            items.push({ text: text, value: options[text] });\n        });\n        return items;\n    }\n    function createListConstraint(options) {\n        return !isEmpty(options)\n            ? new ListConstraint(normalizeListOptions(forceCast(options)))\n            : null;\n    }\n    function findStep(constraint) {\n        const c = constraint ? findConstraint(constraint, StepConstraint) : null;\n        if (!c) {\n            return null;\n        }\n        return c.step;\n    }\n    function getSuitableDecimalDigits(constraint, rawValue) {\n        const sc = constraint && findConstraint(constraint, StepConstraint);\n        if (sc) {\n            return getDecimalDigits(sc.step);\n        }\n        return Math.max(getDecimalDigits(rawValue), 2);\n    }\n    function getBaseStep(constraint) {\n        const step = findStep(constraint);\n        return step !== null && step !== void 0 ? step : 1;\n    }\n    function getSuitableDraggingScale(constraint, rawValue) {\n        var _a;\n        const sc = constraint && findConstraint(constraint, StepConstraint);\n        const base = Math.abs((_a = sc === null || sc === void 0 ? void 0 : sc.step) !== null && _a !== void 0 ? _a : rawValue);\n        return base === 0 ? 0.1 : Math.pow(10, Math.floor(Math.log10(base)) - 1);\n    }\n\n    const className$d = ClassName('ckb');\n    class CheckboxView {\n        constructor(doc, config) {\n            this.onValueChange_ = this.onValueChange_.bind(this);\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$d());\n            config.viewProps.bindClassModifiers(this.element);\n            const labelElem = doc.createElement('label');\n            labelElem.classList.add(className$d('l'));\n            this.element.appendChild(labelElem);\n            const inputElem = doc.createElement('input');\n            inputElem.classList.add(className$d('i'));\n            inputElem.type = 'checkbox';\n            labelElem.appendChild(inputElem);\n            this.inputElement = inputElem;\n            config.viewProps.bindDisabled(this.inputElement);\n            const wrapperElem = doc.createElement('div');\n            wrapperElem.classList.add(className$d('w'));\n            labelElem.appendChild(wrapperElem);\n            const markElem = createSvgIconElement(doc, 'check');\n            wrapperElem.appendChild(markElem);\n            config.value.emitter.on('change', this.onValueChange_);\n            this.value = config.value;\n            this.update_();\n        }\n        update_() {\n            this.inputElement.checked = this.value.rawValue;\n        }\n        onValueChange_() {\n            this.update_();\n        }\n    }\n\n    class CheckboxController {\n        constructor(doc, config) {\n            this.onInputChange_ = this.onInputChange_.bind(this);\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.view = new CheckboxView(doc, {\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            this.view.inputElement.addEventListener('change', this.onInputChange_);\n        }\n        onInputChange_(e) {\n            const inputElem = forceCast(e.currentTarget);\n            this.value.rawValue = inputElem.checked;\n        }\n    }\n\n    function createConstraint$6(params) {\n        const constraints = [];\n        const lc = createListConstraint(params.options);\n        if (lc) {\n            constraints.push(lc);\n        }\n        return new CompositeConstraint(constraints);\n    }\n    const BooleanInputPlugin = {\n        id: 'input-bool',\n        type: 'input',\n        accept: (value, params) => {\n            if (typeof value !== 'boolean') {\n                return null;\n            }\n            const p = ParamsParsers;\n            const result = parseParams(params, {\n                options: p.optional.custom(parseListOptions),\n            });\n            return result\n                ? {\n                    initialValue: value,\n                    params: result,\n                }\n                : null;\n        },\n        binding: {\n            reader: (_args) => boolFromUnknown,\n            constraint: (args) => createConstraint$6(args.params),\n            writer: (_args) => writePrimitive,\n        },\n        controller: (args) => {\n            const doc = args.document;\n            const value = args.value;\n            const c = args.constraint;\n            const lc = c && findConstraint(c, ListConstraint);\n            if (lc) {\n                return new ListController(doc, {\n                    props: new ValueMap({\n                        options: lc.values.value('options'),\n                    }),\n                    value: value,\n                    viewProps: args.viewProps,\n                });\n            }\n            return new CheckboxController(doc, {\n                value: value,\n                viewProps: args.viewProps,\n            });\n        },\n    };\n\n    const className$c = ClassName('col');\n    class ColorView {\n        constructor(doc, config) {\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$c());\n            config.foldable.bindExpandedClass(this.element, className$c(undefined, 'expanded'));\n            bindValueMap(config.foldable, 'completed', valueToClassName(this.element, className$c(undefined, 'cpl')));\n            const headElem = doc.createElement('div');\n            headElem.classList.add(className$c('h'));\n            this.element.appendChild(headElem);\n            const swatchElem = doc.createElement('div');\n            swatchElem.classList.add(className$c('s'));\n            headElem.appendChild(swatchElem);\n            this.swatchElement = swatchElem;\n            const textElem = doc.createElement('div');\n            textElem.classList.add(className$c('t'));\n            headElem.appendChild(textElem);\n            this.textElement = textElem;\n            if (config.pickerLayout === 'inline') {\n                const pickerElem = doc.createElement('div');\n                pickerElem.classList.add(className$c('p'));\n                this.element.appendChild(pickerElem);\n                this.pickerElement = pickerElem;\n            }\n            else {\n                this.pickerElement = null;\n            }\n        }\n    }\n\n    function rgbToHslInt(r, g, b) {\n        const rp = constrainRange(r / 255, 0, 1);\n        const gp = constrainRange(g / 255, 0, 1);\n        const bp = constrainRange(b / 255, 0, 1);\n        const cmax = Math.max(rp, gp, bp);\n        const cmin = Math.min(rp, gp, bp);\n        const c = cmax - cmin;\n        let h = 0;\n        let s = 0;\n        const l = (cmin + cmax) / 2;\n        if (c !== 0) {\n            s = c / (1 - Math.abs(cmax + cmin - 1));\n            if (rp === cmax) {\n                h = (gp - bp) / c;\n            }\n            else if (gp === cmax) {\n                h = 2 + (bp - rp) / c;\n            }\n            else {\n                h = 4 + (rp - gp) / c;\n            }\n            h = h / 6 + (h < 0 ? 1 : 0);\n        }\n        return [h * 360, s * 100, l * 100];\n    }\n    function hslToRgbInt(h, s, l) {\n        const hp = ((h % 360) + 360) % 360;\n        const sp = constrainRange(s / 100, 0, 1);\n        const lp = constrainRange(l / 100, 0, 1);\n        const c = (1 - Math.abs(2 * lp - 1)) * sp;\n        const x = c * (1 - Math.abs(((hp / 60) % 2) - 1));\n        const m = lp - c / 2;\n        let rp, gp, bp;\n        if (hp >= 0 && hp < 60) {\n            [rp, gp, bp] = [c, x, 0];\n        }\n        else if (hp >= 60 && hp < 120) {\n            [rp, gp, bp] = [x, c, 0];\n        }\n        else if (hp >= 120 && hp < 180) {\n            [rp, gp, bp] = [0, c, x];\n        }\n        else if (hp >= 180 && hp < 240) {\n            [rp, gp, bp] = [0, x, c];\n        }\n        else if (hp >= 240 && hp < 300) {\n            [rp, gp, bp] = [x, 0, c];\n        }\n        else {\n            [rp, gp, bp] = [c, 0, x];\n        }\n        return [(rp + m) * 255, (gp + m) * 255, (bp + m) * 255];\n    }\n    function rgbToHsvInt(r, g, b) {\n        const rp = constrainRange(r / 255, 0, 1);\n        const gp = constrainRange(g / 255, 0, 1);\n        const bp = constrainRange(b / 255, 0, 1);\n        const cmax = Math.max(rp, gp, bp);\n        const cmin = Math.min(rp, gp, bp);\n        const d = cmax - cmin;\n        let h;\n        if (d === 0) {\n            h = 0;\n        }\n        else if (cmax === rp) {\n            h = 60 * (((((gp - bp) / d) % 6) + 6) % 6);\n        }\n        else if (cmax === gp) {\n            h = 60 * ((bp - rp) / d + 2);\n        }\n        else {\n            h = 60 * ((rp - gp) / d + 4);\n        }\n        const s = cmax === 0 ? 0 : d / cmax;\n        const v = cmax;\n        return [h, s * 100, v * 100];\n    }\n    function hsvToRgbInt(h, s, v) {\n        const hp = loopRange(h, 360);\n        const sp = constrainRange(s / 100, 0, 1);\n        const vp = constrainRange(v / 100, 0, 1);\n        const c = vp * sp;\n        const x = c * (1 - Math.abs(((hp / 60) % 2) - 1));\n        const m = vp - c;\n        let rp, gp, bp;\n        if (hp >= 0 && hp < 60) {\n            [rp, gp, bp] = [c, x, 0];\n        }\n        else if (hp >= 60 && hp < 120) {\n            [rp, gp, bp] = [x, c, 0];\n        }\n        else if (hp >= 120 && hp < 180) {\n            [rp, gp, bp] = [0, c, x];\n        }\n        else if (hp >= 180 && hp < 240) {\n            [rp, gp, bp] = [0, x, c];\n        }\n        else if (hp >= 240 && hp < 300) {\n            [rp, gp, bp] = [x, 0, c];\n        }\n        else {\n            [rp, gp, bp] = [c, 0, x];\n        }\n        return [(rp + m) * 255, (gp + m) * 255, (bp + m) * 255];\n    }\n    function hslToHsvInt(h, s, l) {\n        const sd = l + (s * (100 - Math.abs(2 * l - 100))) / (2 * 100);\n        return [\n            h,\n            sd !== 0 ? (s * (100 - Math.abs(2 * l - 100))) / sd : 0,\n            l + (s * (100 - Math.abs(2 * l - 100))) / (2 * 100),\n        ];\n    }\n    function hsvToHslInt(h, s, v) {\n        const sd = 100 - Math.abs((v * (200 - s)) / 100 - 100);\n        return [h, sd !== 0 ? (s * v) / sd : 0, (v * (200 - s)) / (2 * 100)];\n    }\n    function removeAlphaComponent(comps) {\n        return [comps[0], comps[1], comps[2]];\n    }\n    function appendAlphaComponent(comps, alpha) {\n        return [comps[0], comps[1], comps[2], alpha];\n    }\n    const MODE_CONVERTER_MAP = {\n        hsl: {\n            hsl: (h, s, l) => [h, s, l],\n            hsv: hslToHsvInt,\n            rgb: hslToRgbInt,\n        },\n        hsv: {\n            hsl: hsvToHslInt,\n            hsv: (h, s, v) => [h, s, v],\n            rgb: hsvToRgbInt,\n        },\n        rgb: {\n            hsl: rgbToHslInt,\n            hsv: rgbToHsvInt,\n            rgb: (r, g, b) => [r, g, b],\n        },\n    };\n    function getColorMaxComponents(mode, type) {\n        return [\n            type === 'float' ? 1 : mode === 'rgb' ? 255 : 360,\n            type === 'float' ? 1 : mode === 'rgb' ? 255 : 100,\n            type === 'float' ? 1 : mode === 'rgb' ? 255 : 100,\n        ];\n    }\n    function loopHueRange(hue, max) {\n        return hue === max ? max : loopRange(hue, max);\n    }\n    function constrainColorComponents(components, mode, type) {\n        var _a;\n        const ms = getColorMaxComponents(mode, type);\n        return [\n            mode === 'rgb'\n                ? constrainRange(components[0], 0, ms[0])\n                : loopHueRange(components[0], ms[0]),\n            constrainRange(components[1], 0, ms[1]),\n            constrainRange(components[2], 0, ms[2]),\n            constrainRange((_a = components[3]) !== null && _a !== void 0 ? _a : 1, 0, 1),\n        ];\n    }\n    function convertColorType(comps, mode, from, to) {\n        const fms = getColorMaxComponents(mode, from);\n        const tms = getColorMaxComponents(mode, to);\n        return comps.map((c, index) => (c / fms[index]) * tms[index]);\n    }\n    function convertColor(components, from, to) {\n        const intComps = convertColorType(components, from.mode, from.type, 'int');\n        const result = MODE_CONVERTER_MAP[from.mode][to.mode](...intComps);\n        return convertColorType(result, to.mode, 'int', to.type);\n    }\n\n    function isRgbColorComponent(obj, key) {\n        if (typeof obj !== 'object' || isEmpty(obj)) {\n            return false;\n        }\n        return key in obj && typeof obj[key] === 'number';\n    }\n    class Color {\n        static black(type = 'int') {\n            return new Color([0, 0, 0], 'rgb', type);\n        }\n        static fromObject(obj, type = 'int') {\n            const comps = 'a' in obj ? [obj.r, obj.g, obj.b, obj.a] : [obj.r, obj.g, obj.b];\n            return new Color(comps, 'rgb', type);\n        }\n        static toRgbaObject(color, type = 'int') {\n            return color.toRgbaObject(type);\n        }\n        static isRgbColorObject(obj) {\n            return (isRgbColorComponent(obj, 'r') &&\n                isRgbColorComponent(obj, 'g') &&\n                isRgbColorComponent(obj, 'b'));\n        }\n        static isRgbaColorObject(obj) {\n            return this.isRgbColorObject(obj) && isRgbColorComponent(obj, 'a');\n        }\n        static isColorObject(obj) {\n            return this.isRgbColorObject(obj);\n        }\n        static equals(v1, v2) {\n            if (v1.mode !== v2.mode) {\n                return false;\n            }\n            const comps1 = v1.comps_;\n            const comps2 = v2.comps_;\n            for (let i = 0; i < comps1.length; i++) {\n                if (comps1[i] !== comps2[i]) {\n                    return false;\n                }\n            }\n            return true;\n        }\n        constructor(comps, mode, type = 'int') {\n            this.mode = mode;\n            this.type = type;\n            this.comps_ = constrainColorComponents(comps, mode, type);\n        }\n        getComponents(opt_mode, type = 'int') {\n            return appendAlphaComponent(convertColor(removeAlphaComponent(this.comps_), { mode: this.mode, type: this.type }, { mode: opt_mode !== null && opt_mode !== void 0 ? opt_mode : this.mode, type }), this.comps_[3]);\n        }\n        toRgbaObject(type = 'int') {\n            const rgbComps = this.getComponents('rgb', type);\n            return {\n                r: rgbComps[0],\n                g: rgbComps[1],\n                b: rgbComps[2],\n                a: rgbComps[3],\n            };\n        }\n    }\n\n    const className$b = ClassName('colp');\n    class ColorPickerView {\n        constructor(doc, config) {\n            this.alphaViews_ = null;\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$b());\n            config.viewProps.bindClassModifiers(this.element);\n            const hsvElem = doc.createElement('div');\n            hsvElem.classList.add(className$b('hsv'));\n            const svElem = doc.createElement('div');\n            svElem.classList.add(className$b('sv'));\n            this.svPaletteView_ = config.svPaletteView;\n            svElem.appendChild(this.svPaletteView_.element);\n            hsvElem.appendChild(svElem);\n            const hElem = doc.createElement('div');\n            hElem.classList.add(className$b('h'));\n            this.hPaletteView_ = config.hPaletteView;\n            hElem.appendChild(this.hPaletteView_.element);\n            hsvElem.appendChild(hElem);\n            this.element.appendChild(hsvElem);\n            const rgbElem = doc.createElement('div');\n            rgbElem.classList.add(className$b('rgb'));\n            this.textView_ = config.textView;\n            rgbElem.appendChild(this.textView_.element);\n            this.element.appendChild(rgbElem);\n            if (config.alphaViews) {\n                this.alphaViews_ = {\n                    palette: config.alphaViews.palette,\n                    text: config.alphaViews.text,\n                };\n                const aElem = doc.createElement('div');\n                aElem.classList.add(className$b('a'));\n                const apElem = doc.createElement('div');\n                apElem.classList.add(className$b('ap'));\n                apElem.appendChild(this.alphaViews_.palette.element);\n                aElem.appendChild(apElem);\n                const atElem = doc.createElement('div');\n                atElem.classList.add(className$b('at'));\n                atElem.appendChild(this.alphaViews_.text.element);\n                aElem.appendChild(atElem);\n                this.element.appendChild(aElem);\n            }\n        }\n        get allFocusableElements() {\n            const elems = [\n                this.svPaletteView_.element,\n                this.hPaletteView_.element,\n                this.textView_.modeSelectElement,\n                ...this.textView_.textViews.map((v) => v.inputElement),\n            ];\n            if (this.alphaViews_) {\n                elems.push(this.alphaViews_.palette.element, this.alphaViews_.text.inputElement);\n            }\n            return elems;\n        }\n    }\n\n    function parseColorType(value) {\n        return value === 'int' ? 'int' : value === 'float' ? 'float' : undefined;\n    }\n    function parseColorInputParams(params) {\n        const p = ParamsParsers;\n        return parseParams(params, {\n            alpha: p.optional.boolean,\n            color: p.optional.object({\n                alpha: p.optional.boolean,\n                type: p.optional.custom(parseColorType),\n            }),\n            expanded: p.optional.boolean,\n            picker: p.optional.custom(parsePickerLayout),\n        });\n    }\n    function getBaseStepForColor(forAlpha) {\n        return forAlpha ? 0.1 : 1;\n    }\n    function extractColorType(params) {\n        var _a;\n        return (_a = params.color) === null || _a === void 0 ? void 0 : _a.type;\n    }\n\n    function equalsStringColorFormat(f1, f2) {\n        return (f1.alpha === f2.alpha &&\n            f1.mode === f2.mode &&\n            f1.notation === f2.notation &&\n            f1.type === f2.type);\n    }\n    function parseCssNumberOrPercentage(text, maxValue) {\n        const m = text.match(/^(.+)%$/);\n        if (!m) {\n            return Math.min(parseFloat(text), maxValue);\n        }\n        return Math.min(parseFloat(m[1]) * 0.01 * maxValue, maxValue);\n    }\n    const ANGLE_TO_DEG_MAP = {\n        deg: (angle) => angle,\n        grad: (angle) => (angle * 360) / 400,\n        rad: (angle) => (angle * 360) / (2 * Math.PI),\n        turn: (angle) => angle * 360,\n    };\n    function parseCssNumberOrAngle(text) {\n        const m = text.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);\n        if (!m) {\n            return parseFloat(text);\n        }\n        const angle = parseFloat(m[1]);\n        const unit = m[2];\n        return ANGLE_TO_DEG_MAP[unit](angle);\n    }\n    function parseFunctionalRgbColorComponents(text) {\n        const m = text.match(/^rgb\\(\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*([0-9A-Fa-f.]+%?)\\s*\\)$/);\n        if (!m) {\n            return null;\n        }\n        const comps = [\n            parseCssNumberOrPercentage(m[1], 255),\n            parseCssNumberOrPercentage(m[2], 255),\n            parseCssNumberOrPercentage(m[3], 255),\n        ];\n        if (isNaN(comps[0]) || isNaN(comps[1]) || isNaN(comps[2])) {\n            return null;\n        }\n        return comps;\n    }\n    function createFunctionalRgbColorParser(type) {\n        return (text) => {\n            const comps = parseFunctionalRgbColorComponents(text);\n            return comps ? new Color(comps, 'rgb', type) : null;\n        };\n    }\n    function parseFunctionalRgbaColorComponents(text) {\n        const m = text.match(/^rgba\\(\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*([0-9A-Fa-f.]+%?)\\s*\\)$/);\n        if (!m) {\n            return null;\n        }\n        const comps = [\n            parseCssNumberOrPercentage(m[1], 255),\n            parseCssNumberOrPercentage(m[2], 255),\n            parseCssNumberOrPercentage(m[3], 255),\n            parseCssNumberOrPercentage(m[4], 1),\n        ];\n        if (isNaN(comps[0]) ||\n            isNaN(comps[1]) ||\n            isNaN(comps[2]) ||\n            isNaN(comps[3])) {\n            return null;\n        }\n        return comps;\n    }\n    function createFunctionalRgbaColorParser(type) {\n        return (text) => {\n            const comps = parseFunctionalRgbaColorComponents(text);\n            return comps ? new Color(comps, 'rgb', type) : null;\n        };\n    }\n    function parseHslColorComponents(text) {\n        const m = text.match(/^hsl\\(\\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\\s*,\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*([0-9A-Fa-f.]+%?)\\s*\\)$/);\n        if (!m) {\n            return null;\n        }\n        const comps = [\n            parseCssNumberOrAngle(m[1]),\n            parseCssNumberOrPercentage(m[2], 100),\n            parseCssNumberOrPercentage(m[3], 100),\n        ];\n        if (isNaN(comps[0]) || isNaN(comps[1]) || isNaN(comps[2])) {\n            return null;\n        }\n        return comps;\n    }\n    function createHslColorParser(type) {\n        return (text) => {\n            const comps = parseHslColorComponents(text);\n            return comps ? new Color(comps, 'hsl', type) : null;\n        };\n    }\n    function parseHslaColorComponents(text) {\n        const m = text.match(/^hsla\\(\\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\\s*,\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*([0-9A-Fa-f.]+%?)\\s*\\)$/);\n        if (!m) {\n            return null;\n        }\n        const comps = [\n            parseCssNumberOrAngle(m[1]),\n            parseCssNumberOrPercentage(m[2], 100),\n            parseCssNumberOrPercentage(m[3], 100),\n            parseCssNumberOrPercentage(m[4], 1),\n        ];\n        if (isNaN(comps[0]) ||\n            isNaN(comps[1]) ||\n            isNaN(comps[2]) ||\n            isNaN(comps[3])) {\n            return null;\n        }\n        return comps;\n    }\n    function createHslaColorParser(type) {\n        return (text) => {\n            const comps = parseHslaColorComponents(text);\n            return comps ? new Color(comps, 'hsl', type) : null;\n        };\n    }\n    function parseHexRgbColorComponents(text) {\n        const mRgb = text.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);\n        if (mRgb) {\n            return [\n                parseInt(mRgb[1] + mRgb[1], 16),\n                parseInt(mRgb[2] + mRgb[2], 16),\n                parseInt(mRgb[3] + mRgb[3], 16),\n            ];\n        }\n        const mRrggbb = text.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);\n        if (mRrggbb) {\n            return [\n                parseInt(mRrggbb[1], 16),\n                parseInt(mRrggbb[2], 16),\n                parseInt(mRrggbb[3], 16),\n            ];\n        }\n        return null;\n    }\n    function parseHexRgbColor(text) {\n        const comps = parseHexRgbColorComponents(text);\n        return comps ? new Color(comps, 'rgb', 'int') : null;\n    }\n    function parseHexRgbaColorComponents(text) {\n        const mRgb = text.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);\n        if (mRgb) {\n            return [\n                parseInt(mRgb[1] + mRgb[1], 16),\n                parseInt(mRgb[2] + mRgb[2], 16),\n                parseInt(mRgb[3] + mRgb[3], 16),\n                mapRange(parseInt(mRgb[4] + mRgb[4], 16), 0, 255, 0, 1),\n            ];\n        }\n        const mRrggbb = text.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);\n        if (mRrggbb) {\n            return [\n                parseInt(mRrggbb[1], 16),\n                parseInt(mRrggbb[2], 16),\n                parseInt(mRrggbb[3], 16),\n                mapRange(parseInt(mRrggbb[4], 16), 0, 255, 0, 1),\n            ];\n        }\n        return null;\n    }\n    function parseHexRgbaColor(text) {\n        const comps = parseHexRgbaColorComponents(text);\n        return comps ? new Color(comps, 'rgb', 'int') : null;\n    }\n    function parseObjectRgbColorComponents(text) {\n        const m = text.match(/^\\{\\s*r\\s*:\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*g\\s*:\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*b\\s*:\\s*([0-9A-Fa-f.]+%?)\\s*\\}$/);\n        if (!m) {\n            return null;\n        }\n        const comps = [\n            parseFloat(m[1]),\n            parseFloat(m[2]),\n            parseFloat(m[3]),\n        ];\n        if (isNaN(comps[0]) || isNaN(comps[1]) || isNaN(comps[2])) {\n            return null;\n        }\n        return comps;\n    }\n    function createObjectRgbColorParser(type) {\n        return (text) => {\n            const comps = parseObjectRgbColorComponents(text);\n            return comps ? new Color(comps, 'rgb', type) : null;\n        };\n    }\n    function parseObjectRgbaColorComponents(text) {\n        const m = text.match(/^\\{\\s*r\\s*:\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*g\\s*:\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*b\\s*:\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*a\\s*:\\s*([0-9A-Fa-f.]+%?)\\s*\\}$/);\n        if (!m) {\n            return null;\n        }\n        const comps = [\n            parseFloat(m[1]),\n            parseFloat(m[2]),\n            parseFloat(m[3]),\n            parseFloat(m[4]),\n        ];\n        if (isNaN(comps[0]) ||\n            isNaN(comps[1]) ||\n            isNaN(comps[2]) ||\n            isNaN(comps[3])) {\n            return null;\n        }\n        return comps;\n    }\n    function createObjectRgbaColorParser(type) {\n        return (text) => {\n            const comps = parseObjectRgbaColorComponents(text);\n            return comps ? new Color(comps, 'rgb', type) : null;\n        };\n    }\n    const PARSER_AND_RESULT = [\n        {\n            parser: parseHexRgbColorComponents,\n            result: {\n                alpha: false,\n                mode: 'rgb',\n                notation: 'hex',\n            },\n        },\n        {\n            parser: parseHexRgbaColorComponents,\n            result: {\n                alpha: true,\n                mode: 'rgb',\n                notation: 'hex',\n            },\n        },\n        {\n            parser: parseFunctionalRgbColorComponents,\n            result: {\n                alpha: false,\n                mode: 'rgb',\n                notation: 'func',\n            },\n        },\n        {\n            parser: parseFunctionalRgbaColorComponents,\n            result: {\n                alpha: true,\n                mode: 'rgb',\n                notation: 'func',\n            },\n        },\n        {\n            parser: parseHslColorComponents,\n            result: {\n                alpha: false,\n                mode: 'hsl',\n                notation: 'func',\n            },\n        },\n        {\n            parser: parseHslaColorComponents,\n            result: {\n                alpha: true,\n                mode: 'hsl',\n                notation: 'func',\n            },\n        },\n        {\n            parser: parseObjectRgbColorComponents,\n            result: {\n                alpha: false,\n                mode: 'rgb',\n                notation: 'object',\n            },\n        },\n        {\n            parser: parseObjectRgbaColorComponents,\n            result: {\n                alpha: true,\n                mode: 'rgb',\n                notation: 'object',\n            },\n        },\n    ];\n    function detectStringColor(text) {\n        return PARSER_AND_RESULT.reduce((prev, { parser, result: detection }) => {\n            if (prev) {\n                return prev;\n            }\n            return parser(text) ? detection : null;\n        }, null);\n    }\n    function detectStringColorFormat(text, type = 'int') {\n        const r = detectStringColor(text);\n        if (!r) {\n            return null;\n        }\n        if (r.notation === 'hex' && type !== 'float') {\n            return Object.assign(Object.assign({}, r), { type: 'int' });\n        }\n        if (r.notation === 'func') {\n            return Object.assign(Object.assign({}, r), { type: type });\n        }\n        return null;\n    }\n    const TYPE_TO_PARSERS = {\n        int: [\n            parseHexRgbColor,\n            parseHexRgbaColor,\n            createFunctionalRgbColorParser('int'),\n            createFunctionalRgbaColorParser('int'),\n            createHslColorParser('int'),\n            createHslaColorParser('int'),\n            createObjectRgbColorParser('int'),\n            createObjectRgbaColorParser('int'),\n        ],\n        float: [\n            createFunctionalRgbColorParser('float'),\n            createFunctionalRgbaColorParser('float'),\n            createHslColorParser('float'),\n            createHslaColorParser('float'),\n            createObjectRgbColorParser('float'),\n            createObjectRgbaColorParser('float'),\n        ],\n    };\n    function createColorStringBindingReader(type) {\n        const parsers = TYPE_TO_PARSERS[type];\n        return (value) => {\n            if (typeof value !== 'string') {\n                return Color.black(type);\n            }\n            const result = parsers.reduce((prev, parser) => {\n                if (prev) {\n                    return prev;\n                }\n                return parser(value);\n            }, null);\n            return result !== null && result !== void 0 ? result : Color.black(type);\n        };\n    }\n    function createColorStringParser(type) {\n        const parsers = TYPE_TO_PARSERS[type];\n        return (value) => {\n            return parsers.reduce((prev, parser) => {\n                if (prev) {\n                    return prev;\n                }\n                return parser(value);\n            }, null);\n        };\n    }\n    function zerofill(comp) {\n        const hex = constrainRange(Math.floor(comp), 0, 255).toString(16);\n        return hex.length === 1 ? `0${hex}` : hex;\n    }\n    function colorToHexRgbString(value, prefix = '#') {\n        const hexes = removeAlphaComponent(value.getComponents('rgb'))\n            .map(zerofill)\n            .join('');\n        return `${prefix}${hexes}`;\n    }\n    function colorToHexRgbaString(value, prefix = '#') {\n        const rgbaComps = value.getComponents('rgb');\n        const hexes = [rgbaComps[0], rgbaComps[1], rgbaComps[2], rgbaComps[3] * 255]\n            .map(zerofill)\n            .join('');\n        return `${prefix}${hexes}`;\n    }\n    function colorToFunctionalRgbString(value, opt_type) {\n        const formatter = createNumberFormatter(opt_type === 'float' ? 2 : 0);\n        const comps = removeAlphaComponent(value.getComponents('rgb', opt_type)).map((comp) => formatter(comp));\n        return `rgb(${comps.join(', ')})`;\n    }\n    function createFunctionalRgbColorFormatter(type) {\n        return (value) => {\n            return colorToFunctionalRgbString(value, type);\n        };\n    }\n    function colorToFunctionalRgbaString(value, opt_type) {\n        const aFormatter = createNumberFormatter(2);\n        const rgbFormatter = createNumberFormatter(opt_type === 'float' ? 2 : 0);\n        const comps = value.getComponents('rgb', opt_type).map((comp, index) => {\n            const formatter = index === 3 ? aFormatter : rgbFormatter;\n            return formatter(comp);\n        });\n        return `rgba(${comps.join(', ')})`;\n    }\n    function createFunctionalRgbaColorFormatter(type) {\n        return (value) => {\n            return colorToFunctionalRgbaString(value, type);\n        };\n    }\n    function colorToFunctionalHslString(value) {\n        const formatters = [\n            createNumberFormatter(0),\n            formatPercentage,\n            formatPercentage,\n        ];\n        const comps = removeAlphaComponent(value.getComponents('hsl')).map((comp, index) => formatters[index](comp));\n        return `hsl(${comps.join(', ')})`;\n    }\n    function colorToFunctionalHslaString(value) {\n        const formatters = [\n            createNumberFormatter(0),\n            formatPercentage,\n            formatPercentage,\n            createNumberFormatter(2),\n        ];\n        const comps = value\n            .getComponents('hsl')\n            .map((comp, index) => formatters[index](comp));\n        return `hsla(${comps.join(', ')})`;\n    }\n    function colorToObjectRgbString(value, type) {\n        const formatter = createNumberFormatter(type === 'float' ? 2 : 0);\n        const names = ['r', 'g', 'b'];\n        const comps = removeAlphaComponent(value.getComponents('rgb', type)).map((comp, index) => `${names[index]}: ${formatter(comp)}`);\n        return `{${comps.join(', ')}}`;\n    }\n    function createObjectRgbColorFormatter(type) {\n        return (value) => colorToObjectRgbString(value, type);\n    }\n    function colorToObjectRgbaString(value, type) {\n        const aFormatter = createNumberFormatter(2);\n        const rgbFormatter = createNumberFormatter(type === 'float' ? 2 : 0);\n        const names = ['r', 'g', 'b', 'a'];\n        const comps = value.getComponents('rgb', type).map((comp, index) => {\n            const formatter = index === 3 ? aFormatter : rgbFormatter;\n            return `${names[index]}: ${formatter(comp)}`;\n        });\n        return `{${comps.join(', ')}}`;\n    }\n    function createObjectRgbaColorFormatter(type) {\n        return (value) => colorToObjectRgbaString(value, type);\n    }\n    const FORMAT_AND_STRINGIFIERS = [\n        {\n            format: {\n                alpha: false,\n                mode: 'rgb',\n                notation: 'hex',\n                type: 'int',\n            },\n            stringifier: colorToHexRgbString,\n        },\n        {\n            format: {\n                alpha: true,\n                mode: 'rgb',\n                notation: 'hex',\n                type: 'int',\n            },\n            stringifier: colorToHexRgbaString,\n        },\n        {\n            format: {\n                alpha: false,\n                mode: 'hsl',\n                notation: 'func',\n                type: 'int',\n            },\n            stringifier: colorToFunctionalHslString,\n        },\n        {\n            format: {\n                alpha: true,\n                mode: 'hsl',\n                notation: 'func',\n                type: 'int',\n            },\n            stringifier: colorToFunctionalHslaString,\n        },\n        ...['int', 'float'].reduce((prev, type) => {\n            return [\n                ...prev,\n                {\n                    format: {\n                        alpha: false,\n                        mode: 'rgb',\n                        notation: 'func',\n                        type: type,\n                    },\n                    stringifier: createFunctionalRgbColorFormatter(type),\n                },\n                {\n                    format: {\n                        alpha: true,\n                        mode: 'rgb',\n                        notation: 'func',\n                        type: type,\n                    },\n                    stringifier: createFunctionalRgbaColorFormatter(type),\n                },\n                {\n                    format: {\n                        alpha: false,\n                        mode: 'rgb',\n                        notation: 'object',\n                        type: type,\n                    },\n                    stringifier: createObjectRgbColorFormatter(type),\n                },\n                {\n                    format: {\n                        alpha: true,\n                        mode: 'rgb',\n                        notation: 'object',\n                        type: type,\n                    },\n                    stringifier: createObjectRgbaColorFormatter(type),\n                },\n            ];\n        }, []),\n    ];\n    function findColorStringifier(format) {\n        return FORMAT_AND_STRINGIFIERS.reduce((prev, fas) => {\n            if (prev) {\n                return prev;\n            }\n            return equalsStringColorFormat(fas.format, format)\n                ? fas.stringifier\n                : null;\n        }, null);\n    }\n\n    const className$a = ClassName('apl');\n    class APaletteView {\n        constructor(doc, config) {\n            this.onValueChange_ = this.onValueChange_.bind(this);\n            this.value = config.value;\n            this.value.emitter.on('change', this.onValueChange_);\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$a());\n            config.viewProps.bindClassModifiers(this.element);\n            config.viewProps.bindTabIndex(this.element);\n            const barElem = doc.createElement('div');\n            barElem.classList.add(className$a('b'));\n            this.element.appendChild(barElem);\n            const colorElem = doc.createElement('div');\n            colorElem.classList.add(className$a('c'));\n            barElem.appendChild(colorElem);\n            this.colorElem_ = colorElem;\n            const markerElem = doc.createElement('div');\n            markerElem.classList.add(className$a('m'));\n            this.element.appendChild(markerElem);\n            this.markerElem_ = markerElem;\n            const previewElem = doc.createElement('div');\n            previewElem.classList.add(className$a('p'));\n            this.markerElem_.appendChild(previewElem);\n            this.previewElem_ = previewElem;\n            this.update_();\n        }\n        update_() {\n            const c = this.value.rawValue;\n            const rgbaComps = c.getComponents('rgb');\n            const leftColor = new Color([rgbaComps[0], rgbaComps[1], rgbaComps[2], 0], 'rgb');\n            const rightColor = new Color([rgbaComps[0], rgbaComps[1], rgbaComps[2], 255], 'rgb');\n            const gradientComps = [\n                'to right',\n                colorToFunctionalRgbaString(leftColor),\n                colorToFunctionalRgbaString(rightColor),\n            ];\n            this.colorElem_.style.background = `linear-gradient(${gradientComps.join(',')})`;\n            this.previewElem_.style.backgroundColor = colorToFunctionalRgbaString(c);\n            const left = mapRange(rgbaComps[3], 0, 1, 0, 100);\n            this.markerElem_.style.left = `${left}%`;\n        }\n        onValueChange_() {\n            this.update_();\n        }\n    }\n\n    class APaletteController {\n        constructor(doc, config) {\n            this.onKeyDown_ = this.onKeyDown_.bind(this);\n            this.onKeyUp_ = this.onKeyUp_.bind(this);\n            this.onPointerDown_ = this.onPointerDown_.bind(this);\n            this.onPointerMove_ = this.onPointerMove_.bind(this);\n            this.onPointerUp_ = this.onPointerUp_.bind(this);\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.view = new APaletteView(doc, {\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            this.ptHandler_ = new PointerHandler(this.view.element);\n            this.ptHandler_.emitter.on('down', this.onPointerDown_);\n            this.ptHandler_.emitter.on('move', this.onPointerMove_);\n            this.ptHandler_.emitter.on('up', this.onPointerUp_);\n            this.view.element.addEventListener('keydown', this.onKeyDown_);\n            this.view.element.addEventListener('keyup', this.onKeyUp_);\n        }\n        handlePointerEvent_(d, opts) {\n            if (!d.point) {\n                return;\n            }\n            const alpha = d.point.x / d.bounds.width;\n            const c = this.value.rawValue;\n            const [h, s, v] = c.getComponents('hsv');\n            this.value.setRawValue(new Color([h, s, v, alpha], 'hsv'), opts);\n        }\n        onPointerDown_(ev) {\n            this.handlePointerEvent_(ev.data, {\n                forceEmit: false,\n                last: false,\n            });\n        }\n        onPointerMove_(ev) {\n            this.handlePointerEvent_(ev.data, {\n                forceEmit: false,\n                last: false,\n            });\n        }\n        onPointerUp_(ev) {\n            this.handlePointerEvent_(ev.data, {\n                forceEmit: true,\n                last: true,\n            });\n        }\n        onKeyDown_(ev) {\n            const step = getStepForKey(getBaseStepForColor(true), getHorizontalStepKeys(ev));\n            if (step === 0) {\n                return;\n            }\n            const c = this.value.rawValue;\n            const [h, s, v, a] = c.getComponents('hsv');\n            this.value.setRawValue(new Color([h, s, v, a + step], 'hsv'), {\n                forceEmit: false,\n                last: false,\n            });\n        }\n        onKeyUp_(ev) {\n            const step = getStepForKey(getBaseStepForColor(true), getHorizontalStepKeys(ev));\n            if (step === 0) {\n                return;\n            }\n            this.value.setRawValue(this.value.rawValue, {\n                forceEmit: true,\n                last: true,\n            });\n        }\n    }\n\n    const className$9 = ClassName('coltxt');\n    function createModeSelectElement(doc) {\n        const selectElem = doc.createElement('select');\n        const items = [\n            { text: 'RGB', value: 'rgb' },\n            { text: 'HSL', value: 'hsl' },\n            { text: 'HSV', value: 'hsv' },\n        ];\n        selectElem.appendChild(items.reduce((frag, item) => {\n            const optElem = doc.createElement('option');\n            optElem.textContent = item.text;\n            optElem.value = item.value;\n            frag.appendChild(optElem);\n            return frag;\n        }, doc.createDocumentFragment()));\n        return selectElem;\n    }\n    class ColorTextView {\n        constructor(doc, config) {\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$9());\n            config.viewProps.bindClassModifiers(this.element);\n            const modeElem = doc.createElement('div');\n            modeElem.classList.add(className$9('m'));\n            this.modeElem_ = createModeSelectElement(doc);\n            this.modeElem_.classList.add(className$9('ms'));\n            modeElem.appendChild(this.modeSelectElement);\n            config.viewProps.bindDisabled(this.modeElem_);\n            const modeMarkerElem = doc.createElement('div');\n            modeMarkerElem.classList.add(className$9('mm'));\n            modeMarkerElem.appendChild(createSvgIconElement(doc, 'dropdown'));\n            modeElem.appendChild(modeMarkerElem);\n            this.element.appendChild(modeElem);\n            const textsElem = doc.createElement('div');\n            textsElem.classList.add(className$9('w'));\n            this.element.appendChild(textsElem);\n            this.textsElem_ = textsElem;\n            this.textViews_ = config.textViews;\n            this.applyTextViews_();\n            bindValue(config.colorMode, (mode) => {\n                this.modeElem_.value = mode;\n            });\n        }\n        get modeSelectElement() {\n            return this.modeElem_;\n        }\n        get textViews() {\n            return this.textViews_;\n        }\n        set textViews(textViews) {\n            this.textViews_ = textViews;\n            this.applyTextViews_();\n        }\n        applyTextViews_() {\n            removeChildElements(this.textsElem_);\n            const doc = this.element.ownerDocument;\n            this.textViews_.forEach((v) => {\n                const compElem = doc.createElement('div');\n                compElem.classList.add(className$9('c'));\n                compElem.appendChild(v.element);\n                this.textsElem_.appendChild(compElem);\n            });\n        }\n    }\n\n    function createFormatter$2(type) {\n        return createNumberFormatter(type === 'float' ? 2 : 0);\n    }\n    function createConstraint$5(mode, type, index) {\n        const max = getColorMaxComponents(mode, type)[index];\n        return new DefiniteRangeConstraint({\n            min: 0,\n            max: max,\n        });\n    }\n    function createComponentController(doc, config, index) {\n        return new NumberTextController(doc, {\n            arrayPosition: index === 0 ? 'fst' : index === 3 - 1 ? 'lst' : 'mid',\n            baseStep: getBaseStepForColor(false),\n            parser: config.parser,\n            props: ValueMap.fromObject({\n                draggingScale: config.colorType === 'float' ? 0.01 : 1,\n                formatter: createFormatter$2(config.colorType),\n            }),\n            value: createValue(0, {\n                constraint: createConstraint$5(config.colorMode, config.colorType, index),\n            }),\n            viewProps: config.viewProps,\n        });\n    }\n    class ColorTextController {\n        constructor(doc, config) {\n            this.onModeSelectChange_ = this.onModeSelectChange_.bind(this);\n            this.colorType_ = config.colorType;\n            this.parser_ = config.parser;\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.colorMode = createValue(this.value.rawValue.mode);\n            this.ccs_ = this.createComponentControllers_(doc);\n            this.view = new ColorTextView(doc, {\n                colorMode: this.colorMode,\n                textViews: [this.ccs_[0].view, this.ccs_[1].view, this.ccs_[2].view],\n                viewProps: this.viewProps,\n            });\n            this.view.modeSelectElement.addEventListener('change', this.onModeSelectChange_);\n        }\n        createComponentControllers_(doc) {\n            const cc = {\n                colorMode: this.colorMode.rawValue,\n                colorType: this.colorType_,\n                parser: this.parser_,\n                viewProps: this.viewProps,\n            };\n            const ccs = [\n                createComponentController(doc, cc, 0),\n                createComponentController(doc, cc, 1),\n                createComponentController(doc, cc, 2),\n            ];\n            ccs.forEach((cs, index) => {\n                connectValues({\n                    primary: this.value,\n                    secondary: cs.value,\n                    forward: (p) => {\n                        return p.rawValue.getComponents(this.colorMode.rawValue, this.colorType_)[index];\n                    },\n                    backward: (p, s) => {\n                        const pickedMode = this.colorMode.rawValue;\n                        const comps = p.rawValue.getComponents(pickedMode, this.colorType_);\n                        comps[index] = s.rawValue;\n                        return new Color(appendAlphaComponent(removeAlphaComponent(comps), comps[3]), pickedMode, this.colorType_);\n                    },\n                });\n            });\n            return ccs;\n        }\n        onModeSelectChange_(ev) {\n            const selectElem = ev.currentTarget;\n            this.colorMode.rawValue = selectElem.value;\n            this.ccs_ = this.createComponentControllers_(this.view.element.ownerDocument);\n            this.view.textViews = [\n                this.ccs_[0].view,\n                this.ccs_[1].view,\n                this.ccs_[2].view,\n            ];\n        }\n    }\n\n    const className$8 = ClassName('hpl');\n    class HPaletteView {\n        constructor(doc, config) {\n            this.onValueChange_ = this.onValueChange_.bind(this);\n            this.value = config.value;\n            this.value.emitter.on('change', this.onValueChange_);\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$8());\n            config.viewProps.bindClassModifiers(this.element);\n            config.viewProps.bindTabIndex(this.element);\n            const colorElem = doc.createElement('div');\n            colorElem.classList.add(className$8('c'));\n            this.element.appendChild(colorElem);\n            const markerElem = doc.createElement('div');\n            markerElem.classList.add(className$8('m'));\n            this.element.appendChild(markerElem);\n            this.markerElem_ = markerElem;\n            this.update_();\n        }\n        update_() {\n            const c = this.value.rawValue;\n            const [h] = c.getComponents('hsv');\n            this.markerElem_.style.backgroundColor = colorToFunctionalRgbString(new Color([h, 100, 100], 'hsv'));\n            const left = mapRange(h, 0, 360, 0, 100);\n            this.markerElem_.style.left = `${left}%`;\n        }\n        onValueChange_() {\n            this.update_();\n        }\n    }\n\n    class HPaletteController {\n        constructor(doc, config) {\n            this.onKeyDown_ = this.onKeyDown_.bind(this);\n            this.onKeyUp_ = this.onKeyUp_.bind(this);\n            this.onPointerDown_ = this.onPointerDown_.bind(this);\n            this.onPointerMove_ = this.onPointerMove_.bind(this);\n            this.onPointerUp_ = this.onPointerUp_.bind(this);\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.view = new HPaletteView(doc, {\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            this.ptHandler_ = new PointerHandler(this.view.element);\n            this.ptHandler_.emitter.on('down', this.onPointerDown_);\n            this.ptHandler_.emitter.on('move', this.onPointerMove_);\n            this.ptHandler_.emitter.on('up', this.onPointerUp_);\n            this.view.element.addEventListener('keydown', this.onKeyDown_);\n            this.view.element.addEventListener('keyup', this.onKeyUp_);\n        }\n        handlePointerEvent_(d, opts) {\n            if (!d.point) {\n                return;\n            }\n            const hue = mapRange(constrainRange(d.point.x, 0, d.bounds.width), 0, d.bounds.width, 0, 360);\n            const c = this.value.rawValue;\n            const [, s, v, a] = c.getComponents('hsv');\n            this.value.setRawValue(new Color([hue, s, v, a], 'hsv'), opts);\n        }\n        onPointerDown_(ev) {\n            this.handlePointerEvent_(ev.data, {\n                forceEmit: false,\n                last: false,\n            });\n        }\n        onPointerMove_(ev) {\n            this.handlePointerEvent_(ev.data, {\n                forceEmit: false,\n                last: false,\n            });\n        }\n        onPointerUp_(ev) {\n            this.handlePointerEvent_(ev.data, {\n                forceEmit: true,\n                last: true,\n            });\n        }\n        onKeyDown_(ev) {\n            const step = getStepForKey(getBaseStepForColor(false), getHorizontalStepKeys(ev));\n            if (step === 0) {\n                return;\n            }\n            const c = this.value.rawValue;\n            const [h, s, v, a] = c.getComponents('hsv');\n            this.value.setRawValue(new Color([h + step, s, v, a], 'hsv'), {\n                forceEmit: false,\n                last: false,\n            });\n        }\n        onKeyUp_(ev) {\n            const step = getStepForKey(getBaseStepForColor(false), getHorizontalStepKeys(ev));\n            if (step === 0) {\n                return;\n            }\n            this.value.setRawValue(this.value.rawValue, {\n                forceEmit: true,\n                last: true,\n            });\n        }\n    }\n\n    const className$7 = ClassName('svp');\n    const CANVAS_RESOL = 64;\n    class SvPaletteView {\n        constructor(doc, config) {\n            this.onValueChange_ = this.onValueChange_.bind(this);\n            this.value = config.value;\n            this.value.emitter.on('change', this.onValueChange_);\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$7());\n            config.viewProps.bindClassModifiers(this.element);\n            config.viewProps.bindTabIndex(this.element);\n            const canvasElem = doc.createElement('canvas');\n            canvasElem.height = CANVAS_RESOL;\n            canvasElem.width = CANVAS_RESOL;\n            canvasElem.classList.add(className$7('c'));\n            this.element.appendChild(canvasElem);\n            this.canvasElement = canvasElem;\n            const markerElem = doc.createElement('div');\n            markerElem.classList.add(className$7('m'));\n            this.element.appendChild(markerElem);\n            this.markerElem_ = markerElem;\n            this.update_();\n        }\n        update_() {\n            const ctx = getCanvasContext(this.canvasElement);\n            if (!ctx) {\n                return;\n            }\n            const c = this.value.rawValue;\n            const hsvComps = c.getComponents('hsv');\n            const width = this.canvasElement.width;\n            const height = this.canvasElement.height;\n            const imgData = ctx.getImageData(0, 0, width, height);\n            const data = imgData.data;\n            for (let iy = 0; iy < height; iy++) {\n                for (let ix = 0; ix < width; ix++) {\n                    const s = mapRange(ix, 0, width, 0, 100);\n                    const v = mapRange(iy, 0, height, 100, 0);\n                    const rgbComps = hsvToRgbInt(hsvComps[0], s, v);\n                    const i = (iy * width + ix) * 4;\n                    data[i] = rgbComps[0];\n                    data[i + 1] = rgbComps[1];\n                    data[i + 2] = rgbComps[2];\n                    data[i + 3] = 255;\n                }\n            }\n            ctx.putImageData(imgData, 0, 0);\n            const left = mapRange(hsvComps[1], 0, 100, 0, 100);\n            this.markerElem_.style.left = `${left}%`;\n            const top = mapRange(hsvComps[2], 0, 100, 100, 0);\n            this.markerElem_.style.top = `${top}%`;\n        }\n        onValueChange_() {\n            this.update_();\n        }\n    }\n\n    class SvPaletteController {\n        constructor(doc, config) {\n            this.onKeyDown_ = this.onKeyDown_.bind(this);\n            this.onKeyUp_ = this.onKeyUp_.bind(this);\n            this.onPointerDown_ = this.onPointerDown_.bind(this);\n            this.onPointerMove_ = this.onPointerMove_.bind(this);\n            this.onPointerUp_ = this.onPointerUp_.bind(this);\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.view = new SvPaletteView(doc, {\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            this.ptHandler_ = new PointerHandler(this.view.element);\n            this.ptHandler_.emitter.on('down', this.onPointerDown_);\n            this.ptHandler_.emitter.on('move', this.onPointerMove_);\n            this.ptHandler_.emitter.on('up', this.onPointerUp_);\n            this.view.element.addEventListener('keydown', this.onKeyDown_);\n            this.view.element.addEventListener('keyup', this.onKeyUp_);\n        }\n        handlePointerEvent_(d, opts) {\n            if (!d.point) {\n                return;\n            }\n            const saturation = mapRange(d.point.x, 0, d.bounds.width, 0, 100);\n            const value = mapRange(d.point.y, 0, d.bounds.height, 100, 0);\n            const [h, , , a] = this.value.rawValue.getComponents('hsv');\n            this.value.setRawValue(new Color([h, saturation, value, a], 'hsv'), opts);\n        }\n        onPointerDown_(ev) {\n            this.handlePointerEvent_(ev.data, {\n                forceEmit: false,\n                last: false,\n            });\n        }\n        onPointerMove_(ev) {\n            this.handlePointerEvent_(ev.data, {\n                forceEmit: false,\n                last: false,\n            });\n        }\n        onPointerUp_(ev) {\n            this.handlePointerEvent_(ev.data, {\n                forceEmit: true,\n                last: true,\n            });\n        }\n        onKeyDown_(ev) {\n            if (isArrowKey(ev.key)) {\n                ev.preventDefault();\n            }\n            const [h, s, v, a] = this.value.rawValue.getComponents('hsv');\n            const baseStep = getBaseStepForColor(false);\n            const ds = getStepForKey(baseStep, getHorizontalStepKeys(ev));\n            const dv = getStepForKey(baseStep, getVerticalStepKeys(ev));\n            if (ds === 0 && dv === 0) {\n                return;\n            }\n            this.value.setRawValue(new Color([h, s + ds, v + dv, a], 'hsv'), {\n                forceEmit: false,\n                last: false,\n            });\n        }\n        onKeyUp_(ev) {\n            const baseStep = getBaseStepForColor(false);\n            const ds = getStepForKey(baseStep, getHorizontalStepKeys(ev));\n            const dv = getStepForKey(baseStep, getVerticalStepKeys(ev));\n            if (ds === 0 && dv === 0) {\n                return;\n            }\n            this.value.setRawValue(this.value.rawValue, {\n                forceEmit: true,\n                last: true,\n            });\n        }\n    }\n\n    class ColorPickerController {\n        constructor(doc, config) {\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.hPaletteC_ = new HPaletteController(doc, {\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            this.svPaletteC_ = new SvPaletteController(doc, {\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            this.alphaIcs_ = config.supportsAlpha\n                ? {\n                    palette: new APaletteController(doc, {\n                        value: this.value,\n                        viewProps: this.viewProps,\n                    }),\n                    text: new NumberTextController(doc, {\n                        parser: parseNumber,\n                        baseStep: 0.1,\n                        props: ValueMap.fromObject({\n                            draggingScale: 0.01,\n                            formatter: createNumberFormatter(2),\n                        }),\n                        value: createValue(0, {\n                            constraint: new DefiniteRangeConstraint({ min: 0, max: 1 }),\n                        }),\n                        viewProps: this.viewProps,\n                    }),\n                }\n                : null;\n            if (this.alphaIcs_) {\n                connectValues({\n                    primary: this.value,\n                    secondary: this.alphaIcs_.text.value,\n                    forward: (p) => {\n                        return p.rawValue.getComponents()[3];\n                    },\n                    backward: (p, s) => {\n                        const comps = p.rawValue.getComponents();\n                        comps[3] = s.rawValue;\n                        return new Color(comps, p.rawValue.mode);\n                    },\n                });\n            }\n            this.textC_ = new ColorTextController(doc, {\n                colorType: config.colorType,\n                parser: parseNumber,\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            this.view = new ColorPickerView(doc, {\n                alphaViews: this.alphaIcs_\n                    ? {\n                        palette: this.alphaIcs_.palette.view,\n                        text: this.alphaIcs_.text.view,\n                    }\n                    : null,\n                hPaletteView: this.hPaletteC_.view,\n                supportsAlpha: config.supportsAlpha,\n                svPaletteView: this.svPaletteC_.view,\n                textView: this.textC_.view,\n                viewProps: this.viewProps,\n            });\n        }\n        get textController() {\n            return this.textC_;\n        }\n    }\n\n    const className$6 = ClassName('colsw');\n    class ColorSwatchView {\n        constructor(doc, config) {\n            this.onValueChange_ = this.onValueChange_.bind(this);\n            config.value.emitter.on('change', this.onValueChange_);\n            this.value = config.value;\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$6());\n            config.viewProps.bindClassModifiers(this.element);\n            const swatchElem = doc.createElement('div');\n            swatchElem.classList.add(className$6('sw'));\n            this.element.appendChild(swatchElem);\n            this.swatchElem_ = swatchElem;\n            const buttonElem = doc.createElement('button');\n            buttonElem.classList.add(className$6('b'));\n            config.viewProps.bindDisabled(buttonElem);\n            this.element.appendChild(buttonElem);\n            this.buttonElement = buttonElem;\n            this.update_();\n        }\n        update_() {\n            const value = this.value.rawValue;\n            this.swatchElem_.style.backgroundColor = colorToHexRgbaString(value);\n        }\n        onValueChange_() {\n            this.update_();\n        }\n    }\n\n    class ColorSwatchController {\n        constructor(doc, config) {\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.view = new ColorSwatchView(doc, {\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n        }\n    }\n\n    class ColorController {\n        constructor(doc, config) {\n            this.onButtonBlur_ = this.onButtonBlur_.bind(this);\n            this.onButtonClick_ = this.onButtonClick_.bind(this);\n            this.onPopupChildBlur_ = this.onPopupChildBlur_.bind(this);\n            this.onPopupChildKeydown_ = this.onPopupChildKeydown_.bind(this);\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.foldable_ = Foldable.create(config.expanded);\n            this.swatchC_ = new ColorSwatchController(doc, {\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            const buttonElem = this.swatchC_.view.buttonElement;\n            buttonElem.addEventListener('blur', this.onButtonBlur_);\n            buttonElem.addEventListener('click', this.onButtonClick_);\n            this.textC_ = new TextController(doc, {\n                parser: config.parser,\n                props: ValueMap.fromObject({\n                    formatter: config.formatter,\n                }),\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            this.view = new ColorView(doc, {\n                foldable: this.foldable_,\n                pickerLayout: config.pickerLayout,\n            });\n            this.view.swatchElement.appendChild(this.swatchC_.view.element);\n            this.view.textElement.appendChild(this.textC_.view.element);\n            this.popC_ =\n                config.pickerLayout === 'popup'\n                    ? new PopupController(doc, {\n                        viewProps: this.viewProps,\n                    })\n                    : null;\n            const pickerC = new ColorPickerController(doc, {\n                colorType: config.colorType,\n                supportsAlpha: config.supportsAlpha,\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            pickerC.view.allFocusableElements.forEach((elem) => {\n                elem.addEventListener('blur', this.onPopupChildBlur_);\n                elem.addEventListener('keydown', this.onPopupChildKeydown_);\n            });\n            this.pickerC_ = pickerC;\n            if (this.popC_) {\n                this.view.element.appendChild(this.popC_.view.element);\n                this.popC_.view.element.appendChild(pickerC.view.element);\n                connectValues({\n                    primary: this.foldable_.value('expanded'),\n                    secondary: this.popC_.shows,\n                    forward: (p) => p.rawValue,\n                    backward: (_, s) => s.rawValue,\n                });\n            }\n            else if (this.view.pickerElement) {\n                this.view.pickerElement.appendChild(this.pickerC_.view.element);\n                bindFoldable(this.foldable_, this.view.pickerElement);\n            }\n        }\n        get textController() {\n            return this.textC_;\n        }\n        onButtonBlur_(e) {\n            if (!this.popC_) {\n                return;\n            }\n            const elem = this.view.element;\n            const nextTarget = forceCast(e.relatedTarget);\n            if (!nextTarget || !elem.contains(nextTarget)) {\n                this.popC_.shows.rawValue = false;\n            }\n        }\n        onButtonClick_() {\n            this.foldable_.set('expanded', !this.foldable_.get('expanded'));\n            if (this.foldable_.get('expanded')) {\n                this.pickerC_.view.allFocusableElements[0].focus();\n            }\n        }\n        onPopupChildBlur_(ev) {\n            if (!this.popC_) {\n                return;\n            }\n            const elem = this.popC_.view.element;\n            const nextTarget = findNextTarget(ev);\n            if (nextTarget && elem.contains(nextTarget)) {\n                return;\n            }\n            if (nextTarget &&\n                nextTarget === this.swatchC_.view.buttonElement &&\n                !supportsTouch(elem.ownerDocument)) {\n                return;\n            }\n            this.popC_.shows.rawValue = false;\n        }\n        onPopupChildKeydown_(ev) {\n            if (this.popC_) {\n                if (ev.key === 'Escape') {\n                    this.popC_.shows.rawValue = false;\n                }\n            }\n            else if (this.view.pickerElement) {\n                if (ev.key === 'Escape') {\n                    this.swatchC_.view.buttonElement.focus();\n                }\n            }\n        }\n    }\n\n    function colorFromObject(value, opt_type) {\n        if (Color.isColorObject(value)) {\n            return Color.fromObject(value, opt_type);\n        }\n        return Color.black(opt_type);\n    }\n    function colorToRgbNumber(value) {\n        return removeAlphaComponent(value.getComponents('rgb')).reduce((result, comp) => {\n            return (result << 8) | (Math.floor(comp) & 0xff);\n        }, 0);\n    }\n    function colorToRgbaNumber(value) {\n        return (value.getComponents('rgb').reduce((result, comp, index) => {\n            const hex = Math.floor(index === 3 ? comp * 255 : comp) & 0xff;\n            return (result << 8) | hex;\n        }, 0) >>> 0);\n    }\n    function numberToRgbColor(num) {\n        return new Color([(num >> 16) & 0xff, (num >> 8) & 0xff, num & 0xff], 'rgb');\n    }\n    function numberToRgbaColor(num) {\n        return new Color([\n            (num >> 24) & 0xff,\n            (num >> 16) & 0xff,\n            (num >> 8) & 0xff,\n            mapRange(num & 0xff, 0, 255, 0, 1),\n        ], 'rgb');\n    }\n    function colorFromRgbNumber(value) {\n        if (typeof value !== 'number') {\n            return Color.black();\n        }\n        return numberToRgbColor(value);\n    }\n    function colorFromRgbaNumber(value) {\n        if (typeof value !== 'number') {\n            return Color.black();\n        }\n        return numberToRgbaColor(value);\n    }\n\n    function createColorStringWriter(format) {\n        const stringify = findColorStringifier(format);\n        return stringify\n            ? (target, value) => {\n                writePrimitive(target, stringify(value));\n            }\n            : null;\n    }\n    function createColorNumberWriter(supportsAlpha) {\n        const colorToNumber = supportsAlpha ? colorToRgbaNumber : colorToRgbNumber;\n        return (target, value) => {\n            writePrimitive(target, colorToNumber(value));\n        };\n    }\n    function writeRgbaColorObject(target, value, opt_type) {\n        const obj = value.toRgbaObject(opt_type);\n        target.writeProperty('r', obj.r);\n        target.writeProperty('g', obj.g);\n        target.writeProperty('b', obj.b);\n        target.writeProperty('a', obj.a);\n    }\n    function writeRgbColorObject(target, value, opt_type) {\n        const obj = value.toRgbaObject(opt_type);\n        target.writeProperty('r', obj.r);\n        target.writeProperty('g', obj.g);\n        target.writeProperty('b', obj.b);\n    }\n    function createColorObjectWriter(supportsAlpha, opt_type) {\n        return (target, inValue) => {\n            if (supportsAlpha) {\n                writeRgbaColorObject(target, inValue, opt_type);\n            }\n            else {\n                writeRgbColorObject(target, inValue, opt_type);\n            }\n        };\n    }\n\n    function shouldSupportAlpha$1(inputParams) {\n        var _a;\n        if ((inputParams === null || inputParams === void 0 ? void 0 : inputParams.alpha) || ((_a = inputParams === null || inputParams === void 0 ? void 0 : inputParams.color) === null || _a === void 0 ? void 0 : _a.alpha)) {\n            return true;\n        }\n        return false;\n    }\n    function createFormatter$1(supportsAlpha) {\n        return supportsAlpha\n            ? (v) => colorToHexRgbaString(v, '0x')\n            : (v) => colorToHexRgbString(v, '0x');\n    }\n    function isForColor(params) {\n        if ('color' in params) {\n            return true;\n        }\n        if ('view' in params && params.view === 'color') {\n            return true;\n        }\n        return false;\n    }\n    const NumberColorInputPlugin = {\n        id: 'input-color-number',\n        type: 'input',\n        accept: (value, params) => {\n            if (typeof value !== 'number') {\n                return null;\n            }\n            if (!isForColor(params)) {\n                return null;\n            }\n            const result = parseColorInputParams(params);\n            return result\n                ? {\n                    initialValue: value,\n                    params: result,\n                }\n                : null;\n        },\n        binding: {\n            reader: (args) => {\n                return shouldSupportAlpha$1(args.params)\n                    ? colorFromRgbaNumber\n                    : colorFromRgbNumber;\n            },\n            equals: Color.equals,\n            writer: (args) => {\n                return createColorNumberWriter(shouldSupportAlpha$1(args.params));\n            },\n        },\n        controller: (args) => {\n            const supportsAlpha = shouldSupportAlpha$1(args.params);\n            const expanded = 'expanded' in args.params ? args.params.expanded : undefined;\n            const picker = 'picker' in args.params ? args.params.picker : undefined;\n            return new ColorController(args.document, {\n                colorType: 'int',\n                expanded: expanded !== null && expanded !== void 0 ? expanded : false,\n                formatter: createFormatter$1(supportsAlpha),\n                parser: createColorStringParser('int'),\n                pickerLayout: picker !== null && picker !== void 0 ? picker : 'popup',\n                supportsAlpha: supportsAlpha,\n                value: args.value,\n                viewProps: args.viewProps,\n            });\n        },\n    };\n\n    function shouldSupportAlpha(initialValue) {\n        return Color.isRgbaColorObject(initialValue);\n    }\n    function createColorObjectReader(opt_type) {\n        return (value) => {\n            return colorFromObject(value, opt_type);\n        };\n    }\n    function createColorObjectFormatter(supportsAlpha, type) {\n        return (value) => {\n            if (supportsAlpha) {\n                return colorToObjectRgbaString(value, type);\n            }\n            return colorToObjectRgbString(value, type);\n        };\n    }\n    const ObjectColorInputPlugin = {\n        id: 'input-color-object',\n        type: 'input',\n        accept: (value, params) => {\n            if (!Color.isColorObject(value)) {\n                return null;\n            }\n            const result = parseColorInputParams(params);\n            return result\n                ? {\n                    initialValue: value,\n                    params: result,\n                }\n                : null;\n        },\n        binding: {\n            reader: (args) => createColorObjectReader(extractColorType(args.params)),\n            equals: Color.equals,\n            writer: (args) => createColorObjectWriter(shouldSupportAlpha(args.initialValue), extractColorType(args.params)),\n        },\n        controller: (args) => {\n            var _a;\n            const supportsAlpha = Color.isRgbaColorObject(args.initialValue);\n            const expanded = 'expanded' in args.params ? args.params.expanded : undefined;\n            const picker = 'picker' in args.params ? args.params.picker : undefined;\n            const type = (_a = extractColorType(args.params)) !== null && _a !== void 0 ? _a : 'int';\n            return new ColorController(args.document, {\n                colorType: type,\n                expanded: expanded !== null && expanded !== void 0 ? expanded : false,\n                formatter: createColorObjectFormatter(supportsAlpha, type),\n                parser: createColorStringParser(type),\n                pickerLayout: picker !== null && picker !== void 0 ? picker : 'popup',\n                supportsAlpha: supportsAlpha,\n                value: args.value,\n                viewProps: args.viewProps,\n            });\n        },\n    };\n\n    const StringColorInputPlugin = {\n        id: 'input-color-string',\n        type: 'input',\n        accept: (value, params) => {\n            if (typeof value !== 'string') {\n                return null;\n            }\n            if ('view' in params && params.view === 'text') {\n                return null;\n            }\n            const format = detectStringColorFormat(value, extractColorType(params));\n            if (!format) {\n                return null;\n            }\n            const stringifier = findColorStringifier(format);\n            if (!stringifier) {\n                return null;\n            }\n            const result = parseColorInputParams(params);\n            return result\n                ? {\n                    initialValue: value,\n                    params: result,\n                }\n                : null;\n        },\n        binding: {\n            reader: (args) => { var _a; return createColorStringBindingReader((_a = extractColorType(args.params)) !== null && _a !== void 0 ? _a : 'int'); },\n            equals: Color.equals,\n            writer: (args) => {\n                const format = detectStringColorFormat(args.initialValue, extractColorType(args.params));\n                if (!format) {\n                    throw TpError.shouldNeverHappen();\n                }\n                const writer = createColorStringWriter(format);\n                if (!writer) {\n                    throw TpError.notBindable();\n                }\n                return writer;\n            },\n        },\n        controller: (args) => {\n            const format = detectStringColorFormat(args.initialValue, extractColorType(args.params));\n            if (!format) {\n                throw TpError.shouldNeverHappen();\n            }\n            const stringifier = findColorStringifier(format);\n            if (!stringifier) {\n                throw TpError.shouldNeverHappen();\n            }\n            const expanded = 'expanded' in args.params ? args.params.expanded : undefined;\n            const picker = 'picker' in args.params ? args.params.picker : undefined;\n            return new ColorController(args.document, {\n                colorType: format.type,\n                expanded: expanded !== null && expanded !== void 0 ? expanded : false,\n                formatter: stringifier,\n                parser: createColorStringParser(format.type),\n                pickerLayout: picker !== null && picker !== void 0 ? picker : 'popup',\n                supportsAlpha: format.alpha,\n                value: args.value,\n                viewProps: args.viewProps,\n            });\n        },\n    };\n\n    class PointNdConstraint {\n        constructor(config) {\n            this.components = config.components;\n            this.asm_ = config.assembly;\n        }\n        constrain(value) {\n            const comps = this.asm_\n                .toComponents(value)\n                .map((comp, index) => { var _a, _b; return (_b = (_a = this.components[index]) === null || _a === void 0 ? void 0 : _a.constrain(comp)) !== null && _b !== void 0 ? _b : comp; });\n            return this.asm_.fromComponents(comps);\n        }\n    }\n\n    const className$5 = ClassName('pndtxt');\n    class PointNdTextView {\n        constructor(doc, config) {\n            this.textViews = config.textViews;\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$5());\n            this.textViews.forEach((v) => {\n                const axisElem = doc.createElement('div');\n                axisElem.classList.add(className$5('a'));\n                axisElem.appendChild(v.element);\n                this.element.appendChild(axisElem);\n            });\n        }\n    }\n\n    function createAxisController(doc, config, index) {\n        return new NumberTextController(doc, {\n            arrayPosition: index === 0 ? 'fst' : index === config.axes.length - 1 ? 'lst' : 'mid',\n            baseStep: config.axes[index].baseStep,\n            parser: config.parser,\n            props: config.axes[index].textProps,\n            value: createValue(0, {\n                constraint: config.axes[index].constraint,\n            }),\n            viewProps: config.viewProps,\n        });\n    }\n    class PointNdTextController {\n        constructor(doc, config) {\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.acs_ = config.axes.map((_, index) => createAxisController(doc, config, index));\n            this.acs_.forEach((c, index) => {\n                connectValues({\n                    primary: this.value,\n                    secondary: c.value,\n                    forward: (p) => {\n                        return config.assembly.toComponents(p.rawValue)[index];\n                    },\n                    backward: (p, s) => {\n                        const comps = config.assembly.toComponents(p.rawValue);\n                        comps[index] = s.rawValue;\n                        return config.assembly.fromComponents(comps);\n                    },\n                });\n            });\n            this.view = new PointNdTextView(doc, {\n                textViews: this.acs_.map((ac) => ac.view),\n            });\n        }\n    }\n\n    function createStepConstraint(params, initialValue) {\n        if ('step' in params && !isEmpty(params.step)) {\n            return new StepConstraint(params.step, initialValue);\n        }\n        return null;\n    }\n    function createRangeConstraint(params) {\n        if (!isEmpty(params.max) && !isEmpty(params.min)) {\n            return new DefiniteRangeConstraint({\n                max: params.max,\n                min: params.min,\n            });\n        }\n        if (!isEmpty(params.max) || !isEmpty(params.min)) {\n            return new RangeConstraint({\n                max: params.max,\n                min: params.min,\n            });\n        }\n        return null;\n    }\n    function findNumberRange(c) {\n        const drc = findConstraint(c, DefiniteRangeConstraint);\n        if (drc) {\n            return [drc.values.get('min'), drc.values.get('max')];\n        }\n        const rc = findConstraint(c, RangeConstraint);\n        if (rc) {\n            return [rc.minValue, rc.maxValue];\n        }\n        return [undefined, undefined];\n    }\n    function createConstraint$4(params,\n    initialValue) {\n        const constraints = [];\n        const sc = createStepConstraint(params, initialValue);\n        if (sc) {\n            constraints.push(sc);\n        }\n        const rc = createRangeConstraint(params);\n        if (rc) {\n            constraints.push(rc);\n        }\n        const lc = createListConstraint(params.options);\n        if (lc) {\n            constraints.push(lc);\n        }\n        return new CompositeConstraint(constraints);\n    }\n    const NumberInputPlugin = {\n        id: 'input-number',\n        type: 'input',\n        accept: (value, params) => {\n            if (typeof value !== 'number') {\n                return null;\n            }\n            const p = ParamsParsers;\n            const result = parseParams(params, {\n                format: p.optional.function,\n                max: p.optional.number,\n                min: p.optional.number,\n                options: p.optional.custom(parseListOptions),\n                step: p.optional.number,\n            });\n            return result\n                ? {\n                    initialValue: value,\n                    params: result,\n                }\n                : null;\n        },\n        binding: {\n            reader: (_args) => numberFromUnknown,\n            constraint: (args) => createConstraint$4(args.params, args.initialValue),\n            writer: (_args) => writePrimitive,\n        },\n        controller: (args) => {\n            var _a;\n            const value = args.value;\n            const c = args.constraint;\n            const lc = c && findConstraint(c, ListConstraint);\n            if (lc) {\n                return new ListController(args.document, {\n                    props: new ValueMap({\n                        options: lc.values.value('options'),\n                    }),\n                    value: value,\n                    viewProps: args.viewProps,\n                });\n            }\n            const formatter = (_a = ('format' in args.params ? args.params.format : undefined)) !== null && _a !== void 0 ? _a : createNumberFormatter(getSuitableDecimalDigits(c, value.rawValue));\n            const drc = c && findConstraint(c, DefiniteRangeConstraint);\n            if (drc) {\n                return new SliderTextController(args.document, {\n                    baseStep: getBaseStep(c),\n                    parser: parseNumber,\n                    sliderProps: new ValueMap({\n                        maxValue: drc.values.value('max'),\n                        minValue: drc.values.value('min'),\n                    }),\n                    textProps: ValueMap.fromObject({\n                        draggingScale: getSuitableDraggingScale(c, value.rawValue),\n                        formatter: formatter,\n                    }),\n                    value: value,\n                    viewProps: args.viewProps,\n                });\n            }\n            return new NumberTextController(args.document, {\n                baseStep: getBaseStep(c),\n                parser: parseNumber,\n                props: ValueMap.fromObject({\n                    draggingScale: getSuitableDraggingScale(c, value.rawValue),\n                    formatter: formatter,\n                }),\n                value: value,\n                viewProps: args.viewProps,\n            });\n        },\n    };\n\n    class Point2d {\n        constructor(x = 0, y = 0) {\n            this.x = x;\n            this.y = y;\n        }\n        getComponents() {\n            return [this.x, this.y];\n        }\n        static isObject(obj) {\n            if (isEmpty(obj)) {\n                return false;\n            }\n            const x = obj.x;\n            const y = obj.y;\n            if (typeof x !== 'number' || typeof y !== 'number') {\n                return false;\n            }\n            return true;\n        }\n        static equals(v1, v2) {\n            return v1.x === v2.x && v1.y === v2.y;\n        }\n        toObject() {\n            return {\n                x: this.x,\n                y: this.y,\n            };\n        }\n    }\n    const Point2dAssembly = {\n        toComponents: (p) => p.getComponents(),\n        fromComponents: (comps) => new Point2d(...comps),\n    };\n\n    const className$4 = ClassName('p2d');\n    class Point2dView {\n        constructor(doc, config) {\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$4());\n            config.viewProps.bindClassModifiers(this.element);\n            bindValue(config.expanded, valueToClassName(this.element, className$4(undefined, 'expanded')));\n            const headElem = doc.createElement('div');\n            headElem.classList.add(className$4('h'));\n            this.element.appendChild(headElem);\n            const buttonElem = doc.createElement('button');\n            buttonElem.classList.add(className$4('b'));\n            buttonElem.appendChild(createSvgIconElement(doc, 'p2dpad'));\n            config.viewProps.bindDisabled(buttonElem);\n            headElem.appendChild(buttonElem);\n            this.buttonElement = buttonElem;\n            const textElem = doc.createElement('div');\n            textElem.classList.add(className$4('t'));\n            headElem.appendChild(textElem);\n            this.textElement = textElem;\n            if (config.pickerLayout === 'inline') {\n                const pickerElem = doc.createElement('div');\n                pickerElem.classList.add(className$4('p'));\n                this.element.appendChild(pickerElem);\n                this.pickerElement = pickerElem;\n            }\n            else {\n                this.pickerElement = null;\n            }\n        }\n    }\n\n    const className$3 = ClassName('p2dp');\n    class Point2dPickerView {\n        constructor(doc, config) {\n            this.onFoldableChange_ = this.onFoldableChange_.bind(this);\n            this.onValueChange_ = this.onValueChange_.bind(this);\n            this.invertsY_ = config.invertsY;\n            this.maxValue_ = config.maxValue;\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$3());\n            if (config.layout === 'popup') {\n                this.element.classList.add(className$3(undefined, 'p'));\n            }\n            config.viewProps.bindClassModifiers(this.element);\n            const padElem = doc.createElement('div');\n            padElem.classList.add(className$3('p'));\n            config.viewProps.bindTabIndex(padElem);\n            this.element.appendChild(padElem);\n            this.padElement = padElem;\n            const svgElem = doc.createElementNS(SVG_NS, 'svg');\n            svgElem.classList.add(className$3('g'));\n            this.padElement.appendChild(svgElem);\n            this.svgElem_ = svgElem;\n            const xAxisElem = doc.createElementNS(SVG_NS, 'line');\n            xAxisElem.classList.add(className$3('ax'));\n            xAxisElem.setAttributeNS(null, 'x1', '0');\n            xAxisElem.setAttributeNS(null, 'y1', '50%');\n            xAxisElem.setAttributeNS(null, 'x2', '100%');\n            xAxisElem.setAttributeNS(null, 'y2', '50%');\n            this.svgElem_.appendChild(xAxisElem);\n            const yAxisElem = doc.createElementNS(SVG_NS, 'line');\n            yAxisElem.classList.add(className$3('ax'));\n            yAxisElem.setAttributeNS(null, 'x1', '50%');\n            yAxisElem.setAttributeNS(null, 'y1', '0');\n            yAxisElem.setAttributeNS(null, 'x2', '50%');\n            yAxisElem.setAttributeNS(null, 'y2', '100%');\n            this.svgElem_.appendChild(yAxisElem);\n            const lineElem = doc.createElementNS(SVG_NS, 'line');\n            lineElem.classList.add(className$3('l'));\n            lineElem.setAttributeNS(null, 'x1', '50%');\n            lineElem.setAttributeNS(null, 'y1', '50%');\n            this.svgElem_.appendChild(lineElem);\n            this.lineElem_ = lineElem;\n            const markerElem = doc.createElement('div');\n            markerElem.classList.add(className$3('m'));\n            this.padElement.appendChild(markerElem);\n            this.markerElem_ = markerElem;\n            config.value.emitter.on('change', this.onValueChange_);\n            this.value = config.value;\n            this.update_();\n        }\n        get allFocusableElements() {\n            return [this.padElement];\n        }\n        update_() {\n            const [x, y] = this.value.rawValue.getComponents();\n            const max = this.maxValue_;\n            const px = mapRange(x, -max, +max, 0, 100);\n            const py = mapRange(y, -max, +max, 0, 100);\n            const ipy = this.invertsY_ ? 100 - py : py;\n            this.lineElem_.setAttributeNS(null, 'x2', `${px}%`);\n            this.lineElem_.setAttributeNS(null, 'y2', `${ipy}%`);\n            this.markerElem_.style.left = `${px}%`;\n            this.markerElem_.style.top = `${ipy}%`;\n        }\n        onValueChange_() {\n            this.update_();\n        }\n        onFoldableChange_() {\n            this.update_();\n        }\n    }\n\n    function computeOffset(ev, baseSteps, invertsY) {\n        return [\n            getStepForKey(baseSteps[0], getHorizontalStepKeys(ev)),\n            getStepForKey(baseSteps[1], getVerticalStepKeys(ev)) * (invertsY ? 1 : -1),\n        ];\n    }\n    class Point2dPickerController {\n        constructor(doc, config) {\n            this.onPadKeyDown_ = this.onPadKeyDown_.bind(this);\n            this.onPadKeyUp_ = this.onPadKeyUp_.bind(this);\n            this.onPointerDown_ = this.onPointerDown_.bind(this);\n            this.onPointerMove_ = this.onPointerMove_.bind(this);\n            this.onPointerUp_ = this.onPointerUp_.bind(this);\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.baseSteps_ = config.baseSteps;\n            this.maxValue_ = config.maxValue;\n            this.invertsY_ = config.invertsY;\n            this.view = new Point2dPickerView(doc, {\n                invertsY: this.invertsY_,\n                layout: config.layout,\n                maxValue: this.maxValue_,\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            this.ptHandler_ = new PointerHandler(this.view.padElement);\n            this.ptHandler_.emitter.on('down', this.onPointerDown_);\n            this.ptHandler_.emitter.on('move', this.onPointerMove_);\n            this.ptHandler_.emitter.on('up', this.onPointerUp_);\n            this.view.padElement.addEventListener('keydown', this.onPadKeyDown_);\n            this.view.padElement.addEventListener('keyup', this.onPadKeyUp_);\n        }\n        handlePointerEvent_(d, opts) {\n            if (!d.point) {\n                return;\n            }\n            const max = this.maxValue_;\n            const px = mapRange(d.point.x, 0, d.bounds.width, -max, +max);\n            const py = mapRange(this.invertsY_ ? d.bounds.height - d.point.y : d.point.y, 0, d.bounds.height, -max, +max);\n            this.value.setRawValue(new Point2d(px, py), opts);\n        }\n        onPointerDown_(ev) {\n            this.handlePointerEvent_(ev.data, {\n                forceEmit: false,\n                last: false,\n            });\n        }\n        onPointerMove_(ev) {\n            this.handlePointerEvent_(ev.data, {\n                forceEmit: false,\n                last: false,\n            });\n        }\n        onPointerUp_(ev) {\n            this.handlePointerEvent_(ev.data, {\n                forceEmit: true,\n                last: true,\n            });\n        }\n        onPadKeyDown_(ev) {\n            if (isArrowKey(ev.key)) {\n                ev.preventDefault();\n            }\n            const [dx, dy] = computeOffset(ev, this.baseSteps_, this.invertsY_);\n            if (dx === 0 && dy === 0) {\n                return;\n            }\n            this.value.setRawValue(new Point2d(this.value.rawValue.x + dx, this.value.rawValue.y + dy), {\n                forceEmit: false,\n                last: false,\n            });\n        }\n        onPadKeyUp_(ev) {\n            const [dx, dy] = computeOffset(ev, this.baseSteps_, this.invertsY_);\n            if (dx === 0 && dy === 0) {\n                return;\n            }\n            this.value.setRawValue(this.value.rawValue, {\n                forceEmit: true,\n                last: true,\n            });\n        }\n    }\n\n    class Point2dController {\n        constructor(doc, config) {\n            var _a, _b;\n            this.onPopupChildBlur_ = this.onPopupChildBlur_.bind(this);\n            this.onPopupChildKeydown_ = this.onPopupChildKeydown_.bind(this);\n            this.onPadButtonBlur_ = this.onPadButtonBlur_.bind(this);\n            this.onPadButtonClick_ = this.onPadButtonClick_.bind(this);\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.foldable_ = Foldable.create(config.expanded);\n            this.popC_ =\n                config.pickerLayout === 'popup'\n                    ? new PopupController(doc, {\n                        viewProps: this.viewProps,\n                    })\n                    : null;\n            const padC = new Point2dPickerController(doc, {\n                baseSteps: [config.axes[0].baseStep, config.axes[1].baseStep],\n                invertsY: config.invertsY,\n                layout: config.pickerLayout,\n                maxValue: config.maxValue,\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            padC.view.allFocusableElements.forEach((elem) => {\n                elem.addEventListener('blur', this.onPopupChildBlur_);\n                elem.addEventListener('keydown', this.onPopupChildKeydown_);\n            });\n            this.pickerC_ = padC;\n            this.textC_ = new PointNdTextController(doc, {\n                assembly: Point2dAssembly,\n                axes: config.axes,\n                parser: config.parser,\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            this.view = new Point2dView(doc, {\n                expanded: this.foldable_.value('expanded'),\n                pickerLayout: config.pickerLayout,\n                viewProps: this.viewProps,\n            });\n            this.view.textElement.appendChild(this.textC_.view.element);\n            (_a = this.view.buttonElement) === null || _a === void 0 ? void 0 : _a.addEventListener('blur', this.onPadButtonBlur_);\n            (_b = this.view.buttonElement) === null || _b === void 0 ? void 0 : _b.addEventListener('click', this.onPadButtonClick_);\n            if (this.popC_) {\n                this.view.element.appendChild(this.popC_.view.element);\n                this.popC_.view.element.appendChild(this.pickerC_.view.element);\n                connectValues({\n                    primary: this.foldable_.value('expanded'),\n                    secondary: this.popC_.shows,\n                    forward: (p) => p.rawValue,\n                    backward: (_, s) => s.rawValue,\n                });\n            }\n            else if (this.view.pickerElement) {\n                this.view.pickerElement.appendChild(this.pickerC_.view.element);\n                bindFoldable(this.foldable_, this.view.pickerElement);\n            }\n        }\n        onPadButtonBlur_(e) {\n            if (!this.popC_) {\n                return;\n            }\n            const elem = this.view.element;\n            const nextTarget = forceCast(e.relatedTarget);\n            if (!nextTarget || !elem.contains(nextTarget)) {\n                this.popC_.shows.rawValue = false;\n            }\n        }\n        onPadButtonClick_() {\n            this.foldable_.set('expanded', !this.foldable_.get('expanded'));\n            if (this.foldable_.get('expanded')) {\n                this.pickerC_.view.allFocusableElements[0].focus();\n            }\n        }\n        onPopupChildBlur_(ev) {\n            if (!this.popC_) {\n                return;\n            }\n            const elem = this.popC_.view.element;\n            const nextTarget = findNextTarget(ev);\n            if (nextTarget && elem.contains(nextTarget)) {\n                return;\n            }\n            if (nextTarget &&\n                nextTarget === this.view.buttonElement &&\n                !supportsTouch(elem.ownerDocument)) {\n                return;\n            }\n            this.popC_.shows.rawValue = false;\n        }\n        onPopupChildKeydown_(ev) {\n            if (this.popC_) {\n                if (ev.key === 'Escape') {\n                    this.popC_.shows.rawValue = false;\n                }\n            }\n            else if (this.view.pickerElement) {\n                if (ev.key === 'Escape') {\n                    this.view.buttonElement.focus();\n                }\n            }\n        }\n    }\n\n    class Point3d {\n        constructor(x = 0, y = 0, z = 0) {\n            this.x = x;\n            this.y = y;\n            this.z = z;\n        }\n        getComponents() {\n            return [this.x, this.y, this.z];\n        }\n        static isObject(obj) {\n            if (isEmpty(obj)) {\n                return false;\n            }\n            const x = obj.x;\n            const y = obj.y;\n            const z = obj.z;\n            if (typeof x !== 'number' ||\n                typeof y !== 'number' ||\n                typeof z !== 'number') {\n                return false;\n            }\n            return true;\n        }\n        static equals(v1, v2) {\n            return v1.x === v2.x && v1.y === v2.y && v1.z === v2.z;\n        }\n        toObject() {\n            return {\n                x: this.x,\n                y: this.y,\n                z: this.z,\n            };\n        }\n    }\n    const Point3dAssembly = {\n        toComponents: (p) => p.getComponents(),\n        fromComponents: (comps) => new Point3d(...comps),\n    };\n\n    function point3dFromUnknown(value) {\n        return Point3d.isObject(value)\n            ? new Point3d(value.x, value.y, value.z)\n            : new Point3d();\n    }\n    function writePoint3d(target, value) {\n        target.writeProperty('x', value.x);\n        target.writeProperty('y', value.y);\n        target.writeProperty('z', value.z);\n    }\n\n    function createConstraint$3(params, initialValue) {\n        return new PointNdConstraint({\n            assembly: Point3dAssembly,\n            components: [\n                createDimensionConstraint('x' in params ? params.x : undefined, initialValue.x),\n                createDimensionConstraint('y' in params ? params.y : undefined, initialValue.y),\n                createDimensionConstraint('z' in params ? params.z : undefined, initialValue.z),\n            ],\n        });\n    }\n    function createAxis$2(initialValue, constraint) {\n        return {\n            baseStep: getBaseStep(constraint),\n            constraint: constraint,\n            textProps: ValueMap.fromObject({\n                draggingScale: getSuitableDraggingScale(constraint, initialValue),\n                formatter: createNumberFormatter(getSuitableDecimalDigits(constraint, initialValue)),\n            }),\n        };\n    }\n    const Point3dInputPlugin = {\n        id: 'input-point3d',\n        type: 'input',\n        accept: (value, params) => {\n            if (!Point3d.isObject(value)) {\n                return null;\n            }\n            const p = ParamsParsers;\n            const result = parseParams(params, {\n                x: p.optional.custom(parsePointDimensionParams),\n                y: p.optional.custom(parsePointDimensionParams),\n                z: p.optional.custom(parsePointDimensionParams),\n            });\n            return result\n                ? {\n                    initialValue: value,\n                    params: result,\n                }\n                : null;\n        },\n        binding: {\n            reader: (_args) => point3dFromUnknown,\n            constraint: (args) => createConstraint$3(args.params, args.initialValue),\n            equals: Point3d.equals,\n            writer: (_args) => writePoint3d,\n        },\n        controller: (args) => {\n            const value = args.value;\n            const c = args.constraint;\n            if (!(c instanceof PointNdConstraint)) {\n                throw TpError.shouldNeverHappen();\n            }\n            return new PointNdTextController(args.document, {\n                assembly: Point3dAssembly,\n                axes: [\n                    createAxis$2(value.rawValue.x, c.components[0]),\n                    createAxis$2(value.rawValue.y, c.components[1]),\n                    createAxis$2(value.rawValue.z, c.components[2]),\n                ],\n                parser: parseNumber,\n                value: value,\n                viewProps: args.viewProps,\n            });\n        },\n    };\n\n    class Point4d {\n        constructor(x = 0, y = 0, z = 0, w = 0) {\n            this.x = x;\n            this.y = y;\n            this.z = z;\n            this.w = w;\n        }\n        getComponents() {\n            return [this.x, this.y, this.z, this.w];\n        }\n        static isObject(obj) {\n            if (isEmpty(obj)) {\n                return false;\n            }\n            const x = obj.x;\n            const y = obj.y;\n            const z = obj.z;\n            const w = obj.w;\n            if (typeof x !== 'number' ||\n                typeof y !== 'number' ||\n                typeof z !== 'number' ||\n                typeof w !== 'number') {\n                return false;\n            }\n            return true;\n        }\n        static equals(v1, v2) {\n            return v1.x === v2.x && v1.y === v2.y && v1.z === v2.z && v1.w === v2.w;\n        }\n        toObject() {\n            return {\n                x: this.x,\n                y: this.y,\n                z: this.z,\n                w: this.w,\n            };\n        }\n    }\n    const Point4dAssembly = {\n        toComponents: (p) => p.getComponents(),\n        fromComponents: (comps) => new Point4d(...comps),\n    };\n\n    function point4dFromUnknown(value) {\n        return Point4d.isObject(value)\n            ? new Point4d(value.x, value.y, value.z, value.w)\n            : new Point4d();\n    }\n    function writePoint4d(target, value) {\n        target.writeProperty('x', value.x);\n        target.writeProperty('y', value.y);\n        target.writeProperty('z', value.z);\n        target.writeProperty('w', value.w);\n    }\n\n    function createConstraint$2(params, initialValue) {\n        return new PointNdConstraint({\n            assembly: Point4dAssembly,\n            components: [\n                createDimensionConstraint('x' in params ? params.x : undefined, initialValue.x),\n                createDimensionConstraint('y' in params ? params.y : undefined, initialValue.y),\n                createDimensionConstraint('z' in params ? params.z : undefined, initialValue.z),\n                createDimensionConstraint('w' in params ? params.w : undefined, initialValue.w),\n            ],\n        });\n    }\n    function createAxis$1(initialValue, constraint) {\n        return {\n            baseStep: getBaseStep(constraint),\n            constraint: constraint,\n            textProps: ValueMap.fromObject({\n                draggingScale: getSuitableDraggingScale(constraint, initialValue),\n                formatter: createNumberFormatter(getSuitableDecimalDigits(constraint, initialValue)),\n            }),\n        };\n    }\n    const Point4dInputPlugin = {\n        id: 'input-point4d',\n        type: 'input',\n        accept: (value, params) => {\n            if (!Point4d.isObject(value)) {\n                return null;\n            }\n            const p = ParamsParsers;\n            const result = parseParams(params, {\n                x: p.optional.custom(parsePointDimensionParams),\n                y: p.optional.custom(parsePointDimensionParams),\n                z: p.optional.custom(parsePointDimensionParams),\n                w: p.optional.custom(parsePointDimensionParams),\n            });\n            return result\n                ? {\n                    initialValue: value,\n                    params: result,\n                }\n                : null;\n        },\n        binding: {\n            reader: (_args) => point4dFromUnknown,\n            constraint: (args) => createConstraint$2(args.params, args.initialValue),\n            equals: Point4d.equals,\n            writer: (_args) => writePoint4d,\n        },\n        controller: (args) => {\n            const value = args.value;\n            const c = args.constraint;\n            if (!(c instanceof PointNdConstraint)) {\n                throw TpError.shouldNeverHappen();\n            }\n            return new PointNdTextController(args.document, {\n                assembly: Point4dAssembly,\n                axes: value.rawValue\n                    .getComponents()\n                    .map((comp, index) => createAxis$1(comp, c.components[index])),\n                parser: parseNumber,\n                value: value,\n                viewProps: args.viewProps,\n            });\n        },\n    };\n\n    function createConstraint$1(params) {\n        const constraints = [];\n        const lc = createListConstraint(params.options);\n        if (lc) {\n            constraints.push(lc);\n        }\n        return new CompositeConstraint(constraints);\n    }\n    const StringInputPlugin = {\n        id: 'input-string',\n        type: 'input',\n        accept: (value, params) => {\n            if (typeof value !== 'string') {\n                return null;\n            }\n            const p = ParamsParsers;\n            const result = parseParams(params, {\n                options: p.optional.custom(parseListOptions),\n            });\n            return result\n                ? {\n                    initialValue: value,\n                    params: result,\n                }\n                : null;\n        },\n        binding: {\n            reader: (_args) => stringFromUnknown,\n            constraint: (args) => createConstraint$1(args.params),\n            writer: (_args) => writePrimitive,\n        },\n        controller: (args) => {\n            const doc = args.document;\n            const value = args.value;\n            const c = args.constraint;\n            const lc = c && findConstraint(c, ListConstraint);\n            if (lc) {\n                return new ListController(doc, {\n                    props: new ValueMap({\n                        options: lc.values.value('options'),\n                    }),\n                    value: value,\n                    viewProps: args.viewProps,\n                });\n            }\n            return new TextController(doc, {\n                parser: (v) => v,\n                props: ValueMap.fromObject({\n                    formatter: formatString,\n                }),\n                value: value,\n                viewProps: args.viewProps,\n            });\n        },\n    };\n\n    const Constants = {\n        monitor: {\n            defaultInterval: 200,\n            defaultLineCount: 3,\n        },\n    };\n\n    const className$2 = ClassName('mll');\n    class MultiLogView {\n        constructor(doc, config) {\n            this.onValueUpdate_ = this.onValueUpdate_.bind(this);\n            this.formatter_ = config.formatter;\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$2());\n            config.viewProps.bindClassModifiers(this.element);\n            const textareaElem = doc.createElement('textarea');\n            textareaElem.classList.add(className$2('i'));\n            textareaElem.style.height = `calc(var(--bld-us) * ${config.lineCount})`;\n            textareaElem.readOnly = true;\n            config.viewProps.bindDisabled(textareaElem);\n            this.element.appendChild(textareaElem);\n            this.textareaElem_ = textareaElem;\n            config.value.emitter.on('change', this.onValueUpdate_);\n            this.value = config.value;\n            this.update_();\n        }\n        update_() {\n            const elem = this.textareaElem_;\n            const shouldScroll = elem.scrollTop === elem.scrollHeight - elem.clientHeight;\n            const lines = [];\n            this.value.rawValue.forEach((value) => {\n                if (value !== undefined) {\n                    lines.push(this.formatter_(value));\n                }\n            });\n            elem.textContent = lines.join('\\n');\n            if (shouldScroll) {\n                elem.scrollTop = elem.scrollHeight;\n            }\n        }\n        onValueUpdate_() {\n            this.update_();\n        }\n    }\n\n    class MultiLogController {\n        constructor(doc, config) {\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.view = new MultiLogView(doc, {\n                formatter: config.formatter,\n                lineCount: config.lineCount,\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n        }\n    }\n\n    const className$1 = ClassName('sgl');\n    class SingleLogView {\n        constructor(doc, config) {\n            this.onValueUpdate_ = this.onValueUpdate_.bind(this);\n            this.formatter_ = config.formatter;\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$1());\n            config.viewProps.bindClassModifiers(this.element);\n            const inputElem = doc.createElement('input');\n            inputElem.classList.add(className$1('i'));\n            inputElem.readOnly = true;\n            inputElem.type = 'text';\n            config.viewProps.bindDisabled(inputElem);\n            this.element.appendChild(inputElem);\n            this.inputElement = inputElem;\n            config.value.emitter.on('change', this.onValueUpdate_);\n            this.value = config.value;\n            this.update_();\n        }\n        update_() {\n            const values = this.value.rawValue;\n            const lastValue = values[values.length - 1];\n            this.inputElement.value =\n                lastValue !== undefined ? this.formatter_(lastValue) : '';\n        }\n        onValueUpdate_() {\n            this.update_();\n        }\n    }\n\n    class SingleLogController {\n        constructor(doc, config) {\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.view = new SingleLogView(doc, {\n                formatter: config.formatter,\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n        }\n    }\n\n    const BooleanMonitorPlugin = {\n        id: 'monitor-bool',\n        type: 'monitor',\n        accept: (value, params) => {\n            if (typeof value !== 'boolean') {\n                return null;\n            }\n            const p = ParamsParsers;\n            const result = parseParams(params, {\n                lineCount: p.optional.number,\n            });\n            return result\n                ? {\n                    initialValue: value,\n                    params: result,\n                }\n                : null;\n        },\n        binding: {\n            reader: (_args) => boolFromUnknown,\n        },\n        controller: (args) => {\n            var _a;\n            if (args.value.rawValue.length === 1) {\n                return new SingleLogController(args.document, {\n                    formatter: BooleanFormatter,\n                    value: args.value,\n                    viewProps: args.viewProps,\n                });\n            }\n            return new MultiLogController(args.document, {\n                formatter: BooleanFormatter,\n                lineCount: (_a = args.params.lineCount) !== null && _a !== void 0 ? _a : Constants.monitor.defaultLineCount,\n                value: args.value,\n                viewProps: args.viewProps,\n            });\n        },\n    };\n\n    const className = ClassName('grl');\n    class GraphLogView {\n        constructor(doc, config) {\n            this.onCursorChange_ = this.onCursorChange_.bind(this);\n            this.onValueUpdate_ = this.onValueUpdate_.bind(this);\n            this.element = doc.createElement('div');\n            this.element.classList.add(className());\n            config.viewProps.bindClassModifiers(this.element);\n            this.formatter_ = config.formatter;\n            this.props_ = config.props;\n            this.cursor_ = config.cursor;\n            this.cursor_.emitter.on('change', this.onCursorChange_);\n            const svgElem = doc.createElementNS(SVG_NS, 'svg');\n            svgElem.classList.add(className('g'));\n            svgElem.style.height = `calc(var(--bld-us) * ${config.lineCount})`;\n            this.element.appendChild(svgElem);\n            this.svgElem_ = svgElem;\n            const lineElem = doc.createElementNS(SVG_NS, 'polyline');\n            this.svgElem_.appendChild(lineElem);\n            this.lineElem_ = lineElem;\n            const tooltipElem = doc.createElement('div');\n            tooltipElem.classList.add(className('t'), ClassName('tt')());\n            this.element.appendChild(tooltipElem);\n            this.tooltipElem_ = tooltipElem;\n            config.value.emitter.on('change', this.onValueUpdate_);\n            this.value = config.value;\n            this.update_();\n        }\n        get graphElement() {\n            return this.svgElem_;\n        }\n        update_() {\n            const bounds = this.svgElem_.getBoundingClientRect();\n            const maxIndex = this.value.rawValue.length - 1;\n            const min = this.props_.get('minValue');\n            const max = this.props_.get('maxValue');\n            const points = [];\n            this.value.rawValue.forEach((v, index) => {\n                if (v === undefined) {\n                    return;\n                }\n                const x = mapRange(index, 0, maxIndex, 0, bounds.width);\n                const y = mapRange(v, min, max, bounds.height, 0);\n                points.push([x, y].join(','));\n            });\n            this.lineElem_.setAttributeNS(null, 'points', points.join(' '));\n            const tooltipElem = this.tooltipElem_;\n            const value = this.value.rawValue[this.cursor_.rawValue];\n            if (value === undefined) {\n                tooltipElem.classList.remove(className('t', 'a'));\n                return;\n            }\n            const tx = mapRange(this.cursor_.rawValue, 0, maxIndex, 0, bounds.width);\n            const ty = mapRange(value, min, max, bounds.height, 0);\n            tooltipElem.style.left = `${tx}px`;\n            tooltipElem.style.top = `${ty}px`;\n            tooltipElem.textContent = `${this.formatter_(value)}`;\n            if (!tooltipElem.classList.contains(className('t', 'a'))) {\n                tooltipElem.classList.add(className('t', 'a'), className('t', 'in'));\n                forceReflow(tooltipElem);\n                tooltipElem.classList.remove(className('t', 'in'));\n            }\n        }\n        onValueUpdate_() {\n            this.update_();\n        }\n        onCursorChange_() {\n            this.update_();\n        }\n    }\n\n    class GraphLogController {\n        constructor(doc, config) {\n            this.onGraphMouseMove_ = this.onGraphMouseMove_.bind(this);\n            this.onGraphMouseLeave_ = this.onGraphMouseLeave_.bind(this);\n            this.onGraphPointerDown_ = this.onGraphPointerDown_.bind(this);\n            this.onGraphPointerMove_ = this.onGraphPointerMove_.bind(this);\n            this.onGraphPointerUp_ = this.onGraphPointerUp_.bind(this);\n            this.props_ = config.props;\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.cursor_ = createValue(-1);\n            this.view = new GraphLogView(doc, {\n                cursor: this.cursor_,\n                formatter: config.formatter,\n                lineCount: config.lineCount,\n                props: this.props_,\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            if (!supportsTouch(doc)) {\n                this.view.element.addEventListener('mousemove', this.onGraphMouseMove_);\n                this.view.element.addEventListener('mouseleave', this.onGraphMouseLeave_);\n            }\n            else {\n                const ph = new PointerHandler(this.view.element);\n                ph.emitter.on('down', this.onGraphPointerDown_);\n                ph.emitter.on('move', this.onGraphPointerMove_);\n                ph.emitter.on('up', this.onGraphPointerUp_);\n            }\n        }\n        onGraphMouseLeave_() {\n            this.cursor_.rawValue = -1;\n        }\n        onGraphMouseMove_(ev) {\n            const bounds = this.view.element.getBoundingClientRect();\n            this.cursor_.rawValue = Math.floor(mapRange(ev.offsetX, 0, bounds.width, 0, this.value.rawValue.length));\n        }\n        onGraphPointerDown_(ev) {\n            this.onGraphPointerMove_(ev);\n        }\n        onGraphPointerMove_(ev) {\n            if (!ev.data.point) {\n                this.cursor_.rawValue = -1;\n                return;\n            }\n            this.cursor_.rawValue = Math.floor(mapRange(ev.data.point.x, 0, ev.data.bounds.width, 0, this.value.rawValue.length));\n        }\n        onGraphPointerUp_() {\n            this.cursor_.rawValue = -1;\n        }\n    }\n\n    function createFormatter(params) {\n        return 'format' in params && !isEmpty(params.format)\n            ? params.format\n            : createNumberFormatter(2);\n    }\n    function createTextMonitor(args) {\n        var _a;\n        if (args.value.rawValue.length === 1) {\n            return new SingleLogController(args.document, {\n                formatter: createFormatter(args.params),\n                value: args.value,\n                viewProps: args.viewProps,\n            });\n        }\n        return new MultiLogController(args.document, {\n            formatter: createFormatter(args.params),\n            lineCount: (_a = args.params.lineCount) !== null && _a !== void 0 ? _a : Constants.monitor.defaultLineCount,\n            value: args.value,\n            viewProps: args.viewProps,\n        });\n    }\n    function createGraphMonitor(args) {\n        var _a, _b, _c;\n        return new GraphLogController(args.document, {\n            formatter: createFormatter(args.params),\n            lineCount: (_a = args.params.lineCount) !== null && _a !== void 0 ? _a : Constants.monitor.defaultLineCount,\n            props: ValueMap.fromObject({\n                maxValue: (_b = ('max' in args.params ? args.params.max : null)) !== null && _b !== void 0 ? _b : 100,\n                minValue: (_c = ('min' in args.params ? args.params.min : null)) !== null && _c !== void 0 ? _c : 0,\n            }),\n            value: args.value,\n            viewProps: args.viewProps,\n        });\n    }\n    function shouldShowGraph(params) {\n        return 'view' in params && params.view === 'graph';\n    }\n    const NumberMonitorPlugin = {\n        id: 'monitor-number',\n        type: 'monitor',\n        accept: (value, params) => {\n            if (typeof value !== 'number') {\n                return null;\n            }\n            const p = ParamsParsers;\n            const result = parseParams(params, {\n                format: p.optional.function,\n                lineCount: p.optional.number,\n                max: p.optional.number,\n                min: p.optional.number,\n                view: p.optional.string,\n            });\n            return result\n                ? {\n                    initialValue: value,\n                    params: result,\n                }\n                : null;\n        },\n        binding: {\n            defaultBufferSize: (params) => (shouldShowGraph(params) ? 64 : 1),\n            reader: (_args) => numberFromUnknown,\n        },\n        controller: (args) => {\n            if (shouldShowGraph(args.params)) {\n                return createGraphMonitor(args);\n            }\n            return createTextMonitor(args);\n        },\n    };\n\n    const StringMonitorPlugin = {\n        id: 'monitor-string',\n        type: 'monitor',\n        accept: (value, params) => {\n            if (typeof value !== 'string') {\n                return null;\n            }\n            const p = ParamsParsers;\n            const result = parseParams(params, {\n                lineCount: p.optional.number,\n                multiline: p.optional.boolean,\n            });\n            return result\n                ? {\n                    initialValue: value,\n                    params: result,\n                }\n                : null;\n        },\n        binding: {\n            reader: (_args) => stringFromUnknown,\n        },\n        controller: (args) => {\n            var _a;\n            const value = args.value;\n            const multiline = value.rawValue.length > 1 ||\n                ('multiline' in args.params && args.params.multiline);\n            if (multiline) {\n                return new MultiLogController(args.document, {\n                    formatter: formatString,\n                    lineCount: (_a = args.params.lineCount) !== null && _a !== void 0 ? _a : Constants.monitor.defaultLineCount,\n                    value: value,\n                    viewProps: args.viewProps,\n                });\n            }\n            return new SingleLogController(args.document, {\n                formatter: formatString,\n                value: value,\n                viewProps: args.viewProps,\n            });\n        },\n    };\n\n    function createInputBindingController(plugin, args) {\n        var _a;\n        const result = plugin.accept(args.target.read(), args.params);\n        if (isEmpty(result)) {\n            return null;\n        }\n        const p = ParamsParsers;\n        const valueArgs = {\n            target: args.target,\n            initialValue: result.initialValue,\n            params: result.params,\n        };\n        const reader = plugin.binding.reader(valueArgs);\n        const constraint = plugin.binding.constraint\n            ? plugin.binding.constraint(valueArgs)\n            : undefined;\n        const value = createValue(reader(result.initialValue), {\n            constraint: constraint,\n            equals: plugin.binding.equals,\n        });\n        const binding = new InputBinding({\n            reader: reader,\n            target: args.target,\n            value: value,\n            writer: plugin.binding.writer(valueArgs),\n        });\n        const disabled = p.optional.boolean(args.params.disabled).value;\n        const hidden = p.optional.boolean(args.params.hidden).value;\n        const controller = plugin.controller({\n            constraint: constraint,\n            document: args.document,\n            initialValue: result.initialValue,\n            params: result.params,\n            value: binding.value,\n            viewProps: ViewProps.create({\n                disabled: disabled,\n                hidden: hidden,\n            }),\n        });\n        return new InputBindingController(args.document, {\n            binding: binding,\n            blade: createBlade(),\n            props: ValueMap.fromObject({\n                label: 'label' in args.params\n                    ? (_a = p.optional.string(args.params.label).value) !== null && _a !== void 0 ? _a : null\n                    : args.target.key,\n            }),\n            valueController: controller,\n        });\n    }\n\n    function createTicker(document, interval) {\n        return interval === 0\n            ? new ManualTicker()\n            : new IntervalTicker(document, interval !== null && interval !== void 0 ? interval : Constants.monitor.defaultInterval);\n    }\n    function createMonitorBindingController(plugin, args) {\n        var _a, _b, _c;\n        const p = ParamsParsers;\n        const result = plugin.accept(args.target.read(), args.params);\n        if (isEmpty(result)) {\n            return null;\n        }\n        const bindingArgs = {\n            target: args.target,\n            initialValue: result.initialValue,\n            params: result.params,\n        };\n        const reader = plugin.binding.reader(bindingArgs);\n        const bufferSize = (_b = (_a = p.optional.number(args.params.bufferSize).value) !== null && _a !== void 0 ? _a : (plugin.binding.defaultBufferSize &&\n            plugin.binding.defaultBufferSize(result.params))) !== null && _b !== void 0 ? _b : 1;\n        const interval = p.optional.number(args.params.interval).value;\n        const binding = new MonitorBinding({\n            reader: reader,\n            target: args.target,\n            ticker: createTicker(args.document, interval),\n            value: initializeBuffer(bufferSize),\n        });\n        const disabled = p.optional.boolean(args.params.disabled).value;\n        const hidden = p.optional.boolean(args.params.hidden).value;\n        const controller = plugin.controller({\n            document: args.document,\n            params: result.params,\n            value: binding.value,\n            viewProps: ViewProps.create({\n                disabled: disabled,\n                hidden: hidden,\n            }),\n        });\n        return new MonitorBindingController(args.document, {\n            binding: binding,\n            blade: createBlade(),\n            props: ValueMap.fromObject({\n                label: 'label' in args.params\n                    ? (_c = p.optional.string(args.params.label).value) !== null && _c !== void 0 ? _c : null\n                    : args.target.key,\n            }),\n            valueController: controller,\n        });\n    }\n\n    class PluginPool {\n        constructor() {\n            this.pluginsMap_ = {\n                blades: [],\n                inputs: [],\n                monitors: [],\n            };\n        }\n        getAll() {\n            return [\n                ...this.pluginsMap_.blades,\n                ...this.pluginsMap_.inputs,\n                ...this.pluginsMap_.monitors,\n            ];\n        }\n        register(r) {\n            if (r.type === 'blade') {\n                this.pluginsMap_.blades.unshift(r);\n            }\n            else if (r.type === 'input') {\n                this.pluginsMap_.inputs.unshift(r);\n            }\n            else if (r.type === 'monitor') {\n                this.pluginsMap_.monitors.unshift(r);\n            }\n        }\n        createInput(document, target, params) {\n            const initialValue = target.read();\n            if (isEmpty(initialValue)) {\n                throw new TpError({\n                    context: {\n                        key: target.key,\n                    },\n                    type: 'nomatchingcontroller',\n                });\n            }\n            const bc = this.pluginsMap_.inputs.reduce((result, plugin) => result !== null && result !== void 0 ? result : createInputBindingController(plugin, {\n                document: document,\n                target: target,\n                params: params,\n            }), null);\n            if (bc) {\n                return bc;\n            }\n            throw new TpError({\n                context: {\n                    key: target.key,\n                },\n                type: 'nomatchingcontroller',\n            });\n        }\n        createMonitor(document, target, params) {\n            const bc = this.pluginsMap_.monitors.reduce((result, plugin) => result !== null && result !== void 0 ? result : createMonitorBindingController(plugin, {\n                document: document,\n                params: params,\n                target: target,\n            }), null);\n            if (bc) {\n                return bc;\n            }\n            throw new TpError({\n                context: {\n                    key: target.key,\n                },\n                type: 'nomatchingcontroller',\n            });\n        }\n        createBlade(document, params) {\n            const bc = this.pluginsMap_.blades.reduce((result, plugin) => result !== null && result !== void 0 ? result : createBladeController(plugin, {\n                document: document,\n                params: params,\n            }), null);\n            if (!bc) {\n                throw new TpError({\n                    type: 'nomatchingview',\n                    context: {\n                        params: params,\n                    },\n                });\n            }\n            return bc;\n        }\n        createBladeApi(bc) {\n            if (bc instanceof InputBindingController) {\n                return new InputBindingApi(bc);\n            }\n            if (bc instanceof MonitorBindingController) {\n                return new MonitorBindingApi(bc);\n            }\n            if (bc instanceof RackController) {\n                return new RackApi(bc, this);\n            }\n            const api = this.pluginsMap_.blades.reduce((result, plugin) => result !== null && result !== void 0 ? result : plugin.api({\n                controller: bc,\n                pool: this,\n            }), null);\n            if (!api) {\n                throw TpError.shouldNeverHappen();\n            }\n            return api;\n        }\n    }\n\n    function createDefaultPluginPool() {\n        const pool = new PluginPool();\n        [\n            Point2dInputPlugin,\n            Point3dInputPlugin,\n            Point4dInputPlugin,\n            StringInputPlugin,\n            NumberInputPlugin,\n            StringColorInputPlugin,\n            ObjectColorInputPlugin,\n            NumberColorInputPlugin,\n            BooleanInputPlugin,\n            BooleanMonitorPlugin,\n            StringMonitorPlugin,\n            NumberMonitorPlugin,\n            ButtonBladePlugin,\n            FolderBladePlugin,\n            SeparatorBladePlugin,\n            TabBladePlugin,\n        ].forEach((p) => {\n            pool.register(p);\n        });\n        return pool;\n    }\n\n    function point2dFromUnknown(value) {\n        return Point2d.isObject(value)\n            ? new Point2d(value.x, value.y)\n            : new Point2d();\n    }\n    function writePoint2d(target, value) {\n        target.writeProperty('x', value.x);\n        target.writeProperty('y', value.y);\n    }\n\n    function createDimensionConstraint(params, initialValue) {\n        if (!params) {\n            return undefined;\n        }\n        const constraints = [];\n        const cs = createStepConstraint(params, initialValue);\n        if (cs) {\n            constraints.push(cs);\n        }\n        const rs = createRangeConstraint(params);\n        if (rs) {\n            constraints.push(rs);\n        }\n        return new CompositeConstraint(constraints);\n    }\n    function createConstraint(params, initialValue) {\n        return new PointNdConstraint({\n            assembly: Point2dAssembly,\n            components: [\n                createDimensionConstraint('x' in params ? params.x : undefined, initialValue.x),\n                createDimensionConstraint('y' in params ? params.y : undefined, initialValue.y),\n            ],\n        });\n    }\n    function getSuitableMaxDimensionValue(constraint, rawValue) {\n        const [min, max] = constraint ? findNumberRange(constraint) : [];\n        if (!isEmpty(min) || !isEmpty(max)) {\n            return Math.max(Math.abs(min !== null && min !== void 0 ? min : 0), Math.abs(max !== null && max !== void 0 ? max : 0));\n        }\n        const step = getBaseStep(constraint);\n        return Math.max(Math.abs(step) * 10, Math.abs(rawValue) * 10);\n    }\n    function getSuitableMaxValue(initialValue, constraint) {\n        const xc = constraint instanceof PointNdConstraint\n            ? constraint.components[0]\n            : undefined;\n        const yc = constraint instanceof PointNdConstraint\n            ? constraint.components[1]\n            : undefined;\n        const xr = getSuitableMaxDimensionValue(xc, initialValue.x);\n        const yr = getSuitableMaxDimensionValue(yc, initialValue.y);\n        return Math.max(xr, yr);\n    }\n    function createAxis(initialValue, constraint) {\n        return {\n            baseStep: getBaseStep(constraint),\n            constraint: constraint,\n            textProps: ValueMap.fromObject({\n                draggingScale: getSuitableDraggingScale(constraint, initialValue),\n                formatter: createNumberFormatter(getSuitableDecimalDigits(constraint, initialValue)),\n            }),\n        };\n    }\n    function shouldInvertY(params) {\n        if (!('y' in params)) {\n            return false;\n        }\n        const yParams = params.y;\n        if (!yParams) {\n            return false;\n        }\n        return 'inverted' in yParams ? !!yParams.inverted : false;\n    }\n    const Point2dInputPlugin = {\n        id: 'input-point2d',\n        type: 'input',\n        accept: (value, params) => {\n            if (!Point2d.isObject(value)) {\n                return null;\n            }\n            const p = ParamsParsers;\n            const result = parseParams(params, {\n                expanded: p.optional.boolean,\n                picker: p.optional.custom(parsePickerLayout),\n                x: p.optional.custom(parsePointDimensionParams),\n                y: p.optional.object({\n                    inverted: p.optional.boolean,\n                    max: p.optional.number,\n                    min: p.optional.number,\n                    step: p.optional.number,\n                }),\n            });\n            return result\n                ? {\n                    initialValue: value,\n                    params: result,\n                }\n                : null;\n        },\n        binding: {\n            reader: (_args) => point2dFromUnknown,\n            constraint: (args) => createConstraint(args.params, args.initialValue),\n            equals: Point2d.equals,\n            writer: (_args) => writePoint2d,\n        },\n        controller: (args) => {\n            const doc = args.document;\n            const value = args.value;\n            const c = args.constraint;\n            if (!(c instanceof PointNdConstraint)) {\n                throw TpError.shouldNeverHappen();\n            }\n            const expanded = 'expanded' in args.params ? args.params.expanded : undefined;\n            const picker = 'picker' in args.params ? args.params.picker : undefined;\n            return new Point2dController(doc, {\n                axes: [\n                    createAxis(value.rawValue.x, c.components[0]),\n                    createAxis(value.rawValue.y, c.components[1]),\n                ],\n                expanded: expanded !== null && expanded !== void 0 ? expanded : false,\n                invertsY: shouldInvertY(args.params),\n                maxValue: getSuitableMaxValue(value.rawValue, c),\n                parser: parseNumber,\n                pickerLayout: picker !== null && picker !== void 0 ? picker : 'popup',\n                value: value,\n                viewProps: args.viewProps,\n            });\n        },\n    };\n\n    class ListApi extends BladeApi {\n        constructor(controller) {\n            super(controller);\n            this.emitter_ = new Emitter();\n            this.controller_.valueController.value.emitter.on('change', (ev) => {\n                this.emitter_.emit('change', {\n                    event: new TpChangeEvent(this, ev.rawValue),\n                });\n            });\n        }\n        get label() {\n            return this.controller_.props.get('label');\n        }\n        set label(label) {\n            this.controller_.props.set('label', label);\n        }\n        get options() {\n            return this.controller_.valueController.props.get('options');\n        }\n        set options(options) {\n            this.controller_.valueController.props.set('options', options);\n        }\n        get value() {\n            return this.controller_.valueController.value.rawValue;\n        }\n        set value(value) {\n            this.controller_.valueController.value.rawValue = value;\n        }\n        on(eventName, handler) {\n            const bh = handler.bind(this);\n            this.emitter_.on(eventName, (ev) => {\n                bh(ev.event);\n            });\n            return this;\n        }\n    }\n\n    class SliderApi extends BladeApi {\n        constructor(controller) {\n            super(controller);\n            this.emitter_ = new Emitter();\n            this.controller_.valueController.value.emitter.on('change', (ev) => {\n                this.emitter_.emit('change', {\n                    event: new TpChangeEvent(this, ev.rawValue),\n                });\n            });\n        }\n        get label() {\n            return this.controller_.props.get('label');\n        }\n        set label(label) {\n            this.controller_.props.set('label', label);\n        }\n        get maxValue() {\n            return this.controller_.valueController.sliderController.props.get('maxValue');\n        }\n        set maxValue(maxValue) {\n            this.controller_.valueController.sliderController.props.set('maxValue', maxValue);\n        }\n        get minValue() {\n            return this.controller_.valueController.sliderController.props.get('minValue');\n        }\n        set minValue(minValue) {\n            this.controller_.valueController.sliderController.props.set('minValue', minValue);\n        }\n        get value() {\n            return this.controller_.valueController.value.rawValue;\n        }\n        set value(value) {\n            this.controller_.valueController.value.rawValue = value;\n        }\n        on(eventName, handler) {\n            const bh = handler.bind(this);\n            this.emitter_.on(eventName, (ev) => {\n                bh(ev.event);\n            });\n            return this;\n        }\n    }\n\n    class TextApi extends BladeApi {\n        constructor(controller) {\n            super(controller);\n            this.emitter_ = new Emitter();\n            this.controller_.valueController.value.emitter.on('change', (ev) => {\n                this.emitter_.emit('change', {\n                    event: new TpChangeEvent(this, ev.rawValue),\n                });\n            });\n        }\n        get label() {\n            return this.controller_.props.get('label');\n        }\n        set label(label) {\n            this.controller_.props.set('label', label);\n        }\n        get formatter() {\n            return this.controller_.valueController.props.get('formatter');\n        }\n        set formatter(formatter) {\n            this.controller_.valueController.props.set('formatter', formatter);\n        }\n        get value() {\n            return this.controller_.valueController.value.rawValue;\n        }\n        set value(value) {\n            this.controller_.valueController.value.rawValue = value;\n        }\n        on(eventName, handler) {\n            const bh = handler.bind(this);\n            this.emitter_.on(eventName, (ev) => {\n                bh(ev.event);\n            });\n            return this;\n        }\n    }\n\n    const ListBladePlugin = (function () {\n        return {\n            id: 'list',\n            type: 'blade',\n            accept(params) {\n                const p = ParamsParsers;\n                const result = parseParams(params, {\n                    options: p.required.custom(parseListOptions),\n                    value: p.required.raw,\n                    view: p.required.constant('list'),\n                    label: p.optional.string,\n                });\n                return result ? { params: result } : null;\n            },\n            controller(args) {\n                const lc = new ListConstraint(normalizeListOptions(args.params.options));\n                const value = createValue(args.params.value, {\n                    constraint: lc,\n                });\n                const ic = new ListController(args.document, {\n                    props: new ValueMap({\n                        options: lc.values.value('options'),\n                    }),\n                    value: value,\n                    viewProps: args.viewProps,\n                });\n                return new LabeledValueController(args.document, {\n                    blade: args.blade,\n                    props: ValueMap.fromObject({\n                        label: args.params.label,\n                    }),\n                    valueController: ic,\n                });\n            },\n            api(args) {\n                if (!(args.controller instanceof LabeledValueController)) {\n                    return null;\n                }\n                if (!(args.controller.valueController instanceof ListController)) {\n                    return null;\n                }\n                return new ListApi(args.controller);\n            },\n        };\n    })();\n\n    /**\n     * @hidden\n     */\n    function exportPresetJson(targets) {\n        return targets.reduce((result, target) => {\n            return Object.assign(result, {\n                [target.presetKey]: target.read(),\n            });\n        }, {});\n    }\n    /**\n     * @hidden\n     */\n    function importPresetJson(bindings, preset) {\n        bindings.forEach((binding) => {\n            const value = preset[binding.target.presetKey];\n            if (value !== undefined) {\n                binding.writer(binding.target, binding.reader(value));\n            }\n        });\n    }\n\n    class RootApi extends FolderApi {\n        /**\n         * @hidden\n         */\n        constructor(controller, pool) {\n            super(controller, pool);\n        }\n        get element() {\n            return this.controller_.view.element;\n        }\n        /**\n         * Imports a preset of all inputs.\n         * @param preset The preset object to import.\n         */\n        importPreset(preset) {\n            const bindings = this.controller_.rackController.rack\n                .find(InputBindingController)\n                .map((ibc) => {\n                return ibc.binding;\n            });\n            importPresetJson(bindings, preset);\n            this.refresh();\n        }\n        /**\n         * Exports a preset of all inputs.\n         * @return An exported preset object.\n         */\n        exportPreset() {\n            const targets = this.controller_.rackController.rack\n                .find(InputBindingController)\n                .map((ibc) => {\n                return ibc.binding.target;\n            });\n            return exportPresetJson(targets);\n        }\n        /**\n         * Refreshes all bindings of the pane.\n         */\n        refresh() {\n            // Force-read all input bindings\n            this.controller_.rackController.rack\n                .find(InputBindingController)\n                .forEach((ibc) => {\n                ibc.binding.read();\n            });\n            // Force-read all monitor bindings\n            this.controller_.rackController.rack\n                .find(MonitorBindingController)\n                .forEach((mbc) => {\n                mbc.binding.read();\n            });\n        }\n    }\n\n    class RootController extends FolderController {\n        constructor(doc, config) {\n            super(doc, {\n                expanded: config.expanded,\n                blade: config.blade,\n                props: config.props,\n                root: true,\n                viewProps: config.viewProps,\n            });\n        }\n    }\n\n    const SliderBladePlugin = {\n        id: 'slider',\n        type: 'blade',\n        accept(params) {\n            const p = ParamsParsers;\n            const result = parseParams(params, {\n                max: p.required.number,\n                min: p.required.number,\n                view: p.required.constant('slider'),\n                format: p.optional.function,\n                label: p.optional.string,\n                value: p.optional.number,\n            });\n            return result ? { params: result } : null;\n        },\n        controller(args) {\n            var _a, _b;\n            const initialValue = (_a = args.params.value) !== null && _a !== void 0 ? _a : 0;\n            const drc = new DefiniteRangeConstraint({\n                max: args.params.max,\n                min: args.params.min,\n            });\n            const vc = new SliderTextController(args.document, {\n                baseStep: 1,\n                parser: parseNumber,\n                sliderProps: new ValueMap({\n                    maxValue: drc.values.value('max'),\n                    minValue: drc.values.value('min'),\n                }),\n                textProps: ValueMap.fromObject({\n                    draggingScale: getSuitableDraggingScale(undefined, initialValue),\n                    formatter: (_b = args.params.format) !== null && _b !== void 0 ? _b : numberToString,\n                }),\n                value: createValue(initialValue, {\n                    constraint: drc,\n                }),\n                viewProps: args.viewProps,\n            });\n            return new LabeledValueController(args.document, {\n                blade: args.blade,\n                props: ValueMap.fromObject({\n                    label: args.params.label,\n                }),\n                valueController: vc,\n            });\n        },\n        api(args) {\n            if (!(args.controller instanceof LabeledValueController)) {\n                return null;\n            }\n            if (!(args.controller.valueController instanceof SliderTextController)) {\n                return null;\n            }\n            return new SliderApi(args.controller);\n        },\n    };\n\n    const TextBladePlugin = (function () {\n        return {\n            id: 'text',\n            type: 'blade',\n            accept(params) {\n                const p = ParamsParsers;\n                const result = parseParams(params, {\n                    parse: p.required.function,\n                    value: p.required.raw,\n                    view: p.required.constant('text'),\n                    format: p.optional.function,\n                    label: p.optional.string,\n                });\n                return result ? { params: result } : null;\n            },\n            controller(args) {\n                var _a;\n                const ic = new TextController(args.document, {\n                    parser: args.params.parse,\n                    props: ValueMap.fromObject({\n                        formatter: (_a = args.params.format) !== null && _a !== void 0 ? _a : ((v) => String(v)),\n                    }),\n                    value: createValue(args.params.value),\n                    viewProps: args.viewProps,\n                });\n                return new LabeledValueController(args.document, {\n                    blade: args.blade,\n                    props: ValueMap.fromObject({\n                        label: args.params.label,\n                    }),\n                    valueController: ic,\n                });\n            },\n            api(args) {\n                if (!(args.controller instanceof LabeledValueController)) {\n                    return null;\n                }\n                if (!(args.controller.valueController instanceof TextController)) {\n                    return null;\n                }\n                return new TextApi(args.controller);\n            },\n        };\n    })();\n\n    function createDefaultWrapperElement(doc) {\n        const elem = doc.createElement('div');\n        elem.classList.add(ClassName('dfw')());\n        if (doc.body) {\n            doc.body.appendChild(elem);\n        }\n        return elem;\n    }\n    function embedStyle(doc, id, css) {\n        if (doc.querySelector(`style[data-tp-style=${id}]`)) {\n            return;\n        }\n        const styleElem = doc.createElement('style');\n        styleElem.dataset.tpStyle = id;\n        styleElem.textContent = css;\n        doc.head.appendChild(styleElem);\n    }\n    /**\n     * The root pane of Tweakpane.\n     */\n    class Pane extends RootApi {\n        constructor(opt_config) {\n            var _a, _b;\n            const config = opt_config !== null && opt_config !== void 0 ? opt_config : {};\n            const doc = (_a = config.document) !== null && _a !== void 0 ? _a : getWindowDocument();\n            const pool = createDefaultPluginPool();\n            const rootController = new RootController(doc, {\n                expanded: config.expanded,\n                blade: createBlade(),\n                props: ValueMap.fromObject({\n                    title: config.title,\n                }),\n                viewProps: ViewProps.create(),\n            });\n            super(rootController, pool);\n            this.pool_ = pool;\n            this.containerElem_ = (_b = config.container) !== null && _b !== void 0 ? _b : createDefaultWrapperElement(doc);\n            this.containerElem_.appendChild(this.element);\n            this.doc_ = doc;\n            this.usesDefaultWrapper_ = !config.container;\n            this.setUpDefaultPlugins_();\n        }\n        get document() {\n            if (!this.doc_) {\n                throw TpError.alreadyDisposed();\n            }\n            return this.doc_;\n        }\n        dispose() {\n            const containerElem = this.containerElem_;\n            if (!containerElem) {\n                throw TpError.alreadyDisposed();\n            }\n            if (this.usesDefaultWrapper_) {\n                const parentElem = containerElem.parentElement;\n                if (parentElem) {\n                    parentElem.removeChild(containerElem);\n                }\n            }\n            this.containerElem_ = null;\n            this.doc_ = null;\n            super.dispose();\n        }\n        registerPlugin(bundle) {\n            const plugins = 'plugin' in bundle\n                ? [bundle.plugin]\n                : 'plugins' in bundle\n                    ? bundle.plugins\n                    : [];\n            plugins.forEach((p) => {\n                this.pool_.register(p);\n                this.embedPluginStyle_(p);\n            });\n        }\n        embedPluginStyle_(plugin) {\n            if (plugin.css) {\n                embedStyle(this.document, `plugin-${plugin.id}`, plugin.css);\n            }\n        }\n        setUpDefaultPlugins_() {\n            // NOTE: This string literal will be replaced with the default CSS by Rollup at the compilation time\n            embedStyle(this.document, 'default', '.tp-tbiv_b,.tp-coltxtv_ms,.tp-ckbv_i,.tp-rotv_b,.tp-fldv_b,.tp-mllv_i,.tp-sglv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-mllv_i,.tp-sglv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--mo-fg);height:var(--bld-us);scrollbar-color:currentColor rgba(0,0,0,0);scrollbar-width:thin;width:100%}.tp-mllv_i::-webkit-scrollbar,.tp-sglv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-mllv_i::-webkit-scrollbar-corner,.tp-sglv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:rgba(0,0,0,0)}.tp-mllv_i::-webkit-scrollbar-thumb,.tp-sglv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:rgba(0,0,0,0) solid 2px;border-radius:4px}.tp-rotv{--font-family: var(--tp-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-br: var(--tp-base-border-radius, 6px);--cnt-h-p: var(--tp-container-horizontal-padding, 4px);--cnt-v-p: var(--tp-container-vertical-padding, 4px);--elm-br: var(--tp-element-border-radius, 2px);--bld-s: var(--tp-blade-spacing, 4px);--bld-us: var(--tp-blade-unit-size, 20px);--bs-bg: var(--tp-base-background-color, hsl(230, 7%, 17%));--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--btn-bg: var(--tp-button-background-color, hsl(230, 7%, 70%));--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, hsl(230, 7%, 17%));--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, hsl(230, 7%, 75%));--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, hsl(230, 7%, 75%));--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tabv_c .tp-brkv>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-v-p))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tabv_c .tp-brkv>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--bld-s)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tabv_c .tp-brkv>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tabv_c .tp-brkv>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--elm-br);border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tabv_c .tp-brkv .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-cntv+.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-cntv+.tp-fldv>.tp-fldv_b{border-top-left-radius:0}.tp-tabv_c .tp-brkv>.tp-cntv+.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-cntv+.tp-tabv>.tp-tabv_t{border-top-left-radius:0}.tp-tabv_c .tp-brkv>.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-tabv>.tp-tabv_t{border-top-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--elm-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);overflow:hidden;padding-left:var(--cnt-h-p);padding-right:calc(4px + var(--bld-us) + var(--cnt-h-p));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:\"\";display:block;height:6px;right:calc(var(--cnt-h-p) + (var(--bld-us) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--elm-br);cursor:pointer;display:block;height:var(--bld-us);position:relative;width:var(--bld-us)}.tp-ckbv_w svg{bottom:0;display:block;height:16px;left:0;margin:auto;opacity:0;position:absolute;right:0;top:0;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--bld-us)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-expanded.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--bld-s);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--bld-s)}.tp-colpv_rgb{display:flex;margin-top:var(--bld-s);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-v-p);padding-top:calc(var(--cnt-v-p) + 2px);position:relative}.tp-colpv_a::before{background-color:var(--grv-fg);content:\"\";height:2px;left:calc(-1*var(--cnt-h-p));position:absolute;right:calc(-1*var(--cnt-h-p));top:0}.tp-colpv.tp-v-disabled .tp-colpv_a::before{opacity:.5}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--elm-br);outline:none;overflow:hidden;position:relative}.tp-svpv.tp-v-disabled{opacity:.5}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--bld-us)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative}.tp-hplv.tp-v-disabled{opacity:.5}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative;width:100%}.tp-aplv.tp-v-disabled{opacity:.5}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--elm-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--elm-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;cursor:pointer;display:block;height:var(--bld-us);left:0;margin:0;outline:none;padding:0;position:absolute;top:0;width:var(--bld-us)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--elm-br);bottom:0;content:\"\";display:block;left:0;position:absolute;right:0;top:0}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--elm-br);color:var(--lbl-fg);cursor:pointer;height:var(--bld-us);line-height:var(--bld-us);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv.tp-v-disabled .tp-coltxtv_mm{opacity:.5}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv{position:relative}.tp-fldv.tp-fldv-not .tp-fldv_b{display:none}.tp-fldv_t{padding-left:4px}.tp-fldv_b:disabled .tp-fldv_m{display:none}.tp-fldv_c{padding-left:4px}.tp-fldv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--bld-us) + 4px);width:var(--bs-br)}.tp-fldv_i::before{background-color:currentColor;bottom:0;content:\"\";left:0;position:absolute;top:0;width:4px}.tp-fldv_b:hover+.tp-fldv_i{color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_i{color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_i{color:var(--cnt-bg-a)}.tp-fldv.tp-v-disabled>.tp-fldv_i{opacity:.5}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--bld-us)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-h-p);padding-right:var(--cnt-h-p)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:160px}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding:0 4px}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--bld-us)*3);line-height:var(--bld-us);padding:0 4px;resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--bld-us);margin-right:4px;position:relative;width:var(--bld-us)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--bld-s);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-p2dpv{padding-left:calc(var(--bld-us) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv.tp-v-disabled .tp-p2dpv_p{opacity:.5}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:6px;box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:168px;padding:var(--cnt-v-p) var(--cnt-h-p);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sprv.tp-v-disabled .tp-sprv_r{opacity:.5}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--bld-us);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;bottom:0;content:\"\";display:block;height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:\"\";display:block;height:2px;left:0;margin-bottom:auto;margin-top:auto;position:absolute;right:0;top:0}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--elm-br);bottom:0;content:\"\";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv{position:relative}.tp-tabv_t{align-items:flex-end;color:var(--cnt-bg);display:flex;overflow:hidden;position:relative}.tp-tabv_t:hover{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus){color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active){color:var(--cnt-bg-a)}.tp-tabv_t::before{background-color:currentColor;bottom:0;content:\"\";height:2px;left:0;pointer-events:none;position:absolute;right:0}.tp-tabv.tp-v-disabled .tp-tabv_t::before{opacity:.5}.tp-tabv.tp-tabv-nop .tp-tabv_t{height:calc(var(--bld-us) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_t::before{background-color:var(--cnt-bg);bottom:0;content:\"\";height:2px;left:0;position:absolute;right:0}.tp-tabv_c{padding-bottom:var(--cnt-v-p);padding-left:4px;padding-top:var(--cnt-v-p)}.tp-tabv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--bld-us) + 4px);width:var(--bs-br)}.tp-tabv_i::before{background-color:currentColor;bottom:0;content:\"\";left:0;position:absolute;top:0;width:4px}.tp-tabv_t:hover+.tp-tabv_i{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus)+.tp-tabv_i{color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active)+.tp-tabv_i{color:var(--cnt-bg-a)}.tp-tabv.tp-v-disabled>.tp-tabv_i{opacity:.5}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv.tp-v-disabled::before{opacity:.5}.tp-tbiv_b{display:block;padding-left:calc(var(--cnt-h-p) + 4px);padding-right:calc(var(--cnt-h-p) + 4px);position:relative;width:100%}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_b::before{background-color:var(--cnt-bg);bottom:2px;content:\"\";left:0;pointer-events:none;position:absolute;right:0;top:0}.tp-tbiv_b:hover::before{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus::before{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active::before{background-color:var(--cnt-bg-a)}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);opacity:.5;overflow:hidden;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-txtv{position:relative}.tp-txtv_i{padding:0 4px}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:-3px;position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:\"\";height:calc(var(--bld-us) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--elm-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) rgba(0,0,0,0) rgba(0,0,0,0) rgba(0,0,0,0);border-style:solid;border-width:2px;box-sizing:border-box;content:\"\";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--font-family);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--bld-us) + var(--cnt-h-p));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0}.tp-rotv.tp-rotv-not .tp-rotv_b{display:none}.tp-rotv_b:disabled .tp-rotv_m{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_t{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}');\n            this.pool_.getAll().forEach((plugin) => {\n                this.embedPluginStyle_(plugin);\n            });\n            this.registerPlugin({\n                plugins: [\n                    SliderBladePlugin,\n                    ListBladePlugin,\n                    TabBladePlugin,\n                    TextBladePlugin,\n                ],\n            });\n        }\n    }\n\n    const VERSION = new Semver('3.1.10');\n\n    exports.BladeApi = BladeApi;\n    exports.ButtonApi = ButtonApi;\n    exports.FolderApi = FolderApi;\n    exports.InputBindingApi = InputBindingApi;\n    exports.ListApi = ListApi;\n    exports.MonitorBindingApi = MonitorBindingApi;\n    exports.Pane = Pane;\n    exports.SeparatorApi = SeparatorApi;\n    exports.SliderApi = SliderApi;\n    exports.TabApi = TabApi;\n    exports.TabPageApi = TabPageApi;\n    exports.TextApi = TextApi;\n    exports.TpChangeEvent = TpChangeEvent;\n    exports.VERSION = VERSION;\n\n    Object.defineProperty(exports, '__esModule', { value: true });\n\n}));\n","import { Pane } from 'tweakpane';\n\nexport default class GUI {\n    constructor() {\n        this.pane = new Pane();\n    }\n\n}","import * as THREE from \"three\";\nimport App from \"../App.js\";\nimport { appStateStore } from \"../Utils/Store.js\";\n\n/**\n * Class representing a physics simulation\n */\nexport default class Physics {\n  /**\n   * Creates an instance of Physics.\n   */\n  constructor() {\n    // getting the app instance\n    this.app = new App();\n    this.scene = this.app.scene;\n\n    // setting the physics map\n    this.meshMap = new Map();\n\n    // setting the physics world\n    import(\"@dimforge/rapier3d\").then((RAPIER) => {\n      const gravity = { x: 0, y: -9.81, z: 0 };\n      this.world = new RAPIER.World(gravity);\n      this.rapier = RAPIER;\n\n      this.rapierLoaded = true;\n      appStateStore.setState({ physicsReady: true });\n    });\n  }\n\n  /**\n   * Adds a mesh to the physics simulation with a given rigid body type and collider type\n   * @param {THREE.Mesh} mesh - The mesh to add to the physics simulation\n   * @param {string} type - The rigid body type (\"dynamic\" or \"fixed\")\n   * @param {string} collider - The collider type (\"cuboid\", \"ball\", or \"trimesh\")\n   */\n  add(mesh, type, collider) {\n    // defining the rigid body type\n    let rigidBodyType;\n    switch(type) {\n      case \"dynamic\":\n      rigidBodyType = this.rapier.RigidBodyDesc.dynamic();\n      break;\n    case \"fixed\":\n      rigidBodyType = this.rapier.RigidBodyDesc.fixed();\n      break\n    case 'kinematic':\n      rigidBodyType = this.rapier.RigidBodyDesc.kinematicPositionBased();\n      break;\n    }\n    this.rigidBody = this.world.createRigidBody(rigidBodyType);\n\n    // defining the collider type\n    let colliderType;\n\n    switch (collider) {\n      case \"cuboid\":\n        const dimensions = this.computeCuboidDimensions(mesh);\n        colliderType = this.rapier.ColliderDesc.cuboid(\n          dimensions.x / 2,\n          dimensions.y / 2,\n          dimensions.z / 2\n        );\n        this.world.createCollider(colliderType, this.rigidBody);\n        break;\n      case \"ball\":\n        const radius = this.computeBallDimensions(mesh);\n        colliderType = this.rapier.ColliderDesc.ball(radius);\n        this.world.createCollider(colliderType, this.rigidBody);\n        break;\n      case \"trimesh\":\n        const { scaledVertices, indices } = this.computeTrimeshDimensions(mesh);\n        colliderType = this.rapier.ColliderDesc.trimesh(\n          scaledVertices,\n          indices\n        );\n        this.world.createCollider(colliderType, this.rigidBody);\n\n        break;\n    }\n\n    // setting the rigid body position and rotation\n    const worldPosition = mesh.getWorldPosition(new THREE.Vector3());\n    const worldRotation = mesh.getWorldQuaternion(new THREE.Quaternion());\n    this.rigidBody.setTranslation(worldPosition);\n    this.rigidBody.setRotation(worldRotation);\n\n    this.meshMap.set(mesh, this.rigidBody);\n    return this.rigidBody;\n  }\n\n  /**\n   * Computes the dimensions of a cuboid collider for a given mesh\n   * @param {THREE.Mesh} mesh - The mesh to compute the dimensions for\n   * @returns {THREE.Vector3} The dimensions of the cuboid collider\n   */\n  computeCuboidDimensions(mesh) {\n    mesh.geometry.computeBoundingBox();\n    const size = mesh.geometry.boundingBox.getSize(new THREE.Vector3());\n    const worldScale = mesh.getWorldScale(new THREE.Vector3());\n    size.multiply(worldScale);\n    return size;\n  }\n\n  /**\n   * Computes the radius of a\n   /**\n\nComputes the radius of a sphere collider for a given mesh\n@param {THREE.Mesh} mesh - The mesh to compute the radius for\n@returns {number} The radius of the sphere collider\n*/\n  computeBallDimensions(mesh) {\n    mesh.geometry.computeBoundingSphere();\n    const radius = mesh.geometry.boundingSphere.radius;\n    const worldScale = mesh.getWorldScale(new THREE.Vector3());\n    const maxScale = Math.max(worldScale.x, worldScale.y, worldScale.z);\n    return radius * maxScale;\n  }\n\n  /**\n  Computes the scaled vertices and indices of a trimesh collider for a given mesh\n  @param {THREE.Mesh} mesh - The mesh to compute the scaled vertices and indices for\n  @returns {{scaledVertices: number[], indices: number[]}} The scaled vertices and indices of the trimesh collider\n  */\n  computeTrimeshDimensions(mesh) {\n    const vertices = mesh.geometry.attributes.position.array;\n    const indices = mesh.geometry.index.array;\n    const worldScale = mesh.getWorldScale(new THREE.Vector3());\n    const scaledVertices = vertices.map((vertex, index) => {\n      return vertex * worldScale.getComponent(index % 3);\n    });\n    return { scaledVertices, indices };\n  }\n  /**\n  \n  The loop function that updates the physics simulation and the mesh positions and rotations\n  */\n  loop() {\n    if (!this.rapierLoaded) return;\n    this.world.step();\n    this.meshMap.forEach((rigidBody, mesh) => {\n\n      // extracting the position and rotation from the rigid body\n      const position = new THREE.Vector3().copy(rigidBody.translation());\n      const rotation = new THREE.Quaternion().copy(rigidBody.rotation());\n\n      // transforming the position to the parent mesh's local space\n      position.applyMatrix4(\n        new THREE.Matrix4().copy(mesh.parent.matrixWorld).invert()\n      );\n\n      // transforming the rotation to the parent mesh's local space\n      const inverseParentMatrix = new THREE.Matrix4()\n        .extractRotation(mesh.parent.matrixWorld)\n        .invert();\n      const inverseParentRotation =\n        new THREE.Quaternion().setFromRotationMatrix(inverseParentMatrix);\n      rotation.premultiply(inverseParentRotation);\n\n      \n      mesh.position.copy(position);\n      mesh.quaternion.copy(rotation);\n    });\n  }\n}\n","import { createStore } from \"zustand/vanilla\";\n\nconst assetsToLoad = [\n  {\n    id:'avatar',\n    path:'/models/avatar.glb',\n    type: 'model' \n  },\n  {\n    id:'environment',\n    path:'/models/environment.glb',\n    type: 'model' \n  }\n];\n\nconst assetStore = createStore((set) => ({\n  assetsToLoad,\n  loadedAssets: {},\n  addLoadedAsset: (asset, id) =>\n    set((state) => ({\n      loadedAssets: {\n        ...state.loadedAssets,\n        [id]: asset,\n      },\n    })),\n}));\n\nexport default assetStore;\n","import * as THREE from \"three\";\nimport App from \"../App.js\";\nimport assetStore from \"../Utils/AssetStore.js\";\n\nexport default class Environment {\n  constructor() {\n    this.app = new App();\n    this.scene = this.app.scene;\n    this.physics = this.app.world.physics;\n    this.pane = this.app.gui.pane;\n\n    this.assetStore = assetStore.getState()\n    this.environment = this.assetStore.loadedAssets.environment\n\n    this.loadEnvironment();\n    this.addLights();\n  }\n\n  loadEnvironment() {\n    // load environment here\n    const environmentScene = this.environment.scene;\n    this.scene.add(environmentScene);\n\n    environmentScene.position.set(-4.8, 0, -7.4)\n    environmentScene.rotation.set(0, -.60, 0)\n    environmentScene.scale.setScalar(1.3)\n\n    const physicalObjects = ['trees',\n      'terrain',\n      'rocks',\n      'stairs',\n      'gates',\n      'floor',\n      'bushes'\n    ]\n\n    const shadowCasters = ['trees',\n      'terrain',\n      'rocks',\n      'stairs',\n      'gates',\n      'bushes'\n    ]\n\n    const shadowReceivers = ['floor',\n    'terrain'\n  ]\n\n  for (const child of environmentScene.children) {\n    child.traverse((obj) => {\n      if (obj.isMesh) {\n        obj.castShadow = shadowCasters.some((keyword) => child.name.includes(keyword))\n        obj.receiveShadow = shadowReceivers.some((keyword) => child.name.includes(keyword))\n        if (physicalObjects.some((keyword) => child.name.includes(keyword))) {\n          this.physics.add(obj, \"fixed\", \"cuboid\")\n        }\n      }\n    })\n  }\n}\n\n\n  addLights() {\n    const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);\n    this.scene.add(ambientLight);\n\n    this.directionalLight = new THREE.DirectionalLight(0xffffff, 0.5);\n    this.directionalLight.position.set(1, 1, 1);\n    this.directionalLight.castShadow = true;\n    this.directionalLight.shadow.camera.top = 30\n    this.directionalLight.shadow.camera.right = 30\n    this.directionalLight.shadow.camera.left = -30\n    this.directionalLight.shadow.camera.bottom = -30\n    this.directionalLight.shadow.bias = -0.002\n    this.directionalLight.shadow.normalBias = 0.072\n     this.scene.add(this.directionalLight);\n  }\n\n}\n","import * as THREE from \"three\";\nimport assetStore from \"../Utils/AssetStore.js\";\n\nimport App from \"../App.js\";\nexport default class Character {\n  constructor() {\n    this.app = new App();\n    this.scene = this.app.scene;\n    this.assetStore = assetStore.getState()\n    this.avatar = this.assetStore.loadedAssets.avatar\n    // console.log(this.avatar)\n\n    this.instantiateCharacter();\n  }\n\n  instantiateCharacter() {\n    // create character and add to scene\n    const geometry = new THREE.BoxGeometry(.6, 2, .6);\n    const material = new THREE.MeshStandardMaterial({\n      color: 0x00ff00,\n      wireframe: true,\n      visible: false,\n    });\n    this.instance = new THREE.Mesh(geometry, material);\n    this.instance.position.set(0, 4, 0);\n    this.scene.add(this.instance);\n\n    // add avatar to character\n    const avatar = this.avatar.scene\n    avatar.rotation.y = Math.PI\n    avatar.position.y = -1\n    this.instance.add(avatar)\n  }\n}\n","import * as THREE from \"three\";\nimport App from \"../App.js\";\nimport { inputStore } from \"../Utils/Store.js\";\n\nexport default class CharacterController {\n    constructor() {\n        this.app = new App();\n        this.scene = this.app.scene;\n        this.physics = this.app.world.physics;\n        this.character = this.app.world.character.instance;\n\n        inputStore.subscribe((state) => {\n            this.forward = state.forward;\n            this.backward = state.backward;\n            this.left = state.left;\n            this.right = state.right;\n        });\n\n        this.instantiateController();\n    }\n\n    instantiateController() {\n        this.rigidBodyType = this.physics.rapier.RigidBodyDesc.kinematicPositionBased();\n        this.rigidBody = this.physics.world.createRigidBody(this.rigidBodyType);\n\n        this.colliderType = this.physics.rapier.ColliderDesc.cuboid(.3, 1, .3);\n        this.collider = this.physics.world.createCollider(\n            this.colliderType,\n            this.rigidBody\n        );\n\n        const worldPosition = this.character.getWorldPosition(new THREE.Vector3());\n        const worldRotation = this.character.getWorldQuaternion(new THREE.Quaternion());\n        this.rigidBody.setTranslation(worldPosition);\n        this.rigidBody.setRotation(worldRotation);\n\n        this.characterController = this.physics.world.createCharacterController(0.01);\n        this.characterController.setApplyImpulsesToDynamicBodies(true);\n        this.characterController.enableAutostep(1, 0.1, false);\n        this.characterController.enableSnapToGround(1);\n    }\n\n    loop() {\n        const movement = new THREE.Vector3();\n        if (this.forward) movement.z -= 1;\n        if (this.backward) movement.z += 1;\n        if (this.left) movement.x -= 1;\n        if (this.right) movement.x += 1;\n\n        if (movement.length() !== 0) {\n            const angle = Math.atan2(movement.x, movement.z) + Math.PI;\n            const characterRotation = new THREE.Quaternion().setFromAxisAngle(\n                new THREE.Vector3(0, 1, 0),\n                angle\n            );\n            this.character.quaternion.slerp(characterRotation, 0.1);\n        }\n\n        movement.normalize().multiplyScalar(0.18);\n        movement.y = -1;\n\n        this.characterController.computeColliderMovement(this.collider, movement);\n        const newPosition = new THREE.Vector3()\n            .copy(this.rigidBody.translation())\n            .add(this.characterController.computedMovement());\n\n        this.rigidBody.setNextKinematicTranslation(newPosition);\n        this.character.position.lerp(this.rigidBody.translation(), 0.1);\n    }\n}","import * as THREE from 'three';\n\nimport App from '../App';\nimport { inputStore } from '../Utils/Store.js';\n\nexport default class AnimationController {\n    constructor() {\n        this.app = new App();\n        this.scene = this.app.scene;\n        this.avatar = this.app.world.character.avatar;\n\n        inputStore.subscribe((input) => this.onInput(input))\n\n        this.instantiatedAnimations()\n    }\n\n    instantiatedAnimations() {\n        const idle = this.avatar.animations[0]\n        this.mixer = new THREE.AnimationMixer(this.avatar.scene)\n\n\n        this.animations = new Map()\n        this.avatar.animations.forEach((clip) => {\n            this.animations.set(clip.name, this.mixer.clipAction(clip))\n        })\n\n        this.currentAction = this.animations.get('Idle')\n        this.currentAction.play()\n    }\n\n    playAnimation(name) {\n        if (this.currentAction === this.animations.get(name)) return\n        const action = this.animations.get(name)\n        action.reset()\n        action.play()\n        action.crossFadeFrom(this.currentAction, 0.2)\n\n        this.currentAction = action\n    }\n\n    onInput(input) {\n        if(\n            input.forward ||\n            input.backward ||\n            input.left ||\n            input.right\n        ) {\n            this.playAnimation('Run')\n        } else {\n            this.playAnimation('Idle')\n\n        }\n    }\n\n    loop(deltaTime) {\n        this.mixer.update(deltaTime)\n    } \n\n}","import * as THREE from \"three\";\nimport App from \"../App.js\";\n\nexport default class Portal {\n    constructor(position, portalData) {\n        this.app = new App();\n        this.scene = this.app.scene;\n        this.physics = this.app.world.physics;\n        \n        this.title = portalData.title;\n        this.description = portalData.description;\n        this.color = portalData.color;\n        this.position = position;\n        \n        this.createTriggerZone();\n        \n        this.playerInTrigger = false;\n        this.cooldown = false;\n    }\n\n    createTriggerZone() {\n        const colliderDesc = this.physics.rapier.ColliderDesc.cuboid(1.5, 2, 0.1)\n            .setTranslation(this.position.x, this.position.y, this.position.z)\n            .setSensor(true)\n            .setActiveEvents(this.physics.rapier.ActiveEvents.COLLISION_EVENTS);\n            \n        this.triggerCollider = this.physics.world.createCollider(colliderDesc);\n        this.triggerCollider.parent = this;\n    }\n\n    update() {\n        if (this.app.world.characterController && !this.cooldown) {\n            const playerPos = this.app.world.characterController.rigidBody.translation();\n            const portalPos = this.position;\n            \n            const distance = Math.sqrt(\n                Math.pow(portalPos.x - playerPos.x, 2) + \n                Math.pow(portalPos.z - playerPos.z, 2)\n            );\n\n            if (distance < 1.2 && !this.playerInTrigger) {\n                this.handlePlayerEnter(this.app.modalManager);\n            } else if (distance >= 1.8 && this.playerInTrigger) {\n                this.handlePlayerExit();\n            }\n        }\n    }\n\n    handlePlayerEnter(modalManager) {\n        if (!this.cooldown && !this.playerInTrigger) {\n            this.playerInTrigger = true;\n            modalManager?.openModal(this.title, this.description);\n            \n            this.cooldown = true;\n            setTimeout(() => {\n                this.cooldown = false;\n            }, 1000);\n        }\n    }\n\n    handlePlayerExit() {\n        this.playerInTrigger = false;\n    }\n\n    dispose() {\n        if (this.triggerCollider) {\n            this.physics.world.removeCollider(this.triggerCollider);\n        }\n    }\n}","import * as THREE from \"three\";\n\nimport App from \"../App.js\";\nimport Physics from \"./Physics.js\";\nimport Environment from \"./Environment.js\";\nimport Character from \"./Character.js\";\nimport CharacterController from \"./CharacterController.js\";\nimport AnimationController from \"./AnimationController.js\";\nimport Portal from \"./Portal.js\";\n\nimport { appStateStore } from \"../Utils/Store.js\";\n\nexport default class World {\n    constructor() {\n        this.app = new App();\n        this.scene = this.app.scene;\n        \n        this.physics = new Physics();\n\n        this.portalData = [\n            {\n                position: new THREE.Vector3(-1.52, 3.04 - 0.61, -12.12 - 0.33),\n                data: {\n                    title: \"Welcome to My World\",\n                    description: \n                        \"<div class='intro'>\" +\n                        \"<h2>Hi, I'm William Curry</h2>\" +\n                        \"<p>I'm a full-stack developer who transforms complex challenges into elegant solutions. \" +\n                        \"With a foundation in modern JavaScript and React, I blend technical expertise with \" +\n                        \"entrepreneurial insight to create impactful applications.</p>\" +\n                        \"<p>What sets me apart is my innovative approach to development – I leverage AI tools \" +\n                        \"to accelerate development while maintaining high code quality. This portfolio itself \" +\n                        \"showcases my passion for interactive experiences, built with Three.js and modern web technologies.</p>\" +\n                        \"<p>My journey from EMT to software engineer has given me a unique perspective on \" +\n                        \"problem-solving and crisis management, skills that prove invaluable in today's fast-paced \" +\n                        \"development environment.</p>\" +\n                        \"<p>Explore my work history and projects through the portals above!</p>\" +\n                        \"</div>\",\n                    color: 0x00ff00\n                }\n            },\n            {\n                position: new THREE.Vector3(-5.65, 15.00 - 10.30, -22.01 - 4.67),\n                data: {\n                    title: \"Professional Journey\",\n                    description: \n                        \"<div class='work-history'>\" +\n                        \"<div class='work-entry'>\" +\n                        \"<h3>Web Developer at Tree Three</h3>\" +\n                        \"<p class='company'>Mar 2023 - Sep 2023</p>\" +\n                        \"<p>Founded and managed an innovative print-on-demand e-commerce platform, combining \" +\n                        \"technical expertise with entrepreneurial vision. Integrated AI services for unique product \" +\n                        \"designs and implemented digital marketing strategies for growth.</p>\" +\n                        \"</div>\" +\n                        \"<div class='work-entry'>\" +\n                        \"<h3>Software Engineer at Guaranteed Rate</h3>\" +\n                        \"<p class='company'>Jan 2022 - Apr 2022</p>\" +\n                        \"<p>Developed frontend solutions using ReactJS and GraphQL, notably contributing to a credit \" +\n                        \"score calculation tool. Enhanced loan processing efficiency through real-time monitoring \" +\n                        \"features and intuitive interfaces.</p>\" +\n                        \"</div>\" +\n                        \"<div class='work-entry'>\" +\n                        \"<h3>Software Developer at Virtual Service Operations</h3>\" +\n                        \"<p class='company'>Sep 2020 - Feb 2021</p>\" +\n                        \"<p>Contributed to Kaiser Permanente's Operations Manager software, working with a \" +\n                        \"microservices architecture. Leveraged TypeScript, Angular, and GraphQL to enhance hospital \" +\n                        \"server monitoring systems.</p>\" +\n                        \"</div>\" +\n                        \"</div>\",\n                    color: 0x0000ff\n                }\n            },\n            {\n                position: new THREE.Vector3(8.48, 12.17 - 8.72, -21.25 - 0.54),\n                data: {\n                    title: \"Featured Projects\",\n                    description: \n                        \"<div class='projects-grid'>\" +\n                        \"<div class='project-card'>\" +\n                        \"<h3>3D Interactive Portfolio</h3>\" +\n                        \"<p>A creative approach to showcasing my work through an immersive 3D environment. \" +\n                        \"Built with Three.js and Rapier physics, featuring dynamic character movement and \" +\n                        \"interactive portals.</p>\" +\n                        \"<div class='tech-stack'>Three.js • Rapier Physics • JavaScript</div>\" +\n                        \"</div>\" +\n                        \"<div class='project-card'>\" +\n                        \"<h3>E-commerce Platform</h3>\" +\n                        \"<p>Full-stack print-on-demand platform integrating AI for design generation. \" +\n                        \"Implemented robust ordering system and analytics dashboard.</p>\" +\n                        \"<div class='tech-stack'>JavaScript • AI Integration • Full-Stack Development</div>\" +\n                        \"</div>\" +\n                        \"<div class='project-card'>\" +\n                        \"<h3>Credit Score Calculator</h3>\" +\n                        \"<p>Developed at Guaranteed Rate, this tool streamlined loan officer workflows by \" +\n                        \"providing real-time credit assessment capabilities.</p>\" +\n                        \"<div class='tech-stack'>React • GraphQL • Tailwind CSS</div>\" +\n                        \"</div>\" +\n                        \"</div>\",\n                    color: 0xff0000\n                }\n            }\n        ];\n\n        const unsub = appStateStore.subscribe((state) => {\n            if (state.physicsReady && state.assetsReady) {\n                this.environment = new Environment();\n                this.character = new Character();\n                this.characterController = new CharacterController();\n                this.animationController = new AnimationController();\n                \n                if (this.physics.rapierLoaded) {\n                    this.createPortals();\n                }\n                \n                unsub();\n            }\n        });\n\n        this.loop();\n    }\n\n    createPortals() {\n        try {\n            this.portals = [];\n            this.portalData.forEach(({ position, data }) => {\n                try {\n                    const portal = new Portal(position, data);\n                    this.portals.push(portal);\n                } catch (error) {\n                    console.error('Error creating portal:', error);\n                }\n            });\n        } catch (error) {\n            console.error('Error in createPortals:', error);\n        }\n    }\n\n    loop(deltaTime, elapsedTime) {\n        if (this.physics) this.physics.loop();\n        if (this.characterController) this.characterController.loop();\n        if (this.animationController) this.animationController.loop(deltaTime);\n        \n        if (this.portals && this.portals.length > 0) {\n            this.portals.forEach(portal => portal.update());\n        }\n    }\n}","import { sizesStore } from \"./Store.js\";\n\nexport default class Resize {\n    constructor() {\n\n        const { setState } = sizesStore\n\n        window.addEventListener(\"resize\", () => {\n            setState({\n                width: window.innerWidth,\n                height: window.innerHeight,\n                pixelRatio: Math.min(window.devicePixelRatio, 2),\n            })\n          \n          });\n\n    }\n}","import {\n\tBufferAttribute,\n\tBufferGeometry,\n\tFloat32BufferAttribute,\n\tInstancedBufferAttribute,\n\tInterleavedBuffer,\n\tInterleavedBufferAttribute,\n\tTriangleFanDrawMode,\n\tTriangleStripDrawMode,\n\tTrianglesDrawMode,\n\tVector3,\n} from 'three';\n\nfunction computeTangents() {\n\n\tthrow new Error( 'BufferGeometryUtils: computeTangents renamed to computeMikkTSpaceTangents.' );\n\n}\n\nfunction computeMikkTSpaceTangents( geometry, MikkTSpace, negateSign = true ) {\n\n\tif ( ! MikkTSpace || ! MikkTSpace.isReady ) {\n\n\t\tthrow new Error( 'BufferGeometryUtils: Initialized MikkTSpace library required.' );\n\n\t}\n\n\tif ( ! geometry.hasAttribute( 'position' ) || ! geometry.hasAttribute( 'normal' ) || ! geometry.hasAttribute( 'uv' ) ) {\n\n\t\tthrow new Error( 'BufferGeometryUtils: Tangents require \"position\", \"normal\", and \"uv\" attributes.' );\n\n\t}\n\n\tfunction getAttributeArray( attribute ) {\n\n\t\tif ( attribute.normalized || attribute.isInterleavedBufferAttribute ) {\n\n\t\t\tconst dstArray = new Float32Array( attribute.getCount() * attribute.itemSize );\n\n\t\t\tfor ( let i = 0, j = 0; i < attribute.getCount(); i ++ ) {\n\n\t\t\t\tdstArray[ j ++ ] = attribute.getX( i );\n\t\t\t\tdstArray[ j ++ ] = attribute.getY( i );\n\n\t\t\t\tif ( attribute.itemSize > 2 ) {\n\n\t\t\t\t\tdstArray[ j ++ ] = attribute.getZ( i );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn dstArray;\n\n\t\t}\n\n\t\tif ( attribute.array instanceof Float32Array ) {\n\n\t\t\treturn attribute.array;\n\n\t\t}\n\n\t\treturn new Float32Array( attribute.array );\n\n\t}\n\n\t// MikkTSpace algorithm requires non-indexed input.\n\n\tconst _geometry = geometry.index ? geometry.toNonIndexed() : geometry;\n\n\t// Compute vertex tangents.\n\n\tconst tangents = MikkTSpace.generateTangents(\n\n\t\tgetAttributeArray( _geometry.attributes.position ),\n\t\tgetAttributeArray( _geometry.attributes.normal ),\n\t\tgetAttributeArray( _geometry.attributes.uv )\n\n\t);\n\n\t// Texture coordinate convention of glTF differs from the apparent\n\t// default of the MikkTSpace library; .w component must be flipped.\n\n\tif ( negateSign ) {\n\n\t\tfor ( let i = 3; i < tangents.length; i += 4 ) {\n\n\t\t\ttangents[ i ] *= - 1;\n\n\t\t}\n\n\t}\n\n\t//\n\n\t_geometry.setAttribute( 'tangent', new BufferAttribute( tangents, 4 ) );\n\n\tif ( geometry !== _geometry ) {\n\n\t\tgeometry.copy( _geometry );\n\n\t}\n\n\treturn geometry;\n\n}\n\n/**\n * @param  {Array<BufferGeometry>} geometries\n * @param  {Boolean} useGroups\n * @return {BufferGeometry}\n */\nfunction mergeBufferGeometries( geometries, useGroups = false ) {\n\n\tconst isIndexed = geometries[ 0 ].index !== null;\n\n\tconst attributesUsed = new Set( Object.keys( geometries[ 0 ].attributes ) );\n\tconst morphAttributesUsed = new Set( Object.keys( geometries[ 0 ].morphAttributes ) );\n\n\tconst attributes = {};\n\tconst morphAttributes = {};\n\n\tconst morphTargetsRelative = geometries[ 0 ].morphTargetsRelative;\n\n\tconst mergedGeometry = new BufferGeometry();\n\n\tlet offset = 0;\n\n\tfor ( let i = 0; i < geometries.length; ++ i ) {\n\n\t\tconst geometry = geometries[ i ];\n\t\tlet attributesCount = 0;\n\n\t\t// ensure that all geometries are indexed, or none\n\n\t\tif ( isIndexed !== ( geometry.index !== null ) ) {\n\n\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index ' + i + '. All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them.' );\n\t\t\treturn null;\n\n\t\t}\n\n\t\t// gather attributes, exit early if they're different\n\n\t\tfor ( const name in geometry.attributes ) {\n\n\t\t\tif ( ! attributesUsed.has( name ) ) {\n\n\t\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index ' + i + '. All geometries must have compatible attributes; make sure \"' + name + '\" attribute exists among all geometries, or in none of them.' );\n\t\t\t\treturn null;\n\n\t\t\t}\n\n\t\t\tif ( attributes[ name ] === undefined ) attributes[ name ] = [];\n\n\t\t\tattributes[ name ].push( geometry.attributes[ name ] );\n\n\t\t\tattributesCount ++;\n\n\t\t}\n\n\t\t// ensure geometries have the same number of attributes\n\n\t\tif ( attributesCount !== attributesUsed.size ) {\n\n\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index ' + i + '. Make sure all geometries have the same number of attributes.' );\n\t\t\treturn null;\n\n\t\t}\n\n\t\t// gather morph attributes, exit early if they're different\n\n\t\tif ( morphTargetsRelative !== geometry.morphTargetsRelative ) {\n\n\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index ' + i + '. .morphTargetsRelative must be consistent throughout all geometries.' );\n\t\t\treturn null;\n\n\t\t}\n\n\t\tfor ( const name in geometry.morphAttributes ) {\n\n\t\t\tif ( ! morphAttributesUsed.has( name ) ) {\n\n\t\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index ' + i + '.  .morphAttributes must be consistent throughout all geometries.' );\n\t\t\t\treturn null;\n\n\t\t\t}\n\n\t\t\tif ( morphAttributes[ name ] === undefined ) morphAttributes[ name ] = [];\n\n\t\t\tmorphAttributes[ name ].push( geometry.morphAttributes[ name ] );\n\n\t\t}\n\n\t\tif ( useGroups ) {\n\n\t\t\tlet count;\n\n\t\t\tif ( isIndexed ) {\n\n\t\t\t\tcount = geometry.index.count;\n\n\t\t\t} else if ( geometry.attributes.position !== undefined ) {\n\n\t\t\t\tcount = geometry.attributes.position.count;\n\n\t\t\t} else {\n\n\t\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index ' + i + '. The geometry must have either an index or a position attribute' );\n\t\t\t\treturn null;\n\n\t\t\t}\n\n\t\t\tmergedGeometry.addGroup( offset, count, i );\n\n\t\t\toffset += count;\n\n\t\t}\n\n\t}\n\n\t// merge indices\n\n\tif ( isIndexed ) {\n\n\t\tlet indexOffset = 0;\n\t\tconst mergedIndex = [];\n\n\t\tfor ( let i = 0; i < geometries.length; ++ i ) {\n\n\t\t\tconst index = geometries[ i ].index;\n\n\t\t\tfor ( let j = 0; j < index.count; ++ j ) {\n\n\t\t\t\tmergedIndex.push( index.getX( j ) + indexOffset );\n\n\t\t\t}\n\n\t\t\tindexOffset += geometries[ i ].attributes.position.count;\n\n\t\t}\n\n\t\tmergedGeometry.setIndex( mergedIndex );\n\n\t}\n\n\t// merge attributes\n\n\tfor ( const name in attributes ) {\n\n\t\tconst mergedAttribute = mergeBufferAttributes( attributes[ name ] );\n\n\t\tif ( ! mergedAttribute ) {\n\n\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the ' + name + ' attribute.' );\n\t\t\treturn null;\n\n\t\t}\n\n\t\tmergedGeometry.setAttribute( name, mergedAttribute );\n\n\t}\n\n\t// merge morph attributes\n\n\tfor ( const name in morphAttributes ) {\n\n\t\tconst numMorphTargets = morphAttributes[ name ][ 0 ].length;\n\n\t\tif ( numMorphTargets === 0 ) break;\n\n\t\tmergedGeometry.morphAttributes = mergedGeometry.morphAttributes || {};\n\t\tmergedGeometry.morphAttributes[ name ] = [];\n\n\t\tfor ( let i = 0; i < numMorphTargets; ++ i ) {\n\n\t\t\tconst morphAttributesToMerge = [];\n\n\t\t\tfor ( let j = 0; j < morphAttributes[ name ].length; ++ j ) {\n\n\t\t\t\tmorphAttributesToMerge.push( morphAttributes[ name ][ j ][ i ] );\n\n\t\t\t}\n\n\t\t\tconst mergedMorphAttribute = mergeBufferAttributes( morphAttributesToMerge );\n\n\t\t\tif ( ! mergedMorphAttribute ) {\n\n\t\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the ' + name + ' morphAttribute.' );\n\t\t\t\treturn null;\n\n\t\t\t}\n\n\t\t\tmergedGeometry.morphAttributes[ name ].push( mergedMorphAttribute );\n\n\t\t}\n\n\t}\n\n\treturn mergedGeometry;\n\n}\n\n/**\n * @param {Array<BufferAttribute>} attributes\n * @return {BufferAttribute}\n */\nfunction mergeBufferAttributes( attributes ) {\n\n\tlet TypedArray;\n\tlet itemSize;\n\tlet normalized;\n\tlet arrayLength = 0;\n\n\tfor ( let i = 0; i < attributes.length; ++ i ) {\n\n\t\tconst attribute = attributes[ i ];\n\n\t\tif ( attribute.isInterleavedBufferAttribute ) {\n\n\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported.' );\n\t\t\treturn null;\n\n\t\t}\n\n\t\tif ( TypedArray === undefined ) TypedArray = attribute.array.constructor;\n\t\tif ( TypedArray !== attribute.array.constructor ) {\n\n\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes.' );\n\t\t\treturn null;\n\n\t\t}\n\n\t\tif ( itemSize === undefined ) itemSize = attribute.itemSize;\n\t\tif ( itemSize !== attribute.itemSize ) {\n\n\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes.' );\n\t\t\treturn null;\n\n\t\t}\n\n\t\tif ( normalized === undefined ) normalized = attribute.normalized;\n\t\tif ( normalized !== attribute.normalized ) {\n\n\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes.' );\n\t\t\treturn null;\n\n\t\t}\n\n\t\tarrayLength += attribute.array.length;\n\n\t}\n\n\tconst array = new TypedArray( arrayLength );\n\tlet offset = 0;\n\n\tfor ( let i = 0; i < attributes.length; ++ i ) {\n\n\t\tarray.set( attributes[ i ].array, offset );\n\n\t\toffset += attributes[ i ].array.length;\n\n\t}\n\n\treturn new BufferAttribute( array, itemSize, normalized );\n\n}\n\n/**\n * @param {BufferAttribute}\n * @return {BufferAttribute}\n */\nexport function deepCloneAttribute( attribute ) {\n\n\tif ( attribute.isInstancedInterleavedBufferAttribute || attribute.isInterleavedBufferAttribute ) {\n\n\t\treturn deinterleaveAttribute( attribute );\n\n\t}\n\n\tif ( attribute.isInstancedBufferAttribute ) {\n\n\t\treturn new InstancedBufferAttribute().copy( attribute );\n\n\t}\n\n\treturn new BufferAttribute().copy( attribute );\n\n}\n\n/**\n * @param {Array<BufferAttribute>} attributes\n * @return {Array<InterleavedBufferAttribute>}\n */\nfunction interleaveAttributes( attributes ) {\n\n\t// Interleaves the provided attributes into an InterleavedBuffer and returns\n\t// a set of InterleavedBufferAttributes for each attribute\n\tlet TypedArray;\n\tlet arrayLength = 0;\n\tlet stride = 0;\n\n\t// calculate the length and type of the interleavedBuffer\n\tfor ( let i = 0, l = attributes.length; i < l; ++ i ) {\n\n\t\tconst attribute = attributes[ i ];\n\n\t\tif ( TypedArray === undefined ) TypedArray = attribute.array.constructor;\n\t\tif ( TypedArray !== attribute.array.constructor ) {\n\n\t\t\tconsole.error( 'AttributeBuffers of different types cannot be interleaved' );\n\t\t\treturn null;\n\n\t\t}\n\n\t\tarrayLength += attribute.array.length;\n\t\tstride += attribute.itemSize;\n\n\t}\n\n\t// Create the set of buffer attributes\n\tconst interleavedBuffer = new InterleavedBuffer( new TypedArray( arrayLength ), stride );\n\tlet offset = 0;\n\tconst res = [];\n\tconst getters = [ 'getX', 'getY', 'getZ', 'getW' ];\n\tconst setters = [ 'setX', 'setY', 'setZ', 'setW' ];\n\n\tfor ( let j = 0, l = attributes.length; j < l; j ++ ) {\n\n\t\tconst attribute = attributes[ j ];\n\t\tconst itemSize = attribute.itemSize;\n\t\tconst count = attribute.count;\n\t\tconst iba = new InterleavedBufferAttribute( interleavedBuffer, itemSize, offset, attribute.normalized );\n\t\tres.push( iba );\n\n\t\toffset += itemSize;\n\n\t\t// Move the data for each attribute into the new interleavedBuffer\n\t\t// at the appropriate offset\n\t\tfor ( let c = 0; c < count; c ++ ) {\n\n\t\t\tfor ( let k = 0; k < itemSize; k ++ ) {\n\n\t\t\t\tiba[ setters[ k ] ]( c, attribute[ getters[ k ] ]( c ) );\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\treturn res;\n\n}\n\n// returns a new, non-interleaved version of the provided attribute\nexport function deinterleaveAttribute( attribute ) {\n\n\tconst cons = attribute.data.array.constructor;\n\tconst count = attribute.count;\n\tconst itemSize = attribute.itemSize;\n\tconst normalized = attribute.normalized;\n\n\tconst array = new cons( count * itemSize );\n\tlet newAttribute;\n\tif ( attribute.isInstancedInterleavedBufferAttribute ) {\n\n\t\tnewAttribute = new InstancedBufferAttribute( array, itemSize, normalized, attribute.meshPerAttribute );\n\n\t} else {\n\n\t\tnewAttribute = new BufferAttribute( array, itemSize, normalized );\n\n\t}\n\n\tfor ( let i = 0; i < count; i ++ ) {\n\n\t\tnewAttribute.setX( i, attribute.getX( i ) );\n\n\t\tif ( itemSize >= 2 ) {\n\n\t\t\tnewAttribute.setY( i, attribute.getY( i ) );\n\n\t\t}\n\n\t\tif ( itemSize >= 3 ) {\n\n\t\t\tnewAttribute.setZ( i, attribute.getZ( i ) );\n\n\t\t}\n\n\t\tif ( itemSize >= 4 ) {\n\n\t\t\tnewAttribute.setW( i, attribute.getW( i ) );\n\n\t\t}\n\n\t}\n\n\treturn newAttribute;\n\n}\n\n// deinterleaves all attributes on the geometry\nexport function deinterleaveGeometry( geometry ) {\n\n\tconst attributes = geometry.attributes;\n\tconst morphTargets = geometry.morphTargets;\n\tconst attrMap = new Map();\n\n\tfor ( const key in attributes ) {\n\n\t\tconst attr = attributes[ key ];\n\t\tif ( attr.isInterleavedBufferAttribute ) {\n\n\t\t\tif ( ! attrMap.has( attr ) ) {\n\n\t\t\t\tattrMap.set( attr, deinterleaveAttribute( attr ) );\n\n\t\t\t}\n\n\t\t\tattributes[ key ] = attrMap.get( attr );\n\n\t\t}\n\n\t}\n\n\tfor ( const key in morphTargets ) {\n\n\t\tconst attr = morphTargets[ key ];\n\t\tif ( attr.isInterleavedBufferAttribute ) {\n\n\t\t\tif ( ! attrMap.has( attr ) ) {\n\n\t\t\t\tattrMap.set( attr, deinterleaveAttribute( attr ) );\n\n\t\t\t}\n\n\t\t\tmorphTargets[ key ] = attrMap.get( attr );\n\n\t\t}\n\n\t}\n\n}\n\n/**\n * @param {Array<BufferGeometry>} geometry\n * @return {number}\n */\nfunction estimateBytesUsed( geometry ) {\n\n\t// Return the estimated memory used by this geometry in bytes\n\t// Calculate using itemSize, count, and BYTES_PER_ELEMENT to account\n\t// for InterleavedBufferAttributes.\n\tlet mem = 0;\n\tfor ( const name in geometry.attributes ) {\n\n\t\tconst attr = geometry.getAttribute( name );\n\t\tmem += attr.count * attr.itemSize * attr.array.BYTES_PER_ELEMENT;\n\n\t}\n\n\tconst indices = geometry.getIndex();\n\tmem += indices ? indices.count * indices.itemSize * indices.array.BYTES_PER_ELEMENT : 0;\n\treturn mem;\n\n}\n\n/**\n * @param {BufferGeometry} geometry\n * @param {number} tolerance\n * @return {BufferGeometry}\n */\nfunction mergeVertices( geometry, tolerance = 1e-4 ) {\n\n\ttolerance = Math.max( tolerance, Number.EPSILON );\n\n\t// Generate an index buffer if the geometry doesn't have one, or optimize it\n\t// if it's already available.\n\tconst hashToIndex = {};\n\tconst indices = geometry.getIndex();\n\tconst positions = geometry.getAttribute( 'position' );\n\tconst vertexCount = indices ? indices.count : positions.count;\n\n\t// next value for triangle indices\n\tlet nextIndex = 0;\n\n\t// attributes and new attribute arrays\n\tconst attributeNames = Object.keys( geometry.attributes );\n\tconst tmpAttributes = {};\n\tconst tmpMorphAttributes = {};\n\tconst newIndices = [];\n\tconst getters = [ 'getX', 'getY', 'getZ', 'getW' ];\n\tconst setters = [ 'setX', 'setY', 'setZ', 'setW' ];\n\n\t// Initialize the arrays, allocating space conservatively. Extra\n\t// space will be trimmed in the last step.\n\tfor ( let i = 0, l = attributeNames.length; i < l; i ++ ) {\n\n\t\tconst name = attributeNames[ i ];\n\t\tconst attr = geometry.attributes[ name ];\n\n\t\ttmpAttributes[ name ] = new BufferAttribute(\n\t\t\tnew attr.array.constructor( attr.count * attr.itemSize ),\n\t\t\tattr.itemSize,\n\t\t\tattr.normalized\n\t\t);\n\n\t\tconst morphAttr = geometry.morphAttributes[ name ];\n\t\tif ( morphAttr ) {\n\n\t\t\ttmpMorphAttributes[ name ] = new BufferAttribute(\n\t\t\t\tnew morphAttr.array.constructor( morphAttr.count * morphAttr.itemSize ),\n\t\t\t\tmorphAttr.itemSize,\n\t\t\t\tmorphAttr.normalized\n\t\t\t);\n\n\t\t}\n\n\t}\n\n\t// convert the error tolerance to an amount of decimal places to truncate to\n\tconst decimalShift = Math.log10( 1 / tolerance );\n\tconst shiftMultiplier = Math.pow( 10, decimalShift );\n\tfor ( let i = 0; i < vertexCount; i ++ ) {\n\n\t\tconst index = indices ? indices.getX( i ) : i;\n\n\t\t// Generate a hash for the vertex attributes at the current index 'i'\n\t\tlet hash = '';\n\t\tfor ( let j = 0, l = attributeNames.length; j < l; j ++ ) {\n\n\t\t\tconst name = attributeNames[ j ];\n\t\t\tconst attribute = geometry.getAttribute( name );\n\t\t\tconst itemSize = attribute.itemSize;\n\n\t\t\tfor ( let k = 0; k < itemSize; k ++ ) {\n\n\t\t\t\t// double tilde truncates the decimal value\n\t\t\t\thash += `${ ~ ~ ( attribute[ getters[ k ] ]( index ) * shiftMultiplier ) },`;\n\n\t\t\t}\n\n\t\t}\n\n\t\t// Add another reference to the vertex if it's already\n\t\t// used by another index\n\t\tif ( hash in hashToIndex ) {\n\n\t\t\tnewIndices.push( hashToIndex[ hash ] );\n\n\t\t} else {\n\n\t\t\t// copy data to the new index in the temporary attributes\n\t\t\tfor ( let j = 0, l = attributeNames.length; j < l; j ++ ) {\n\n\t\t\t\tconst name = attributeNames[ j ];\n\t\t\t\tconst attribute = geometry.getAttribute( name );\n\t\t\t\tconst morphAttr = geometry.morphAttributes[ name ];\n\t\t\t\tconst itemSize = attribute.itemSize;\n\t\t\t\tconst newarray = tmpAttributes[ name ];\n\t\t\t\tconst newMorphArrays = tmpMorphAttributes[ name ];\n\n\t\t\t\tfor ( let k = 0; k < itemSize; k ++ ) {\n\n\t\t\t\t\tconst getterFunc = getters[ k ];\n\t\t\t\t\tconst setterFunc = setters[ k ];\n\t\t\t\t\tnewarray[ setterFunc ]( nextIndex, attribute[ getterFunc ]( index ) );\n\n\t\t\t\t\tif ( morphAttr ) {\n\n\t\t\t\t\t\tfor ( let m = 0, ml = morphAttr.length; m < ml; m ++ ) {\n\n\t\t\t\t\t\t\tnewMorphArrays[ m ][ setterFunc ]( nextIndex, morphAttr[ m ][ getterFunc ]( index ) );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\thashToIndex[ hash ] = nextIndex;\n\t\t\tnewIndices.push( nextIndex );\n\t\t\tnextIndex ++;\n\n\t\t}\n\n\t}\n\n\t// generate result BufferGeometry\n\tconst result = geometry.clone();\n\tfor ( const name in geometry.attributes ) {\n\n\t\tconst tmpAttribute = tmpAttributes[ name ];\n\n\t\tresult.setAttribute( name, new BufferAttribute(\n\t\t\ttmpAttribute.array.slice( 0, nextIndex * tmpAttribute.itemSize ),\n\t\t\ttmpAttribute.itemSize,\n\t\t\ttmpAttribute.normalized,\n\t\t) );\n\n\t\tif ( ! ( name in tmpMorphAttributes ) ) continue;\n\n\t\tfor ( let j = 0; j < tmpMorphAttributes[ name ].length; j ++ ) {\n\n\t\t\tconst tmpMorphAttribute = tmpMorphAttributes[ name ][ j ];\n\n\t\t\tresult.morphAttributes[ name ][ j ] = new BufferAttribute(\n\t\t\t\ttmpMorphAttribute.array.slice( 0, nextIndex * tmpMorphAttribute.itemSize ),\n\t\t\t\ttmpMorphAttribute.itemSize,\n\t\t\t\ttmpMorphAttribute.normalized,\n\t\t\t);\n\n\t\t}\n\n\t}\n\n\t// indices\n\n\tresult.setIndex( newIndices );\n\n\treturn result;\n\n}\n\n/**\n * @param {BufferGeometry} geometry\n * @param {number} drawMode\n * @return {BufferGeometry}\n */\nfunction toTrianglesDrawMode( geometry, drawMode ) {\n\n\tif ( drawMode === TrianglesDrawMode ) {\n\n\t\tconsole.warn( 'THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles.' );\n\t\treturn geometry;\n\n\t}\n\n\tif ( drawMode === TriangleFanDrawMode || drawMode === TriangleStripDrawMode ) {\n\n\t\tlet index = geometry.getIndex();\n\n\t\t// generate index if not present\n\n\t\tif ( index === null ) {\n\n\t\t\tconst indices = [];\n\n\t\t\tconst position = geometry.getAttribute( 'position' );\n\n\t\t\tif ( position !== undefined ) {\n\n\t\t\t\tfor ( let i = 0; i < position.count; i ++ ) {\n\n\t\t\t\t\tindices.push( i );\n\n\t\t\t\t}\n\n\t\t\t\tgeometry.setIndex( indices );\n\t\t\t\tindex = geometry.getIndex();\n\n\t\t\t} else {\n\n\t\t\t\tconsole.error( 'THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible.' );\n\t\t\t\treturn geometry;\n\n\t\t\t}\n\n\t\t}\n\n\t\t//\n\n\t\tconst numberOfTriangles = index.count - 2;\n\t\tconst newIndices = [];\n\n\t\tif ( drawMode === TriangleFanDrawMode ) {\n\n\t\t\t// gl.TRIANGLE_FAN\n\n\t\t\tfor ( let i = 1; i <= numberOfTriangles; i ++ ) {\n\n\t\t\t\tnewIndices.push( index.getX( 0 ) );\n\t\t\t\tnewIndices.push( index.getX( i ) );\n\t\t\t\tnewIndices.push( index.getX( i + 1 ) );\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\t// gl.TRIANGLE_STRIP\n\n\t\t\tfor ( let i = 0; i < numberOfTriangles; i ++ ) {\n\n\t\t\t\tif ( i % 2 === 0 ) {\n\n\t\t\t\t\tnewIndices.push( index.getX( i ) );\n\t\t\t\t\tnewIndices.push( index.getX( i + 1 ) );\n\t\t\t\t\tnewIndices.push( index.getX( i + 2 ) );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tnewIndices.push( index.getX( i + 2 ) );\n\t\t\t\t\tnewIndices.push( index.getX( i + 1 ) );\n\t\t\t\t\tnewIndices.push( index.getX( i ) );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( ( newIndices.length / 3 ) !== numberOfTriangles ) {\n\n\t\t\tconsole.error( 'THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.' );\n\n\t\t}\n\n\t\t// build final geometry\n\n\t\tconst newGeometry = geometry.clone();\n\t\tnewGeometry.setIndex( newIndices );\n\t\tnewGeometry.clearGroups();\n\n\t\treturn newGeometry;\n\n\t} else {\n\n\t\tconsole.error( 'THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:', drawMode );\n\t\treturn geometry;\n\n\t}\n\n}\n\n/**\n * Calculates the morphed attributes of a morphed/skinned BufferGeometry.\n * Helpful for Raytracing or Decals.\n * @param {Mesh | Line | Points} object An instance of Mesh, Line or Points.\n * @return {Object} An Object with original position/normal attributes and morphed ones.\n */\nfunction computeMorphedAttributes( object ) {\n\n\tif ( object.geometry.isBufferGeometry !== true ) {\n\n\t\tconsole.error( 'THREE.BufferGeometryUtils: Geometry is not of type BufferGeometry.' );\n\t\treturn null;\n\n\t}\n\n\tconst _vA = new Vector3();\n\tconst _vB = new Vector3();\n\tconst _vC = new Vector3();\n\n\tconst _tempA = new Vector3();\n\tconst _tempB = new Vector3();\n\tconst _tempC = new Vector3();\n\n\tconst _morphA = new Vector3();\n\tconst _morphB = new Vector3();\n\tconst _morphC = new Vector3();\n\n\tfunction _calculateMorphedAttributeData(\n\t\tobject,\n\t\tattribute,\n\t\tmorphAttribute,\n\t\tmorphTargetsRelative,\n\t\ta,\n\t\tb,\n\t\tc,\n\t\tmodifiedAttributeArray\n\t) {\n\n\t\t_vA.fromBufferAttribute( attribute, a );\n\t\t_vB.fromBufferAttribute( attribute, b );\n\t\t_vC.fromBufferAttribute( attribute, c );\n\n\t\tconst morphInfluences = object.morphTargetInfluences;\n\n\t\tif ( morphAttribute && morphInfluences ) {\n\n\t\t\t_morphA.set( 0, 0, 0 );\n\t\t\t_morphB.set( 0, 0, 0 );\n\t\t\t_morphC.set( 0, 0, 0 );\n\n\t\t\tfor ( let i = 0, il = morphAttribute.length; i < il; i ++ ) {\n\n\t\t\t\tconst influence = morphInfluences[ i ];\n\t\t\t\tconst morph = morphAttribute[ i ];\n\n\t\t\t\tif ( influence === 0 ) continue;\n\n\t\t\t\t_tempA.fromBufferAttribute( morph, a );\n\t\t\t\t_tempB.fromBufferAttribute( morph, b );\n\t\t\t\t_tempC.fromBufferAttribute( morph, c );\n\n\t\t\t\tif ( morphTargetsRelative ) {\n\n\t\t\t\t\t_morphA.addScaledVector( _tempA, influence );\n\t\t\t\t\t_morphB.addScaledVector( _tempB, influence );\n\t\t\t\t\t_morphC.addScaledVector( _tempC, influence );\n\n\t\t\t\t} else {\n\n\t\t\t\t\t_morphA.addScaledVector( _tempA.sub( _vA ), influence );\n\t\t\t\t\t_morphB.addScaledVector( _tempB.sub( _vB ), influence );\n\t\t\t\t\t_morphC.addScaledVector( _tempC.sub( _vC ), influence );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t_vA.add( _morphA );\n\t\t\t_vB.add( _morphB );\n\t\t\t_vC.add( _morphC );\n\n\t\t}\n\n\t\tif ( object.isSkinnedMesh ) {\n\n\t\t\tobject.boneTransform( a, _vA );\n\t\t\tobject.boneTransform( b, _vB );\n\t\t\tobject.boneTransform( c, _vC );\n\n\t\t}\n\n\t\tmodifiedAttributeArray[ a * 3 + 0 ] = _vA.x;\n\t\tmodifiedAttributeArray[ a * 3 + 1 ] = _vA.y;\n\t\tmodifiedAttributeArray[ a * 3 + 2 ] = _vA.z;\n\t\tmodifiedAttributeArray[ b * 3 + 0 ] = _vB.x;\n\t\tmodifiedAttributeArray[ b * 3 + 1 ] = _vB.y;\n\t\tmodifiedAttributeArray[ b * 3 + 2 ] = _vB.z;\n\t\tmodifiedAttributeArray[ c * 3 + 0 ] = _vC.x;\n\t\tmodifiedAttributeArray[ c * 3 + 1 ] = _vC.y;\n\t\tmodifiedAttributeArray[ c * 3 + 2 ] = _vC.z;\n\n\t}\n\n\tconst geometry = object.geometry;\n\tconst material = object.material;\n\n\tlet a, b, c;\n\tconst index = geometry.index;\n\tconst positionAttribute = geometry.attributes.position;\n\tconst morphPosition = geometry.morphAttributes.position;\n\tconst morphTargetsRelative = geometry.morphTargetsRelative;\n\tconst normalAttribute = geometry.attributes.normal;\n\tconst morphNormal = geometry.morphAttributes.position;\n\n\tconst groups = geometry.groups;\n\tconst drawRange = geometry.drawRange;\n\tlet i, j, il, jl;\n\tlet group;\n\tlet start, end;\n\n\tconst modifiedPosition = new Float32Array( positionAttribute.count * positionAttribute.itemSize );\n\tconst modifiedNormal = new Float32Array( normalAttribute.count * normalAttribute.itemSize );\n\n\tif ( index !== null ) {\n\n\t\t// indexed buffer geometry\n\n\t\tif ( Array.isArray( material ) ) {\n\n\t\t\tfor ( i = 0, il = groups.length; i < il; i ++ ) {\n\n\t\t\t\tgroup = groups[ i ];\n\n\t\t\t\tstart = Math.max( group.start, drawRange.start );\n\t\t\t\tend = Math.min( ( group.start + group.count ), ( drawRange.start + drawRange.count ) );\n\n\t\t\t\tfor ( j = start, jl = end; j < jl; j += 3 ) {\n\n\t\t\t\t\ta = index.getX( j );\n\t\t\t\t\tb = index.getX( j + 1 );\n\t\t\t\t\tc = index.getX( j + 2 );\n\n\t\t\t\t\t_calculateMorphedAttributeData(\n\t\t\t\t\t\tobject,\n\t\t\t\t\t\tpositionAttribute,\n\t\t\t\t\t\tmorphPosition,\n\t\t\t\t\t\tmorphTargetsRelative,\n\t\t\t\t\t\ta, b, c,\n\t\t\t\t\t\tmodifiedPosition\n\t\t\t\t\t);\n\n\t\t\t\t\t_calculateMorphedAttributeData(\n\t\t\t\t\t\tobject,\n\t\t\t\t\t\tnormalAttribute,\n\t\t\t\t\t\tmorphNormal,\n\t\t\t\t\t\tmorphTargetsRelative,\n\t\t\t\t\t\ta, b, c,\n\t\t\t\t\t\tmodifiedNormal\n\t\t\t\t\t);\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tstart = Math.max( 0, drawRange.start );\n\t\t\tend = Math.min( index.count, ( drawRange.start + drawRange.count ) );\n\n\t\t\tfor ( i = start, il = end; i < il; i += 3 ) {\n\n\t\t\t\ta = index.getX( i );\n\t\t\t\tb = index.getX( i + 1 );\n\t\t\t\tc = index.getX( i + 2 );\n\n\t\t\t\t_calculateMorphedAttributeData(\n\t\t\t\t\tobject,\n\t\t\t\t\tpositionAttribute,\n\t\t\t\t\tmorphPosition,\n\t\t\t\t\tmorphTargetsRelative,\n\t\t\t\t\ta, b, c,\n\t\t\t\t\tmodifiedPosition\n\t\t\t\t);\n\n\t\t\t\t_calculateMorphedAttributeData(\n\t\t\t\t\tobject,\n\t\t\t\t\tnormalAttribute,\n\t\t\t\t\tmorphNormal,\n\t\t\t\t\tmorphTargetsRelative,\n\t\t\t\t\ta, b, c,\n\t\t\t\t\tmodifiedNormal\n\t\t\t\t);\n\n\t\t\t}\n\n\t\t}\n\n\t} else {\n\n\t\t// non-indexed buffer geometry\n\n\t\tif ( Array.isArray( material ) ) {\n\n\t\t\tfor ( i = 0, il = groups.length; i < il; i ++ ) {\n\n\t\t\t\tgroup = groups[ i ];\n\n\t\t\t\tstart = Math.max( group.start, drawRange.start );\n\t\t\t\tend = Math.min( ( group.start + group.count ), ( drawRange.start + drawRange.count ) );\n\n\t\t\t\tfor ( j = start, jl = end; j < jl; j += 3 ) {\n\n\t\t\t\t\ta = j;\n\t\t\t\t\tb = j + 1;\n\t\t\t\t\tc = j + 2;\n\n\t\t\t\t\t_calculateMorphedAttributeData(\n\t\t\t\t\t\tobject,\n\t\t\t\t\t\tpositionAttribute,\n\t\t\t\t\t\tmorphPosition,\n\t\t\t\t\t\tmorphTargetsRelative,\n\t\t\t\t\t\ta, b, c,\n\t\t\t\t\t\tmodifiedPosition\n\t\t\t\t\t);\n\n\t\t\t\t\t_calculateMorphedAttributeData(\n\t\t\t\t\t\tobject,\n\t\t\t\t\t\tnormalAttribute,\n\t\t\t\t\t\tmorphNormal,\n\t\t\t\t\t\tmorphTargetsRelative,\n\t\t\t\t\t\ta, b, c,\n\t\t\t\t\t\tmodifiedNormal\n\t\t\t\t\t);\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tstart = Math.max( 0, drawRange.start );\n\t\t\tend = Math.min( positionAttribute.count, ( drawRange.start + drawRange.count ) );\n\n\t\t\tfor ( i = start, il = end; i < il; i += 3 ) {\n\n\t\t\t\ta = i;\n\t\t\t\tb = i + 1;\n\t\t\t\tc = i + 2;\n\n\t\t\t\t_calculateMorphedAttributeData(\n\t\t\t\t\tobject,\n\t\t\t\t\tpositionAttribute,\n\t\t\t\t\tmorphPosition,\n\t\t\t\t\tmorphTargetsRelative,\n\t\t\t\t\ta, b, c,\n\t\t\t\t\tmodifiedPosition\n\t\t\t\t);\n\n\t\t\t\t_calculateMorphedAttributeData(\n\t\t\t\t\tobject,\n\t\t\t\t\tnormalAttribute,\n\t\t\t\t\tmorphNormal,\n\t\t\t\t\tmorphTargetsRelative,\n\t\t\t\t\ta, b, c,\n\t\t\t\t\tmodifiedNormal\n\t\t\t\t);\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\tconst morphedPositionAttribute = new Float32BufferAttribute( modifiedPosition, 3 );\n\tconst morphedNormalAttribute = new Float32BufferAttribute( modifiedNormal, 3 );\n\n\treturn {\n\n\t\tpositionAttribute: positionAttribute,\n\t\tnormalAttribute: normalAttribute,\n\t\tmorphedPositionAttribute: morphedPositionAttribute,\n\t\tmorphedNormalAttribute: morphedNormalAttribute\n\n\t};\n\n}\n\nfunction mergeGroups( geometry ) {\n\n\tif ( geometry.groups.length === 0 ) {\n\n\t\tconsole.warn( 'THREE.BufferGeometryUtils.mergeGroups(): No groups are defined. Nothing to merge.' );\n\t\treturn geometry;\n\n\t}\n\n\tlet groups = geometry.groups;\n\n\t// sort groups by material index\n\n\tgroups = groups.sort( ( a, b ) => {\n\n\t\tif ( a.materialIndex !== b.materialIndex ) return a.materialIndex - b.materialIndex;\n\n\t\treturn a.start - b.start;\n\n\t} );\n\n\t// create index for non-indexed geometries\n\n\tif ( geometry.getIndex() === null ) {\n\n\t\tconst positionAttribute = geometry.getAttribute( 'position' );\n\t\tconst indices = [];\n\n\t\tfor ( let i = 0; i < positionAttribute.count; i += 3 ) {\n\n\t\t\tindices.push( i, i + 1, i + 2 );\n\n\t\t}\n\n\t\tgeometry.setIndex( indices );\n\n\t}\n\n\t// sort index\n\n\tconst index = geometry.getIndex();\n\n\tconst newIndices = [];\n\n\tfor ( let i = 0; i < groups.length; i ++ ) {\n\n\t\tconst group = groups[ i ];\n\n\t\tconst groupStart = group.start;\n\t\tconst groupLength = groupStart + group.count;\n\n\t\tfor ( let j = groupStart; j < groupLength; j ++ ) {\n\n\t\t\tnewIndices.push( index.getX( j ) );\n\n\t\t}\n\n\t}\n\n\tgeometry.dispose(); // Required to force buffer recreation\n\tgeometry.setIndex( newIndices );\n\n\t// update groups indices\n\n\tlet start = 0;\n\n\tfor ( let i = 0; i < groups.length; i ++ ) {\n\n\t\tconst group = groups[ i ];\n\n\t\tgroup.start = start;\n\t\tstart += group.count;\n\n\t}\n\n\t// merge groups\n\n\tlet currentGroup = groups[ 0 ];\n\n\tgeometry.groups = [ currentGroup ];\n\n\tfor ( let i = 1; i < groups.length; i ++ ) {\n\n\t\tconst group = groups[ i ];\n\n\t\tif ( currentGroup.materialIndex === group.materialIndex ) {\n\n\t\t\tcurrentGroup.count += group.count;\n\n\t\t} else {\n\n\t\t\tcurrentGroup = group;\n\t\t\tgeometry.groups.push( currentGroup );\n\n\t\t}\n\n\t}\n\n\treturn geometry;\n\n}\n\n\n// Creates a new, non-indexed geometry with smooth normals everywhere except faces that meet at\n// an angle greater than the crease angle.\nfunction toCreasedNormals( geometry, creaseAngle = Math.PI / 3 /* 60 degrees */ ) {\n\n\tconst creaseDot = Math.cos( creaseAngle );\n\tconst hashMultiplier = ( 1 + 1e-10 ) * 1e2;\n\n\t// reusable vertors\n\tconst verts = [ new Vector3(), new Vector3(), new Vector3() ];\n\tconst tempVec1 = new Vector3();\n\tconst tempVec2 = new Vector3();\n\tconst tempNorm = new Vector3();\n\tconst tempNorm2 = new Vector3();\n\n\t// hashes a vector\n\tfunction hashVertex( v ) {\n\n\t\tconst x = ~ ~ ( v.x * hashMultiplier );\n\t\tconst y = ~ ~ ( v.y * hashMultiplier );\n\t\tconst z = ~ ~ ( v.z * hashMultiplier );\n\t\treturn `${x},${y},${z}`;\n\n\t}\n\n\tconst resultGeometry = geometry.toNonIndexed();\n\tconst posAttr = resultGeometry.attributes.position;\n\tconst vertexMap = {};\n\n\t// find all the normals shared by commonly located vertices\n\tfor ( let i = 0, l = posAttr.count / 3; i < l; i ++ ) {\n\n\t\tconst i3 = 3 * i;\n\t\tconst a = verts[ 0 ].fromBufferAttribute( posAttr, i3 + 0 );\n\t\tconst b = verts[ 1 ].fromBufferAttribute( posAttr, i3 + 1 );\n\t\tconst c = verts[ 2 ].fromBufferAttribute( posAttr, i3 + 2 );\n\n\t\ttempVec1.subVectors( c, b );\n\t\ttempVec2.subVectors( a, b );\n\n\t\t// add the normal to the map for all vertices\n\t\tconst normal = new Vector3().crossVectors( tempVec1, tempVec2 ).normalize();\n\t\tfor ( let n = 0; n < 3; n ++ ) {\n\n\t\t\tconst vert = verts[ n ];\n\t\t\tconst hash = hashVertex( vert );\n\t\t\tif ( ! ( hash in vertexMap ) ) {\n\n\t\t\t\tvertexMap[ hash ] = [];\n\n\t\t\t}\n\n\t\t\tvertexMap[ hash ].push( normal );\n\n\t\t}\n\n\t}\n\n\t// average normals from all vertices that share a common location if they are within the\n\t// provided crease threshold\n\tconst normalArray = new Float32Array( posAttr.count * 3 );\n\tconst normAttr = new BufferAttribute( normalArray, 3, false );\n\tfor ( let i = 0, l = posAttr.count / 3; i < l; i ++ ) {\n\n\t\t// get the face normal for this vertex\n\t\tconst i3 = 3 * i;\n\t\tconst a = verts[ 0 ].fromBufferAttribute( posAttr, i3 + 0 );\n\t\tconst b = verts[ 1 ].fromBufferAttribute( posAttr, i3 + 1 );\n\t\tconst c = verts[ 2 ].fromBufferAttribute( posAttr, i3 + 2 );\n\n\t\ttempVec1.subVectors( c, b );\n\t\ttempVec2.subVectors( a, b );\n\n\t\ttempNorm.crossVectors( tempVec1, tempVec2 ).normalize();\n\n\t\t// average all normals that meet the threshold and set the normal value\n\t\tfor ( let n = 0; n < 3; n ++ ) {\n\n\t\t\tconst vert = verts[ n ];\n\t\t\tconst hash = hashVertex( vert );\n\t\t\tconst otherNormals = vertexMap[ hash ];\n\t\t\ttempNorm2.set( 0, 0, 0 );\n\n\t\t\tfor ( let k = 0, lk = otherNormals.length; k < lk; k ++ ) {\n\n\t\t\t\tconst otherNorm = otherNormals[ k ];\n\t\t\t\tif ( tempNorm.dot( otherNorm ) > creaseDot ) {\n\n\t\t\t\t\ttempNorm2.add( otherNorm );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\ttempNorm2.normalize();\n\t\t\tnormAttr.setXYZ( i3 + n, tempNorm2.x, tempNorm2.y, tempNorm2.z );\n\n\t\t}\n\n\t}\n\n\tresultGeometry.setAttribute( 'normal', normAttr );\n\treturn resultGeometry;\n\n}\n\nexport {\n\tcomputeTangents,\n\tcomputeMikkTSpaceTangents,\n\tmergeBufferGeometries,\n\tmergeBufferAttributes,\n\tinterleaveAttributes,\n\testimateBytesUsed,\n\tmergeVertices,\n\ttoTrianglesDrawMode,\n\tcomputeMorphedAttributes,\n\tmergeGroups,\n\ttoCreasedNormals\n};\n","import {\n\tAnimationClip,\n\tBone,\n\tBox3,\n\tBufferAttribute,\n\tBufferGeometry,\n\tClampToEdgeWrapping,\n\tColor,\n\tDirectionalLight,\n\tDoubleSide,\n\tFileLoader,\n\tFrontSide,\n\tGroup,\n\tImageBitmapLoader,\n\tInstancedMesh,\n\tInterleavedBuffer,\n\tInterleavedBufferAttribute,\n\tInterpolant,\n\tInterpolateDiscrete,\n\tInterpolateLinear,\n\tLine,\n\tLineBasicMaterial,\n\tLineLoop,\n\tLineSegments,\n\tLinearFilter,\n\tLinearMipmapLinearFilter,\n\tLinearMipmapNearestFilter,\n\tLoader,\n\tLoaderUtils,\n\tMaterial,\n\tMathUtils,\n\tMatrix4,\n\tMesh,\n\tMeshBasicMaterial,\n\tMeshPhysicalMaterial,\n\tMeshStandardMaterial,\n\tMirroredRepeatWrapping,\n\tNearestFilter,\n\tNearestMipmapLinearFilter,\n\tNearestMipmapNearestFilter,\n\tNumberKeyframeTrack,\n\tObject3D,\n\tOrthographicCamera,\n\tPerspectiveCamera,\n\tPointLight,\n\tPoints,\n\tPointsMaterial,\n\tPropertyBinding,\n\tQuaternion,\n\tQuaternionKeyframeTrack,\n\tRepeatWrapping,\n\tSkeleton,\n\tSkinnedMesh,\n\tSphere,\n\tSpotLight,\n\tTexture,\n\tTextureLoader,\n\tTriangleFanDrawMode,\n\tTriangleStripDrawMode,\n\tVector2,\n\tVector3,\n\tVectorKeyframeTrack,\n\tsRGBEncoding\n} from 'three';\nimport { toTrianglesDrawMode } from '../utils/BufferGeometryUtils.js';\n\nclass GLTFLoader extends Loader {\n\n\tconstructor( manager ) {\n\n\t\tsuper( manager );\n\n\t\tthis.dracoLoader = null;\n\t\tthis.ktx2Loader = null;\n\t\tthis.meshoptDecoder = null;\n\n\t\tthis.pluginCallbacks = [];\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsClearcoatExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFTextureBasisUExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFTextureWebPExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsSheenExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsTransmissionExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsVolumeExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsIorExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsEmissiveStrengthExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsSpecularExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsIridescenceExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFLightsExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMeshoptCompression( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMeshGpuInstancing( parser );\n\n\t\t} );\n\n\t}\n\n\tload( url, onLoad, onProgress, onError ) {\n\n\t\tconst scope = this;\n\n\t\tlet resourcePath;\n\n\t\tif ( this.resourcePath !== '' ) {\n\n\t\t\tresourcePath = this.resourcePath;\n\n\t\t} else if ( this.path !== '' ) {\n\n\t\t\tresourcePath = this.path;\n\n\t\t} else {\n\n\t\t\tresourcePath = LoaderUtils.extractUrlBase( url );\n\n\t\t}\n\n\t\t// Tells the LoadingManager to track an extra item, which resolves after\n\t\t// the model is fully loaded. This means the count of items loaded will\n\t\t// be incorrect, but ensures manager.onLoad() does not fire early.\n\t\tthis.manager.itemStart( url );\n\n\t\tconst _onError = function ( e ) {\n\n\t\t\tif ( onError ) {\n\n\t\t\t\tonError( e );\n\n\t\t\t} else {\n\n\t\t\t\tconsole.error( e );\n\n\t\t\t}\n\n\t\t\tscope.manager.itemError( url );\n\t\t\tscope.manager.itemEnd( url );\n\n\t\t};\n\n\t\tconst loader = new FileLoader( this.manager );\n\n\t\tloader.setPath( this.path );\n\t\tloader.setResponseType( 'arraybuffer' );\n\t\tloader.setRequestHeader( this.requestHeader );\n\t\tloader.setWithCredentials( this.withCredentials );\n\n\t\tloader.load( url, function ( data ) {\n\n\t\t\ttry {\n\n\t\t\t\tscope.parse( data, resourcePath, function ( gltf ) {\n\n\t\t\t\t\tonLoad( gltf );\n\n\t\t\t\t\tscope.manager.itemEnd( url );\n\n\t\t\t\t}, _onError );\n\n\t\t\t} catch ( e ) {\n\n\t\t\t\t_onError( e );\n\n\t\t\t}\n\n\t\t}, onProgress, _onError );\n\n\t}\n\n\tsetDRACOLoader( dracoLoader ) {\n\n\t\tthis.dracoLoader = dracoLoader;\n\t\treturn this;\n\n\t}\n\n\tsetDDSLoader() {\n\n\t\tthrow new Error(\n\n\t\t\t'THREE.GLTFLoader: \"MSFT_texture_dds\" no longer supported. Please update to \"KHR_texture_basisu\".'\n\n\t\t);\n\n\t}\n\n\tsetKTX2Loader( ktx2Loader ) {\n\n\t\tthis.ktx2Loader = ktx2Loader;\n\t\treturn this;\n\n\t}\n\n\tsetMeshoptDecoder( meshoptDecoder ) {\n\n\t\tthis.meshoptDecoder = meshoptDecoder;\n\t\treturn this;\n\n\t}\n\n\tregister( callback ) {\n\n\t\tif ( this.pluginCallbacks.indexOf( callback ) === - 1 ) {\n\n\t\t\tthis.pluginCallbacks.push( callback );\n\n\t\t}\n\n\t\treturn this;\n\n\t}\n\n\tunregister( callback ) {\n\n\t\tif ( this.pluginCallbacks.indexOf( callback ) !== - 1 ) {\n\n\t\t\tthis.pluginCallbacks.splice( this.pluginCallbacks.indexOf( callback ), 1 );\n\n\t\t}\n\n\t\treturn this;\n\n\t}\n\n\tparse( data, path, onLoad, onError ) {\n\n\t\tlet json;\n\t\tconst extensions = {};\n\t\tconst plugins = {};\n\t\tconst textDecoder = new TextDecoder();\n\n\t\tif ( typeof data === 'string' ) {\n\n\t\t\tjson = JSON.parse( data );\n\n\t\t} else if ( data instanceof ArrayBuffer ) {\n\n\t\t\tconst magic = textDecoder.decode( new Uint8Array( data, 0, 4 ) );\n\n\t\t\tif ( magic === BINARY_EXTENSION_HEADER_MAGIC ) {\n\n\t\t\t\ttry {\n\n\t\t\t\t\textensions[ EXTENSIONS.KHR_BINARY_GLTF ] = new GLTFBinaryExtension( data );\n\n\t\t\t\t} catch ( error ) {\n\n\t\t\t\t\tif ( onError ) onError( error );\n\t\t\t\t\treturn;\n\n\t\t\t\t}\n\n\t\t\t\tjson = JSON.parse( extensions[ EXTENSIONS.KHR_BINARY_GLTF ].content );\n\n\t\t\t} else {\n\n\t\t\t\tjson = JSON.parse( textDecoder.decode( data ) );\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tjson = data;\n\n\t\t}\n\n\t\tif ( json.asset === undefined || json.asset.version[ 0 ] < 2 ) {\n\n\t\t\tif ( onError ) onError( new Error( 'THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.' ) );\n\t\t\treturn;\n\n\t\t}\n\n\t\tconst parser = new GLTFParser( json, {\n\n\t\t\tpath: path || this.resourcePath || '',\n\t\t\tcrossOrigin: this.crossOrigin,\n\t\t\trequestHeader: this.requestHeader,\n\t\t\tmanager: this.manager,\n\t\t\tktx2Loader: this.ktx2Loader,\n\t\t\tmeshoptDecoder: this.meshoptDecoder\n\n\t\t} );\n\n\t\tparser.fileLoader.setRequestHeader( this.requestHeader );\n\n\t\tfor ( let i = 0; i < this.pluginCallbacks.length; i ++ ) {\n\n\t\t\tconst plugin = this.pluginCallbacks[ i ]( parser );\n\t\t\tplugins[ plugin.name ] = plugin;\n\n\t\t\t// Workaround to avoid determining as unknown extension\n\t\t\t// in addUnknownExtensionsToUserData().\n\t\t\t// Remove this workaround if we move all the existing\n\t\t\t// extension handlers to plugin system\n\t\t\textensions[ plugin.name ] = true;\n\n\t\t}\n\n\t\tif ( json.extensionsUsed ) {\n\n\t\t\tfor ( let i = 0; i < json.extensionsUsed.length; ++ i ) {\n\n\t\t\t\tconst extensionName = json.extensionsUsed[ i ];\n\t\t\t\tconst extensionsRequired = json.extensionsRequired || [];\n\n\t\t\t\tswitch ( extensionName ) {\n\n\t\t\t\t\tcase EXTENSIONS.KHR_MATERIALS_UNLIT:\n\t\t\t\t\t\textensions[ extensionName ] = new GLTFMaterialsUnlitExtension();\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase EXTENSIONS.KHR_DRACO_MESH_COMPRESSION:\n\t\t\t\t\t\textensions[ extensionName ] = new GLTFDracoMeshCompressionExtension( json, this.dracoLoader );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase EXTENSIONS.KHR_TEXTURE_TRANSFORM:\n\t\t\t\t\t\textensions[ extensionName ] = new GLTFTextureTransformExtension();\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase EXTENSIONS.KHR_MESH_QUANTIZATION:\n\t\t\t\t\t\textensions[ extensionName ] = new GLTFMeshQuantizationExtension();\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\n\t\t\t\t\t\tif ( extensionsRequired.indexOf( extensionName ) >= 0 && plugins[ extensionName ] === undefined ) {\n\n\t\t\t\t\t\t\tconsole.warn( 'THREE.GLTFLoader: Unknown extension \"' + extensionName + '\".' );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tparser.setExtensions( extensions );\n\t\tparser.setPlugins( plugins );\n\t\tparser.parse( onLoad, onError );\n\n\t}\n\n\tparseAsync( data, path ) {\n\n\t\tconst scope = this;\n\n\t\treturn new Promise( function ( resolve, reject ) {\n\n\t\t\tscope.parse( data, path, resolve, reject );\n\n\t\t} );\n\n\t}\n\n}\n\n/* GLTFREGISTRY */\n\nfunction GLTFRegistry() {\n\n\tlet objects = {};\n\n\treturn\t{\n\n\t\tget: function ( key ) {\n\n\t\t\treturn objects[ key ];\n\n\t\t},\n\n\t\tadd: function ( key, object ) {\n\n\t\t\tobjects[ key ] = object;\n\n\t\t},\n\n\t\tremove: function ( key ) {\n\n\t\t\tdelete objects[ key ];\n\n\t\t},\n\n\t\tremoveAll: function () {\n\n\t\t\tobjects = {};\n\n\t\t}\n\n\t};\n\n}\n\n/*********************************/\n/********** EXTENSIONS ***********/\n/*********************************/\n\nconst EXTENSIONS = {\n\tKHR_BINARY_GLTF: 'KHR_binary_glTF',\n\tKHR_DRACO_MESH_COMPRESSION: 'KHR_draco_mesh_compression',\n\tKHR_LIGHTS_PUNCTUAL: 'KHR_lights_punctual',\n\tKHR_MATERIALS_CLEARCOAT: 'KHR_materials_clearcoat',\n\tKHR_MATERIALS_IOR: 'KHR_materials_ior',\n\tKHR_MATERIALS_SHEEN: 'KHR_materials_sheen',\n\tKHR_MATERIALS_SPECULAR: 'KHR_materials_specular',\n\tKHR_MATERIALS_TRANSMISSION: 'KHR_materials_transmission',\n\tKHR_MATERIALS_IRIDESCENCE: 'KHR_materials_iridescence',\n\tKHR_MATERIALS_UNLIT: 'KHR_materials_unlit',\n\tKHR_MATERIALS_VOLUME: 'KHR_materials_volume',\n\tKHR_TEXTURE_BASISU: 'KHR_texture_basisu',\n\tKHR_TEXTURE_TRANSFORM: 'KHR_texture_transform',\n\tKHR_MESH_QUANTIZATION: 'KHR_mesh_quantization',\n\tKHR_MATERIALS_EMISSIVE_STRENGTH: 'KHR_materials_emissive_strength',\n\tEXT_TEXTURE_WEBP: 'EXT_texture_webp',\n\tEXT_MESHOPT_COMPRESSION: 'EXT_meshopt_compression',\n\tEXT_MESH_GPU_INSTANCING: 'EXT_mesh_gpu_instancing'\n};\n\n/**\n * Punctual Lights Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_lights_punctual\n */\nclass GLTFLightsExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_LIGHTS_PUNCTUAL;\n\n\t\t// Object3D instance caches\n\t\tthis.cache = { refs: {}, uses: {} };\n\n\t}\n\n\t_markDefs() {\n\n\t\tconst parser = this.parser;\n\t\tconst nodeDefs = this.parser.json.nodes || [];\n\n\t\tfor ( let nodeIndex = 0, nodeLength = nodeDefs.length; nodeIndex < nodeLength; nodeIndex ++ ) {\n\n\t\t\tconst nodeDef = nodeDefs[ nodeIndex ];\n\n\t\t\tif ( nodeDef.extensions\n\t\t\t\t\t&& nodeDef.extensions[ this.name ]\n\t\t\t\t\t&& nodeDef.extensions[ this.name ].light !== undefined ) {\n\n\t\t\t\tparser._addNodeRef( this.cache, nodeDef.extensions[ this.name ].light );\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\t_loadLight( lightIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst cacheKey = 'light:' + lightIndex;\n\t\tlet dependency = parser.cache.get( cacheKey );\n\n\t\tif ( dependency ) return dependency;\n\n\t\tconst json = parser.json;\n\t\tconst extensions = ( json.extensions && json.extensions[ this.name ] ) || {};\n\t\tconst lightDefs = extensions.lights || [];\n\t\tconst lightDef = lightDefs[ lightIndex ];\n\t\tlet lightNode;\n\n\t\tconst color = new Color( 0xffffff );\n\n\t\tif ( lightDef.color !== undefined ) color.fromArray( lightDef.color );\n\n\t\tconst range = lightDef.range !== undefined ? lightDef.range : 0;\n\n\t\tswitch ( lightDef.type ) {\n\n\t\t\tcase 'directional':\n\t\t\t\tlightNode = new DirectionalLight( color );\n\t\t\t\tlightNode.target.position.set( 0, 0, - 1 );\n\t\t\t\tlightNode.add( lightNode.target );\n\t\t\t\tbreak;\n\n\t\t\tcase 'point':\n\t\t\t\tlightNode = new PointLight( color );\n\t\t\t\tlightNode.distance = range;\n\t\t\t\tbreak;\n\n\t\t\tcase 'spot':\n\t\t\t\tlightNode = new SpotLight( color );\n\t\t\t\tlightNode.distance = range;\n\t\t\t\t// Handle spotlight properties.\n\t\t\t\tlightDef.spot = lightDef.spot || {};\n\t\t\t\tlightDef.spot.innerConeAngle = lightDef.spot.innerConeAngle !== undefined ? lightDef.spot.innerConeAngle : 0;\n\t\t\t\tlightDef.spot.outerConeAngle = lightDef.spot.outerConeAngle !== undefined ? lightDef.spot.outerConeAngle : Math.PI / 4.0;\n\t\t\t\tlightNode.angle = lightDef.spot.outerConeAngle;\n\t\t\t\tlightNode.penumbra = 1.0 - lightDef.spot.innerConeAngle / lightDef.spot.outerConeAngle;\n\t\t\t\tlightNode.target.position.set( 0, 0, - 1 );\n\t\t\t\tlightNode.add( lightNode.target );\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tthrow new Error( 'THREE.GLTFLoader: Unexpected light type: ' + lightDef.type );\n\n\t\t}\n\n\t\t// Some lights (e.g. spot) default to a position other than the origin. Reset the position\n\t\t// here, because node-level parsing will only override position if explicitly specified.\n\t\tlightNode.position.set( 0, 0, 0 );\n\n\t\tlightNode.decay = 2;\n\n\t\tassignExtrasToUserData( lightNode, lightDef );\n\n\t\tif ( lightDef.intensity !== undefined ) lightNode.intensity = lightDef.intensity;\n\n\t\tlightNode.name = parser.createUniqueName( lightDef.name || ( 'light_' + lightIndex ) );\n\n\t\tdependency = Promise.resolve( lightNode );\n\n\t\tparser.cache.add( cacheKey, dependency );\n\n\t\treturn dependency;\n\n\t}\n\n\tgetDependency( type, index ) {\n\n\t\tif ( type !== 'light' ) return;\n\n\t\treturn this._loadLight( index );\n\n\t}\n\n\tcreateNodeAttachment( nodeIndex ) {\n\n\t\tconst self = this;\n\t\tconst parser = this.parser;\n\t\tconst json = parser.json;\n\t\tconst nodeDef = json.nodes[ nodeIndex ];\n\t\tconst lightDef = ( nodeDef.extensions && nodeDef.extensions[ this.name ] ) || {};\n\t\tconst lightIndex = lightDef.light;\n\n\t\tif ( lightIndex === undefined ) return null;\n\n\t\treturn this._loadLight( lightIndex ).then( function ( light ) {\n\n\t\t\treturn parser._getNodeRef( self.cache, lightIndex, light );\n\n\t\t} );\n\n\t}\n\n}\n\n/**\n * Unlit Materials Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_unlit\n */\nclass GLTFMaterialsUnlitExtension {\n\n\tconstructor() {\n\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_UNLIT;\n\n\t}\n\n\tgetMaterialType() {\n\n\t\treturn MeshBasicMaterial;\n\n\t}\n\n\textendParams( materialParams, materialDef, parser ) {\n\n\t\tconst pending = [];\n\n\t\tmaterialParams.color = new Color( 1.0, 1.0, 1.0 );\n\t\tmaterialParams.opacity = 1.0;\n\n\t\tconst metallicRoughness = materialDef.pbrMetallicRoughness;\n\n\t\tif ( metallicRoughness ) {\n\n\t\t\tif ( Array.isArray( metallicRoughness.baseColorFactor ) ) {\n\n\t\t\t\tconst array = metallicRoughness.baseColorFactor;\n\n\t\t\t\tmaterialParams.color.fromArray( array );\n\t\t\t\tmaterialParams.opacity = array[ 3 ];\n\n\t\t\t}\n\n\t\t\tif ( metallicRoughness.baseColorTexture !== undefined ) {\n\n\t\t\t\tpending.push( parser.assignTexture( materialParams, 'map', metallicRoughness.baseColorTexture, sRGBEncoding ) );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n}\n\n/**\n * Materials Emissive Strength Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/blob/5768b3ce0ef32bc39cdf1bef10b948586635ead3/extensions/2.0/Khronos/KHR_materials_emissive_strength/README.md\n */\nclass GLTFMaterialsEmissiveStrengthExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_EMISSIVE_STRENGTH;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst emissiveStrength = materialDef.extensions[ this.name ].emissiveStrength;\n\n\t\tif ( emissiveStrength !== undefined ) {\n\n\t\t\tmaterialParams.emissiveIntensity = emissiveStrength;\n\n\t\t}\n\n\t\treturn Promise.resolve();\n\n\t}\n\n}\n\n/**\n * Clearcoat Materials Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_clearcoat\n */\nclass GLTFMaterialsClearcoatExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_CLEARCOAT;\n\n\t}\n\n\tgetMaterialType( materialIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\n\n\t\treturn MeshPhysicalMaterial;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst pending = [];\n\n\t\tconst extension = materialDef.extensions[ this.name ];\n\n\t\tif ( extension.clearcoatFactor !== undefined ) {\n\n\t\t\tmaterialParams.clearcoat = extension.clearcoatFactor;\n\n\t\t}\n\n\t\tif ( extension.clearcoatTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'clearcoatMap', extension.clearcoatTexture ) );\n\n\t\t}\n\n\t\tif ( extension.clearcoatRoughnessFactor !== undefined ) {\n\n\t\t\tmaterialParams.clearcoatRoughness = extension.clearcoatRoughnessFactor;\n\n\t\t}\n\n\t\tif ( extension.clearcoatRoughnessTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'clearcoatRoughnessMap', extension.clearcoatRoughnessTexture ) );\n\n\t\t}\n\n\t\tif ( extension.clearcoatNormalTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'clearcoatNormalMap', extension.clearcoatNormalTexture ) );\n\n\t\t\tif ( extension.clearcoatNormalTexture.scale !== undefined ) {\n\n\t\t\t\tconst scale = extension.clearcoatNormalTexture.scale;\n\n\t\t\t\tmaterialParams.clearcoatNormalScale = new Vector2( scale, scale );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n}\n\n/**\n * Iridescence Materials Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_iridescence\n */\nclass GLTFMaterialsIridescenceExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_IRIDESCENCE;\n\n\t}\n\n\tgetMaterialType( materialIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\n\n\t\treturn MeshPhysicalMaterial;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst pending = [];\n\n\t\tconst extension = materialDef.extensions[ this.name ];\n\n\t\tif ( extension.iridescenceFactor !== undefined ) {\n\n\t\t\tmaterialParams.iridescence = extension.iridescenceFactor;\n\n\t\t}\n\n\t\tif ( extension.iridescenceTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'iridescenceMap', extension.iridescenceTexture ) );\n\n\t\t}\n\n\t\tif ( extension.iridescenceIor !== undefined ) {\n\n\t\t\tmaterialParams.iridescenceIOR = extension.iridescenceIor;\n\n\t\t}\n\n\t\tif ( materialParams.iridescenceThicknessRange === undefined ) {\n\n\t\t\tmaterialParams.iridescenceThicknessRange = [ 100, 400 ];\n\n\t\t}\n\n\t\tif ( extension.iridescenceThicknessMinimum !== undefined ) {\n\n\t\t\tmaterialParams.iridescenceThicknessRange[ 0 ] = extension.iridescenceThicknessMinimum;\n\n\t\t}\n\n\t\tif ( extension.iridescenceThicknessMaximum !== undefined ) {\n\n\t\t\tmaterialParams.iridescenceThicknessRange[ 1 ] = extension.iridescenceThicknessMaximum;\n\n\t\t}\n\n\t\tif ( extension.iridescenceThicknessTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'iridescenceThicknessMap', extension.iridescenceThicknessTexture ) );\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n}\n\n/**\n * Sheen Materials Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/main/extensions/2.0/Khronos/KHR_materials_sheen\n */\nclass GLTFMaterialsSheenExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_SHEEN;\n\n\t}\n\n\tgetMaterialType( materialIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\n\n\t\treturn MeshPhysicalMaterial;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst pending = [];\n\n\t\tmaterialParams.sheenColor = new Color( 0, 0, 0 );\n\t\tmaterialParams.sheenRoughness = 0;\n\t\tmaterialParams.sheen = 1;\n\n\t\tconst extension = materialDef.extensions[ this.name ];\n\n\t\tif ( extension.sheenColorFactor !== undefined ) {\n\n\t\t\tmaterialParams.sheenColor.fromArray( extension.sheenColorFactor );\n\n\t\t}\n\n\t\tif ( extension.sheenRoughnessFactor !== undefined ) {\n\n\t\t\tmaterialParams.sheenRoughness = extension.sheenRoughnessFactor;\n\n\t\t}\n\n\t\tif ( extension.sheenColorTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'sheenColorMap', extension.sheenColorTexture, sRGBEncoding ) );\n\n\t\t}\n\n\t\tif ( extension.sheenRoughnessTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'sheenRoughnessMap', extension.sheenRoughnessTexture ) );\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n}\n\n/**\n * Transmission Materials Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_transmission\n * Draft: https://github.com/KhronosGroup/glTF/pull/1698\n */\nclass GLTFMaterialsTransmissionExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_TRANSMISSION;\n\n\t}\n\n\tgetMaterialType( materialIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\n\n\t\treturn MeshPhysicalMaterial;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst pending = [];\n\n\t\tconst extension = materialDef.extensions[ this.name ];\n\n\t\tif ( extension.transmissionFactor !== undefined ) {\n\n\t\t\tmaterialParams.transmission = extension.transmissionFactor;\n\n\t\t}\n\n\t\tif ( extension.transmissionTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'transmissionMap', extension.transmissionTexture ) );\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n}\n\n/**\n * Materials Volume Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_volume\n */\nclass GLTFMaterialsVolumeExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_VOLUME;\n\n\t}\n\n\tgetMaterialType( materialIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\n\n\t\treturn MeshPhysicalMaterial;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst pending = [];\n\n\t\tconst extension = materialDef.extensions[ this.name ];\n\n\t\tmaterialParams.thickness = extension.thicknessFactor !== undefined ? extension.thicknessFactor : 0;\n\n\t\tif ( extension.thicknessTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'thicknessMap', extension.thicknessTexture ) );\n\n\t\t}\n\n\t\tmaterialParams.attenuationDistance = extension.attenuationDistance || Infinity;\n\n\t\tconst colorArray = extension.attenuationColor || [ 1, 1, 1 ];\n\t\tmaterialParams.attenuationColor = new Color( colorArray[ 0 ], colorArray[ 1 ], colorArray[ 2 ] );\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n}\n\n/**\n * Materials ior Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_ior\n */\nclass GLTFMaterialsIorExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_IOR;\n\n\t}\n\n\tgetMaterialType( materialIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\n\n\t\treturn MeshPhysicalMaterial;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst extension = materialDef.extensions[ this.name ];\n\n\t\tmaterialParams.ior = extension.ior !== undefined ? extension.ior : 1.5;\n\n\t\treturn Promise.resolve();\n\n\t}\n\n}\n\n/**\n * Materials specular Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_specular\n */\nclass GLTFMaterialsSpecularExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_SPECULAR;\n\n\t}\n\n\tgetMaterialType( materialIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\n\n\t\treturn MeshPhysicalMaterial;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst pending = [];\n\n\t\tconst extension = materialDef.extensions[ this.name ];\n\n\t\tmaterialParams.specularIntensity = extension.specularFactor !== undefined ? extension.specularFactor : 1.0;\n\n\t\tif ( extension.specularTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'specularIntensityMap', extension.specularTexture ) );\n\n\t\t}\n\n\t\tconst colorArray = extension.specularColorFactor || [ 1, 1, 1 ];\n\t\tmaterialParams.specularColor = new Color( colorArray[ 0 ], colorArray[ 1 ], colorArray[ 2 ] );\n\n\t\tif ( extension.specularColorTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'specularColorMap', extension.specularColorTexture, sRGBEncoding ) );\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n}\n\n/**\n * BasisU Texture Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_texture_basisu\n */\nclass GLTFTextureBasisUExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_TEXTURE_BASISU;\n\n\t}\n\n\tloadTexture( textureIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst json = parser.json;\n\n\t\tconst textureDef = json.textures[ textureIndex ];\n\n\t\tif ( ! textureDef.extensions || ! textureDef.extensions[ this.name ] ) {\n\n\t\t\treturn null;\n\n\t\t}\n\n\t\tconst extension = textureDef.extensions[ this.name ];\n\t\tconst loader = parser.options.ktx2Loader;\n\n\t\tif ( ! loader ) {\n\n\t\t\tif ( json.extensionsRequired && json.extensionsRequired.indexOf( this.name ) >= 0 ) {\n\n\t\t\t\tthrow new Error( 'THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures' );\n\n\t\t\t} else {\n\n\t\t\t\t// Assumes that the extension is optional and that a fallback texture is present\n\t\t\t\treturn null;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn parser.loadTextureImage( textureIndex, extension.source, loader );\n\n\t}\n\n}\n\n/**\n * WebP Texture Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/EXT_texture_webp\n */\nclass GLTFTextureWebPExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.EXT_TEXTURE_WEBP;\n\t\tthis.isSupported = null;\n\n\t}\n\n\tloadTexture( textureIndex ) {\n\n\t\tconst name = this.name;\n\t\tconst parser = this.parser;\n\t\tconst json = parser.json;\n\n\t\tconst textureDef = json.textures[ textureIndex ];\n\n\t\tif ( ! textureDef.extensions || ! textureDef.extensions[ name ] ) {\n\n\t\t\treturn null;\n\n\t\t}\n\n\t\tconst extension = textureDef.extensions[ name ];\n\t\tconst source = json.images[ extension.source ];\n\n\t\tlet loader = parser.textureLoader;\n\t\tif ( source.uri ) {\n\n\t\t\tconst handler = parser.options.manager.getHandler( source.uri );\n\t\t\tif ( handler !== null ) loader = handler;\n\n\t\t}\n\n\t\treturn this.detectSupport().then( function ( isSupported ) {\n\n\t\t\tif ( isSupported ) return parser.loadTextureImage( textureIndex, extension.source, loader );\n\n\t\t\tif ( json.extensionsRequired && json.extensionsRequired.indexOf( name ) >= 0 ) {\n\n\t\t\t\tthrow new Error( 'THREE.GLTFLoader: WebP required by asset but unsupported.' );\n\n\t\t\t}\n\n\t\t\t// Fall back to PNG or JPEG.\n\t\t\treturn parser.loadTexture( textureIndex );\n\n\t\t} );\n\n\t}\n\n\tdetectSupport() {\n\n\t\tif ( ! this.isSupported ) {\n\n\t\t\tthis.isSupported = new Promise( function ( resolve ) {\n\n\t\t\t\tconst image = new Image();\n\n\t\t\t\t// Lossy test image. Support for lossy images doesn't guarantee support for all\n\t\t\t\t// WebP images, unfortunately.\n\t\t\t\timage.src = 'data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA';\n\n\t\t\t\timage.onload = image.onerror = function () {\n\n\t\t\t\t\tresolve( image.height === 1 );\n\n\t\t\t\t};\n\n\t\t\t} );\n\n\t\t}\n\n\t\treturn this.isSupported;\n\n\t}\n\n}\n\n/**\n * meshopt BufferView Compression Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/EXT_meshopt_compression\n */\nclass GLTFMeshoptCompression {\n\n\tconstructor( parser ) {\n\n\t\tthis.name = EXTENSIONS.EXT_MESHOPT_COMPRESSION;\n\t\tthis.parser = parser;\n\n\t}\n\n\tloadBufferView( index ) {\n\n\t\tconst json = this.parser.json;\n\t\tconst bufferView = json.bufferViews[ index ];\n\n\t\tif ( bufferView.extensions && bufferView.extensions[ this.name ] ) {\n\n\t\t\tconst extensionDef = bufferView.extensions[ this.name ];\n\n\t\t\tconst buffer = this.parser.getDependency( 'buffer', extensionDef.buffer );\n\t\t\tconst decoder = this.parser.options.meshoptDecoder;\n\n\t\t\tif ( ! decoder || ! decoder.supported ) {\n\n\t\t\t\tif ( json.extensionsRequired && json.extensionsRequired.indexOf( this.name ) >= 0 ) {\n\n\t\t\t\t\tthrow new Error( 'THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files' );\n\n\t\t\t\t} else {\n\n\t\t\t\t\t// Assumes that the extension is optional and that fallback buffer data is present\n\t\t\t\t\treturn null;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn buffer.then( function ( res ) {\n\n\t\t\t\tconst byteOffset = extensionDef.byteOffset || 0;\n\t\t\t\tconst byteLength = extensionDef.byteLength || 0;\n\n\t\t\t\tconst count = extensionDef.count;\n\t\t\t\tconst stride = extensionDef.byteStride;\n\n\t\t\t\tconst source = new Uint8Array( res, byteOffset, byteLength );\n\n\t\t\t\tif ( decoder.decodeGltfBufferAsync ) {\n\n\t\t\t\t\treturn decoder.decodeGltfBufferAsync( count, stride, source, extensionDef.mode, extensionDef.filter ).then( function ( res ) {\n\n\t\t\t\t\t\treturn res.buffer;\n\n\t\t\t\t\t} );\n\n\t\t\t\t} else {\n\n\t\t\t\t\t// Support for MeshoptDecoder 0.18 or earlier, without decodeGltfBufferAsync\n\t\t\t\t\treturn decoder.ready.then( function () {\n\n\t\t\t\t\t\tconst result = new ArrayBuffer( count * stride );\n\t\t\t\t\t\tdecoder.decodeGltfBuffer( new Uint8Array( result ), count, stride, source, extensionDef.mode, extensionDef.filter );\n\t\t\t\t\t\treturn result;\n\n\t\t\t\t\t} );\n\n\t\t\t\t}\n\n\t\t\t} );\n\n\t\t} else {\n\n\t\t\treturn null;\n\n\t\t}\n\n\t}\n\n}\n\n/**\n * GPU Instancing Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/EXT_mesh_gpu_instancing\n *\n */\nclass GLTFMeshGpuInstancing {\n\n\tconstructor( parser ) {\n\n\t\tthis.name = EXTENSIONS.EXT_MESH_GPU_INSTANCING;\n\t\tthis.parser = parser;\n\n\t}\n\n\tcreateNodeMesh( nodeIndex ) {\n\n\t\tconst json = this.parser.json;\n\t\tconst nodeDef = json.nodes[ nodeIndex ];\n\n\t\tif ( ! nodeDef.extensions || ! nodeDef.extensions[ this.name ] ||\n\t\t\tnodeDef.mesh === undefined ) {\n\n\t\t\treturn null;\n\n\t\t}\n\n\t\tconst meshDef = json.meshes[ nodeDef.mesh ];\n\n\t\t// No Points or Lines + Instancing support yet\n\n\t\tfor ( const primitive of meshDef.primitives ) {\n\n\t\t\tif ( primitive.mode !== WEBGL_CONSTANTS.TRIANGLES &&\n\t\t\t\t primitive.mode !== WEBGL_CONSTANTS.TRIANGLE_STRIP &&\n\t\t\t\t primitive.mode !== WEBGL_CONSTANTS.TRIANGLE_FAN &&\n\t\t\t\t primitive.mode !== undefined ) {\n\n\t\t\t\treturn null;\n\n\t\t\t}\n\n\t\t}\n\n\t\tconst extensionDef = nodeDef.extensions[ this.name ];\n\t\tconst attributesDef = extensionDef.attributes;\n\n\t\t// @TODO: Can we support InstancedMesh + SkinnedMesh?\n\n\t\tconst pending = [];\n\t\tconst attributes = {};\n\n\t\tfor ( const key in attributesDef ) {\n\n\t\t\tpending.push( this.parser.getDependency( 'accessor', attributesDef[ key ] ).then( accessor => {\n\n\t\t\t\tattributes[ key ] = accessor;\n\t\t\t\treturn attributes[ key ];\n\n\t\t\t} ) );\n\n\t\t}\n\n\t\tif ( pending.length < 1 ) {\n\n\t\t\treturn null;\n\n\t\t}\n\n\t\tpending.push( this.parser.createNodeMesh( nodeIndex ) );\n\n\t\treturn Promise.all( pending ).then( results => {\n\n\t\t\tconst nodeObject = results.pop();\n\t\t\tconst meshes = nodeObject.isGroup ? nodeObject.children : [ nodeObject ];\n\t\t\tconst count = results[ 0 ].count; // All attribute counts should be same\n\t\t\tconst instancedMeshes = [];\n\n\t\t\tfor ( const mesh of meshes ) {\n\n\t\t\t\t// Temporal variables\n\t\t\t\tconst m = new Matrix4();\n\t\t\t\tconst p = new Vector3();\n\t\t\t\tconst q = new Quaternion();\n\t\t\t\tconst s = new Vector3( 1, 1, 1 );\n\n\t\t\t\tconst instancedMesh = new InstancedMesh( mesh.geometry, mesh.material, count );\n\n\t\t\t\tfor ( let i = 0; i < count; i ++ ) {\n\n\t\t\t\t\tif ( attributes.TRANSLATION ) {\n\n\t\t\t\t\t\tp.fromBufferAttribute( attributes.TRANSLATION, i );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( attributes.ROTATION ) {\n\n\t\t\t\t\t\tq.fromBufferAttribute( attributes.ROTATION, i );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( attributes.SCALE ) {\n\n\t\t\t\t\t\ts.fromBufferAttribute( attributes.SCALE, i );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tinstancedMesh.setMatrixAt( i, m.compose( p, q, s ) );\n\n\t\t\t\t}\n\n\t\t\t\t// Add instance attributes to the geometry, excluding TRS.\n\t\t\t\tfor ( const attributeName in attributes ) {\n\n\t\t\t\t\tif ( attributeName !== 'TRANSLATION' &&\n\t\t\t\t\t\t attributeName !== 'ROTATION' &&\n\t\t\t\t\t\t attributeName !== 'SCALE' ) {\n\n\t\t\t\t\t\tmesh.geometry.setAttribute( attributeName, attributes[ attributeName ] );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\t// Just in case\n\t\t\t\tObject3D.prototype.copy.call( instancedMesh, mesh );\n\n\t\t\t\t// https://github.com/mrdoob/three.js/issues/18334\n\t\t\t\tinstancedMesh.frustumCulled = false;\n\t\t\t\tthis.parser.assignFinalMaterial( instancedMesh );\n\n\t\t\t\tinstancedMeshes.push( instancedMesh );\n\n\t\t\t}\n\n\t\t\tif ( nodeObject.isGroup ) {\n\n\t\t\t\tnodeObject.clear();\n\n\t\t\t\tnodeObject.add( ... instancedMeshes );\n\n\t\t\t\treturn nodeObject;\n\n\t\t\t}\n\n\t\t\treturn instancedMeshes[ 0 ];\n\n\t\t} );\n\n\t}\n\n}\n\n/* BINARY EXTENSION */\nconst BINARY_EXTENSION_HEADER_MAGIC = 'glTF';\nconst BINARY_EXTENSION_HEADER_LENGTH = 12;\nconst BINARY_EXTENSION_CHUNK_TYPES = { JSON: 0x4E4F534A, BIN: 0x004E4942 };\n\nclass GLTFBinaryExtension {\n\n\tconstructor( data ) {\n\n\t\tthis.name = EXTENSIONS.KHR_BINARY_GLTF;\n\t\tthis.content = null;\n\t\tthis.body = null;\n\n\t\tconst headerView = new DataView( data, 0, BINARY_EXTENSION_HEADER_LENGTH );\n\t\tconst textDecoder = new TextDecoder();\n\n\t\tthis.header = {\n\t\t\tmagic: textDecoder.decode( new Uint8Array( data.slice( 0, 4 ) ) ),\n\t\t\tversion: headerView.getUint32( 4, true ),\n\t\t\tlength: headerView.getUint32( 8, true )\n\t\t};\n\n\t\tif ( this.header.magic !== BINARY_EXTENSION_HEADER_MAGIC ) {\n\n\t\t\tthrow new Error( 'THREE.GLTFLoader: Unsupported glTF-Binary header.' );\n\n\t\t} else if ( this.header.version < 2.0 ) {\n\n\t\t\tthrow new Error( 'THREE.GLTFLoader: Legacy binary file detected.' );\n\n\t\t}\n\n\t\tconst chunkContentsLength = this.header.length - BINARY_EXTENSION_HEADER_LENGTH;\n\t\tconst chunkView = new DataView( data, BINARY_EXTENSION_HEADER_LENGTH );\n\t\tlet chunkIndex = 0;\n\n\t\twhile ( chunkIndex < chunkContentsLength ) {\n\n\t\t\tconst chunkLength = chunkView.getUint32( chunkIndex, true );\n\t\t\tchunkIndex += 4;\n\n\t\t\tconst chunkType = chunkView.getUint32( chunkIndex, true );\n\t\t\tchunkIndex += 4;\n\n\t\t\tif ( chunkType === BINARY_EXTENSION_CHUNK_TYPES.JSON ) {\n\n\t\t\t\tconst contentArray = new Uint8Array( data, BINARY_EXTENSION_HEADER_LENGTH + chunkIndex, chunkLength );\n\t\t\t\tthis.content = textDecoder.decode( contentArray );\n\n\t\t\t} else if ( chunkType === BINARY_EXTENSION_CHUNK_TYPES.BIN ) {\n\n\t\t\t\tconst byteOffset = BINARY_EXTENSION_HEADER_LENGTH + chunkIndex;\n\t\t\t\tthis.body = data.slice( byteOffset, byteOffset + chunkLength );\n\n\t\t\t}\n\n\t\t\t// Clients must ignore chunks with unknown types.\n\n\t\t\tchunkIndex += chunkLength;\n\n\t\t}\n\n\t\tif ( this.content === null ) {\n\n\t\t\tthrow new Error( 'THREE.GLTFLoader: JSON content not found.' );\n\n\t\t}\n\n\t}\n\n}\n\n/**\n * DRACO Mesh Compression Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_draco_mesh_compression\n */\nclass GLTFDracoMeshCompressionExtension {\n\n\tconstructor( json, dracoLoader ) {\n\n\t\tif ( ! dracoLoader ) {\n\n\t\t\tthrow new Error( 'THREE.GLTFLoader: No DRACOLoader instance provided.' );\n\n\t\t}\n\n\t\tthis.name = EXTENSIONS.KHR_DRACO_MESH_COMPRESSION;\n\t\tthis.json = json;\n\t\tthis.dracoLoader = dracoLoader;\n\t\tthis.dracoLoader.preload();\n\n\t}\n\n\tdecodePrimitive( primitive, parser ) {\n\n\t\tconst json = this.json;\n\t\tconst dracoLoader = this.dracoLoader;\n\t\tconst bufferViewIndex = primitive.extensions[ this.name ].bufferView;\n\t\tconst gltfAttributeMap = primitive.extensions[ this.name ].attributes;\n\t\tconst threeAttributeMap = {};\n\t\tconst attributeNormalizedMap = {};\n\t\tconst attributeTypeMap = {};\n\n\t\tfor ( const attributeName in gltfAttributeMap ) {\n\n\t\t\tconst threeAttributeName = ATTRIBUTES[ attributeName ] || attributeName.toLowerCase();\n\n\t\t\tthreeAttributeMap[ threeAttributeName ] = gltfAttributeMap[ attributeName ];\n\n\t\t}\n\n\t\tfor ( const attributeName in primitive.attributes ) {\n\n\t\t\tconst threeAttributeName = ATTRIBUTES[ attributeName ] || attributeName.toLowerCase();\n\n\t\t\tif ( gltfAttributeMap[ attributeName ] !== undefined ) {\n\n\t\t\t\tconst accessorDef = json.accessors[ primitive.attributes[ attributeName ] ];\n\t\t\t\tconst componentType = WEBGL_COMPONENT_TYPES[ accessorDef.componentType ];\n\n\t\t\t\tattributeTypeMap[ threeAttributeName ] = componentType.name;\n\t\t\t\tattributeNormalizedMap[ threeAttributeName ] = accessorDef.normalized === true;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn parser.getDependency( 'bufferView', bufferViewIndex ).then( function ( bufferView ) {\n\n\t\t\treturn new Promise( function ( resolve ) {\n\n\t\t\t\tdracoLoader.decodeDracoFile( bufferView, function ( geometry ) {\n\n\t\t\t\t\tfor ( const attributeName in geometry.attributes ) {\n\n\t\t\t\t\t\tconst attribute = geometry.attributes[ attributeName ];\n\t\t\t\t\t\tconst normalized = attributeNormalizedMap[ attributeName ];\n\n\t\t\t\t\t\tif ( normalized !== undefined ) attribute.normalized = normalized;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tresolve( geometry );\n\n\t\t\t\t}, threeAttributeMap, attributeTypeMap );\n\n\t\t\t} );\n\n\t\t} );\n\n\t}\n\n}\n\n/**\n * Texture Transform Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_texture_transform\n */\nclass GLTFTextureTransformExtension {\n\n\tconstructor() {\n\n\t\tthis.name = EXTENSIONS.KHR_TEXTURE_TRANSFORM;\n\n\t}\n\n\textendTexture( texture, transform ) {\n\n\t\tif ( transform.texCoord !== undefined ) {\n\n\t\t\tconsole.warn( 'THREE.GLTFLoader: Custom UV sets in \"' + this.name + '\" extension not yet supported.' );\n\n\t\t}\n\n\t\tif ( transform.offset === undefined && transform.rotation === undefined && transform.scale === undefined ) {\n\n\t\t\t// See https://github.com/mrdoob/three.js/issues/21819.\n\t\t\treturn texture;\n\n\t\t}\n\n\t\ttexture = texture.clone();\n\n\t\tif ( transform.offset !== undefined ) {\n\n\t\t\ttexture.offset.fromArray( transform.offset );\n\n\t\t}\n\n\t\tif ( transform.rotation !== undefined ) {\n\n\t\t\ttexture.rotation = transform.rotation;\n\n\t\t}\n\n\t\tif ( transform.scale !== undefined ) {\n\n\t\t\ttexture.repeat.fromArray( transform.scale );\n\n\t\t}\n\n\t\ttexture.needsUpdate = true;\n\n\t\treturn texture;\n\n\t}\n\n}\n\n/**\n * Mesh Quantization Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_mesh_quantization\n */\nclass GLTFMeshQuantizationExtension {\n\n\tconstructor() {\n\n\t\tthis.name = EXTENSIONS.KHR_MESH_QUANTIZATION;\n\n\t}\n\n}\n\n/*********************************/\n/********** INTERPOLATION ********/\n/*********************************/\n\n// Spline Interpolation\n// Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#appendix-c-spline-interpolation\nclass GLTFCubicSplineInterpolant extends Interpolant {\n\n\tconstructor( parameterPositions, sampleValues, sampleSize, resultBuffer ) {\n\n\t\tsuper( parameterPositions, sampleValues, sampleSize, resultBuffer );\n\n\t}\n\n\tcopySampleValue_( index ) {\n\n\t\t// Copies a sample value to the result buffer. See description of glTF\n\t\t// CUBICSPLINE values layout in interpolate_() function below.\n\n\t\tconst result = this.resultBuffer,\n\t\t\tvalues = this.sampleValues,\n\t\t\tvalueSize = this.valueSize,\n\t\t\toffset = index * valueSize * 3 + valueSize;\n\n\t\tfor ( let i = 0; i !== valueSize; i ++ ) {\n\n\t\t\tresult[ i ] = values[ offset + i ];\n\n\t\t}\n\n\t\treturn result;\n\n\t}\n\n\tinterpolate_( i1, t0, t, t1 ) {\n\n\t\tconst result = this.resultBuffer;\n\t\tconst values = this.sampleValues;\n\t\tconst stride = this.valueSize;\n\n\t\tconst stride2 = stride * 2;\n\t\tconst stride3 = stride * 3;\n\n\t\tconst td = t1 - t0;\n\n\t\tconst p = ( t - t0 ) / td;\n\t\tconst pp = p * p;\n\t\tconst ppp = pp * p;\n\n\t\tconst offset1 = i1 * stride3;\n\t\tconst offset0 = offset1 - stride3;\n\n\t\tconst s2 = - 2 * ppp + 3 * pp;\n\t\tconst s3 = ppp - pp;\n\t\tconst s0 = 1 - s2;\n\t\tconst s1 = s3 - pp + p;\n\n\t\t// Layout of keyframe output values for CUBICSPLINE animations:\n\t\t//   [ inTangent_1, splineVertex_1, outTangent_1, inTangent_2, splineVertex_2, ... ]\n\t\tfor ( let i = 0; i !== stride; i ++ ) {\n\n\t\t\tconst p0 = values[ offset0 + i + stride ]; // splineVertex_k\n\t\t\tconst m0 = values[ offset0 + i + stride2 ] * td; // outTangent_k * (t_k+1 - t_k)\n\t\t\tconst p1 = values[ offset1 + i + stride ]; // splineVertex_k+1\n\t\t\tconst m1 = values[ offset1 + i ] * td; // inTangent_k+1 * (t_k+1 - t_k)\n\n\t\t\tresult[ i ] = s0 * p0 + s1 * m0 + s2 * p1 + s3 * m1;\n\n\t\t}\n\n\t\treturn result;\n\n\t}\n\n}\n\nconst _q = new Quaternion();\n\nclass GLTFCubicSplineQuaternionInterpolant extends GLTFCubicSplineInterpolant {\n\n\tinterpolate_( i1, t0, t, t1 ) {\n\n\t\tconst result = super.interpolate_( i1, t0, t, t1 );\n\n\t\t_q.fromArray( result ).normalize().toArray( result );\n\n\t\treturn result;\n\n\t}\n\n}\n\n\n/*********************************/\n/********** INTERNALS ************/\n/*********************************/\n\n/* CONSTANTS */\n\nconst WEBGL_CONSTANTS = {\n\tFLOAT: 5126,\n\t//FLOAT_MAT2: 35674,\n\tFLOAT_MAT3: 35675,\n\tFLOAT_MAT4: 35676,\n\tFLOAT_VEC2: 35664,\n\tFLOAT_VEC3: 35665,\n\tFLOAT_VEC4: 35666,\n\tLINEAR: 9729,\n\tREPEAT: 10497,\n\tSAMPLER_2D: 35678,\n\tPOINTS: 0,\n\tLINES: 1,\n\tLINE_LOOP: 2,\n\tLINE_STRIP: 3,\n\tTRIANGLES: 4,\n\tTRIANGLE_STRIP: 5,\n\tTRIANGLE_FAN: 6,\n\tUNSIGNED_BYTE: 5121,\n\tUNSIGNED_SHORT: 5123\n};\n\nconst WEBGL_COMPONENT_TYPES = {\n\t5120: Int8Array,\n\t5121: Uint8Array,\n\t5122: Int16Array,\n\t5123: Uint16Array,\n\t5125: Uint32Array,\n\t5126: Float32Array\n};\n\nconst WEBGL_FILTERS = {\n\t9728: NearestFilter,\n\t9729: LinearFilter,\n\t9984: NearestMipmapNearestFilter,\n\t9985: LinearMipmapNearestFilter,\n\t9986: NearestMipmapLinearFilter,\n\t9987: LinearMipmapLinearFilter\n};\n\nconst WEBGL_WRAPPINGS = {\n\t33071: ClampToEdgeWrapping,\n\t33648: MirroredRepeatWrapping,\n\t10497: RepeatWrapping\n};\n\nconst WEBGL_TYPE_SIZES = {\n\t'SCALAR': 1,\n\t'VEC2': 2,\n\t'VEC3': 3,\n\t'VEC4': 4,\n\t'MAT2': 4,\n\t'MAT3': 9,\n\t'MAT4': 16\n};\n\nconst ATTRIBUTES = {\n\tPOSITION: 'position',\n\tNORMAL: 'normal',\n\tTANGENT: 'tangent',\n\tTEXCOORD_0: 'uv',\n\tTEXCOORD_1: 'uv2',\n\tCOLOR_0: 'color',\n\tWEIGHTS_0: 'skinWeight',\n\tJOINTS_0: 'skinIndex',\n};\n\nconst PATH_PROPERTIES = {\n\tscale: 'scale',\n\ttranslation: 'position',\n\trotation: 'quaternion',\n\tweights: 'morphTargetInfluences'\n};\n\nconst INTERPOLATION = {\n\tCUBICSPLINE: undefined, // We use a custom interpolant (GLTFCubicSplineInterpolation) for CUBICSPLINE tracks. Each\n\t\t                        // keyframe track will be initialized with a default interpolation type, then modified.\n\tLINEAR: InterpolateLinear,\n\tSTEP: InterpolateDiscrete\n};\n\nconst ALPHA_MODES = {\n\tOPAQUE: 'OPAQUE',\n\tMASK: 'MASK',\n\tBLEND: 'BLEND'\n};\n\n/**\n * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#default-material\n */\nfunction createDefaultMaterial( cache ) {\n\n\tif ( cache[ 'DefaultMaterial' ] === undefined ) {\n\n\t\tcache[ 'DefaultMaterial' ] = new MeshStandardMaterial( {\n\t\t\tcolor: 0xFFFFFF,\n\t\t\temissive: 0x000000,\n\t\t\tmetalness: 1,\n\t\t\troughness: 1,\n\t\t\ttransparent: false,\n\t\t\tdepthTest: true,\n\t\t\tside: FrontSide\n\t\t} );\n\n\t}\n\n\treturn cache[ 'DefaultMaterial' ];\n\n}\n\nfunction addUnknownExtensionsToUserData( knownExtensions, object, objectDef ) {\n\n\t// Add unknown glTF extensions to an object's userData.\n\n\tfor ( const name in objectDef.extensions ) {\n\n\t\tif ( knownExtensions[ name ] === undefined ) {\n\n\t\t\tobject.userData.gltfExtensions = object.userData.gltfExtensions || {};\n\t\t\tobject.userData.gltfExtensions[ name ] = objectDef.extensions[ name ];\n\n\t\t}\n\n\t}\n\n}\n\n/**\n * @param {Object3D|Material|BufferGeometry} object\n * @param {GLTF.definition} gltfDef\n */\nfunction assignExtrasToUserData( object, gltfDef ) {\n\n\tif ( gltfDef.extras !== undefined ) {\n\n\t\tif ( typeof gltfDef.extras === 'object' ) {\n\n\t\t\tObject.assign( object.userData, gltfDef.extras );\n\n\t\t} else {\n\n\t\t\tconsole.warn( 'THREE.GLTFLoader: Ignoring primitive type .extras, ' + gltfDef.extras );\n\n\t\t}\n\n\t}\n\n}\n\n/**\n * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#morph-targets\n *\n * @param {BufferGeometry} geometry\n * @param {Array<GLTF.Target>} targets\n * @param {GLTFParser} parser\n * @return {Promise<BufferGeometry>}\n */\nfunction addMorphTargets( geometry, targets, parser ) {\n\n\tlet hasMorphPosition = false;\n\tlet hasMorphNormal = false;\n\tlet hasMorphColor = false;\n\n\tfor ( let i = 0, il = targets.length; i < il; i ++ ) {\n\n\t\tconst target = targets[ i ];\n\n\t\tif ( target.POSITION !== undefined ) hasMorphPosition = true;\n\t\tif ( target.NORMAL !== undefined ) hasMorphNormal = true;\n\t\tif ( target.COLOR_0 !== undefined ) hasMorphColor = true;\n\n\t\tif ( hasMorphPosition && hasMorphNormal && hasMorphColor ) break;\n\n\t}\n\n\tif ( ! hasMorphPosition && ! hasMorphNormal && ! hasMorphColor ) return Promise.resolve( geometry );\n\n\tconst pendingPositionAccessors = [];\n\tconst pendingNormalAccessors = [];\n\tconst pendingColorAccessors = [];\n\n\tfor ( let i = 0, il = targets.length; i < il; i ++ ) {\n\n\t\tconst target = targets[ i ];\n\n\t\tif ( hasMorphPosition ) {\n\n\t\t\tconst pendingAccessor = target.POSITION !== undefined\n\t\t\t\t? parser.getDependency( 'accessor', target.POSITION )\n\t\t\t\t: geometry.attributes.position;\n\n\t\t\tpendingPositionAccessors.push( pendingAccessor );\n\n\t\t}\n\n\t\tif ( hasMorphNormal ) {\n\n\t\t\tconst pendingAccessor = target.NORMAL !== undefined\n\t\t\t\t? parser.getDependency( 'accessor', target.NORMAL )\n\t\t\t\t: geometry.attributes.normal;\n\n\t\t\tpendingNormalAccessors.push( pendingAccessor );\n\n\t\t}\n\n\t\tif ( hasMorphColor ) {\n\n\t\t\tconst pendingAccessor = target.COLOR_0 !== undefined\n\t\t\t\t? parser.getDependency( 'accessor', target.COLOR_0 )\n\t\t\t\t: geometry.attributes.color;\n\n\t\t\tpendingColorAccessors.push( pendingAccessor );\n\n\t\t}\n\n\t}\n\n\treturn Promise.all( [\n\t\tPromise.all( pendingPositionAccessors ),\n\t\tPromise.all( pendingNormalAccessors ),\n\t\tPromise.all( pendingColorAccessors )\n\t] ).then( function ( accessors ) {\n\n\t\tconst morphPositions = accessors[ 0 ];\n\t\tconst morphNormals = accessors[ 1 ];\n\t\tconst morphColors = accessors[ 2 ];\n\n\t\tif ( hasMorphPosition ) geometry.morphAttributes.position = morphPositions;\n\t\tif ( hasMorphNormal ) geometry.morphAttributes.normal = morphNormals;\n\t\tif ( hasMorphColor ) geometry.morphAttributes.color = morphColors;\n\t\tgeometry.morphTargetsRelative = true;\n\n\t\treturn geometry;\n\n\t} );\n\n}\n\n/**\n * @param {Mesh} mesh\n * @param {GLTF.Mesh} meshDef\n */\nfunction updateMorphTargets( mesh, meshDef ) {\n\n\tmesh.updateMorphTargets();\n\n\tif ( meshDef.weights !== undefined ) {\n\n\t\tfor ( let i = 0, il = meshDef.weights.length; i < il; i ++ ) {\n\n\t\t\tmesh.morphTargetInfluences[ i ] = meshDef.weights[ i ];\n\n\t\t}\n\n\t}\n\n\t// .extras has user-defined data, so check that .extras.targetNames is an array.\n\tif ( meshDef.extras && Array.isArray( meshDef.extras.targetNames ) ) {\n\n\t\tconst targetNames = meshDef.extras.targetNames;\n\n\t\tif ( mesh.morphTargetInfluences.length === targetNames.length ) {\n\n\t\t\tmesh.morphTargetDictionary = {};\n\n\t\t\tfor ( let i = 0, il = targetNames.length; i < il; i ++ ) {\n\n\t\t\t\tmesh.morphTargetDictionary[ targetNames[ i ] ] = i;\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tconsole.warn( 'THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.' );\n\n\t\t}\n\n\t}\n\n}\n\nfunction createPrimitiveKey( primitiveDef ) {\n\n\tconst dracoExtension = primitiveDef.extensions && primitiveDef.extensions[ EXTENSIONS.KHR_DRACO_MESH_COMPRESSION ];\n\tlet geometryKey;\n\n\tif ( dracoExtension ) {\n\n\t\tgeometryKey = 'draco:' + dracoExtension.bufferView\n\t\t\t\t+ ':' + dracoExtension.indices\n\t\t\t\t+ ':' + createAttributesKey( dracoExtension.attributes );\n\n\t} else {\n\n\t\tgeometryKey = primitiveDef.indices + ':' + createAttributesKey( primitiveDef.attributes ) + ':' + primitiveDef.mode;\n\n\t}\n\n\treturn geometryKey;\n\n}\n\nfunction createAttributesKey( attributes ) {\n\n\tlet attributesKey = '';\n\n\tconst keys = Object.keys( attributes ).sort();\n\n\tfor ( let i = 0, il = keys.length; i < il; i ++ ) {\n\n\t\tattributesKey += keys[ i ] + ':' + attributes[ keys[ i ] ] + ';';\n\n\t}\n\n\treturn attributesKey;\n\n}\n\nfunction getNormalizedComponentScale( constructor ) {\n\n\t// Reference:\n\t// https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_mesh_quantization#encoding-quantized-data\n\n\tswitch ( constructor ) {\n\n\t\tcase Int8Array:\n\t\t\treturn 1 / 127;\n\n\t\tcase Uint8Array:\n\t\t\treturn 1 / 255;\n\n\t\tcase Int16Array:\n\t\t\treturn 1 / 32767;\n\n\t\tcase Uint16Array:\n\t\t\treturn 1 / 65535;\n\n\t\tdefault:\n\t\t\tthrow new Error( 'THREE.GLTFLoader: Unsupported normalized accessor component type.' );\n\n\t}\n\n}\n\nfunction getImageURIMimeType( uri ) {\n\n\tif ( uri.search( /\\.jpe?g($|\\?)/i ) > 0 || uri.search( /^data\\:image\\/jpeg/ ) === 0 ) return 'image/jpeg';\n\tif ( uri.search( /\\.webp($|\\?)/i ) > 0 || uri.search( /^data\\:image\\/webp/ ) === 0 ) return 'image/webp';\n\n\treturn 'image/png';\n\n}\n\nconst _identityMatrix = new Matrix4();\n\n/* GLTF PARSER */\n\nclass GLTFParser {\n\n\tconstructor( json = {}, options = {} ) {\n\n\t\tthis.json = json;\n\t\tthis.extensions = {};\n\t\tthis.plugins = {};\n\t\tthis.options = options;\n\n\t\t// loader object cache\n\t\tthis.cache = new GLTFRegistry();\n\n\t\t// associations between Three.js objects and glTF elements\n\t\tthis.associations = new Map();\n\n\t\t// BufferGeometry caching\n\t\tthis.primitiveCache = {};\n\n\t\t// Object3D instance caches\n\t\tthis.meshCache = { refs: {}, uses: {} };\n\t\tthis.cameraCache = { refs: {}, uses: {} };\n\t\tthis.lightCache = { refs: {}, uses: {} };\n\n\t\tthis.sourceCache = {};\n\t\tthis.textureCache = {};\n\n\t\t// Track node names, to ensure no duplicates\n\t\tthis.nodeNamesUsed = {};\n\n\t\t// Use an ImageBitmapLoader if imageBitmaps are supported. Moves much of the\n\t\t// expensive work of uploading a texture to the GPU off the main thread.\n\n\t\tlet isSafari = false;\n\t\tlet isFirefox = false;\n\t\tlet firefoxVersion = - 1;\n\n\t\tif ( typeof navigator !== 'undefined' ) {\n\n\t\t\tisSafari = /^((?!chrome|android).)*safari/i.test( navigator.userAgent ) === true;\n\t\t\tisFirefox = navigator.userAgent.indexOf( 'Firefox' ) > - 1;\n\t\t\tfirefoxVersion = isFirefox ? navigator.userAgent.match( /Firefox\\/([0-9]+)\\./ )[ 1 ] : - 1;\n\n\t\t}\n\n\t\tif ( typeof createImageBitmap === 'undefined' || isSafari || ( isFirefox && firefoxVersion < 98 ) ) {\n\n\t\t\tthis.textureLoader = new TextureLoader( this.options.manager );\n\n\t\t} else {\n\n\t\t\tthis.textureLoader = new ImageBitmapLoader( this.options.manager );\n\n\t\t}\n\n\t\tthis.textureLoader.setCrossOrigin( this.options.crossOrigin );\n\t\tthis.textureLoader.setRequestHeader( this.options.requestHeader );\n\n\t\tthis.fileLoader = new FileLoader( this.options.manager );\n\t\tthis.fileLoader.setResponseType( 'arraybuffer' );\n\n\t\tif ( this.options.crossOrigin === 'use-credentials' ) {\n\n\t\t\tthis.fileLoader.setWithCredentials( true );\n\n\t\t}\n\n\t}\n\n\tsetExtensions( extensions ) {\n\n\t\tthis.extensions = extensions;\n\n\t}\n\n\tsetPlugins( plugins ) {\n\n\t\tthis.plugins = plugins;\n\n\t}\n\n\tparse( onLoad, onError ) {\n\n\t\tconst parser = this;\n\t\tconst json = this.json;\n\t\tconst extensions = this.extensions;\n\n\t\t// Clear the loader cache\n\t\tthis.cache.removeAll();\n\n\t\t// Mark the special nodes/meshes in json for efficient parse\n\t\tthis._invokeAll( function ( ext ) {\n\n\t\t\treturn ext._markDefs && ext._markDefs();\n\n\t\t} );\n\n\t\tPromise.all( this._invokeAll( function ( ext ) {\n\n\t\t\treturn ext.beforeRoot && ext.beforeRoot();\n\n\t\t} ) ).then( function () {\n\n\t\t\treturn Promise.all( [\n\n\t\t\t\tparser.getDependencies( 'scene' ),\n\t\t\t\tparser.getDependencies( 'animation' ),\n\t\t\t\tparser.getDependencies( 'camera' ),\n\n\t\t\t] );\n\n\t\t} ).then( function ( dependencies ) {\n\n\t\t\tconst result = {\n\t\t\t\tscene: dependencies[ 0 ][ json.scene || 0 ],\n\t\t\t\tscenes: dependencies[ 0 ],\n\t\t\t\tanimations: dependencies[ 1 ],\n\t\t\t\tcameras: dependencies[ 2 ],\n\t\t\t\tasset: json.asset,\n\t\t\t\tparser: parser,\n\t\t\t\tuserData: {}\n\t\t\t};\n\n\t\t\taddUnknownExtensionsToUserData( extensions, result, json );\n\n\t\t\tassignExtrasToUserData( result, json );\n\n\t\t\tPromise.all( parser._invokeAll( function ( ext ) {\n\n\t\t\t\treturn ext.afterRoot && ext.afterRoot( result );\n\n\t\t\t} ) ).then( function () {\n\n\t\t\t\tonLoad( result );\n\n\t\t\t} );\n\n\t\t} ).catch( onError );\n\n\t}\n\n\t/**\n\t * Marks the special nodes/meshes in json for efficient parse.\n\t */\n\t_markDefs() {\n\n\t\tconst nodeDefs = this.json.nodes || [];\n\t\tconst skinDefs = this.json.skins || [];\n\t\tconst meshDefs = this.json.meshes || [];\n\n\t\t// Nothing in the node definition indicates whether it is a Bone or an\n\t\t// Object3D. Use the skins' joint references to mark bones.\n\t\tfor ( let skinIndex = 0, skinLength = skinDefs.length; skinIndex < skinLength; skinIndex ++ ) {\n\n\t\t\tconst joints = skinDefs[ skinIndex ].joints;\n\n\t\t\tfor ( let i = 0, il = joints.length; i < il; i ++ ) {\n\n\t\t\t\tnodeDefs[ joints[ i ] ].isBone = true;\n\n\t\t\t}\n\n\t\t}\n\n\t\t// Iterate over all nodes, marking references to shared resources,\n\t\t// as well as skeleton joints.\n\t\tfor ( let nodeIndex = 0, nodeLength = nodeDefs.length; nodeIndex < nodeLength; nodeIndex ++ ) {\n\n\t\t\tconst nodeDef = nodeDefs[ nodeIndex ];\n\n\t\t\tif ( nodeDef.mesh !== undefined ) {\n\n\t\t\t\tthis._addNodeRef( this.meshCache, nodeDef.mesh );\n\n\t\t\t\t// Nothing in the mesh definition indicates whether it is\n\t\t\t\t// a SkinnedMesh or Mesh. Use the node's mesh reference\n\t\t\t\t// to mark SkinnedMesh if node has skin.\n\t\t\t\tif ( nodeDef.skin !== undefined ) {\n\n\t\t\t\t\tmeshDefs[ nodeDef.mesh ].isSkinnedMesh = true;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( nodeDef.camera !== undefined ) {\n\n\t\t\t\tthis._addNodeRef( this.cameraCache, nodeDef.camera );\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\t/**\n\t * Counts references to shared node / Object3D resources. These resources\n\t * can be reused, or \"instantiated\", at multiple nodes in the scene\n\t * hierarchy. Mesh, Camera, and Light instances are instantiated and must\n\t * be marked. Non-scenegraph resources (like Materials, Geometries, and\n\t * Textures) can be reused directly and are not marked here.\n\t *\n\t * Example: CesiumMilkTruck sample model reuses \"Wheel\" meshes.\n\t */\n\t_addNodeRef( cache, index ) {\n\n\t\tif ( index === undefined ) return;\n\n\t\tif ( cache.refs[ index ] === undefined ) {\n\n\t\t\tcache.refs[ index ] = cache.uses[ index ] = 0;\n\n\t\t}\n\n\t\tcache.refs[ index ] ++;\n\n\t}\n\n\t/** Returns a reference to a shared resource, cloning it if necessary. */\n\t_getNodeRef( cache, index, object ) {\n\n\t\tif ( cache.refs[ index ] <= 1 ) return object;\n\n\t\tconst ref = object.clone();\n\n\t\t// Propagates mappings to the cloned object, prevents mappings on the\n\t\t// original object from being lost.\n\t\tconst updateMappings = ( original, clone ) => {\n\n\t\t\tconst mappings = this.associations.get( original );\n\t\t\tif ( mappings != null ) {\n\n\t\t\t\tthis.associations.set( clone, mappings );\n\n\t\t\t}\n\n\t\t\tfor ( const [ i, child ] of original.children.entries() ) {\n\n\t\t\t\tupdateMappings( child, clone.children[ i ] );\n\n\t\t\t}\n\n\t\t};\n\n\t\tupdateMappings( object, ref );\n\n\t\tref.name += '_instance_' + ( cache.uses[ index ] ++ );\n\n\t\treturn ref;\n\n\t}\n\n\t_invokeOne( func ) {\n\n\t\tconst extensions = Object.values( this.plugins );\n\t\textensions.push( this );\n\n\t\tfor ( let i = 0; i < extensions.length; i ++ ) {\n\n\t\t\tconst result = func( extensions[ i ] );\n\n\t\t\tif ( result ) return result;\n\n\t\t}\n\n\t\treturn null;\n\n\t}\n\n\t_invokeAll( func ) {\n\n\t\tconst extensions = Object.values( this.plugins );\n\t\textensions.unshift( this );\n\n\t\tconst pending = [];\n\n\t\tfor ( let i = 0; i < extensions.length; i ++ ) {\n\n\t\t\tconst result = func( extensions[ i ] );\n\n\t\t\tif ( result ) pending.push( result );\n\n\t\t}\n\n\t\treturn pending;\n\n\t}\n\n\t/**\n\t * Requests the specified dependency asynchronously, with caching.\n\t * @param {string} type\n\t * @param {number} index\n\t * @return {Promise<Object3D|Material|THREE.Texture|AnimationClip|ArrayBuffer|Object>}\n\t */\n\tgetDependency( type, index ) {\n\n\t\tconst cacheKey = type + ':' + index;\n\t\tlet dependency = this.cache.get( cacheKey );\n\n\t\tif ( ! dependency ) {\n\n\t\t\tswitch ( type ) {\n\n\t\t\t\tcase 'scene':\n\t\t\t\t\tdependency = this.loadScene( index );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'node':\n\t\t\t\t\tdependency = this._invokeOne( function ( ext ) {\n\n\t\t\t\t\t\treturn ext.loadNode && ext.loadNode( index );\n\n\t\t\t\t\t} );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'mesh':\n\t\t\t\t\tdependency = this._invokeOne( function ( ext ) {\n\n\t\t\t\t\t\treturn ext.loadMesh && ext.loadMesh( index );\n\n\t\t\t\t\t} );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'accessor':\n\t\t\t\t\tdependency = this.loadAccessor( index );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'bufferView':\n\t\t\t\t\tdependency = this._invokeOne( function ( ext ) {\n\n\t\t\t\t\t\treturn ext.loadBufferView && ext.loadBufferView( index );\n\n\t\t\t\t\t} );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'buffer':\n\t\t\t\t\tdependency = this.loadBuffer( index );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'material':\n\t\t\t\t\tdependency = this._invokeOne( function ( ext ) {\n\n\t\t\t\t\t\treturn ext.loadMaterial && ext.loadMaterial( index );\n\n\t\t\t\t\t} );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'texture':\n\t\t\t\t\tdependency = this._invokeOne( function ( ext ) {\n\n\t\t\t\t\t\treturn ext.loadTexture && ext.loadTexture( index );\n\n\t\t\t\t\t} );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'skin':\n\t\t\t\t\tdependency = this.loadSkin( index );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'animation':\n\t\t\t\t\tdependency = this._invokeOne( function ( ext ) {\n\n\t\t\t\t\t\treturn ext.loadAnimation && ext.loadAnimation( index );\n\n\t\t\t\t\t} );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'camera':\n\t\t\t\t\tdependency = this.loadCamera( index );\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tdependency = this._invokeOne( function ( ext ) {\n\n\t\t\t\t\t\treturn ext != this && ext.getDependency && ext.getDependency( type, index );\n\n\t\t\t\t\t} );\n\n\t\t\t\t\tif ( ! dependency ) {\n\n\t\t\t\t\t\tthrow new Error( 'Unknown type: ' + type );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t\tthis.cache.add( cacheKey, dependency );\n\n\t\t}\n\n\t\treturn dependency;\n\n\t}\n\n\t/**\n\t * Requests all dependencies of the specified type asynchronously, with caching.\n\t * @param {string} type\n\t * @return {Promise<Array<Object>>}\n\t */\n\tgetDependencies( type ) {\n\n\t\tlet dependencies = this.cache.get( type );\n\n\t\tif ( ! dependencies ) {\n\n\t\t\tconst parser = this;\n\t\t\tconst defs = this.json[ type + ( type === 'mesh' ? 'es' : 's' ) ] || [];\n\n\t\t\tdependencies = Promise.all( defs.map( function ( def, index ) {\n\n\t\t\t\treturn parser.getDependency( type, index );\n\n\t\t\t} ) );\n\n\t\t\tthis.cache.add( type, dependencies );\n\n\t\t}\n\n\t\treturn dependencies;\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#buffers-and-buffer-views\n\t * @param {number} bufferIndex\n\t * @return {Promise<ArrayBuffer>}\n\t */\n\tloadBuffer( bufferIndex ) {\n\n\t\tconst bufferDef = this.json.buffers[ bufferIndex ];\n\t\tconst loader = this.fileLoader;\n\n\t\tif ( bufferDef.type && bufferDef.type !== 'arraybuffer' ) {\n\n\t\t\tthrow new Error( 'THREE.GLTFLoader: ' + bufferDef.type + ' buffer type is not supported.' );\n\n\t\t}\n\n\t\t// If present, GLB container is required to be the first buffer.\n\t\tif ( bufferDef.uri === undefined && bufferIndex === 0 ) {\n\n\t\t\treturn Promise.resolve( this.extensions[ EXTENSIONS.KHR_BINARY_GLTF ].body );\n\n\t\t}\n\n\t\tconst options = this.options;\n\n\t\treturn new Promise( function ( resolve, reject ) {\n\n\t\t\tloader.load( LoaderUtils.resolveURL( bufferDef.uri, options.path ), resolve, undefined, function () {\n\n\t\t\t\treject( new Error( 'THREE.GLTFLoader: Failed to load buffer \"' + bufferDef.uri + '\".' ) );\n\n\t\t\t} );\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#buffers-and-buffer-views\n\t * @param {number} bufferViewIndex\n\t * @return {Promise<ArrayBuffer>}\n\t */\n\tloadBufferView( bufferViewIndex ) {\n\n\t\tconst bufferViewDef = this.json.bufferViews[ bufferViewIndex ];\n\n\t\treturn this.getDependency( 'buffer', bufferViewDef.buffer ).then( function ( buffer ) {\n\n\t\t\tconst byteLength = bufferViewDef.byteLength || 0;\n\t\t\tconst byteOffset = bufferViewDef.byteOffset || 0;\n\t\t\treturn buffer.slice( byteOffset, byteOffset + byteLength );\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#accessors\n\t * @param {number} accessorIndex\n\t * @return {Promise<BufferAttribute|InterleavedBufferAttribute>}\n\t */\n\tloadAccessor( accessorIndex ) {\n\n\t\tconst parser = this;\n\t\tconst json = this.json;\n\n\t\tconst accessorDef = this.json.accessors[ accessorIndex ];\n\n\t\tif ( accessorDef.bufferView === undefined && accessorDef.sparse === undefined ) {\n\n\t\t\tconst itemSize = WEBGL_TYPE_SIZES[ accessorDef.type ];\n\t\t\tconst TypedArray = WEBGL_COMPONENT_TYPES[ accessorDef.componentType ];\n\t\t\tconst normalized = accessorDef.normalized === true;\n\n\t\t\tconst array = new TypedArray( accessorDef.count * itemSize );\n\t\t\treturn Promise.resolve( new BufferAttribute( array, itemSize, normalized ) );\n\n\t\t}\n\n\t\tconst pendingBufferViews = [];\n\n\t\tif ( accessorDef.bufferView !== undefined ) {\n\n\t\t\tpendingBufferViews.push( this.getDependency( 'bufferView', accessorDef.bufferView ) );\n\n\t\t} else {\n\n\t\t\tpendingBufferViews.push( null );\n\n\t\t}\n\n\t\tif ( accessorDef.sparse !== undefined ) {\n\n\t\t\tpendingBufferViews.push( this.getDependency( 'bufferView', accessorDef.sparse.indices.bufferView ) );\n\t\t\tpendingBufferViews.push( this.getDependency( 'bufferView', accessorDef.sparse.values.bufferView ) );\n\n\t\t}\n\n\t\treturn Promise.all( pendingBufferViews ).then( function ( bufferViews ) {\n\n\t\t\tconst bufferView = bufferViews[ 0 ];\n\n\t\t\tconst itemSize = WEBGL_TYPE_SIZES[ accessorDef.type ];\n\t\t\tconst TypedArray = WEBGL_COMPONENT_TYPES[ accessorDef.componentType ];\n\n\t\t\t// For VEC3: itemSize is 3, elementBytes is 4, itemBytes is 12.\n\t\t\tconst elementBytes = TypedArray.BYTES_PER_ELEMENT;\n\t\t\tconst itemBytes = elementBytes * itemSize;\n\t\t\tconst byteOffset = accessorDef.byteOffset || 0;\n\t\t\tconst byteStride = accessorDef.bufferView !== undefined ? json.bufferViews[ accessorDef.bufferView ].byteStride : undefined;\n\t\t\tconst normalized = accessorDef.normalized === true;\n\t\t\tlet array, bufferAttribute;\n\n\t\t\t// The buffer is not interleaved if the stride is the item size in bytes.\n\t\t\tif ( byteStride && byteStride !== itemBytes ) {\n\n\t\t\t\t// Each \"slice\" of the buffer, as defined by 'count' elements of 'byteStride' bytes, gets its own InterleavedBuffer\n\t\t\t\t// This makes sure that IBA.count reflects accessor.count properly\n\t\t\t\tconst ibSlice = Math.floor( byteOffset / byteStride );\n\t\t\t\tconst ibCacheKey = 'InterleavedBuffer:' + accessorDef.bufferView + ':' + accessorDef.componentType + ':' + ibSlice + ':' + accessorDef.count;\n\t\t\t\tlet ib = parser.cache.get( ibCacheKey );\n\n\t\t\t\tif ( ! ib ) {\n\n\t\t\t\t\tarray = new TypedArray( bufferView, ibSlice * byteStride, accessorDef.count * byteStride / elementBytes );\n\n\t\t\t\t\t// Integer parameters to IB/IBA are in array elements, not bytes.\n\t\t\t\t\tib = new InterleavedBuffer( array, byteStride / elementBytes );\n\n\t\t\t\t\tparser.cache.add( ibCacheKey, ib );\n\n\t\t\t\t}\n\n\t\t\t\tbufferAttribute = new InterleavedBufferAttribute( ib, itemSize, ( byteOffset % byteStride ) / elementBytes, normalized );\n\n\t\t\t} else {\n\n\t\t\t\tif ( bufferView === null ) {\n\n\t\t\t\t\tarray = new TypedArray( accessorDef.count * itemSize );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tarray = new TypedArray( bufferView, byteOffset, accessorDef.count * itemSize );\n\n\t\t\t\t}\n\n\t\t\t\tbufferAttribute = new BufferAttribute( array, itemSize, normalized );\n\n\t\t\t}\n\n\t\t\t// https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#sparse-accessors\n\t\t\tif ( accessorDef.sparse !== undefined ) {\n\n\t\t\t\tconst itemSizeIndices = WEBGL_TYPE_SIZES.SCALAR;\n\t\t\t\tconst TypedArrayIndices = WEBGL_COMPONENT_TYPES[ accessorDef.sparse.indices.componentType ];\n\n\t\t\t\tconst byteOffsetIndices = accessorDef.sparse.indices.byteOffset || 0;\n\t\t\t\tconst byteOffsetValues = accessorDef.sparse.values.byteOffset || 0;\n\n\t\t\t\tconst sparseIndices = new TypedArrayIndices( bufferViews[ 1 ], byteOffsetIndices, accessorDef.sparse.count * itemSizeIndices );\n\t\t\t\tconst sparseValues = new TypedArray( bufferViews[ 2 ], byteOffsetValues, accessorDef.sparse.count * itemSize );\n\n\t\t\t\tif ( bufferView !== null ) {\n\n\t\t\t\t\t// Avoid modifying the original ArrayBuffer, if the bufferView wasn't initialized with zeroes.\n\t\t\t\t\tbufferAttribute = new BufferAttribute( bufferAttribute.array.slice(), bufferAttribute.itemSize, bufferAttribute.normalized );\n\n\t\t\t\t}\n\n\t\t\t\tfor ( let i = 0, il = sparseIndices.length; i < il; i ++ ) {\n\n\t\t\t\t\tconst index = sparseIndices[ i ];\n\n\t\t\t\t\tbufferAttribute.setX( index, sparseValues[ i * itemSize ] );\n\t\t\t\t\tif ( itemSize >= 2 ) bufferAttribute.setY( index, sparseValues[ i * itemSize + 1 ] );\n\t\t\t\t\tif ( itemSize >= 3 ) bufferAttribute.setZ( index, sparseValues[ i * itemSize + 2 ] );\n\t\t\t\t\tif ( itemSize >= 4 ) bufferAttribute.setW( index, sparseValues[ i * itemSize + 3 ] );\n\t\t\t\t\tif ( itemSize >= 5 ) throw new Error( 'THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.' );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn bufferAttribute;\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#textures\n\t * @param {number} textureIndex\n\t * @return {Promise<THREE.Texture|null>}\n\t */\n\tloadTexture( textureIndex ) {\n\n\t\tconst json = this.json;\n\t\tconst options = this.options;\n\t\tconst textureDef = json.textures[ textureIndex ];\n\t\tconst sourceIndex = textureDef.source;\n\t\tconst sourceDef = json.images[ sourceIndex ];\n\n\t\tlet loader = this.textureLoader;\n\n\t\tif ( sourceDef.uri ) {\n\n\t\t\tconst handler = options.manager.getHandler( sourceDef.uri );\n\t\t\tif ( handler !== null ) loader = handler;\n\n\t\t}\n\n\t\treturn this.loadTextureImage( textureIndex, sourceIndex, loader );\n\n\t}\n\n\tloadTextureImage( textureIndex, sourceIndex, loader ) {\n\n\t\tconst parser = this;\n\t\tconst json = this.json;\n\n\t\tconst textureDef = json.textures[ textureIndex ];\n\t\tconst sourceDef = json.images[ sourceIndex ];\n\n\t\tconst cacheKey = ( sourceDef.uri || sourceDef.bufferView ) + ':' + textureDef.sampler;\n\n\t\tif ( this.textureCache[ cacheKey ] ) {\n\n\t\t\t// See https://github.com/mrdoob/three.js/issues/21559.\n\t\t\treturn this.textureCache[ cacheKey ];\n\n\t\t}\n\n\t\tconst promise = this.loadImageSource( sourceIndex, loader ).then( function ( texture ) {\n\n\t\t\ttexture.flipY = false;\n\n\t\t\ttexture.name = textureDef.name || sourceDef.name || '';\n\n\t\t\tconst samplers = json.samplers || {};\n\t\t\tconst sampler = samplers[ textureDef.sampler ] || {};\n\n\t\t\ttexture.magFilter = WEBGL_FILTERS[ sampler.magFilter ] || LinearFilter;\n\t\t\ttexture.minFilter = WEBGL_FILTERS[ sampler.minFilter ] || LinearMipmapLinearFilter;\n\t\t\ttexture.wrapS = WEBGL_WRAPPINGS[ sampler.wrapS ] || RepeatWrapping;\n\t\t\ttexture.wrapT = WEBGL_WRAPPINGS[ sampler.wrapT ] || RepeatWrapping;\n\n\t\t\tparser.associations.set( texture, { textures: textureIndex } );\n\n\t\t\treturn texture;\n\n\t\t} ).catch( function () {\n\n\t\t\treturn null;\n\n\t\t} );\n\n\t\tthis.textureCache[ cacheKey ] = promise;\n\n\t\treturn promise;\n\n\t}\n\n\tloadImageSource( sourceIndex, loader ) {\n\n\t\tconst parser = this;\n\t\tconst json = this.json;\n\t\tconst options = this.options;\n\n\t\tif ( this.sourceCache[ sourceIndex ] !== undefined ) {\n\n\t\t\treturn this.sourceCache[ sourceIndex ].then( ( texture ) => texture.clone() );\n\n\t\t}\n\n\t\tconst sourceDef = json.images[ sourceIndex ];\n\n\t\tconst URL = self.URL || self.webkitURL;\n\n\t\tlet sourceURI = sourceDef.uri || '';\n\t\tlet isObjectURL = false;\n\n\t\tif ( sourceDef.bufferView !== undefined ) {\n\n\t\t\t// Load binary image data from bufferView, if provided.\n\n\t\t\tsourceURI = parser.getDependency( 'bufferView', sourceDef.bufferView ).then( function ( bufferView ) {\n\n\t\t\t\tisObjectURL = true;\n\t\t\t\tconst blob = new Blob( [ bufferView ], { type: sourceDef.mimeType } );\n\t\t\t\tsourceURI = URL.createObjectURL( blob );\n\t\t\t\treturn sourceURI;\n\n\t\t\t} );\n\n\t\t} else if ( sourceDef.uri === undefined ) {\n\n\t\t\tthrow new Error( 'THREE.GLTFLoader: Image ' + sourceIndex + ' is missing URI and bufferView' );\n\n\t\t}\n\n\t\tconst promise = Promise.resolve( sourceURI ).then( function ( sourceURI ) {\n\n\t\t\treturn new Promise( function ( resolve, reject ) {\n\n\t\t\t\tlet onLoad = resolve;\n\n\t\t\t\tif ( loader.isImageBitmapLoader === true ) {\n\n\t\t\t\t\tonLoad = function ( imageBitmap ) {\n\n\t\t\t\t\t\tconst texture = new Texture( imageBitmap );\n\t\t\t\t\t\ttexture.needsUpdate = true;\n\n\t\t\t\t\t\tresolve( texture );\n\n\t\t\t\t\t};\n\n\t\t\t\t}\n\n\t\t\t\tloader.load( LoaderUtils.resolveURL( sourceURI, options.path ), onLoad, undefined, reject );\n\n\t\t\t} );\n\n\t\t} ).then( function ( texture ) {\n\n\t\t\t// Clean up resources and configure Texture.\n\n\t\t\tif ( isObjectURL === true ) {\n\n\t\t\t\tURL.revokeObjectURL( sourceURI );\n\n\t\t\t}\n\n\t\t\ttexture.userData.mimeType = sourceDef.mimeType || getImageURIMimeType( sourceDef.uri );\n\n\t\t\treturn texture;\n\n\t\t} ).catch( function ( error ) {\n\n\t\t\tconsole.error( 'THREE.GLTFLoader: Couldn\\'t load texture', sourceURI );\n\t\t\tthrow error;\n\n\t\t} );\n\n\t\tthis.sourceCache[ sourceIndex ] = promise;\n\t\treturn promise;\n\n\t}\n\n\t/**\n\t * Asynchronously assigns a texture to the given material parameters.\n\t * @param {Object} materialParams\n\t * @param {string} mapName\n\t * @param {Object} mapDef\n\t * @return {Promise<Texture>}\n\t */\n\tassignTexture( materialParams, mapName, mapDef, encoding ) {\n\n\t\tconst parser = this;\n\n\t\treturn this.getDependency( 'texture', mapDef.index ).then( function ( texture ) {\n\n\t\t\tif ( ! texture ) return null;\n\n\t\t\t// Materials sample aoMap from UV set 1 and other maps from UV set 0 - this can't be configured\n\t\t\t// However, we will copy UV set 0 to UV set 1 on demand for aoMap\n\t\t\tif ( mapDef.texCoord !== undefined && mapDef.texCoord != 0 && ! ( mapName === 'aoMap' && mapDef.texCoord == 1 ) ) {\n\n\t\t\t\tconsole.warn( 'THREE.GLTFLoader: Custom UV set ' + mapDef.texCoord + ' for texture ' + mapName + ' not yet supported.' );\n\n\t\t\t}\n\n\t\t\tif ( parser.extensions[ EXTENSIONS.KHR_TEXTURE_TRANSFORM ] ) {\n\n\t\t\t\tconst transform = mapDef.extensions !== undefined ? mapDef.extensions[ EXTENSIONS.KHR_TEXTURE_TRANSFORM ] : undefined;\n\n\t\t\t\tif ( transform ) {\n\n\t\t\t\t\tconst gltfReference = parser.associations.get( texture );\n\t\t\t\t\ttexture = parser.extensions[ EXTENSIONS.KHR_TEXTURE_TRANSFORM ].extendTexture( texture, transform );\n\t\t\t\t\tparser.associations.set( texture, gltfReference );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( encoding !== undefined ) {\n\n\t\t\t\ttexture.encoding = encoding;\n\n\t\t\t}\n\n\t\t\tmaterialParams[ mapName ] = texture;\n\n\t\t\treturn texture;\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Assigns final material to a Mesh, Line, or Points instance. The instance\n\t * already has a material (generated from the glTF material options alone)\n\t * but reuse of the same glTF material may require multiple threejs materials\n\t * to accommodate different primitive types, defines, etc. New materials will\n\t * be created if necessary, and reused from a cache.\n\t * @param  {Object3D} mesh Mesh, Line, or Points instance.\n\t */\n\tassignFinalMaterial( mesh ) {\n\n\t\tconst geometry = mesh.geometry;\n\t\tlet material = mesh.material;\n\n\t\tconst useDerivativeTangents = geometry.attributes.tangent === undefined;\n\t\tconst useVertexColors = geometry.attributes.color !== undefined;\n\t\tconst useFlatShading = geometry.attributes.normal === undefined;\n\n\t\tif ( mesh.isPoints ) {\n\n\t\t\tconst cacheKey = 'PointsMaterial:' + material.uuid;\n\n\t\t\tlet pointsMaterial = this.cache.get( cacheKey );\n\n\t\t\tif ( ! pointsMaterial ) {\n\n\t\t\t\tpointsMaterial = new PointsMaterial();\n\t\t\t\tMaterial.prototype.copy.call( pointsMaterial, material );\n\t\t\t\tpointsMaterial.color.copy( material.color );\n\t\t\t\tpointsMaterial.map = material.map;\n\t\t\t\tpointsMaterial.sizeAttenuation = false; // glTF spec says points should be 1px\n\n\t\t\t\tthis.cache.add( cacheKey, pointsMaterial );\n\n\t\t\t}\n\n\t\t\tmaterial = pointsMaterial;\n\n\t\t} else if ( mesh.isLine ) {\n\n\t\t\tconst cacheKey = 'LineBasicMaterial:' + material.uuid;\n\n\t\t\tlet lineMaterial = this.cache.get( cacheKey );\n\n\t\t\tif ( ! lineMaterial ) {\n\n\t\t\t\tlineMaterial = new LineBasicMaterial();\n\t\t\t\tMaterial.prototype.copy.call( lineMaterial, material );\n\t\t\t\tlineMaterial.color.copy( material.color );\n\n\t\t\t\tthis.cache.add( cacheKey, lineMaterial );\n\n\t\t\t}\n\n\t\t\tmaterial = lineMaterial;\n\n\t\t}\n\n\t\t// Clone the material if it will be modified\n\t\tif ( useDerivativeTangents || useVertexColors || useFlatShading ) {\n\n\t\t\tlet cacheKey = 'ClonedMaterial:' + material.uuid + ':';\n\n\t\t\tif ( useDerivativeTangents ) cacheKey += 'derivative-tangents:';\n\t\t\tif ( useVertexColors ) cacheKey += 'vertex-colors:';\n\t\t\tif ( useFlatShading ) cacheKey += 'flat-shading:';\n\n\t\t\tlet cachedMaterial = this.cache.get( cacheKey );\n\n\t\t\tif ( ! cachedMaterial ) {\n\n\t\t\t\tcachedMaterial = material.clone();\n\n\t\t\t\tif ( useVertexColors ) cachedMaterial.vertexColors = true;\n\t\t\t\tif ( useFlatShading ) cachedMaterial.flatShading = true;\n\n\t\t\t\tif ( useDerivativeTangents ) {\n\n\t\t\t\t\t// https://github.com/mrdoob/three.js/issues/11438#issuecomment-507003995\n\t\t\t\t\tif ( cachedMaterial.normalScale ) cachedMaterial.normalScale.y *= - 1;\n\t\t\t\t\tif ( cachedMaterial.clearcoatNormalScale ) cachedMaterial.clearcoatNormalScale.y *= - 1;\n\n\t\t\t\t}\n\n\t\t\t\tthis.cache.add( cacheKey, cachedMaterial );\n\n\t\t\t\tthis.associations.set( cachedMaterial, this.associations.get( material ) );\n\n\t\t\t}\n\n\t\t\tmaterial = cachedMaterial;\n\n\t\t}\n\n\t\t// workarounds for mesh and geometry\n\n\t\tif ( material.aoMap && geometry.attributes.uv2 === undefined && geometry.attributes.uv !== undefined ) {\n\n\t\t\tgeometry.setAttribute( 'uv2', geometry.attributes.uv );\n\n\t\t}\n\n\t\tmesh.material = material;\n\n\t}\n\n\tgetMaterialType( /* materialIndex */ ) {\n\n\t\treturn MeshStandardMaterial;\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#materials\n\t * @param {number} materialIndex\n\t * @return {Promise<Material>}\n\t */\n\tloadMaterial( materialIndex ) {\n\n\t\tconst parser = this;\n\t\tconst json = this.json;\n\t\tconst extensions = this.extensions;\n\t\tconst materialDef = json.materials[ materialIndex ];\n\n\t\tlet materialType;\n\t\tconst materialParams = {};\n\t\tconst materialExtensions = materialDef.extensions || {};\n\n\t\tconst pending = [];\n\n\t\tif ( materialExtensions[ EXTENSIONS.KHR_MATERIALS_UNLIT ] ) {\n\n\t\t\tconst kmuExtension = extensions[ EXTENSIONS.KHR_MATERIALS_UNLIT ];\n\t\t\tmaterialType = kmuExtension.getMaterialType();\n\t\t\tpending.push( kmuExtension.extendParams( materialParams, materialDef, parser ) );\n\n\t\t} else {\n\n\t\t\t// Specification:\n\t\t\t// https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#metallic-roughness-material\n\n\t\t\tconst metallicRoughness = materialDef.pbrMetallicRoughness || {};\n\n\t\t\tmaterialParams.color = new Color( 1.0, 1.0, 1.0 );\n\t\t\tmaterialParams.opacity = 1.0;\n\n\t\t\tif ( Array.isArray( metallicRoughness.baseColorFactor ) ) {\n\n\t\t\t\tconst array = metallicRoughness.baseColorFactor;\n\n\t\t\t\tmaterialParams.color.fromArray( array );\n\t\t\t\tmaterialParams.opacity = array[ 3 ];\n\n\t\t\t}\n\n\t\t\tif ( metallicRoughness.baseColorTexture !== undefined ) {\n\n\t\t\t\tpending.push( parser.assignTexture( materialParams, 'map', metallicRoughness.baseColorTexture, sRGBEncoding ) );\n\n\t\t\t}\n\n\t\t\tmaterialParams.metalness = metallicRoughness.metallicFactor !== undefined ? metallicRoughness.metallicFactor : 1.0;\n\t\t\tmaterialParams.roughness = metallicRoughness.roughnessFactor !== undefined ? metallicRoughness.roughnessFactor : 1.0;\n\n\t\t\tif ( metallicRoughness.metallicRoughnessTexture !== undefined ) {\n\n\t\t\t\tpending.push( parser.assignTexture( materialParams, 'metalnessMap', metallicRoughness.metallicRoughnessTexture ) );\n\t\t\t\tpending.push( parser.assignTexture( materialParams, 'roughnessMap', metallicRoughness.metallicRoughnessTexture ) );\n\n\t\t\t}\n\n\t\t\tmaterialType = this._invokeOne( function ( ext ) {\n\n\t\t\t\treturn ext.getMaterialType && ext.getMaterialType( materialIndex );\n\n\t\t\t} );\n\n\t\t\tpending.push( Promise.all( this._invokeAll( function ( ext ) {\n\n\t\t\t\treturn ext.extendMaterialParams && ext.extendMaterialParams( materialIndex, materialParams );\n\n\t\t\t} ) ) );\n\n\t\t}\n\n\t\tif ( materialDef.doubleSided === true ) {\n\n\t\t\tmaterialParams.side = DoubleSide;\n\n\t\t}\n\n\t\tconst alphaMode = materialDef.alphaMode || ALPHA_MODES.OPAQUE;\n\n\t\tif ( alphaMode === ALPHA_MODES.BLEND ) {\n\n\t\t\tmaterialParams.transparent = true;\n\n\t\t\t// See: https://github.com/mrdoob/three.js/issues/17706\n\t\t\tmaterialParams.depthWrite = false;\n\n\t\t} else {\n\n\t\t\tmaterialParams.transparent = false;\n\n\t\t\tif ( alphaMode === ALPHA_MODES.MASK ) {\n\n\t\t\t\tmaterialParams.alphaTest = materialDef.alphaCutoff !== undefined ? materialDef.alphaCutoff : 0.5;\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( materialDef.normalTexture !== undefined && materialType !== MeshBasicMaterial ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'normalMap', materialDef.normalTexture ) );\n\n\t\t\tmaterialParams.normalScale = new Vector2( 1, 1 );\n\n\t\t\tif ( materialDef.normalTexture.scale !== undefined ) {\n\n\t\t\t\tconst scale = materialDef.normalTexture.scale;\n\n\t\t\t\tmaterialParams.normalScale.set( scale, scale );\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( materialDef.occlusionTexture !== undefined && materialType !== MeshBasicMaterial ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'aoMap', materialDef.occlusionTexture ) );\n\n\t\t\tif ( materialDef.occlusionTexture.strength !== undefined ) {\n\n\t\t\t\tmaterialParams.aoMapIntensity = materialDef.occlusionTexture.strength;\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( materialDef.emissiveFactor !== undefined && materialType !== MeshBasicMaterial ) {\n\n\t\t\tmaterialParams.emissive = new Color().fromArray( materialDef.emissiveFactor );\n\n\t\t}\n\n\t\tif ( materialDef.emissiveTexture !== undefined && materialType !== MeshBasicMaterial ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'emissiveMap', materialDef.emissiveTexture, sRGBEncoding ) );\n\n\t\t}\n\n\t\treturn Promise.all( pending ).then( function () {\n\n\t\t\tconst material = new materialType( materialParams );\n\n\t\t\tif ( materialDef.name ) material.name = materialDef.name;\n\n\t\t\tassignExtrasToUserData( material, materialDef );\n\n\t\t\tparser.associations.set( material, { materials: materialIndex } );\n\n\t\t\tif ( materialDef.extensions ) addUnknownExtensionsToUserData( extensions, material, materialDef );\n\n\t\t\treturn material;\n\n\t\t} );\n\n\t}\n\n\t/** When Object3D instances are targeted by animation, they need unique names. */\n\tcreateUniqueName( originalName ) {\n\n\t\tconst sanitizedName = PropertyBinding.sanitizeNodeName( originalName || '' );\n\n\t\tlet name = sanitizedName;\n\n\t\tfor ( let i = 1; this.nodeNamesUsed[ name ]; ++ i ) {\n\n\t\t\tname = sanitizedName + '_' + i;\n\n\t\t}\n\n\t\tthis.nodeNamesUsed[ name ] = true;\n\n\t\treturn name;\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#geometry\n\t *\n\t * Creates BufferGeometries from primitives.\n\t *\n\t * @param {Array<GLTF.Primitive>} primitives\n\t * @return {Promise<Array<BufferGeometry>>}\n\t */\n\tloadGeometries( primitives ) {\n\n\t\tconst parser = this;\n\t\tconst extensions = this.extensions;\n\t\tconst cache = this.primitiveCache;\n\n\t\tfunction createDracoPrimitive( primitive ) {\n\n\t\t\treturn extensions[ EXTENSIONS.KHR_DRACO_MESH_COMPRESSION ]\n\t\t\t\t.decodePrimitive( primitive, parser )\n\t\t\t\t.then( function ( geometry ) {\n\n\t\t\t\t\treturn addPrimitiveAttributes( geometry, primitive, parser );\n\n\t\t\t\t} );\n\n\t\t}\n\n\t\tconst pending = [];\n\n\t\tfor ( let i = 0, il = primitives.length; i < il; i ++ ) {\n\n\t\t\tconst primitive = primitives[ i ];\n\t\t\tconst cacheKey = createPrimitiveKey( primitive );\n\n\t\t\t// See if we've already created this geometry\n\t\t\tconst cached = cache[ cacheKey ];\n\n\t\t\tif ( cached ) {\n\n\t\t\t\t// Use the cached geometry if it exists\n\t\t\t\tpending.push( cached.promise );\n\n\t\t\t} else {\n\n\t\t\t\tlet geometryPromise;\n\n\t\t\t\tif ( primitive.extensions && primitive.extensions[ EXTENSIONS.KHR_DRACO_MESH_COMPRESSION ] ) {\n\n\t\t\t\t\t// Use DRACO geometry if available\n\t\t\t\t\tgeometryPromise = createDracoPrimitive( primitive );\n\n\t\t\t\t} else {\n\n\t\t\t\t\t// Otherwise create a new geometry\n\t\t\t\t\tgeometryPromise = addPrimitiveAttributes( new BufferGeometry(), primitive, parser );\n\n\t\t\t\t}\n\n\t\t\t\t// Cache this geometry\n\t\t\t\tcache[ cacheKey ] = { primitive: primitive, promise: geometryPromise };\n\n\t\t\t\tpending.push( geometryPromise );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#meshes\n\t * @param {number} meshIndex\n\t * @return {Promise<Group|Mesh|SkinnedMesh>}\n\t */\n\tloadMesh( meshIndex ) {\n\n\t\tconst parser = this;\n\t\tconst json = this.json;\n\t\tconst extensions = this.extensions;\n\n\t\tconst meshDef = json.meshes[ meshIndex ];\n\t\tconst primitives = meshDef.primitives;\n\n\t\tconst pending = [];\n\n\t\tfor ( let i = 0, il = primitives.length; i < il; i ++ ) {\n\n\t\t\tconst material = primitives[ i ].material === undefined\n\t\t\t\t? createDefaultMaterial( this.cache )\n\t\t\t\t: this.getDependency( 'material', primitives[ i ].material );\n\n\t\t\tpending.push( material );\n\n\t\t}\n\n\t\tpending.push( parser.loadGeometries( primitives ) );\n\n\t\treturn Promise.all( pending ).then( function ( results ) {\n\n\t\t\tconst materials = results.slice( 0, results.length - 1 );\n\t\t\tconst geometries = results[ results.length - 1 ];\n\n\t\t\tconst meshes = [];\n\n\t\t\tfor ( let i = 0, il = geometries.length; i < il; i ++ ) {\n\n\t\t\t\tconst geometry = geometries[ i ];\n\t\t\t\tconst primitive = primitives[ i ];\n\n\t\t\t\t// 1. create Mesh\n\n\t\t\t\tlet mesh;\n\n\t\t\t\tconst material = materials[ i ];\n\n\t\t\t\tif ( primitive.mode === WEBGL_CONSTANTS.TRIANGLES ||\n\t\t\t\t\t\tprimitive.mode === WEBGL_CONSTANTS.TRIANGLE_STRIP ||\n\t\t\t\t\t\tprimitive.mode === WEBGL_CONSTANTS.TRIANGLE_FAN ||\n\t\t\t\t\t\tprimitive.mode === undefined ) {\n\n\t\t\t\t\t// .isSkinnedMesh isn't in glTF spec. See ._markDefs()\n\t\t\t\t\tmesh = meshDef.isSkinnedMesh === true\n\t\t\t\t\t\t? new SkinnedMesh( geometry, material )\n\t\t\t\t\t\t: new Mesh( geometry, material );\n\n\t\t\t\t\tif ( mesh.isSkinnedMesh === true && ! mesh.geometry.attributes.skinWeight.normalized ) {\n\n\t\t\t\t\t\t// we normalize floating point skin weight array to fix malformed assets (see #15319)\n\t\t\t\t\t\t// it's important to skip this for non-float32 data since normalizeSkinWeights assumes non-normalized inputs\n\t\t\t\t\t\tmesh.normalizeSkinWeights();\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( primitive.mode === WEBGL_CONSTANTS.TRIANGLE_STRIP ) {\n\n\t\t\t\t\t\tmesh.geometry = toTrianglesDrawMode( mesh.geometry, TriangleStripDrawMode );\n\n\t\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.TRIANGLE_FAN ) {\n\n\t\t\t\t\t\tmesh.geometry = toTrianglesDrawMode( mesh.geometry, TriangleFanDrawMode );\n\n\t\t\t\t\t}\n\n\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.LINES ) {\n\n\t\t\t\t\tmesh = new LineSegments( geometry, material );\n\n\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.LINE_STRIP ) {\n\n\t\t\t\t\tmesh = new Line( geometry, material );\n\n\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.LINE_LOOP ) {\n\n\t\t\t\t\tmesh = new LineLoop( geometry, material );\n\n\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.POINTS ) {\n\n\t\t\t\t\tmesh = new Points( geometry, material );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tthrow new Error( 'THREE.GLTFLoader: Primitive mode unsupported: ' + primitive.mode );\n\n\t\t\t\t}\n\n\t\t\t\tif ( Object.keys( mesh.geometry.morphAttributes ).length > 0 ) {\n\n\t\t\t\t\tupdateMorphTargets( mesh, meshDef );\n\n\t\t\t\t}\n\n\t\t\t\tmesh.name = parser.createUniqueName( meshDef.name || ( 'mesh_' + meshIndex ) );\n\n\t\t\t\tassignExtrasToUserData( mesh, meshDef );\n\n\t\t\t\tif ( primitive.extensions ) addUnknownExtensionsToUserData( extensions, mesh, primitive );\n\n\t\t\t\tparser.assignFinalMaterial( mesh );\n\n\t\t\t\tmeshes.push( mesh );\n\n\t\t\t}\n\n\t\t\tfor ( let i = 0, il = meshes.length; i < il; i ++ ) {\n\n\t\t\t\tparser.associations.set( meshes[ i ], {\n\t\t\t\t\tmeshes: meshIndex,\n\t\t\t\t\tprimitives: i\n\t\t\t\t} );\n\n\t\t\t}\n\n\t\t\tif ( meshes.length === 1 ) {\n\n\t\t\t\treturn meshes[ 0 ];\n\n\t\t\t}\n\n\t\t\tconst group = new Group();\n\n\t\t\tparser.associations.set( group, { meshes: meshIndex } );\n\n\t\t\tfor ( let i = 0, il = meshes.length; i < il; i ++ ) {\n\n\t\t\t\tgroup.add( meshes[ i ] );\n\n\t\t\t}\n\n\t\t\treturn group;\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#cameras\n\t * @param {number} cameraIndex\n\t * @return {Promise<THREE.Camera>}\n\t */\n\tloadCamera( cameraIndex ) {\n\n\t\tlet camera;\n\t\tconst cameraDef = this.json.cameras[ cameraIndex ];\n\t\tconst params = cameraDef[ cameraDef.type ];\n\n\t\tif ( ! params ) {\n\n\t\t\tconsole.warn( 'THREE.GLTFLoader: Missing camera parameters.' );\n\t\t\treturn;\n\n\t\t}\n\n\t\tif ( cameraDef.type === 'perspective' ) {\n\n\t\t\tcamera = new PerspectiveCamera( MathUtils.radToDeg( params.yfov ), params.aspectRatio || 1, params.znear || 1, params.zfar || 2e6 );\n\n\t\t} else if ( cameraDef.type === 'orthographic' ) {\n\n\t\t\tcamera = new OrthographicCamera( - params.xmag, params.xmag, params.ymag, - params.ymag, params.znear, params.zfar );\n\n\t\t}\n\n\t\tif ( cameraDef.name ) camera.name = this.createUniqueName( cameraDef.name );\n\n\t\tassignExtrasToUserData( camera, cameraDef );\n\n\t\treturn Promise.resolve( camera );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#skins\n\t * @param {number} skinIndex\n\t * @return {Promise<Skeleton>}\n\t */\n\tloadSkin( skinIndex ) {\n\n\t\tconst skinDef = this.json.skins[ skinIndex ];\n\n\t\tconst pending = [];\n\n\t\tfor ( let i = 0, il = skinDef.joints.length; i < il; i ++ ) {\n\n\t\t\tpending.push( this.getDependency( 'node', skinDef.joints[ i ] ) );\n\n\t\t}\n\n\t\tif ( skinDef.inverseBindMatrices !== undefined ) {\n\n\t\t\tpending.push( this.getDependency( 'accessor', skinDef.inverseBindMatrices ) );\n\n\t\t} else {\n\n\t\t\tpending.push( null );\n\n\t\t}\n\n\t\treturn Promise.all( pending ).then( function ( results ) {\n\n\t\t\tconst inverseBindMatrices = results.pop();\n\t\t\tconst jointNodes = results;\n\n\t\t\tconst bones = [];\n\t\t\tconst boneInverses = [];\n\n\t\t\tfor ( let i = 0, il = jointNodes.length; i < il; i ++ ) {\n\n\t\t\t\tconst jointNode = jointNodes[ i ];\n\n\t\t\t\tif ( jointNode ) {\n\n\t\t\t\t\tbones.push( jointNode );\n\n\t\t\t\t\tconst mat = new Matrix4();\n\n\t\t\t\t\tif ( inverseBindMatrices !== null ) {\n\n\t\t\t\t\t\tmat.fromArray( inverseBindMatrices.array, i * 16 );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tboneInverses.push( mat );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tconsole.warn( 'THREE.GLTFLoader: Joint \"%s\" could not be found.', skinDef.joints[ i ] );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn new Skeleton( bones, boneInverses );\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#animations\n\t * @param {number} animationIndex\n\t * @return {Promise<AnimationClip>}\n\t */\n\tloadAnimation( animationIndex ) {\n\n\t\tconst json = this.json;\n\n\t\tconst animationDef = json.animations[ animationIndex ];\n\n\t\tconst pendingNodes = [];\n\t\tconst pendingInputAccessors = [];\n\t\tconst pendingOutputAccessors = [];\n\t\tconst pendingSamplers = [];\n\t\tconst pendingTargets = [];\n\n\t\tfor ( let i = 0, il = animationDef.channels.length; i < il; i ++ ) {\n\n\t\t\tconst channel = animationDef.channels[ i ];\n\t\t\tconst sampler = animationDef.samplers[ channel.sampler ];\n\t\t\tconst target = channel.target;\n\t\t\tconst name = target.node;\n\t\t\tconst input = animationDef.parameters !== undefined ? animationDef.parameters[ sampler.input ] : sampler.input;\n\t\t\tconst output = animationDef.parameters !== undefined ? animationDef.parameters[ sampler.output ] : sampler.output;\n\n\t\t\tpendingNodes.push( this.getDependency( 'node', name ) );\n\t\t\tpendingInputAccessors.push( this.getDependency( 'accessor', input ) );\n\t\t\tpendingOutputAccessors.push( this.getDependency( 'accessor', output ) );\n\t\t\tpendingSamplers.push( sampler );\n\t\t\tpendingTargets.push( target );\n\n\t\t}\n\n\t\treturn Promise.all( [\n\n\t\t\tPromise.all( pendingNodes ),\n\t\t\tPromise.all( pendingInputAccessors ),\n\t\t\tPromise.all( pendingOutputAccessors ),\n\t\t\tPromise.all( pendingSamplers ),\n\t\t\tPromise.all( pendingTargets )\n\n\t\t] ).then( function ( dependencies ) {\n\n\t\t\tconst nodes = dependencies[ 0 ];\n\t\t\tconst inputAccessors = dependencies[ 1 ];\n\t\t\tconst outputAccessors = dependencies[ 2 ];\n\t\t\tconst samplers = dependencies[ 3 ];\n\t\t\tconst targets = dependencies[ 4 ];\n\n\t\t\tconst tracks = [];\n\n\t\t\tfor ( let i = 0, il = nodes.length; i < il; i ++ ) {\n\n\t\t\t\tconst node = nodes[ i ];\n\t\t\t\tconst inputAccessor = inputAccessors[ i ];\n\t\t\t\tconst outputAccessor = outputAccessors[ i ];\n\t\t\t\tconst sampler = samplers[ i ];\n\t\t\t\tconst target = targets[ i ];\n\n\t\t\t\tif ( node === undefined ) continue;\n\n\t\t\t\tnode.updateMatrix();\n\n\t\t\t\tlet TypedKeyframeTrack;\n\n\t\t\t\tswitch ( PATH_PROPERTIES[ target.path ] ) {\n\n\t\t\t\t\tcase PATH_PROPERTIES.weights:\n\n\t\t\t\t\t\tTypedKeyframeTrack = NumberKeyframeTrack;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase PATH_PROPERTIES.rotation:\n\n\t\t\t\t\t\tTypedKeyframeTrack = QuaternionKeyframeTrack;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase PATH_PROPERTIES.position:\n\t\t\t\t\tcase PATH_PROPERTIES.scale:\n\t\t\t\t\tdefault:\n\n\t\t\t\t\t\tTypedKeyframeTrack = VectorKeyframeTrack;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t\tconst targetName = node.name ? node.name : node.uuid;\n\n\t\t\t\tconst interpolation = sampler.interpolation !== undefined ? INTERPOLATION[ sampler.interpolation ] : InterpolateLinear;\n\n\t\t\t\tconst targetNames = [];\n\n\t\t\t\tif ( PATH_PROPERTIES[ target.path ] === PATH_PROPERTIES.weights ) {\n\n\t\t\t\t\tnode.traverse( function ( object ) {\n\n\t\t\t\t\t\tif ( object.morphTargetInfluences ) {\n\n\t\t\t\t\t\t\ttargetNames.push( object.name ? object.name : object.uuid );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t} );\n\n\t\t\t\t} else {\n\n\t\t\t\t\ttargetNames.push( targetName );\n\n\t\t\t\t}\n\n\t\t\t\tlet outputArray = outputAccessor.array;\n\n\t\t\t\tif ( outputAccessor.normalized ) {\n\n\t\t\t\t\tconst scale = getNormalizedComponentScale( outputArray.constructor );\n\t\t\t\t\tconst scaled = new Float32Array( outputArray.length );\n\n\t\t\t\t\tfor ( let j = 0, jl = outputArray.length; j < jl; j ++ ) {\n\n\t\t\t\t\t\tscaled[ j ] = outputArray[ j ] * scale;\n\n\t\t\t\t\t}\n\n\t\t\t\t\toutputArray = scaled;\n\n\t\t\t\t}\n\n\t\t\t\tfor ( let j = 0, jl = targetNames.length; j < jl; j ++ ) {\n\n\t\t\t\t\tconst track = new TypedKeyframeTrack(\n\t\t\t\t\t\ttargetNames[ j ] + '.' + PATH_PROPERTIES[ target.path ],\n\t\t\t\t\t\tinputAccessor.array,\n\t\t\t\t\t\toutputArray,\n\t\t\t\t\t\tinterpolation\n\t\t\t\t\t);\n\n\t\t\t\t\t// Override interpolation with custom factory method.\n\t\t\t\t\tif ( sampler.interpolation === 'CUBICSPLINE' ) {\n\n\t\t\t\t\t\ttrack.createInterpolant = function InterpolantFactoryMethodGLTFCubicSpline( result ) {\n\n\t\t\t\t\t\t\t// A CUBICSPLINE keyframe in glTF has three output values for each input value,\n\t\t\t\t\t\t\t// representing inTangent, splineVertex, and outTangent. As a result, track.getValueSize()\n\t\t\t\t\t\t\t// must be divided by three to get the interpolant's sampleSize argument.\n\n\t\t\t\t\t\t\tconst interpolantType = ( this instanceof QuaternionKeyframeTrack ) ? GLTFCubicSplineQuaternionInterpolant : GLTFCubicSplineInterpolant;\n\n\t\t\t\t\t\t\treturn new interpolantType( this.times, this.values, this.getValueSize() / 3, result );\n\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\t// Mark as CUBICSPLINE. `track.getInterpolation()` doesn't support custom interpolants.\n\t\t\t\t\t\ttrack.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline = true;\n\n\t\t\t\t\t}\n\n\t\t\t\t\ttracks.push( track );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tconst name = animationDef.name ? animationDef.name : 'animation_' + animationIndex;\n\n\t\t\treturn new AnimationClip( name, undefined, tracks );\n\n\t\t} );\n\n\t}\n\n\tcreateNodeMesh( nodeIndex ) {\n\n\t\tconst json = this.json;\n\t\tconst parser = this;\n\t\tconst nodeDef = json.nodes[ nodeIndex ];\n\n\t\tif ( nodeDef.mesh === undefined ) return null;\n\n\t\treturn parser.getDependency( 'mesh', nodeDef.mesh ).then( function ( mesh ) {\n\n\t\t\tconst node = parser._getNodeRef( parser.meshCache, nodeDef.mesh, mesh );\n\n\t\t\t// if weights are provided on the node, override weights on the mesh.\n\t\t\tif ( nodeDef.weights !== undefined ) {\n\n\t\t\t\tnode.traverse( function ( o ) {\n\n\t\t\t\t\tif ( ! o.isMesh ) return;\n\n\t\t\t\t\tfor ( let i = 0, il = nodeDef.weights.length; i < il; i ++ ) {\n\n\t\t\t\t\t\to.morphTargetInfluences[ i ] = nodeDef.weights[ i ];\n\n\t\t\t\t\t}\n\n\t\t\t\t} );\n\n\t\t\t}\n\n\t\t\treturn node;\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#nodes-and-hierarchy\n\t * @param {number} nodeIndex\n\t * @return {Promise<Object3D>}\n\t */\n\tloadNode( nodeIndex ) {\n\n\t\tconst json = this.json;\n\t\tconst extensions = this.extensions;\n\t\tconst parser = this;\n\n\t\tconst nodeDef = json.nodes[ nodeIndex ];\n\n\t\t// reserve node's name before its dependencies, so the root has the intended name.\n\t\tconst nodeName = nodeDef.name ? parser.createUniqueName( nodeDef.name ) : '';\n\n\t\treturn ( function () {\n\n\t\t\tconst objectPending = [];\n\n\t\t\tconst meshPromise = parser._invokeOne( function ( ext ) {\n\n\t\t\t\treturn ext.createNodeMesh && ext.createNodeMesh( nodeIndex );\n\n\t\t\t} );\n\n\t\t\tif ( meshPromise ) {\n\n\t\t\t\tobjectPending.push( meshPromise );\n\n\t\t\t}\n\n\t\t\tif ( nodeDef.camera !== undefined ) {\n\n\t\t\t\tobjectPending.push( parser.getDependency( 'camera', nodeDef.camera ).then( function ( camera ) {\n\n\t\t\t\t\treturn parser._getNodeRef( parser.cameraCache, nodeDef.camera, camera );\n\n\t\t\t\t} ) );\n\n\t\t\t}\n\n\t\t\tparser._invokeAll( function ( ext ) {\n\n\t\t\t\treturn ext.createNodeAttachment && ext.createNodeAttachment( nodeIndex );\n\n\t\t\t} ).forEach( function ( promise ) {\n\n\t\t\t\tobjectPending.push( promise );\n\n\t\t\t} );\n\n\t\t\tconst childPending = [];\n\t\t\tconst childrenDef = nodeDef.children || [];\n\n\t\t\tfor ( let i = 0, il = childrenDef.length; i < il; i ++ ) {\n\n\t\t\t\tchildPending.push( parser.getDependency( 'node', childrenDef[ i ] ) );\n\n\t\t\t}\n\n\t\t\tconst skeletonPending = nodeDef.skin === undefined\n\t\t\t\t? Promise.resolve( null )\n\t\t\t\t: parser.getDependency( 'skin', nodeDef.skin );\n\n\t\t\treturn Promise.all( [\n\t\t\t\tPromise.all( objectPending ),\n\t\t\t\tPromise.all( childPending ),\n\t\t\t\tskeletonPending\n\t\t\t] );\n\n\t\t}() ).then( function ( results ) {\n\n\t\t\tconst objects = results[ 0 ];\n\t\t\tconst children = results[ 1 ];\n\t\t\tconst skeleton = results[ 2 ];\n\n\t\t\tlet node;\n\n\t\t\t// .isBone isn't in glTF spec. See ._markDefs\n\t\t\tif ( nodeDef.isBone === true ) {\n\n\t\t\t\tnode = new Bone();\n\n\t\t\t} else if ( objects.length > 1 ) {\n\n\t\t\t\tnode = new Group();\n\n\t\t\t} else if ( objects.length === 1 ) {\n\n\t\t\t\tnode = objects[ 0 ];\n\n\t\t\t} else {\n\n\t\t\t\tnode = new Object3D();\n\n\t\t\t}\n\n\t\t\tif ( node !== objects[ 0 ] ) {\n\n\t\t\t\tfor ( let i = 0, il = objects.length; i < il; i ++ ) {\n\n\t\t\t\t\tnode.add( objects[ i ] );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( nodeDef.name ) {\n\n\t\t\t\tnode.userData.name = nodeDef.name;\n\t\t\t\tnode.name = nodeName;\n\n\t\t\t}\n\n\t\t\tassignExtrasToUserData( node, nodeDef );\n\n\t\t\tif ( nodeDef.extensions ) addUnknownExtensionsToUserData( extensions, node, nodeDef );\n\n\t\t\tif ( nodeDef.matrix !== undefined ) {\n\n\t\t\t\tconst matrix = new Matrix4();\n\t\t\t\tmatrix.fromArray( nodeDef.matrix );\n\t\t\t\tnode.applyMatrix4( matrix );\n\n\t\t\t} else {\n\n\t\t\t\tif ( nodeDef.translation !== undefined ) {\n\n\t\t\t\t\tnode.position.fromArray( nodeDef.translation );\n\n\t\t\t\t}\n\n\t\t\t\tif ( nodeDef.rotation !== undefined ) {\n\n\t\t\t\t\tnode.quaternion.fromArray( nodeDef.rotation );\n\n\t\t\t\t}\n\n\t\t\t\tif ( nodeDef.scale !== undefined ) {\n\n\t\t\t\t\tnode.scale.fromArray( nodeDef.scale );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( ! parser.associations.has( node ) ) {\n\n\t\t\t\tparser.associations.set( node, {} );\n\n\t\t\t}\n\n\t\t\tparser.associations.get( node ).nodes = nodeIndex;\n\n\t\t\tif ( skeleton !== null ) {\n\n\t\t\t\t// This full traverse should be fine because\n\t\t\t\t// child glTF nodes have not been added to this node yet.\n\t\t\t\tnode.traverse( function ( mesh ) {\n\n\t\t\t\t\tif ( ! mesh.isSkinnedMesh ) return;\n\n\t\t\t\t\tmesh.bind( skeleton, _identityMatrix );\n\n\t\t\t\t} );\n\n\t\t\t}\n\n\t\t\tfor ( let i = 0, il = children.length; i < il; i ++ ) {\n\n\t\t\t\tnode.add( children[ i ] );\n\n\t\t\t}\n\n\t\t\treturn node;\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#scenes\n\t * @param {number} sceneIndex\n\t * @return {Promise<Group>}\n\t */\n\tloadScene( sceneIndex ) {\n\n\t\tconst extensions = this.extensions;\n\t\tconst sceneDef = this.json.scenes[ sceneIndex ];\n\t\tconst parser = this;\n\n\t\t// Loader returns Group, not Scene.\n\t\t// See: https://github.com/mrdoob/three.js/issues/18342#issuecomment-578981172\n\t\tconst scene = new Group();\n\t\tif ( sceneDef.name ) scene.name = parser.createUniqueName( sceneDef.name );\n\n\t\tassignExtrasToUserData( scene, sceneDef );\n\n\t\tif ( sceneDef.extensions ) addUnknownExtensionsToUserData( extensions, scene, sceneDef );\n\n\t\tconst nodeIds = sceneDef.nodes || [];\n\n\t\tconst pending = [];\n\n\t\tfor ( let i = 0, il = nodeIds.length; i < il; i ++ ) {\n\n\t\t\tpending.push( parser.getDependency( 'node', nodeIds[ i ] ) );\n\n\t\t}\n\n\t\treturn Promise.all( pending ).then( function ( nodes ) {\n\n\t\t\tfor ( let i = 0, il = nodes.length; i < il; i ++ ) {\n\n\t\t\t\tscene.add( nodes[ i ] );\n\n\t\t\t}\n\n\t\t\t// Removes dangling associations, associations that reference a node that\n\t\t\t// didn't make it into the scene.\n\t\t\tconst reduceAssociations = ( node ) => {\n\n\t\t\t\tconst reducedAssociations = new Map();\n\n\t\t\t\tfor ( const [ key, value ] of parser.associations ) {\n\n\t\t\t\t\tif ( key instanceof Material || key instanceof Texture ) {\n\n\t\t\t\t\t\treducedAssociations.set( key, value );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tnode.traverse( ( node ) => {\n\n\t\t\t\t\tconst mappings = parser.associations.get( node );\n\n\t\t\t\t\tif ( mappings != null ) {\n\n\t\t\t\t\t\treducedAssociations.set( node, mappings );\n\n\t\t\t\t\t}\n\n\t\t\t\t} );\n\n\t\t\t\treturn reducedAssociations;\n\n\t\t\t};\n\n\t\t\tparser.associations = reduceAssociations( scene );\n\n\t\t\treturn scene;\n\n\t\t} );\n\n\t}\n\n}\n\n/**\n * @param {BufferGeometry} geometry\n * @param {GLTF.Primitive} primitiveDef\n * @param {GLTFParser} parser\n */\nfunction computeBounds( geometry, primitiveDef, parser ) {\n\n\tconst attributes = primitiveDef.attributes;\n\n\tconst box = new Box3();\n\n\tif ( attributes.POSITION !== undefined ) {\n\n\t\tconst accessor = parser.json.accessors[ attributes.POSITION ];\n\n\t\tconst min = accessor.min;\n\t\tconst max = accessor.max;\n\n\t\t// glTF requires 'min' and 'max', but VRM (which extends glTF) currently ignores that requirement.\n\n\t\tif ( min !== undefined && max !== undefined ) {\n\n\t\t\tbox.set(\n\t\t\t\tnew Vector3( min[ 0 ], min[ 1 ], min[ 2 ] ),\n\t\t\t\tnew Vector3( max[ 0 ], max[ 1 ], max[ 2 ] )\n\t\t\t);\n\n\t\t\tif ( accessor.normalized ) {\n\n\t\t\t\tconst boxScale = getNormalizedComponentScale( WEBGL_COMPONENT_TYPES[ accessor.componentType ] );\n\t\t\t\tbox.min.multiplyScalar( boxScale );\n\t\t\t\tbox.max.multiplyScalar( boxScale );\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tconsole.warn( 'THREE.GLTFLoader: Missing min/max properties for accessor POSITION.' );\n\n\t\t\treturn;\n\n\t\t}\n\n\t} else {\n\n\t\treturn;\n\n\t}\n\n\tconst targets = primitiveDef.targets;\n\n\tif ( targets !== undefined ) {\n\n\t\tconst maxDisplacement = new Vector3();\n\t\tconst vector = new Vector3();\n\n\t\tfor ( let i = 0, il = targets.length; i < il; i ++ ) {\n\n\t\t\tconst target = targets[ i ];\n\n\t\t\tif ( target.POSITION !== undefined ) {\n\n\t\t\t\tconst accessor = parser.json.accessors[ target.POSITION ];\n\t\t\t\tconst min = accessor.min;\n\t\t\t\tconst max = accessor.max;\n\n\t\t\t\t// glTF requires 'min' and 'max', but VRM (which extends glTF) currently ignores that requirement.\n\n\t\t\t\tif ( min !== undefined && max !== undefined ) {\n\n\t\t\t\t\t// we need to get max of absolute components because target weight is [-1,1]\n\t\t\t\t\tvector.setX( Math.max( Math.abs( min[ 0 ] ), Math.abs( max[ 0 ] ) ) );\n\t\t\t\t\tvector.setY( Math.max( Math.abs( min[ 1 ] ), Math.abs( max[ 1 ] ) ) );\n\t\t\t\t\tvector.setZ( Math.max( Math.abs( min[ 2 ] ), Math.abs( max[ 2 ] ) ) );\n\n\n\t\t\t\t\tif ( accessor.normalized ) {\n\n\t\t\t\t\t\tconst boxScale = getNormalizedComponentScale( WEBGL_COMPONENT_TYPES[ accessor.componentType ] );\n\t\t\t\t\t\tvector.multiplyScalar( boxScale );\n\n\t\t\t\t\t}\n\n\t\t\t\t\t// Note: this assumes that the sum of all weights is at most 1. This isn't quite correct - it's more conservative\n\t\t\t\t\t// to assume that each target can have a max weight of 1. However, for some use cases - notably, when morph targets\n\t\t\t\t\t// are used to implement key-frame animations and as such only two are active at a time - this results in very large\n\t\t\t\t\t// boxes. So for now we make a box that's sometimes a touch too small but is hopefully mostly of reasonable size.\n\t\t\t\t\tmaxDisplacement.max( vector );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tconsole.warn( 'THREE.GLTFLoader: Missing min/max properties for accessor POSITION.' );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\t// As per comment above this box isn't conservative, but has a reasonable size for a very large number of morph targets.\n\t\tbox.expandByVector( maxDisplacement );\n\n\t}\n\n\tgeometry.boundingBox = box;\n\n\tconst sphere = new Sphere();\n\n\tbox.getCenter( sphere.center );\n\tsphere.radius = box.min.distanceTo( box.max ) / 2;\n\n\tgeometry.boundingSphere = sphere;\n\n}\n\n/**\n * @param {BufferGeometry} geometry\n * @param {GLTF.Primitive} primitiveDef\n * @param {GLTFParser} parser\n * @return {Promise<BufferGeometry>}\n */\nfunction addPrimitiveAttributes( geometry, primitiveDef, parser ) {\n\n\tconst attributes = primitiveDef.attributes;\n\n\tconst pending = [];\n\n\tfunction assignAttributeAccessor( accessorIndex, attributeName ) {\n\n\t\treturn parser.getDependency( 'accessor', accessorIndex )\n\t\t\t.then( function ( accessor ) {\n\n\t\t\t\tgeometry.setAttribute( attributeName, accessor );\n\n\t\t\t} );\n\n\t}\n\n\tfor ( const gltfAttributeName in attributes ) {\n\n\t\tconst threeAttributeName = ATTRIBUTES[ gltfAttributeName ] || gltfAttributeName.toLowerCase();\n\n\t\t// Skip attributes already provided by e.g. Draco extension.\n\t\tif ( threeAttributeName in geometry.attributes ) continue;\n\n\t\tpending.push( assignAttributeAccessor( attributes[ gltfAttributeName ], threeAttributeName ) );\n\n\t}\n\n\tif ( primitiveDef.indices !== undefined && ! geometry.index ) {\n\n\t\tconst accessor = parser.getDependency( 'accessor', primitiveDef.indices ).then( function ( accessor ) {\n\n\t\t\tgeometry.setIndex( accessor );\n\n\t\t} );\n\n\t\tpending.push( accessor );\n\n\t}\n\n\tassignExtrasToUserData( geometry, primitiveDef );\n\n\tcomputeBounds( geometry, primitiveDef, parser );\n\n\treturn Promise.all( pending ).then( function () {\n\n\t\treturn primitiveDef.targets !== undefined\n\t\t\t? addMorphTargets( geometry, primitiveDef.targets, parser )\n\t\t\t: geometry;\n\n\t} );\n\n}\n\nexport { GLTFLoader };\n","import {\n\tBufferAttribute,\n\tBufferGeometry,\n\tFileLoader,\n\tLoader\n} from 'three';\n\nconst _taskCache = new WeakMap();\n\nclass DRACOLoader extends Loader {\n\n\tconstructor( manager ) {\n\n\t\tsuper( manager );\n\n\t\tthis.decoderPath = '';\n\t\tthis.decoderConfig = {};\n\t\tthis.decoderBinary = null;\n\t\tthis.decoderPending = null;\n\n\t\tthis.workerLimit = 4;\n\t\tthis.workerPool = [];\n\t\tthis.workerNextTaskID = 1;\n\t\tthis.workerSourceURL = '';\n\n\t\tthis.defaultAttributeIDs = {\n\t\t\tposition: 'POSITION',\n\t\t\tnormal: 'NORMAL',\n\t\t\tcolor: 'COLOR',\n\t\t\tuv: 'TEX_COORD'\n\t\t};\n\t\tthis.defaultAttributeTypes = {\n\t\t\tposition: 'Float32Array',\n\t\t\tnormal: 'Float32Array',\n\t\t\tcolor: 'Float32Array',\n\t\t\tuv: 'Float32Array'\n\t\t};\n\n\t}\n\n\tsetDecoderPath( path ) {\n\n\t\tthis.decoderPath = path;\n\n\t\treturn this;\n\n\t}\n\n\tsetDecoderConfig( config ) {\n\n\t\tthis.decoderConfig = config;\n\n\t\treturn this;\n\n\t}\n\n\tsetWorkerLimit( workerLimit ) {\n\n\t\tthis.workerLimit = workerLimit;\n\n\t\treturn this;\n\n\t}\n\n\tload( url, onLoad, onProgress, onError ) {\n\n\t\tconst loader = new FileLoader( this.manager );\n\n\t\tloader.setPath( this.path );\n\t\tloader.setResponseType( 'arraybuffer' );\n\t\tloader.setRequestHeader( this.requestHeader );\n\t\tloader.setWithCredentials( this.withCredentials );\n\n\t\tloader.load( url, ( buffer ) => {\n\n\t\t\tthis.decodeDracoFile( buffer, onLoad ).catch( onError );\n\n\t\t}, onProgress, onError );\n\n\t}\n\n\tdecodeDracoFile( buffer, callback, attributeIDs, attributeTypes ) {\n\n\t\tconst taskConfig = {\n\t\t\tattributeIDs: attributeIDs || this.defaultAttributeIDs,\n\t\t\tattributeTypes: attributeTypes || this.defaultAttributeTypes,\n\t\t\tuseUniqueIDs: !! attributeIDs\n\t\t};\n\n\t\treturn this.decodeGeometry( buffer, taskConfig ).then( callback );\n\n\t}\n\n\tdecodeGeometry( buffer, taskConfig ) {\n\n\t\tconst taskKey = JSON.stringify( taskConfig );\n\n\t\t// Check for an existing task using this buffer. A transferred buffer cannot be transferred\n\t\t// again from this thread.\n\t\tif ( _taskCache.has( buffer ) ) {\n\n\t\t\tconst cachedTask = _taskCache.get( buffer );\n\n\t\t\tif ( cachedTask.key === taskKey ) {\n\n\t\t\t\treturn cachedTask.promise;\n\n\t\t\t} else if ( buffer.byteLength === 0 ) {\n\n\t\t\t\t// Technically, it would be possible to wait for the previous task to complete,\n\t\t\t\t// transfer the buffer back, and decode again with the second configuration. That\n\t\t\t\t// is complex, and I don't know of any reason to decode a Draco buffer twice in\n\t\t\t\t// different ways, so this is left unimplemented.\n\t\t\t\tthrow new Error(\n\n\t\t\t\t\t'THREE.DRACOLoader: Unable to re-decode a buffer with different ' +\n\t\t\t\t\t'settings. Buffer has already been transferred.'\n\n\t\t\t\t);\n\n\t\t\t}\n\n\t\t}\n\n\t\t//\n\n\t\tlet worker;\n\t\tconst taskID = this.workerNextTaskID ++;\n\t\tconst taskCost = buffer.byteLength;\n\n\t\t// Obtain a worker and assign a task, and construct a geometry instance\n\t\t// when the task completes.\n\t\tconst geometryPending = this._getWorker( taskID, taskCost )\n\t\t\t.then( ( _worker ) => {\n\n\t\t\t\tworker = _worker;\n\n\t\t\t\treturn new Promise( ( resolve, reject ) => {\n\n\t\t\t\t\tworker._callbacks[ taskID ] = { resolve, reject };\n\n\t\t\t\t\tworker.postMessage( { type: 'decode', id: taskID, taskConfig, buffer }, [ buffer ] );\n\n\t\t\t\t\t// this.debug();\n\n\t\t\t\t} );\n\n\t\t\t} )\n\t\t\t.then( ( message ) => this._createGeometry( message.geometry ) );\n\n\t\t// Remove task from the task list.\n\t\t// Note: replaced '.finally()' with '.catch().then()' block - iOS 11 support (#19416)\n\t\tgeometryPending\n\t\t\t.catch( () => true )\n\t\t\t.then( () => {\n\n\t\t\t\tif ( worker && taskID ) {\n\n\t\t\t\t\tthis._releaseTask( worker, taskID );\n\n\t\t\t\t\t// this.debug();\n\n\t\t\t\t}\n\n\t\t\t} );\n\n\t\t// Cache the task result.\n\t\t_taskCache.set( buffer, {\n\n\t\t\tkey: taskKey,\n\t\t\tpromise: geometryPending\n\n\t\t} );\n\n\t\treturn geometryPending;\n\n\t}\n\n\t_createGeometry( geometryData ) {\n\n\t\tconst geometry = new BufferGeometry();\n\n\t\tif ( geometryData.index ) {\n\n\t\t\tgeometry.setIndex( new BufferAttribute( geometryData.index.array, 1 ) );\n\n\t\t}\n\n\t\tfor ( let i = 0; i < geometryData.attributes.length; i ++ ) {\n\n\t\t\tconst attribute = geometryData.attributes[ i ];\n\t\t\tconst name = attribute.name;\n\t\t\tconst array = attribute.array;\n\t\t\tconst itemSize = attribute.itemSize;\n\n\t\t\tgeometry.setAttribute( name, new BufferAttribute( array, itemSize ) );\n\n\t\t}\n\n\t\treturn geometry;\n\n\t}\n\n\t_loadLibrary( url, responseType ) {\n\n\t\tconst loader = new FileLoader( this.manager );\n\t\tloader.setPath( this.decoderPath );\n\t\tloader.setResponseType( responseType );\n\t\tloader.setWithCredentials( this.withCredentials );\n\n\t\treturn new Promise( ( resolve, reject ) => {\n\n\t\t\tloader.load( url, resolve, undefined, reject );\n\n\t\t} );\n\n\t}\n\n\tpreload() {\n\n\t\tthis._initDecoder();\n\n\t\treturn this;\n\n\t}\n\n\t_initDecoder() {\n\n\t\tif ( this.decoderPending ) return this.decoderPending;\n\n\t\tconst useJS = typeof WebAssembly !== 'object' || this.decoderConfig.type === 'js';\n\t\tconst librariesPending = [];\n\n\t\tif ( useJS ) {\n\n\t\t\tlibrariesPending.push( this._loadLibrary( 'draco_decoder.js', 'text' ) );\n\n\t\t} else {\n\n\t\t\tlibrariesPending.push( this._loadLibrary( 'draco_wasm_wrapper.js', 'text' ) );\n\t\t\tlibrariesPending.push( this._loadLibrary( 'draco_decoder.wasm', 'arraybuffer' ) );\n\n\t\t}\n\n\t\tthis.decoderPending = Promise.all( librariesPending )\n\t\t\t.then( ( libraries ) => {\n\n\t\t\t\tconst jsContent = libraries[ 0 ];\n\n\t\t\t\tif ( ! useJS ) {\n\n\t\t\t\t\tthis.decoderConfig.wasmBinary = libraries[ 1 ];\n\n\t\t\t\t}\n\n\t\t\t\tconst fn = DRACOWorker.toString();\n\n\t\t\t\tconst body = [\n\t\t\t\t\t'/* draco decoder */',\n\t\t\t\t\tjsContent,\n\t\t\t\t\t'',\n\t\t\t\t\t'/* worker */',\n\t\t\t\t\tfn.substring( fn.indexOf( '{' ) + 1, fn.lastIndexOf( '}' ) )\n\t\t\t\t].join( '\\n' );\n\n\t\t\t\tthis.workerSourceURL = URL.createObjectURL( new Blob( [ body ] ) );\n\n\t\t\t} );\n\n\t\treturn this.decoderPending;\n\n\t}\n\n\t_getWorker( taskID, taskCost ) {\n\n\t\treturn this._initDecoder().then( () => {\n\n\t\t\tif ( this.workerPool.length < this.workerLimit ) {\n\n\t\t\t\tconst worker = new Worker( this.workerSourceURL );\n\n\t\t\t\tworker._callbacks = {};\n\t\t\t\tworker._taskCosts = {};\n\t\t\t\tworker._taskLoad = 0;\n\n\t\t\t\tworker.postMessage( { type: 'init', decoderConfig: this.decoderConfig } );\n\n\t\t\t\tworker.onmessage = function ( e ) {\n\n\t\t\t\t\tconst message = e.data;\n\n\t\t\t\t\tswitch ( message.type ) {\n\n\t\t\t\t\t\tcase 'decode':\n\t\t\t\t\t\t\tworker._callbacks[ message.id ].resolve( message );\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'error':\n\t\t\t\t\t\t\tworker._callbacks[ message.id ].reject( message );\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tconsole.error( 'THREE.DRACOLoader: Unexpected message, \"' + message.type + '\"' );\n\n\t\t\t\t\t}\n\n\t\t\t\t};\n\n\t\t\t\tthis.workerPool.push( worker );\n\n\t\t\t} else {\n\n\t\t\t\tthis.workerPool.sort( function ( a, b ) {\n\n\t\t\t\t\treturn a._taskLoad > b._taskLoad ? - 1 : 1;\n\n\t\t\t\t} );\n\n\t\t\t}\n\n\t\t\tconst worker = this.workerPool[ this.workerPool.length - 1 ];\n\t\t\tworker._taskCosts[ taskID ] = taskCost;\n\t\t\tworker._taskLoad += taskCost;\n\t\t\treturn worker;\n\n\t\t} );\n\n\t}\n\n\t_releaseTask( worker, taskID ) {\n\n\t\tworker._taskLoad -= worker._taskCosts[ taskID ];\n\t\tdelete worker._callbacks[ taskID ];\n\t\tdelete worker._taskCosts[ taskID ];\n\n\t}\n\n\tdebug() {\n\n\t\tconsole.log( 'Task load: ', this.workerPool.map( ( worker ) => worker._taskLoad ) );\n\n\t}\n\n\tdispose() {\n\n\t\tfor ( let i = 0; i < this.workerPool.length; ++ i ) {\n\n\t\t\tthis.workerPool[ i ].terminate();\n\n\t\t}\n\n\t\tthis.workerPool.length = 0;\n\n\t\tif ( this.workerSourceURL !== '' ) {\n\n\t\t\tURL.revokeObjectURL( this.workerSourceURL );\n\n\t\t}\n\n\t\treturn this;\n\n\t}\n\n}\n\n/* WEB WORKER */\n\nfunction DRACOWorker() {\n\n\tlet decoderConfig;\n\tlet decoderPending;\n\n\tonmessage = function ( e ) {\n\n\t\tconst message = e.data;\n\n\t\tswitch ( message.type ) {\n\n\t\t\tcase 'init':\n\t\t\t\tdecoderConfig = message.decoderConfig;\n\t\t\t\tdecoderPending = new Promise( function ( resolve/*, reject*/ ) {\n\n\t\t\t\t\tdecoderConfig.onModuleLoaded = function ( draco ) {\n\n\t\t\t\t\t\t// Module is Promise-like. Wrap before resolving to avoid loop.\n\t\t\t\t\t\tresolve( { draco: draco } );\n\n\t\t\t\t\t};\n\n\t\t\t\t\tDracoDecoderModule( decoderConfig ); // eslint-disable-line no-undef\n\n\t\t\t\t} );\n\t\t\t\tbreak;\n\n\t\t\tcase 'decode':\n\t\t\t\tconst buffer = message.buffer;\n\t\t\t\tconst taskConfig = message.taskConfig;\n\t\t\t\tdecoderPending.then( ( module ) => {\n\n\t\t\t\t\tconst draco = module.draco;\n\t\t\t\t\tconst decoder = new draco.Decoder();\n\t\t\t\t\tconst decoderBuffer = new draco.DecoderBuffer();\n\t\t\t\t\tdecoderBuffer.Init( new Int8Array( buffer ), buffer.byteLength );\n\n\t\t\t\t\ttry {\n\n\t\t\t\t\t\tconst geometry = decodeGeometry( draco, decoder, decoderBuffer, taskConfig );\n\n\t\t\t\t\t\tconst buffers = geometry.attributes.map( ( attr ) => attr.array.buffer );\n\n\t\t\t\t\t\tif ( geometry.index ) buffers.push( geometry.index.array.buffer );\n\n\t\t\t\t\t\tself.postMessage( { type: 'decode', id: message.id, geometry }, buffers );\n\n\t\t\t\t\t} catch ( error ) {\n\n\t\t\t\t\t\tconsole.error( error );\n\n\t\t\t\t\t\tself.postMessage( { type: 'error', id: message.id, error: error.message } );\n\n\t\t\t\t\t} finally {\n\n\t\t\t\t\t\tdraco.destroy( decoderBuffer );\n\t\t\t\t\t\tdraco.destroy( decoder );\n\n\t\t\t\t\t}\n\n\t\t\t\t} );\n\t\t\t\tbreak;\n\n\t\t}\n\n\t};\n\n\tfunction decodeGeometry( draco, decoder, decoderBuffer, taskConfig ) {\n\n\t\tconst attributeIDs = taskConfig.attributeIDs;\n\t\tconst attributeTypes = taskConfig.attributeTypes;\n\n\t\tlet dracoGeometry;\n\t\tlet decodingStatus;\n\n\t\tconst geometryType = decoder.GetEncodedGeometryType( decoderBuffer );\n\n\t\tif ( geometryType === draco.TRIANGULAR_MESH ) {\n\n\t\t\tdracoGeometry = new draco.Mesh();\n\t\t\tdecodingStatus = decoder.DecodeBufferToMesh( decoderBuffer, dracoGeometry );\n\n\t\t} else if ( geometryType === draco.POINT_CLOUD ) {\n\n\t\t\tdracoGeometry = new draco.PointCloud();\n\t\t\tdecodingStatus = decoder.DecodeBufferToPointCloud( decoderBuffer, dracoGeometry );\n\n\t\t} else {\n\n\t\t\tthrow new Error( 'THREE.DRACOLoader: Unexpected geometry type.' );\n\n\t\t}\n\n\t\tif ( ! decodingStatus.ok() || dracoGeometry.ptr === 0 ) {\n\n\t\t\tthrow new Error( 'THREE.DRACOLoader: Decoding failed: ' + decodingStatus.error_msg() );\n\n\t\t}\n\n\t\tconst geometry = { index: null, attributes: [] };\n\n\t\t// Gather all vertex attributes.\n\t\tfor ( const attributeName in attributeIDs ) {\n\n\t\t\tconst attributeType = self[ attributeTypes[ attributeName ] ];\n\n\t\t\tlet attribute;\n\t\t\tlet attributeID;\n\n\t\t\t// A Draco file may be created with default vertex attributes, whose attribute IDs\n\t\t\t// are mapped 1:1 from their semantic name (POSITION, NORMAL, ...). Alternatively,\n\t\t\t// a Draco file may contain a custom set of attributes, identified by known unique\n\t\t\t// IDs. glTF files always do the latter, and `.drc` files typically do the former.\n\t\t\tif ( taskConfig.useUniqueIDs ) {\n\n\t\t\t\tattributeID = attributeIDs[ attributeName ];\n\t\t\t\tattribute = decoder.GetAttributeByUniqueId( dracoGeometry, attributeID );\n\n\t\t\t} else {\n\n\t\t\t\tattributeID = decoder.GetAttributeId( dracoGeometry, draco[ attributeIDs[ attributeName ] ] );\n\n\t\t\t\tif ( attributeID === - 1 ) continue;\n\n\t\t\t\tattribute = decoder.GetAttribute( dracoGeometry, attributeID );\n\n\t\t\t}\n\n\t\t\tgeometry.attributes.push( decodeAttribute( draco, decoder, dracoGeometry, attributeName, attributeType, attribute ) );\n\n\t\t}\n\n\t\t// Add index.\n\t\tif ( geometryType === draco.TRIANGULAR_MESH ) {\n\n\t\t\tgeometry.index = decodeIndex( draco, decoder, dracoGeometry );\n\n\t\t}\n\n\t\tdraco.destroy( dracoGeometry );\n\n\t\treturn geometry;\n\n\t}\n\n\tfunction decodeIndex( draco, decoder, dracoGeometry ) {\n\n\t\tconst numFaces = dracoGeometry.num_faces();\n\t\tconst numIndices = numFaces * 3;\n\t\tconst byteLength = numIndices * 4;\n\n\t\tconst ptr = draco._malloc( byteLength );\n\t\tdecoder.GetTrianglesUInt32Array( dracoGeometry, byteLength, ptr );\n\t\tconst index = new Uint32Array( draco.HEAPF32.buffer, ptr, numIndices ).slice();\n\t\tdraco._free( ptr );\n\n\t\treturn { array: index, itemSize: 1 };\n\n\t}\n\n\tfunction decodeAttribute( draco, decoder, dracoGeometry, attributeName, attributeType, attribute ) {\n\n\t\tconst numComponents = attribute.num_components();\n\t\tconst numPoints = dracoGeometry.num_points();\n\t\tconst numValues = numPoints * numComponents;\n\t\tconst byteLength = numValues * attributeType.BYTES_PER_ELEMENT;\n\t\tconst dataType = getDracoDataType( draco, attributeType );\n\n\t\tconst ptr = draco._malloc( byteLength );\n\t\tdecoder.GetAttributeDataArrayForAllPoints( dracoGeometry, attribute, dataType, byteLength, ptr );\n\t\tconst array = new attributeType( draco.HEAPF32.buffer, ptr, numValues ).slice();\n\t\tdraco._free( ptr );\n\n\t\treturn {\n\t\t\tname: attributeName,\n\t\t\tarray: array,\n\t\t\titemSize: numComponents\n\t\t};\n\n\t}\n\n\tfunction getDracoDataType( draco, attributeType ) {\n\n\t\tswitch ( attributeType ) {\n\n\t\t\tcase Float32Array: return draco.DT_FLOAT32;\n\t\t\tcase Int8Array: return draco.DT_INT8;\n\t\t\tcase Int16Array: return draco.DT_INT16;\n\t\t\tcase Int32Array: return draco.DT_INT32;\n\t\t\tcase Uint8Array: return draco.DT_UINT8;\n\t\t\tcase Uint16Array: return draco.DT_UINT16;\n\t\t\tcase Uint32Array: return draco.DT_UINT32;\n\n\t\t}\n\n\t}\n\n}\n\nexport { DRACOLoader };\n","import * as THREE from 'three'\nimport { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js'\nimport { DRACOLoader } from 'three/addons/loaders/DRACOLoader.js'\nimport assetStore from './AssetStore.js'\n\nexport default class AssetLoader {\n    constructor() {\n        this.assetStore = assetStore.getState()\n        this.assetsToLoad = this.assetStore.assetsToLoad\n        this.addLoadedAsset = this.assetStore.addLoadedAsset\n        this.loadingProgress = {}\n        \n        this.instantiateLoaders()\n        this.startLoading()\n    }\n\n    instantiateLoaders() {\n        const dracoLoader = new DRACOLoader()\n        // Update path to match GitHub Pages structure\n        const basePath = import.meta.env.DEV ? '/draco/' : '/folio_3js/draco/'\n        dracoLoader.setDecoderPath(basePath)\n\n        this.gltfLoader = new GLTFLoader()\n        this.gltfLoader.setDRACOLoader(dracoLoader)\n        this.textureLoader = new THREE.TextureLoader()\n\n        // Optional: Log decoder path in development\n        if (import.meta.env.DEV) {\n            console.log('Draco decoder path:', basePath)\n        }\n    }\n\n    updateLoadingProgress(assetId, progress) {\n        this.loadingProgress[assetId] = progress\n        const totalProgress = Object.values(this.loadingProgress).reduce((a, b) => a + b, 0)\n        const averageProgress = totalProgress / this.assetsToLoad.length\n        \n        // If you have a loading UI, you can update it here\n        if (import.meta.env.DEV) {\n            console.log(`Overall loading progress: ${Math.round(averageProgress)}%`)\n        }\n    }\n\n    getAssetPath(path) {\n        // Handle paths for both development and production\n        return import.meta.env.DEV ? path : `/folio_3js${path}`\n    }\n\n    startLoading() {\n        this.assetsToLoad.forEach((asset) => {\n            const assetPath = this.getAssetPath(asset.path)\n            \n            const onError = (error) => {\n                console.error(`Error loading asset ${asset.id}:`, error)\n                if (this.assetStore.setLoadingError) {\n                    this.assetStore.setLoadingError(asset.id, error)\n                }\n            }\n\n            const onProgress = (progress) => {\n                if (progress.lengthComputable) {\n                    const percentComplete = (progress.loaded / progress.total) * 100\n                    this.updateLoadingProgress(asset.id, percentComplete)\n                }\n            }\n\n            if (asset.type === 'texture') {\n                this.textureLoader.load(\n                    assetPath,\n                    (loadedAsset) => {\n                        this.addLoadedAsset(loadedAsset, asset.id)\n                        this.updateLoadingProgress(asset.id, 100)\n                    },\n                    onProgress,\n                    onError\n                )\n            }\n\n            if (asset.type === 'model') {\n                this.gltfLoader.load(\n                    assetPath,\n                    (loadedAsset) => {\n                        this.addLoadedAsset(loadedAsset, asset.id)\n                        this.updateLoadingProgress(asset.id, 100)\n                        \n                        if (import.meta.env.DEV) {\n                            console.log(`Loaded model: ${asset.id}`)\n                        }\n                    },\n                    onProgress,\n                    onError\n                )\n            }\n        })\n    }\n\n    // Utility method to check if all assets are loaded\n    areAllAssetsLoaded() {\n        const loadedCount = Object.keys(this.assetStore.loadedAssets).length\n        return loadedCount === this.assetsToLoad.length\n    }\n\n    // Utility method to get loading status\n    getLoadingStatus() {\n        return {\n            totalAssets: this.assetsToLoad.length,\n            loadedAssets: Object.keys(this.assetStore.loadedAssets).length,\n            progress: this.loadingProgress,\n            isComplete: this.areAllAssetsLoaded()\n        }\n    }\n}","import assetStore from '../Utils/AssetStore.js'\nimport { appStateStore } from '../Utils/Store.js'\n\nexport default class Preloader {\n    constructor() {\n        this.assetStore = assetStore\n\n        // access to DOM elements\n        this.overlay = document.querySelector('.overlay')\n        this.loading = document.querySelector('.loading')\n        this.startButton = document.querySelector('.start')\n\n        this.assetStore.subscribe((state) =>{\n            this.numberOfLoadedAssets = Object.keys(state.loadedAssets).length\n            this.numberOfAssetsToLoad = state.assetsToLoad.length\n            this.progress = this.numberOfLoadedAssets / this.numberOfAssetsToLoad\n            this.progress = Math.trunc(this.progress * 100)\n            document.getElementById('progressPercentage').innerHTML = this.progress\n\n            if (this.progress === 100) {\n                appStateStore.setState({assetsReady: true})\n                this.loading.classList.add('fade')\n                window.setTimeout(() => this.ready(), 1200)\n            }\n        })\n    }\n\n    ready() {\n        this.loading.remove()\n\n        this.startButton.style.display = 'inline'\n        this.startButton.classList.add('fadeIn')\n\n        this.startButton.addEventListener('click', () => {\n            this.overlay.classList.add('fade')\n            this.startButton.classList.add('fadeOut')\n            \n            // Show the permanent controls\n            document.querySelector('.permanent-controls').classList.add('show')\n\n            window.setTimeout(() => {\n                this.overlay.remove()\n                this.startButton.remove()\n            }, 2000)\n        }, {once: true})\n    }\n}","import { inputStore } from \"../Utils/Store.js\";\n\nexport default class InputController {\n  constructor() {\n    this.inputStore = inputStore;\n    this.keyPressed = {};\n    this.touchActive = false;\n    \n    this.startListening();\n    this.setupTouchControls();\n  }\n\n  startListening() {\n    window.addEventListener(\"keydown\", (event) => this.onKeyDown(event));\n    window.addEventListener(\"keyup\", (event) => this.onKeyUp(event));\n  }\n\n  setupTouchControls() {\n    const dpad = document.querySelector('.dpad');\n    const center = { x: 75, y: 75 }; // Center of the 150x150 dpad\n    const deadzone = 20; // Minimum distance from center to trigger movement\n\n    const handleTouch = (e) => {\n      e.preventDefault();\n      const touch = e.touches[0];\n      if (!touch) return;\n\n      const rect = dpad.getBoundingClientRect();\n      const x = touch.clientX - rect.left - center.x;\n      const y = touch.clientY - rect.top - center.y;\n      \n      const distance = Math.sqrt(x * x + y * y);\n      if (distance < deadzone) {\n        this.resetDirections();\n        return;\n      }\n\n      const angle = Math.atan2(y, x);\n      const degrees = angle * (180 / Math.PI);\n\n      // Reset all directions\n      this.resetDirections();\n\n      // Highlight arrows based on direction\n      const arrows = {\n        up: document.querySelector('.up-arrow'),\n        right: document.querySelector('.right-arrow'),\n        down: document.querySelector('.down-arrow'),\n        left: document.querySelector('.left-arrow')\n      };\n\n      // Handle 8-way movement\n      if (degrees > -112.5 && degrees <= -67.5) {\n        // Up\n        inputStore.setState({ forward: true });\n        arrows.up.classList.add('active');\n      } else if (degrees > -67.5 && degrees <= -22.5) {\n        // Up-right\n        inputStore.setState({ forward: true, right: true });\n        arrows.up.classList.add('active');\n        arrows.right.classList.add('active');\n      } else if (degrees > -22.5 && degrees <= 22.5) {\n        // Right\n        inputStore.setState({ right: true });\n        arrows.right.classList.add('active');\n      } else if (degrees > 22.5 && degrees <= 67.5) {\n        // Down-right\n        inputStore.setState({ backward: true, right: true });\n        arrows.down.classList.add('active');\n        arrows.right.classList.add('active');\n      } else if (degrees > 67.5 && degrees <= 112.5) {\n        // Down\n        inputStore.setState({ backward: true });\n        arrows.down.classList.add('active');\n      } else if (degrees > 112.5 && degrees <= 157.5) {\n        // Down-left\n        inputStore.setState({ backward: true, left: true });\n        arrows.down.classList.add('active');\n        arrows.left.classList.add('active');\n      } else if ((degrees > 157.5 && degrees <= 180) || (degrees <= -157.5 && degrees >= -180)) {\n        // Left\n        inputStore.setState({ left: true });\n        arrows.left.classList.add('active');\n      } else if (degrees > -157.5 && degrees <= -112.5) {\n        // Up-left\n        inputStore.setState({ forward: true, left: true });\n        arrows.up.classList.add('active');\n        arrows.left.classList.add('active');\n      }\n    };\n\n    dpad.addEventListener('touchstart', handleTouch);\n    dpad.addEventListener('touchmove', handleTouch);\n    dpad.addEventListener('touchend', () => {\n      this.resetDirections();\n      document.querySelectorAll('.dpad-arrow').forEach(arrow => {\n        arrow.classList.remove('active');\n      });\n    });\n  }\n\n  resetDirections() {\n    inputStore.setState({\n      forward: false,\n      backward: false,\n      left: false,\n      right: false\n    });\n  }\n\n  onKeyDown(event) {\n    if (!this.keyPressed[event.code]) {\n      switch (event.code) {\n        case \"KeyW\":\n        case \"ArrowUp\":\n          inputStore.setState({ forward: true });\n          break;\n        case \"KeyA\":\n        case \"ArrowLeft\":\n          inputStore.setState({ left: true });\n          break;\n        case \"KeyS\":\n        case \"ArrowDown\":\n          inputStore.setState({ backward: true });\n          break;\n        case \"KeyD\":\n        case \"ArrowRight\":\n          inputStore.setState({ right: true });\n          break;\n      }\n      this.keyPressed[event.code] = true;\n    }\n  }\n\n  onKeyUp(event) {\n    switch (event.code) {\n      case \"KeyW\":\n      case \"ArrowUp\":\n        inputStore.setState({ forward: false });\n        break;\n      case \"KeyA\":\n      case \"ArrowLeft\":\n        inputStore.setState({ left: false });\n        break;\n      case \"KeyS\":\n      case \"ArrowDown\":\n        inputStore.setState({ backward: false });\n        break;\n      case \"KeyD\":\n      case \"ArrowRight\":\n        inputStore.setState({ right: false });\n        break;\n    }\n    this.keyPressed[event.code] = false;\n  }\n}","export default class ModalManager {\n    constructor() {\n        this.modal = document.getElementById(\"myModal\");\n        this.modalWrapper = document.querySelector(\".modal-wrapper\");\n        this.close = document.querySelector(\".close\");\n        this.title = document.getElementById(\"modalTitle\");\n        this.description = document.getElementById(\"modalDescription\");\n        this.isOpen = false;\n\n        // Bind event handlers\n        this.close.onclick = () => this.closeModal();\n        this.modal.onclick = (event) => {\n            if (event.target === this.modal) {\n                this.closeModal();\n            }\n        };\n\n        // Handle escape key\n        document.addEventListener('keydown', (event) => {\n            if (event.key === 'Escape' && this.isOpen) {\n                this.closeModal();\n            }\n        });\n\n        this.cooldown = false;\n    }\n\n    openModal(title, description) {\n        if (this.cooldown) return;\n        \n        // Update content\n        this.title.innerHTML = title;\n        this.description.innerHTML = description;\n\n        // Show modal with animation\n        this.modal.style.display = \"block\";\n        this.modal.offsetHeight; // Force reflow\n        this.modal.classList.remove('fadeOut');\n        this.modal.classList.add('fadeIn');\n        \n        this.isOpen = true;\n\n        // Add cooldown to prevent spam\n        this.cooldown = true;\n        setTimeout(() => {\n            this.cooldown = false;\n        }, 1000);\n    }\n\n    closeModal() {\n        if (!this.isOpen) return;\n\n        this.modal.classList.remove('fadeIn');\n        this.modal.classList.add('fadeOut');\n\n        setTimeout(() => {\n            this.modal.style.display = \"none\";\n            this.modal.classList.remove('fadeOut');\n        }, 600);\n\n        this.isOpen = false;\n    }\n}","import * as THREE from 'three'\nimport Camera from './Camera.js'\nimport Renderer from './Renderer.js'\nimport Loop from './Utils/Loop.js'\nimport GUI from './Utils/GUI.js'\nimport World from './World/World.js'\nimport Resize from './Utils/Resize.js'\nimport AssetLoader from './Utils/AssetLoader.js'\nimport Preloader from './UI/Preloader.js'\nimport InputController from './UI/InputController.js'\nimport ModalManager from './UI/ModalManager.js'\n\nlet instance = null\n\nexport default class App {\n    constructor() {\n        if(instance) return instance\n        instance = this\n\n        // threejs elements\n        this.canvas = document.querySelector(\"canvas.threejs\");\n        this.scene = new THREE.Scene()\n\n        // add debug GUI\n        this.gui = new GUI()\n\n        // Asset Loader\n        this.assetLoader = new AssetLoader()\n\n        // UI\n        this.preloader = new Preloader()\n        this.inputController = new InputController()\n        this.modalManager = new ModalManager()  // Add this line\n\n        // World\n        this.world = new World()\n\n        // Camera and Renderer\n        this.camera = new Camera()\n        this.renderer = new Renderer()\n\n        // extra utils\n        this.loop = new Loop()\n        this.resize = new Resize()\n    }\n}","import './style.css'\nimport App from './App/App.js'\n\nconst app = new App()\n"],"file":"assets/index-5e61279b.js"}