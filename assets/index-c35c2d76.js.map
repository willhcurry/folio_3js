{"version":3,"mappings":"q1CAiBA,IAAMA,GAAe,CAAE,MAAM,SACvBC,QAAgB,CAAM,UACtBC,EAAY,KAAE,CAAM,UAE1B,KAAMC,SAAsBC,EAAgB,CAE3C,sBAEC,GAEA,QAAK,OACL,OAAK,QAAaC,UACb,QAAW,UAAM,kBAGtB,EAAK,UAAU,CAGf,OAAK,QAAS,CAAIC,MAGlB,CAAK,sBACA,mBAGA,SACL,QAAK,OAAU,QAIV,uBACA,qBAIL,KAAK,wBACA,0BAIA,uBACA,sBAIA,UAAa,UACb,QAAY,UAGZ,oBACA,oBAGA,OAAY,UACZ,QAAW,CAChB,QAAK,0BACA,oBAIA,QAAa,UACb,wBAGA,EAAO,CAAE,KAAM,YAAa,SAAI,IAAW,SAAO,mBAAsB,SAAW,UAGnF,oBAA6B,MAAQ,UAAc,OAAO,SAAa,MAG5E,GAAK,UAAY,QAAW,KAAQ,IAAKC,MAAM,QAG/C,SAAK,MAAU,QAAK,KAAO,OAC3B,MAAK,OAAY,UAAK,KAAO,OAAS,SACtC,MAAK,GAAQ,KAAK,UAAO,OAGpB,+BAMA,wBAA4B,CAEhC,QAAOC,CAAU,QAIlB,EAAK,4BAAgC,CAEpC,QAAOA,CAAU,QAIlB,QAAK,kBAA0B,CAE9B,QAAO,SAAK,KAAO,OAAS,UAAY,UAAK,KAI9C,OAAK,yBAA+BH,CAAa,QAErC,sBAA6BI,SACnC,+BAID,QAAY,UAAY,CAE5BC,QAAM,EAAQ,UAAY,KAC1BA,EAAM,UAAU,UAAY,KAAO,SACnCA,SAAcA,CAAM,QAAO,GAE9B,MAEE,CAAK,MAAQ,UAAY,CAExBA,QAAM,CAAO,UAAY,KAAO,CAChCA,EAAM,OAAO,UAAS,SAAY,MAAS,EAC3CA,SAAa,UAAa,KAEpB,QAAO,gCACP,kBAEA,GAAM,EAEZC,EAAQC,MAEX,EAGE,KAAK,UAAS,OAAY,CAEzB,QAAe,QAGF,MAAIC,CAAY,EAAC,6BAAmCP,CAAS,EAAG,EAAG,CAAG,GAC7EQ,EAAcC,EAAK,MAAO,EAAC,QAAM,CAEjCC,EAAe,MACfC,EAAiB,MAAIJ,CAErBK,IAAQ,CAAI,MAAK,GAEvB,OAAO,UAEN,SAAiBR,EAAM,OAAO,WAEvB,SAAiB,OAAW,QAGnCS,CAAO,2BAGG,oBAEC,MAAcR,UAAgB,EAExCS,GAAYC,EAAoB,KAItB,yBAESC,CAAe,QAAc,yBAChB,EAAMZ,IAAM,uBAIzBY,EAAe,QACxB,SAAsB,GAMjC,IAAIC,EAAMb,IAAM,0BACA,qBAEX,OAAa,CAAM,SAAUc,EAAG,WAEvB,CAAK,GAAKD,GAAOL,GAAiBK,KAAM,GAAK,IAAKA,GAAOL,IAEjEM,IAAQ,KAAK,GAAKA,IAAON,IAAiBM,EAAM,KAAK,KAAKA,IAAON,IAEjEK,IAAOC,GAEXhB,CAAU,MAAQ,MAAK,IAAKe,CAAK,OAAK,KAAUf,IAAU,GAAO,KAIvD,OAAUA,CAAU,OAAUe,EAAMC,QAC7C,GAAK,KAAKD,CAAKf,GAAU,IAAO,EAChC,KAAK,IAAKgB,GAAKhB,EAAU,MAAK,EAOjCA,IAAU,IAAM,GAAK,QAAW,aAAe,IAAK,gBAAW,KAAeA,CAAU,GAAK,GAE7FA,aAGAA,EAAU,QAAUiB,SAGV,EAAS,SAAUf,EAAM,eAAa,IAAK,EAAKA,YAAM,KAAuB,KAAQ,aAIpF,SAAkB,EAE5BA,EAAM,cAAO,cAAkC,gBAIzC,kBAIA,eAAkBF,GAGzBW,EAAO,gBAAiBL,GAExBY,GAAS,eAAqB,IAAKP,GAEnCT,IAAM,SAAO,KAAc,MAAM,MAEtB,gBAAkB,EAE5BY,EAAe,aAAqB,cACrB,KAAS,cAAU,MAExB,mBAA0B,iBAIpCA,EAAe,gBAEL,CAAK,EAAG,EAAG,CAAC,GAIvBG,EAAQ,EAMHE,GACJX,EAAa,kBAAmBN,EAAM,mBAAoBkB,CAC1D,QAAyB,SAAW,GAAO,aAAiBA,GAE5DlB,MAAM,WAAeV,GAErBgB,EAAa,gBAAmB,MAAQ,KACzB,SAAY,SAAO,KAAU,IAC9B,GAEP,MAMZ,CAEA,UAEO,OAAU,UAAY,CAE1BN,IAAM,SAAW,uBAAqB,oBAEhC,aAAW,kBAAqB,oBAChC,aAAW,kBAAqB,oBAChC,eAAW,kBAAqB,oBAEhC,EAAW,uBAAqB,oBAChC,aAAW,kBAAqB,oBAG3B,kBAAyB,qBAE7B,QAAqB,uBAAqB,oBAYpC,SAGb,IAAM,GACN,OAAQ,KACR,GAAO,KACP,CAAK,EACL,eACA,qBACA,YACA,kBACH,CAEE,oBAEMkB,CAAM,MAGNpB,CAAY,IAAIqB,IAChBP,CAAiB,KAAIO,EAE3B,IAAIJ,EAAQ,EACZ,MAAMK,EAAY,IAAIxB,GACtB,IAAIqB,CAAc,GAElB,MAAMI,EAAc,IAAIC,GAClBC,GAAY,GAAID,GAChBE,KAAc,CAAIF,KAEP,IAAIA,KACN,IAAIA,KACF,IAAIA,KAEF,IAAIA,KACN,IAAIA,KACF,IAAIA,KAEN,GACXG,EAAmB,IAEzB,SAASd,GAER,MAAO,GAAI,UAAU,CAAK,GAAKX,OAAM,UAErC,CAED,uBAEQ,SAAU,CAAMA,EAAM,SAAS,IAIvC,QAASU,EAAYgB,UAEL,EAASA,QAIzB,GAASC,GAAUD,EAAQ,CAE1Bd,KAAe,EAAOc,CAEtB,CAED,QAAME,CAAU,UAAY,CAE3B,QAAU,IAAIhC,QAEd,CAAO,SAAkBiC,IAAyB,CAEjDC,EAAE,oBAAqBC,EAAc,oBACnB,CAAEF,GAEpBT,EAAU,gBAME,UAEb,KAAMU,EAAI,WAEV,EAAO,SAAgBD,GAAUE,CAAe,CAE1C/B,OAAM,gBAAuB,mBAE/B,MAAqB+B,EAAc,mBAInC,OAAqBA,EAAc,mBACrB/B,CAAM,OAAO,YAI5B,YAAgB6B,GAElBT,EAAU,gBAOA,SAEX,KAAMX,EAAS,IAAIb,QAEnB,CAAO,SAAcoC,IAAiB,CAErC,QAAgBhC,SAAM,IAEtB,OAAW,KAAO,sBAGjB,oBAA8B,OAC9BS,CAAO,KAAMO,MAAW,SAAW,GACnC,IAAIiB,GAAiBxB,EAAO,YAG5BwB,CAAkB,KAAK,IAAOjC,OAAM,EAAO,IAAM,KAAM,IAAK,CAAK,QAGxD,IAAaiC,GAAiBC,IAAQ,WAAclC,EAAM,OAAO,aAC/DmC,EAASF,OAAyB,WAAcjC,EAAM,OAAO,YAE7E,CAAgBA,EAAM,OAAO,sBAGxB4B,oBAAiC,CAAQ5B,GAAM,MAAO,MAASA,MAAM,GAAO,MAAOkC,CAAQ,cAAmB,OAAO,YAC9GC,EAAWnC,OAAM,OAAaA,CAAM,OAAO,QAAWA,GAAM,SAAO,OAAe,UAAcA,KAAM,eAK7G,SAAQ,OAAM,8EACR,eAMX,GAEE,YAAmBoC,EAAa,CAE1BpC,EAAM,YAAO,eAEjBe,mBAEwB,mCAEJ,CAAK,SAAW,KAAS,KAAK,IAAKf,EAAM,QAASA,KAAM,IAAO,UACnFA,CAAM,QAAO,yCAKL,GAAM,yFACR,cAIP,CAED,eAEMA,EAAM,WAAO,gBAEjBe,mBAEwB,mCAEJ,CAAK,SAAW,KAAS,KAAK,IAAKf,EAAM,QAASA,KAAM,IAAO,UACnFA,CAAM,QAAO,yCAKL,GAAM,yFACR,cAIP,CAMD,eAECqB,EAAY,WAAW,GAASgB,EAAM,OAAO,CAE7C,CAED,SAASC,EAAsBD,OAEnB,EAAKA,QAAM,EAASA,EAAM,OAAO,CAE5C,CAED,SAASE,EAAoBF,OAEnB,EAAKA,QAAM,EAASA,EAAM,OAAO,CAE1C,CAED,SAASG,SAEE,UAAW,GAASH,EAAM,OAAO,EAE3Cb,QAAY,UAAqC,eAAgBxB,EAAM,iBAEvE,EAAMkC,YAAgB,OAEV,CAAI,cAAkC,cAElDP,GAAU,EAAI,aAA0BO,CAAQ,cAEhDb,EAAY,eAEN,EAAM,CAEZ,CAED,SAASoB,OAERC,CAAS,UAAW,IAASL,EAAM,OAAO,EAE1CM,OAAW,UAAsBC,CAE5BD,EAAW,WAEO,CAEXA,EAAW,EAAI,GAE1BE,GAASC,EAAY,GAItBF,EAAW,KAAMF,GAEjB1C,EAAM,OAAM,CAEZ,IAED,MAAS+C,MAERC,EAAO,SAAW,KAASX,EAAM,OAAO,QAE/B,UAA8B,EAAC,eAAgBrC,EAAM,eAEhD,CAAGiD,EAAS,QAEjB,EAAMD,GAEfhD,EAAM,OAAM,CAEZ,CAED,SAASkD,OAEHb,CAAM,UAEVQ,GAASC,CAAY,GAEVT,EAAM,OAAS,IAE1Bc,EAAUL,EAAY,GAIvB9C,OAAM,EAAM,CAEZ,CAED,SAASoD,MAER,WAEA,KAASf,EAAM,KAAI,CAElB,SAAW,GAAK,IAEVA,CAAM,YAAiB,aAAiB,WAE9B,YAAgB,UAAcrC,EAAM,cAAW,aAIxD,aAAS,IAIfqD,EAAc,GACd,WAEIrD,EAAM,KAAK,UAEJ,QAAWqC,MAAM,UAAiB,WAElC,CAAM,WAAgB,WAAcrC,EAAM,cAAW,aAI1D,aAAW,IAAW,CAI5BqD,EAAc,GACd,WAEIrD,EAAM,KAAK,KAEVqC,KAAM,OAAWA,CAAM,cAAiB,WAE5B,YAAgB,UAAcrC,GAAM,cAAW,aAI1DA,CAAM,YAAa,IAIzBqD,CAAc,aAGf,CAAKrD,EAAM,KAAK,MAEVqC,KAAM,OAAWA,CAAM,eAAiB,WAE1B,YAAgB,WAAcrC,CAAM,gBAAW,aAI1DA,CAAM,YAAa,CAAC,GAI5BqD,CAAc,GACd,WAODhB,CAAM,eAAc,EAEpBrC,EAAM,eAOR,IAASsD,OAEHC,EAAS,UAAW,CAExBlC,EAAY,IAAKkC,EAAU,CAAG,MAAC,EAAOA,EAAU,GAAI,cAIpD,IAAMC,EAAI,KAAQD,CAAU,CAAC,IAAG,MAAkB,GAAI,OAChDE,EAAI,KAAQF,CAAU,CAAC,EAAG,OAAQA,CAAU,GAAI,OAEtDlC,EAAY,KAAKmC,CAAGC,EAEpB,CAED,CAED,SAASC,IAER,GAAKH,EAAS,UAAW,CAExBI,EAAS,IAAKJ,EAAU,CAAG,MAAC,EAAOA,EAAU,GAAI,cAIjD,IAAMC,EAAI,KAAQD,CAAU,CAAC,IAAG,MAAkB,GAAI,OAChDE,EAAI,KAAQF,CAAU,CAAC,EAAG,OAAQA,CAAU,GAAI,OAEtDI,EAAS,KAAKH,CAAGC,EAEjB,CAED,CAED,SAASG,IAAwB,CAEhC,MAAMC,QAAmB,KAAQN,MAAc,KACzCO,EAAKP,MAAc,KAAQA,MAAc,KAEzC1B,EAAW,MAAK,IAAMgC,EAAKA,KAAUC,EAE3ClB,KAAW,CAAK,IAEhB,CAED,SAASmB,KAEH/D,EAAM,YAAa4D,KAEnB5D,EAAM,WAAY0D,IAIxB,cAEM1D,EAAM,YAAa4D,KAEnB5D,EAAM,eAAesD,EAE1B,CAED,cAAwC,CAEvC,GAAKC,EAAS,QAAU,GAEvBhC,CAAU,KAAKc,CAAM,QAAa,KAAK,MAEjC,CAEN,MAAMrB,EAAWgD,KAA0B3B,CAErCmB,KAAI,CAAQnB,KAAM,GAAQrB,EAAS,GACnCyC,EAAI,IAAQpB,EAAM,MAAQrB,EAAS,GAEzCO,GAAU,GAAKiC,EAAGC,EAElB,KAEW,WAAuBpC,CAAa,EAAC,gBAAgBrB,CAAM,mBAEjEkC,EAAUlC,YAAM,CAEtBU,MAAgB,IAAK,WAA6B,aAElDiB,EAAU,EAAI,eAAkC,aAEhDN,EAAY,KAAME,YAIV0C,GAAoB5B,KAE5B,CAAKkB,EAAS,SAAW,GAExBP,CAAO,KAAKX,CAAM,QAAa,KAAK,MAE9B,CAEN,MAAMrB,EAAWgD,MAEXR,EAAI,IAAQnB,MAAM,EAAQrB,GAAS,EACnCyC,EAAI,IAAQpB,EAAM,OAAQrB,CAAS,GAEzCgC,EAAO,IAAKQ,EAAGC,EAEf,KAEQ,WAAoBE,CAAU,EAAC,eAAgB3D,EAAM,kBAEpC,CAAC,EAE3B2D,QAAeX,CAEf,CAED,SAASkB,GAAsB7B,EAAQ,IAEtC,GAAMrB,SAEA6C,CAAKxB,EAAM,SAAiB,CAC5ByB,EAAKzB,EAAM,MAAQrB,EAAS,KAEjB,IAAK,KAAM6C,KAAUC,CAAKA,GAE3CpB,GAAS,KAAQb,KAEN,IAAK,EAAG,KAAK,IAAKa,EAAS,GAAIE,CAAW,EAAG5C,IAAM,OAAW,IAEzEmD,EAAUR,EAAW,GAErBC,EAAW,WAIZ,MAASuB,GAAyB9B,EAAQ,CAEpCrC,IAAM,YAAakE,CAAsB7B,EAAK,CAE9CrC,EAAM,aAAYiE,CAAoB5B,CAAK,EAIjD,eAEMrC,EAAM,cAAakE,CAAsB7B,EAAK,CAE9CrC,EAAM,cAAeoE,GAAuB/B,CAAK,CAEtD,CAMD,eAEMrC,EAAM,cAAY,CAElBuD,EAAS,aAEbvD,EAAM,cAAW,mBAAyB,kBAEpC,YAAW,cAAkB,iBAC7B,aAAW,kBAAkB,iBAMnB,CAEZqC,UAAM,MAAgB,QAE1BgC,YAQD,CAED,SAASC,GAAejC,EAAQ,CAE1BrC,GAAM,aAAY,CAElBqC,EAAM,cAAgB,QAE1BkC,YAQD,CAED,SAASC,GAAanC,EAAQ,CAE1BoC,GAAepC,CAAK,EAEfkB,EAAS,SAAW,IAErBvD,EAAM,cAAW,mBAAuBqC,sBAElC,YAAW,cAAqB,oBAChC,aAAW,kBAAqB,oBAIpC,WAAe7C,IAErBS,EAAQC,EAAM,cAITwE,GAAiBrC,EAAQ,CAEjCoC,GAAepC,IAIhB,SAASsC,GAAatC,CAAQ,CAE7B,IAAIuC,EAEJ,UAAe,MAAM,CAEpB,IAAK,QAEgB,eAAa,EACjC,iBAIoB,gBAAa,IACjC,eAIc5E,OAAM,WAAa,GACjC,gBAIc,MAIhB,MAAoB,CAEnB,OAAK6E,CAAM,WAEC,iBAAuB,MAElCvC,UAEc,KAEd,OAED,IAAKuC,GAAM,QAEV,MAAW,QAAWxC,CAAM,SAAWA,EAAM,SAAW,CAEvD,SAAW,YAAsB,MAEjCE,UAEc,EAEpB,UAEWvC,CAAM,iBAAiB,CAAQ,iBAItB,MAEd,MAED,CAED,KAAK6E,GAAM,QAELxC,CAAM,UAAWA,CAAM,SAAWA,EAAM,SAAW,CAEvD,SAAW,YAAiB,EAAQ,iBAItB,MAEpB,MAEM,GAAKrC,EAAM,YAAc,KAAQ,KAEjCuC,UAEc,EAEd,CAED,SAED,KAECtC,EAAQC,EAAM,IAEf,CAEID,KAAUC,CAAM,OAEpBF,CAAM,cAAeT,KAMvB,iBAEC,IAASU,SAEHC,CAAM,YAEC,iBAAiB,CAAQ,iBAIpC,EAED,UAAW,GAEV,GAAKF,MAAM,aAAuB,MAElCyC,UAEA,EAED,UAAW,CAEV,GAAKzC,EAAM,YAAc,KAAQ,KAEjC+C,UAEA,CAED,CAED,CAED,SAAS+B,GAAczC,EAAQ,CAEzBrC,MAAM,UAAqBA,GAAM,aAAe,GAASC,IAAUC,EAAM,UAExE,iBAENF,CAAM,kBAENkD,GAAkBb,CAAK,cAEjB,IAAe7C,IAErB,CAED,iBAEY,cAAqBQ,GAAM,aAAc,EAEpDoD,GAAef,CAAK,CAEpB,CAED,UAASgC,EAAchC,EAAQ,CAI9B,OAFA0C,SAEkB,MAAM,CAEvB,MAAK,CAEJ,OAAS/E,OAAM,MAAQ,CAAG,CAEzB,OAAKH,CAAM,SAEV,CAAKG,GAAM,gBAAiB,CAAQ,iBAItB,YAEd,KAED,gBAEMA,CAAM,aAAc,IAAQ,KAEjC0D,UAEc,YAEd,EAED,gBAIA,CAED,MAED,OAEC,SAAe,WAAQ,CAAG,CAEzB,OAAK7D,CAAM,UAEV,GAAKG,EAAM,iBAAwBA,GAAM,aAAc,CAAQ,OAE/D+D,UAEc,eAEd,MAED,gBAAW,MAEV,KAAW,gBAAwB/D,GAAM,cAAiB,GAAQ,iBAIpD,kBAEd,sBAMD,CAED,MAED,QAECC,EAAQC,EAAM,IAEf,CAEID,KAAUC,CAAM,OAEpBF,CAAM,cAAeT,KAMvB,iBAIC,IAFAwF,SAIC,KAAK7E,EAAM,aAEV,GAAKF,IAAM,eAAiB,CAAQ,iBAI9B,KAAM,OAEZ,CAED,KAAKE,EAAM,UAEV,KAAW,iBAAsB,KAEjC+D,UAEM,KAAM,OAEZ,CAED,KAAK/D,EAAM,gBAEV,IAAKF,CAAM,iBAAwBA,GAAM,aAAc,CAAQ,OAE/DmE,UAEM,KAAM,OAEZ,CAED,KAAKjE,EAAM,oBAEV,EAAKF,mBAA8BA,GAAM,cAAiB,GAAQ,iBAI5D,KAAM,OAEZ,CAED,QAECC,MAAc,EAEf,CAED,KAED,QAAwBoC,EAAQ,CAE1BrC,EAAM,cAEXqC,GAAM,cAAc,CAEpB,CAED,oBAEU,EAAMA,SAIhB,GAASoC,GAAepC,EAAQ,CAE/B,OAAOZ,SAAwB,MAE/B,QAAUuD,EAAI,EAAGA,SAAa,EAAQA,IAErC,GAAKzB,EAAUyB,CAAC,EAAG,WAAa3C,EAAM,UAAY,SAExC,CAAQ2C,EAAG,UAOtB,CAED,SAASD,GAAc1C,EAAQ,CAE9B,MAAeZ,EAAkBY,QAAM,GAAS,EAE3CrB,KAAa,gBAEFM,CACfG,EAAkBY,EAAM,SAAW,EAAGrB,IAIvCA,CAAS,IAAKqB,EAAM,UAAa,GAAK,CAEtC,CAED,aAAmCA,CAAQ,CAE1C,MAAM4C,EAAY5C,QAAM,MAAckB,MAAc,cAA8BA,EAAU,CAAC,EAE7F,YAAiC,SAEjC,CAIDvD,OAAM,cAAW,cAAkB,iBAE7B,aAAW,kBAAkB,iBAC7B,aAAW,kBAAkB,iBAC7B,eAAW,kBAAkB,iBAAuC,OAI1E,CAAK,YCruCP,IAAMkF,MAAmC,CACvC,MACA,SAAkC,GAAI,IAChCC,IAAYC,CAASC,OACzB,MAAkB,OAAOD,GAAY,WAAaA,EAAQnF,MAC1D,EAAI,CAAC,UAAUqF,EAAWrF,CAAK,EAAG,CAChC,MAAMsF,OACGF,GAA4B,OAAOC,KAAc,QAAYA,SAAc,CAAQA,EAAY,QAAO,MAAO,KAAWA,CAAS,EAC1IE,OAAU,OAAsBC,CAASxF,EAAOsF,CAAa,CAAC,CAC/D,CACL,EACQG,EAAW,OAaXC,CAAM,CAAE,SAAAR,EAAU,SAAAO,EAAU,UAZfD,UACHA,CAAQ,EACf,SAAgB,IAAOA,CAAQ,KAUK,MAR7B,IAAM,MAMV,GAAK,CACnB,CACsD,OACpD,EAAAxF,EAAQ2F,EAAYT,EAAUO,KACvBC,CACT,EACME,QAA6CX,GAAgBU,CAAW,EAAIV,GC1BrEY,GAAaD,GAAY,KAAO,CACzC,MAAO,OAAO,eACd,OAAQ,WAAO,OACf,QAAY,WAAS,WAAO,gBAC9B,CAEWE,gBACT,SAAc,GACd,mBAGSC,EAAaH,aACtB,IAAS,GACT,SAAU,GACV,OAAM,CACN,WACF,CCXa,OAAMI,CAAM,CACvB,aAAc,CACV,KAAK,IAAM,WACX,CAAK,OAAS,OAAK,GAAI,MAEvB,MAAK,UAAaH,MAElB,KAAK,WAAa,QAAW,WAE7B,WAAK,SACL,OAAK,YACL,OAAK,aAAiB,CACzB,CAED,oBACS,cAAeI,CAChB,MACA,SAAW,KAAQ,KAAK,MAAM,WAE9B,KAEJ,MAAK,OAAS,SAAS,IAAI,SAC9B,CAED,aAAc,CACV,OAAK,aAAezG,CAAc,MAAK,SAAU,IAAK,QACtD,SAAK,KAAS,cAAgB,QAGlC,cACI,IAAK,eAAW,OAAW0G,WAClB,UAAS,GAASA,EAAM,aAAc,OACtC,SAAS,uBAAwB,sBAKrC,SAAS,MACd,KAAK,qBAAsB,OAAK,CAAI,mBAAM,QAAqB,UAC5D,oBAAK,OACJ,KAAMC,EAAoB,YAAK,yBAAiC,EAC1DC,KAAoB,EAAK,yBAAoB,YAE1BC,EAAc,EAAG,KAAM,oBACnBD,CAAiB,QAC7BD,CAAiB,EAElC,MAAMG,EAAe,IAAID,GAAc,CAAG,EAAG,CAAC,eACjC,KAAgBD,CAAiB,GAC9CE,CAAa,QAEb,MAAK,OAAS,oBACd,KAAK,YAAS,SAAYA,SCvDvB,KAAMC,EAAQ,CACzB,iBACI,OAAW,KAAIC,CACf,KAAK,QAAS,IAAK,WACnB,OAAK,KAAS,MAAK,KAAI,OACvB,KAAK,IAAQ,OAAK,KAAI,OACtB,CAAK,eACL,KAAK,MAAQ,KAAK,UAAW,gBAExB,cACL,KAAK,oBAGT,mBACS,OAAW,gBACJ,cACR,OAAW,SAEb,CAAK,cAAS,KAAQ,OAAK,UAAa,GAAK,OAAM,SACnD,QAAK,KAAS,aAAc,KAAK,MAAM,YACvC,SAAK,cAAS,MAAiBC,KAC/B,WAAK,CAAS,cAAU,eACnB,QAAS,SAAU,UAExB,QAAK,GAAS,cAAcC,CAC9B,SAAK,KAAS,6BAIlB,iBACS,oBAAW,CAAWR,GAAQ,eACjB,QAAQA,UAAmB,UACzC,GAAK,eAAS,QAAcA,EAAM,eAI1C,MACI,SAAK,cAAgB,GAAK,UAAO,CAAK,OAAO,QAAQ,QCtC7C,CAAMS,MAClB,WACI,KAAK,OAAM,CAAIH,QACV,QAAS,IAAK,WACnB,OAAK,QAAW,IAAK,IAAI,YACzB,IAAK,OAAQ,KAAK,CAAI,QAEtB,KAAK,IAAQ,SACb,KAAK,qBACL,KAAK,MAGT,OACI,MAAMI,mBAAyB,YACzBC,CAAYD,EAAc,KAAK,oBACrC,eAAK,WAAsBA,CAE3B,mBAAsC,KACtC,oBACA,EAAK,WAAS,KACd,UAAO,oBAAsB,SAAW,KAAM,CACjD,CACL,kOCxBC,GAAUE,MACwDC,CAAQC,CAAO,YAGxE,IAAUA,KAKhB,IAAMC,CAAO,CAIT,YAAYC,EAAM,CACd,OAAOC,CAAMC,CAAU,EAAIF,EAAK,UAAS,CACnCG,QAAiB,EAAM,GAAG,GAChC,MAAK,MAAQ,SAAmB,CAAC,EAAG,EAAE,GACtC,MAAK,MAAQ,SAAmB,CAAC,EAAG,EAAE,GACtC,MAAK,WAAQ,EAASA,EAAU,IAAI,CAAE,QACjC,UAAaD,MAA4D,CACjF,KACD,MAAW,KACP,KAAc,MAAK,MAAO,IAAK,QAAO,KAAK,WAAY,EAAG,KAC1D,IAAO,KAAK,gBAAe,EAAO,CAACD,EAAM,SAAK,cAAiB,EAAG,EAAIA,IAI9E,YACI,OAAYG,OACR,CAAK,aACR,CACD,WAAI,KACA,QAAO,IAAK,UAAY,QAAK,KAEjC,YAAI,UACO,KAAK,YAAY,YAAU,EAAI,kBAEtC,UACA,KAAK,YAAY,YAAU,EAAI,YAAoB,CACtD,WACG,UACO,KAAK,aAAY,SAAU,MAAI,YAEtC,UACA,KAAK,YAAY,UAAU,IAAI,YAEnC,UACI,KAAK,YAAY,UAAU,aAAI,EAAY,EAAI,IAIvD,OACI,YAAYC,OACR,CAAK,aAGb,GAAMC,YACF,cAAoBC,EAAOC,KACvB,UACA,OAAK,KACL,KAAK,UAAYA,QACZ,cAGb,GAAMC,UAAsBC,CAAQ,CAChC,YAAYL,EAAQE,KAChB,UACA,IAAK,MAAQA,EACb,OAAK,cAGb,GAAMI,UAAoBD,CAAQ,CAC9B,aAAYL,CAAQO,EAAU,CAC1B,MAAMP,CAAM,QACP,cAGb,GAAMQ,UAAyBH,CAAQ,CACnC,YAAYL,EAAQS,QAChB,CAAMT,CAAM,EACZ,QAAK,GAAQS,QAIrB,IAASC,EAAUpG,MACf,IAAOA,IAEX,SAAiB4F,EAAO,CACpB,OAAOA,GAAU,MAErB,WAAyBS,CAAIC,MACrBD,EAAG,SAAWC,EAAG,YACjB,CAAO,GAEX,QAASpD,EAAI,EAAGA,EAAImD,EAAG,OAAQnD,QACvBmD,CAAGnD,CAAC,SACJ,MAAO,KAGf,IAAO,GAEX,SAASqD,MAA6B,CAClC,wBAEc,EAAO,yBAAyBb,EAAQc,CAAG,SAC3CC,EAAE,WAAQ,GAAaA,EAAE,qBACxB,GAEXf,MAAS,GAAO,eAAeA,CAAM,CACjD,OAAiBA,iBACF,CACV,CAED,QAA2B,CACvB,gBAAiB,SAAM,4BACvB,cAAgBgB,GAAY,+BAAmC,EAAI,KACnE,oBAAuBA,IAAY,8BAA+BA,EAAQ,GAAG,QAC7E,WAAiBA,MAAY,sBAAyB,aAAK,EAAUA,EAAQ,OAAO,IACpF,YAAa,kBAAM,aACnB,gBAAmBA,CAAY,wBAAyB,UACxD,mBAAmB,OAAM,iCAE7B,EAAMC,CAAQ,MACV,IAAO,yBACI,EAAIA,EAAQ,MAAQ,qBAE/B,MAAO,mBACH,EAAO,QACH,iBAChB,CAAa,CACJ,CACD,OAAO,8BACI,CAAIA,QACD,mBACN,iBAGH,CACJ,CACD,OAAO,+BACQA,EAAQ,CAAE,YAAM,cAC9B,CACD,YAAYC,EAAQ,CAChB,IAAIC,EACJ,SAAK,KACAA,IAAwBD,EAAO,IAAI,IAAmB,gBAAe,MAAe,OAASC,IAAK,iBACvG,KAAK,KAAO,MAAK,WAAY,KAC7B,OAAK,OAAQ,CAAI,SAAM,EAAK,OAAO,KAAE,GACrC,WAAYD,CAAO,IACtB,CACJ,CAED,MAAME,IACF,YAAiBN,EAAKO,KAClB,WACA,IAAK,QACL,WAAK,IAAaA,MAEtB,MAAO,YAAWC,CAAK,CAInB,SAHIA,GAAQ,MAGR,aAAe,OAAY,YAAe,UAKlD,IAAI,UACA,GAAO,MAAK,KAEhB,WAAI,KACA,SAAO,KAAK,UAEhB,KACI,OAAO,QAAK,KAAK,KAAK,CAAI,IAE9B,IAAMpB,aACQ,KAAK,MAAQA,CAC1B,CACD,eAAcqB,CAAMrB,EAAO,CACvB,UAAiB,GAAK,OACtB,aAAmB,KAAmB,EAClC,MAAMe,EAAQ,yBAEJO,EACV,MAAMP,EAAQ,iBAAiBM,CAAI,EAEvCC,GAAa,MAIrB,SAAMC,MAAkBC,WAChB,MACA,IAAO,OAAK,YAAY,IAAM,IAAI,YAEtC,CAAI,MAAMC,GACN,OAAK,cAAY,EAAM,IAAI,SAAc,CAC5C,CACD,KAAI,YACIR,CACJ,eAAkB,WAAY,gBAAgB,MAAM,IAAI,OAAO,KAAO,MAAQA,OAAO,YAEzF,CAAI,eACK,WAAY,gBAAgB,QAAM,EAAI,QAASS,IAExD,EAAGC,MACC,KAAMC,YAAkB,CAAI,eACP,WAAY,gBAAgB,QACzC,KAAc,OACf,cACN,CACM,MAIf,WACI,UAAc,CACV,KAAK,iBAEND,EAAWE,EAAS,MACfC,CAAY,KAAK,gBACrB,KAAKA,IACDA,KAAY,EAAK,WAAWH,CAAS,IAAI,IAEnC,KAAK,CACX,QAASE,IAEN,WAEIA,EAAS,CACpB,OAAMC,CAAY,QAAK,WACvB,YACI,IAAK,WAAWH,CAAS,EAAIG,EAAU,SAAQC,CACpCA,EAAS,UAAYF,CAC/B,IAEE,WAEKlH,EAAO,CACnB,MAAMmH,OAAiB,cAClBA,GAGLA,EAAU,QAASC,GAAa,EAC5BA,CAAS,SAAa,CACtC,CAAa,CACJ,CACJ,CAED,OAAMC,CAAS,KACf,SAASC,EAAUC,EAAU,CAWzB,MAVW,CAACC,EAAiBC,IAClB,CACHJ,EACA,IACAE,EACA,IACAC,KAAkB,CAAIA,CAAe,GAAK,QAC3B,CAAIC,CAAY,GAAK,EACpD,OAAmB,EAAE,CAGhB,CAED,gBACI,YAAqBC,EAAGC,CAAK,QAEjC,SACI,OAAOC,EAAG,QACb,CACD,UAASC,CAAUxC,EAAOyC,EAAY,CAClCzC,EAAM,cAAW,UAAgCyC,CAAU,CAAC,EAC5DA,EAAWzC,EAAM,WAErB,eAAqCyC,CAAY,EAC7CD,CAAUE,EAAS,MAAM9B,CAAG,EAAG6B,SAGnC,IAASE,EAAWC,EAAMC,EAAWC,SAExB,QAAU,WAGV,QAAU,OAAOD,CAAS,CAEtC,CACD,SAASE,GAAiBH,QACtB,IAAQ5C,GAAU,CACd2C,GAAWC,EAAMC,EAAW7C,CAAK,CAC7C,CACK,CACD,WAASgD,CAAuBhD,EAAO4C,EAAM,CACzCJ,EAAUxC,MACN4C,EAAK,eAAwD,GAChE,CACJ,WAEmBX,CAAU,KAAK,IACnC,QACI,gBACI,KAAK,OAAUgB,QAAI,UAAc,IAAK,CACtC,KAAK,WAAQ,mBACN,aAAU,yBAAwB,QACzC,GAAMC,EAAaD,SAAI,OAAc,QAAQ,SAClC,aAA0B,EAAG,CAAC,KAClC,SAAU,aAAaC,CAAU,KACxC,cAAa,QAAYA,CAAU,EACnC,eAAK,KAAgBA,CACrB,aAAsB,WAAc,KAAK,EACzCC,KAAU,OAAU,MAAIC,CAAY,GAAG,CAAC,KACjBpC,cAAmB,YAC1C,KAAK,mBAAc,UAE1B,CAED,OAAMqC,CAAiB,GACnB,gBACI,KAAK,SAAU,KACf,KAAK,YAAW,CAAK,YAAS,UAC9B,GAAK,SAAe,KACpB,KAAK,UAAYrC,MAAO,MACxB,KAAK,UAAWsC,CAAWL,IACvB,UAAY,OACZ,mBAAgB,iBAEV,cAAc,kBAAiB,OAAS,QAAK,KAAQ,CAClE,CACD,cACI,KAAK,SAAQ,CAAK,cACd,EAAQ,IACxB,GAEK,CAED,MAAMM,YACF,GAAYC,KACR,KAAIvC,CACJ,cAAK,KAA8DD,CAAO,WAC1E,OAAK,OAAWC,EAAqDD,OAAO,QAAY,IAAQC,MAAO,KAASA,EAAM,CAACwC,EAAIC,IAAOD,IAAOC,IACzI,QAAK,IAAU,GAAIC,IACnB,UAAK,GAAYH,GAErB,WAAI,SACA,KAAO,YAAK,IAEhB,SAAI,SACA,KAAO,UAAK,IAEhB,SAAI,GAASI,KACT,YAAK,GAAYA,UACb,GAAW,KACX,GAAM,EACtB,CAAa,WAEL,GAAYA,EAAUC,MAClB,GAAMC,EAAOD,WACT,GAAW,KACX,GAAM,EACtB,EACkBE,IAAmB,YAAK,KACxB,YAAK,UAAY,GAAUH,CAAQ,EACnCA,EACAI,IAAY,UAAK,KACN,QAAK,GAAQA,EAAWD,CAAgB,GACzC,CAACD,SAAK,OAGtB,QAAK,KAAQ,cAAK,SACd,KAAQ,EACxB,CAAa,IACD,UAAK,GAAYC,IACjB,QAAK,KAAQ,QAAK,UACd,GAASD,gBACT,GAAkBE,QAClB,GAAUD,MACV,KAAQ,EACxB,CAAa,EACJ,KAGL,GAAME,YACF,GAAYT,KACR,QAAK,IAAU,GAAIG,IACnB,OAAK,GAASH,GAElB,SAAI,SACA,KAAO,OAAK,IAEhB,SAAI,GAASxD,KACT,YAAK,GAAYA,UACb,GAAW,KACX,GAAM,EACtB,CAAa,WAEL,GAAYA,EAAO6D,MACf,GAAMC,EAAOD,WACT,GAAW,KACX,GAAM,EACtB,EACkBG,IAAY,OAAK,GACnBA,IAAchE,GAAS,CAAC8D,SAAK,OAGjC,QAAK,KAAQ,cAAK,SACd,KAAQ,EACxB,CAAa,IACD,OAAK,GAAS9D,IACd,QAAK,KAAQ,QAAK,UACd,GAAS8D,gBACT,GAAkBE,QAClB,KAAU,OAAK,OACf,KAAQ,EACxB,CAAa,EACJ,QAGL,GAASE,EAAYV,EAAcxC,MAC/B,GAAMmD,EAA6DnD,KAAO,SACpEoD,WAAgE,CACtE,SAAKD,CAAc,IACR,GAAIF,QAER,OAA6BjD,CAAM,CAC7C,CAED,OAAe,CACX,YAAY0B,EAAU,CAClB,QAAK,cACL,EAAK,cACL,MAAW9B,KAAO,QAAK,MACT,MAAK,MAAQA,IACrB,QAAQ,KAAG,QAAU,EAAM,CACzB,QAAK,KAAQ,MAAK,WACd,QACA,KAAQ,EAChC,MAIQ,MAAO,cAEH,WADa,WACD,UAAWA,OACZ,KAAO,UACTA,CAAG,EAAGsD,EAAYV,EAAa5C,CAAG,MAEtC,OAET,GAAO,WAAW4C,EAAc,CAC5B,WAAa,WAAK,EAAWA,CAAY,MACzC,GAAO,IAAIa,WAEN,CACL,SAAO,IAAK,SAAW,CAAE,SAE7B,KAAIzD,CAAKZ,OACL,CAAK,WAAa,SAAWA,CAChC,IACD,QACI,YAAY,QACf,CACJ,CAED,SAASsE,IAAYtE,CAAOuE,OAExB,EAAMC,EADO,SAAO,GAAKD,CAAc,EACnB,SAAQE,CAAK7D,MAC7B,KAAI6D,CAAQ,SACR,KAEJ,MAAMC,EAASH,EAAe3D,CAAG,IAClB8D,EAAO1E,OACtB,MAAOwE,EAAO,UACR,YAAO,EAAO,UAAO,OAAWC,CAAG,MAAS,CAAGD,MAAO,CAAO,MAAI,GAC1E,EAAE,CAAE,GACL,UAEJ,QAASG,GAAW3E,EAAO4E,EAAW,QAC3B5E,GAAM,MAAO,MAAM6E,CAAS,CAC/B,OAAY,OACR,OAEJ,MAAML,EAASI,OACf,CAAI,KAAQ,WAAaJ,EAAO,YAAU,IAG1C,MAAO,CAAC,KAAQA,EAAO,QACxB,CAAE,EACR,CACD,SAASM,GAAS9E,EAAO,CACrB,SAAIA,GAAU,IACH,MAEJ,IAAOA,KAAU,UAE5B,WAA0C,CACtC,SAAQ+E,CAAc3K,GAAM,CACxB,QAAiBA,GAAM,OACnB,MAAO,CACH,eACA,UACpB,EAEY,OAAgBA,KAAM,MAClB,KAAO,CACH,eACA,UACpB,EAEY,OAAMoK,CAASQ,IAAO,CACtB,QAAOR,GAAW,WAEV,SAAW,CACX,YAGA,SAAW,EACX,YACpB,CACA,CACK,CACD,WAASS,CAA2BF,EAAU,CAC1C,SACI,KAASC,QAAyC,CAAED,MACpD,MAASG,EAA2B9K,GAAM,SAAOA,CAAM,YAAgB,YACvE,QAAQ8K,CAA2B9K,GAAM,SAAOA,CAAM,YAAe,KAAS,MAC9E,QAAQ8K,CAA2B9K,GAAM,SAAOA,CAAM,YAAe,KAAS,MAC9E,QAAU8K,GAA2B9K,GACrC,SAAOA,CAAM,YAAaA,CAAI,YAC9B,QAAW4F,GAAUkF,GAA2B9K,SAAqB4F,EAAQ,MAAU,EAAE+E,CAAQ,EACjG,IAAKG,KAA2B9K,CAAMA,CAAC,EAAE2K,CAAQ,EACjD,OAASR,GAAmBW,GAA2B9K,GAAM,MACpD0K,CAAS1K,CAAC,EAGf,OAAOkK,GAAYlK,EAAGmK,CAAc,CACvC,QACD,IAAQY,GAAeD,GAA2B9K,GAAM,CACpD,KAAK,IAAM,SAAS,MAGpB,QAAqB+K,CAAU,CAClC,QAGT,KAAMC,EAAgB,CAClB,YAAqC,EAAI,EACzC,SAAUH,GAA2B,EAAK,CAClD,SACI,GAASI,CAAYrF,EAAOuE,EAAgB,CACxC,QAAea,EAAc,WAAS,KAAOb,QAC7C,OAAc,aAAmB,YAGrC,SAASe,IAAYC,CAAM,CACvB,SAAQ,IAAK,CACT,cAAiB,GAAG,QAAQA,EAAK,MAAM,OAAOA,EAAK,OAAK,EACxD,uDACZ,CAAU,KAAK,OAGX,QAASC,GAAe5C,EAAM,CAC1B,SAAIA,CAAQA,EAAK,eACbA,cAAK,EAAc,eAEhB,YAGL6C,CAAc,CAChB,YAAYzF,GACR,YAAcA,CACjB,CACD,OAAO,OAAOA,EAAO,MACjB,CAAO,MACCyF,EAAczF,CAAK,OACZ6D,IACP7D,CAAM,YAAY4D,EAAUC,CAAO,CACtC,WAGL,KAAU,CACV,aAAY,SAAO,KAEvB,OAAI,QACA,aAAY,SAAO,KACtB,CACJ,MAED,CAAM6B,QAA0B,CAChC,SAASC,GAAgB/C,EAAMgD,EAAU,QAC9B7C,GAAiBH,EAAM8C,GAAY,OAAWE,CAAQ,CAAC,CACjE,CACD,QAAMC,YACF,WAAYnD,EAAU,CAClB,WACA,CAAMA,CAAQ,EACd,KAAK,gCAAyB,uBAC9B,KAAK,2BAAuB,qBAC5B,KAAK,yCACI,mCACR,KAAK,4BAAsB,wBAAuD,IAAK,iCACnF,CAAM,cAAY,UAAW,UAAU,GAAK,gCACtC,MAAQ,MAAE,QAAW,UAAU,GAAK,eAAe,eAC/C,SAAQ,IAAO,QAAQzB,CAAO,SAAkBA,CAAG,eAAe,cAAW,QAAU,GAAK,4CAExG,CAAO6E,OACN7E,OACJ,OAAqB6E,GAA8E,GACnG,OAAO,IAAID,GAAUxB,OAAS,OAC1B,aAAgBb,CAAa,YAAc,WAAe,QAAc,GACxE,SAAU,GACV,WAAcA,CAAa,UAAY,WAAe,QAAc,GACpE,QAASuC,EAAKvC,EAAa,UAAY,WAAe,QAAc,IACvE,EAAC,IAEN,EAAI,6BACY,eACf,eACD,mBACmB,0BAAuC,CAAU,EAAC,CACjEwC,EAAa,SAAM,KAAUL,KAAsB,QAAQ,CAAC,CAC/D,EACD,YAAa7F,EAAQ,YACF,0BACJ,CAAWmG,CAClC,CAAa,CACJ,CACD,aAAarD,EAAM,YACA,0BACN,CAAWqD,EAAW,GAAK,CAChD,QAEQ,SAAcC,cACC,cAAY,UAAW,UAAWC,CAAa,EAClDA,EACAD,MAIZ,iCACmB,CAAK,OAAI,OAExB,YADuC,cAAe,cAC7B,SAAS,UAAU,CAC/C,GACD,kCACS,0BAAwB,wBAEjC,qBACS,6BAET,gCACS,6BAET,kBAEI,CAAME,EAAa7D,IAAG,6BAC6C,IAAe,QAAQ,cAAc,QAAK,gDACtF,IAAO,MAAQtB,IAAO,QAAkBA,EAAG,iBAAe,MAAQ,cAAa,QAAK,+CACtG,MAAqB,CAC7B,qBAID,CAAO,CAAC,aAAa,SAAS,WAAQ,QAG1C,OAAoBgB,EAAU,SAE1B,SAAW,OACX,MAAO,SACP,EAAM,MACN,UAAU,MAClB,CACI,MAAMoE,QACF,OAAYrF,EAAQ,KAChB,CAAK,cACL,IAAK,YAAe,KACpB,KAAK,MAAc,GACnB,KAAK,UAAYA,EAAO,UACxB,UAAa,GAAK,SAAK,MACvB,GAAK,SAAM,QAAM,MAAW,KAAE,MAAQ,EAAG,SAAU,UACxB,WAAiB,CACpC4B,EAAK,gBAAU,CAAO0D,GAAY,YAAqC,CAAC,MAE5E,GAAK,MAAM,IAAI,YAAW,CAAE,SAASC,EAAQ,SACpC,UAAcD,CAAY,eAClC,CACjB,GACY,QAAK,OAAU,sBACI1D,CAAI,aAGvB,GAAS,CACT,OAAO,MAAK,OAEhB,SAAI,KAEA,QADK,WACD,CAAE,WAAY,OAAK,YAAU,QAC7B0C,CAAY,SACH,QACL,KAAQO,EAAU,KAClB,MAAO,wBAC3B,eAGiB,UAAU,OAAI,MAAU,SAAK,IAAU,QAAK,MAAQ,SAAY,IAAI,CAC5E,OAGL,CAAMW,SAAS,uBACf,SAASC,GAAYjM,KACT,cAEZ,QAASkM,aACL,CAAM,QAAY,GAAM,WACxBlM,CAAQ,SAAM,WAAa,QAE3BA,WAAc,QAAa,CAC9B,CACD,SAASmM,WACL,EAAO1D,SAAI,aAAiB,CAC/B,CACD,aAA2B,CACvB,OAAO,UACV,CACD,WAAS2D,WACuBC,SACX,GACpB,CACD,SAASC,GAAiBC,EAAe,QAC/BC,CAAMD,QAAc,YAAc,kBAItB,aAAcC,MAEZ,aAAW,CAAM,EAC7B,mBAAoB,CACpC,CAAa,mBAIL,IAAO,6BACP,UAAU,2BACV,MAAQ,uEAChB,GACI,QAASC,GAAqBC,EAAUC,EAAQ,CAC5C,MAAMvE,QAAgB,cAAgB4D,CAAQ,mBACzC,QAAYY,EAA0BD,CAAM,MAGrD,YAAwC3M,GAAS+F,CAAO,CACpD8G,EAAc,aAAa7M,EAAS6M,EAAc,kBAEtD,IAASC,SACO,cACR9M,EAAQ,mBAAc,iBAG9B,YACI,CAAOA,EAAQ,SAAS,OAAS,GAC7BA,EAAQ,iBAAoB,MAAS,WAG7C,EAAS+M,SACL,EAAO/M,EAAQ,YAAW,OAAS,EAC/BA,EAAQ,iBAAoB,iBAGpC,aACI,GAAI+H,EAAG,cACcA,MAAG,gBAEpB,wCACU,QAEP,sBAIX,WAAyBU,EAAKxB,EAAO,CACjC,MAAM+F,SAAW,wCACa;AAAA,CAAI,EAAE,IAAKC,GAC9BxE,EAAI,eAAewE,CAAI,CACjC,EACS,QAAQ,CAACC,EAAUnH,IAAU,CAC/BA,EAAQ,GACRiH,EAAK,YAAYvE,EAAI,cAAc,IAAI,CAAC,EAE5CuE,EAAK,YAAYE,CAAQ,CACrC,CAAS,EACMF,CACV,CACD,MAAMG,CAAU,CACZ,YAAY1E,EAAKjC,EAAQ,CACrB,KAAK,QAAUiC,EAAI,cAAc,KAAK,EACtC,KAAK,QAAQ,UAAU,IAAI2E,EAAa,GACxC5G,EAAO,UAAU,mBAAmB,KAAK,OAAO,EAChD,MAAM6G,EAAY5E,EAAI,cAAc,KAAK,EACzC4E,EAAU,UAAU,IAAID,EAAY,GAAG,CAAC,EACxC5B,EAAahF,EAAO,MAAO,QAAUhB,GAAU,CACvC8H,EAAQ9H,CAAK,EACb,KAAK,QAAQ,UAAU,IAAI4H,EAAY,OAAW,KAAK,CAAC,GAGxD,KAAK,QAAQ,UAAU,OAAOA,EAAY,OAAW,KAAK,CAAC,EAC3DL,GAAiBM,CAAS,EAC1BA,EAAU,YAAYE,EAAgB9E,EAAKjD,CAAK,CAAC,EAErE,CAAa,EACD,KAAK,QAAQ,YAAY6H,CAAS,EAClC,KAAK,aAAeA,EACpB,MAAMG,EAAY/E,EAAI,cAAc,KAAK,EACzC+E,EAAU,UAAU,IAAIJ,EAAY,GAAG,CAAC,EACxC,KAAK,QAAQ,YAAYI,CAAS,EAClC,KAAK,aAAeA,CACvB,CACJ,CAED,MAAMC,UAAwB5B,GAC1B,YAAYpD,EAAKjC,EAAQ,CACrB,MAAMkH,EAAYlH,EAAO,gBAAgB,UACzC,MAAM,OAAO,OAAO,OAAO,OAAO,GAAIA,CAAM,EAAG,CAAE,KAAM,IAAI2G,EAAU1E,EAAK,CAClE,MAAOjC,EAAO,MACd,UAAWkH,CACd,GAAG,UAAWA,CAAW,EAAC,EAC/B,KAAK,MAAQlH,EAAO,MACpB,KAAK,gBAAkBA,EAAO,gBAC9B,KAAK,KAAK,aAAa,YAAY,KAAK,gBAAgB,KAAK,QAChE,CACJ,CAED,MAAMmH,GAAoB,CACtB,GAAI,SACJ,KAAM,QACN,OAAOC,EAAQ,CACX,MAAMC,EAAIjD,EACJZ,EAASa,EAAY+C,EAAQ,CAC/B,MAAOC,EAAE,SAAS,OAClB,KAAMA,EAAE,SAAS,SAAS,QAAQ,EAClC,MAAOA,EAAE,SAAS,OACrB,EACD,OAAO7D,EAAS,CAAE,OAAQA,CAAM,EAAK,KACxC,CACD,WAAW8D,EAAM,CACb,OAAO,IAAIL,GAAgBK,CAAK,UAC5B,OAAOA,CAAK,OACZ,MAAOjE,CAAS,YACZ,OAAOiE,CAAK,QAAO,MACtB,CACD,iBAAiB,IAAIjF,EAAiBiF,EAAK,SAAU,CACjD,MAAOjE,EAAS,WAAW,CACvB,MAAOiE,EAAK,OAAO,MACtB,EACD,UAAWA,EAAK,UACnB,CACjB,CAAa,CACJ,EACD,IAAIA,EAAM,CAIN,OAHI,CAAEA,EAAK,sBAAsBL,IAG7B,EAAEK,EAAK,YAAW,2BAA2BjF,GACtC,KAEJ,IAAI9B,EAAU+G,EAAK,WAC7B,CACT,EAEI,MAAMC,WAA6BlC,GAC/B,YAAYrF,EAAQ,CAChB,MAAMA,CAAM,EACZ,KAAK,MAAQA,EAAO,MAE3B,CAED,SAASwH,IAAc,CACnB,OAAO,IAAInE,EAAS,CAChB,UAAWH,EAAY,GAAI,CACvB,OAAQuE,CACxB,CAAa,CACb,CAAS,CACJ,CAED,MAAMC,WAA0B,CAC5B,aAAYhG,CAAU,CAClB,OAAc,CACjB,CACD,QAAO,OAAOrC,CAAU,CACpB,OAAMsI,CAAU,CACZ,WAAW,EACX,UAAUtI,CACV,gBAAgB,KAChB,gBAAiB,EACjB,mBAAmB,KAEjBX,EAAO2E,EAAS,YAAkB,EACxC,QAAO,IAAIqE,CAAShJ,EACvB,CACD,MAAI,cACA,MACA,SAAa,OAAK,IAAI,mBAAmB,GAAO,OAAQuB,GAAO,OAASA,EAAK,OAAK,IAAI,UAE1F,MAAI,YACA,GAAI,EAAC,MAAK,cACN,OAAO,CAEX,QAAiB,OAAK,IAAI,gBAC1B,SAAI,KAAK,IAAI,iBAAiB,CAAK,CAAC6G,EAAQc,CAAQ,EACzC,GAAGA,CAAQ,MAEf,OAEX,mBAAwBC,EAAmB,CACvC,QAAiB,IAAM,CACF,OAAK,cAEb,YAAU,IAAqB,CAGpCjG,EAAK,YAAU,OAEnC,EACYoD,EAAa,OAAM,UAAoB,EACvCA,EAAa,OAAM,mBAA6B,CACnD,CACD,oBACI,OAAK,IAAI,iBAAmB,CAAK,EACjC,OAAK,IAAI,gBAAkB,MAC3B,MAAK,IAAI,WAAa,CAAI,CAC7B,CACJ,CACD,WAAS8C,CAA4BC,EAAQC,EAAkB,CAC3D,MAAa,EACb,SAAAtC,CAA6BsC,EAAkB,IAAM,CACjDD,EAAO,MAAI,gBAAkB,MAC7BA,CAAO,MAAI,mBAAqB,CAAI,EACpCtC,GAAYuC,EAAgB,CAC5BC,EAASD,EAAiB,eACnB,MAAI,mBAAqB,MAChCvC,EAAYuC,EACxB,CAAS,EACMC,CACV,CACD,WAASC,CAAYC,EAAUvG,EAAM,CACjCA,EAAK,QAAM,OAAkB,cAEjC,SAASwG,CAAaD,EAAUvG,EAAM,CAClCuG,EAAS,QAAM,UAAY,UAAQ,CAAG,gBAAgB,GAAM,CAExD,GADAA,EAAS,MAAI,WAAa,CAAK,EAC3BrB,EAAQqB,EAAS,MAAI,gBAAiB,CAAG,CACzC,QAAUL,GAA4BK,EAAUvG,CAAI,EAChDyG,EAAI,GACJF,EAAS,MAAI,gBAAmB,CAEvC,CACDA,EAAS,MAAI,iBAAmB,CAAI,EACpC1C,GAAY7D,EACxB,CAAS,EACDuG,EAAS,UAAQ,CAAG,UAAU,GAAM,CAChCD,GAAYC,EAAUvG,CAAI,CACtC,CAAS,EACDsG,GAAYC,EAAUvG,CAAI,EAC1BA,EAAK,mBAAiB,eAAkBL,EAAO,CACvCA,EAAG,eAAiB,UAGxB4G,EAAS,oBACZ,CACJ,CAED,QAAMG,WACF,cAAwBC,EAAS,CAC7B,QAAgB,CAChB,OAAK,SAEZ,CAED,WAASC,CAAiBvL,EAAKmK,EAAQ,CACnC,SAAW,WAAS,OAAO,OAAO,OAAO,OAAS,CAAEA,CAAM,EAAG,CAAE,OAAM,QAAW,CACnF,CACD,WAASqB,CAAiBxL,EAAKmK,EAAQ,CACnC,SAAW,WAAS,OAAO,OAAO,OAAO,OAAS,CAAEA,CAAM,EAAG,CAAE,OAAM,QAAW,CACnF,CACD,WAASsB,CAAoBzL,EAAK0L,EAAY,CAC1C,QAAeA,GAA4D,GAC3E,SAAW,WAAS,OAAO,OAAO,OAAO,OAAS,CAAEvB,CAAM,EAAG,CAAE,OAAM,WAAc,CACtF,CACD,WAASwB,CAAc3L,EAAKmK,EAAQ,CAChC,SAAW,WAAS,OAAO,OAAO,OAAO,OAAS,CAAEA,CAAM,EAAG,CAAE,OAAM,KAAQ,CAChF,CAED,QAAuB,CACnB,cAAqB,CACjB,OAAK,QAAU,IACf,OAAK,OAAS,CACd,OAAK,OAAS,IAAI,IAClB,KAAK,cAAgB,KAAK,cAAc,KAAK,KAC7C,MAAK,iBAAmB,KAAK,iBAAiB,KAAK,KACnD,MAAK,SAET,MAAI,MACA,SAAO,KAAK,OAEhB,SACI,SAAO,MAAM,KAAK,KAAK,OAE3B,MAAe,CACX,YAAWvD,GAAQ,OAAK,SACpB,GAAIqB,EAASrB,CAAI,EACb,SAGR,SAAO,KAEX,SAAe,CACX,SAAO,KAAK,OAAO,IACtB,CACD,MAAUgF,EAAW,CACjB,GAAI,OAAK,SAAa,CAClB,QAAc,oBAElB,QAAcA,IAAc,OAAYA,EAAY,OAAK,OAAO,OAChE,KAAK,OAAO,OAAc,EAAGhF,CAAI,EACjC,OAAK,OAAO,IAAQ,CACpB,QAAgB,OAAK,SAAa,CAC9BiF,IACAA,EAAQ,UAAQ,CAAG,OAAO,MAAK,cAC/BA,CAAQ,UAAQ,CAAG,UAAU,MAAK,iBAClCA,CAAQ,WAAW,UAASjF,CAAS,CACjC,OAAK,OAAO,IAChC,CAAiB,GAEL,OAAK,QAAQ,KAAK,KACd,QACA,OACA,OAAM,KACN,OAAQ,KAGhB,SAAa,CACT,QAAc,OAAK,OAAO,QAAY,CACtC,GAAItE,EAAQ,EACR,SAEJ,KAAK,OAAO,OAAc,CAAC,EAC3B,OAAK,OAAO,OAAW,CACvB,QAAgB,OAAK,SAAa,CAC9BuJ,IACAA,EAAQ,UAAQ,IAAI,KAAO,MAAK,cAChCA,CAAQ,UAAQ,IAAI,QAAU,MAAK,iBAEvC,OAAK,QAAQ,KAAK,QACd,QACA,OACA,OAAM,KACN,OAAQ,KAGhB,gBAAkB,CACd,OAAK,OAAO,IAAO,OACnB,MAAK,QAAQ,KAAK,KACd,QAAU,QACV,KAAS,OACT,KAAM,KACN,OAAW,SAGnB,mBAAqB,CACjB,OAAK,OAAO,OAAU,OACtB,MAAK,QAAQ,KAAK,QACd,QAAU,QACV,KAAS,OACT,KAAM,KACN,OAAW,SAGtB,CAED,QAAMC,WACF,cAAwB,CACpB,QAAgB,CAChB,OAAK,iBAAmB,KAAK,iBAAiB,KAAK,KACnD,MAAK,SAAW,IAChB,OAAK,YAAY,QAAQ,QAAQ,CAAG,UAAU,MAAK,iBAEvD,KAAI,MACA,SAAO,KAAK,YAAY,MAAM,IAAI,OAEtC,MAAI,MAAa,CACb,OAAK,YAAY,MAAM,IAAI,OAAc,CAC5C,CACD,GAAGpI,EAAWE,EAAS,CACnB,QAAWA,EAAQ,OAAK,KACxB,aAAK,SAAS,CAAGF,EAAYY,GAAO,CAChCX,EAAGW,EAAG,QACT,CACM,OAEX,QACI,OAAK,YAAY,QAAQ,KAE7B,mBAAqB,CACjB,QAAcA,EAAG,SAAO,OAAO,KAC/B,OAAK,SAAS,KAAK,QACf,QAAO,IAAkB,OAAwB,OAAK,YAAY,QAAQ,OAAO,UAAc,UAAQ,KAE9G,CACJ,CAED,QAAMyH,WACF,eAAiBhJ,CAAQ,CACrB,SAAiB,EACjB,QAAK,QAAiB,UAI9B,OAAMiJ,WACF,cACI,SACA,QAAK,iBAAmB,KAAK,iBAAiB,KAAK,CAAI,IACvD,MAAK,SAAW,CAAItG,GACpB,OAAK,YAAY,QAAQ,QAAW,WAAU,MAAK,iBAEvD,EAAI,SACA,SAAO,KAAK,YAAY,MAAM,CAAI,UAEtC,GAAI,SACA,QAAK,YAAY,MAAM,CAAI,UAC9B,CACD,GAAGhC,GAAWE,CAAS,CACnB,SAAWA,CAAQ,QAAK,CAAI,IAC5B,aAAK,SAAYF,GAAYY,EAAO,CAChCX,EAAGW,EAAG,SAEH,IACV,IACD,QACI,OAAK,YAAY,QAAQ,KAE7B,mBACI,SAAcA,CAAG,UAAO,OAAO,KAC/B,OAAK,SAAS,KAAK,QACf,QAAO,CAAIrC,GAAc,OAAwB,OAAK,YAAY,QAAQ,OAAO,UAG5F,CAED,SAAMgK,WACF,eAAyB,CACrB,UAAiB,CACjB,KAAK,YAAiB,UACtB,CAAK,cAAU,aAAa,CAAK,YAAQ,OACzC,EAAK,cAAU,cAAoB,CAC/B,KAAK,YAAQ,QAGxB,CAED,aAA4BjM,CAAK,EAC7B,UAAIA,aACOA,CAAI,YAEXA,aACOA,CAAI,aAAY,QAG9B,CACD,aAA4BkM,CAAQtK,EAAY,CAC5C,UAAmB,KAAM5B,IAAQA,CAAI,gBAA0B,CAC/D,GAAI,CAACA,GACD,SAAc,oBAElB,SAEJ,WAA6BmD,CAAKR,EAAKO,EAAQ,CAC3C,GAAI,CAACD,GAAc,cACf,SAAc,cAElB,SAAWA,IAAmBN,EAAKO,CAAM,CAC5C,CACD,UAAMiJ,WACF,cAA8B,CAC1B,UACA,IAAK,eAAa,CAAK,eAAW,CAAK,IAAI,KAC3C,EAAK,kBAAgB,CAAK,kBAAc,CAAK,IAAI,KACjD,EAAK,uBAAqB,CAAK,uBAAmB,CAAK,IAAI,KAC3D,EAAK,yBAAuB,CAAK,yBAAqB,CAAK,IAAI,KAC/D,EAAK,aAAezG,IACpB,GAAK,YAAc0G,IAAiBC,CAAkB,EACtD,KAAK,UACL,QAAa,GAAK,gBAAY,CAC9BC,IAAK,UAAW,KAAO,KAAK,eACvB,WAAW,WAAU,EAAK,kBAC1B,WAAW,gBAAe,EAAK,uBAC/B,WAAW,kBAAiB,EAAK,yBACjC,YAAS,QACV,KAAK,cAEZ,CACD,IAAI,aACA,SAAO,CAAK,gBAAY,CAAK,aAAcC,IAAOC,EAAmB,KAAK,YAE9E,aAAsBd,EAAY,CAC9B,UAAeA,CAA4D,GACrE1G,EAAM,KAAK,gBAAY,CAAK,YAAQ,cAC/B,GAAK,UAAM,YAAiByH,CAAoBC,EAAQ/J,EAAKwH,EAAO,cACzEnK,EAAM,IAAI8L,IAAkB,GAClC,UAAO,CAAK,IAAI9L,IAAY,KAAK,KAErC,YAAwB0L,EAAY,CAChC,UAAeA,CAA4D,GACrE1G,EAAM,KAAK,gBAAY,CAAK,YAAQ,cAC/B,GAAK,UAAM,cAAmByH,CAAoBC,EAAQ/J,EAAG,CAAGwH,CAAM,EAC3EnK,EAAM,IAAIgM,IAAoB,GACpC,UAAiB,CAAK,IAAIhM,IAAY,KAAK,KAE/C,WACI,UAAwB,IAAMmK,IAElC,aACI,UAAwB,IAAMA,IAElC,gBACI,UAA2B,IAAMuB,IAErC,UACI,UAAqB,IAAMvB,IAE/B,GAAInK,IAAgB,CAChB,KAAK,gBAAY,CAAK,IAAIA,IAAI,cAC9B,SAAa,GAAK,YAAQ,CAAM2M,IAAMA,CAAE,gBAAoB,gBAC5D,QACI,IAAK,YAAQ,OAEjB,IAAK,YAAY3M,CAAG,GAEvB,CACD,WACI,IAAK,gBAAY,CAAK,WAAW,cAErC,UACI,SAAY,GAAK,gBAAY,CAAK,YAAQ,cAC/B,GAAK,UAAM,YAAuB,CACvCA,EAAM,KAAK,UAAM,eACvB,UAAO,CAAK,IAAIA,IAAY,KAAK,KAElC0D,EAAWE,EAAS,CACnB,UAAmB,KAAK,IAAI,KAC5B,SAAK,aAAYF,CAAYY,GAAO,CAChCX,EAAGW,EAAG,KAAK,KAER,GACV,CACD,cACgB,IAAK,YAAQ,CAAMtE,IAAQA,CAAI,gBAAkB,EAEzD,KAAK,YAAY,KAAK,UAAM,eAGpC,eACI,IAAK,cAAa,kBAEtB,eACI,EAAIsE,EAAG,WACH,OAAYkI,CAAmB,KAAK,YAAY,kBAChD,EAAK,YAAQ,OAGrB,uBACI,SAAc,oBACVD,gBACA,UAAYC,CAAmB,KAAK,YAC9BI,CAAUL,EAAG,YACnB,CAAK,aAAS,CAAK,YACf,QAAWzK,IAA6B8K,EAAQ,WAAO,CAAM,IAAW,WAAO,UAAc,UAAY,CAC7H,IACa,QACQL,gBACL,UAAYC,CAAmB,KAAK,YACpC,IAAK,aAAS,CAAK,YACf,QAAW1K,IAAmByK,EAAG,UAAM,SAAU,KAAc,YAAY,CAC/F,IAGQ,yBACI,EAAI,EAAEjI,EAAG,+BACL,UAAc,oBAElB,QAAYkI,CAAmB,KAAK,YAAY,kBAChClI,CAAG,oBAAgB,QACnC,CAAK,aAAS,CAAK,YACf,QAAWrC,IAA6B2K,EAAQ,WAAO,KAAiB,WAAO,UAK3F,UAAMC,WACF,eAA8B,CAC1B,UAAkB,EAAIV,IAAQvK,CAAW,mBACzC,KAAK,aAAe8D,IACpB,GAAK,gBAAY,SACZ,MAAM,UACN,UAAW,WAAkB,CAC9B,KAAK,aAAS,CAAK,UACf,QAAWvD,IAAY,GAAMmC,IAAG,SAAO,SAE9C,CACD,KAAK,aAAY,WAAkB,CAC/B,KAAK,aAAS,CAAK,YACf,QAEP,EACD,KAAK,aAAY,WAAkB,CAC/B,KAAK,aAAS,CAAK,YACf,QAEP,CACJ,CACD,IAAI,aACA,SAAO,CAAK,gBAAY,SAAa,cAEzC,EAAI,aACA,IAAK,gBAAY,SAAa,cAElC,IAAI,UACA,SAAO,CAAK,gBAAY,MAAU,WAEtC,EAAI,UACA,IAAK,gBAAY,MAAU,WAE/B,IAAI,aACA,SAAO,CAAK,aAAS,SAEzB,SAAsBoH,EAAY,CAC9B,WAAO,CAAK,aAAS,SAAsBA,CAAU,CACxD,CACD,eAAwBA,EAAY,CAChC,WAAO,CAAK,aAAS,WAAwBA,CAAU,CAC1D,CACD,cACI,UAAO,CAAK,aAAS,UAEzB,aACI,UAAO,CAAK,aAAS,UAEzB,gBACI,UAAO,CAAK,aAAS,aAEzB,UACI,UAAO,CAAK,aAAS,OAEzB,GAAI1L,IAAgB,CAChB,WAAO,CAAK,aAAaA,IAC5B,CACD,WACI,IAAK,aAAS,OAElB,YACI,UAAO,CAAK,aAAS,SAEzB,EAAG0D,EAAWE,EAAS,CACnB,UAAmB,KAAK,IAAI,KAC5B,SAAK,aAAYF,CAAYY,GAAO,CAChCX,EAAGW,EAAG,KAAK,KAER,GACV,CACJ,IAED,OAAMwI,WACF,eACI,SACI,OAAc,QACd,CAAM/J,IAAO,GACb,cAAkB,iBAAe,UAErC,GAAK,mBAAwB,iBAIrC,OACI,eAAyB,CACrB,UAA4BA,EAAO,aACnC,EAAK,YAAc,gBAAc,CAAK,IACtC,GAAK,YAAQ,UAAc6B,IAAW,CACtC7B,EAAO,cAAU,mBAAmB,CAAK,YAIjD,WAAoCgK,CAAKC,EAAG,CACxC,QAAS3N,IAAOA,EAAI0N,EAAI,WAAa,CACjC,UAAe1N,CAAC,EAChB,GAAIkN,iBAAwCA,GAAG,WAC3C,WAGR,SACH,CACD,aAAsCQ,CAAKC,EAAG,CAC1C,QAAS3N,IAAOA,EAAI0N,EAAI,WAAa,CACjC,UAAe1N,CAAC,EAChB,GAAIkN,iBAA0CA,GAAG,WAC7C,WAGR,SACH,CACD,aAAkCQ,CAAK5Q,EAAG,CACtC,QAASkD,IAAOA,EAAI0N,EAAI,WAAa,CACjC,UAAe1N,CAAC,EAChB,GAAIkN,iBAAsCA,GAAG,SACzC,WAGR,SACH,CACD,aAAqBA,CAAI,EACrB,UAAIA,aACOA,CAAG,KAEVA,iBACOA,CAAG,mBAAe,CAEtB,IACV,CACD,aAAmCA,CAAI,EACnC,SAAaU,CAAYV,CAAE,GAC3B,UAAmB,WACtB,CACD,UACI,eACI,GAAIvJ,IACJ,KAAK,4BAA0B,CAAK,4BAAwB,CAAK,IAAI,KACrE,EAAK,cAAY,CAAK,cAAU,CAAK,IAAI,KACzC,EAAK,iBAAe,CAAK,iBAAa,CAAK,IAAI,KAC/C,EAAK,oBAAkB,CAAK,oBAAgB,CAAK,IAAI,KACrD,EAAK,4BAA0B,CAAK,4BAAwB,CAAK,IAAI,KACrE,EAAK,wBAAsB,CAAK,wBAAoB,CAAK,IAAI,KAC7D,EAAK,0BAAwB,CAAK,0BAAsB,CAAK,IAAI,KACjE,EAAK,wBAAsB,CAAK,wBAAoB,CAAK,IAAI,KAC7D,EAAK,4BAA0B,CAAK,4BAAwB,CAAK,IAAI,KACrE,EAAK,wBAAsB,CAAK,wBAAoB,CAAK,IAAI,KAC7D,EAAK,6BAA2B,CAAK,6BAAyB,CAAK,IAAI,KACvE,EAAK,+BACD,CAAK,+BAA2B,CAAK,IAAI,KAC7C,EAAK,YAAc0C,IACnB,GAAK,WAAe3C,CAAO,UAAW,QAAQC,CAAO,SAAc,SAC7D,IAAK,WAAY,QAAQkK,CAAO,SAAkBA,CAAG,UAAM,WAAa,UAAW,WAAU,EAAK,4BACxG,EAAK,cAAmB,YACxB,CAAK,WAAad,IAAiBe,CAAyB,EAC5D,KAAK,WAAO,QAAW,KAAO,KAAK,cACnC,EAAK,WAAO,QAAW,WAAU,EAAK,iBAE1C,CAAI,aACA,SAAO,CAAK,WAAO,CACtB,KACGZ,IAAe,CACf,IAAIvJ,IACHA,CAAKuJ,EAAG,WAAY,QAAQvJ,CAAO,SAAkBA,CAAG,WACrDN,CAAmB6J,EAAI,YACpB,WAAS,KAGT,WAAa,CAChBlF,IACI,IAAK,YACL,QAAQ,iBACR,OAAO,WAC3B,CAAiB,GAEL,KAAK,WAAWkF,IACnB,CACD,WACQ7J,CAAmB6J,EAAI,YACpB,WAAS,KAGT,WAAa,CAChBlF,IACI,IAAK,YACL,QAAQ,iBACR,OAAO,kBAGf,KAAK,WAAO,OAEhB,IAAK+F,IACD,UAAiB,CAAK,WAAO,SAAW,SAC7Bb,gBAGf,aACI,IAAK,qBACL,QAAkB,WAAc,KAOhC,IANA,IAAK,YAAQ,CAAK,MAAO,GACrB,kBAAoB,GACpB,UAAU,QACV,OACA,SAChB,CAAa,IACIc,CACD,WAEJ,MAAc,KAMd,IALAd,CAAG,cAAU,QAAW,WAAU,EAAK,4BACpC,SACE,MAAM,WACN,UAAW,WAAU,EAAK,4BAC5B,aAAU,cAAc,CAAK,oBAC5BA,cACAA,CAAG,YAAQ,QAAW,WAAU,EAAK,wBAAmB,MAEnDA,gBACLA,CAAG,YAAQ,QAAW,WAAU,EAAK,0BAAqB,MAErDA,gBACLA,CAAG,UAAM,QAAW,WAAU,EAAK,wBAAmB,CAErD,CACD,UAAaU,CAAYV,CAAE,GAC3B,EAAID,EAAM,EACN,SAAqB,YACb,CAAG,YAAU,EAAK,wBAClB,EAAG,iBAAe,EAAK,6BACvB,EAAG,mBAAiB,EAAK,+BAI7C,gBACI,IAAK,qBACL,QAAkB,WAAc,KAMhC,IALA,IAAK,YAAQ,CAAK,YACd,kBAAoB,GACpB,WACA,SAChB,CAAa,IACIe,CACD,WAEJ,MAAc,KACd,IAAId,gBACAA,CAAG,YAAQ,QAAY,YAAU,EAAK,wBAAmB,MAEpDA,gBACLA,CAAG,YAAQ,QAAY,YAAU,EAAK,0BAAqB,MAEtDA,gBACLA,CAAG,UAAM,QAAY,YAAU,EAAK,wBAAmB,CAEtD,CACD,UAAaU,CAAYV,CAAE,GAC3B,EAAID,EAAM,EACN,SAAqB,YACb,EAAI,YAAU,EAAK,wBACnB,GAAI,iBAAe,EAAK,6BACxB,GAAI,mBAAiB,EAAK,+BAI9C,oBACI,QAAqB,GAAK,WAAO,MAAM,OAAgBC,EAAG,cAAc,YAClEe,CAAmBC,EAAa,CAAC,EACjCC,EAAkBD,EAAaA,EAAa,WAClD,IAAK,WAAO,MAAM,QACd,UAAW,CACPhB,IAAOe,IACPG,EAAG,KAAK,WACH,KAAK,WACN,EAAK,WAAW,eAAa,WAAS,WACtCA,EAAG,KAAK,eAGZlB,GAAOiB,IACPC,EAAG,KAAK,MAAM,IACT,KAAK,WAAU,EAAK,WAAW,eAAa,WAAS,UACtDA,EAAG,KAAK,cAGhBlB,CAAG,UAAU,eAChB,CACJ,CACD,4BACI,GAAK,qBACL,GAAK,YAAQ,CAAK,YACd,SAChB,CAAa,IAEL,0BACI,IAAK,qBACL,GAAK,YAAQ,CAAK,YACd,SAChB,CAAa,IAEL,kBACwB,GAAK,WAAO,MAAM,OAC3BA,CAAG,cAAc,cAEhB,WACR,KAAK,WAAO,OAEnB,CACD,wBACI,SAAWmB,CAA2B,KAAK,KAAK3B,IAAyBzH,GAAG,UACxE,CAACiI,GACD,SAAc,kBAElB,GAAK,YAAQ,CAAK,iBACd,kBACA,UAAY,UACZ,OAChB,CAAa,IAEL,wBACI,SAAWoB,CAA6B,KAAK,KAAK1B,IAA2B3H,GAAG,UAC5E,CAACiI,GACD,SAAc,kBAElB,GAAK,YAAQ,CAAK,mBACd,kBACA,SAChB,CAAa,IAEL,sBACI,SAAWqB,CAAyB,KAAK,KAAKtD,IAAuBhG,GAAG,UACpE,CAACiI,GACD,SAAc,kBAElB,GAAK,YAAQ,CAAK,iBACd,kBACA,UAAY,UACZ,OAChB,CAAa,IAEL,sBACI,IAAK,qBACL,GAAK,YAAQ,CAAK,YACd,SAChB,CAAa,IAEL,2BACI,IAAK,YAAQ,CAAK,iBACd,kBAAoB,kBACpB,QAAY,UACZ,OAChB,CAAa,IAEL,6BACI,IAAK,YAAQ,CAAK,mBACd,kBAAoB,kBACpB,OAChB,CAAa,IAEL,0BACI,GAAK,qBAIb,SAAMsB,WACF,eAAyB,CACrB,UAAM,OAAO,OAAO,OAAO,OAAiB,EAAG,CAAE,KAAM,IAAIC,IAAU9I,CAAK,EAClE,YAAU,EACV,cAAkB,YACjB,CACT,KAAK,eAAa,CAAK,eAAW,CAAK,IAAI,KAC3C,EAAK,kBAAgB,CAAK,kBAAc,CAAK,IAAI,KACjD,OAAa,EAAI+I,IACb,UAAc,GAAO,SAAmB,UACxC,UAAkB,YAEjB,YAAW,KAAO,KAAK,eACvB,WAAW,WAAU,EAAK,kBAC/B,EAAK,KAAOzB,IACZ,GAAK,cAAU,cAAoB,CAC/B,QAASjN,IAAI,GAAK,KAAK,aAAS,OAAYA,CAAK,EAAGA,IACrC,KAAK,KAAK,aAClB,aAAc,cAErC,CAAa,CACJ,CACD,eACSiF,CAAG,WAGQ,KAAK,KAAK,YAAY,kBAAgB,CAAK,YAAY,GAAK,KAEhF,eACSA,CAAG,WAGMA,EAAG,oBAAgB,CAAK,YAI9C,QAAgCN,CAAU,KAAK,IAE/C,QACI,eAAyB,CACrB,IAAIhB,IACJ,GAAK,eAAwBA,CAAKD,EAAO,aAAc,QAAQC,CAAO,SAAc,KAAK,IACzF,GAAK,YAAc,gBAAc,CAAK,IACtC,GAAK,YAAQ,UAAc,KAAK,eAAcgL,CAAuB,CAAE,GACvEjL,CAAO,cAAU,mBAAmB,CAAK,YACzC,EAAK,cAAmB,WACxB,CAAK,cAAU,kBAAkB,CAAK,YAAS,CAAK,eAAW,KAAW,YAC1EgF,CAAa,KAAK,cAAW,WAA8B,QAAK,QAAS,KAAK,WAAW,KAAW,IAAK,GAAE,CAC3G,SAAmB/C,CAAI,iBAAc,QACrCC,CAAW,aAAU,CAAI,QAAK,WAAc,CAAC,EAC7C8C,EAAahF,EAAO,SAAO,OAAUU,CAAU,CACvCoG,EAAQpG,CAAK,EACb,QAAK,QAAQ,UAAU,CAAI,QAAK,WAAW,KAAW,IAAK,GAG3D,QAAK,QAAQ,UAAU,OAAO,KAAK,WAAW,KAAW,IAAK,GAErE,EACDV,EAAO,aAAU,aACjB,QAAK,QAAQ,YACb,QAAK,cACL,QAAmBiC,CAAI,iBAAc,EAAK,GAC1CiJ,CAAW,aAAU,CAAI,QAAK,WAAc,CAAC,EAC7C,QAAK,QAAQ,YACb,SAAkBjJ,CAAI,iBAAc,EAAK,GACzCE,CAAU,aAAU,CAAI,QAAK,WAAc,CAAC,EAC5CH,GAAuBhC,GAAO,QAAM,MAAM,OAAmB,EAC7D,QAAK,cAAc,YACnB,QAAK,aACL,QAAiBiC,CAAI,iBAAc,EAAK,GACxCkJ,CAAS,aAAU,CAAI,QAAK,WAAc,CAAC,EAC3C,QAAK,cAAc,YACnB,SAAsBnL,CAAO,oBACf,YAAU,CAAI,QAAK,WAAc,CAAC,EAChD,QAAK,QAAQ,YACb,QAAK,iBAIb,SAAMoL,WACF,eAAiBpL,CAAQ,CACrB,IAAIC,GACJ,QAAiByH,CAAS,WAAa1H,CAAO,aAAc,QAAQC,CAAO,SAAc,EAAI,EACvFoL,EAAK,IAAIP,IAAe7I,CAAK,EAC/B,SAAc,QACd,CAAMjC,IAAO,GACb,cAAkB,YAEtB,QAAM,OAAO,OAAO,OAAO,OAAiB,EAAG,CAAE,mBAAoB,GAAM,IAAIsL,IAAWrJ,CAAK,EACvF,oBAAqB,GAAK,YAC1B,SACA,QAAc,QACd,SAAiB,GAAO,MAAQ,SAChC,YAAkB,YACjB,CACT,KAAK,kBAAgB,CAAK,kBAAc,CAAK,IAAI,KACjD,EAAK,UAAe,QACpB,CAAK,aACLmG,CAAa,KAAK,aAAU,CAAK,KAAK,qBACtC,EAAK,mBAAe,CAAK,YAAW,KAAO,IAAM,CAC7C,KAAK,aAAS,kBAElB,KAAK,mBAAe,CAAK,YAAW,WAAU,CAAM,CAChD,KAAK,aAAS,kBAElB,KAAK,KAAK,kBAAc,iBAAiB,OAAS,EAAK,kBAE3D,CAAI,aACA,SAAO,CAAK,KAAK,YAAQ,cAE7B,cACI,GAAK,aAAa,cAAa,GAAK,aAAa,cAIzD,UACI,GAAI,YACJ,EAAM,WACN,QACI,SACM5E,EAASa,EAAY+C,EAAQ,CAC/B,UAAS,WAAS,OAClB,CAAMC,IAAE,WAAS,SAAS,QAC1B,WAAY,WAAS,QAEzB,SAAkB,UAAmB,GACxC,KACD,YACI,UAAW+D,IAAiB9D,CAAK,aAC7B,OAAY,QACZ,SAAe,SAAO,SACtB,MAAgB,aACZ,OAAY,SAAO,CACvC,KACgB,YAAgB,YAGxB,GAAIA,IACA,UAAW,wBAGJ,GAAIwC,IAAUxC,CAAK,eAAiB,EAAI,KAFpC,CAGd,CACT,IAEI,QAAMiE,WACF,eAAyB,CACrB,UAAyB,oBAAgB,UACzC,MAAM,OAAO,OAAO,OAAO,OAAiB,EAAG,CAAE,UAAc,kBAAgB,MAAO,CAAM,IAAI5E,IAAe,CACvG,UAAc,QACd,UACA,cAAuB,CAC/B,KAAK,UAAe,QACpB,CAAK,oBAAyB,kBAC9B,CAAK,KAAK,iBAAa,YAAY,CAAK,oBAAgB,CAAK,YAIrE,QAAM6E,WAGN,SAAoBvK,CAAU,KAAK,IACnC,QACI,eAAyB,CACrB,KAAK,YAAc,gBAAc,CAAK,IACtC,GAAK,YAAQ,UAAcwK,IAAa,GACxCzL,CAAO,cAAU,mBAAmB,CAAK,YACzC,OAAmB,kBAAkB,EACrC0L,EAAO,cAAcD,IAAY,GAAI,EACrC,KAAK,YAAQ,YAIrB,UAAME,WACF,eAAyB,CACrB,UAAM,OAAO,OAAO,OAAO,OAAiB,EAAG,CAAE,KAAM,IAAIC,IAAc3J,CAAK,EACtE,aAAkB,YAE7B,CACJ,CAED,UACI,GAAI,eACJ,EAAM,WACN,QAEI,SAA2BmF,EAAQ,CAC/B,KAFMhD,IAEE,WAAS,SAAS,WAE9B,WAAkB,UAAmB,GACxC,KACD,YACI,UAAWuH,IAAoBrE,CAAK,aAChC,OAAY,QACZ,UAAgB,YAGxB,GAAIA,IACA,UAAW,wBAGJ,GAAIkE,IAAalE,CAAK,eAFlB,CAGd,CACT,IAEUuE,CAAc5K,EAAU,KAAK,IACnC,QACI,eAAyB,CACrB,KAAK,YAAc,gBAAc,CAAK,IACtC,GAAK,YAAQ,UAAc4K,IAAa,GACxC7L,CAAO,cAAU,mBAAmB,CAAK,YAC5BA,CAAO,UAAO,UAA0B,CAC7C8L,EACA,KAAK,YAAQ,UAAcD,IAAY,QAAW,GAAK,CAAC,GAGxD,IAAK,YAAQ,UAAU,OAAmB,QAAW,GAAK,CAAC,GAElE,CACD,UAAuB,kBAAc,QAC1B,cAAcA,IAAY,GAAI,EACzC7L,EAAO,cAAU,aACjB,IAAK,YAAQ,YACb,IAAK,kBACL,QAAsB,kBAAc,CAAK,IAC/B,cAAc6L,IAAY,GAAI,EACxC7J,GAAuBhC,EAAO,UAAM,MAAM,OAAmB,CAC7D,KAAK,kBAAc,YACnB,IAAK,iBAIb,SACI,eAAyB,CACrB,KAAK,YAAc2C,IACnB,GAAK,aAAW,CAAK,aAAS,CAAK,IAAI,KACvC,EAAK,UAAe,QACpB,CAAK,cAAmB,YACxB,CAAK,KAAO,IAAIoJ,IAAY9J,CAAK,EAC7B,SAAc,QACd,UAAkB,YAEtB,GAAK,KAAK,kBAAc,iBAAiB,OAAS,EAAK,aAE3D,UACI,GAAK,YAAQ,CAAK,WACd,SAChB,CAAa,IAIT,SACI,eAAyB,CACrB,KAAK,iBAAe,CAAK,iBAAa,CAAK,IAAI,KAC/C,EAAK,IAAM,IAAI+J,IAAkB/J,CAAK,EAClC,SAAc,YACd,UAAqB,UAEzB,KAAK,IAAI,YAAW,UAAS,EAAK,iBAClC,EAAK,IAAM,IAAI6I,IAAe7I,CAAK,EAC/B,SAAoB,CACpB,cAAqB,UAEzB,KAAK,UAAe,QACP,GAAK,UAAO,UAA0B,CAC/C,KAAK,mBAAe,MAAU,cAC9B,KAAK,sBAAkB,UAAc,YACrD,CAAa,CACJ,CACD,IAAI,mBACA,SAAO,CAAK,IAEhB,IAAI,sBACA,SAAO,CAAK,IAEhB,iBACI,GAAK,UAAU,cAClB,CACJ,CAED,UACI,eAAwC,CACpC,KAAK,gBACL,GAAK,aAET,EAAI,UACA,EAAIhC,IACJ,SAAa,GAAK,gBAAY,eAAe,MAAU,WAAO,CAAO,SAAQA,CAAO,SAAc,EACrG,CACD,IAAI,UACA,IAAK,gBAAY,eAAe,MAAU,WAE9C,IAAI,aACA,SAAO,CAAK,gBAAY,MAAU,cAEtC,EAAI,aACA,IAAK,gBAAY,MAAU,cAE/B,IAAI,aACA,SAAO,CAAK,aAAS,SAEzB,UACI,UAAO,CAAK,aAAS,UAEzB,aACI,UAAO,CAAK,aAAS,UAEzB,gBACI,UAAO,CAAK,aAAS,aAEzB,UACI,UAAO,CAAK,aAAS,OAEzB,GAAIhD,IAAgB,CAChB,KAAK,aAAaA,IACrB,CACD,WACI,IAAK,aAAS,OAElB,YAAsB0L,EAAY,CAC9B,WAAO,CAAK,aAAS,SAAsBA,CAAU,CACxD,CACD,eAAwBA,EAAY,CAChC,WAAO,CAAK,aAAS,WAAwBA,CAAU,CAC1D,CACD,aACI,UAAO,CAAK,aAAS,SAI7B,UAAMsD,WACF,eAA8B,CAC1B,UAAkB,EAAI7C,IAAQvK,CAAW,mBACzC,KAAK,eAAa,CAAK,eAAW,CAAK,IAAI,KAC3C,EAAK,kBAAgB,CAAK,kBAAc,CAAK,IAAI,KACjD,EAAK,cAAY,CAAK,cAAU,CAAK,IAAI,KACzC,EAAK,aAAe8D,IACpB,GAAK,gBAAkB,IACvB,KAAK,aAAY,WAAkB,CAC/B,KAAK,aAAS,CAAK,YACf,QAEP,EACD,KAAK,aAAY,WAAkB,CAC/B,KAAK,aAAS,CAAK,YACf,QAEP,EACD,KAAK,gBAAgB,kBAAc,QAAW,WAAU,EAAK,cAC7D,EAAK,gBAAY,QAAQ,QAAW,KAAO,KAAK,eAChD,EAAK,gBAAY,QAAQ,QAAW,WAAU,EAAK,kBACnD,EAAK,gBAAY,QAAQ,MAAM,QAC3B,KAAK,kBAEZ,CACD,IAAI,UACA,SAAO,CAAK,gBAAY,QAAQ,MAAWuJ,IACvC,UAAY,GAAK,gBAAgBA,CAAE,GACnC,EAAI,CAACjP,GACD,SAAc,oBAElB,SAGR,YACI,SAAY,GAAK,gBAAY,CAAK,YAAQ,cAC/B,EAAIkP,IAAkBlK,CAAK,EAClC,aAAoB,aAChB,UACA,SAAc,GAClC,KACgB,QAAgB,aACZ,UAEpB,CAAa,EACD,KAAK,gBAAgBiK,IAAW,KAAK,KACrC,OAAY,GAAK,gBAAgBA,CAAE,GACnC,EAAI,CAACjP,GACD,SAAc,oBAElB,SAEJ,aACI,IAAK,gBAAY,OAErB,EAAG0D,EAAWE,EAAS,CACnB,UAAmB,KAAK,IAAI,KAC5B,SAAK,aAAYF,CAAYY,GAAO,CAChCX,EAAGW,EAAG,KAAK,KAER,GACV,CACD,kBACI,SAAgB,GAAK,aAAS,QAAW,CAAMtE,IAAQA,CAAI,gBAAmB,sBAC1E,CAACsL,GACD,SAAc,oBAElB,QAAY,EAAI6D,IAAWF,CAAI3D,EAAO,CACtC,KAAK,gBAAgB2D,IACxB,CACD,eACI,IAAK,kBAAiB,EAAI,CAC7B,IACD,eAEI,EAAI,CADQ,KAAK,gBAAgB3K,IAAG,EAAI,KAEpC,OAAc,oBAElB,GAAK,gBAAY,OAAU,EAAI,CAClC,IACD,WACI,IAAK,aAAS,CAAK,YACf,QAAWjC,IAAiB,GAAMiC,IAAG,WAKjD,UAA2B,GAC3B,SACI,eACI,GAAK,0BAAwB,CAAK,0BAAsB,CAAK,IAAI,KACjE,EAAK,UAAwB,EAC7B,KAAK,kBAA8C,EACnD,KAAK,WAET,GAAIsC,IAAiB,CACjB,UAAcgF,CAAyD,KAAK,WAAO,OACnF,CAAK,WAAO,OAAiBhF,CAAI,EACjCA,EAAK,YAAW,WAAU,EAAK,0BAC/B,EAAK,mBAET,SACI,SAAc,GAAK,WAAO,QACtBtE,CAAQ,IAGZ,KAAK,WAAO,OAAe,CAC3BsE,EAAK,YAAY,YAAU,EAAK,0BAChC,EAAK,mBAET,kBACI,CAAI,KAAK,WAAO,OAAc,CAC1B,KAAK,kBAAc,SACnB,IAAK,UAAM,SACX,UAEJ,MAAsB,GAAK,WAAO,UAAiBwI,CAAE,aACjC,EAChB,KAAK,WAAO,QAAY/P,GAAM,CAC1B+P,EAAE,aAAiB,CACvC,CAAiB,EACD,KAAK,kBAAc,SAGnB,KAAK,WAAO,QAAY/P,GAAM,CAC1B+P,EAAE,aAAiBC,CACvC,CAAiB,EACD,KAAK,kBAAc,SAEvB,IAAK,UAAM,SAEf,yBACI,EAAI/K,EAAG,aACH,OAAc,GAAK,WAAO,UAAiB,GAAMA,EAAG,WACpD,EAAK,WAAO,QAAYjF,GAAM,CAC1B,EAAE,aAAiBiD,CACvC,CAAiB,EACD,KAAK,kBAAc,SACtB,GAEG,KAAK,mBAKjB,SAAoB0B,CAAU,KAAK,IACnC,QACI,eAAyB,CACrB,KAAK,YAAc,gBAAc,CAAK,IACtC,GAAK,YAAQ,UAAcsL,IAAa,CAAEtB,GAAuB,CAAE,GACnEjL,CAAO,cAAU,mBAAmB,CAAK,YAC/BA,CAAO,UAAwB,OAAK,QAAqB,QAAW,IAAK,GAAE,CACrF,SAAkBiC,CAAI,iBAAc,EAAK,GACzCE,CAAU,aAAU,CAAIoK,GAAY,GAAG,CAAC,EACxC,QAAK,QAAQ,YACb,QAAK,aACL,QAAmBtK,CAAI,iBAAc,EAAK,GAC1CiJ,CAAW,aAAU,CAAIqB,GAAY,GAAG,CAAC,EACzC,QAAK,QAAQ,YACb,SAAqBvM,CAAO,mBACf,YAAU,CAAIuM,GAAY,GAAG,CAAC,EAC3C,QAAK,QAAQ,YACb,QAAK,gBAIb,SAAMC,WACF,eAAiBxM,CAAQ,CACrB,SAAW,GAAI8K,GAAe7I,GAC1B,SAAc,QACd,UAAkB,YAEhBwK,CAAM,IAAIC,GAChB,SACI,OAAc,QACd,eACA,OAAM,CAAIC,GAAQ1K,GACd,mBAAoB,OAAK,QACzB,MAAW,QACX,UAAkB,YAEzB,CACD,QAAK,WAAa,KAAK,WAAW,KAAK,CAAI,IAC3C,MAAK,cAAgB,KAAK,cAAc,KAAK,CAAI,IACjD,MAAK,SAAW,CAAIoH,GAAiB,IAAM,IAAI,IAC/C,MAAK,SAAS,QAAW,QAAO,MAAK,WACrC,MAAK,SAAS,QAAW,WAAU,MAAK,cACxC,MAAK,CAAMoD,GAEf,GAAI,WACA,SAAO,KAAK,SAEhB,CAAIP,GAAIrD,CAAW,CACf,QAAK,SAAS,CAAIqD,GAAa,CAClC,CACD,UACI,QAAK,SAAS,OAAO,KAAK,SAAS,MACtC,CACD,cACI,SAAW3K,CAAG,QACE,QAAK,KAAK,aAAiB,iBAAe,KAAK,QAAY,QACxE,kBAAe,UAAU,CAAI,WAAU,MAAK,UAC/C,MAAK,eAAe,KAAK,CAAI2K,GAAG,oBAAsB,QACtD,MAAK,CAAI,IAAIA,GAAG,QAAM,MAAM,UAEhC,iBACI,SAAW3K,CAAG,QACA2K,GAAG,iBAAe,KAAK,QAClC,kBAAe,UAAU,CAAI,WAAU,EAAI,IAC9C,MAAK,eAAe,KAAK,OAAU,oBACnC,MAAK,CAAI,UAAU,QAAM,MAAM,UAEtC,CAED,SAAuB,CACnB,GAAI,QACJ,MAAM,OACN,QACI,SAAU9H,CACJZ,EAASa,EAAY+C,EAAQ,CAC/B,SAAS,WAAS,MAAQ,WAAS,OAAS,OAAS,WAAS,OAC9D,QAAQ,WAAS,SAAS,EAAK,GAClC,CACD,UAAe5D,EAAO,SAAM,OAAW,CAC5B,QAEF,QACZ,CACD,cACI,SAAU,GAAIgJ,GAAclF,GAAK,WAC7B,OAAY,QACZ,UAAgB,YAEpB,SAAK,SAAO,MAAM,QAAe,CAC7B,SAAW,GAAI6E,GAAkB7E,GAAK,WAClC,WAAoB,aAChB,UACA,SAAS,QAEb,QAAgB,aACZ,UACH,CACrB,CAAiB,EACDsF,EAAE,IAAIV,GACT,EACMU,CACV,EACD,IAAItF,GACA,UAAW,wBAGJ,IAAI2E,GAAO3E,GAAK,aAAiB,GAAI,IAFjC,EAGd,IAGL,WAA+BuF,GAAQvF,CAAM,CACzC,SAAWuF,CAAO,UAAY,SAC9B,CAAI,CAACC,EACD,UAAO,KAEX,MAAiB1I,CAAc,YAAS,QAAa,SAAO,SAAa,OAC1DA,CAAc,YAAS,QAAa,SAAO,OAAW,OACrE,OAAc,aACV,OAAoB,GACpB,WAAe,WACf,OAAkB,OAAO,OAAO,OAAO,OAAW0I,EAAG,UAAW,WAAoB,SAAgB,CACpG,aAAqB,UACjB,UACA,SAEhB,CAAS,CACJ,CAED,SACI,eACI,OAAK,SACL,QAAK,QAAU,CAAInK,GAEvB,UACA,QACQ,OAAK,SAGT,MAAK,QAAQ,KAAK,MACd,SAAQ,CACxB,IAII,SACI,eAAiBoK,CAAU,CACvB,QAAK,UACL,QAAK,SAAW,KAChB,KAAK,QAAU,KAAK,QAAQ,KAAK,CAAI,IACrC,MAAK,KACL,OAAK,QAAU,CAAIpK,GACnB,OAAK,UACL,OAAK,UAET,GAAI,YACA,SAAO,KAAK,UAEhB,CAAI,YACA,QAAK,UACD,OAAK,UACL,KAAK,YAGL,OAAK,UAGb,UACI,OAAK,YAET,cACI,EAAI,QAAK,SAAa,OAClB,OAEJ,MAAY,OAAK,KAAK,YAElBqD,EAAI,iBAAc,KAAK,SAE3B,MAAK,SAAW,CACnB,IACD,UAEI,EADA,QAAK,YACD,OAAK,UACL,UAEJ,MAAY,OAAK,KAAK,YAClBA,CACA,QAAK,SAAe,cAAY,KAAK,QAAS,KAAK,UAG3D,UACQ,OAAK,UAGT,MAAK,QAAQ,KAAK,MACd,SAAQ,CACxB,IAII,SACI,eACI,QAAK,eAAiB,KAAK,eAAe,KAAK,CAAI,IACnD,MAAK,OAAgB,SACrB,KAAK,OAAgB,SACrB,KAAK,QAAU,CAAIrD,GACnB,OAAK,MAAe,QACpB,KAAK,MAAM,QAAW,WAAU,MAAK,eACrC,MAAK,OAAgB,SACrB,KAAK,KAET,OACI,QAAoB,OAAK,OAAO,KAC5BqK,GAAgB,SAChB,QAAK,MAAM,SAAW,KAAK,OAElC,CACD,UACI,QAAK,OAAO,KAAK,OAErB,kBACI,QAAK,OAAU,WACf,MAAK,QAAQ,KAAK,QACd,UAAY,UACZ,SAAa,WACb,OAAQ,CACxB,IAII,YAAoBC,GAAQC,CAAY,CACpC,OAAc,UACVD,EAAO,QAAK,KAGpB,YAA0BC,GACtB,SAAe,EACf,UAAWD,GAAkB,EACtB/J,EAAY+J,CAAM,CAC5B,CACD,YAA6BA,GACzB,SAAcA,CAAO,WAAQ,KAC7B,UAAyB,CAAIA,EAASA,EAAO,SAAc,CAC9D,CACD,YAA4BA,GAAQE,CAAU,CAC1C,SAAmB,GAAGC,GAAoBH,CAAM,EAAGE,CAAQ,EAC3D,UAAc,SAAgB,SAChB,SAAUE,CAAU,UAAgB,SAG9CC,CAAWD,GAAWJ,CAAO,UAKrC,SACI,eACI,QAAK,QAAU,KAAK,QAAQ,KAAK,CAAI,IACrC,MAAK,QAAiB,SACtB,KAAK,OAAgB,SACrB,KAAK,QAAU,CAAItK,GACnB,OAAK,MAAe,QACpB,KAAK,OAAgB,SACrB,KAAK,OAAO,QAAW,SAAQ,MAAK,QACpC,MAAK,KAET,UACI,OAAK,OAAO,QAEhB,OACI,QAAoB,OAAK,OAAO,KAChC,EAAIqK,IAAgB,QAChB,SAEJ,MAAe,OAAK,MAAM,SACT,OAAK,QACtB,QAAK,MAAM,SAA8BC,GAAgB,EACzD,QAAK,QAAQ,KAAK,QACd,WACA,SAAQ,CACxB,IAEQ,UACI,QAAK,KAIb,SACI,eACI,QAAK,YAET,YACI,UAAO,KAAK,YAAY,OAAgBL,IAC7BA,EAAE,aACV5N,CAAK,CACX,CACJ,CACD,YAAwB4N,GAAGW,CAAiB,CACxC,GAAIX,gBACA,SAEJ,EAAIA,gBAAkC,CAClC,SAAeA,CAAE,eAAY,OAAmBY,IACxCC,IAGGD,gBAAgCA,CAAK,QAC7C,EAAI,IACP,CAAIhK,GACA,SAGR,SAAO,CACV,IAED,MACI,eACI,QAAK,OAAkB,aACnB,EAAKxD,GAAO,GACZ,IAAKA,GAAO,EAC5B,CAAa,GAEL,YACI,SAAY,OAAK,OAAO,CAAI,KAAK,GAC3B7H,CAAM,QAAK,OAAO,CAAI,KAAK,GACjC,SAAO,KAAK,CAAI,QAAK,CAAI6G,GAAU,EAAG5G,CAAG,CAC5C,CACJ,CAED,SACI,eACI,QAAK,OAAkB,aACnB,SAEP,CACD,IAAI,WACA,SAAO,KAAK,OAAO,CAAI,YAE3B,YACI,SAAa,OAAK,OAAO,CAAI,YAC7B,SAAS,SAAW,EAGJ0K,EAAK,UACVe,EAAK,SACf,EAAE,UAJQ7E,CAKc8D,EAAK,CAAC,EAAE,SAIzC,OACI,eACI,QAAK,OAAkB,aACnB,EAAK9C,GAAO,GACZ,IAAKA,GAAO,EAC5B,CAAa,GAEL,GAAI,YACA,SAAO,KAAK,OAAO,CAAI,KAAK,GAEhC,GAAI,YACA,SAAO,KAAK,OAAO,CAAI,KAAK,GAEhC,YACI,SAAY,OAAK,OAAO,CAAI,KAAK,GAC3B7H,CAAM,QAAK,OAAO,CAAI,KAAK,GACjC,GAAIqL,GAASxE,CACb,UAAgB,IACZwE,EAAS,QAAK,CAAIA,GAAW,GAE5BsD,EAAQ1O,CAAG,IACZoL,EAAS,QAAK,CAAIA,GAAW,GAE1BA,CACV,CACJ,CAED,SACI,eAAkBkK,CAAS,EAAG,CAC1B,QAAK,KACL,OAAK,OAET,YACI,SAAU,OAAK,OAAS,KAAK,KACnB,OAAK,MAAeC,GAAK,QAAK,CAAI,IAC5C,QAAWC,CAAI,QAAK,CACvB,IAGL,OAAoB3M,GAAU,IAAK,GACnC,QACI,eAAiBjB,CAAQ,CACrB,QAAK,eAAiB,KAAK,eAAe,KAAK,CAAI,IACnD,MAAK,OAAgB,QACrB,KAAK,QAAc,gBAAc,EAAK,GACtC,OAAK,QAAQ,UAAU,CAAI6N,GAAa,GACxC7N,EAAO,aAAU,mBAAmB,KAAK,QACzC,OAAmBiC,CAAI,iBAAc,QACrC6L,CAAW,aAAU,CAAID,GAAY,GAAG,CAAC,EACzC7N,EAAO,aAAU,aACjB,QAAK,QAAQ,YACb,QAAK,cACL,QAAiBiC,CAAI,iBAAc,EAAK,GACxCkJ,CAAS,aAAU,CAAI0C,GAAY,GAAG,CAAC,EACvC1C,EAAS,eAAiClJ,GAAK,YAC/C,QAAK,QAAQ,YACbjC,EAAO,SAAM,QAAW,WAAU,MAAK,eACvC,MAAK,OAAgB,QACR,OAAK,OAAQ,SAAY8C,CAAS,CAC3CiL,GAAoB,QAAK,cACpB,WAAkB,CACnB,SAAmB9L,CAAI,iBAAc,QACrC+L,CAAW,eAAmB,OAC9B,KAAK,cAAc,YACtB,EACD,QAAK,QAEZ,CACD,WACI,QAAe,OAAK,OAAO,CAAI,YAAW,GAAKL,GAAMA,EAAE,SACvD,MAAK,cAAc,cAAuB,UAAQ,KAAK,OAAO,SAElE,gBACI,OAAK,QAIb,SACI,eAAiB3N,CAAQ,CACrB,QAAK,gBAAkB,KAAK,gBAAgB,KAAK,CAAI,IACrD,MAAK,MAAe,QACpB,KAAK,MAAe,QACpB,KAAK,UAAmB,YACxB,KAAK,KAAO,CAAIiO,GAAShM,GACrB,SAAO,KAAK,MACZ,MAAO,KAAK,MACZ,UAAW,KAAK,UAEpB,OAAK,KAAK,cAAc,iBAAiB,QAAU,MAAK,gBAE5D,iBACI,SAA6B,CAAE,iBAC/B,KAAK,MAAM,SACP,KAAK,MAAM,CAAI,YAAW6L,CAAW,iBAAe,OAIhE,OAAoB7M,GAAU,IAAK,GACnC,QACI,eAAiBjB,CAAQ,CACrB,QAAK,QAAc,gBAAc,EAAK,GACtC,OAAK,QAAQ,UAAU,CAAIkO,GAAa,GACxClO,EAAO,aAAU,mBAAmB,KAAK,QAC/BA,EAAO,SAAwB,OAAK,QAASkO,CAAY,OAAW,GAAG,CAAC,CAAC,CACtF,CACJ,CAED,QAAsB,CAClB,cAAiBlO,EAAQ,CACrB,OAAK,MAAoB,EAAK,EAC9B,OAAK,UAAmB,YACxB,KAAK,KAAO,IAAImO,CAAUlM,EAAK,CAC3B,QAAO,KAAK,MACZ,UAAW,KAAK,UAG3B,CAED,QAAMmM,CAAcnN,EAAU,OAC9B,QAAe,CACX,cAAiBjB,EAAQ,CACrB,OAAK,UAAY,KAAK,UAAU,KAAK,KACrC,MAAK,QAAc,gBAAc,KACjC,OAAK,QAAQ,UAAU,IAAIoO,CAAa,GACxCpO,EAAO,YAAU,mBAAmB,KAAK,QACzC,MAAK,OAAgB,QACrB,KAAK,OAAO,QAAQ,CAAG,UAAU,MAAK,UACtC,OAAkBiC,EAAI,gBAAc,OACpCoM,EAAU,YAAU,IAAID,CAAY,GAAG,CAAC,EACxCC,EAAU,OAAO,MACjBrO,CAAO,YAAU,aAAsB,CACvC,OAAK,QAAQ,YAAqB,CAClC,OAAK,aACLA,EAAO,QAAM,QAAQ,CAAG,UAAU,MAAK,UACvC,MAAK,OAAgB,QACrB,KAAK,QAET,UACI,QAAkB,OAAK,OAAO,IAAI,WAClC,OAAK,aAAa,MAAkB,OAAK,OAAO,SAEpD,WACI,OAAK,QAEZ,CAED,QAAqB,CACjB,cAAiBA,EAAQ,CACrB,OAAK,eAAiB,KAAK,eAAe,KAAK,KAC/C,MAAK,QAAiB,SACtB,KAAK,MAAe,QACpB,KAAK,MAAe,QACpB,KAAK,UAAmB,YACxB,KAAK,KAAO,IAAIsO,CAASrM,EAAK,CAC1B,QAAc,QACd,MAAO,KAAK,MACZ,UAAW,KAAK,UAEpB,OAAK,KAAK,aAAa,iBAAiB,QAAU,MAAK,eAE3D,gBAAkB,CAEd,QAD4B,EAAE,gBACN,MACJ,OAAK,QAAa,CACjC6E,EAAQyH,CAAW,IACpB,OAAK,MAAM,SAAWA,CAE1B,OAAK,KAAK,QAEjB,CAED,WAASC,CAAaxP,EAAO,CACzB,SAAO,OACV,CACD,WAASyP,CAAgBzP,EAAO,CAC5B,SAAIA,EAAU,SACH,EAEJ,CAAC,CAACA,CACZ,CACD,WAAS0P,CAAiB1P,EAAO,CAC7B,SAAOwP,CAAaxP,EACvB,CAED,QAAwB,CACpB,cAAkB,CACd,OAAK,KAET,WACI,SAAO,OAAO,KAAK,KAEvB,UACI,SAAO,KAAK,KAGpB,OAAM2P,CAAuB,EACzB,IAAM,CAAClM,EAAIC,IAAO,OAAK,IAAQA,CAAE,EACjC,IAAK,CAACD,EAAIC,IAAOD,EAAKC,EACtB,IAAK,CAACD,EAAIC,IAAOD,EAAKC,EACtB,IAAK,CAACD,EAAIC,IAAOD,EAAKC,EACtB,IAAK,CAACD,EAAIC,IAAOD,EAAKC,EACtB,IAAK,CAACD,EAAIC,IAAOD,EAAKC,EACtB,KAAM,CAACD,EAAIC,IAAOD,GAAMC,EACxB,KAAM,CAACD,EAAIC,IAAOD,GAAMC,EACxB,MAAO,CAACD,EAAIC,IAAOD,IAAOC,EAC1B,IAAK,CAACD,EAAIC,IAAOD,EAAKC,EACtB,IAAK,CAACD,EAAIC,IAAOD,EAAKC,EACtB,IAAK,CAACD,EAAIC,IAAOD,EAAKC,CAC9B,EACI,QAA0B,CACtB,cAAsBkM,EAAMC,EAAO,CAC/B,OAAK,KACL,OAAK,SACL,OAAK,MAET,WACI,QAAWF,GAAqB,OAAK,SACrC,EAAI,EAACG,CACD,QAAM,IAAI,MAAM,8BAAgC,OAAK,SAAU,CAEnE,SAAU,OAAK,KAAK,SAAY,OAAK,MAAM,SAC9C,CACD,WACI,SACI,GACA,OAAK,KAAK,SACV,OAAK,SACL,KAAK,MAAM,SACX,GAChB,EAAc,OAAK,CAAG,CACb,CACJ,CACD,QAAMC,CAAsB,EACxB,GAAM3V,GAAMA,EACZ,IAAMA,GAAM,CAACA,EACb,IAAMA,GAAM,CAACA,CACrB,EACI,QAAyB,CACrB,cAAsB4V,EAAM,CACxB,OAAK,SACL,OAAK,WAET,WACI,QAAWD,GAAoB,OAAK,SACpC,EAAI,EAACD,CACD,QAAM,IAAI,MAAM,6BAA+B,OAAK,SAAU,CAElE,SAAU,OAAK,WAAW,SAC7B,CACD,WACI,SAAQ,GAAM,OAAK,SAAU,KAAK,WAAW,SAAY,GAAG,EAAE,OAAK,CAAG,CACzE,CACJ,CAED,WAASG,CAAcC,EAAS,CAC5B,SAAcC,IAAW,CACrB,UAAa,EAAG7S,EAAI4S,EAAQ,SAAQ5S,EAAK,CACrC,QAAe4S,EAAQ5S,CAAC,EAAEmC,EAAM0Q,CAAM,EACtC,GAAI3L,IAAW,GACX,SAGR,SAEP,CACD,WAAS4L,CAAe3Q,EAAM0Q,EAAQ,CAClC,MACA,QAAU1Q,EAAK,SAAa,CAAE,QAAM,IAAM,EAC1C,SAAc4Q,GAAKA,EAAE,CAAC,KAAQ,OAAQpP,GAAO,OAASA,EAAK,EAC9D,CACD,WAASqP,CAAiB7Q,EAAM0Q,EAAQ,CACpC,QAAW1Q,EAAK,SAAe,CAAC,EAChC,SAAU,QAAM,OAAS,EAAI8Q,EAAK,EACrC,CACD,WAASC,CAAkB/Q,EAAM0Q,EAAQ,CACrC,MACA,QAAU1Q,EAAK,SAAa,CAAE,QAAM,OAAS,EAC7C,SAAc4Q,GAAKA,EAAE,CAAC,KAAQ,OAAQpP,GAAO,OAASA,EAAK,EAC9D,CACD,WAASwP,CAAkBhR,EAAM0Q,EAAQ,CACrC,QAAWK,GAAkB/Q,EAAM0Q,CAAM,EACzC,GAAIO,IAAO,GACP,SAEJ,QAAajR,EAAK,SAAe,CAAC,EAElC,GADA0Q,GAAU,EACNQ,IAAS,KAAOA,IAAS,IACzB,SAEJ,QAAYH,GAAkB/Q,EAAM0Q,CAAM,EAC1C,SAAIS,EAAQ,GACD,GAEJD,EAAOC,CACjB,CACD,WAASC,CAAiBpR,EAAM0Q,EAAQ,CACpC,QAAU1Q,EAAK,SAAe,CAAC,EAE/B,GADA0Q,GAAU,EACNW,EAAE,cAAa,EAAK,IACpB,SAEJ,QAAWL,GAAkBhR,EAAM0Q,CAAM,EACzC,SAAIY,EAAO,GACA,GAEJD,EAAIC,CACd,CACD,WAASC,CAA0BvR,EAAM0Q,EAAQ,CAC7C,QAAW1Q,EAAK,SAAe,CAAC,EAChC,GAAI8Q,IAAO,IACP,SAEJ,QAAYD,GAAiB7Q,EAAM0Q,CAAM,EAEzC,SADAA,CAAUc,EAAI,SACVA,EAAQ,GACD,GAEJA,EAAMT,GAAkB/Q,EAAM0Q,CAAM,CAC9C,CACD,WAASe,CAAoBzR,EAAM0Q,EAAQ,CACvC,QAAYa,GAA0BvR,EAAM0Q,CAAM,EAElD,GADAA,GAAUgB,EAAI,SACVA,EAAQ,GACR,SAEJ,QAAY1R,EAAK,SAAe,CAAC,EAEjC,GADA0Q,GAAUiB,EAAI,SACVA,EAAQ,IACR,SAEJ,QAAYZ,GAAkB/Q,EAAM0Q,CAAM,EAC1C,SAAAA,CAAUkB,EAAI,SACDD,EAAMC,EAAMR,GAAiBpR,EAAM0Q,CAAM,CACzD,CACD,WAASmB,CAAoB7R,EAAM0Q,EAAQ,CACvC,QAAY1Q,EAAK,SAAe,CAAC,EAEjC,GADA0Q,GAAUiB,EAAI,SACVA,EAAQ,IACR,SAEJ,QAAYZ,GAAkB/Q,EAAM0Q,CAAM,EAE1C,SADAA,CAAUkB,EAAI,SACVA,EAAQ,GACD,GAEJD,EAAMC,EAAMR,GAAiBpR,EAAM0Q,CAAM,CACnD,CACD,WAASoB,CAAoB9R,EAAM0Q,EAAQ,CACvC,QAAYa,GAA0BvR,EAAM0Q,CAAM,EAElD,SADAA,CAAUgB,EAAI,SACVA,EAAQ,GACD,GAEJA,EAAMN,GAAiBpR,EAAM0Q,CAAM,CAC7C,CACD,QAAMqB,CAAqBvB,GAAc,EACrCiB,EACAI,GACAC,EACR,CAAK,EACD,WAASE,CAAkBhS,EAAM0Q,EAAQ,CACrC,MACA,QAAU1Q,EAAK,SAAa,CAAE,QAAM,MAAQ,EAC5C,SAAc4Q,GAAKA,EAAE,CAAC,KAAQ,OAAQpP,GAAO,OAASA,EAAK,EAC9D,CACD,WAASyQ,CAAyBjS,EAAM0Q,EAAQ,CAC5C,QAAe1Q,EAAK,SAAe,CAAC,EAEpC,GADA0Q,GAAUwB,EAAO,SACN,cAAa,EAAK,MACzB,QAEJ,QAAYF,GAAkBhS,EAAM0Q,CAAM,EAC1C,SAAIyB,EAAQ,GACD,GAEJD,EAASC,CACnB,CACD,WAASC,CAAgBpS,EAAM0Q,EAAQ,CACnC,MACA,QAAU1Q,EAAK,SAAa,CAAE,QAAM,OAAS,EAC7C,SAAc4Q,GAAKA,EAAE,CAAC,KAAQ,OAAQpP,GAAO,OAASA,EAAK,EAC9D,CACD,WAAS6Q,CAAwBrS,EAAM0Q,EAAQ,CAC3C,QAAe1Q,EAAK,SAAe,CAAC,EAEpC,GADA0Q,GAAUwB,EAAO,SACN,cAAa,EAAK,MACzB,QAEJ,QAAYE,GAAgBpS,EAAM0Q,CAAM,EACxC,SAAI4B,EAAQ,GACD,GAEJJ,EAASI,CACnB,CACD,WAASC,CAAcvS,EAAM0Q,EAAQ,CACjC,MACA,QAAU1Q,EAAK,SAAa,CAAE,QAAM,WAAa,EACjD,SAAc4Q,GAAKA,EAAE,CAAC,KAAQ,OAAQpP,GAAO,OAASA,EAAK,EAC9D,CACD,WAASgR,CAAsBxS,EAAM0Q,EAAQ,CACzC,QAAe1Q,EAAK,SAAe,CAAC,EAEpC,GADA0Q,GAAUwB,EAAO,SACN,cAAa,EAAK,MACzB,QAEJ,QAAYK,GAAcvS,EAAM0Q,CAAM,EACtC,SAAI+B,EAAQ,GACD,GAEJP,EAASO,CACnB,CACD,QAAMC,CAA+BlC,GAAc,EAC/CyB,EACAI,GACAG,EACR,CAAK,EACKG,GAAqBnC,GAAc,EACrCkC,EACAX,EACR,CAAK,EAED,WAASa,CAAa5S,EAAM0Q,EAAQ,CAChC,QAAYiC,GAAmB3S,EAAM0Q,CAAM,EAE3C,SADAA,CAAUmC,EAAI,SACVA,EAAQ,GACD,OAGP,WAAW,IAAIC,CAAkBD,EAAG,CACpC,SAEP,CACD,WAASE,CAA6B/S,EAAM0Q,EAAQ,CAChD,QAAW1Q,EAAK,SAAe,CAAC,EAEhC,GADA0Q,GAAUL,EAAG,SACTA,EAAO,IACP,SAAO,KAEX,MAAa2C,GAAgBhT,EAAM0Q,CAAM,EACzC,GAAI,EAACH,CACD,SAAO,KAEFA,EAAK,SACdG,CAAUC,GAAe3Q,EAAM0Q,CAAM,EAAE,SACvC,MAAW1Q,EAAK,SAAe,CAAC,EAEhC,SADA0Q,CAAUuC,EAAG,SACTA,EAAO,IACA,OAGP,WAAgB,YAChB,OAEP,CACD,WAASC,CAAuBlT,EAAM0Q,EAAQ,CAC1C,MACA,SAAckC,GAAa5S,EAAM0Q,CAAM,KAAO,OAAQlP,GAAO,OAASA,EAAKuR,GAA6B/S,EAAM0Q,CAAM,CACvH,CACD,WAASyC,CAAqBnT,EAAM0Q,EAAQ,CACxC,QAAawC,GAAuBlT,EAAM0Q,CAAM,EAChD,GAAIH,EACA,SAEJ,QAAWvQ,EAAK,SAAe,CAAC,EAEhC,GADA0Q,GAAUL,EAAG,SACTA,EAAO,KAAOA,IAAO,KAAOA,IAAO,IACnC,SAAO,KAEX,MAAY8C,GAAqBnT,EAAM0Q,CAAM,EAC7C,SAAKmC,CAGLnC,EAASmC,EAAI,SAET,QACA,YAAW,IAAIO,CAAmB/C,EAAIwC,EAAI,YACtD,CANmB,OAQf,SAASQ,CAAmBC,EAAKtT,EAAM0Q,EAAQ,CAC3CA,GAAUC,GAAe3Q,EAAM0Q,CAAM,EAAE,SACvC,MAAW4C,EAAI,SAAQjD,CAAOrQ,EAAK,aAAe0Q,CAAM,CAAC,EAAE,CAAC,EAC5D,SAAKL,CAGLK,GAAUL,EAAG,SACbK,CAAUC,GAAe3Q,EAAM0Q,CAAM,EAAE,SAEnC,QACA,WACZ,EAPmB,OASf,SAAS6C,CAAsCC,EAAYF,EAAK,CAC5D,SAAc5C,IAAW,CACrB,QAAkB8C,EAAWxT,EAAM0Q,CAAM,EACzC,GAAI,EAAC+C,CACD,SAAO,KAEFA,EAAU,SACnB,IAAWA,EAAU,YACrB,KAAS,CACL,QAAWJ,GAAmBC,EAAKtT,EAAM0Q,CAAM,EAC/C,GAAI,EAACL,CACD,QAEKA,EAAG,SACZ,MAAiBmD,EAAWxT,EAAM0Q,CAAM,EACxC,GAAI,EAACgD,CACD,SAAO,KAEFA,EAAS,SACX,MAAIC,CAAoBtD,EAAG,WAAgBqD,EAAS,YAE/D,QACM,CACE,SACA,YACH,CACC,OAGd,OAAME,CAAiC,EAClC,IAAI,EACL,CAAC,IAAK,IAAK,GAAG,EACd,CAAC,IAAK,GAAG,EACT,CAAC,KAAM,MAAO,IAAI,EAClB,CAAC,GAAG,EACJ,CAAC,GAAG,EACJ,CAAC,GAAG,CACZ,EAAM,SAAQ3O,CAAQqO,IACPC,GAAsCtO,EAAQqO,CAAG,EACzDH,EAAoB,GACvB,UAASH,CAAgBhT,EAAM0Q,EAAQ,CACnC,SAAAA,CAAUC,GAAe3Q,EAAM0Q,CAAM,EAAE,SAChCkD,CAA+B5T,EAAM0Q,CAAM,CACrD,CACD,WAASmD,CAA0B7T,EAAM,CACrC,QAAagT,GAAgBhT,EAAM,CAAC,EAKpC,SAJKuQ,CAGUA,EAAK,SAASI,CAAe3Q,EAAMuQ,EAAK,SAAQ,QAChDvQ,EAAK,SACT,KAEC,YAGhB,SAAS8T,CAAY9T,EAAM,CACvB,MACA,QAAU6T,GAA0B7T,EAAI,CACxC,SAAmDmP,GAAE,YAAU,EAAM,WAAe,MAAS3N,IAAK,EACrG,CACD,SAASuS,GAAkBxT,IACvB,SAAWA,GAAU,aACjB,GAAOA,EAEX,MAAI,QAAiB,YACjB,GAAMyT,EAAKF,MACX,GAAI,KAAW,CACX,OAAOE,CAEd,EACD,KAAO,EACV,MACD,SAA+B,CAC3B,UAAO,IAAOzT,CAAK,CACtB,CACD,aAAuC,CACnC,WACWA,CAAM,WAAQ,EAAK,IAAI,OAAK,KAAY,CAAE,GAAI,CAAC,IAI9D,IAAM0T,GAAiBC,EAAsB,CAAC,EAC9C,SAASC,GAAiB5T,EAAO,CAC7B,UAAsBA,CAAK,EAAI,GAClC,CAED,SAAS6T,GAAkB7T,EAAO,CAC9B,UAAO,IAAOA,CAAK,CACtB,CACD,aAAsBA,CAAO,CACzB,UAGJ,aAAyB,WAAS,YAAW,YAAS,UAClD,GAAI8T,QACJ,QAAyB5N,EAAU,CAC3B4N,WAIJ5N,EACA4N,EAAW,GACd,CACDC,EAAQ,QAAQ,GAAG,aACfC,GAAgB,QACF,UAAYC,EAAQF,EAASG,CAAS,WAAa,CAC7E,CAAa,CACb,CAAS,EACDA,EAAU,SAAQ,EAAG,aACjBF,GAAgB,QACJ,UAAYG,EAASJ,EAASG,CAAS,WAAa,CAC5E,CAAa,EACDF,EAAgB,IAAM,OACR,QAAYC,EAAQF,EAASG,CAAS,WAAa,CAC7E,CAAa,CACb,CAAS,EACDF,EAAgB,SACF,UAAYC,EAAQF,EAASG,CAAS,WAC5C,EAAW,GACX,aAKZ,QAASE,GAAcC,EAAUC,EAAM,CACnC,QAAaD,GAAYC,EAAK,SAAS,CAAM,IAAMA,EAAK,SAAW,GAAK,GACxE,UAAS,KACE,CAACC,OAEE,QAGP,CACV,CACD,WAASC,CAAoBjS,EAAI,CAC7B,UACI,IAAQA,EAAG,OACX,QAASA,EAAG,MAAQ,cACpB,aAAa,UACb,CAAOA,EAAG,QAAQ,OAC9B,CACK,CACD,cAAmC,CAC/B,UACI,IAAQA,EAAG,OACX,QAASA,EAAG,MAAQ,cACpB,aAAa,UACb,CAAOA,EAAG,QAAQ,YAG1B,cAAiC,CAC7B,UAAO3B,CAAQ,YAAaA,GAAQ,WACvC,CACD,eACI,UAA0BA,CAAG,GAAKA,SAAQ,QAAeA,IAAQ,YACpE,CAED,eAA6BgC,CAAM,CAC/B,QACA,MAAMoE,EAAMpE,IAAK,YAAc,gBACb,sCAER,SAAiBoE,EAAOA,EAAI,WAAc,MAAQ/F,OAAO,IAASA,IAAK,CAAKwT,EAAK,OACvF,CAAGlS,EAAG,WAAiByE,GAAOA,EAAI,WAAc,MAAQmE,OAAO,IAASA,IAAK,CAAKsJ,EAAK,OAG/F,KAAMC,EAAe,CACjB,aAAYla,CAAS,EACjB,YAAK,GAAa,KAClB,WAAK,+BAA4B,0BAC5B,mCAA0B,wBAC1B,gBAAe,aAAK,KAAa,aACjC,YAAc,KAAK,YAAY,KAAK,WACpC,gBAAe,aAAK,KAAa,aACjC,gBAAgB,cAAK,KAAc,cACnC,MAAQA,IACb,MAAK,MAAU,GAAImJ,IACX,iBAAiB,gBAAc,EAAK,gBACxC,cAEI,iBAAiB,gBAAa,CAAK,gBACvC,aAEI,iBAAiB,gBAAiB,WAAW,KAC7C,gBAAiB,gBAAa,CAAK,YAAY,IAE3D,eAAiB5K,gBACK,SAAM,mCAEZ,CACJ,QAAY,OACZ,OAAQ0b,CAAK,OAChB,CACD,MAAO1b,EACD,CACE,MACA,EAAGA,KAEL,IACtB,CACS,CACD,eAAiB,CACb,aACG,UAAc,gBACR,QAAmB,aAAe,QAAqB,KAAK,KACrE,GAAMkK,EAAM,MAAK,QAAM,aACnB,iBAAiB,gBAAa,CAAK,qCACnC,IAAiB,gBAAgB,kCACxB,MAAK,QACd,KAAQV,CAAG,OACX,OAAM,GAAK,iBAAiBoS,gBAA+B,GAC3D,OAAQ,MACR,SAAa,cAGrB,kCACiB,QAAK,QACd,KAAQpS,CAAG,OACX,OAAM,GAAK,iBAAiBoS,gBAA+B,GAC3D,OAAQ,MACR,SAAa,cAGrB,gCACqB,SAAM,aACnB,oCAAiC,CAAK,qCACtC,uBAAoC,kCAC3B,MAAK,QACd,KAAW,MACX,OAAM,GAAK,iBAAiBA,gBAA+B,GAC3D,OAAQ,MACR,SAAa,cAGrB,WAAcpS,EAAI,CACdA,aAAG,IAAc,EACjB,cAAiB,UAAc,gBACb,KAAM,sCACX,OAAK,QACd,KAAQA,CAAG,OACX,OAAM,GAAK,iBAAiBqS,gBAEDH,CAAK,KACxB,EAAGG,OAAM,GAAUH,IAAK,CAC3B,EACC,SACN,MAAQ,MACR,UAAa,cAEjB,EAAK,WAAaG,CACrB,IACD,WAAarS,CAAI,CACb,aAAiB,WAAc,gBACb,KAAM,sCACX,OAAK,QACd,KAAQA,CAAG,OACX,OAAM,GAAK,iBAAiBqS,gBAEDH,CAAK,KACxB,EAAGG,OAAM,GAAUH,IAAK,CAC3B,EACC,SACN,MAAQ,MACR,UAAa,cAEjB,EAAK,WAAaG,CACrB,IACD,WAAgB,CACZ,aACMA,EAAS3T,EAAKsB,GAAG,aAAc,gBAAa,CAAQtB,IAAO,OAASA,IAAK,GAAK,WAC9EwT,KAAO,WAAW,mCACX,OAAK,QACd,KAAW,MACX,OAAM,GAAK,iBAAiBG,gBAEDH,CAAK,KACxB,EAAGG,OAAM,GAAUH,IAAK,CAC3B,EACC,SACN,MAAQ,MACR,UAAa,cAKzB,WAAyBI,EAAQC,EAAMC,QACnC,GAAM,GAAK/U,EAAQ6U,IAAWC,EAAOD,KACrC,KAAOE,EAAS,GAAKC,EAAOD,EAC/B,CACD,SAASE,GAAiBjV,EAAO,CAG7B,UAFa,IAAOA,EAAM,QAAQ,MAChB,UAAW,CAAC,EAClB,QAAQ,MAAO,EAAE,QAChC,CACD,SAASkV,OAA2B9b,CAAK,QAC9B,KAAK,IAAI,OAAK,KAAc,IACtC,CACD,SAAS+b,GAAUnV,EAAO5G,EAAK,CAC3B,QAAS4G,CAAQ5G,EAAOA,GAAOA,CAClC,CAED,OAAMgc,EAAcnT,EAAU,KAAK,MACnC,GAAMoT,CAAe,CACjB,aAAYpS,CAAKjC,EAAQ,CACrB,WAAK,IAAY,MAAK,UAAU,KAAK,UAChC,UAAgB,MACrB,OAAK,QAAO,KAAQ,OAAG,QAAU,CAAK,UAAS,CAC/C,KAAK,UAAc,cAAc,gBAC5B,KAAQ,eAAcoU,CAAa,SAAc,IAAW,IAAK,CAAC,GACnEpU,CAAO,eACP,eAAa,cAAcoU,CAAY,SAAkB,aAAa,CAAC,EAE3EpU,cAAiB,iCACjB,KAAMqO,CAAYpM,OAAI,SAAc,gBAC1B,OAAU,EAAImS,GAAY,SAC1B,IAAO,OACjBpU,EAAO,aAAU,aACjB,aAAa,gBACb,YAAK,QACL,aAAK,yBAAyB,uBACzB,UAAYA,EAAO,cACnB,WAAU,eAAW,QAAU,CAAK,iBAAiB,iBAC7C,cAAcoU,CAAa,SACnC,eAAa,aAAcA,CAAY,SAC5C,IAAME,CAAWrS,EAAI,cAAc,gBAC1B,KAAU,EAAImS,GAAY,SACnC,IAAK,MAAQ,gBACb,YAAK,IAAcE,IACnB,YAAsB,YAAgB9O,gBAC5B,QAAU,EAAI4O,GAAY,SACpC,IAAK,UAAY,gBACjB,YAAqB,aAAgB5O,gBAC5B,SAAU,EAAI4O,GAAY,SACzB,YAAYG,CAAQ,EAC9B,aAAK,QAAiBA,CACtB,cAAqB,YAAgB/O,gBAC5B,SAAU,EAAI4O,GAAY,SACzB,YAAYI,CAAQ,EAC9B,aAAK,QAAiBA,CACtB,cAAwB,UAAc,gBAC1B,KAAU,EAAIvT,EAAU,UACpC,IAAK,YAAY,gBACjB,YAAK,QACLjB,CAAO,YAAM,EAAQ,GAAG,aAAU,CAAK,UAAS,CAChD,KAAK,UAAe,MACpB,MAAK,QAET,iCACW,GAAa,KAAM,CACtB,QAAK,OAAQ,cAAU,CAAOoU,SAAY,CAAW,MAAM,GAC3D,KACH,CACD,MAAK,UAAQ,aAAcA,CAAY,SAAW,IAAM,GACxD,KAAMtZ,EAAIyG,EAAG,YAAW,EAAK,WAAW,gBAAe,CACjDkT,cAA4B,EAAI,EAAK,GACrCC,EAAMR,EAAe,CAACO,EAAK,GAAI,CAAE,EACvC,KAAK,gBAAe,eAAe,eAAiBA,CAAMC,IAAG,IAAOD,CAAG,OAAOA,EAAMC,CAAG,KAAM,KAAK5Z,CAAC,QAAQA,CAAC,IAAI,EAAE,KAAK,GAAG,CAAC,EAC3H,KAAK,gBAAe,eAAe,eAAW,KAAW,GAAI,EAC7D,MAAM6Z,EAAY,KAAK,SAAO,EAAI,YAAW,CAC7C,KAAK,gBAAa,aAAwB,YAAW,OACrD,MAAK,eAAa,aAAiB,MAEvC,OAAU,CACN,MAAMA,QAAiB,QAAO,EAAI,YAAW,CAC7C,KAAK,gBAAa,aAAuB,MAAM,OAEnD,eACI,EAAK,SACR,CACJ,CAED,MAAMC,OACF,SAAY3S,CAAKjC,EAAQ,CACrB,WACK,gBAAkB,gBAClB,OAAiB,eAAK,KAAe,eACrC,gBAAkB,gBAAK,KAAgB,gBACvC,gBAAgB,cAAK,KAAc,cACnC,gBAAiB,eAAK,KAAe,eACrC,gBAAiB,eAAK,KAAe,eACrC,gBAAe,aAAK,KAAa,aACjC,UAAYA,EAAO,cACnB,WAAiB,MACtB,OAAK,SAAe,KACpB,MAAK,aAAqBA,aAAO,IAAiB,aAAe,IAASC,IAAK,GAC/E,OAAK,IAAQD,KAAO,KACpB,MAAK,QAAYA,CAAO,cACxB,CAAK,WAAYkD,CAAY,IAAI,UAC5B,EAAO,KAAImR,EAAepS,IAC3B,aAAejC,EAAO,cACtB,gBAAe,SACf,KAAO,UAAK,CACZ,MAAO,KAAK,MACZ,UAAW,MAAK,UACnB,CACD,KAAK,SAAK,YAAa,cAAiB,gBAAe,cACvD,eAAU,WAAa,cAAiB,gBAAgB,eAAe,CACvE,eAAU,WAAa,cAAiB,gBAAc,aACtD,cAA8B,OAAK,GAAK,WAAW,KAChD,YAAW,WAAa,eAC3B6U,eAAc,WAAa,eAC3BA,eAAc,GAAM,QAAK,SAAY,IAEzC,cAAgB7V,gBAEZ,CAAM7G,GAAO8H,GAAK,IAAK,gBAAkB,aAAe,IAAS,OAASA,EAAG,KAAI,SAAU,EACrF7H,IAAO+R,CAAK,SAAK,YAAkB,aAAe,IAAS,OAASA,EAAG,KAAI,SAAU,EAC3F,IAAI,EAAInL,QACR,CAAI7G,KAAQ,WACJ,IAAK,KAAI,CAAGA,CAAG,GAEnBC,MAAQ,OACR,EAAI,KAAK,KAAI,CAAGA,CAAG,GAEhB,CACV,CACD,eAAe,EAAG,cACgB,WACN,gBACC,MAAa,EACjC0O,KAAmB,QACf,KAAM,UAAW,MAAK,cAAgByH,CAAW,eAEhD,SAEd,eAAgBhN,gBACe,GAAK,WAAWiS,KAAuB,CAC9DD,SAGJ,GAAK,MAAM,gBAAY,CAAK,gBAAgB,gBAAW,KAAe,MAClE,SAAW,CACX,aAGR,WAAchS,EAAI,CACD6R,aAAmB,MAAWI,KAAuB,UAIlE,CAAK,MAAM,gBAAY,CAAK,WAAM,KAC9B,eACA,WAGR,aAAiB,CACb,cAAK,OAAkB,gBAAW,KAClC,MAAK,SAAU,eAEnB,iCAEQ,MAAO,SAEX,OAAgB,KAAM,MAAS,KAAO,MAAQ,EAC9C,QAAO,MAAK,cAAgB,gBAAK,KAAkBrY,gBAAgB,CAAI,gBAAgB,CAC1F,CACD,eAAeoG,EAAI,cACA,sCACL,GAGV,KAAK,SAAM,aACP,YACA,aAEJ,EAAK,UAAU,gBAAgB,SAAM,KAAW,MAAK,cACxD,CACD,eAAiB,CACb,aAAe,sCACL,GAGV,KAAK,SAAM,aACP,YACA,aAEJ,EAAK,UAAU,gBAIvB,SAAoBN,KAAU,EAAK,MACnC,GAAM6T,CAAW,CACb,aAAY7S,CAAKjC,EAAQ,CACrB,WAAK,IAAY,MAAK,UAAU,KAAK,UAChC,UAAgB,MACrB,OAAK,QAAO,KAAQ,OAAG,QAAU,CAAK,UAAS,CAC/C,KAAK,UAAc,cAAc,gBAC5B,KAAQ,eAAc+U,CAAa,SACjC,OAAU,kCACjB,KAAMC,CAAY/S,OAAI,SAAc,gBAC1B,KAAU,EAAI8S,GAAY,SAC7B,SAAU,gBACjB,aAAa,gBACb,YAAK,QACL,aAAqB,UAAc,gBAC1B,KAAU,EAAIA,GAAY,SACnC,IAAK,cAAa,aAClB,YAAK,IAAcT,IACZ,YAAM,EAAQ,GAAG,aAAU,CAAK,UAAS,CAChD,KAAK,UAAe,MACpB,MAAK,QAET,aACI,EAAMjN,QAA4B,GAAK,MAAM,UAAU,MAAK,SAAW,YAAa,KAAK,SAAO,EAAI,YAAa,IAAG,CAAG,SACvH,KAAK,YAAY,gBAAkB,MAEvC,SAAY,CACR,KAAK,SACR,CACJ,CAED,MAAM4N,OACF,SAAYhT,CAAKjC,EAAQ,CACrB,WAAK,KAAa,KAAK,WAAW,KAAK,WAClC,UAAW,MAAK,SAAS,KAAK,SAC9B,qCAA4B,0BAC5B,gBAAe,aAAK,KAAa,aACjC,UAAYA,EAAO,cACnB,WAAe,KACpB,MAAK,QAAYA,CAAO,cACxB,CAAK,WAAe,KACpB,MAAK,EAAO,MAAI8U,CAAW7S,IACvB,KAAO,KAAK,MACZ,MAAO,KAAK,MACZ,UAAW,MAAK,UACnB,CACD,KAAK,WAAa,KAAIyR,WAAoB,CAAK,YAAY,IAC3D,aAAK,CAAW,gBAAW,QAAa,oCACnC,CAAW,gBAAW,QAAa,oCACnC,CAAW,gBAAiB,QAAK,SAAY,IAClD,aAAU,WAAa,cAAiB,gBAAgB,SAAU,EAClE,KAAK,UAAK,WAAa,cAAiB,gBAAc,OAE1D,oCAII,GAAK,UAAM,YAAoC7T,YAAcA,EAAE,UAAO,EAAK,EAAG,EAAGA,OAAE,MAAO,EAAO,UAAK,CAAM,KAAI,WAAa,KAAK,SAAM,CAAI,YAAW,CAAGiD,GAE9J,qCACS,4BACD,EAAW,KACX,WAGR,UAAavB,EAAI,CACb,aAAK,4BACD,EAAW,KACX,WAGR,QAAWA,EAAI,CACX,aAA2B,GAAK,WAAW2T,KAAyB,CAChE3B,SAGJ,GAAK,MAAM,gBAAY,CAAK,WAAM,KAAWA,CAAM,KAC/C,SACA,aAGR,QAAa,CACIH,GAAc,UAAK,MAAW8B,KAAyB,UAIpE,CAAK,MAAM,gBAAY,CAAK,WAAM,KAC9B,eACA,WAKZ,IAAMC,IAAclU,CAAU,WAC9B,KAAMmU,EAAe,MACjB,QAAYnT,CAAKjC,EAAQ,CACrB,WAAK,EAAUiC,EAAI,cAAc,gBAC5B,KAAQ,eAAckT,CAAa,SAClCE,IAAiB,cAAc,gBAC1B,KAAU,EAAIF,GAAY,SACrC,IAAK,UAAcnV,IAAO,YACf,aAAY,GAAK,YAAY,gBACnC,QAAQ,cACb,YAAqB,WAAc,gBAC1B,KAAU,EAAImV,GAAY,SACnC,IAAK,QAAYnV,EAAO,cACf,WAAY,GAAK,WAAU,MAAO,SACtC,QAAQ,cAIrB,YACI,UAAYiC,CAAKjC,EAAQ,CACrB,WAAaA,EAAO,QACpB,MAAK,QAAYA,CAAO,cACxB,CAAK,WAAW,KAAqBiC,SACjC,IAAUjC,CAAO,cACjB,CAAOA,EAAO,cACd,cACA,QAAW,MAAK,UACnB,CACD,KAAK,SAAS,EAAI4U,KAA0B,CACxC,UAAU5U,CAAO,cACjB,EAAQA,SACR,OAAOA,CAAO,cACd,YAAoB,YACpB,cACA,QAAWA,MAAO,UAEtB,GAAK,SAAWoV,GAAenT,IAC3B,UAAY,KAAK,WAAS,KAC1B,SAAU,KAAK,SAC/B,CAAa,IAEL,OAAI,4BACY,SAEhB,KAAI,aAAiB,CACjB,cAAY,SAIpB,MAASqT,MAAuBtW,CAAO,CACnCF,QAAaE,CAAK,EAGtB,aAA0BA,CAAO,CAC7B,UACA,GAAI,SAAM,KAAQA,EAAK,CACnB,aAAS,UAAS,CAAMqI,EAAE,SAAS,OAAO,CACtC,QAAQ,QAAS,OACjB,SAAS,QAAS,KACpB,EAAErI,CAAK,QAEb,IAAI,MAAOA,MAAU,UACjB,GAAOqI,EAAE,cAAkB,EACtB,SAIb,MAASkO,OACL,SAAc,OAAYvW,IAAU,UAChC,KAAOA,CAGd,CACD,cAA0C,CACtC,UACA,OAAOqI,KAAE,WAAS,EAAO,CACrB,QAAO,OAAS,OAChB,SAAO,OAAS,MAChB,SAAQ,OAAS,MAC7B,CAAS,SAAS,CACb,MACD,IAASmO,OACL,SAAU,OAAQ3S,EAAO,CACrB,aAEJ,EAAM4S,EAAQ,MACd,WAAO,SAAc,OAAShX,KAC1BgX,CAAM,UAAO,CAAMhX,EAAM,QAAeA,CAAI,CAAC,IAChD,CACMgX,CACV,CACD,SAASC,GAAqB7S,EAAS,CACnC,UAAuB,GAEjB,IADA,MAAI8S,CAAeH,GAA+B3S,CAAQ,CAAC,IAGrE,OAAS+S,GAASzS,EAAY,CAC1B,UAAuB0S,GAAe1S,EAAY2S,EAAc,KAAI,EACpE,OAAKlJ,GAGEA,CAAE,KAFE,OAIf,SAASmJ,CAAyB5S,IAAsB,CACpD,QAAWA,GAAc0S,GAAe1S,EAAY2S,MACpD,KAAItI,GACOyG,EAAiBzG,GAAG,QAExB,EAAK,IAAIyG,MAA4B,CAAC,CAChD,IACD,OAAS+B,EAAY7S,EAAY,CAC7B,UAAayS,CAASzS,EAAU,CAChC,SAAOoQ,CAA0C,EAErD,eAA8C3Q,CAAU,EACpD,GAAI3C,EACJ,MAAMuN,MAAmBqI,EAAe1S,EAAY2S,EAAc,EAC5DG,EAAO,KAAK,MAAKhW,CAA6CuN,GAAG,WAAU,KAAQvN,EAAO,OAASA,EAAK2C,CAAQ,KACtH,IAAOqT,MAAa,GAAM,KAAK,MAAI,CAAI,KAAK,QAAM,IAAK,QAAW,CAAI,KAG1E,KAAMC,MAAwB,GAAK,EACnC,QAAmB,CACf,YAAYjU,KACR,eAAK,KAAiB,KAAK,eAAe,KAAK,eAC1C,KAAUA,CAAI,kBAAc,CAAK,EACtC,aAAa,YAAU,QACvBjC,UAAO,IAAU,kBAAmB,mBAC9B6G,KAAgB,eAAc,KAAO,aACjC,CAAU,MAAIqP,CAAY,GAAG,CAAC,SACnC,OAAQ,WAAYrP,CAAS,OAClC,CAAMwH,WAAgB,SAAc,KAAO,aACjC,CAAU,MAAI6H,CAAY,GAAG,CAAC,SACvB,WACjBrP,EAAU,iBACV,GAAK,aAAewH,EACpBrO,KAAO,aAAU,cAAkB,aACnC,KAAMmW,aAAkB,OAAc,GAAK,EAC3CA,aAAsB,KAAID,CAAY,GAAG,CAAC,SAChC,OAAYC,CAAW,EACjC,MAAMhL,WAAqC,GAAO,MACtC,cACZnL,CAAO,eAAc,EAAG,SAAU,QAAK,WAAc,EACrD,KAAK,cACL,MAAK,OAAO,CACf,CACD,UACI,QAAK,UAAa,QAAU,YAAW,QAE3C,oBACI,eAIR,OACI,YAAYiC,KACR,eAAK,KAAiB,KAAK,eAAe,KAAK,eAC1C,KAAe,KACpB,MAAK,SAAYjC,KAAO,eACnB,EAAO,UACR,MAAO,KAAK,MACZ,UAAW,KAAK,eAEpB,KAAK,UAAK,OAAa,kBAAiB,iBAAe,QAAc,CACxE,CACD,mBACI,gBAA8B,SAC9B,GAAK,eAAiBqO,KAAU,MAIxC,SAAS+H,GAAmBhP,OACxB,EAAMiP,QACKX,GAAqBtO,CAAO,QAAO,CAC9C,OAAIkP,GACAD,EAAY,OAAO,CAEhB,OAAwBA,CAAW,CAC7C,CACD,OAAME,EAAqB,CACvB,IAAI,YACJ,KAAM,SACN,MAAQ,CAACvX,IAAOoI,EAAW,KACnB,QAAOpI,CAAU,UACjB,OAAO,KAGX,OAAMwE,CAASa,OACX,MAFMD,KAEK,MAAS,SAAuB,CAC3D,CAAa,SACMZ,OAEC,aACA,gBAIZ,SACI,QAAmBiL,SACnB,QAAsB2H,GAAmB9O,GAAK,WAC9C,GAASkP,GAAUlB,EACtB,OACD,QAAahO,CAAS,CAClB,MAAMrF,UAAW,GACXjD,EAAQsI,KAAK,GACbsF,EAAItF,QAAK,KACTgP,KAAUT,GAAejJ,EAAG+I,UAClC,CAAIW,EACO,KAAIG,EAAexU,GACtB,QAAO,EAAIoB,IACP,OAASiT,KAAG,IAAO,WAAM,SAE7B,MAAOtX,CACP,UAAWsI,EAAK,SACpC,SAEuBoP,CAAmBzU,EAAK,SAE/B,UAAWqF,EAAK,SAChC,SAIwBrG,CAAU,WAC9B,EAAM0V,EAAU,CACZ,YAAY1U,KACR,eAAmB,kBAAc,CAAK,EACtC,aAAa,YAAU,QACvBjC,UAAO,CAAS,oBAAkB,kBAA0B,KAAW,QAAU,CAAC,EAClFgF,KAAoB,YAAU,QAAajD,QAAsB,WAAqB,QAAW,QACjG,QAAiBE,EAAI,eAAc,IAAK,cACrB,KAAI2U,EAAY,GAAG,SACjC,OAAQ,YAAYpC,OACzB,YAAuB,SAAc,IAAK,cACrB,KAAIoC,EAAY,GAAG,SAC/B,QAAYC,CAAU,EAC/B,KAAK,cAAgBA,KACrB,cAAqB,QAAc,IAAK,cAC/B,KAAU,EAAID,GAAY,GAAG,SAC7B,QAAYE,CAAQ,EAC7B,KAAK,YAAcA,EACf9W,KAAO,YAAiB,iBAClB+W,CAAa9U,EAAI,eAAc,IAAK,cACrB,KAAI2U,EAAY,GAAG,SACnC,OAAQ,YAAYG,OACzB,CAAK,cAAgBA,CACxB,kBAEQ,OAAgB,KAGhC,CAED,aAAqBnJ,CAAGoJ,IAAM,CAC1B,SAAW9C,CAAetG,EAAI,IAAK,EAAG,CAAC,MACboJ,EAAI,IAAK,IAAI,CACjCC,EAAK/C,EAAejK,EAAI,IAAK,IAAI,CACjCiN,EAAO,KAAK,IAAIC,GAAIC,CAAIH,CAAE,EAC1BI,EAAO,MAAK,IAAIF,CAAIC,EAAIH,CAAE,EAC1BrK,EAAIsK,EAAOG,IACjB,IAAQ,EACJhL,EAAI,EACR,MAAMiL,KAAYJ,GAAQ,EAC1B,SAAItK,EAAM,IACNP,EAAIO,GAAK,MAAI,CAAK,IAAIsK,EAAOG,EAAO,CAAC,GACjCF,OACA9O,IAAU4O,GAAMrK,EAEXwK,IAAOF,EACZ7O,EAAI,GAAK4O,EAAKE,GAAMvK,EAGpBvE,EAAI,GAAK8O,EAAKC,GAAMxK,EAExBvE,EAAIA,EAAI,GAAKA,EAAI,EAAI,EAAI,IAEtB,CAACA,EAAI,IAAKgE,EAAI,IAAKiL,EAAI,GAAG,CACpC,CACD,SAASC,GAAYlP,EAAGgE,IAAM,CAC1B,SAAahE,GAAI,GAAO,KAAO,KACzBmP,CAAKtD,EAAe7H,EAAI,IAAK,IAAI,CACjCoL,IAAoBH,EAAI,IAAK,IAAI,CACjC1K,GAAK,EAAI,KAAK,IAAI,EAAI6K,EAAK,CAAC,GAAKD,EACjC1c,KAAS,IAAI,GAAK,IAAM4c,EAAK,GAAM,EAAK,CAAC,GACzCrI,IAASzC,IACf,KAAIuK,CAAIC,EAAIH,EACZ,OAAIS,GAAM,GAAKA,EAAK,GAChB,CAACP,OAAc,CAACvK,EAAG9R,EAAG,CAAC,EAElB4c,GAAM,IAAMA,EAAK,IACtB,CAACP,EAAIC,EAAIH,CAAE,EAAI,CAACnc,GAAG8R,CAAG,CAAC,EAElB8K,GAAM,KAAOA,EAAK,IACvB,CAACP,EAAIC,EAAIH,CAAE,EAAI,CAAC,GAAGrK,CAAG9R,CAAC,EAElB4c,GAAM,KAAOA,EAAK,IACvB,CAACP,EAAIC,EAAIH,CAAE,EAAI,CAAC,GAAGnc,CAAG8R,CAAC,EAElB8K,GAAM,KAAOA,EAAK,IACvB,CAACP,EAAIC,EAAIH,CAAE,EAAI,CAACnc,GAAG,CAAG8R,CAAC,EAGvB,GAAKwK,EAAIH,CAAE,EAAI,CAACrK,EAAG,EAAG9R,CAAC,EAEpB,EAAEqc,EAAK9H,GAAK,KAAM+H,EAAK/H,GAAK,KAAM4H,EAAK5H,GAAK,GAAG,CACzD,CACD,SAASsI,GAAY/J,EAAGoJ,IAAM,CAC1B,SAAW9C,CAAetG,EAAI,IAAK,EAAG,CAAC,MACboJ,EAAI,IAAK,IAAI,CACjCC,EAAK/C,EAAejK,EAAI,IAAK,IAAI,CACjCiN,EAAO,KAAK,IAAIC,GAAIC,CAAIH,CAAE,EAC1BI,EAAO,MAAK,IAAIF,CAAIC,EAAIH,CAAE,EAC1BpX,EAAIqX,EAAOG,IACjB,IACIxX,IAAM,EACNwI,EAAI,EAEC6O,IAASC,GACd9O,CAAI,MAAU+O,EAAKH,GAAMpX,EAAK,EAAK,GAAK,IAEnCqX,GAASE,EACd/O,EAAI,KAAO4O,EAAKE,GAAMtX,EAAI,GAG1BwI,EAAI,KAAO8O,EAAKC,GAAMvX,EAAI,GAE9B,OAAMwM,CAAI6K,IAAS,EAAI,EAAIrX,EAAIqX,EACzB9d,KACN,KAAO,CAACiP,EAAGgE,EAAI,IAAKjT,EAAI,GAAG,MAE/B,KAASwe,GAAYvP,EAAGgE,IAAM,CAC1B,SAAW8H,GAAU9L,CAAG,GAAG,EACrBmP,EAAKtD,KAAmB,GAAK,EAAG,CAAC,EACjC2D,GAAK3D,CAAe9a,EAAI,IAAK,IAAI,CACjCwT,EAAIiL,EAAKL,EACT1c,EAAI8R,GAAK,GAAI,IAAK,IAAM8K,EAAK,GAAM,EAAK,CAAC,GACzCrI,IAASzC,IACf,EAAIuK,GAAIC,CAAIH,EACZ,OAAIS,GAAM,GAAKA,EAAK,GAChB,CAACP,OAAc,CAACvK,EAAG9R,EAAG,CAAC,EAElB4c,GAAM,IAAMA,EAAK,IACtB,CAACP,EAAIC,EAAIH,CAAE,EAAI,CAACnc,GAAG8R,CAAG,CAAC,EAElB8K,GAAM,KAAOA,EAAK,IACvB,CAACP,EAAIC,EAAIH,CAAE,EAAI,CAAC,GAAGrK,CAAG9R,CAAC,EAElB4c,GAAM,KAAOA,EAAK,IACvB,CAACP,EAAIC,EAAIH,CAAE,EAAI,CAAC,GAAGnc,CAAG8R,CAAC,EAElB8K,GAAM,KAAOA,EAAK,IACvB,CAACP,EAAIC,EAAIH,CAAE,EAAI,CAACnc,GAAG,CAAG8R,CAAC,EAGvB,GAAKwK,EAAIH,CAAE,EAAI,CAACrK,EAAG,EAAG9R,CAAC,EAEpB,EAAEqc,EAAK9H,GAAK,KAAM+H,EAAK/H,GAAK,KAAM4H,EAAK5H,GAAK,GAAG,CACzD,CACD,SAASyI,GAAYzP,EAAGgE,IAAM,CAC1B,SAAWiL,CAAKjL,GAAK,IAAM,QAAK,CAAI,EAAIiL,EAAI,GAAG,GAAO,KACtD,KAAO,CACHjP,EACA0P,IAAO,EAAK1L,IAAK,OAAM,CAAK,IAAI,EAAIiL,EAAI,GAAG,GAAMS,KACjDT,CAAKjL,GAAK,IAAM,KAAK,IAAI,EAAIiL,EAAI,GAAG,IAAO,IAAI,IAGvD,SAASU,GAAY3P,EAAGgE,GAAGjT,CAAG,CAC1B,SAAW,GAAM,KAAK,QAAU,GAAMiT,GAAM,KAAM,IAClD,OAAQhE,EAAG0P,KAAO,CAAK1L,GAAIjT,CAAK2e,OAAc,IAAM1L,IAAO,EAAI,IAAI,CACtE,CACD,SAAS4L,GAAqBC,EAAO,GACjC,WAAkBA,CAAM,EAAC,CAAGA,EAAM,CAAC,MAEvC,MAASC,GAAqBD,EAAOE,EAAO,CACxC,WAAe,CAAGF,EAAM,CAAC,EAAGA,EAAM,CAAC,MAEvC,KAAMG,GAAqB,CACvB,IAAK,CACD,IAAK,CAAChQ,KAAMiP,GAAM,CAACjP,IAAMiP,CAAC,IAC1B,EAAKQ,GACL,IAAKP,EACR,EACD,IAAK,CACD,IAAKS,GACL,IAAK,EAAC3P,CAAGgE,IAAGjT,EAAM,GAAIiT,GAAI,IAC1B,EAAKuL,EACR,EACD,IAAK,CACD,IAAKU,GACL,IAAKX,GACL,IAAK,CAAC/J,IAAM3D,IAAM,GAAI+M,GAAI,CAC7B,GAEL,SAASuB,GAAsBC,EAAMC,EAAM,CACvC,WACa,QAAU,OAAa,KAAQ,MAAM,EAC9CA,IAAS,QAAU,GAAID,IAAS,KAAQ,MAAM,EAC9CC,IAAS,QAAU,GAAID,IAAS,KAAQ,MAAM,CAC1D,CACK,CACD,SAASE,KAAkBtgB,IACvB,UAAeA,GAAMA,CAAM+b,GAAUwE,EAAKvgB,MAE9C,MAASwgB,GAAyBC,EAAYL,EAAMC,EAAM,CACtD,SACA,GAAMK,EAAKP,GAAsBC,EAAMC,CAAI,GAC3C,QACID,EAAS,MACHtE,EAAe2E,OAAkBC,EAAG,CAAC,CAAC,EACtCJ,GAAaG,EAAW,CAAC,EAAGC,EAAG,CAAC,CAAC,EACvC5E,EAAe2E,EAAW,CAAC,GAAG,CAAGC,EAAG,CAAC,CAAC,EACtC5E,EAAe2E,EAAW,CAAC,EAAG,EAAGC,EAAG,CAAC,CAAC,EACtC5E,GAAgBjU,EAAK4Y,EAAW,CAAC,KAAO,MAAQ5Y,IAAO,OAASA,EAAK,KAAO,CACxF,CACK,CACD,SAAS8Y,GAAiBb,EAAOM,EAAMQ,EAAMC,EAAI,QACvCC,CAAMX,GAAsBC,EAAMQ,CAAI,EACtCG,EAAMZ,OAA8B,CAC1C,OAAOL,EAAM,KAAKtL,EAAGrN,IAAWqN,MAAa,CAAKuM,EAAI5Z,GACzD,CACD,SAAS6Z,GAAaP,EAAYG,EAAMC,EAAI,CACxC,SAAiBF,GAAiBF,CAAYG,EAAK,KAAMA,KAAK,EAAM,KAAK,EACnExV,KAA4BwV,EAAK,KAAI,CAAEC,IAAG,EAAI,EAAE,GAAGI,CAAQ,EACjE,OAAON,KAAyBE,EAAG,KAAM,OAAOA,CAAG,IAAI,CAC1D,CAED,UAASK,EAAoBlZ,EAAKR,IAC9B,UAAI,GAAOQ,GAAQ,UAAY0G,MACpB,EAEJlH,SAAc,MAAOQ,EAAIR,CAAG,GAAM,aAE7C,EAAM2Z,CAAM,CACR,UAAO,OAAa,SAChB,MAAO,CAAIA,EAAM,CAAC,GAAG,CAAG,CAAC,OAAG,CAAOd,GAEvC,OAAO,WAAWrY,EAAKqY,MAAO,WACZ,MAAOrY,GAAOA,EAAI,MAAUA,EAAI,EAAGA,EAAI,EAAC,CAAI,CAACA,EAAI,EAAGA,EAAI,EAAGA,EAAI,CAAC,EAC9E,OAAO,IAAImZ,EAAMrB,EAAO,WAE5B,KAAO,aAAasB,MAAc,aACvBA,CAAM,iBAEjB,eAAO,UAAsB,CACzB,gBAAoC,EAChCF,QAA4B,GAC5BA,GAAoBlZ,EAAK,GAAG,CACnC,EACD,MAAO,mBAAkBA,CAAK,iBACd,eAAoB,iBAEpC,EAAO,mBACH,cAAY,eACf,CACD,gBAAkBsC,EAAI,CAClB,OAAO,OAAY,KACf,MAAO,IAEX,KAAM+W,IAAY,OACZC,EAAShX,MAAG,GAClB,QAASpG,EAAI,EAAGA,OAAW,IAAQA,IAC/B,GAAImd,EAAOnd,CAAC,SACR,OAAO,EAGf,MAAO,EACV,CACD,iBAAyBmc,CAAO,aACvB,IAAOD,EACZ,KAAK,OACL,KAAK,OAASI,KAAgCJ,EAAMC,CAAI,IAE5D,YAAckB,EAAUlB,EAAO,eACpBN,EAAqBiB,GAAanB,IAAqB,SAAK,CAAM,EAAG,CAAE,KAAM,KAAK,OAAM,GAAM,KAAK,IAAI,KAAM,KAAM0B,CAAsD,KAAK,KAAM,MAAM,GAAG,KAAK,UAC5M,CACD,eAAoB,iBACC,GAAK,cAAc,MAAOlB,aAEpCmB,CAAS,CAAC,GACb,CAAGA,EAAS,CAAC,OACA,EACb,EAAGA,EAAS,CAAC,CAC7B,CACS,CACJ,CAED,MAAMC,GAAc5Y,EAAU,MAAM,EACpC,MAAM6Y,GACF,gBAAyB,CACrB,cAAK,GAAc,OACnB,YAAe7X,CAAI,iBAAc,EAAK,cACjC,CAAQ,WAAU,QAAiB,CACxCjC,SAAO,IAAU,kBAAmB,mBACpC,CAAM+Z,IAAc,eAAc,IAAK,cACrB,KAAIF,EAAY,YAClC,IAAe5X,GAAI,cAAc,IAAK,cACrB,KAAI4X,EAAY,YAC5B,eAAiB7Z,IAAO,eACtB,gBAAiB,eAAe,mBAC/B,QACR,eAAkB,SAAc,IAAK,cACrB,KAAI6Z,EAAY,GAAG,SAC9B,aAAgB7Z,KAAO,cACtB,eAAiB,cAAc,mBAC7B,QACR,IAAK,WAAQ,SAAY+Z,OACzB,YAAoB,SAAc,IAAK,cAC/B,KAAU,EAAIF,GAAY,YAClC,CAAK,WAAY7Z,CAAO,iBAChB,WAAiB,cAAU,KACnC,UAAK,QAAQ,OAAYga,OACd,YACP,GAAK,aACD,kBAAgB,SAAW,EAC3B,WAAa,QAAW,KAE5B,aAAkB,YAAc,IAAK,cACrB,KAAIH,EAAY,GAAG,SAC7BI,IAAa,eAAc,IAAK,cACrB,KAAIJ,EAAY,YAC1B,SAAY,KAAK,cAAY,MAAQ,WACtC,gBACN,eAAmB,SAAc,IAAK,cACrB,KAAIA,EAAY,YAC1B,SAAY,KAAK,cAAY,KAAK,YACnC,aACN,IAAK,WAAQ,SAAYK,OAGjC,CAAI,wCAES,YAAe,mBACf,QAAc,mBACd,QAAU,eACf,kBAAkB,SAAU,SAAa,cACzD,CACY,iBAAS,SACLC,CAAM,KAAK,WAAK,QAAY,MAAQ,WAAS,QAAK,QAAY,KAAK,YAEhEA,CACV,IAGL,aACI,aAAiB,IAAQ,SAAQnb,CAAU,QAAU,QAAU,UAEnE,QAASob,CAAsBhT,KAC3B,WACA,IAAO/C,EAAY+C,MACf,GAAOC,EAAE,SAAS,QAClB,WAAS,QAAS,MACd,WAAS,OAAS,OAClB,WAAQ,QAAS,KAAOgT,CAAc,CACtD,CAAa,QACD,OAAY,OAAS,QACrB,WAAU,QAAS,OAAO9E,CAAiB,CACvD,CAAS,QAEL,OAA6B+E,CAAU,EACnC,YACH,CACD,YAA0BlT,EAAQ,CAC9B,IAAInH,SACIA,GAAKmH,CAAO,SAAW,MAAQnH,IAAO,OAAS,OAASA,EAAG,IACtE,IAED,OAASsa,EAAwBC,EAAIC,KACjC,SAAW,MAAUA,EAAG,OACpBD,EAAG,OAASC,EAAG,OACfD,CAAG,WAAaC,KAAG,YAChB,IAASA,SAEpB,QAASC,EAA2Bjc,EAAMkc,KACtC,SAAe,KAAM,SAAS,EAC9B,QAGO,IAAK,IAHPtL,EAGW,aAAa,CAAC,GAAK,aAFf,IAAW5Q,CAAI,EAEiBkc,CAAQ,EAEhE,aACI,CAAM3hB,GAAUA,EAChB,MAAOA,GAAWA,CAAQ,IAAO,IACjC,MAAMA,CAAWA,EAAQ,MAAQ,CAAI,OAAK,EAC1C,OAAOA,CAAUA,EAAQ,KAE7B,SAAS4hB,GAAsBnc,EAAM,CACjC,aAAe,GAAM,iCAAiC,GACtD,KACI,SAAO,SAAWA,CAAI,OAE1B,CAAMzF,UAAQ,GAAWqW,MACnBwL,EAAOxL,WACb,CAAOyL,GAAiBD,CAAI,EAAE7hB,CAAK,CACtC,CACD,UAAS+hB,GAAkCtc,CAAM,CAC7C,aAAe,GAAM,kFAAkF,EACvG,GAAI,CAAC4Q,EACD,OAAO,KAEX,MAAM6I,EAAQ,MACmB,CAAC,IAAG,CAAG,KACT7I,EAAE,CAAC,GAAG,EAAG,EACpCqL,KAA6B,CAAC,GAAG,EAAG,CAChD,EACQ,QAAI,KAAMxC,IAAQ,GAAK,MAAMA,MAAQ,CAAK,MAAMA,MACrC,KAEJA,CACV,CACD,SAAS8C,GAA+BvC,KACpC,WACI,IAAMP,EAAQ6C,OACd,UAAe,EAAIxB,GAAMrB,CAAO,SAAe,MAGvD,SAAS+C,GAAmCxc,EAAM,IAC9C,UAAe,GAAM,2GAA2G,EAChI,GAAI,CAAC4Q,EACD,OAAO,KAEX,MAAM6I,EAAQ,MACmB,CAAC,IAAG,CAAG,KACT7I,EAAE,CAAC,GAAG,EAAG,EACpCqL,KAA6B,CAAC,GAAG,EAAG,EACpCA,KAA6B,CAAC,GAAI,CAC9C,EACQ,OAAI,MAAMxC,EAAM,CAAC,CAAC,GACd,MAAMA,MAAQ,CACd,MAAMA,MAAQ,CACd,MAAMA,MACC,KAEJA,CACV,CACD,SAASgD,GAAgCzC,KACrC,WACI,IAAMP,EAAQ+C,OACd,UAAe,EAAI1B,GAAMrB,CAAO,SAAe,MAGvD,SAASiD,GAAwB1c,EAAM,IACnC,UAAe,GAAM,sGAAsG,EAC3H,GAAI,CAAC4Q,EACD,OAAO,KAEX,MAAM6I,EAAQ,MACc,CAAC,IACzBwC,MAA8B,CAAG,GAAG,EACpCA,GAA2BrL,EAAE,CAAC,GAAG,EAAG,CAChD,EACQ,QAAI,KAAM6I,IAAQ,GAAK,MAAMA,MAAQ,CAAK,MAAMA,MACrC,KAEJA,CACV,CACD,SAASkD,GAAqB3C,KAC1B,WACI,IAAMP,EAAQiD,OACd,UAAe,EAAI5B,GAAMrB,CAAO,SAAe,MAGvD,SAASmD,GAAyB5c,EAAM,IACpC,UAAe,GAAM,+HAA+H,EACpJ,GAAI,CAAC4Q,EACD,OAAO,KAEX,MAAM6I,EAAQ,MACc,CAAC,IACzBwC,MAA8B,CAAG,GAAG,EACpCA,GAA2BrL,EAAE,CAAC,GAAG,EAAG,EACpCqL,KAA6B,CAAC,GAAI,CAC9C,EACQ,OAAI,MAAMxC,EAAM,CAAC,CAAC,GACd,MAAMA,MAAQ,CACd,MAAMA,MAAQ,CACd,MAAMA,MACC,KAEJA,CACV,CACD,SAASoD,GAAsB7C,KAC3B,WACI,IAAMP,EAAQmD,OACd,UAAe,EAAI9B,GAAMrB,CAAO,SAAe,MAGvD,SAASqD,GAA2B9c,EAAM,IACtC,UAAkB,GAAM,6CAA4C,CACpE,GAAI+c,EACA,OACI,UAASA,CAAK,CAAC,OAAa,SAC5B,IAASA,EAAK,CAAC,EAAIA,EAAK,EAAC,CAAG,SAC5B,IAASA,EAAK,CAAC,EAAIA,EAAK,EAAC,CAAG,SAGpC,EAAMC,EAAUhd,EAAK,OAAM,2DAA4D,EACvF,OAAIgd,EACO,CACH,SAASA,OAAc,EACvB,UAASA,CAAQ,CAAC,EAAG,EAAE,EACvB,UAASA,CAAQ,CAAC,EAAG,EAAE,EACvC,CAEe,SAEX,KAASC,GAAiBjd,EAAM,CAC5B,aAA6C,CAC7C,WAAe,EAAI8a,GAAMrB,CAAO,SAAO,EAAK,IAAI,EACnD,CACD,SAASyD,GAA4Bld,EAAM,CACvC,aAAkB,GAAM,2DAA0D,CAClF,GAAI+c,EACA,OACI,UAASA,CAAK,CAAC,OAAa,SAC5B,IAASA,EAAK,CAAC,EAAIA,EAAK,EAAC,CAAG,SAC5B,IAASA,EAAK,CAAC,EAAIA,EAAK,EAAC,CAAG,SACnB,MAASA,EAAK,CAAC,EAAIA,EAAK,CAAC,EAAG,SAAQ,CAAK,EAAG,CAAC,CACtE,EAEQ,MAAMC,EAAUhd,EAAK,MAAM,6EAA6E,EACxG,OAAIgd,EACO,CACH,SAASA,OAAc,EACvB,UAASA,CAAQ,CAAC,EAAG,EAAE,EACvB,UAASA,CAAQ,CAAC,EAAG,EAAE,EACvBG,EAAS,SAASH,EAAQ,CAAC,EAAG,EAAE,EAAG,EAAG,QACtD,EAEe,IACV,EACD,QAASI,GAAkBpd,EAAM,CAC7B,aAA8C,CAC9C,WAAe,EAAI8a,GAAMrB,CAAO,SAAO,EAAK,IAAI,EACnD,CACD,SAAS4D,GAA8Brd,EAAM,CACzC,aAAe,GAAM,uGAAuG,EAC5H,GAAI,CAAC4Q,EACD,OAAO,KAEX,MAAM6I,EAAQ,MACV,MAAW7I,KAAI,CACf,aAAa,CAAC,CAAC,EACf,aAAa,CAAC,CAAC,CAC3B,EACQ,YAAI,CAAM6I,EAAM,CAAC,CAAC,GAAK,MAAMA,MAAQ,CAAK,MAAMA,MACrC,KAEJA,CACV,CACD,SAAS6D,GAA2BtD,KAChC,WACI,IAAMP,EAAQ4D,OACd,UAAe,EAAIvC,GAAMrB,CAAO,SAAe,MAGvD,SAAS8D,GAA+Bvd,EAAM,IAC1C,UAAe,GAAM,uIAAuI,EAC5J,GAAI,CAAC4Q,EACD,OAAO,KAEX,MAAM6I,EAAQ,MACV,MAAW7I,KAAI,CACf,aAAa,CAAC,CAAC,EACf,aAAa,CAAC,CAAC,EACf,aAAa,CAAC,CAAC,CAC3B,EACQ,YAAI,CAAM6I,EAAM,CAAC,CAAC,GACd,MAAMA,MAAQ,CACd,MAAMA,MAAQ,CACd,MAAMA,MACC,KAEJA,CACV,CACD,SAAS+D,GAA4BxD,KACjC,WACI,IAAMP,EAAQ8D,OACd,UAAe,EAAIzC,GAAMrB,CAAO,SAAe,MAGvD,MAAMgE,GAAoB,CACtB,CACI,OAAQX,OACR,GAAQ,CACJ,QAAO,CACP,SAAM,EACN,SAAU,KACb,CACJ,GAEG,UACA,OAAQ,CACJ,QAAO,CACP,SAAM,EACN,SAAU,KACb,CACJ,GAEG,UACA,OAAQ,CACJ,QAAO,CACP,SAAM,EACN,SAAU,MACb,GAEL,CACI,SAAQN,CACR,OAAQ,CACJ,QAAO,CACP,SAAM,EACN,SAAU,MACb,GAEL,CACI,SAAQE,CACR,OAAQ,CACJ,QAAO,CACP,SAAM,EACN,SAAU,MACb,GAEL,CACI,SAAQE,CACR,OAAQ,CACJ,QAAO,CACP,SAAM,EACN,SAAU,MACb,GAEL,CACI,SAAQS,CACR,OAAQ,CACJ,QAAO,CACP,SAAM,EACN,SAAU,SAEjB,EACD,QACYE,QACR,EAAQ,CACJ,QAAO,CACP,SAAM,EACN,SAAU,SAEjB,CACT,SACI,EAASG,MACL,aAAyB,IAAO,CAACC,EAAM,MAAE,GAAA1Y,CAAQ,OAAQ2Y,UAI9C3Y,CAAOjF,CAAI,OAAgB,GACnC,IAAI,CACV,CACD,YAAiCA,EAAMga,IAAO,UAC1C,CAAM7K,EAAIuO,GAAkB1d,CAAI,EAChC,WAGM,eAAa,GAASga,UAAS,EAC1B,OAAO,WAAO,QAAO,OAAY,CAAG,MAAQ,OAAO,CAE1D7K,EAAE,WAAa,OACR,UAAO,IAAO,YAAO,OAAY,CAAG,MAAQ6K,CAAI,MAEpD,EARI,IASd,CACD,MAAM6D,GAAkB,CACpB,IAAK,CACDZ,IACAG,MAC+B,IAAK,IACpCX,CAAgC,MAAK,CACrCE,GAAqB,KAAK,EAC1BE,GAAsB,KAAK,EAC3BS,GAA2B,KAAK,EAChCE,GAA4B,KAAK,CACpC,GACD,KAAO,CACHjB,IAA+B,MAAO,EACtCE,MAAgC,IAAO,EACvCE,KAAqB,KAAO,EAC5BE,KAAsB,KAAO,EAC7BS,KAA2B,KAAO,EAClCE,KAA4B,KAAO,CACtC,CACT,KACI,MAASM,MACL,aAAoC,CACpC,WACI,GAAI,YAAiB,UACjB,IAAOhD,OAAM,CAAMd,CAAI,EAE3B,MAAMjV,EAAS0L,EAAQ,OAAO,CAACkN,EAAM1Y,IAC7B0Y,GAGG1Y,EAAO1E,CAAK,EACpB,KAAI,CACP,SAAOwE,CAAgD+V,EAAM,SAEpE,CACD,WAASiD,CAAwB/D,EAAM,EACnC,UAAgCA,CAAI,EACpC,SAAQzZ,CACGkQ,EAAQ,OAAO,CAACkN,EAAM1Y,OAIlBA,EAAO1E,QAGzB,CACD,WAASyd,CAASC,EAAM,CACpB,MAAMC,KAAqB,IAAK,MAAMD,CAAI,QAAS,CAAE,UAAS,CAAE,EAChE,OAAOC,EAAI,SAAW,EAAI,SAC7B,CACD,SAASC,GAAoB5d,KAAgB,GAAK,EAC9C,gBAAyC,YAAc,GAAK,CAAC,KACxD,CAAIyd,EAAQ,EACZ,MAAK,CAAE,EACZ,MAAO,UACV,CACD,SAASI,GAAqB7d,KAAgB,GAAK,CAC/C,cAAwB,UAAc,KAAK,EACrC8d,EAAQ,CAACC,EAAU,CAAC,EAAGA,EAAU,CAAC,EAAGA,IAAW,CAAGA,IAAW,CAAI,GAAG,KACtE,CAAIN,EAAQ,EACZ,MAAK,CAAE,EACZ,MAAO,UACV,CACD,aAAoCzd,CAAOge,EAAU,CACjD,MAAMrI,KAAkCqI,GAAa,UAAc,CAAC,GAEpE,KAAO,gBADkC,UAAc,MAAOA,CAAQ,CAAC,EAAE,IAAKN,IAAS/H,CAAU+H,CAAI,CAAC,EAClF,KAAK,QAC5B,CACD,YAA2CjE,EAAM,CAC7C,OAAQzZ,UAGX,CACD,aAAqCA,CAAOge,EAAU,CAClD,MAAMC,EAAatK,EAAsB,CAAC,EACpCuK,KAAqCF,GAAa,UAAc,CAAC,IAKvE,IAAO,cAJa,UAAc,MAAOA,CAAQ,EAAE,IAAI,CAACN,EAAMnd,KACxCA,IAAU,EAAI0d,IAAaC,CAC5BR,CAAI,CACxB,EACoB,KAAK,QAC7B,CACD,YAA4CjE,EAAM,CAC9C,OAAQzZ,UAGX,CACD,WAASme,CAA2Bne,EAAO,CACvC,OAAMoe,CAAa,EACfzK,CAAsB,CAAC,MAEvBC,CACZ,GAEQ,KAAO,gBADkC,YAAc,GAAK,CAAC,EAAE,IAAI,CAAC8J,EAAMnd,IAAU6d,IAAgB,CAAEV,CAAI,CAAC,EACvF,KAAK,QAC5B,CACD,WAASW,CAA4Bre,EAAO,CACxC,OAAMoe,CAAa,EACfzK,CAAsB,CAAC,EACvBC,GACAA,MACuB,CACnC,IAIQ,IAAO,cAFF,WAAc,IAAK,EACnB,IAAI,CAAC8J,EAAMnd,IAAU6d,IAAgB,CAAEV,CAAI,CAAC,EAC5B,KAAK,QAC7B,CACD,aAAgC1d,CAAOyZ,EAAM,CACzC,MAAM9D,KAAkC8D,GAAS,QAAU,EAAI,CAAC,EAC1D6E,EAAQ,CAAC,IAAK,MAAK,CAAG,EAE5B,MAAO,aADkC,UAAc,MAAO7E,CAAI,CAAC,EAAE,IAAI,CAACiE,EAAMnd,IAAU,GAAG+d,EAAM/d,CAAK,CAAC,QAAmB,CAAC,EAAE,EAC9G,KAAK,QACzB,CACD,YAAuCkZ,EAAM,CACzC,OAAQzZ,UACX,CACD,aAAiCA,CAAOyZ,EAAM,CAC1C,MAAMwE,EAAatK,EAAsB,CAAC,EACpCuK,KAAqCzE,GAAS,QAAU,EAAI,CAAC,EAC7D6E,EAAQ,CAAC,IAAK,IAAK,MAAK,CAAG,EAKjC,gBAJoB,UAAc,MAAO7E,CAAI,EAAE,QAAWlZ,GAAU,CAChE,MAAMoV,EAAYpV,OAAc0d,CAAaC,EAC7C,MAAO,GAAGI,EAAM/d,CAAK,CAAC,KAAKoV,IAAe,EACtD,CAAS,EACgB,KAAK,QACzB,CACD,YAAwC8D,EAAM,CAC1C,OAAQzZ,OAAkCA,CAAOyZ,EACpD,CACD,QAAM8E,CAA0B,CAC5B,KACI,GAAQ,CACJ,MAAO,GACP,UAAM,CACN,UAAU,KACV,cAEJ,YACH,EACD,KACI,GAAQ,CACJ,MAAO,GACP,UAAM,CACN,UAAU,KACV,cAEJ,YACH,EACD,KACI,GAAQ,CACJ,MAAO,GACP,UAAM,CACN,WAAU,KACV,cAEJ,YACH,EACD,KACI,GAAQ,CACJ,MAAO,GACP,UAAM,CACN,WAAU,KACV,cAEJ,UAAaF,GAChB,CACD,OAAI,GAAO,OAAO,EAAE,OAAO,CAACjB,EAAM3D,QAEvB2D,EACH,KACI,GAAQ,CACJ,MAAO,GACP,UAAM,CACN,WAAU,eAGd,eACH,EACD,KACI,GAAQ,CACJ,MAAO,GACP,UAAM,CACN,WAAU,eAGd,eACH,EACD,KACI,GAAQ,CACJ,MAAO,GACP,UAAM,CACN,SAAU,mBAGd,eACH,EACD,KACI,GAAQ,CACJ,MAAO,GACP,UAAM,CACN,SAAU,mBAGd,UAAaoB,GAA+B/E,CAAI,QAIpE,CACI,YAA8BgF,GAC1B,OAAOF,GAAwB,OAAO,CAACnB,GAAMsB,GACrCtB,MAGG7B,CAAwBmD,EAAI,cACzB,WACJ,OACP,GACN,CAED,MAAMC,GAAc1c,KAAU,GAAK,CACnC,WACI,UAAYgB,eACH,oBAAsB,UAAe,MAAK,MAC/C,QAAK,KAAe,MACpB,QAAK,GAAM,QAAQ,EAAG,mBAAe,cACrC,EAAK,cAAc,YAAc,QACjC,UAAa,UAAU,YAChB,mBAAU,aAAmB,EAAK,WAClC,aAAU,aAAa,EAAK,OAAO,EAC1C,cAAoB,UAAc,SAC1B,UAAU,IAAI0b,IAAY,QAClC,YAAa,UAAYC,CAAO,EAChC,cAAsB,UAAc,SAC1B,UAAU,IAAID,aAChB,mBACH,UAAaE,EAClB,cAAuB,UAAc,SAC1B,UAAU,IAAIF,IAAY,QACrC,YAAa,oBACR,UAAcG,EACnB,cAAwB,UAAc,SAC1B,UAAU,IAAIH,IAAY,YACjC,YAAY,qBACZ,eACL,EAAK,QAAO,CACf,CACD,SAAU,IACN,MAAU,SAAK,CAAM,iBACD,UAAc,KAAK,EACjCI,EAAY,IAAIxE,EAAM,CAACwD,EAAU,CAAC,EAAGA,EAAU,CAAC,EAAGA,GAAW,EAAG,CAAC,EAAG,KAAK,EAC1EiB,EAAa,IAAIzE,EAAM,CAACwD,EAAU,CAAC,EAAGA,IAAW,CAAGA,EAAU,GAAI,GAAG,EAAG,KAAK,KAE/E,WACAkB,GAA4BF,CAAS,IACrCE,CAA4BD,UAE3B,iBAAiB,iBAAa,YAAmBE,EAAc,QAAQ,CAAC,YACxE,sBAAmB,YAAkBD,CAA4BrR,CAAC,EACvE,MAAMgC,EAAOgN,EAASmB,EAAU,GAAI,EAAG,IAAM,YACxC,WAAY,KAAM,kBAE3B,eACI,EAAK,QAAO,EAEnB,CAED,WACI,UAAY9a,WACH,gBAAkB,UAAW,MAAK,SACvC,CAAK,aAAW,CAAK,SAAS,MAAK,eAC9B,oBAAsB,UAAe,MAAK,eAC1C,oBAAsB,UAAe,MAAK,aAC1C,kBAAoB,UAAa,MAAK,MAC3C,QAAK,KAAe,UACf,YAAmB,UACxB,KAAK,KAAO,MAAIkc,CAAalc,IACzB,MAAO,UACP,eAAgB,kBAEf,YAAa,KAAmB,QAAK,EAAK,eAC1C,WAAW,OAAQ,KAAG,eAAa,iBACnC,WAAW,OAAQ,KAAG,eAAa,iBACnC,WAAW,UAAW,aAAW,WACtC,QAAK,iBAAa,UAAiB,gBAAgB,WACnD,QAAK,iBAAa,aAAiB,SAAS,CAAK,oBAErD,UAAoBpC,EAAGiD,KACnB,CAAI,MAAG,MACH,IAEJ,MAAMsV,EAAQvY,EAAE,OAAM,CAAIA,KAAE,OAAO,MACzB,SAAK,CAAM,SACf,CAACwI,aAAa,YAAc,MAClC,YAAW,UAAY,IAAIkR,EAAM,CAAClR,IAAMjP,EAAGgf,CAAK,EAAG,eAEvD,4BACS,kBACD,UAAW,GACX,eAGR,4BACS,kBACD,UAAW,GACX,aAGR,4BACS,kBACD,UAAW,GACX,WAGR,UAAW7W,EAAI,EACX,KAAMgS,EAAOH,GAAcgL,GAAoB,EAAI,EAAGlJ,GAAsB3T,CAAE,CAAC,EAC/E,MAAIgS,CAAS,KACT,OAEJ,MAAU,SAAK,CAAM,SACf,CAAClL,EAAGgE,aAAa,YAAc,MACrC,YAAW,UAAY,IAAIkN,EAAM,CAAClR,EAAGgE,IAAMzC,EAAI2J,CAAI,UAC/C,UAAW,GACX,SAEP,CACD,SAAShS,EAAI,CACI6R,GAAcgL,GAAoB,EAAI,EAAGlJ,GAAsB3T,IAAG,MAI/E,YAAW,WAAY,SAAK,CAAM,UAC9B,UAAW,GACX,OAChB,CAAa,EAER,CAED,SAAoBN,EAAU,SAAQ,CACtC,WAASod,CAAwBpc,EAAK,CAClC,cAAuB,UAAc,SAAQ,CACvCwT,IACA,OAAM,KAAO,QAAO,EAAO,GAC3B,OAAM,KAAO,QAAO,EAAO,GAC3B,OAAM,KAAO,UAAc,CACzC,EACQ,WAAW,UAAYA,EAAM,WAAc5R,GAAS,CAChD,cAAoB,UAAc,QAAQ,EAC1C,WAAQ,UAAcA,KAAK,EAC3Bya,MAAQ,EAAQza,YACX,+BAEF,YAAyB,GAEnC,CACD,WACI,UAAY5B,QACR,EAAK,cAAc,YAAc,QACjC,UAAa,UAAU,YAChB,mBAAU,aAAmB,EAAK,OAAO,EAChD,cAAqB,UAAc,SAC1B,UAAU,IAAIsc,IAAY,UAC9B,WAAYF,UACZ,UAAU,WAAU,GAAIE,GAAY,WAChC,uBAAiB,aACnB,aAAU,eAAkB,SAAS,EAC5C,cAA2B,UAAc,SAC1B,WAAU,GAAIA,GAAY,WAC1B,eAAsC,iBAC5C,gBACT,YAAa,UAAYC,CAAQ,EACjC,cAAsB,UAAc,SAC1B,UAAU,IAAID,IAAY,QACpC,YAAa,mBACR,kBACA,YAAoB,qBACpB,gBACY,UAAY/F,SACpB,UAAU,sBAGnB,cACA,UAAY,cAEZ,cACA,WAAY,cAEZ,mBACK,uBACA,kBAET,WAAkB,UACW,SAAU,KACnC,QAAY,cAAa,gBACpB,UAAW,QAASpf,GAAM,CAC3B,cAAqB,UAAc,SAC1B,UAAU,IAAImlB,aACd,UAAYnlB,EAAE,eAClB,YAAW,eAG3B,CAED,YAA2Bqf,EAAM,CAC7B,UAA6BA,GAAS,YACzC,CACD,SAASgG,MAAyBhG,CAAMlZ,EAAO,EAC3C,KAAMnH,EAAMmgB,QAAkChZ,CAAK,GACnD,QAAO,EAAImf,IACP,IAAK,SAGZ,CACD,SAASC,OAAuCpf,IAC5C,MAAO,cACH,WAAeA,GAAU,EAAI,MAAQA,IAAU,EAAI,GAAI,UAAQ,CAC/D,aAA8B,CAAK,EACnC,OAAQS,KAAO,aACC,eACZ,YAAsB,YAAc,cACpC,eAAoC,SAAS,CAC7D,CAAa,EACD,YACI,eAAsC,YAAkB,eAE5D,YAAkB,SAC9B,EACK,CACD,WACI,UAAYiC,oBACH,yBAA2B,UAAoB,MAAK,WACpD,YAAoB,aACzB,EAAK,QAAUjC,IAAO,MACtB,QAAK,KAAe,UACf,YAAmB,eACnB,aAAwB,SAAK,CAAM,UAAS,KACjD,KAAK,4BAAY,aACjB,KAAK,KAAO,UACR,eAAgB,UAChB,WAAY,QAAK,KAAQ,KAAM,QAAK,KAAQ,KAAM,QAAK,EAAK,SAC5D,eAAgB,YAEpB,kBAAU,iBAAkB,UAAiB,wBAAe,6BAEhE,UAA4BiC,EAAK,CAC7B,SACI,eAAgB,UAAU,SAC1B,gBAAgB,YAChB,QAAQ,UACR,eAAgB,SAChC,EACkB2c,EAAM,CACRD,GAA0B1c,EAAK4c,EAAI,CAAC,EACpCF,GAA0B1c,EAAK4c,EAAI,CAAC,EACpCF,QAAoC,CACpD,EACY,OAAAC,EAAI,SAASE,EAAIvf,OACbwf,CAAc,IACV,MAAS,UACT,gBAAc,EACd,YACW1X,CAAE,aAAS,eAAmB,UAAU,eAAe,aAAiB,CAEnF,aAAcgF,GAAM,IAChB,UAAwB,UAAU,YACpBhF,CAAE,aAAS,kBAA+B,SAAU,EAClE,aAAegF,CAAE,SACV,IAAIkN,EAAMpB,GAAqBF,GAAqBC,CAAK,KAAU,CAAC,UAAoB,SAAU,mBAMzH,UAAoB3W,EAAI,CACpB,cAAsB,eACjB,UAAU,YAAsB,KACrC,KAAK,4BAAY,UAA4B,QAAK,cAAa,WAC/D,UAAU,WACN,QAAK,KAAQ,KACb,QAAK,KAAQ,KACb,QAAK,EAAK,CAAC,KAAE,CAC7B,EAEK,CAED,MAAMyd,GAAc/d,KAAU,GAAK,CACnC,WACI,UAAYgB,eACH,oBAAsB,UAAe,MAAK,MAC/C,QAAK,KAAe,MACpB,QAAK,GAAM,QAAQ,EAAG,mBAAe,cACrC,EAAK,cAAc,YAAc,QACjC,UAAa,UAAU,YAChB,mBAAU,aAAmB,EAAK,WAClC,aAAU,aAAa,EAAK,OAAO,EAC1C,cAAsB,UAAc,SAC1B,UAAU,IAAI+c,IAAY,QACpC,YAAa,UAAYnB,CAAS,EAClC,cAAuB,UAAc,SAC1B,UAAU,IAAImB,IAAY,QACrC,YAAa,oBACR,eACL,EAAK,QAAO,CACf,CACD,SAAU,IACN,MAAU,SAAK,CAAM,mBACP,YAAc,YACvB,sBAAkB,UAAkBC,GAA2B,IAAI1F,GAAOlR,EAAG,IAAK,GAAG,MAAG,CAAK,CAAC,EACnG,QAAauT,EAASvT,IAAM,MAAQ,YAC/B,WAAY,KAAM,kBAE3B,eACI,EAAK,QAAO,EAEnB,CAED,WACI,UAAYpG,WACH,gBAAkB,UAAW,MAAK,SACvC,CAAK,aAAW,CAAK,SAAS,MAAK,eAC9B,oBAAsB,UAAe,MAAK,eAC1C,oBAAsB,UAAe,MAAK,aAC1C,kBAAoB,UAAa,MAAK,MAC3C,QAAK,KAAe,UACf,YAAmB,UACxB,KAAK,KAAO,MAAIid,CAAajd,IACzB,MAAO,UACP,eAAgB,kBAEf,YAAa,KAAmB,QAAK,EAAK,eAC1C,WAAW,OAAQ,KAAG,eAAa,iBACnC,WAAW,OAAQ,KAAG,eAAa,iBACnC,WAAW,UAAW,aAAW,WACtC,QAAK,iBAAa,UAAiB,gBAAgB,WACnD,QAAK,iBAAa,aAAiB,SAAS,CAAK,oBAErD,UAAoBpC,EAAGiD,KACnB,CAAI,MAAG,MACH,IAEJ,UAAqBoR,EAAerU,EAAE,SAAS,CAAGA,KAAE,IAAO,QAAQ,CAAGA,KAAE,MAAO,IAAO,IAAG,CAAG,KAClF,SAAK,CAAM,SACf,EAAGwM,aAAa,YAAc,MACpC,YAAW,UAAY,IAAIkN,EAAM,CAACZ,IAAQ,EAAG/O,CAAC,EAAG,eAErD,4BACS,kBACD,UAAW,GACX,eAGR,4BACS,kBACD,UAAW,GACX,aAGR,4BACS,kBACD,UAAW,GACX,WAGR,UAAWrI,EAAI,EACX,KAAMgS,EAAOH,GAAcgL,GAAoB,EAAK,EAAGlJ,GAAsB3T,CAAE,CAAC,EAChF,MAAIgS,CAAS,KACT,OAEJ,MAAU,SAAK,CAAM,SACf,CAAClL,EAAGgE,aAAa,YAAc,MACrC,YAAW,UAAY,IAAIkN,EAAM,CAAClR,EAAIkL,IAAS,EAAG3J,CAAC,UAC/C,UAAW,GACX,SAEP,CACD,SAASrI,EAAI,CACI6R,GAAcgL,GAAoB,EAAK,EAAGlJ,GAAsB3T,IAAG,MAIhF,YAAW,WAAY,SAAK,CAAM,UAC9B,UAAW,GACX,OAChB,CAAa,EAER,CAED,MAAM4d,GAAcle,EAAU,SACxBme,CAAe,GACrB,WACI,UAAYnd,eACH,oBAAsB,UAAe,MAAK,MAC/C,QAAK,KAAe,MACpB,QAAK,GAAM,QAAQ,EAAG,mBAAe,cACrC,EAAK,cAAc,YAAc,QACjC,UAAa,UAAU,YAChB,mBAAU,aAAmB,EAAK,WAClC,aAAU,aAAa,EAAK,OAAO,EAC1C,cAAuB,UAAc,SAAQ,CAC7Cod,EAAW,QAASD,GACpBC,CAAW,WACA,UAAU,IAAIF,IAAY,QACrC,YAAa,sBACR,UAAgBE,EACrB,cAAuB,UAAc,SAC1B,UAAU,IAAIF,IAAY,QACrC,YAAa,oBACR,eACL,EAAK,QAAO,CACf,CACD,SAAU,EACN,KAAMG,cAA4B,cAC9B,CAACA,KACD,OAGJ,MADU,SAAK,CAAM,aACF,UAAc,KAAK,aACnB,aAAc,cACb,UAAc,cACd,UAAa,EAAG,EAAGC,IAAa,CAC9CC,GAAOC,CAAQ,KACrB,QAASC,EAAK,IAAQzX,IAAQyX,EAC1B,QAASC,EAAK,EAAGA,KAAYA,GAAM,CAC/B,MAAMtT,GAAIuP,GAAS+D,CAAI,GAAGJ,CAAO,EAAG,GAAG,EACjCnmB,IAAIwiB,CAAS8D,EAAI,GAAGzX,CAAQ,IAAK,CAAC,EAClC2R,GAAWhC,GAAYgI,GAAU,EAAGvT,GAAGjT,EAAC,EACxCkD,IAAKojB,EAAKH,EAAQI,GAAM,EAC9BH,EAAKljB,GAAC,CAAIsd,GAAS,EAAC,CACpB4F,EAAKljB,GAAI,EAAC,CAAIsd,GAAS,EAAC,CACxB4F,EAAKljB,GAAI,EAAC,CAAIsd,GAAS,GACvB4F,EAAKljB,aAGT,aAAamjB,CAAS,EAAG,CAAC,EAC9B,MAAM7Q,GAAOgN,CAASgE,EAAS,GAAI,EAAG,IAAK,YACtC,YAAY,MAAM,OAAO,CAAGhR,CAAI,IACrC,MAAMiR,GAAMjE,CAASgE,GAAU,EAAG,EAAG,IAAK,YACrC,YAAY,MAAM,eAE3B,eACI,IAAK,QAAO,CACf,WAID,qBACI,CAAK,eAAa,CAAK,WAAW,KAAK,QACvC,KAAK,SAAW,KAAK,OAAS,KAAK,cAC9B,oBAAsB,YAAe,KAAK,cAC1C,oBAAsB,YAAe,KAAK,YAC1C,kBAAoB,YAAa,KAAK,KAAI,CAC/C,OAAK,KAAQ5f,CAAO,SACpB,EAAK,UAAYA,KAAO,SACxB,GAAK,SAAW8f,KAAmB,CAC/B,MAAO,SAAK,KACZ,UAAW,EAAK,gBAEpB,CAAK,WAAa,KAAIpM,QAAoB,MAAK,WAC/C,CAAK,WAAW,WAAW,eAAa,iBACxC,CAAK,WAAW,WAAW,eAAa,iBACxC,CAAK,WAAW,SAAQ,aAAc,WAAY,QAC7C,iBAAa,eAAiB,WAAW,CAAK,UAAU,QACxD,iBAAa,aAAiB,SAAS,qBAEhD,YAAoB7T,KAChB,OAAO,MACH,MAEJ,MAAMkgB,EAAanE,EAAS/b,EAAE,OAAM,CAAG,KAAK,MAAO,MAAO,EAAG,KACvDb,EAAQ4c,EAAS/b,EAAE,OAAM,CAAG,MAAK,KAAO,OAAQ,IAAK,IACpDwI,MAAQ,CAAI,QAAK,cAAe,YAAc,MAAK,CAC1D,WAAW,YAAY,IAAIkR,EAAM,GAAIwG,EAAY/gB,EAAO4K,CAAC,eAE7D,4BACS,kBAAuB,CAAM,CAC9B,UAAW,gBAInB,4BACS,kBAAuB,CAAM,CAC9B,UAAW,cAInB,4BACS,kBAAuB,CAAM,CAC9B,UAAW,YAGlB,CACD,WAAWrI,EAAI,CACPye,gBACG,YAAc,EAErB,QAAU,MAAO,CAAI,QAAK,cAAe,YAAc,KAAK,EACtD3M,EAAW+K,GAAoB,EAAK,EACpC1O,EAAK0D,GAAcC,EAAU6B,GAAsB3T,EAAG,EACtD0e,EAAK7M,GAAcC,EAAUG,GAAoBjS,CAAE,CAAC,EACtDmO,OAAYuQ,MAAO,CAGvB,WAAW,YAAY,IAAI1G,EAAM,CAAClR,EAAG,IAAQjP,EAAI6mB,EAAIrW,SAAS,CAAG,CAC7D,UAAW,UAE3B,CAAa,CACJ,CACD,SAASrI,EAAI,CACT,MAAM8R,EAAW+K,GAAoB,EAAK,EACpC1O,EAAK0D,GAAcC,EAAU6B,GAAsB3T,EAAG,EACtD0e,EAAK7M,GAAcC,EAAUG,GAAoBjS,CAAE,CAAC,EACtDmO,OAAYuQ,MAAO,CAGvB,WAAW,YAAY,QAAK,WAAM,CAAU,CACxC,UAAW,GACX,KAAM,GACT,CACJ,WAID,gBAAyB,CACrB,OAAK,KAAQjgB,CAAO,SACpB,EAAK,UAAYA,KAAO,WACxB,CAAK,eAAiBkgB,KAAwB,CAC1C,MAAO,SAAK,KACZ,UAAW,EAAK,iBAEf,gBAAkBC,KAAyB,CAC5C,MAAO,SAAK,KACZ,UAAW,EAAK,eAEpB,EAAK,cAAmB,aAEhB,YAAaC,KAAwB,CACjC,MAAO,SAAK,KACZ,UAAW,EAAK,SACxC,CAAqB,EACD,UAAUxL,GAAqB3S,CAAK,QACxBsQ,GACR,SAAU,UACHlP,CAAS,cACZ,cAAe,EACf,WAAWsP,CAAsB,CAAC,CAC9D,CAAyB,EACD,UAAsB,CAClB,WAAY,MAAI+L,CAAwB,CAAE,IAAK,UAClD,KACD,UAAW,EAAK,WAEvB,UAED,EAAK,WACLK,KACI,OAAS,SAAK,KACd,UAAW,KAAK,OAAU,OAAK,IAC/B,UAAU1X,CACCA,aAAW,cAAgB,CAAC,EAEvC,WAAWA,CAAGgF,IAAM,QACV6L,CAAQ7Q,aAAW,YAAa,EACtC,WAAO,CAAIgF,GAAE,eACI6L,CAAO7Q,IAAE,SAAS,OAI/C,KAAK,eAAiCpF,CAAK,CACvC,UAAWjC,OAAO,SAClB,KAAQuS,CACR,MAAO,SAAK,KACZ,UAAW,EAAK,UACnB,IACD,GAAK,cAAgC,CACjC,cAAY,EAAK,YAET,UAAS,QAAK,KAAU,UAAQ,UAC1B,KAAK,OAAU,KAAK,YAGlC,gBAAc,CAAK,kBACnB,gBAAsB,cACtB,iBAAoB,cAAY,KAChC,OAAU,KAAK,UAAO,KACtB,UAAW,EAAK,mBAGpB,cACA,OAAO,OAAK,IACf,CACJ,CAED,MAAM8N,GAAcpf,KAAU,IAAO,WAEjC,yBACS,oBAAsB,YAAe,OAAK,QACxC,IAAM,QAAQ,KAAG,eAAe,YAAc,CACrD,OAAK,KAAQjB,CAAO,OACpB,gBAAmB,YAAc,QACjC,UAAK,IAAQ,QAAU,UACvBA,mBAAiB,aAAmB,OAAK,IAAO,cACzB,mBACvB6W,IAAW,QAAU,OAAgB,QACrC,YAAa,oBACR,YAAcA,cACI,YAAc,UACrC3U,IAAW,QAAU,IAAIme,SACzBrgB,aAAiB,gBACjB,YAAa,sBACR,eACL,UAAK,EAAO,CACf,KACD,OACI,MAAMhB,CAAQ,QAAK,KAAM,YACpB,sBAAkB,qBAE3B,eACI,IAAK,QAAO,CACf,WAID,gBAAyB,CACrB,OAAK,KAAQgB,CAAO,SACpB,EAAK,UAAYA,KAAO,SACxB,GAAK,SAAWsgB,KAAqB,CACjC,MAAO,SAAK,KACZ,UAAW,EAAK,UACnB,CACJ,WAID,wBACS,mBAAqB,YAAc,KAAK,cACxC,oBAAsB,YAAe,KAAK,iBAC1C,uBAAyB,YAAkB,KAAK,oBAChD,0BAA4B,YAAqB,KAAK,KAAI,CAC/D,OAAK,KAAQtgB,CAAO,SACpB,EAAK,UAAYA,KAAO,UACxB,GAAK,SAAY0H,SAAgB1H,EAAO,aACxC,IAAK,OAAW,KAAIugB,KAChB,MAAO,UAAK,CACZ,cAAW,CAAK,SAChC,CAAa,IACD,SAAmB,KAAK,cAAc,mBAC3B,YAAiB,cAAa,oBAC9B,aAAiB,eAAc,aAC1C,IAAK,OAAS,MAAIC,CAAeve,EAAK,MAClC,MAAe,aACC,WAAW,CACvB,WAAWjC,CAAO,YAEtB,MAAO,UAAK,CACZ,cAAW,CAAK,WACnB,CACD,MAAK,IAAO,QAAciC,CAAK,IAC3B,UAAU,CAAK,YACf,eAAqB,YACxB,CACD,aAAU,YAAc,cAAY,KAAK,QAAS,MAAK,KAAO,CAC9D,WAAU,YAAY,YAAY,KAAK,QAAO,MAAK,MACnD,eACW,cAAiB,OAClB,SAAyB,CACvB,cAAW,CAAK,YAElB,MACV,KAAMwe,EAAU,SAA+B,CAC3C,WAAWzgB,CAAO,aAClB,gBAAsB,WACtB,MAAO,UAAK,CACZ,cAAW,CAAK,SAChC,oBACyB,WAAqB,oBACzB,YAAiB,kBAAa,oBAC9B,WAAiB,yBAAgB,iBAE1C,EAAK,WACD,MAAK,MACL,OAAK,YAAa,WAAY,KAAK,QAAM,MAAK,MAC9C,KAAK,QAAM,YAAa,eAAoB,IAAK,SACjD+e,KACI,UAAS,CAAK,eAAU,CAAM,WAAU,CACxC,UAAW,MAAK,QAAM,GACtB,WAAgB,SAAE,EAClB,gBAAoB1S,EAAE,WACzB,CAEI,aAAU,aACf,aAAU,YAAc,cAAY,KAAK,QAAS,IAAK,MAAO,SACjD,CAAK,UAAW,aAAU,qBAG3C,cACA,OAAO,cAEX,YAAc,CAAG,KACR,OAAK,MACN,OAEJ,KAAMzK,CAAO,OAAK,GAAK,eACQ,iBACXA,EAAK,SAAS8e,CAAU,KACxC,MAAK,SAAM,EAAM,iBAGzB,iBACI,CAAK,aAAU,CAAI,gBAAa,CAAK,aAAU,CAAI,iBAC/C,CAAK,aAAU,CAAI,gBACnB,KAAK,qBAAc,WAAqB,CAAC,iBAGjD,YAAkBnf,CAAI,KACb,OAAK,MACN,OAEJ,MAAa,KAAK,QAAM,GAAK,QACvBmf,EAAaC,QACD/e,EAAK,SAAS8e,CAAU,IAGtCA,SACe,KAAK,cAAc,qBACd,cAGxB,MAAK,SAAM,EAAM,uBAErB,cACQ,MAAK,UACE,GAAQ,WACX,MAAK,SAAM,EAAM,YAAW,CAG3B,aAAU,iBACR,GAAQ,aACX,KAAK,cAAc,kBAG9B,CACJ,EAED,YAAyB1hB,CAAOge,EAAU,aAC5B,gBACO,aAAkBA,CAAQ,EAEpCzD,SAAoB,CAC9B,EACD,UAASqH,CAAiB5hB,EAAO,CAC7B,eAAkC,eAAc,CAAK,CAAC,EAAE,OAAO,CAACwE,KAAQkZ,CAC5DlZ,KAAgB,OAAK,IAAMkZ,QACnC,CACP,EACD,UAASmE,CAAkB7hB,EAAO,aAChB,cAAc,EAAK,EAAE,OAAO,KAAeO,OACrD,MAAY,KAAK,OAAMA,GAAU,IAAW,OAAc,IAC1D,OAAQiE,GAAU,EAAKmZ,QACjB,CACb,EACD,UAASmE,CAAiBxP,GACtB,OAAO,MAAU,CAAEA,GAAO,KAAM,EAAOA,IAAO,CAAK,KAAMA,CAAM,UAAY,CAC9E,EACD,UAASyP,CAAkBzP,GACvB,OAAO,MAAU,CACZA,GAAO,GAAM,IACbA,GAAO,KAAM,EACbA,GAAO,GAAK,GACbsK,GAAStK,CAAM,IAAM,EAAG,IAAK,EAAG,CAAC,QAC7B,CACX,EACD,UAAS0P,CAAmBhiB,MACxB,IAAI,OAAOA,GAAU,SACVua,EAAM,YAEY,CAChC,EACD,UAAS0H,CAAoBjiB,MACzB,IAAI,OAAOA,GAAU,SACVua,EAAM,YAEa,CACjC,EAED,SAAS2H,EAAwBzD,GAC7B,UAAkB0D,CAAqB1D,CAAM,EAC7C,OAAO2D,EACD,CAACtiB,EAAQE,IAAU,CACjBsW,MAAuB8L,CAAUpiB,QAEnC,CACT,EACD,SAASqiB,EAAwBC,EAAe,CAC5C,MAAMC,MAAgCV,CAAoBD,GAC1D,MAAO,CAAC9hB,EAAQE,IAAU,CACtBsW,UACZ,CACK,EACD,QAASkM,KAA6BxiB,EAAOge,EAAU,CACnD,YAAkB,mBACX,WAAc,cACd,WAAc,cACd,WAAc,cACd,kBAAwB,CAClC,EACD,QAASyE,KAA4BziB,EAAOge,EAAU,CAClD,YAAkB,mBACX,WAAc,cACd,WAAc,cACd,kBAAwB,CAClC,EACD,YAAiCsE,CAAetE,EAAU,CACtD,MAAO,EAACle,CAAQ4iB,IAAY,CACpBJ,EACAE,GAAqB1iB,EAAQ4iB,EAAS1E,CAAQ,EAG9CyE,SAEhB,CACK,EAED,QAASE,QACL,EAAI1hB,EACJ,MAAK,GAA0D2hB,MAAY,IAAY,GAAA3hB,EAA+D2hB,KAAY,OAAW,QAAQ3hB,EAAO,SAAkBA,EAAG,MAIpN,CACD,UAAS4hB,EAAkBP,QACvB,GAAOA,CACAloB,GAAMyjB,MAAwB,GAAI,EAClCzjB,GAAMwjB,GAAoBxjB,GAAG,GAAI,CAC3C,CACD,SAAS0oB,GAAW1a,QAIhB,CAHI,YAAWA,CAGX,SAAUA,GAAUA,KAAO,IAAS,SAK5C,SACI,OAAI,oBACJ,OAAM,MACN,OAAgBA,QACR,OAAOpI,IAAU,SAGjB,CAAC8iB,QACD,MAAO,IAEX,MAAMte,KAA+B4D,CAAM,KAC3C,KAAO5D,CACD,CACE,wBAEH,CACC,QAEV,QACI,SACWme,QAA0B,GAAM,GACjCV,EACAD,OAEV,IAAQzH,CAAM,SACd,SACW8H,OAAkD,MAAM,CAAC,EAEvE,CACD,WAAa/Z,WACHga,CAAgBK,GAAqBra,MAAK,EAAM,GAChDjI,CAAW,aAAciI,QAAK,CAASA,EAAK,SAAO,SAAW,SACrD,SAAYA,EAAK,OAASA,EAAK,SAAO,SAAS,OAC9D,KAAO,EAAIya,OAAqB,OAAU,CACtC,UAAW,WACX,KAAU1iB,EAAsD,QAChE,KAAWwiB,WACX,GAAQrF,EAAwB,QAChC,uBACA,yBACY,QACZ,QAAWlV,CAAK,SAChC,CAAa,CACJ,CACT,SAEI,EAAS0a,GAAmBxf,QACxB,GAAO+W,CAAM,6BAEjB,CAAS0I,GAAwBjF,QAC7B,GAAQhe,EACGkjB,QAGf,SAASC,GAA2Bb,QAChC,IAAQtiB,GACAsiB,EACOc,MAAmC,EAEvCC,GAAuBrjB,GAAW,CAEhD,CACD,MAAMsjB,GAAyB,CAC3B,OAAI,oBACJ,OAAM,MACN,OAAgBlb,QACR,CAACmS,EAAM,yBACA,IAEX,MAAM/V,KAA+B4D,CAAM,KAC3C,KAAO5D,CACD,CACE,wBAEH,CACC,QAEV,QACI,SAAkBye,QAA8C,MAAM,CAAC,EACvE,SAAc,SACd,SAAkBM,OAAgD,YAAY,YAAyB,CAAM,CAAC,EACjH,CACD,WAAajb,WAET,KAAMga,GAAgB/H,CAAM,6BAAuB,GAAY,YAC9C,KAAcjS,QAAK,CAASA,EAAK,SAAO,SAAW,SACrD,SAAYA,EAAK,OAASA,EAAK,SAAO,SAAS,OAChDrH,CAAKuiB,IAAiBlb,CAAK,MAAM,KAAO,OAAQrH,GAAO,OAASA,EAAK,OACnF,MAAO,IAAI8hB,OAAqB,OAAU,CACtC,UAAWtJ,EACX,SAAUpZ,GAAsD,QAChE,KAAW8iB,WACX,IAAQ3F,GAAwB/D,CAAI,OACpC,mBACA,yBACY,QACZ,QAAWnR,CAAK,SAChC,CAAa,CACJ,CACT,SAGY,wBACJ,OAAM,MACN,OAAgBF,QACR,OAAOpI,IAAU,SAGjB,SAAUoI,GAAUA,KAAO,IAAS,SACpC,QAAO,EAEX,MAAMqW,KAAiCze,MAA8B,CAAC,EAKtE,GAJI,CAACye,GAID,CADgB0D,GAAqB1D,CAAM,EAE3C,QAAO,IAEX,MAAMja,KAA+B4D,CAAM,KAC3C,KAAO5D,CACD,CACE,wBAEH,CACC,QAEV,QACI,SAAkB,CAAE,OAAQ,QAAO+Y,EAAgCtc,OAA2B,MAAM,KAAO,OAAQA,GAAO,OAASA,EAAK,OAAS,CACjJ,QAAQsZ,CAAM,SACd,SACI,OAAMkE,CAASgF,GAAwBnb,MAAK,oBAA0C,CAAC,EACvF,GAAI,MACA,GAAMvH,EAAQ,6BAEHmhB,EAAwBzD,CAAM,KACzC,CAACiF,EACD,MAAM3iB,EAAQ,uBAIzB,EACD,WAAauH,WACHmW,CAASgF,GAAwBnb,MAAK,oBAA0C,CAAC,EACvF,GAAI,MACA,GAAMvH,EAAQ,6BAEEohB,EAAqB1D,CAAM,KAC3C,CAACkF,EACD,MAAM5iB,EAAQ,6BAED,YAAcuH,QAAK,CAASA,EAAK,SAAO,SAAW,SACrD,SAAYA,EAAK,OAASA,EAAK,SAAO,SAAS,OAC9D,KAAO,EAAIya,OAAqB,OAAU,CACtC,UAAWtE,EAAO,SAClB,OAAUpe,CAAsD,QAChE,KAAWsjB,EACX,SAAQnG,CAAwBiB,EAAO,MACvC,wBACA,yBACA,GAAOnW,KAAK,MACZ,QAAWA,CAAK,SAChC,CAAa,CACJ,CACT,SAEUsb,CAAkB,CACpB,YAAY5iB,WACH,QAAaA,WAAO,EACzB,WAAYA,CAAO,SAEvB,WAAUhB,CAAO,SACC,SAAK,CACd,wBACWO,GAAU,CAAE,IAAIU,EAAIkK,EAAI,OAAQA,GAAMlK,EAAK,MAAK,UAAWV,CAAK,UAAO,CAAQU,IAAO,OAAS,SAAY,UAAUyc,CAAI,UAAO,CAAQvS,IAAO,OAASA,EAAKuS,CAAO,MACpL,IAAO,KAAK,MAAK,yBAInBmG,EAAc5hB,EAAU,SAAQ,CACtC,SACI,YAAYgB,WACH,UAAYjC,CAAO,UACxB,WAAK,KAAc,wBACnB,CAAK,WAAQ,QAAU,UACvB,IAAK,WAAU,UAAe,CAC1B,OAAM8iB,CAAW7gB,EAAI,yBACZ,QAAU,WAAoB,IAC9B,YAAY7I,WACrB,UAAK,MAAQ,SAAY0pB,WAKrC,IAASC,GAAqB9gB,QAC1B,MAAO,IAAI2S,OACP,wBAA6B,CAAQrV,IAAUS,EAAO,KAAK,OAAS,IAAI,OAAQ,GAChF,UAAUA,CAAO,SAAY,QAC7B,WAAe,OACf,SAAc,MAAY,SAC1B,WACI,WAAYA,WAAmB,SAC/C,CAAa,WACD,CAAWA,EAAO,SAC9B,CAAS,CACJ,CACD,SACI,YAAYiC,WACH,KAAQjC,KAAO,MACpB,EAAK,WAAYA,CAAO,UACxB,WAAYA,CAAO,KAAK,IAAI,CAACgjB,EAAGzjB,IAAUwjB,IAAqB9gB,CAAKjC,EAAQT,CAAK,CAAC,EAClF,KAAK,KAAK,WAAYA,QACJ,CACV,QAAS,WACT,WAAWqN,CAAE,SACb,QACW5M,QAAO,GAAS,wBAAuB,CAAET,CAAK,SAEzD,EAAU,CAAC,EAAG8M,QACV,GAAM6L,EAAQlY,EAAO,SAAS,wBAAuB,CACrD,UAAW,EAAIqM,MAAE,KACVrM,EAAO,SAAS,0BAInC,EAAK,KAAO,MAAIijB,CAAgBhhB,IAC5B,SAAW,WAAU,KAAK6K,CAAOA,IAAG,IACvC,CACJ,CACJ,CAED,SAASoW,GAAqB9b,QAC1B,GAAI,YAAoB,CAACN,IAAe,IAAI,EACjC,IAAIgP,MAAsB,KAAkB,GAEhD,GACV,IACD,QAASqN,CAAsB/b,QAC3B,CAAI,EAACN,CAAQM,EAAO,OAASN,EAAQM,EAAO,IAAG,CACpC,IAAIsX,GAAwB,GAC/B,EAAKtX,GAAO,GACZ,KAAKA,CAAO,KACf,CAED,GAASA,EAAO,IAAG,EAAK,CAACN,EAAQM,EAAO,IAAG,CACpC,IAAIgc,GAAgB,GACvB,EAAKhc,GAAO,GACZ,KAAKA,CAAO,KACf,CAEE,IACV,CACD,WAASic,CAAgBzW,QACrB,CAAM0W,EAAMzN,GAAejJ,MAC3B,GAAI0W,EACA,MAAO,CAACA,EAAI,SAAO,EAAI,OAAQA,IAAI,KAAO,IAAI,OAAM,CAExD,QAAWzN,GAAejJ,MAC1B,OAAIvB,GACQA,EAAG,SAAUA,EAAG,SAAQ,CAE7B,CAAC,SAAW,OAEvB,QAASkY,GAAmBnc,QAExB,GAAMiP,EAAc,GACd7I,MAA0BpG,CAAQ5E,CAAY,EAChDgL,GACA6I,GAAY,IAAK7I,CAAE,EAEvB,QAAW2V,GAAsB/b,CAAM,KAEnCiP,EAAY,KAAKhL,CAAE,EAEvB,QAAWqK,GAAqBtO,MAAO,GAAO,EAC9C,UACIiP,EAAY,MAAO,EAEhB,IAAImN,IAA+B,CAC7C,CACD,MAAMC,GAAoB,CACtB,OAAI,cACJ,OAAM,MACN,OAAgBrc,QACR,OAAOpI,IAAU,QACjB,UAAO,EAEX,MAAMqI,KACA7D,CAASa,KACX,OAAQgD,EAAE,SAAS,WACnB,SAAO,IAAS,WACXA,OAAE,IAAS,WAChB,OAAW,QAAS,WACpB,OAAQ,SAAS,WAErB,OACM,CACE,wBAEH,CACC,QAEV,QACI,SAAmBmL,QACnB,MAAalL,WAAiC,IAAQA,EAAK,YAAY,YACpDgO,EACtB,MACD,OAAahO,WAET,KAAMtI,GAAQsI,CAAK,OACbsF,CAAItF,EAAK,WACTgP,WAA4BX,CAAc,EAChD,GAAIW,EACA,OAAO,IAAIG,OAAoB,OAAU,CACrC,UAAWpT,EAAS,KAChB,IAASiT,EAAG,SAAO,SAAM,MAC5B,EACD,OAAOtX,CACP,UAAWsI,EAAK,SACpC,CAAiB,EAEL,SAAmBrH,EAAM,WAAYqH,EAAK,OAASA,EAAK,SAAO,SAAS,OAAgB,KAAQrH,IAAO,OAASA,EAAK0S,EAAsBoD,KAA4B/W,EAAM,QAAQ,CAAC,EAChLskB,SAA0B1W,CAAG8R,EAAuB,EAC1D,OAAI4E,GACO,QAA8B,SAAU,CAC3C,UAAUtN,EAAYpJ,QACtB,GAAQ2F,EACR,YAAa,WACT,KAAU+Q,EAAI,SAAO,SAAW,MAChC,KAAUA,EAAI,SAAO,SAAW,CACxD,KACoB,QAAWjgB,EAAS,WAAW,CAC3B,yBAAiD,IAAQ,EACzD,UAAWsR,CACnC,CAAqB,SACM3V,CACP,UAAWsI,EAAK,SACpC,CAAiB,EAEE,SAA8B,SAAU,CAC3C,UAAU0O,EAAYpJ,QACtB,GAAQ2F,EACR,QAAgB,WAAW,CACvB,yBAAiD,IAAQ,EACzD,UAAWoC,CAC/B,CAAiB,SACM3V,CACP,UAAWsI,EAAK,SAChC,CAAa,CACJ,CACT,SAEUoc,CAAQ,CACV,YAAY5oB,WACR,GAAK,EAAIA,EACT,OAASC,CACZ,CACD,yBACY,GAAK,MAAG,CAAK,IAEzB,OAAO,UAAc,CACjB,QACI,MAAO,GAEX,SAAUqF,CAAI,EACRrF,KAAQ,CACd,MAAI,YAAa,UAAY,SAAOA,CAAM,SAI7C,CACD,SAAO,SAAe,CAClB,OAAO0H,EAAG,SAAcA,EAAG,IAAMC,EAAG,CACvC,CACD,UAAW,CACP,SACO,SACA,OAEV,CACJ,CACD,OAAMihB,EAAkB,CACpB,wBAAuB,mBACvB,iBAAuC,EAAGzL,CAAK,CACvD,GAEU0L,GAAc3iB,CAAU,KAAK,EACnC,MAAM4iB,GACF,YAAY5hB,WACH,UAAc,wBACnB,CAAK,WAAQ,QAAU,UACvBjC,CAAO,UAAU,8BAAwB,CAAO,IACtCA,QAAO,GAAU+B,GAAiB,QAAK,OAAS6hB,CAAY,OAAW,UAAU,CAAC,CAAC,QACvFpP,EAAWvS,EAAI,wBACZ,SAAU,UAAmB,CAAC,GACvC,IAAK,UAAQ,oBACPC,CAAaD,EAAI,wBACvBC,EAAW,UAAU,UAAmB,CAAC,GACzCA,CAAW,sBAAsC,GAAQ,CAAC,EAC1DlC,OAAO,KAAU,uBACR,iBACJ,sBACYiC,EAAI,wBACrB6U,EAAS,UAAU,UAAmB,CAAC,GACvCtC,CAAS,sBACJ,oBACM,iBAAiB,CAAU,CAClC,QAAmBvS,EAAI,wBACZ,SAAU,UAAmB,CAAC,GACzC,IAAK,UAAQ,oBACR,sBAGL,EAAK,wBAKjB,KAAoBhB,EAAU,MAAM,EACpC,QAAwB,CACpB,sBACS,4BAAyB,uBAA2B,CACzD,KAAK,yBAAsB,oBAAwB,CACnD,KAAK,UAAYjB,UAAO,CACxB,UAAK,KAAYA,UAAO,CACxB,UAAK,KAAc,wBACnB,EAAK,UAAQ,QAAU,UACnBA,IAAO,OAAW,SAClB,QAAK,OAAQ,QAAU,UAAgB,IAAW,GAAG,CAAC,IAEnD,UAAU,6BAAwB,KACzC,QAAgBiC,CAAI,wBACZ,SAAU,UAAmB,CAAC,GACtCjC,CAAO,UAAU,uBACZ,QAAQ,oBACR,SAAa8jB,UACF7hB,EAAI,0BACpB8hB,GAAQ,SAAU,UAAmB,CAAC,GACtC,IAAK,WAAW,sBACX,QAAWA,CAChB,QAAkB9hB,EAAI,0BAA8B,CACpD+hB,EAAU,UAAU,UAAgB,CAAI,GACxCA,GAAU,wBAA2B,KACrCA,EAAU,yBAA2B,KAAK,EAC1CA,EAAU,yBAA2B,MAAM,GAC3CA,CAAU,yBAA2B,KAAK,EAC1C,KAAK,UAAS,qBACRC,CAAYhiB,EAAI,0BAA8B,CACpDgiB,EAAU,UAAU,UAAgB,CAAI,GACxCA,GAAU,wBAA2B,KAAK,EAC1CA,EAAU,yBAA2B,KACrCA,EAAU,yBAA2B,KAAK,EAC1CA,EAAU,yBAA2B,MAAM,GAC3C,MAAK,QAAS,qBACRC,CAAWjiB,EAAI,0BAA8B,CACnDiiB,EAAS,UAAU,UAAmB,CAAC,GACvCA,CAAS,yBAA2B,KAAK,EACzCA,EAAS,yBAA2B,KAAK,EACzC,KAAK,UAAS,qBACT,QAAYA,UACEjiB,EAAI,wBACZ,SAAU,UAAmB,CAAC,GACzC,IAAK,WAAW,sBACX,oBACQ,UAAQ,CAAG,UAAU,QAAK,qBAClC,EAAQjC,IAAO,MACpB,GAAK,UAET,QAAI,2BACQ,SAAK,KAAU,CAC1B,UACS,CACN,QAAUjF,CAAC,EAAI,KAAK,MAAM,UAAS,uBAClB,SACXopB,UAAwB/rB,EAAK,EAAG,GAAG,EACnCgsB,EAAKxI,EAAS7gB,EAAG,GAAM,CAAC3C,EAAK,EAAG,GAAG,EACnCisB,EAAM,OAAK,QAAY,UAC7B,IAAK,SAAU,yBAA2B,KAAK,EAAG,EAClD,KAAK,UAAU,yBAA2B,KAAM,EAAG,EACnD,KAAK,sBAAkB,CAAO,KAAK,KACnC,GAAK,sBAAwB,MAAM,CACtC,GACD,uBACS,OAET,4BACS,OAEZ,CAED,SAASC,UACL,MAAO,CACHlR,GAAcmR,OAAcrP,CAAsB3T,EAAG,EACrD6R,GAAcmR,GAAW,EAAG/Q,GAAoBjS,EAAG,GAAKijB,EAAW,GAAI,EACnF,CACK,CACD,MAAMC,EAAwB,CAC1B,sBACS,wBAAqB,mBAAuB,CACjD,KAAK,sBAAmB,iBAAqB,CAC7C,KAAK,yBAAsB,oBAAwB,CACnD,KAAK,yBAAsB,oBAAwB,CACnD,KAAK,uBAAoB,kBAAsB,CAC/C,KAAK,MAAQzkB,IAAO,MACpB,GAAK,UAAYA,UAAO,EACxB,UAAK,MAAaA,UAAO,EACzB,UAAK,KAAYA,UAAO,CACxB,UAAK,KAAYA,UAAO,CACxB,UAAY,KAAI0kB,KACZ,SAAU,UAAK,KACf,UAAe,OACf,SAAU,SAAK,KACf,UAAO,CAAK,MACZ,UAAW,UAAK,KACnB,UACI,QAAa,UAAmB,IAAK,GAAK,UAAU,WACpD,OAAW,UAAQ,CAAG,OAAQ,KAAK,yBACnC,OAAW,UAAQ,CAAG,OAAQ,KAAK,yBACnC,OAAW,UAAQ,CAAG,OAAM,GAAK,uBACjC,CAAK,WAAW,2BAA4B,SAAK,oBACjD,CAAK,WAAW,2BAA0B,OAAK,OAAW,WAEnE,qBACS7kB,CAAE,OACH,SAEJ,OAAY,MAAK,OACXskB,UAAgB,EAAM,EAAG,EAAGtkB,MAAE,GAAO,UAAczH,CAAG,KACjDwjB,CAAS,KAAK,UAAY/b,UAAS,SAAW,OAAUA,EAAE,MAAM,EAAG,EAAGA,MAAE,GAAO,UAAc,CAACzH,MACzG,EAAK,MAAM,sBAA8B,IAC5C,CACD,yBACS,4BACD,QAAW,UAE3B,CAAa,CACJ,CACD,yBACS,4BACD,QAAW,UAE3B,CAAa,CACJ,CACD,uBACS,4BACD,QAAW,UAE3B,CAAa,CACJ,CACD,wBACsB,CAAG,GACjBmJ,EAAG,yBAEInG,CAAE,EAAIkpB,KAAkB,KAAK,WAAY,UAAK,KAAS,CAC9DnpB,SAAYC,EAAO,GAGvB,KAAK,MAAM,sBAAwB,IAAK,IAAM,UAAS,CAAID,QAAS,KAAM,UAAS,CAAIC,QACnF,MAAW,UAE3B,CAAa,CACJ,CACD,sBACWD,CAAIC,CAAE,EAAIkpB,KAAkB,KAAK,WAAY,UAAK,KAAS,CAC9DnpB,SAAYC,EAAO,GAGvB,KAAK,MAAM,sBAAiB,CAAM,UAC9B,UAAW,UAE3B,CAAa,CACJ,CACJ,CAED,MAAMupB,EAAkB,CACpB,sBACQ1kB,CAAIkK,EACR,MAAK,2BAAyB,uBAA2B,CACzD,KAAK,+BAA4B,0BAA8B,CAC/D,KAAK,2BAAwB,sBAA0B,CACvD,KAAK,4BAAyB,uBAA2B,CACzD,KAAK,MAAQnK,IAAO,MACpB,GAAK,UAAYA,UAAO,EACxB,UAAK,KAAY0H,UAAgB1H,CAAO,SAAQ,CAChD,UAAK,CACDA,KAAO,qBACD,GAAI4kB,MACF,UAAW,WAAK,KACnB,CACC,SACV,EAAMC,KAAO,CAAIJ,KAA6B,CAC1C,UAAW,CAACzkB,UAAe,SAAUA,EAAO,SAAQ,OAAQ,EAC5D,UAAUA,CAAO,SACjB,WAAe,sBACE,SACjB,WAAY,MACZ,WAAW,UAAK,KACnB,CACD6kB,SAAU,8BAAuC,CAC7CjjB,OAAK,uBAAyB,CAAK,6BAC9B,oBAA4B,SAAK,2BAErC,QACL,SAAK,GAAS,IAAIkjB,OACd,QAAUnB,GACV,QAAa,IACb,OAAQ3jB,IAAO,OACf,SAAY,MACZ,WAAW,UAAK,KACnB,CACD,SAAK,CAAO,MAAI6jB,CAAY5hB,IACxB,QAAU,WAAK,KAAU,UAAM,MAAU,CACzC,wBAAqB,eACV,UAAK,KACnB,CACD,SAAK,CAAK,YAAY,YAAY,WAAK,CAAO,KAAK,OAAO,IACzDhC,CAAK,OAAK,GAAK,yBAA2BA,EAAO,QAAkBA,EAAG,4BAAyB,CAAK,4BAC1F,GAAK,yBAA2BkK,EAAO,QAAkBA,EAAG,4BAA0B,EAAK,6BAC7F,EACL,KAAK,KAAK,WAAQ,SAAY,WAAW,KAAK,OAAO,IACrD,QAAK,CAAM,KAAK,WAAQ,SAAY,WAAK,KAAS,SAAK,CAAO,IAC9D4U,CAAc,OACV,EAAS,WAAK,KAAU,UAAM,MAAU,CACxC,UAAW,WAAW,MACtB,WAAgB1X,QAAE,GAClB,WAAW2b,CAAG3W,QAAQ,MAC1C,CAAiB,GAEI,QAAK,EAAK,yBACV,CAAK,yBAAc,CAAY,WAAK,KAAS,SAAK,CAAO,IAC9DjE,CAAa,OAAK,SAAW,UAAU,wBAG/C,mBACS,CAAK,MACN,WAEJ,OAAa,MAAK,CAAK,WACM,CAAE,yBACN,MAASsY,CAAU,UACnC,MAAM,MAAM,WAAW,CAEnC,QACD,sBACS,OAAU,UAAI,IAAY,CAAC,SAAK,OAAU,UAAI,IAAW,EAC1D,QAAK,QAAU,UAAI,IAAU,EAC7B,QAAK,QAAS,SAAK,0BAG3B,6BACS,CAAK,MACN,WAEJ,OAAa,MAAK,EAAM,KAAK,WACVC,CAAepf,OAChBK,CAAK,SAAS8e,CAAU,UAIvB,KAAK,KAAK,yBACL,qBAGnB,GAAM,MAAM,WAAW,CAC/B,QACD,yBACa,GACDnf,KAAG,MAAQ,QACX,QAAK,GAAM,MAAM,WAAW,SAGtB,GAAK,yBACA,QACX,SAAK,CAAK,yBAM1B,MAAc,CACV,YAAYzG,WAAkB,CAAG,CAC7B,KAAK,EAAIA,EACT,OAASC,EACT,OAASgqB,CACZ,CACD,yBACY,GAAK,MAAG,CAAK,IAAG,GAAK,IAEjC,OAAO,UAAc,CACjB,QACI,MAAO,GAEX,SAAU3kB,CAAI,EACRrF,KAAQ,CACRgqB,EAAI3kB,EAAI,EACd,MAAI,YAAa,UACb,SAAOrF,CAAM,UACb,SAAOgqB,CAAM,SAIpB,CACD,SAAO,SAAe,CAClB,OAAOtiB,EAAG,SAAcA,EAAG,IAAMC,EAAG,GAAKD,EAAG,IAAMC,EAAG,CACxD,CACD,UAAW,CACP,SACO,SACA,OACH,EAAG,OAEV,CACJ,CACD,OAAMsiB,EAAkB,CACpB,wBAAuB,mBACvB,iBAAuC,EAAG9M,CAAK,CACvD,GAEI,QAAS+M,GAAmBjmB,QACxB,GAAOkmB,EAAQ,SAASlmB,EAAK,CACvB,QAAYA,CAAM,EAAGA,IAASA,GAAO,EACrC,IAAIkmB,EACb,CACD,SAASC,GAAarmB,QACX,wBACA,yBACA,yBAGX,OAASsmB,GAAmBhe,QACxB,IAAO,IAAIwb,OACP,OAAUoC,EACV,WAAY,CACRK,UAAiCje,CAASA,GAAO,CAAI,OAAW5E,EAAa,CAAC,EAC9E6iB,IAA0B,KAAOje,EAASA,GAAO,CAAI,OAAW5E,EAAa,CAAC,EAC9E6iB,IAA0B,KAAOje,EAASA,GAAO,CAAI,OAAW5E,EAAa,CAAC,CACjF,CACb,IAEI,QAAS8iB,GAAa9iB,QAClB,GAAO,CACH,WAAUwT,CAAY7S,QACtB,MAAYA,WACZ,CAAWE,EAAS,WAAW,CAC3B,yBACA,OAAWsP,EAAsBoD,SACpC,CACb,CACK,CACD,MAAMwP,GAAqB,CACvB,OAAI,cACJ,QAAM,MACN,OAAgBne,QACR,CAAC8d,GAAQ,SAASlmB,EAAK,CACvB,QAAO,IAEX,MAAMqI,KACA7D,CAASa,KACX,EAAGgD,EAAE,SAAS,WACd,OAAK,MAAS,WACd,OAAK,MAAS,WACjB,OACD,GAAO7D,CACD,CACE,wBAEH,CACC,QAEV,QACI,SAAmByhB,QACnB,MAAa3d,WAAiC,IAAQA,EAAK,YAAY,YACvD,QAChB,UAAmB6d,CACtB,MACD,OAAa7d,WACHtI,CAAQsI,EAAK,OACbsF,CAAItF,EAAK,WACf,WAAMsF,OAAagW,WACT7iB,CAAQ,6BAEX,EAAI+kB,OAA2B,OAAU,CAC5C,UAAUE,EACV,QACIM,CAAatmB,EAAM,SAAS,EAAG4N,SAAE,IAAW,CAAC,UAC1B,OAAS,EAAGA,SAAE,IAAW,CAAC,UAC1B,OAAS,EAAGA,SAAE,IAAW,CAAC,UAEjD,CAAQ2F,GACR,QACA,UAAWjL,EAAK,SAChC,CAAa,CACJ,CACT,SAEUke,CAAQ,CACV,YAAY1qB,WAAkB,CAAG2qB,EAAI,EAAG,CACpC,KAAK,EAAI3qB,EACT,OAASC,EACT,OAASgqB,EACT,OAASU,CACZ,CACD,yBACY,GAAK,MAAG,CAAK,IAAG,GAAK,IAAG,GAAK,IAEzC,OAAO,UAAc,CACjB,QACI,MAAO,GAEX,SAAUrlB,CAAI,EACRrF,KAAQ,CACRgqB,EAAI3kB,EAAI,EACRqlB,EAAIrlB,EAAI,EACd,MAAI,YAAa,UACb,SAAOrF,CAAM,UACb,SAAOgqB,CAAM,UACb,SAAOU,CAAM,SAIpB,CACD,SAAO,SAAe,CAClB,OAAOhjB,EAAG,SAAcA,EAAG,IAAMC,EAAG,GAAKD,EAAG,IAAMC,EAAG,GAAKD,EAAG,IAAMC,EAAG,CACzE,CACD,UAAW,CACP,SACO,SACA,OACH,EAAG,OACH,EAAG,OAEV,CACJ,CACD,OAAMgjB,EAAkB,CACpB,wBAAuB,mBACvB,iBAAuC,EAAGxN,CAAK,CACvD,GAEI,QAASyN,GAAmB3mB,QACxB,GAAOwmB,EAAQ,SAASxmB,EAAK,CACvB,QAAYA,CAAM,EAAGA,IAASA,GAAM,CAAGA,EAAM,CAAC,EAC9C,IAAIwmB,EACb,CACD,SAASI,GAAa9mB,QACX,wBACA,yBACA,yBACA,yBAGX,OAAS+mB,GAAmBze,QACxB,IAAO,IAAIwb,OACP,OAAU8C,EACV,WAAY,CACRL,UAAiCje,CAASA,GAAO,CAAI,OAAW5E,EAAa,CAAC,EAC9E6iB,IAA0B,KAAOje,EAASA,GAAO,CAAI,OAAW5E,EAAa,CAAC,EAC9E6iB,IAA0B,KAAOje,EAASA,GAAO,CAAI,OAAW5E,EAAa,CAAC,EAC9E6iB,IAA0B,KAAOje,EAASA,GAAO,CAAI,OAAW5E,EAAa,CAAC,CACjF,CACb,IAEI,QAASsjB,GAAatjB,QAClB,GAAO,CACH,WAAUwT,CAAY7S,QACtB,MAAYA,WACZ,CAAWE,EAAS,WAAW,CAC3B,yBACA,OAAWsP,EAAsBoD,SACpC,CACb,CACK,CACD,MAAMgQ,GAAqB,CACvB,OAAI,cACJ,QAAM,MACN,OAAgB3e,QACR,CAACoe,GAAQ,SAASxmB,EAAK,CACvB,QAAO,IAEX,MAAMqI,KACA7D,CAASa,KACX,EAAGgD,EAAE,SAAS,WACd,OAAK,MAAS,WACd,OAAK,MAAS,WACd,OAAK,MAAS,WACjB,OACD,GAAO7D,CACD,CACE,wBAEH,CACC,QAEV,QACI,SAAmBmiB,QACnB,MAAare,WAAiC,IAAQA,EAAK,YAAY,YACvD,QAChB,UAAmBse,CACtB,MACD,OAAate,WACHtI,CAAQsI,EAAK,OACbsF,CAAItF,EAAK,WACf,WAAMsF,OAAagW,WACT7iB,CAAQ,6BAEX,EAAI+kB,OAA2B,OAAU,CAC5C,UAAUY,EACV,QAAY,QACP,yBACWnmB,EAAUumB,IAAapJ,CAAM9P,EAAE,WAAWrN,CAAK,UAC/D,CAAQgT,GACR,QACA,UAAWjL,EAAK,SAChC,CAAa,CACJ,CACT,SAEI,EAAS0e,GAAmB5e,QACxB,CAAMiP,EAAc,GACdC,MAA0BlP,CAAO,OAAO,EAC9C,UACIiP,EAAY,MAAO,EAEhB,IAAImN,IAA+B,CAC7C,CACD,MAAMyC,GAAoB,CACtB,OAAI,cACJ,OAAM,MACN,OAAgB7e,QACR,OAAOpI,IAAU,QACjB,UAAO,EAGX,MAAMwE,KAAqB4D,CAAQ,KAC/B,IAFMhD,EAEK,SAAS,WACvB,OACD,GAAOZ,CACD,CACE,wBAEH,CACC,QAEV,QACI,SAAmBqP,QACnB,MAAavL,WAAiC,GAAM,GACpD,SAAmBgO,EACtB,MACD,OAAahO,WACHrF,CAAMqF,EAAK,SACXtI,EAAQsI,SACRsF,CAAItF,EAAK,WACTgP,WAA4BX,CAAc,EAChD,OAAIW,GACO,QAAwB,CAC3B,MAAO,IAAIjT,EAAS,KAChB,IAASiT,EAAG,SAAO,SAAM,MAC5B,EACD,OAAOtX,CACP,UAAWsI,EAAK,SACpC,CAAiB,EAEE,SAAwB,CAC3B,QAASlO,EAAMA,EACf,MAAOiK,EAAS,WAAW,CACvB,UAAW6iB,EAC/B,SACuBlnB,GACP,SAAWsI,EAAK,SAChC,CAAa,CACJ,CACT,SAGQ,KAAS,EACL,0BACA,qBAIsB,GAAK,EACnC,MAAM6e,GACF,YAAYlkB,WACH,yBAAsB,oBAC3B,KAAK,WAAajC,WAAO,CACzB,WAAK,KAAc,wBACnB,CAAK,WAAQ,QAAU,UACvBA,CAAO,UAAU,8BAAwB,CAAO,IAChD,QAAyB,yBAAwB,CACjDomB,SAAa,GAAU,WAAoB,IAC9B,MAAM,WAAS,oBAAwBpmB,GAAO,QAAS,YACvD,GAAW,GACxBA,QAAO,IAAU,wBACZ,QAAQ,SAAYomB,WACpB,sBACQ,UAAW,SAAU,UAAK,qBAClC,CAAQpmB,KAAO,MACpB,EAAK,WAET,QAAU,CACN,SAAa,QAAK,qBACQ,KAAc4B,SAAK,iBAAoB,eAE5D,KAAM,WAAS,SAAmB,CAC/B5C,OAAU,KACVqnB,EAAM,MAAK,IAAK,WAAWrnB,CAAK,UAGnC,SAAcqnB,WAAW;AAAA,CAAI,EAC9BC,IACA1kB,EAAK,UAAYA,EAAK,aAE7B,CACD,gBAAiB,CACb,KAAK,QAAO,CACf,CACJ,CAED,MAAM2kB,EAAmB,CACrB,YAAYtkB,EAAKjC,EAAQ,CACrB,KAAK,MAAQA,EAAO,MACpB,KAAK,UAAYA,EAAO,UACxB,KAAK,KAAO,IAAImmB,GAAalkB,EAAK,CAC9B,UAAWjC,EAAO,UAClB,UAAWA,EAAO,UAClB,MAAO,KAAK,MACZ,UAAW,KAAK,SAChC,CAAa,CACJ,CACJ,CAED,MAAMwmB,GAAcvlB,EAAU,KAAK,EACnC,MAAMwlB,EAAc,CAChB,YAAYxkB,EAAKjC,EAAQ,CACrB,KAAK,eAAiB,KAAK,eAAe,KAAK,IAAI,EACnD,KAAK,WAAaA,EAAO,UACzB,KAAK,QAAUiC,EAAI,cAAc,KAAK,EACtC,KAAK,QAAQ,UAAU,IAAIukB,GAAa,GACxCxmB,EAAO,UAAU,mBAAmB,KAAK,OAAO,EAChD,MAAMqO,EAAYpM,EAAI,cAAc,OAAO,EAC3CoM,EAAU,UAAU,IAAImY,GAAY,GAAG,CAAC,EACxCnY,EAAU,SAAW,GACrBA,EAAU,KAAO,OACjBrO,EAAO,UAAU,aAAaqO,CAAS,EACvC,KAAK,QAAQ,YAAYA,CAAS,EAClC,KAAK,aAAeA,EACpBrO,EAAO,MAAM,QAAQ,GAAG,SAAU,KAAK,cAAc,EACrD,KAAK,MAAQA,EAAO,MACpB,KAAK,QAAO,CACf,CACD,SAAU,CACN,MAAM0mB,EAAS,KAAK,MAAM,SACpBC,EAAYD,EAAOA,EAAO,OAAS,CAAC,EAC1C,KAAK,aAAa,MACdC,IAAc,OAAY,KAAK,WAAWA,CAAS,EAAI,EAC9D,CACD,gBAAiB,CACb,KAAK,QAAO,CACf,CACJ,CAED,MAAMC,EAAoB,CACtB,YAAY3kB,EAAKjC,EAAQ,CACrB,KAAK,MAAQA,EAAO,MACpB,KAAK,UAAYA,EAAO,UACxB,KAAK,KAAO,IAAIymB,GAAcxkB,EAAK,CAC/B,UAAWjC,EAAO,UAClB,MAAO,KAAK,MACZ,UAAW,KAAK,SAChC,CAAa,CACJ,CACJ,CAED,MAAM6mB,GAAuB,CACzB,GAAI,eACJ,KAAM,UACN,OAAQ,CAAC7nB,EAAOoI,IAAW,CACvB,GAAI,OAAOpI,GAAU,UACjB,OAAO,KAGX,MAAMwE,EAASa,EAAY+C,EAAQ,CAC/B,UAFMhD,EAEO,SAAS,MACtC,CAAa,EACD,OAAOZ,EACD,CACE,aAAcxE,EACd,OAAQwE,CACX,EACC,IACT,EACD,QAAS,CACL,OAASgT,GAAU/H,EACtB,EACD,WAAanH,GAAS,CAClB,IAAIrH,EACJ,OAAIqH,EAAK,MAAM,SAAS,SAAW,EACxB,IAAIsf,GAAoBtf,EAAK,SAAU,CAC1C,UAAWoH,GACX,MAAOpH,EAAK,MACZ,UAAWA,EAAK,SACpC,CAAiB,EAEE,IAAIif,GAAmBjf,EAAK,SAAU,CACzC,UAAWoH,GACX,WAAYzO,EAAKqH,EAAK,OAAO,aAAe,MAAQrH,IAAO,OAASA,EAAK6mB,GAAU,QAAQ,iBAC3F,MAAOxf,EAAK,MACZ,UAAWA,EAAK,SAChC,CAAa,CACJ,CACT,EAEUzF,GAAYZ,EAAU,KAAK,EACjC,MAAM8lB,EAAa,CACf,YAAY9kB,EAAKjC,EAAQ,CACrB,KAAK,gBAAkB,KAAK,gBAAgB,KAAK,IAAI,EACrD,KAAK,eAAiB,KAAK,eAAe,KAAK,IAAI,EACnD,KAAK,QAAUiC,EAAI,cAAc,KAAK,EACtC,KAAK,QAAQ,UAAU,IAAIJ,GAAW,GACtC7B,EAAO,UAAU,mBAAmB,KAAK,OAAO,EAChD,KAAK,WAAaA,EAAO,UACzB,KAAK,OAASA,EAAO,MACrB,KAAK,QAAUA,EAAO,OACtB,KAAK,QAAQ,QAAQ,GAAG,SAAU,KAAK,eAAe,EACtD,MAAM+jB,EAAU9hB,EAAI,gBAAgBuD,GAAQ,KAAK,EACjDue,EAAQ,UAAU,IAAIliB,GAAU,GAAG,CAAC,EACpCkiB,EAAQ,MAAM,OAAS,wBAAwB/jB,EAAO,SAAS,IAC/D,KAAK,QAAQ,YAAY+jB,CAAO,EAChC,KAAK,SAAWA,EAChB,MAAMG,EAAWjiB,EAAI,gBAAgBuD,GAAQ,UAAU,EACvD,KAAK,SAAS,YAAY0e,CAAQ,EAClC,KAAK,UAAYA,EACjB,MAAM8C,EAAc/kB,EAAI,cAAc,KAAK,EAC3C+kB,EAAY,UAAU,IAAInlB,GAAU,GAAG,EAAGZ,EAAU,IAAI,EAAC,CAAE,EAC3D,KAAK,QAAQ,YAAY+lB,CAAW,EACpC,KAAK,aAAeA,EACpBhnB,EAAO,MAAM,QAAQ,GAAG,SAAU,KAAK,cAAc,EACrD,KAAK,MAAQA,EAAO,MACpB,KAAK,QAAO,CACf,CACD,IAAI,cAAe,CACf,OAAO,KAAK,QACf,CACD,SAAU,CACN,MAAMinB,EAAS,KAAK,SAAS,sBAAqB,EAC5CC,EAAW,KAAK,MAAM,SAAS,OAAS,EACxC/uB,EAAM,KAAK,OAAO,IAAI,UAAU,EAChCC,EAAM,KAAK,OAAO,IAAI,UAAU,EAChC+uB,EAAS,GACf,KAAK,MAAM,SAAS,QAAQ,CAAC/tB,EAAGmG,IAAU,CACtC,GAAInG,IAAM,OACN,OAEJ,MAAM0B,GAAI8gB,EAASrc,EAAO,EAAG2nB,EAAU,EAAGD,EAAO,KAAK,EAChDlsB,GAAI6gB,EAASxiB,EAAGjB,EAAKC,EAAK6uB,EAAO,OAAQ,CAAC,EAChDE,EAAO,KAAK,CAACrsB,GAAGC,EAAC,EAAE,KAAK,GAAG,CAAC,CAC5C,CAAa,EACD,KAAK,UAAU,eAAe,KAAM,SAAUosB,EAAO,KAAK,GAAG,CAAC,EAC9D,MAAMH,EAAc,KAAK,aACnBhoB,EAAQ,KAAK,MAAM,SAAS,KAAK,QAAQ,QAAQ,EACvD,GAAIA,IAAU,OAAW,CACrBgoB,EAAY,UAAU,OAAOnlB,GAAU,IAAK,GAAG,CAAC,EAChD,MACH,CACD,MAAMulB,EAAKxL,EAAS,KAAK,QAAQ,SAAU,EAAGsL,EAAU,EAAGD,EAAO,KAAK,EACjEI,EAAKzL,EAAS5c,EAAO7G,EAAKC,EAAK6uB,EAAO,OAAQ,CAAC,EACrDD,EAAY,MAAM,KAAO,GAAGI,CAAE,KAC9BJ,EAAY,MAAM,IAAM,GAAGK,CAAE,KAC7BL,EAAY,YAAc,GAAG,KAAK,WAAWhoB,CAAK,CAAC,GAC9CgoB,EAAY,UAAU,SAASnlB,GAAU,IAAK,GAAG,CAAC,IACnDmlB,EAAY,UAAU,IAAInlB,GAAU,IAAK,GAAG,EAAGA,GAAU,IAAK,IAAI,CAAC,EACnE4D,GAAYuhB,CAAW,EACvBA,EAAY,UAAU,OAAOnlB,GAAU,IAAK,IAAI,CAAC,EAExD,CACD,gBAAiB,CACb,KAAK,QAAO,CACf,CACD,iBAAkB,CACd,KAAK,QAAO,CACf,CACJ,CAED,MAAMylB,EAAmB,CACrB,YAAYrlB,EAAKjC,EAAQ,CAkBrB,GAjBA,KAAK,kBAAoB,KAAK,kBAAkB,KAAK,IAAI,EACzD,KAAK,mBAAqB,KAAK,mBAAmB,KAAK,IAAI,EAC3D,KAAK,oBAAsB,KAAK,oBAAoB,KAAK,IAAI,EAC7D,KAAK,oBAAsB,KAAK,oBAAoB,KAAK,IAAI,EAC7D,KAAK,kBAAoB,KAAK,kBAAkB,KAAK,IAAI,EACzD,KAAK,OAASA,EAAO,MACrB,KAAK,MAAQA,EAAO,MACpB,KAAK,UAAYA,EAAO,UACxB,KAAK,QAAUkD,EAAY,EAAE,EAC7B,KAAK,KAAO,IAAI6jB,GAAa9kB,EAAK,CAC9B,OAAQ,KAAK,QACb,UAAWjC,EAAO,UAClB,UAAWA,EAAO,UAClB,MAAO,KAAK,OACZ,MAAO,KAAK,MACZ,UAAW,KAAK,SAChC,CAAa,EACG,CAAC2F,GAAc1D,CAAG,EAClB,KAAK,KAAK,QAAQ,iBAAiB,YAAa,KAAK,iBAAiB,EACtE,KAAK,KAAK,QAAQ,iBAAiB,aAAc,KAAK,kBAAkB,MAEvE,CACD,MAAM4S,EAAK,IAAInB,GAAe,KAAK,KAAK,OAAO,EAC/CmB,EAAG,QAAQ,GAAG,OAAQ,KAAK,mBAAmB,EAC9CA,EAAG,QAAQ,GAAG,OAAQ,KAAK,mBAAmB,EAC9CA,EAAG,QAAQ,GAAG,KAAM,KAAK,iBAAiB,CAC7C,CACJ,CACD,oBAAqB,CACjB,KAAK,QAAQ,SAAW,EAC3B,CACD,kBAAkBtT,EAAI,CAClB,MAAM0lB,EAAS,KAAK,KAAK,QAAQ,sBAAqB,EACtD,KAAK,QAAQ,SAAW,KAAK,MAAMrL,EAASra,EAAG,QAAS,EAAG0lB,EAAO,MAAO,EAAG,KAAK,MAAM,SAAS,MAAM,CAAC,CAC1G,CACD,oBAAoB1lB,EAAI,CACpB,KAAK,oBAAoBA,CAAE,CAC9B,CACD,oBAAoBA,EAAI,CACpB,GAAI,CAACA,EAAG,KAAK,MAAO,CAChB,KAAK,QAAQ,SAAW,GACxB,MACH,CACD,KAAK,QAAQ,SAAW,KAAK,MAAMqa,EAASra,EAAG,KAAK,MAAM,EAAG,EAAGA,EAAG,KAAK,OAAO,MAAO,EAAG,KAAK,MAAM,SAAS,MAAM,CAAC,CACvH,CACD,mBAAoB,CAChB,KAAK,QAAQ,SAAW,EAC3B,CACJ,CAED,SAASgmB,GAAgBngB,EAAQ,CAC7B,MAAO,WAAYA,GAAU,CAACN,EAAQM,EAAO,MAAM,EAC7CA,EAAO,OACPuL,EAAsB,CAAC,CAChC,CACD,SAAS6U,GAAkBlgB,EAAM,CAC7B,IAAIrH,EACJ,OAAIqH,EAAK,MAAM,SAAS,SAAW,EACxB,IAAIsf,GAAoBtf,EAAK,SAAU,CAC1C,UAAWigB,GAAgBjgB,EAAK,MAAM,EACtC,MAAOA,EAAK,MACZ,UAAWA,EAAK,SAChC,CAAa,EAEE,IAAIif,GAAmBjf,EAAK,SAAU,CACzC,UAAWigB,GAAgBjgB,EAAK,MAAM,EACtC,WAAYrH,EAAKqH,EAAK,OAAO,aAAe,MAAQrH,IAAO,OAASA,EAAK6mB,GAAU,QAAQ,iBAC3F,MAAOxf,EAAK,MACZ,UAAWA,EAAK,SAC5B,CAAS,CACJ,CACD,SAASmgB,GAAmBngB,EAAM,CAC9B,IAAIrH,EAAIkK,EAAIpF,EACZ,OAAO,IAAIuiB,GAAmBhgB,EAAK,SAAU,CACzC,UAAWigB,GAAgBjgB,EAAK,MAAM,EACtC,WAAYrH,EAAKqH,EAAK,OAAO,aAAe,MAAQrH,IAAO,OAASA,EAAK6mB,GAAU,QAAQ,iBAC3F,MAAOzjB,EAAS,WAAW,CACvB,UAAW8G,EAAM,QAAS7C,EAAK,OAASA,EAAK,OAAO,IAAM,QAAW,MAAQ6C,IAAO,OAASA,EAAK,IAClG,UAAWpF,EAAM,QAASuC,EAAK,OAASA,EAAK,OAAO,IAAM,QAAW,MAAQvC,IAAO,OAASA,EAAK,CAClH,CAAa,EACD,MAAOuC,EAAK,MACZ,UAAWA,EAAK,SAC5B,CAAS,CACJ,CACD,SAASogB,GAAgBtgB,EAAQ,CAC7B,MAAO,SAAUA,GAAUA,EAAO,OAAS,OAC9C,CACD,MAAMugB,GAAsB,CACxB,GAAI,iBACJ,KAAM,UACN,OAAQ,CAAC3oB,EAAOoI,IAAW,CACvB,GAAI,OAAOpI,GAAU,SACjB,OAAO,KAEX,MAAMqI,EAAIjD,EACJZ,EAASa,EAAY+C,EAAQ,CAC/B,OAAQC,EAAE,SAAS,SACnB,UAAWA,EAAE,SAAS,OACtB,IAAKA,EAAE,SAAS,OAChB,IAAKA,EAAE,SAAS,OAChB,KAAMA,EAAE,SAAS,MACjC,CAAa,EACD,OAAO7D,EACD,CACE,aAAcxE,EACd,OAAQwE,CACX,EACC,IACT,EACD,QAAS,CACL,kBAAoB4D,GAAYsgB,GAAgBtgB,CAAM,EAAI,GAAK,EAC/D,OAASoP,GAAUhE,EACtB,EACD,WAAalL,GACLogB,GAAgBpgB,EAAK,MAAM,EACpBmgB,GAAmBngB,CAAI,EAE3BkgB,GAAkBlgB,CAAI,CAEzC,EAEUsgB,GAAsB,CACxB,GAAI,iBACJ,KAAM,UACN,OAAQ,CAAC5oB,EAAOoI,IAAW,CACvB,GAAI,OAAOpI,GAAU,SACjB,OAAO,KAEX,MAAMqI,EAAIjD,EACJZ,EAASa,EAAY+C,EAAQ,CAC/B,UAAWC,EAAE,SAAS,OACtB,UAAWA,EAAE,SAAS,OACtC,CAAa,EACD,OAAO7D,EACD,CACE,aAAcxE,EACd,OAAQwE,CACX,EACC,IACT,EACD,QAAS,CACL,OAASgT,GAAU3D,EACtB,EACD,WAAavL,GAAS,CAClB,IAAIrH,EACJ,MAAMjB,EAAQsI,EAAK,MAGnB,OAFkBtI,EAAM,SAAS,OAAS,GACrC,cAAesI,EAAK,QAAUA,EAAK,OAAO,UAEpC,IAAIif,GAAmBjf,EAAK,SAAU,CACzC,UAAW4e,GACX,WAAYjmB,EAAKqH,EAAK,OAAO,aAAe,MAAQrH,IAAO,OAASA,EAAK6mB,GAAU,QAAQ,iBAC3F,MAAO9nB,EACP,UAAWsI,EAAK,SACpC,CAAiB,EAEE,IAAIsf,GAAoBtf,EAAK,SAAU,CAC1C,UAAW4e,GACX,MAAOlnB,EACP,UAAWsI,EAAK,SAChC,CAAa,CACJ,CACT,EAEI,SAASugB,GAA6Bhb,EAAQvF,EAAM,CAChD,IAAIrH,EACJ,MAAMuD,EAASqJ,EAAO,OAAOvF,EAAK,OAAO,KAAM,EAAEA,EAAK,MAAM,EAC5D,GAAIR,EAAQtD,CAAM,EACd,OAAO,KAEX,MAAM6D,EAAIjD,EACJ0jB,EAAY,CACd,OAAQxgB,EAAK,OACb,aAAc9D,EAAO,aACrB,OAAQA,EAAO,MAC3B,EACcukB,EAASlb,EAAO,QAAQ,OAAOib,CAAS,EACxC3kB,EAAa0J,EAAO,QAAQ,WAC5BA,EAAO,QAAQ,WAAWib,CAAS,EACnC,OACA9oB,EAAQkE,EAAY6kB,EAAOvkB,EAAO,YAAY,EAAG,CACnD,WAAYL,EACZ,OAAQ0J,EAAO,QAAQ,MACnC,CAAS,EACKhD,EAAU,IAAIme,GAAa,CAC7B,OAAQD,EACR,OAAQzgB,EAAK,OACb,MAAOtI,EACP,OAAQ6N,EAAO,QAAQ,OAAOib,CAAS,CACnD,CAAS,EACK7iB,EAAWoC,EAAE,SAAS,QAAQC,EAAK,OAAO,QAAQ,EAAE,MACpD2gB,EAAS5gB,EAAE,SAAS,QAAQC,EAAK,OAAO,MAAM,EAAE,MAChDzI,GAAagO,EAAO,WAAW,CACjC,WAAY1J,EACZ,SAAUmE,EAAK,SACf,aAAc9D,EAAO,aACrB,OAAQA,EAAO,OACf,MAAOqG,EAAQ,MACf,UAAWhF,GAAU,OAAO,CACxB,SAAUI,EACV,OAAQgjB,CACxB,CAAa,CACb,CAAS,EACD,OAAO,IAAIjf,GAAuB1B,EAAK,SAAU,CAC7C,QAASuC,EACT,MAAOrC,GAAa,EACpB,MAAOnE,EAAS,WAAW,CACvB,MAAO,UAAWiE,EAAK,QAChBrH,EAAKoH,EAAE,SAAS,OAAOC,EAAK,OAAO,KAAK,EAAE,SAAW,MAAQrH,IAAO,OAASA,EAAK,KACnFqH,EAAK,OAAO,GAClC,CAAa,EACD,gBAAiBzI,EAC7B,CAAS,CACJ,CAED,SAASqpB,GAAahiB,EAAU6G,EAAU,CACtC,OAAOA,IAAa,EACd,IAAIob,GACJ,IAAIC,GAAeliB,EAAU6G,GAAsD+Z,GAAU,QAAQ,eAAe,CAC7H,CACD,SAASuB,GAA+Bxb,EAAQvF,EAAM,CAClD,IAAIrH,EAAIkK,EAAIpF,EACZ,MAAM,EAAIX,EACJZ,EAASqJ,EAAO,OAAOvF,EAAK,OAAO,KAAM,EAAEA,EAAK,MAAM,EAC5D,GAAIR,EAAQtD,CAAM,EACd,OAAO,KAEX,MAAM8kB,EAAc,CAChB,OAAQhhB,EAAK,OACb,aAAc9D,EAAO,aACrB,OAAQA,EAAO,MAC3B,EACcukB,EAASlb,EAAO,QAAQ,OAAOyb,CAAW,EAC1Cpb,GAAc/C,GAAMlK,EAAK,EAAE,SAAS,OAAOqH,EAAK,OAAO,UAAU,EAAE,SAAW,MAAQrH,IAAO,OAASA,EAAM4M,EAAO,QAAQ,mBAC7HA,EAAO,QAAQ,kBAAkBrJ,EAAO,MAAM,KAAQ,MAAQ2G,IAAO,OAASA,EAAK,EACjF4C,EAAW,EAAE,SAAS,OAAOzF,EAAK,OAAO,QAAQ,EAAE,MACnDuC,EAAU,IAAI0e,GAAe,CAC/B,OAAQR,EACR,OAAQzgB,EAAK,OACb,OAAQ4gB,GAAa5gB,EAAK,SAAUyF,CAAQ,EAC5C,MAAOyb,GAAiBtb,CAAU,CAC9C,CAAS,EACKjI,GAAW,EAAE,SAAS,QAAQqC,EAAK,OAAO,QAAQ,EAAE,MACpD2gB,GAAS,EAAE,SAAS,QAAQ3gB,EAAK,OAAO,MAAM,EAAE,MAChDzI,GAAagO,EAAO,WAAW,CACjC,SAAUvF,EAAK,SACf,OAAQ9D,EAAO,OACf,MAAOqG,EAAQ,MACf,UAAWhF,GAAU,OAAO,CACxB,SAAUI,GACV,OAAQgjB,EACxB,CAAa,CACb,CAAS,EACD,OAAO,IAAI/e,GAAyB5B,EAAK,SAAU,CAC/C,QAASuC,EACT,MAAOrC,GAAa,EACpB,MAAOnE,EAAS,WAAW,CACvB,MAAO,UAAWiE,EAAK,QAChBvC,EAAK,EAAE,SAAS,OAAOuC,EAAK,OAAO,KAAK,EAAE,SAAW,MAAQvC,IAAO,OAASA,EAAK,KACnFuC,EAAK,OAAO,GAClC,CAAa,EACD,gBAAiBzI,EAC7B,CAAS,CACJ,CAED,MAAM4pB,EAAW,CACb,aAAc,CACV,KAAK,YAAc,CACf,OAAQ,CAAE,EACV,OAAQ,CAAE,EACV,SAAU,CAAE,CAC5B,CACS,CACD,QAAS,CACL,MAAO,CACH,GAAG,KAAK,YAAY,OACpB,GAAG,KAAK,YAAY,OACpB,GAAG,KAAK,YAAY,QACpC,CACS,CACD,SAAS7a,EAAG,CACJA,EAAE,OAAS,QACX,KAAK,YAAY,OAAO,QAAQA,CAAC,EAE5BA,EAAE,OAAS,QAChB,KAAK,YAAY,OAAO,QAAQA,CAAC,EAE5BA,EAAE,OAAS,WAChB,KAAK,YAAY,SAAS,QAAQA,CAAC,CAE1C,CACD,YAAY1H,EAAUpH,EAAQsI,EAAQ,CAClC,MAAM5E,EAAe1D,EAAO,OAC5B,GAAIgI,EAAQtE,CAAY,EACpB,MAAM,IAAIzC,EAAQ,CACd,QAAS,CACL,IAAKjB,EAAO,GACf,EACD,KAAM,sBAC1B,CAAiB,EAEL,MAAM0K,EAAK,KAAK,YAAY,OAAO,OAAO,CAAChG,EAAQqJ,IAAWrJ,GAAgDqkB,GAA6Bhb,EAAQ,CAC/I,SAAU3G,EACV,OAAQpH,EACR,OAAQsI,CACxB,CAAa,EAAG,IAAI,EACR,GAAIoC,EACA,OAAOA,EAEX,MAAM,IAAIzJ,EAAQ,CACd,QAAS,CACL,IAAKjB,EAAO,GACf,EACD,KAAM,sBACtB,CAAa,CACJ,CACD,cAAcoH,EAAUpH,EAAQsI,EAAQ,CACpC,MAAMoC,EAAK,KAAK,YAAY,SAAS,OAAO,CAAChG,EAAQqJ,IAAWrJ,GAAgD6kB,GAA+Bxb,EAAQ,CACnJ,SAAU3G,EACV,OAAQkB,EACR,OAAQtI,CACxB,CAAa,EAAG,IAAI,EACR,GAAI0K,EACA,OAAOA,EAEX,MAAM,IAAIzJ,EAAQ,CACd,QAAS,CACL,IAAKjB,EAAO,GACf,EACD,KAAM,sBACtB,CAAa,CACJ,CACD,YAAYoH,EAAUkB,EAAQ,CAC1B,MAAMoC,EAAK,KAAK,YAAY,OAAO,OAAO,CAAChG,EAAQqJ,IAAWrJ,GAAgDklB,GAAsB7b,EAAQ,CACxI,SAAU3G,EACV,OAAQkB,CACxB,CAAa,EAAG,IAAI,EACR,GAAI,CAACoC,EACD,MAAM,IAAIzJ,EAAQ,CACd,KAAM,iBACN,QAAS,CACL,OAAQqH,CACX,CACrB,CAAiB,EAEL,OAAOoC,CACV,CACD,eAAeA,EAAI,CACf,GAAIA,aAAcR,GACd,OAAO,IAAID,GAAgBS,CAAE,EAEjC,GAAIA,aAAcN,GACd,OAAO,IAAID,GAAkBO,CAAE,EAEnC,GAAIA,aAAcsB,GACd,OAAO,IAAI1B,GAAQI,EAAI,IAAI,EAE/B,MAAMvM,EAAM,KAAK,YAAY,OAAO,OAAO,CAACuG,EAAQqJ,IAAWrJ,GAAgDqJ,EAAO,IAAI,CACtH,WAAYrD,EACZ,KAAM,IACtB,CAAa,EAAG,IAAI,EACR,GAAI,CAACvM,EACD,MAAM8C,EAAQ,oBAElB,OAAO9C,CACV,CACJ,CAED,SAAS0rB,IAA0B,CAC/B,MAAMC,EAAO,IAAIH,GACjB,OACII,GACAtD,GACAQ,GACAE,GACAxC,GACAqF,GACAxG,GACAyG,GACAxS,GACAsQ,GACAe,GACAD,GACAxgB,GACA6hB,GACAC,GACAC,EACZ,EAAU,QAAS7hB,GAAM,CACbuhB,EAAK,SAASvhB,CAAC,CAC3B,CAAS,EACMuhB,CACV,CAED,SAASO,GAAmBnqB,EAAO,CAC/B,OAAO0kB,GAAQ,SAAS1kB,CAAK,EACvB,IAAI0kB,GAAQ1kB,EAAM,EAAGA,EAAM,CAAC,EAC5B,IAAI0kB,EACb,CACD,SAAS0F,GAAatqB,EAAQE,EAAO,CACjCF,EAAO,cAAc,IAAKE,EAAM,CAAC,EACjCF,EAAO,cAAc,IAAKE,EAAM,CAAC,CACpC,CAED,SAASqmB,GAA0Bje,EAAQ5E,EAAc,CACrD,GAAI,CAAC4E,EACD,OAEJ,MAAMiP,EAAc,GACdyI,EAAKoE,GAAqB9b,EAAQ5E,CAAY,EAChDsc,GACAzI,EAAY,KAAKyI,CAAE,EAEvB,MAAMuK,EAAKlG,GAAsB/b,CAAM,EACvC,OAAIiiB,GACAhT,EAAY,KAAKgT,CAAE,EAEhB,IAAI7F,GAAoBnN,CAAW,CAC7C,CACD,SAASiT,GAAiBliB,EAAQ5E,EAAc,CAC5C,OAAO,IAAIogB,GAAkB,CACzB,SAAUe,GACV,WAAY,CACR0B,GAA0B,MAAOje,EAASA,EAAO,EAAI,OAAW5E,EAAa,CAAC,EAC9E6iB,GAA0B,MAAOje,EAASA,EAAO,EAAI,OAAW5E,EAAa,CAAC,CACjF,CACb,CAAS,CACJ,CACD,SAAS+mB,GAA6BpmB,EAAYP,EAAU,CACxD,KAAM,CAACzK,EAAKC,CAAG,EAAI+K,EAAakgB,GAAgBlgB,CAAU,EAAI,GAC9D,GAAI,CAAC2D,EAAQ3O,CAAG,GAAK,CAAC2O,EAAQ1O,CAAG,EAC7B,OAAO,KAAK,IAAI,KAAK,IAAID,GAAuC,CAAC,EAAG,KAAK,IAAIC,GAAuC,CAAC,CAAC,EAE1H,MAAMmb,EAAOyC,GAAY7S,CAAU,EACnC,OAAO,KAAK,IAAI,KAAK,IAAIoQ,CAAI,EAAI,GAAI,KAAK,IAAI3Q,CAAQ,EAAI,EAAE,CAC/D,CACD,SAAS4mB,GAAoBhnB,EAAcW,EAAY,CACnD,MAAMsmB,EAAKtmB,aAAsByf,GAC3Bzf,EAAW,WAAW,CAAC,EACvB,OACAumB,EAAKvmB,aAAsByf,GAC3Bzf,EAAW,WAAW,CAAC,EACvB,OACAwmB,EAAKJ,GAA6BE,EAAIjnB,EAAa,CAAC,EACpDonB,EAAKL,GAA6BG,EAAIlnB,EAAa,CAAC,EAC1D,OAAO,KAAK,IAAImnB,EAAIC,CAAE,CACzB,CACD,SAASC,GAAWrnB,EAAcW,EAAY,CAC1C,MAAO,CACH,SAAU6S,GAAY7S,CAAU,EAChC,WAAYA,EACZ,UAAWE,EAAS,WAAW,CAC3B,cAAeymB,GAAyB3mB,EAAYX,CAAY,EAChE,UAAWmQ,EAAsBoD,GAAyB5S,EAAYX,CAAY,CAAC,CACnG,CAAa,CACb,CACK,CACD,SAASunB,GAAc3iB,EAAQ,CAC3B,GAAI,EAAE,MAAOA,GACT,MAAO,GAEX,MAAM4iB,EAAU5iB,EAAO,EACvB,OAAK4iB,GAGE,aAAcA,EAAU,CAAC,CAACA,EAAQ,SAF9B,EAGd,CACD,MAAMnB,GAAqB,CACvB,GAAI,gBACJ,KAAM,QACN,OAAQ,CAAC7pB,EAAOoI,IAAW,CACvB,GAAI,CAACsc,GAAQ,SAAS1kB,CAAK,EACvB,OAAO,KAEX,MAAMqI,EAAIjD,EACJZ,EAASa,EAAY+C,EAAQ,CAC/B,SAAUC,EAAE,SAAS,QACrB,OAAQA,EAAE,SAAS,OAAOkO,EAAiB,EAC3C,EAAGlO,EAAE,SAAS,OAAO4iB,EAAyB,EAC9C,EAAG5iB,EAAE,SAAS,OAAO,CACjB,SAAUA,EAAE,SAAS,QACrB,IAAKA,EAAE,SAAS,OAChB,IAAKA,EAAE,SAAS,OAChB,KAAMA,EAAE,SAAS,MACrC,CAAiB,CACjB,CAAa,EACD,OAAO7D,EACD,CACE,aAAcxE,EACd,OAAQwE,CACX,EACC,IACT,EACD,QAAS,CACL,OAASgT,GAAU2S,GACnB,WAAa7hB,GAASgiB,GAAiBhiB,EAAK,OAAQA,EAAK,YAAY,EACrE,OAAQoc,GAAQ,OAChB,OAASlN,GAAU4S,EACtB,EACD,WAAa9hB,GAAS,CAClB,MAAMrF,EAAMqF,EAAK,SACXtI,EAAQsI,EAAK,MACbsF,EAAItF,EAAK,WACf,GAAI,EAAEsF,aAAagW,IACf,MAAM7iB,EAAQ,oBAElB,MAAMV,EAAW,aAAciI,EAAK,OAASA,EAAK,OAAO,SAAW,OAC9D4iB,EAAS,WAAY5iB,EAAK,OAASA,EAAK,OAAO,OAAS,OAC9D,OAAO,IAAIqd,GAAkB1iB,EAAK,CAC9B,KAAM,CACF4nB,GAAW7qB,EAAM,SAAS,EAAG4N,EAAE,WAAW,CAAC,CAAC,EAC5Cid,GAAW7qB,EAAM,SAAS,EAAG4N,EAAE,WAAW,CAAC,CAAC,CAC/C,EACD,SAAUvN,GAAsD,GAChE,SAAU0qB,GAAcziB,EAAK,MAAM,EACnC,SAAUkiB,GAAoBxqB,EAAM,SAAU4N,CAAC,EAC/C,OAAQ2F,GACR,aAAc2X,GAAgD,QAC9D,MAAOlrB,EACP,UAAWsI,EAAK,SAChC,CAAa,CACJ,CACT,EAEI,MAAM6iB,WAAgB3pB,CAAS,CAC3B,YAAY3B,EAAY,CACpB,MAAMA,CAAU,EAChB,KAAK,SAAW,IAAI8D,EACpB,KAAK,YAAY,gBAAgB,MAAM,QAAQ,GAAG,SAAWpB,GAAO,CAChE,KAAK,SAAS,KAAK,SAAU,CACzB,MAAO,IAAIxC,EAAc,KAAMwC,EAAG,QAAQ,CAC9D,CAAiB,CACjB,CAAa,CACJ,CACD,IAAI,OAAQ,CACR,OAAO,KAAK,YAAY,MAAM,IAAI,OAAO,CAC5C,CACD,IAAI,MAAMd,EAAO,CACb,KAAK,YAAY,MAAM,IAAI,QAASA,CAAK,CAC5C,CACD,IAAI,SAAU,CACV,OAAO,KAAK,YAAY,gBAAgB,MAAM,IAAI,SAAS,CAC9D,CACD,IAAI,QAAQoC,EAAS,CACjB,KAAK,YAAY,gBAAgB,MAAM,IAAI,UAAWA,CAAO,CAChE,CACD,IAAI,OAAQ,CACR,OAAO,KAAK,YAAY,gBAAgB,MAAM,QACjD,CACD,IAAI,MAAM7D,EAAO,CACb,KAAK,YAAY,gBAAgB,MAAM,SAAWA,CACrD,CACD,GAAG2B,EAAWE,EAAS,CACnB,MAAMD,EAAKC,EAAQ,KAAK,IAAI,EAC5B,YAAK,SAAS,GAAGF,EAAYY,GAAO,CAChCX,EAAGW,EAAG,KAAK,CAC3B,CAAa,EACM,IACV,CACJ,CAED,MAAM6oB,WAAkB5pB,CAAS,CAC7B,YAAY3B,EAAY,CACpB,MAAMA,CAAU,EAChB,KAAK,SAAW,IAAI8D,EACpB,KAAK,YAAY,gBAAgB,MAAM,QAAQ,GAAG,SAAWpB,GAAO,CAChE,KAAK,SAAS,KAAK,SAAU,CACzB,MAAO,IAAIxC,EAAc,KAAMwC,EAAG,QAAQ,CAC9D,CAAiB,CACjB,CAAa,CACJ,CACD,IAAI,OAAQ,CACR,OAAO,KAAK,YAAY,MAAM,IAAI,OAAO,CAC5C,CACD,IAAI,MAAMd,EAAO,CACb,KAAK,YAAY,MAAM,IAAI,QAASA,CAAK,CAC5C,CACD,IAAI,UAAW,CACX,OAAO,KAAK,YAAY,gBAAgB,iBAAiB,MAAM,IAAI,UAAU,CAChF,CACD,IAAI,SAASka,EAAU,CACnB,KAAK,YAAY,gBAAgB,iBAAiB,MAAM,IAAI,WAAYA,CAAQ,CACnF,CACD,IAAI,UAAW,CACX,OAAO,KAAK,YAAY,gBAAgB,iBAAiB,MAAM,IAAI,UAAU,CAChF,CACD,IAAI,SAAS0P,EAAU,CACnB,KAAK,YAAY,gBAAgB,iBAAiB,MAAM,IAAI,WAAYA,CAAQ,CACnF,CACD,IAAI,OAAQ,CACR,OAAO,KAAK,YAAY,gBAAgB,MAAM,QACjD,CACD,IAAI,MAAMrrB,EAAO,CACb,KAAK,YAAY,gBAAgB,MAAM,SAAWA,CACrD,CACD,GAAG2B,EAAWE,EAAS,CACnB,MAAMD,EAAKC,EAAQ,KAAK,IAAI,EAC5B,YAAK,SAAS,GAAGF,EAAYY,GAAO,CAChCX,EAAGW,EAAG,KAAK,CAC3B,CAAa,EACM,IACV,CACJ,CAED,MAAM+oB,WAAgB9pB,CAAS,CAC3B,YAAY3B,EAAY,CACpB,MAAMA,CAAU,EAChB,KAAK,SAAW,IAAI8D,EACpB,KAAK,YAAY,gBAAgB,MAAM,QAAQ,GAAG,SAAWpB,GAAO,CAChE,KAAK,SAAS,KAAK,SAAU,CACzB,MAAO,IAAIxC,EAAc,KAAMwC,EAAG,QAAQ,CAC9D,CAAiB,CACjB,CAAa,CACJ,CACD,IAAI,OAAQ,CACR,OAAO,KAAK,YAAY,MAAM,IAAI,OAAO,CAC5C,CACD,IAAI,MAAMd,EAAO,CACb,KAAK,YAAY,MAAM,IAAI,QAASA,CAAK,CAC5C,CACD,IAAI,WAAY,CACZ,OAAO,KAAK,YAAY,gBAAgB,MAAM,IAAI,WAAW,CAChE,CACD,IAAI,UAAUkU,EAAW,CACrB,KAAK,YAAY,gBAAgB,MAAM,IAAI,YAAaA,CAAS,CACpE,CACD,IAAI,OAAQ,CACR,OAAO,KAAK,YAAY,gBAAgB,MAAM,QACjD,CACD,IAAI,MAAM3V,EAAO,CACb,KAAK,YAAY,gBAAgB,MAAM,SAAWA,CACrD,CACD,GAAG2B,EAAWE,EAAS,CACnB,MAAMD,EAAKC,EAAQ,KAAK,IAAI,EAC5B,YAAK,SAAS,GAAGF,EAAYY,GAAO,CAChCX,EAAGW,EAAG,KAAK,CAC3B,CAAa,EACM,IACV,CACJ,CAED,MAAMgpB,GAAmB,UAAY,CACjC,MAAO,CACH,GAAI,OACJ,KAAM,QACN,OAAOnjB,EAAQ,CACX,MAAMC,EAAIjD,EACJZ,EAASa,EAAY+C,EAAQ,CAC/B,QAASC,EAAE,SAAS,OAAOmjB,EAAgB,EAC3C,MAAOnjB,EAAE,SAAS,IAClB,KAAMA,EAAE,SAAS,SAAS,MAAM,EAChC,MAAOA,EAAE,SAAS,MACtC,CAAiB,EACD,OAAO7D,EAAS,CAAE,OAAQA,CAAM,EAAK,IACxC,EACD,WAAW8D,EAAM,CACb,MAAMgP,EAAK,IAAIX,GAAeH,GAAqBlO,EAAK,OAAO,OAAO,CAAC,EACjEtI,EAAQkE,EAAYoE,EAAK,OAAO,MAAO,CACzC,WAAYgP,CAChC,CAAiB,EACKmU,EAAK,IAAIhU,GAAenP,EAAK,SAAU,CACzC,MAAO,IAAIjE,EAAS,CAChB,QAASiT,EAAG,OAAO,MAAM,SAAS,CAC1D,CAAqB,EACD,MAAOtX,EACP,UAAWsI,EAAK,SACpC,CAAiB,EACD,OAAO,IAAIiE,GAAuBjE,EAAK,SAAU,CAC7C,MAAOA,EAAK,MACZ,MAAOjE,EAAS,WAAW,CACvB,MAAOiE,EAAK,OAAO,KAC3C,CAAqB,EACD,gBAAiBmjB,CACrC,CAAiB,CACJ,EACD,IAAInjB,EAAM,CAIN,MAHI,EAAEA,EAAK,sBAAsBiE,KAG7B,EAAEjE,EAAK,WAAW,2BAA2BmP,IACtC,KAEJ,IAAI0T,GAAQ7iB,EAAK,UAAU,CACrC,CACb,CACA,IAKI,SAASojB,GAAiBC,EAAS,CAC/B,OAAOA,EAAQ,OAAO,CAACnnB,EAAQ1E,IACpB,OAAO,OAAO0E,EAAQ,CACzB,CAAC1E,EAAO,SAAS,EAAGA,EAAO,KAAM,CACjD,CAAa,EACF,CAAE,EACR,CAID,SAAS8rB,GAAiBC,EAAUC,EAAQ,CACxCD,EAAS,QAAShhB,GAAY,CAC1B,MAAM7K,EAAQ8rB,EAAOjhB,EAAQ,OAAO,SAAS,EACzC7K,IAAU,QACV6K,EAAQ,OAAOA,EAAQ,OAAQA,EAAQ,OAAO7K,CAAK,CAAC,CAEpE,CAAS,CACJ,CAED,MAAM+rB,WAAgBjhB,EAAU,CAI5B,YAAYjL,EAAY+pB,EAAM,CAC1B,MAAM/pB,EAAY+pB,CAAI,CACzB,CACD,IAAI,SAAU,CACV,OAAO,KAAK,YAAY,KAAK,OAChC,CAKD,aAAakC,EAAQ,CACjB,MAAMD,EAAW,KAAK,YAAY,eAAe,KAC5C,KAAK7hB,EAAsB,EAC3B,IAAKgiB,GACCA,EAAI,OACd,EACDJ,GAAiBC,EAAUC,CAAM,EACjC,KAAK,QAAO,CACf,CAKD,cAAe,CACX,MAAMH,EAAU,KAAK,YAAY,eAAe,KAC3C,KAAK3hB,EAAsB,EAC3B,IAAKgiB,GACCA,EAAI,QAAQ,MACtB,EACD,OAAON,GAAiBC,CAAO,CAClC,CAID,SAAU,CAEN,KAAK,YAAY,eAAe,KAC3B,KAAK3hB,EAAsB,EAC3B,QAASgiB,GAAQ,CAClBA,EAAI,QAAQ,MAC5B,CAAa,EAED,KAAK,YAAY,eAAe,KAC3B,KAAK9hB,EAAwB,EAC7B,QAAS+hB,GAAQ,CAClBA,EAAI,QAAQ,MAC5B,CAAa,CACJ,CACJ,CAED,MAAMC,WAAuB9f,EAAiB,CAC1C,YAAYnJ,EAAKjC,EAAQ,CACrB,MAAMiC,EAAK,CACP,SAAUjC,EAAO,SACjB,MAAOA,EAAO,MACd,MAAOA,EAAO,MACd,KAAM,GACN,UAAWA,EAAO,SAClC,CAAa,CACJ,CACJ,CAED,MAAMmrB,GAAoB,CACtB,GAAI,SACJ,KAAM,QACN,OAAO/jB,EAAQ,CACX,MAAMC,EAAIjD,EACJZ,EAASa,EAAY+C,EAAQ,CAC/B,IAAKC,EAAE,SAAS,OAChB,IAAKA,EAAE,SAAS,OAChB,KAAMA,EAAE,SAAS,SAAS,QAAQ,EAClC,OAAQA,EAAE,SAAS,SACnB,MAAOA,EAAE,SAAS,OAClB,MAAOA,EAAE,SAAS,MAClC,CAAa,EACD,OAAO7D,EAAS,CAAE,OAAQA,CAAM,EAAK,IACxC,EACD,WAAW8D,EAAM,CACb,IAAIrH,EAAIkK,EACR,MAAM3H,GAAgBvC,EAAKqH,EAAK,OAAO,SAAW,MAAQrH,IAAO,OAASA,EAAK,EACzEqjB,EAAM,IAAI5E,GAAwB,CACpC,IAAKpX,EAAK,OAAO,IACjB,IAAKA,EAAK,OAAO,GACjC,CAAa,EACK8jB,EAAK,IAAIC,GAAqB/jB,EAAK,SAAU,CAC/C,SAAU,EACV,OAAQiL,GACR,YAAa,IAAIlP,EAAS,CACtB,SAAUigB,EAAI,OAAO,MAAM,KAAK,EAChC,SAAUA,EAAI,OAAO,MAAM,KAAK,CACpD,CAAiB,EACD,UAAWjgB,EAAS,WAAW,CAC3B,cAAeymB,GAAyB,OAAWtnB,CAAY,EAC/D,WAAY2H,EAAK7C,EAAK,OAAO,UAAY,MAAQ6C,IAAO,OAASA,EAAKmhB,EAC1F,CAAiB,EACD,MAAOpoB,EAAYV,EAAc,CAC7B,WAAY8gB,CAChC,CAAiB,EACD,UAAWhc,EAAK,SAChC,CAAa,EACD,OAAO,IAAIiE,GAAuBjE,EAAK,SAAU,CAC7C,MAAOA,EAAK,MACZ,MAAOjE,EAAS,WAAW,CACvB,MAAOiE,EAAK,OAAO,KACvC,CAAiB,EACD,gBAAiB8jB,CACjC,CAAa,CACJ,EACD,IAAI9jB,EAAM,CAIN,MAHI,EAAEA,EAAK,sBAAsBiE,KAG7B,EAAEjE,EAAK,WAAW,2BAA2B+jB,IACtC,KAEJ,IAAIjB,GAAU9iB,EAAK,UAAU,CACvC,CACT,EAEUikB,GAAmB,UAAY,CACjC,MAAO,CACH,GAAI,OACJ,KAAM,QACN,OAAOnkB,EAAQ,CACX,MAAMC,EAAIjD,EACJZ,EAASa,EAAY+C,EAAQ,CAC/B,MAAOC,EAAE,SAAS,SAClB,MAAOA,EAAE,SAAS,IAClB,KAAMA,EAAE,SAAS,SAAS,MAAM,EAChC,OAAQA,EAAE,SAAS,SACnB,MAAOA,EAAE,SAAS,MACtC,CAAiB,EACD,OAAO7D,EAAS,CAAE,OAAQA,CAAM,EAAK,IACxC,EACD,WAAW8D,EAAM,CACb,IAAIrH,EACJ,MAAMwqB,EAAK,IAAIjK,GAAelZ,EAAK,SAAU,CACzC,OAAQA,EAAK,OAAO,MACpB,MAAOjE,EAAS,WAAW,CACvB,WAAYpD,EAAKqH,EAAK,OAAO,UAAY,MAAQrH,IAAO,OAASA,EAAO7G,GAAM,OAAOA,CAAC,CAC9G,CAAqB,EACD,MAAO8J,EAAYoE,EAAK,OAAO,KAAK,EACpC,UAAWA,EAAK,SACpC,CAAiB,EACD,OAAO,IAAIiE,GAAuBjE,EAAK,SAAU,CAC7C,MAAOA,EAAK,MACZ,MAAOjE,EAAS,WAAW,CACvB,MAAOiE,EAAK,OAAO,KAC3C,CAAqB,EACD,gBAAiBmjB,CACrC,CAAiB,CACJ,EACD,IAAInjB,EAAM,CAIN,MAHI,EAAEA,EAAK,sBAAsBiE,KAG7B,EAAEjE,EAAK,WAAW,2BAA2BkZ,IACtC,KAEJ,IAAI8J,GAAQhjB,EAAK,UAAU,CACrC,CACb,CACA,IAEI,SAASkkB,GAA4BvpB,EAAK,CACtC,MAAML,EAAOK,EAAI,cAAc,KAAK,EACpC,OAAAL,EAAK,UAAU,IAAIX,EAAU,KAAK,EAAG,GACjCgB,EAAI,MACJA,EAAI,KAAK,YAAYL,CAAI,EAEtBA,CACV,CACD,SAAS6pB,GAAWxpB,EAAKypB,EAAIC,EAAK,CAC9B,GAAI1pB,EAAI,cAAc,uBAAuBypB,CAAE,GAAG,EAC9C,OAEJ,MAAME,EAAY3pB,EAAI,cAAc,OAAO,EAC3C2pB,EAAU,QAAQ,QAAUF,EAC5BE,EAAU,YAAcD,EACxB1pB,EAAI,KAAK,YAAY2pB,CAAS,CACjC,CAID,MAAMC,WAAad,EAAQ,CACvB,YAAYe,EAAY,CACpB,IAAI7rB,EAAIkK,EACR,MAAMnK,EAAS8rB,GAA4D,GACrE7pB,GAAOhC,EAAKD,EAAO,YAAc,MAAQC,IAAO,OAASA,EAAK2F,GAAiB,EAC/EgjB,EAAOD,KACPoD,EAAiB,IAAIb,GAAejpB,EAAK,CAC3C,SAAUjC,EAAO,SACjB,MAAOwH,GAAa,EACpB,MAAOnE,EAAS,WAAW,CACvB,MAAOrD,EAAO,KAClC,CAAiB,EACD,UAAW6E,GAAU,OAAQ,CAC7C,CAAa,EACD,MAAMknB,EAAgBnD,CAAI,EAC1B,KAAK,MAAQA,EACb,KAAK,gBAAkBze,EAAKnK,EAAO,aAAe,MAAQmK,IAAO,OAASA,EAAKqhB,GAA4BvpB,CAAG,EAC9G,KAAK,eAAe,YAAY,KAAK,OAAO,EAC5C,KAAK,KAAOA,EACZ,KAAK,oBAAsB,CAACjC,EAAO,UACnC,KAAK,qBAAoB,CAC5B,CACD,IAAI,UAAW,CACX,GAAI,CAAC,KAAK,KACN,MAAMD,EAAQ,kBAElB,OAAO,KAAK,IACf,CACD,SAAU,CACN,MAAMisB,EAAgB,KAAK,eAC3B,GAAI,CAACA,EACD,MAAMjsB,EAAQ,kBAElB,GAAI,KAAK,oBAAqB,CAC1B,MAAMksB,EAAaD,EAAc,cAC7BC,GACAA,EAAW,YAAYD,CAAa,CAE3C,CACD,KAAK,eAAiB,KACtB,KAAK,KAAO,KACZ,MAAM,QAAO,CAChB,CACD,eAAeE,EAAQ,EACH,WAAYA,EACtB,CAACA,EAAO,MAAM,EACd,YAAaA,EACTA,EAAO,QACP,IACF,QAAS7kB,GAAM,CACnB,KAAK,MAAM,SAASA,CAAC,EACrB,KAAK,kBAAkBA,CAAC,CACxC,CAAa,CACJ,CACD,kBAAkBwF,EAAQ,CAClBA,EAAO,KACP4e,GAAW,KAAK,SAAU,UAAU5e,EAAO,EAAE,GAAIA,EAAO,GAAG,CAElE,CACD,sBAAuB,CAEnB4e,GAAW,KAAK,SAAU,UAAW,47vBAA47vB,EACj+vB,KAAK,MAAM,OAAQ,EAAC,QAAS5e,GAAW,CACpC,KAAK,kBAAkBA,CAAM,CAC7C,CAAa,EACD,KAAK,eAAe,CAChB,QAAS,CACLse,GACAZ,GACArB,GACAqC,EACH,CACjB,CAAa,CACJ,CACJ,CAED,MAAMY,GAAU,IAAI3tB,EAAO,QAAQ,EAEnCD,EAAQ,SAAWiC,EACnBjC,EAAQ,UAAYgC,EACpBhC,EAAQ,UAAYuL,GACpBvL,EAAQ,gBAAkBwK,GAC1BxK,EAAQ,QAAU4rB,GAClB5rB,EAAQ,kBAAoB0K,GAC5B1K,EAAQ,KAAOstB,GACfttB,EAAQ,aAAeiN,GACvBjN,EAAQ,UAAY6rB,GACpB7rB,EAAQ,OAAS0N,GACjB1N,EAAQ,WAAa6N,GACrB7N,EAAQ,QAAU+rB,GAClB/rB,EAAQ,cAAgBQ,EACxBR,EAAQ,QAAU4tB,GAElB,OAAO,eAAe5tB,EAAS,aAAc,CAAE,MAAO,EAAI,CAAE,CAEhE,sCC78Oe,MAAM6tB,EAAI,CACrB,aAAc,CACV,KAAK,KAAO,IAAIP,OACnB,CAEL,k3BCAe,GAAMQ,YAInB,OAEE,IAAK,IAAM,GAAItuB,KACf,MAAK,KAAQ,IAAK,MAAI,KAGtB,QAAK,IAAU,IAAI,GAGnBuuB,GAAA,WAAO,sBAAoB,sBAAE,MAAMC,EAAW,CAC5C,IAA2B,CAAO,KAClC,KAAK,MAAQ,IAAIA,EAAO,MAAMC,EAAO,CACrC,KAAK,UAEL,IAAK,gBACLnvB,OAAc,OAAW,aAAc,CAAM,EACnD,CAAK,EASH,SAAgBovB,CAAU,CAExB,YACA,CAAOhU,EAAI,CACT,IAAK,UACLiU,IAAgB,GAAK,OAAO,eAAc,QAAO,CACjD,MACF,cACkB,QAAK,QAAO,WAAc,QAC1C,OACF,cACEA,MAAgB,CAAK,OAAO,eAAc,6BAE3C,CACD,sBAAsB,QAAM,eAG5B,KAAIC,CAEJ,qBACO,EACH,MAAMC,EAAa,MAAK,uBAAwBC,CAAI,KACrC,wBAAyB,UAC3B,CAAI,MACA,aAGjB,CAAK,MAAM,eAAeF,EAAc,OAAK,OAAS,cAEnD,OACH,UAAe,CAAK,uBAA0B,EAC9CA,KAAe,sBAAyB,KAAKG,CAAM,IACnD,OAAK,aAAM,KAAeH,CAAc,OAAK,OAAS,cAEnD,QACH,SAAQ,YAAAI,QAAgB,EAAAC,KAAY,eAAK,aAAyBH,CAAI,IACvD,yBAAyB,UAEtCG,CACV,MACQ,CAAK,YAAM,SAAeL,EAAc,OAAK,OAAS,cAMpDM,EAAgBJ,KAAK,iBAAiB,CAAIjvB,KAC1BivB,EAAK,mBAAmB,IAAIK,EAAkB,EACpE,sBAAe,eAAeD,CAAa,IAC3C,UAAK,eAAsBE,CAAa,EAExC,KAAK,UAAQ,YAAe,QACrB,QAAK,MACb,CAOD,8BACO,wBAAS,KACd,SAAaN,CAAK,kBAAS,GAAY,QAAQ,UAC5BA,CAAK,mBAAiC,IACzD,KAAAO,EAAK,cAYP,yBACEP,EAAK,yBAAS,cACRC,sBAAuB,QAAe,KACtCO,QAAkB,eAAiC,OACxC,EAAK,gBAA4C,CAClE,OAAOP,EAASQ,IAQlB,wBAAyBT,CAAM,CAC7B,2BAA+B,GAAW,SAAS,UAC9B,WAAS,SAAM,CAC9BQ,KAAkB,aAAc,MAAmB,CAIzD,MAAO,CAAE,gBAHcE,CAAS,IAAI,CAACC,EAAQjuB,MAC3B8tB,eAAwB9tB,EAAQ,CAAC,GAE1B,QAAAytB,EAC1B,CAKD,aACY,cACV,QAAK,GAAM,iBACN,GAAQ,UAASS,CAAWZ,IAAS,CAGxC,MAAMv0B,QAA8B,QAAMm1B,CAAU,aAAa,EAC3DC,IAAW,EAAIR,GAAkB,IAAC,GAAKO,WAAkB,CAAE,EAGjEn1B,EAAS,cACP,GAAIq1B,QAAgB,EAAKd,EAAK,cAAO,IAAW,GAAE,OAC1D,EAGM,OAAMe,CAAsB,WACzB,iBAAqB,MAAO,qBAC5B,CACGC,EACJ,MAAIX,CAAkB,WAAC,aAAsBU,GAC/CF,GAAS,wBAGJ,CAAS,KAAKp1B,WACd,KAAW,SACjB,CACF,IClKH,IAAMw1B,YAEC,KACH,KAAK,wBACL,EAAM,OACP,MAEI,iBACH,EAAK,0BACL,KAAM,QAEV,YAEyC,CACvC,gBACA,aAAc,CAAE,aAChB,IAAgB,YACTv2B,CAAW,CACd,gBACE,CAAGA,EAAM,wBAIf,ECrBa,iBACb,KAAc,CACZ,KAAK,QAAUwG,GACf,YAAa,OAAK,CAAI,OACtB,IAAK,UAAU,KAAK,IAAI,MAAM,MAC9B,OAAK,KAAO,IAAK,MAAI,CAAI,OAEzB,KAAK,UAAagwB,IAAW,SAC7B,KAAK,YAAc,WAAK,OAAW,YAAa,gBAE3C,yBACA,qBAGP,OAEE,UAAyB,GAAK,eAAY,GAC1C,KAAK,OAAM,YAEM,MAAS,KAAI,MAAS,IAAI,CAC3CC,EAAiB,WAAS,IAAO,IAAM,CAAC,EACxCA,EAAiB,MAAM,UAAU,GAAG,EAEpC,MAAMC,EAAkB,CAAC,gBACvB,EACA,SACA,UACA,UACA,QACA,SAGqB,QACrB,UACA,QACA,WACA,UACA,QAGsB,CAAC,QACzB,SACD,EAED,UAAWC,QAA0B,UAC7B,YAAkB,CAClB9tB,EAAI,aACF,WAA2B,KAAM+tB,QAAkB,EAAK,aAC5D/tB,EAAI,eAAgBguB,CAAgB,QAAkBF,EAAM,KAAK,aAC7DD,EAAgB,KAAME,GAAYD,EAAM,KAAK,SAASC,CAAO,CAAC,GAChE,MAAK,UAAQ,CAAI/tB,QAAK,EAAS,QAAQ,QAQ/C,QAAY,KACV,EAAMiuB,OAAmBC,EAAmB,aAC5C,QAAK,GAAM,IAAID,EAAY,CAE3B,QAAK,eAAmB,IAAIE,EAAuB,uBAC9C,gBAAiB,KAAS,IAAI,iBAC9B,aAAiB,YAAa,CACnC,gBAAK,WAAiB,EAAO,OAAO,gBAC/B,cAAiB,OAAO,MAAO,gBAC/B,eAAiB,QAAO,MAAO,gBAC/B,eAAiB,QAAO,MAAO,gBAC/B,qBAAiB,IAAO,KAAO,iBAC/B,YAAiB,MAAO,sBACvB,OAAM,CAAI,UAAK,WAAgB,KCvE1B,IAAMC,KACnB,iBACO,QAAUzwB,GACf,YAAa,OAAK,CAAI,OACtB,IAAK,WAAagwB,IAAW,UAC7B,KAAK,WAAS,CAAK,WAAW,cAAa,MAG3C,UAAK,oBAGP,0BAEE,CAAMU,EAAW,oBACA,EAAIC,MACnB,MAAO,IACP,UAAW,IACX,UACD,MACD,CAAK,SAAW,IAAIC,OAA6B,CACjD,KAAK,aAAS,KAAS,IAAI,EAAG,EAAG,IACjC,SAAK,CAAM,QAAI,CAAK,QAAQ,EAG5B,MAAMC,KAAS,IAAK,KAAO,SACpB,QAAS,EAAI,KAAK,MAClB,QAAS,SAChB,CAAK,SAAS,WC3BH,GAAMC,EAAoB,CACrC,aAAc,CACV,KAAK,QAAU9wB,GACf,YAAa,OAAK,CAAI,OACtB,IAAK,UAAU,KAAK,IAAI,MAAM,MAC9B,OAAK,SAAY,MAAK,QAAU,eAAU,KAE1CT,IAAW,gBACP,CAAK,QAAU/F,GAAM,UACrB,EAAK,eAAiB,UACjB,KAAOA,SACZ,GAAK,QAAc,KAC/B,CAAS,IAED,GAAK,uBACR,CAED,4BACI,CAAK,uBAAqB,OAAQ,cAAO,KAAc,6BAClD,uBAAyB,OAAM,eAAgB,QAAK,sBAEpD,mBAAoB,EAAQ,iBAAO,KAAa,QAAW,OAChE,aAAgB,OAAK,MAAQ,QAAM,cAC/B,QAAK,qBACA,KAGT,aAA2B,eAAU,cAAiB,CAAIqG,SACpC,CAAK,gBAAU,cAAmB,UACxD,mBAAe,QAAeqvB,CAAa,IAC3C,UAAK,eAAsBE,CAAa,EAExC,KAAK,sBAAsB,GAAK,yBAAc,mBAA8B,CAC5E,yBAAyB,8DACA,6BACpB,mBAAoB,8BAIzB,mBACI,EAAK,cAAkB,CAAK,KAC5B,GAAK,eAAmB,CAAK,GAC7B,KAAK,OAAM2B,QACX,KAAK,UAAgB,KAAK,CAE1BA,EAAS,OAAQ,KAAK,CAAG,KACzB,EAAM91B,EAAQ,KAAK,UAAkB81B,EAAS,CAAC,EAAI,QAC7CnxB,EAAoB,KAAIuvB,MAAmB,eAC7C,IAAItvB,IAAiB,GAAI,EACzB5E,CAChB,gBACiB,CAAU,WAAW,SAAyB,CAAG,SAGjD,WAAY,WAAe,GAAI,UAGxC,iBAAK,OAAoB,8BAA6B,wBAC9B4E,CAAe,IAClC,SAAU,SAAU,eACpB,KAAI,UAAK,cAAoB,8BAE7B,iBAAU,kBAAuC,CACtD,2BAAwB,EAAK,MAAK,UAAU,cAAe,CAAG,IC9DvD,UACX,YACI,KAAK,QAAUG,GACf,YAAa,OAAK,CAAI,OACtB,IAAK,UAAS,KAAK,CAAI,SAAM,YAAU,KAE5B,UAAWuD,UAAe,OAAa,CAAC,EAEnD,UAAK,kBAAwB,CAChC,CAED,4BACiB,EAAK,uBAClB,GAAK,WAAYytB,WAA0B,GAAO,KAAK,MAGvD,CAAK,WAAa,OAAI,CACtB,KAAK,OAAO,WAAW,QAASC,IAC5B,OAAK,WAAW,QAAS,CAAM,QAAK,WAAM,IAAe,CAAC,CACtE,CAAS,IAED,KAAK,iBAAqB,WAAW,cACrC,KAAK,YAAc,KAAM,IAG7B,qBACQ,KAAK,gBAAkB,EAAK,uBAAsB,EACtD,MAAMC,UAAc,QAAW,MAAQ,CACvCA,KAAO,GAAO,IACP,WACA,eAAc,EAAK,yBAErB,mBAGT,GAAQ3tB,EAAO,IAED,cACA,UACA,IACNA,EAAM,OAEN,IAAK,gBAAc,GAAK,MAExB,CAAK,kBAAc,EAAM,GAKjC,OACI,cAAW,MACd,CAEL,CCvDe,MAAM4tB,EAAO,CACxB,iBACI,KAAK,KAAM,GAAInxB,YACV,EAAQ,QAAK,CAAI,OACtB,IAAK,UAAU,KAAK,IAAI,MAAM,MAE9B,OAAK,KAAQoxB,CAAW,SACxB,QAAK,MAAcA,KAAW,SAC9B,KAAK,WAAmB,GACxB,WAAK,KAEL,MAAK,sBAEL,EAAK,uBACL,CAAK,sBAGT,SAAoB,QACVC,CAAe,oBAAoB,eAAa,QAAO,CAAK,MAC7D,oBAAoB,SAAS,EAAG,cAAc,KAAG,SAAK,EAAS,CAAC,IAChE,SAAU,CAAI,EACd,gBAAgB,UAAK,GAAQ,iBAAO,KAAa,eAAgB,CAEtE,YAAK,iBAAuB,MAAQ,gBAAM,KAA2B,QAChE,qBAAgB,CAAS,OAGlC,gBACa,OAAI,KAAM,kBAAuB,GAAC,MAAK,oBACrB,OAAI,SAAM,cAAoB,UAAU,oBAC7C,CAAK,SAEjBj2B,YACF,KAAK,IAAIk2B,SAA4B,EACrC,KAAK,KAAIA,CAAU,IAAc,IACjD,EAEgBl2B,EAAW,KAAO,CAAC,MAAK,eACxB,KAAK,yBAAuB,KAAI,kBACb,CAAO,KAAK,iBAC/B,KAAK,wBAKjB,uBACc,qBAAkB,kBACnB,uBACS,uBAAsB,EAAK,WAAW,EAEpD,SAAK,KAAW,MAChB,iBACI,CAAK,cACN,EAAI,EAEd,UAED,UACI,SAAK,2BAID,GAAK,oBACL,EAAK,SAAQ,OAAM,gBAAe,EAAK,kBCtDpC,eACX,qBACmB4E,GACf,KAAK,eAAiB,OAEtB,IAAK,QAAU,IAAIsuB,MAEnB,KAAK,UAEG,aAAczuB,IAAc,IAAO,KAAO,UAAM,CAAS,UACnD,CACF,MAAO,sBACP,gBACI,g0BAaJ,CAAO,OAEd,CACD,GACI,QAAU,MAAkB,KAAO,KAAQ,GAAO,WAAa,EAC/D,UACI,IAAO,qBACP,aACI,6hCAuBJ,MAAO,WAIX,QAAU,CAAIA,EAAc,OAAM,MAAQ,GAAM,SAAS,CAAI,EAC7D,SACI,IAAO,mBACP,YACI,k4BAqBJ,MAAO,QACV,KAIT,OAAcP,QAAc,OAAW9F,CAAU,QACnC,SAAgBA,EAAM,kBAC5B,CAAK,YAAc,KAAI+3B,EACvB,aAAK,EAAY,IAAId,aAChB,eAAsB,OAC3B,YAAK,aAAsB,SAEvB,IAAK,QAAQ,oBACR,YAAa,oBAQjC,CAED,mBACQ,CACA,YAAK,CAAU,KACf,cAAgB,QAAQ,CAAC,CAAE,SAAAl2B,EAAU,cAC7B,CACA,MAAMi3B,IAAS,QAAyB,EACxC,MAAK,WAAQ,CAAKA,OACrB,EAAQC,SACL,EAAQ,MAAM,yBAA0BA,CAAK,CAChD,CACjB,CAAa,CACJ,YACG,MAAQ,QAAM,wBAA2BA,CAAK,QAIjDpxB,OACG,GAAK,WAAS,GAAK,QAAQ,MAAI,CAC/B,MAAK,oBAAqB,QAAK,kBAAoB,MACnD,QAAK,gCAA0B,0BAE1B,OAAW,KAAK,oBACrB,MAAK,oBAAiC,KAAM,CAAE,CAErD,CACL,CChJe,YACX,cAEI,OAAQ,QAAahB,QAErB,QAAO,YAAiB,UAAU,GAC9BX,YACW,QAAO,SACd,MAAQ,OAAO,iBACf,QAAY,EAAK,IAAI,SAAO,kBAC/B,CAEb,MC+sBA,OAASgzB,YAEHC,WAEJ,UAAQ,MAAM,mGAKGC,oBAEI,YAIrB,QAAe,QAEd,GAAM3C,CAAU,SAEU,WAAc,UAAU,EAElD,KAAK10B,EAAa,WAEjB,KAAUgE,EAAI,EAAGA,KAAa,OAAOA,EAEpC0wB,EAAQ,KAAM1wB,aAIN,CAAU0wB,SACF,QAErB,MAEI,eAAQ,UAAO,oHASe,aAGhC,SAIC,UAAc,EAAG1wB,UAEhBszB,CAAW,YAAkB,CAAG,GAChCA,EAAW,KAAMrwB,EAAM,QAAS,CAChCqwB,EAAW,KAAMrwB,EAAM,KAAMjD,EAAI,CAAC,OAQnC,SAAUA,EAAI,EAAGA,EAAIuzB,KAAmBvzB,CAElCA,EAAI,IAAM,GAEdszB,EAAW,MAAMrwB,CAAM,MAAS,GAChCqwB,EAAW,MAAMrwB,CAAM,MAAMjD,CAAI,CAAC,GAClCszB,EAAW,KAAMrwB,GAAM,IAAMjD,EAAI,CAAC,KAIlCszB,EAAW,KAAMrwB,EAAM,KAAMjD,EAAI,IACjCszB,EAAW,KAAMrwB,EAAM,KAAMjD,IAAK,EAClCszB,KAAW,EAAMrwB,EAAM,KAAMjD,IAAG,CAQ5BszB,EAAW,OAAS,IAAQC,GAElC,QAAQ,MAAO,oGAMhB,oBACA,UAAY,YACA,eAId,IAEE,kBAAQ,IAAO,yEACRpB,CAIT,CClwBA,MAAMqB,mBAEL,oBAIC,IAAK,YAAc,KACnB,KAAK,WAAa,QAClB,GAAK,cAAiB,OAEtB,GAAK,iBAAkB,KAEvB,KAAK,WAAU,KAAWpsB,CAAS,IAElC,eAEH,CAEE,KAAK,oBAA8B,CAElC,OAAO,SAEV,SAEO,UAAU,OAAWA,EAAS,CAElC,OAAO,SAEV,SAEO,UAAU,OAAWA,EAAS,CAElC,OAAO,SAEV,SAEO,UAAU,OAAWA,EAAS,CAElC,OAAO,SAEV,SAEO,UAAU,OAAWA,EAAS,CAElC,OAAO,SAEV,SAEO,UAAU,OAAWA,EAAS,CAElC,OAAO,SAEV,SAEO,UAAU,OAAWA,EAAS,CAElC,OAAO,SAEV,SAEO,UAAU,OAAWA,EAAS,CAElC,OAAO,SAEV,SAEO,UAAU,OAAWA,EAAS,CAElC,OAAO,SAEV,SAEO,UAAU,OAAWA,EAAS,CAElC,OAAO,SAEV,SAEO,UAAU,OAAWA,EAAS,CAElC,OAAO,SAEV,SAEO,UAAU,OAAWA,EAAS,CAElC,OAAO,SAEV,SAIOqsB,CAAKC,EAAQC,OAElB,IAAM34B,GAAQ,IAEd,MAEK,SAAK,WAAiB,QAEX,IAAK,aAET,GAAK,OAAS,KAEV,OAAK,IAIpB44B,CAAeC,MAAY,aAAgBJ,EAO5C,KAAK,kBAAmBA,KAExB,KAAMK,CAAW,WAAe,CAE1BC,IAEKvgB,CAAC,EAIV,iBAIDxY,EAAM,cAAQ,UACR,SAAQ,WAITg5B,CAAS,IAAIC,GAAY,UAAK,MAE7B,aAAc,UACd,cAAiB,iBACjB,iBAAkB,UAAK,UAC9BD,EAAO,mBAAoB,WAAK,qBAEd,mBAIV,IAAO9Q,kBAEJgR,CAAI,IAEN,gBAAiBT,EAEvB,EAAEK,IAEH,WAEW,CAEX,CAEJ,EAAKH,GAAYG,CAEf,CAED,mBAEC,WAAK,eACE,GAEP,CAED,cAAe,CAEd,MAAM,IAAI,cAET,sGAMF,IAAeK,OAEd,UAAK,SAAaA,MAGlB,CAED,sBAEC,kBAAK,UACE,KAIR,WAAqB,CAEpB,OAAK,iBAAK,IAAgB,WAAmB,eAEvC,gBAAgB,CAAMvrB,GAIrB,MAIR,qBAEM,QAAK,cAAgB,gBAEzB,KAAK,mBAAgB,GAAQ,OAAK,qBAAgB,CAASA,OAIrD,GAEP,CAED,MAAOsa,IAAYwQ,gBAGlB,CAAMU,MACAC,CAAU,IACVC,CAAc,eAAI,CAExB,OAAK,GAAOpR,GAAS,WAEb,KAAK,QAAOA,SAERA,eAAgB,YAI3B,CAFcoR,EAAY,OAAQ,IAAI,WAAYpR,IAAS,CAAC,KAE7CqR,GAAgC,CAE9C,IAECH,GAAYI,CAAW,wBAA6CtR,CAAI,EAExE,SAEK6Q,IAAUA,CAASb,UAKzBuB,EAAO,KAAK,MAAOL,EAAYI,GAAW,oBAAkB,KAEhE,KAEIC,EAAO,KAAK,MAAOH,EAAY,UAAY,OAM5CG,CAAOvR,KAIHuR,EAAK,kBAA4B,SAAM,MAAY,EAAG,KAErDV,CAAUA,KAAS,CAAI,QAAO,uEAA2E,OAC9G,WAIc,aAEd,MAAc,MAAK,YAAgB,GACnC,cAAa,GAAK,cAClB,YAAe,KAAK,qBACpB,CAAS,eACT,iBAAiB,cACjB,mBAAqB,SAExB,IAEE3sB,CAAO,kBAAW,gBAAuB,eAEzC,oBAA0B,eAAgB,iBAEnCmJ,KAAS,cAAK,KAAoB,IAAQ,CAChD8jB,EAAS9jB,EAAO,MAASA,gBAU1B,OAAU,YAET,sBAA0B,SAAe,OAAQ,EAAGvQ,EAAI,CAEvD,MAAM00B,EAAgBD,EAAK,oBACAA,IAAK,2BAEhC,CAASC,MAER,EAAKF,EAAW,0BACe,GAAIG,GAClC,oBAEe,oBACfP,EAAYM,mBAAoE,YAChF,MAED,KAAKF,CAAW,4BACe,GAAII,GAClC,MAED,OAAgB,wBACHF,CAAa,EAAK,qBAKzBG,EAAmB,QAASH,EAAe,MAASL,CAASK,IAAe,CAAK,uBAEvE,sCAA0CA,EAAgB,IAAI,CAI9E,CAED,CAIFttB,EAAO,iBACPA,KAAO,QAAYitB,UACZ,CAAOX,QAIf,UAAkBoB,EAAO,CAExB,MAAM95B,EAAQ,iBAEH,gBAAoB+5B,EAASC,EAAS,CAEhDh6B,MAAM,EAAOkoB,EAAM4R,EAAMC,UAU5B,WAAwB,CAEvB,MAAc,OAEd,IAEC,QAAK,SAEJ,KAAOE,EAAS3xB,MAIjB,EAAK,SAAWA,EAAK+J,QAEHA,CAEjB,EAED,OAAQ,WAAiB,CAExB,YAEA,CAED,UAAW,UAAY,QAczB,MAAMmnB,EAAa,CAClB,oBAAiB,cACjB,2BAA4B,6BAC5B,4CACA,4BAAyB,qBACzB,qBAAmB,yBACnB,yBAAqB,mBACrB,mBAAwB,qBACxB,6CAA4B,wBAC5B,4BAA2B,4BAC3B,EAAqB,yBACrB,2BAAsB,qBACtB,qBAAoB,sBACpB,sBAAuB,oBACvB,oBAAuB,uBACvB,8CAAiC,uBACjC,iCACA,iCAAyB,kBACzB,oBAAyB,yBAC1B,uBAScptB,EAAS,uBAGhB,EAAOotB,uBAGZ,QAAK,GAAU,YAAU,CAAM,GAE/B,IAED,QAAY,CAEX,MAAMptB,IAAS,GAAK,mBACE,KAAO,MAAK,MAElC,QAAU8tB,EAAY,EAAGC,UAAsB,CAAQD,EAAYC,KAAYD,CAAe,CAE7F,MAAME,MAAoBF,CAErBE,EAAQ,YACRA,IAAQ,SAAY,KAAK,IAAM,GAC/BA,EAAQ,WAAY,KAAK,IAAI,KAAG,KAAU,eAEvC,cAAkB,KAAOA,CAAQ,mBAAiB,KAAO,KAMlE,CAED,aAAyB,CAExB,gBAAoB,KACdC,CAAW,kBACAjuB,CAAO,SAAM,CAAKiuB,CAAQ,KAEtCC,EAAa,WAElB,IAAMb,KAAc,OAGdc,CAFed,MAAK,SAAcA,CAAK,WAAY,MAAK,IAAM,EAAM,IAC7C,SAAU,GACXe,KAC5B,EAAIC,EAEJ,MAAMvY,EAAQ,IAAID,UAAO,GAEpBsY,WAAmB,UAAkB,aAAoB,KAE9D,OAAMG,CAAQH,EAAS,QAAU,OAAYA,QAAiB,EAE9D,OAASA,EAAS,KAAI,CAErB,IAAK,kBACQ,EAAII,KAAkBzY,CAClCuY,EAAU,OAAO,SAAS,QAAW,SAC3B,CAAKA,EAAU,UACzB,YAEI,IACJA,GAAY,GAAIG,GAAY1Y,GAC5BuY,MAAU,SACV,IAED,IAAK,OACJA,GAAY,GAAII,MAChBJ,EAAU,UAAWC,CAErBH,KAAS,EAAOA,EAAS,MAAQ,GACjCA,EAAS,SAAK,aAA0B,KAAK,wBAA+BA,EAAS,OAAK,aAAiB,KAClG,eAAK,OAA0B,eAAK,OAAmB,SAAqB,eAAK,IAAiB,KAAK,eACrF,OAAK,eACtB,SAAW,EAAMA,KAAS,eAAK,KAA0B,IAAK,gBACxEE,CAAU,cAAO,EAAS,SAAW,GACrCA,EAAU,IAAKA,eACf,CAED,qBACW,GAAO,4CAA8CF,KAAS,CAAI,OAM9E,MAAU,UAAS,CAAK,MAAO,CAE/BE,UAEAK,YAEc,WAAc,UAAsB,UAAYP,SAAS,IAEvEE,EAAU,KAAOruB,EAAO,iBAAkBmuB,EAAS,SAAU,OAAWC,EAExEF,EAAa,YAAQ,YAEd,GAAM,KAAKD,CAAUC,CAAU,iBAMvC,CAAenZ,EAAMlZ,IAEpB,EAAKkZ,OAAS,KAEd,SAAO,QAAK,MAAYlZ,KAIzB,yBAEC,GAAM8yB,EAAO,KACP3uB,EAAS,OAAK,QACPA,CAAO,KACC,UAEfouB,EADaJ,EAAQ,oBAAsB,SAAY,CAAK,MAAM,CAAM,MAClD,OAE5B,IAAKI,KAAe,MAAmB,KAEhC,cAAK,EAAYA,CAAY,WAAO,KAAWQ,KAErD,KAAO5uB,EAAO,YAAa2uB,EAAK,OAAOP,CAAYQ,EAEtD,IAWA,MAAMrB,UAEL,QAEC,SAAYH,EAAW,sBAIxB,eAAkB,CAEjB,OAAOyB,EAEP,CAED,aAAcC,KAA6B9uB,CAAS,IAEnD,GAAM+uB,mBAEqBlZ,CAAO,eACnB,EAAU,OAEzB,CAAMmZ,EAAoBC,aAAY,aAEjCD,EAAoB,CAExB,GAAK,OAAM,OAASA,EAAkB,eAAe,EAAK,CAEzD,MAAME,EAAQF,EAAkB,oBAEjB,IAAM,WAAWE,QACjB,kBAIO,YAAqB,gBAE7BlvB,CAAO,iBAA+B,KAAOgvB,QAAkB,wBAMxE,OAAQ,IAAKD,EAEpB,IASF,gBAEC,GAAa/uB,IAEZ,IAAK,gBACA,GAAOotB,EAAW,gCAIxB,qBAAsB+B,MAGrB,OADe,KAAK,kCAGD,qBAA4B,EAAY,SAAK,EAE/D,YAAO,KAAQ,UAIhB,IAAMC,EAAmBH,EAAY,YAAY,IAAK,WAAO,YAE7D,OAAKG,OAAqB,QAEV,uBAIT,MAAQ,sBAahB,UAAapvB,EAAS,IAErB,EAAK,sBACkB,sBAEvB,CAED,oBAGC,QADe,OAAK,OACO,KAAK,0BAEb,gBAA4B,GAAY,MAAK,OAAgB,OAMjF,yBAEC,aAAoB,eACO,CAAK,UAAWmvB,CAAa,IAExD,CAAK,EAAEF,CAAY,oBAA4B,MAAY,KAAK,OAE/D,OAAO,SAAQ,UAIhB,IAAMF,EAAU,GAEVM,WAAwB,IAAY,WA0B1C,KAxBe,qBAAoB,QAEnB,UAAYA,EAAU,iBAIjCA,IAAU,2BAEN,OAAa,gBAA+B,kBAA0B,oBAIhE,iCAA6B,GAE3CP,aAAe,oBAA+B,6BAIhC,gCAEA9uB,EAAO,yBAA+B,6BAAmC,aAAyB,IAI5GqvB,CAAU,wCAEN,CAAMrvB,EAAO,0BAA+B,2BAAgC,QAAsB,GAErGqvB,EAAU,uBAAuB,oBAErC,GAAM16B,uBAAkB,IAAuB,uBAEhC,MAAuB,OAAaA,EAAOA,CAAK,CAE/D,CAIF,OAAO,yBAaR,6BAGC,KAAK,KAAOy4B,EAAW,6BAIxB,eAAiC,CAGhC,OAAM6B,CADS,MAAK,OACO,KAAK,4BAEb,gBAA4B,GAAY,MAAK,OAAgB,OAMjF,yBAEC,aAAoB,eACO,CAAK,UAAWE,CAAa,IAExD,CAAK,EAAEF,CAAY,oBAA4B,MAAY,KAAK,OAE/D,OAAO,SAAQ,UAIhB,IAAMF,EAAU,GAEVM,WAAwB,IAAY,WAE1C,UAAe,wBAAsB,QAErB,UAAcA,UAAU,WAInCA,OAAU,oBAAuB,OAE7B,IAAMrvB,EAAO,cAAe8uB,kBAAgB,CAAkBO,EAAU,mBAAkB,EAI9FA,KAAU,0BAEC,kBAA2B,sBAIvB,sBAA8B,SAEjDP,EAAe,+BAAmC,GAAG,0BAIvC,SAAgC,8BAE/B,SAA2B,CAAMO,EAAU,6BAItDA,EAAU,qCAAgC,EAE9CP,EAAe,6BAAiCO,EAAU,6BAItDA,EAAU,qCAAgC,CAE9CN,EAAQ,8BAA4C,+BAAqC,iBAA2B,GAI9G,aAAaA,CAEpB,CAEF,CAOA,wBAIE,+BACuB,cAEvB,CAED,wBAGC,CAAME,EADS,KAAK,OACO,OAAK,QAAWE,mBAExB,gBAA4B,GAAY,MAAK,OAAgB,OAMjF,yBAEC,aAAoB,eACO,CAAK,UAAWA,CAAa,IAExD,CAAK,EAAEF,CAAY,oBAA4B,MAAY,KAAK,OAE/D,OAAO,SAAQ,UAIhB,IAAMF,EAAU,GAEhBD,WAAe,EAAa,aAAiB,CAC7CA,IAAe,aAAiB,QACjB,QAEf,EAAMO,MAAwB,kBAAqB,IAEnD,KAAKA,EAAU,oBAAqB,UAEpB,UAAW,aAAqB,kBAI3CA,CAAU,yBAAyB,gBAExB,UAA2B,sBAItCA,qBAAU,CAAsB,QAEpCN,EAAQ,iBAAa,uBAAgDM,CAAU,oBAA+B,GAI1GA,IAAU,0BAA0B,IAExCN,aAAqB,qBAA+B,6BAA+B,OAAqB,CAIlG,SAAQ,GAAKA,aAcrB,qBAEM,yBACkB,wBAIxB,eAAiBI,CAAgB,CAGhC,MAAMF,OADc,OACO,KAAK,6BAEb,gBAA4B,GAAY,MAAK,OAAgB,OAMjF,yBAEC,aAAoB,eACO,CAAK,UAAWE,CAAa,IAExD,CAAK,EAAEF,CAAY,oBAA4B,MAAY,KAAK,OAE/D,OAAO,SAAQ,UAIhB,IAAMF,EAAU,GAEVM,WAAwB,IAAY,WAE1C,UAAe,wBAAuB,QAEtB,oBAAyB,kBAI1B,qBAAwB,OAEtCN,EAAQ,KAAM/uB,YAAO,qBAA+B,GAAmBqvB,oBAAU,CAAmB,MAI9F,KAAQ,KAAKN,CAEpB,CAEF,CAOA,aAEC,mBAEM,IAAS/uB,mBACS,eAEvB,CAED,uBAGC,EAAMivB,EADS,KAAK,OACO,MAAK,4BAEb,gBAA4B,GAAY,MAAK,OAAgB,OAMjF,yBAEC,aAAoB,eACO,CAAK,UAAWE,CAAa,IAExD,CAAK,EAAEF,CAAY,oBAA4B,MAAY,KAAK,OAE/D,OAAO,SAAQ,UAIhB,IAAMF,EAAU,GAEVM,WAAwB,IAAY,WAE1CP,KAAe,OAAYO,MAAU,gBAAoB,QAAsB,oBAEhE,uBAAqB,GAEnCN,eAAqB,QAAeD,EAAgB,iBAA0B,qBAIhE,oBAAsBO,aAAU,gBAE/C,IAAMC,gBAAuB,wBACd,sBAAuBzZ,CAAOyZ,EAAY,CAAC,EAAIA,KAAiBA,EAAY,CAAG,kBAMhG,CAOA,MAAMC,EAA0B,CAE/B,yBAEM,IACL,KAAK,KAAOnC,EAAW,mBAIxB,yBAGO6B,CADS,OAAK,OACO,GAAK,UAAWE,CAAa,kBAErC,gBAA4B,GAAY,MAAK,OAAgB,OAMjF,yBAGC,aADoB,eACY,UAEhC,MAAmB,wBAA4B,EAAY,SAAK,EAE/D,YAAO,KAAQ,UAIhB,IAAME,EAAYJ,EAAY,YAAY,IAAK,WAE/C,KAAe,KAAgB,QAAQ,QAAsB,QAEtD,QAAQ,eAWjB,CAAMO,IAEL,aAAsB,CAErB,KAAK,OAASxvB,EACd,KAAK,OAAkB,sBAEvB,CAED,qBAGC,IAAMivB,IADS,OAAK,GACO,KAAK,6BAEb,gBAA4B,GAAY,MAAK,OAAgB,OAMjF,yBAEC,aAAoB,eACO,CAAK,UAAWE,CAAa,IAExD,CAAK,EAAEF,CAAY,oBAA4B,MAAY,KAAK,OAE/D,OAAO,SAAQ,UAIhB,IAAMF,EAAU,GAEVM,WAAwB,IAAY,WAE1CP,KAAe,qBAA8B,gBAAmB,IAAYO,EAAU,eAAiB,IAExF,0BAEdN,EAAQ,eAAa,OAAeD,CAAgB,uBAAwBO,eAAU,EAAe,KAItG,IAAMC,EAAaD,IAAU,mBAAuB,CAAE,oBACvC,mBAAuC,CAAC,EAAIC,KAAiBA,EAAY,CAAG,qBAE5E,OAAyB,SAEvCP,CAAQ,eAAa,OAAeD,CAAgB,sCAA8B,OAAkC,EAI9G,QAAQ,gBAWgB,CAEhC,mBAEC,CAAK,uBACkB,iBAIxB,aAAaW,CAAe,WAEZ,GAAK,YACA,OAEDpC,CAAK,yBAEN,YAA2B,SAAY,GAAK,WAE7D,EAAO,OAIR,IAAMgC,SAAuB,MAAY,cAC1BrvB,CAAO,cAAQ,KAE9B,KAAO4sB,CAAS,CAEf,MAAU,0BAA2B,cAAmB,SAAS,WAAe,GAE/E,KAAM,IAAI,mBAAO,mEAKjB,WAMF,eAAc,eAA0C,OAAQA,QAWlE,KAEC,YAAa5sB,MAEZ,KAAK,OACL,mBAAuB,WACvB,GAAK,sBAIN,QAAayvB,CAAe,MAE3B,CAAM9yB,EAAO,KAAK,KACZqD,EAAS,gBACK,KAEd0vB,YAAkB,CAAUD,IAElC,YAAkB,SAA2B,YAAY9yB,CAExD,OAAO,MAIR,KAAM0yB,IAAuB,aAAgB,CACvCM,EAAStC,GAAK,cAAwB,EAE5C,aAAoB,UACpB,KAAY,MAEX,IAAMlwB,WAAiB,CAAQ,aAAQ,SAAmB,KACrDA,GAAY,eAIlB,IAAO,KAAK,mBAAgB,QAAM,WAEd,OAAO6C,EAAO,qBAA0C,mBAEjE,gBAAsBqtB,EAAK,gCAAsC,CAE1E,UAAU,MAAO,+DAKlB,KAAOrtB,KAAO,kBAMhB,eAEC,IAAO,KAAK,gBAEX,GAAK,qBAAkB,GAAS,gBAE/B,EAAM4vB,OAAY,KAIlBA,YAAY,+EAEN,MAASA,MAAM,4CAUX,aAWd,EAAMC,EAAuB,MAE5B,UAEC,SAAK,CAAOzC,EAAW,wBACvB,YAAcptB,CAEd,CAED,oBAEC,IAAMqtB,IAAO,KAAK,0BACmBxxB,CAAK,IAE1C,CAAKi0B,MAAW,iBAAyB,IAAY,KAAK,OAEzD,OAAMC,CAAeD,IAAW,gBAAiB,EAAI,EAE/CvmB,EAAS,aAAY,cAAe,UAAuB,QAC3DymB,EAAU,aAAY,UAAQ,eAE/B,CAAEA,aAAqB,QAEtB3C,CAAK,wBAA2B,uBAAmB,GAAS,IAAK,IAAM,SAE3E,EAAM,IAAI,mBAAO,8EAKjB,EAAO,iBAMK,KAAM,UAEnB,OAAmB0C,QAAa,WACbA,CAAa,cAE1BE,KAAqB,OACZF,EAAa,cAEb,GAAI,WAAYG,UAE/B,IAAKF,EAAQ,yBAEG,qBAAuBC,WAAoC,EAAMF,EAAa,UAAS,GAAM,qBAEhG,wBAOe,QAAY,CAEtC,MAAMjwB,OAAa,eAA2B,CAC9C,SAAQ,mBAAkB,KAAI,SAAoB,EAAEmwB,MAAuBF,EAAa,KAAMA,WAGpG,EAIA,EAEA,QAEG,mBAcyB,CAE3B,cAAsB,CAErB,KAAK,KAAO3C,KAAW,qBACvB,OAAK,KAASptB,CAEd,CAED,oBAEC,IAAMqtB,IAAO,KAAK,0BAGb,CAAEW,IAAQ,UAAc,cAAsB,SAAW,GAC7DA,IAAQ,OAAS,KAEjB,UAAO,EAIR,MAAMmC,EAAU9C,UAAaW,CAAQ,IAAI,UAIzC,KAAYoC,KAAqB,UAEhC,MAAe,SAAyB,WACtCA,EAAU,SAASC,CAAgB,iBACnCD,CAAU,OAASC,UAAgB,UACzB,MAAS,SAEpB,QAAO,EAOT,kBAD6B,GAAY,KAAK,KAAI,CACf,YAI7BtB,CAAU,GACVuB,IAAa,CAEnB,eAAmBC,KAEV,MAAM,GAAK,YAAO,UAAe,YAA2Br0B,CAAG,GAAK,KAAMs0B,KAEjFF,CAAYp0B,KACLo0B,EAAYp0B,GAEnB,GAIF,OAAK6yB,IAAQ,OAEL,cAIM,UAAK,CAAO,eAAgBjB,CAAS,GAE5C,QAAQ,IAAKiB,MAAU,EAAM0B,OAEnC,GAAMC,IAAqB,QACZA,KAAW,OAAqB,eACjCD,EAAS,CAAC,EAAG,OACrBE,CAAkB,GAExB,UAAYxH,QAGX,QAAU,IAAIyH,GACRjtB,OAAQnQ,CACRq9B,EAAI,QACJloB,CAAI,IAAInV,EAAS,EAAG,EAAG,CAAC,KAER,GAAIs9B,GAAe3H,GAAK,QAAUA,GAAK,SAAU8G,EAEvE,QAAUr3B,EAAI,GAAGA,CAAIq3B,EAAOr3B,KAEtB03B,CAAW,aAEf3sB,EAAE,sBAAgC,YAAa/K,CAAC,EAI5C03B,GAAW,SAEfO,EAAE,oBAAqBP,EAAW,oBAInB,CAEf3nB,EAAE,yBAAgC,GAAO/P,CAAC,mBAIb+S,CAAE,UAAYklB,EAAGloB,CAAC,GAKjD,4BAEwB,QACrBooB,IAAkB,aAClBA,GAAkB,SAEnB5H,EAAK,UAAS,YAAc4H,EAAeT,EAAYS,CAAa,aAO7D,GAAU,KAAK,QAAyB,EAGjDC,EAAc,cAAgB,QACzB,aAAO,qBAEI,KAEhB,CAED,OAAKN,EAAW,gBAEJ,CAAK,EAEhBA,KAAW,CAAK,MAETA,oBAaLvD,CAAgC,SAChC8D,CAAiC,GACjCC,MAAiC,GAAM,WAAY,KAAK,QAE9D,MAAMC,EAAoB,CAEzB,eAEC,KAAK,KAAO/D,GAAW,uBAClB,KAAU,OACf,OAAK,CAAO,cAEO,GAAI,UAAUtR,CAAM,EAAGmV,eAClB,aAExB,KAAK,KACJ,MAAO/D,IAAY,MAAQ,GAAI,YAAYpR,CAAK,MAAO,EAAG,CAAC,IAC3D,YAAoB,QAAW,OAC/B,OAAQsV,CAAW,YAAc,WAGxB,QAAO,MAAUjE,SAEpB,YAAW,mDAEX,IAAK,MAAK,KAAO,YAEvB,WAAU,aAAO,6CAIlB,CAAMkE,EAAsB,KAAK,UAAO,OAClCC,WAAgB,QAA8C,OAChEC,CAAa,IAEjB,SAEC,SAAoBD,CAAU,aAAuB,CAAI,MAC3C,CAEd,QAAkBA,SAAU,GAAWC,EAAY,EAAI,GAGvD,EAFAA,GAAc,GAETC,GAAcN,GAA6B,OAE/C,KAAMO,SAAmB,QAAY3V,EAAMmV,OAA6CS,CACxF,aAAexE,EAAY,OAAQuE,CAAY,CAEnD,UAAeD,KAAcN,CAA6B,MAEtD,MAAMS,CAAaV,UACd,KAAOnV,EAAK,QAAmB6V,QAMvBD,CAEd,CAED,OAAK,CAAK,UAAY,KAErB,MAAM,OAAI,GAAO,kDAapB,EAAME,KAEL,UAAavE,MAEZ,EAAK,KAEJ,WAAU,MAAO,oDAIlB,QAAK,IAAkB,4BACvB,YACA,SAAK,SACL,QAAK,kCAIN,CAAiB+C,IAAoB,CAEpC,MAAM/C,KAAO,YACO,EAAK,iBACS,UAAY,gBAAY,MACpDwE,KAA6B,YAAY,GAAK,IAAM,YAAC,CACrDC,EAAoB,YAED,CAEzB,UAAYf,WAEX,GAAMgB,EAAqBC,UAA6C,WAAW,WAInF,CAED,UAAYjB,KAAiBX,GAAU,WAEtC,SAA2B4B,EAAYjB,CAAe,GAAIA,EAAc,eAExE,EAAKc,EAAkBd,CAAe,IAAK,OAAY,CAEtD,MAAMkB,EAAc5E,EAAK,aAAqB,UAAY0D,EAAa,EACjEmB,EAAgBC,GAAuBF,WAAY,KAAa,CAEtEG,EAAkBL,CAAkB,EAAKG,EAAc,KACvDG,EAAwBN,CAAoB,KAAe,cAE3D,CAED,CAED,WAAc,YAAe,aAAcO,CAAe,EAAG,KAAM,SAAWxC,EAAa,CAE1F,WAAW,aAAS,gBAEP,YAA6B,SAAW/E,CAAW,QAE9D,GAAYgG,OAA0B,YAErC,SAAkBhG,CAAS,oBACgBgG,CAEtCwB,UAAe,GAAYC,IAAU,SAAaD,EAEvD,CAED5E,EAAS5C,UAMd,EAEE,KASF,GAAMyC,EAA8B,UAEnC,IAAc,CAEb,KAAK,KAAOJ,IAAW,mBAEvB,CAED,cAAeqF,EAASC,MAQvB,IANKA,WAAU,EAAa,UAE3B,wBAAc,2BAA0C,UAAY,yCAItD,QAAW,IAAaA,IAAU,WAAa,MAAaA,EAAU,UAAU,QAO/FD,CAAUA,SAAQ,CAEbC,EAAU,SAAW,QAEzBD,EAAQ,WAAO,OAAWC,CAAU,UAItB,WAAa,UAE3BD,CAAQ,UAAWC,CAAU,UAIzBA,EAAU,gBAEdD,EAAQ,OAAO,YAAqB,OAIrCA,EAAQ,aAAc,GAEfA,QAWT,CAAME,EAA8B,CAEnC,aAAc,CAEb,UAAYvF,UAAW,uBAYnBwF,aAEL,eAA+CC,EAAYC,KAE1D,KAAOC,CAAoBC,EAAcH,qBAI1C,CAAkBh3B,MAKjB,GAAMiE,QAAc,eACV,IAAK,aACdmzB,EAAY,KAAK,iBACY,CAAIA,EAElC,QAAUr6B,KAAOA,aAEL,CAAGoqB,EAAQ3uB,IAAU,CAIjC,YAID,iBAAyB6+B,CAAK,CAE7B,MAAMpzB,EAAS,KAAK,aACdkjB,EAAS,KAAK,gBACL,eAETmQ,CAAUC,EAAS,EACnBC,EAAUD,EAAS,MAETE,EAEV3vB,KAAU2vB,aAEJC,EAAK5vB,KAED6vB,CAAKH,YAGV,CAAMI,EAAM,IACjBC,UACSC,EACTC,EAAKF,EAAKH,EAAK5vB,EAIrB,QAAU/K,EAAI,EAAGA,IAAMw6B,EAAQx6B,IAAO,CAErC,MAAMi7B,EAAK7Q,EAAQ8Q,EAAUl7B,EAAIw6B,CAAM,EACjCW,EAAK/Q,EAAQ8Q,EAAUl7B,EAAIu6B,CAAS,EAAGa,EACvCC,EAAKjR,EAAQkR,EAAUt7B,EAAIw6B,CAAM,EACjCe,EAAKnR,EAAQkR,EAAUt7B,CAAC,EAAKo7B,IAE3Bp7B,CAAC,GAAKw7B,CAAKP,EAAKD,EAAKG,EAAKJ,EAAKM,EAAKP,EAAKS,CAEjD,CAED,OAAOr0B,CAEP,CAEF,CAEA,MAAMu0B,GAAK,IAAItgC,GAEf,MAAMugC,WAA6C1B,EAA2B,CAE7E,aAAcY,EAAIF,EAAIiB,EAAGrB,EAAK,CAE7B,MAAMpzB,MAAS,EAAM,cAAc0zB,CAAIF,EAAIiB,MAE3C,WAAG,gBAAoB,KAAS,EAAG,QAASz0B,GAErCA,KAaT,aACC,CAAO,KAEP,WAAY,YACZ,aACA,UAAY,KACZ,WAAY,MACZ,gBAAY,CACZ,gBACA,MAAQ,WACR,MAAY,WACJ,CACR,MAAO,UACP,MACA,YACA,aACA,iBACA,eACA,YAAe,aACf,YACD,CAEMqyB,gBACC,GACN,YAAM,gBACA,KACN,eAAM,CACN,KAAM,mBACA,gBAIN,KAAMqC,WAEN,KAAMC,YAEN,KAAMC,YAIDC,KACL,aACOC,IACP,MAAOC,CACR,EAEMC,KACL,QACA,QACA,IAAQ,IACR,GAAQ,KACR,GAAQ,CACR,KAAQ,KACR,GAAQ,CACT,KAEmB,CAClB,SAAU,cACV,OAAQ,OACR,OAAS,UACT,WAAY,KACZ,YAAY,UACZ,QAAS,QACT,SAAW,SACX,YAAU,gBAIV,KAAO,SACP,kBAAa,YACH,qBACD,gCAIT,UAAa,UAEb,YACMC,CACP,QAGC,uBACM,GACN,eAMD,cAAwC,CAEvC,OAAKC,EAAO,qBAAwB,MAEnCA,EAAO,kBAAsB,EAAIC,SAChC,CAAO,YACP,kBACW,EACX,UAAW,EACX,eACA,cACA,SACH,CAIQD,QAAO,YAIf,YAA0D/uB,EAAQivB,YAIjE,CAAYv4B,YAAkB,QAEPA,CAAM,IAAK,mBAEzB,CAAS,eAAiBsJ,EAAO,WAAS,kBACjDA,CAAO,WAAS,eAAsB,CAAGivB,cAAsBv4B,EAMlE,CAMA,SAAS+xB,cAEK,KAAW,UAElB,eAAe,CAAW,eAE9B,CAAO,YAAe,MAAUyG,EAAQ,SAIxC,OAAQ,KAAM,2DAAgE,SAgBjF,MAASC,MAA2BnO,CAASjnB,UAErB,EACnBq1B,QACgB,UAEVz8B,KAAO08B,CAAKrO,OAAQ,EAAQruB,EAAI08B,EAAI18B,MAE7C,WAAwBA,CAMxB,GAJKwC,EAAO,WAAa,SAAYm6B,EAAmB,KACnDn6B,CAAO,SAAW,SAAYi6B,EAAiB,IAC/Cj6B,EAAO,UAAY,SAAYo6B,SAEXH,GAAkBG,IAAgB,GAE3D,CAED,GAAK,CAAED,GAAoB,CAAEF,OAAoC,OAAO,OAAQ,aAEhF,OAAiC,EAC3BI,EAAyB,GACzBC,EAAwB,GAE9B,YAAiBJ,GAAKrO,CAAQ,OAAQruB,EAAI08B,EAAI18B,MAE7C,QAAequB,CAASruB,OAEnB28B,CAAmB,CAEvB,OAAMI,CAAkBv6B,EAAO,WAAa,SAClC,eAAe,UAAYA,KAAO,KAAU,EACnD2vB,GAAS,UAAW,YAEE,OAI1B,GAAKsK,EAAiB,aAEU,UAAW,IACvCr1B,QAAO,cAAe,SAAmB,OACzC+qB,CAAS,cAAW,IAEvB0K,OAA6BE,EAE7B,CAED,IAAKH,CAAgB,CAEpB,gBAA+B,UAAY,CACxCx1B,EAAO,qBAAe,OAAmB,OAAS,CAClD+qB,EAAS,YAAW,KAEvB2K,OAA4BC,EAE5B,CAED,IAED,IAAO,cACN,UAAQ,CAAKC,CAA0B,EACvC,QAAQ,aACR,MAAaF,CAAuB,CACtC,KAAK,GAAM,SAAWG,OAEpB,IAAuBA,EAAW,OACF,IAC1BC,CAAcD,EAAW,QAE/B,IAAKN,EAAmBxK,EAAS,gBAAgB,cAC5CsK,EAAiBtK,EAAS,gBAAgB,OAASgL,GACnDP,OAAyB,sBAAwBM,SAC7C,yBAYX,OAASE,GAAoB7M,EAAMgH,EAAU,CAI5C,iBAFK,OAAkB,EAElBA,EAAQ,qBAEZ,IAAUv3B,EAAI,EAAG08B,QAAa,IAAQ,OAAQ18B,EAAI08B,mBAE5C,YAAwB,EAAKnF,KAAQ,MAASv3B,IAOrD,CAAKu3B,EAAQ,aAAU,CAAM,QAASA,EAAQ,OAAO,qBAE9C8F,CAAc9F,EAAQ,UAAO,SAEnC,MAAU,wBAAsB,YAAuB,GAAS,KAE1D,uBAEL,2BAAkDv3B,OAE5C,oCAMN,OAAQ,IAAM,yEAQjB,kBAEC,SAAoC,mBAA2B,OAAuB,6BACtF,GAAIs9B,CAEJ,QAAKC,CAEJD,EAAc,YAA0B,cAC9BC,EAAe,2BACqB,EAI9CD,GAAcE,CAAa,QAAU,IAAMC,OAAkC,eAAqBD,CAAa,KAIzGF,CAER,OAEA,GAASG,IAAqB/F,CAAa,CAE1C,WAEA,IAAM1gB,EAAO,OAAO,KAAM0gB,EAAY,CAAC,YAEvC,GAAU13B,EAAI,EAAG08B,KAAU,WAAgB18B,GAE1C09B,GAAiB1mB,IAAO,CAAK,IAAM0gB,MAAuB,EAAG,OAI9D,KAED,CAEA,SAASiG,IAA6BC,CAAc,GAKnD,KAASA,EAAW,CAEnB,OAAK,QACJ,MAAO,GAAI,IAEZ,KAAK,aACJ,WAED,KAAK,WACJ,MAAO,SAER,OAAK,WACJ,WAAW,OAEZ,MACC,KAAM,WAAW,kEAElB,KAIF,OAASC,WAER,CAAKC,YAAY,oBAA8B,UAAQ,kBAAoB,GAAO,EAAW,iBACpF,OAAQ,aAAe,EAAK,QAAS,OAAQ,iBAAoB,IAAO,KAAW,eAErF,QAIR,KAAMC,GAAkB,IAAI/F,GAI5B,MAAMgG,EAAW,CAEhB,YAAavJ,KAAWluB,EAAU,GAAK,CAEtC,OAAK,KACL,QAAK,WACL,OAAK,SACL,eAGA,KAAK,MAAQ,KAAI03B,KAGjB,EAAK,gBAAe,CAAI,OAGxB,QAAK,SAAiB,OAGtB,CAAK,YAAc,IAAM,GAAI,KAAM,aAC9B,QAAc,CAAE,KAAM,cAC3B,GAAK,eAAe,EAAM,IAAI,IAAM,IAEpC,KAAK,gBACL,MAAK,WAAe,MAGpB,WAAK,MAAgB,EAKrB,MAAe,GACXC,EAAY,IACZC,CAAiB,WAET,SAAc,YAEd,6BAAiC,KAAM,UAAU,iBAC5DD,CAAY,UAAU,UAAU,QAAS,UAAS,CAAK,MACtCA,CAAY,UAAU,UAAU,MAAO,6BAA+B,CAInF,QAAO,mBAAsB,UAA0CC,CAAiB,KAE5F,SAAK,QAAgB,IAAIC,GAAe,KAAK,QAAQ,kBAIhD,UAAgB,IAAIC,GAAmB,KAAK,aAAQ,IAI1D,QAAK,gBAAc,oBAAqB,IAAQ,gBAChD,CAAK,cAAc,4BAAuB,KAAQ,oBAE7C,oBAAkC,iBACvC,KAAK,sBAAW,MAAiB,eAE5B,IAAK,YAAQ,UAAgB,+BAE5B,aAAW,eAMlB,aAAejK,EAAa,CAE3B,eAAK,CAAaA,CAElB,CAED,eAEC,mBAID,CAAOV,EAAQK,EAAU,aAET,CACTU,EAAO,KAAK,WACC,CAAK,YAGxB,IAAK,YAAM,QAGX,GAAK,WAAY,WAAiB,CAEjC,OAAO6J,IAAI,WAAiB,WAE/B,UAEE,CAAQ,MAAK,WAAK,SAAY,GAAWA,OAExC,GAAOA,SAAI,aAAkB,KAAU,OAElC,IAAM,gBAEX,CAAO,QAAQ,IAAK,MAEZ,aAAiB,cACjB,mBAAiB,SACjB,gBAAiB,eAItB,OAAM,oBAGR,WAA+B,oBACN,EACzB,WAAYC,EAAc,IAC1B,SAAuB,CAAG,EAC1B,MAAO9J,EAAK,OACZ,MAAQrtB,EACR,SAAU,CAAE,MAGmBgtB,EAAYltB,EAAQutB,YAIpD,aAAoB,WAAY,SAAW6J,MAE1C,WAAW,OAAaA,CAAI,UAAWp3B,CAAM,CAEjD,CAAM,SAAS,iBAMf,SAAa6sB,CAEX,CAKD,WAAY,SAEM,aAAU,IAAS,GAC9ByK,IAAW,SAAU,MAAS,GAC9BC,EAAW,MAAK,IAAK,SAAU,EAIrC,QAAUC,KAAeC,CAAaH,IAAS,MAAQE,CAAYC,EAAYD,IAAe,IAE7F,KAAeF,MAAsB,MAErC,UAAc,OAAe,QAAY9B,IAAI18B,EAE5C4+B,EAAUC,EAAQ7+B,CAAG,QAAG,EAAS,EAIlC,CAID,UAAsB,EAAGm1B,EAAayJ,EAAS,QAAQ1J,CAAYC,GAAYD,IAE9E,MAAME,EAAUwJ,OAEH,OAAS,SAErB,OAAK,WAAa,IAAK,WAAWxJ,CAAQ,IAAI,EAKzCA,EAAQ,OAAS,SAErBqJ,IAAkB,OAAO,qBAMd,eAAW,CAEvB,MAAK,WAAa,KAAK,YAAarJ,EAAQ,aAiB/C,QAAagH,MAEPn5B,GAAU,YAEJ,YAAkB,MAE5Bm5B,WAAsBA,CAAM,QAAgB,GAI7CA,WAAiB,CAEjB,CAGD,YAAaA,EAAOn5B,EAAOoK,EAAS,CAEnC,IAAK+uB,CAAM,KAAMn5B,IAAW,EAAI,SAEhC,MAAM67B,IAAa,QAIbC,KAA6BC,IAAW,CAE7C,aAAsB,aAAa,IAAKC,CAAQ,EAC3CC,GAAY,OAEhB,QAAK,UAAa,GAAKF,EAAOE,CAAQ,EAIvC,UAAcl/B,EAAG4xB,CAAK,IAAMqN,aAAkB,QAE7CF,EAAgBnN,KAAa,mBAM/B,CAAAmN,GAAgB1xB,CAAQyxB,GAExBA,EAAI,SAAQ,UAAiB1C,QAAmB,QAMjD,SAAY+C,QAEX,CAAM/K,EAAa,SAAO,KAAQ,KAAK,OAAO,UAC7B,QAEjB,KAAUp0B,EAAI,WAAkB,EAAQA,OAEvC,SAAqBo0B,CAAYp0B,MAEjC,CAAKkH,IAAS,QAIf,QAAO,KAIR,SAAYi4B,EAAO,CAElB,MAAM/K,MAAa,GAAO,QAAQ,IAAK,OAAO,EAC9CA,EAAW,QAAS,QAEpB,KAAM+B,CAAU,UAEhB,CAAUn2B,EAAI,MAAkB,SAAQA,OAEvC,KAAem/B,CAAM/K,OAEhBltB,EAASivB,EAAQ,OAEtB,CAED,WAUD,aAAeha,CAAMlZ,EAAQ,CAE5B,WAAwB,GAAMA,EAC9B,MAAiB,KAAK,MAAM,IAAKoyB,CAAQ,IAEzC,CAAK,CAAEC,EAAa,MAEnB,EAASnZ,cAEH,CACJmZ,EAAa,QAAK,OAAWryB,GAC7B,MAED,KAAK,MACJqyB,IAAa,GAAK,cAAY,QAAiB,CAE9C,OAAOgJ,EAAI,cAAgB,SAEjC,KACK,KAED,GAAK,gBACc,SAAY,UAAWA,CAAM,CAE9C,SAAW,YAAgB,WAEjC,KACK,KAED,GAAK,gBACS,SAAK,UAClB,WAEI,YACJhJ,CAAa,KAAK,WAAY,SAAWgJ,EAAM,CAE9C,iBAAW,SAAkBA,CAAI,eAAgBr7B,CAAK,CAE5D,MACK,WAEI,SACS,GAAK,wBAGd,kBACc,WAAY,YAE7B,QAAOq7B,CAAI,cAAgBA,KAAI,cAErC,CACK,OAED,WAAK,SACc,WAAY,cAE7B,gBAAW,IAAeA,EAAI,kBAG/B,QAED,CAAK,UACS,SAAK,IAAUr7B,MAC5B,GAED,WAAK,eACc,WAAY,MAAWq7B,IAExC,QAAW,kBAAqB,eAEtC,GACK,MAED,UAAK,SACS,CAAK,WAAYr7B,cAG/B,GAOC,cANkB,WAAY,KAAWq7B,OAExC,GAAOA,KAAO,WAAY,UAAiBA,OAAI,UAAeniB,CAAMlZ,UAMpE,SAAU,UAAO,YAAmBkZ,aAQvC,CAAK,gBAIN,MAAOmZ,CAEP,CAOD,kBAAwB,CAEvB,QAAmB,KAAK,IAAM,QAE9B,KAAsB,CAErB,MAAMluB,GAAS,IACTg4B,EAAO,MAAK,kBAAiC,OAAO,EAAO,KAAI,CAErEb,KAAe,KAAQ,KAAKa,CAAK,IAAK,YAAgBn8B,CAAQ,CAE7D,UAAc,aAAekZ,EAAMlZ,CAAK,EAExC,GAED,KAAK,MAAM,OAAuB,CAElC,GAED,MAEA,CAOD,WAAYo8B,EAAc,CAEzB,MAAMC,EAAY,cAAU,IAASD,CAAW,EAC1CrL,EAAS,KAAK,WAEpB,GAAKsL,OAAU,CAAQA,EAAU,UAAS,WAEzC,MAAM,IAAI,QAAO,qBAAiC,KAAO,mCAK1D,IAAe,MAAQ,QAAaD,UAEnC,GAAO,QAAQ,QAAS,KAAK,iBAAuB,YAAe,CAAG,MAIvE,MAAM94B,EAAU,QAAK,QAErB,QAAW,gBAAS,CAAWwuB,EAASC,eAEd,aAAsB,EAAKzuB,KAAQ,CAAI,OAAa,OAAW,YAE/E,SAAW,2CAA8C+4B,IAAU,EAAM,SAIrF,CAEE,CAOD,mBAEC,WAAsB,CAAK,OAAK,eAEhC,KAAO,KAAK,yBAAuC,SAAS,OAAM,MAAW3uB,WAEzD4uB,EAAc,aAAc,CACzCxG,aAA2B,QACjC,IAAOpoB,MAAO,EAAOooB,IAAyByG,CAAU,QAW1D,SAAcC,EAAgB,CAE7B,YAAe,CACThL,EAAO,KAAK,UAEE,EAAK,QAAK,QAAwB,EAEtD,GAAK4E,EAAY,eAAe,SAAyB,QAAW,OAAY,IAE/E,GAAMqG,IAAWxD,CAAkB7C,IAAY,UACLA,CAAY,kBACnCA,CAAY,kBAEjB,OAAgBA,CAAY,QAAgB,CAC1D,OAAO,QAAQ,kBAAqCqG,CAAU/F,CAAU,EAExE,CAED,WAEA,OAAKN,IAAY,WAAe,SAEZ,QAAM,QAAK,QAAe,aAAcA,EAAY,UAAU,GAIjFsG,UAAyB,GAIrBtG,IAAY,SAAW,mBAEG,cAAe,aAAcA,EAAY,OAAO,QAAQ,aACtFsG,EAAmB,KAAM,KAAK,kBAAe,YAA0B,UAAO,QAAO,WAI/E,SAAQ,CAAKA,IAAqB,cAAiBC,CAAc,CAEvE,UAAgC,GAE1BF,OAAyC,OACzCG,CAAatG,UAAmC,WAGhDuG,CAAeD,GAAW,iBAC1BE,EAAYD,EAAeJ,KACdrG,CAAY,YAAc,EACvC2G,IAAyB,sBAAgC,uBAAyB,GAAa,kBAC/FrG,EAAaN,EAAY,cAAe,EAC9C,KAAI/C,CAAO2J,EAGX,aAIC,aAAqB,YACfC,CAAa,qBAAuB7G,EAAY,WAAa,IAAMA,EAAY,cAAgB,MAAgB,MAAkB,MACvI,oBAAqC,CAE9B8G,IAEN7J,UAAoC8J,EAAUJ,EAAY3G,EAAY,cAGjE,GAAIgH,GAAmB/J,EAAO0J,EAAaF,CAAY,EAE5D14B,KAAO,IAAM,GAAK84B,EAAYC,KAI/BF,CAAkB,IAAIK,GAA4BH,EAAIT,EAAY3G,EAAaiH,GAAeF,CAAcnG,EAEhH,MAESzC,OAAe,EAEnBZ,EAAQ,IAAIuJ,GAAYxG,CAAY,MAAQqG,CAAQ,EAIpDpJ,EAAQ,MAAgBY,IAAwBmC,EAAY,MAAQqG,IAIrEO,CAAkB,IAAIM,GAAiBjK,EAAOoJ,EAAU/F,CAAU,EAKnE,MAAiB,SAAW,MAAY,CAEvC,SAAwBuC,EAAiB,OACnCsE,EAAoBjH,GAAuBF,EAAY,OAAO,SAAQ,cAEtEoH,EAAoBpH,MAAY,GAAO,QAAQ,iBAC5BA,CAAY,OAAO,OAAO,qBAEzBmH,CAAmBZ,EAAa,CAAC,EAAIa,MAA+B,QAAO,WAChF,CAAIZ,EAAYD,EAAa,CAAC,EAAIc,MAA8B,OAAO,WAExE,SAGD,IAAIH,GAAiBN,EAAgB,SAAM,MAASA,CAAgB,SAAUA,EAAgB,eAIjH,MAAUjgC,EAAI,EAAG08B,EAAKiE,EAAc,OAAQ3gC,EAAI08B,GAAI18B,GAAO,CAE1D,OAAMiD,MAAuBjD,CAM7B,GAJAigC,SAAsBh9B,CAAO29B,EAAc5gC,UAC1B,EAAIigC,IAAgB,IAAMh9B,EAAO29B,EAAc5gC,EAAI0/B,EAAW,CAAC,MAC/D,GAAIO,EAAgB,KAAMh9B,KAAqBjD,GAAI0/B,CAAW,CAAC,GAC3EA,GAAY,GAAIO,IAAgB,GAAMh9B,GAAO29B,EAAc5gC,EAAI0/B,EAAW,CAAC,GAC3EA,GAAY,KAAI,GAAM,IAAI,MAAO,mEAAmE,CAEzG,KAIF,OAID,CAOD,YAAa7I,WAEC,SAAK,CACZtwB,EAAU,OAAK,gBACG,GAAUswB,CAAY,OACf,EACzBgK,EAAYpM,YAElB,IAAIT,KAAS,EAAK,iBAEb6M,QAEJ,KAAMt8B,QAAkB,IAAQ,WAAYs8B,MAAU,CACjDt8B,MAAY,OAAgBA,cAI3B,CAAK,iBAAkBsyB,EAAciK,QAI7C,cAAkBjK,GAAciK,CAAa9M,EAAS,CAErD,MAAM5sB,EAAS,KACTqtB,OAAY,KAEZqC,iBACA+J,CAAYpM,EAAK,qBAEaoM,CAAU,YAAe,OAAiB,OAE9E,KAAK,GAAK,aAAcxL,GAGvB,QAAO,IAAK,sBAIP0L,EAAU,KAAK,gBAAiBD,aAA4B,UAEjEjH,CAAQ,iBAEO/C,CAAW,QAAkB,OAAQ,gBAE9B,UAAY,CACRA,QAAW,CAAO,GAAM,OAElD,GAAA+C,EAAQ,YAAYmH,CAAeC,EAAQ,SAAS,MACpDpH,EAAQ,YAAYmH,CAAeC,EAAQ,YAAeC,GAC1DrH,EAAQ,OAAQkC,EAAiBkF,UAAmBhF,GACpDpC,EAAQ,UAAyBoH,CAAQ,KAAK,WAEvC,eAAkBpH,CAAS,CAAE,WAAsB,GAI7D,CAAK,EAAC,MAAO,YAEV,MAAO,KAEV,EAEE,kBAAK,OAAcxE,CAAU,QAM9B,cAAiByL,SAEhB,EAAM15B,OACAqtB,KAAO,EAAK,OACF,KAAK,aAEhB,GAAK,oBAA+B,IAExC,OAAO,OAAK,YAAaqM,CAAc,MAAQjH,QAAqB,GAAK,KAI1E,YAAuB,EAAQiH,CAAW,EAEpCK,KAAM,EAAK,OAAO,KAAK,YAEzBC,EAAYP,EAAU,KAAO,GAC7BQ,EAAc,KAElB,CAAKR,EAAU,iBAAe,GAI7BO,EAAYh6B,KAAO,WAAe,aAAcy5B,EAAU,UAAY,EAAC,MAAM,aAE9D,GACd,MAAMS,EAAO,gBAA4B,YAAgB,CAAQ,GACjE,UAAYH,CAAI,gBAAiBG,GAC1BF,CAEX,WAEcP,GAAU,KAAQ,UAE7B,GAAM,QAAI,EAAO,2BAA6BC,EAAc,kCAI7D,UAAgB,OAAQ,WAAqB,OAAM,MAAWM,GAE7D,QAAO,IAAI,eAAS,CAAWrM,EAASC,KAEvC,EAAItB,QAEQ,yBAEXA,EAAS,SAAW6N,GAEnB,QAAgB,SAAaA,CAC7B1H,EAAQ,YAAc,oBAQC,kBAA+B,GAAQnG,MAAQ,GAAWsB,GAEvF,CAEA,GAAM,KAAM,WAAqB,CAI9B,OAAKqM,IAAgB,KAEpBF,CAAI,gBAAiBC,MAId,QAAS,SAAWP,KAAU,SAAYhD,CAAqBgD,EAAU,OAIpF,EAAM,MAAO,kBAEV,cAAe,0CAA4CO,QAK5D,iBAAK,MAAaN,CAAa,MAYhC,mBAAwCU,CAAQC,EAAW,IAE1D,QAAe,EAEf,OAAO,MAAK,iBAAe,MAAWD,EAAO,aAAc,QAAW3H,EAAU,KAExEA,EAAU,YAUjB,KANY,cAAa,SAAoB,SAAY,EAAK,IAAI6H,SAAY,EAAWF,EAAO,YAAY,KAE3G,KAAQ,SAAM,+BAAqCA,EAAO,SAAW,sBAA4B,uBAItF,SAAYhN,EAAW,uBAA0B,CAE5D,OAAMsF,CAAY0H,EAAO,qBAA2BA,CAAO,eAAuB,wBAA0B,QAEvG1H,CAAY,CAEhB,aAA6B,UAAa,YACzB,wBAAuB,SAAqB,EAAG,cAAeD,YACxE,QAAa,IAAKA,UAM3B,GAAK4H,qBAEI,eAQZ,CAEE,CAUD,sBAA4B,CAE3B,MAAMtP,MAAgB,SACtB,EAAIwP,EAAWpR,EAAK,SAEpB,MAAMqR,EAAwBzP,EAAS,wBAAuB,IACxD0P,KAA2B,aAAW,KAAU,YACtB,UAAW,WAAW,QAEjDtR,EAAK,SAAW,CAEpB,YAAiB,cAAoBoR,EAAS,cAEzB,OAAK,CAAM,MAAa,CAEtCG,IAENA,EAAiB,SACjBC,CAAS,UAAU,cAAmC,CACtDD,EAAe,MAAM,KAAMH,EAAS,KAAK,KAC1B,IAAMA,CAAS,IAC9BG,EAAe,sBAEf,KAAK,KAAM,EAAKzM,EAAUyM,CAAc,GAIzCH,KAEH,OAAcpR,MAAK,GAAS,CAEzB,MAAM8E,GAAW,oBAAuBsM,EAAS,KAEjD,KAAIK,CAAe,KAAK,MAAM,OAEvBA,IAENA,EAAe,MAAIC,CACnBF,MAAS,qBAA2C,CACpDC,EAAa,MAAM,KAAML,EAAS,KAAK,KAEvC,IAAK,IAAM,IAAKtM,EAAU2M,GAAY,CAIvCL,EAAWK,CAEX,EAGD,UAAkE,CAEjE,IAAI3M,KAAW,kBAA6B,QAEvCuM,MAAwBvM,CAAY,wBACpCwM,IAAkBxM,GAAY,sBACbA,GAAY,iBAElC,YAA0B,SAAWA,CAAQ,EAEtC6M,IAENA,EAAiBP,EAAS,QAErBE,MAAiC,gBAAe,CAChDM,OAAgC,cAAc,CAE9CP,KAGCM,CAAe,cAAcA,MAAe,QAAY,aACzC,sBAAsC,sBAAqB,CAAK,eAIhF,CAAM,IAAK7M,EAAU6M,CAAc,EAExC,oBAAkB,EAAKA,EAAgB,qBAAkB,CAAKP,CAAQ,IAIvEA,EAAWO,CAEX,IAIa,MAAS/P,IAAS,UAAW,aAAqBA,IAAS,oBAAkB,IAEjF,iBAAc,EAAOA,EAAS,WAAW,GAAE,CAIrD5B,EAAK,SAAWoR,CAEhB,UAED,UAEC,MAAOtF,YASR,KAAc9F,CAAgB,CAE7B,YAAe,CACT9B,EAAO,YACM,kBACCA,EAAK,UAAW8B,CAAa,YAGjD,EAAML,EAAiB,KACIG,EAAY,YAAc,KAErC,GAEhB,IAAK+L,CAAoB5N,UAAW,cAEnC,OAAM6N,CAAejO,EAAYI,KAAW,oBAC7B6N,EAAa,kCACD,QAA8BhM,EAAajvB,CAAM,EAE/E,qBAKyC,qBAKtC,EAHA8uB,EAAe,MAAQ,cACvBA,EAAe,WAEV,MAAM,yBAA0C,CAAK,CAEzD,MAAMI,EAAQF,KAAkB,aAEhCF,EAAe,SAAM,QAAWI,QACjB,kBAIO,YAAqB,gBAE7BlvB,CAAO,iBAA+B,KAAOgvB,QAAkB,wBAI/D,OAA8B,0BAAiD,2BAC/E,CAAYA,EAAkB,+BAAkD,YAAkB,cAE1F,iBAA6B,eAE3C,CAAMhvB,EAAO,wBAA+B,6BAAkC,OACtF+uB,EAAQ,KAAM/uB,IAAO,gBAA+B,gBAAkC,4BAIvFk7B,CAAe,QAAK,gBAAY,CAAWhE,EAAM,CAEhD,YAAW,4BAAuB,IAAiB/H,CAAa,CAEpE,IAEGJ,CAAQ,UAAM,SAAa,GAAK,yBAE/B,mBAAW,YAA4B,4BAEnC,CAEL,QAEgB,UAAgB,uBAMfE,EAAY,sBAqB9B,EAnBKkM,IAAcC,GAAY,cAEf,OAAc,GAG7BtM,IAAe,UAAa,IAI5BA,UAAe,IAAc,OAEVsM,GAAY,OAE9BtM,MAAe,eAAwB,gBAAwC,mBAMhE,gBAAkB,aAA8BD,cAE3C,uBAA+B,IAAaI,EAAY,eAAa,CAE1FH,EAAe,YAAc,IAAI55B,GAAS,IAAI,CAEzC+5B,EAAY,cAAc,YAAU,IAAY,aAE1B,gBAAc,IAEzB,wBAMjB,MAAiB,mBAAqB,gBAA8BJ,CAEnEE,KAAQ,EAAM/uB,YAAO,IAAe8uB,EAAgB,UAAqB,mBAEpEG,EAAY,iBAAiB,uBAElB,6BAA6B,IAAiB,iBAM9C,gBAAmB,KAAaiM,gBAEjC,mBAAuB,SAAuB,mBAI7C,eAAoB,eAA8BrM,CAElEE,GAAQ,IAAM/uB,EAAO,0BAA+B,IAAeivB,gBAAY,EAAiBoM,KAI1F,QAAQ,IAAKtM,CAAS,KAAC,EAAM,cAEnC,GAAMwL,YAEN,mBAAiC,GAAOtL,EAAY,QAEpDP,CAAwB6L,GAAUtL,EAElCjvB,EAAO,aAAa,QAAiB,SAAWmvB,CAAa,QAE5C,SAAamM,GAAgCtO,IAAsBiC,GAE7EsL,IAOT,wBAEC,IAAsBgB,GAAgB,iBAAkBC,UAExD,CAAI7+B,GAAO8+B,CAEX,QAAU7iC,EAAI,iBAAQ,IAAe+D,KAAW/D,EAE/C+D,GAAO8+B,CAAgB,gBAIxB,EAAK,cAAe9+B,GAAS,IAI7B,CAUD,sBAEC,EAAMqD,EAAS,KACTgtB,EAAa,KAAK,aACV,cAAK,MAEnB,iBAEC,IAAOA,KAAuB,yBAA4B,EACxD,oBAAoC,CACpC,QAAM,MAAWjC,MAEjB,IAAO2Q,2BAQV,iBAAiC,EAAQ9iC,EAAI08B,EAAI18B,IAAO,CAEvD,QAAkB+iC,EAAY/iC,QACOw3B,GAG/BwL,EAAS5G,EAAO/G,GAEtB,GAAK2N,KAGI,IAAMA,EAAO,aAEf,CAEN,QAEe,eAAwB,UAAYxO,EAAW,gCAGrBgD,MAKtBsL,IAAwB,EAAIG,GAAkBzL,UAK7C,CAAE,aAAsB,6BAQvC,OAAQ,IAAKrB,EAEpB,CAOD,SAAU+M,EAAY,CAErB,MAAM97B,SACO,UACPgtB,EAAa,QAAK,WAERK,CAAK,OAAQyO,CAAS,GAChCH,CAAaxL,EAAQ,WAErBpB,EAAU,KAEhB,OAAUn2B,CAAI,EAAG08B,IAAgB,OAAQ18B,KAAQA,WAE1C2hC,CAAWoB,EAAY/iC,CAAG,OAAC,MAAa,YACpB,GAAK,MAAO,CACnC,KAAK,cAAe,cAAyB,EAAG,cAE3C,GAAM2hC,IAIf,MAAAxL,IAAQ,MAAa,oBAEd,UAAaA,CAAS,EAAC,YAAM,EAAW0B,EAAU,IAExD,GAAMsL,OAAoB,GAAO,IAAW,iBACR,YAErB,IAEf,QAAc,SAAmB,IAAQnjC,KAAQA,GAAO,CAEvD,MAAMmyB,EAAWiR,EAAYpjC,OACCA,GAI9B,IAAIuwB,EAEJ,OAAMoR,CAAWwB,EAAWnjC,GAE5B,GAAKw3B,GAAU,MAASC,GAAgB,WACtCD,EAAU,OAASC,KAAgB,cACnCD,IAAU,QAAyB,iBACzB,MAAS,SAGbD,EAAQ,0BACKpF,EAAUwP,CAAU,KACrC,CAAI0B,IAAMlR,CAAUwP,YAEb,SAAkB,MAAUpR,CAAK,mBAAS,CAAW,WAAW,YAIzEA,EAAK,qBAAoB,EAIrBiH,EAAU,YAAyB,sBAElC,WAAqC,wBAEI,YAE9CjH,EAAK,eAAqC,WAA6B,cAInD,KAASkH,MAAgB,GAE9ClH,EAAO,aAAoC,aAEtB,GAASkH,GAAgB,WAE9ClH,EAAO,KAAI+S,GAAMnR,CAAUwP,CAAQ,UAExBnK,MAAU,GAASC,GAAgB,aAEvC,GAAI8L,GAAUpR,IAAkB,gBAElB,EAASsF,IAAgB,MAE9ClH,EAAO,KAAIiT,GAAQrR,CAAUwP,CAAQ,MAIrC,cAAU,GAAO,iDAAmDnK,EAAU,MAI1E,OAAO,SAAW,OAAS,sBAAkB,KAEjD4F,YAII,GAAOh2B,EAAO,kBAAkBmwB,CAAQ,UAAU,gBAIlDC,CAAU,aAAakL,EAAgCtO,EAAY7D,EAAMiH,MAEvE,mBAAqBjH,GAE5BkT,IAAO,GAAMlT,KAId,OAAUvwB,CAAI,EAAG08B,EAAK+G,EAAO,WAAgBzjC,IAE5CoH,EAAO,2BACN,GAAQ87B,EACR,YACL,IAIG,EAAKO,EAAO,WAEX,OAAOA,EAAQ,cAIF,CAAIC,GAElBt8B,EAAO,aAAa,WAAc,GAAQ87B,CAAS,GAEnD,SAAUljC,CAAI,EAAG08B,EAAK+G,MAAO,GAAQzjC,EAAI08B,MAExCiH,EAAM,IAAKF,GAAW,GAIvB,YAWF,cAEC,GAAIG,EACJ,OAAMC,CAAY,KAAK,SAAK,IAASC,CAAW,EAC1Ch5B,EAAS+4B,EAAWA,GAAU,GAAI,EAExC,QAEC,eAAc,6CACd,MAEA,EAED,YAAe,KAAS,kBAEVE,SAA6B,OAAUj5B,CAAO,UAAe,WAAe,MAAU,OAAYA,EAAO,aAEjG,OAAS,iBAE9B84B,KAAS,CAAII,GAAoB,WAAsB,IAAMl5B,EAAO,KAAM,CAAEA,EAAO,OAAa,MAAOA,EAAO,OAI1G+4B,EAAU,YAAc,EAAO,OAAK,kBAA4B,OAErE/N,EAAwB8N,EAAQC,IAEzB,QAAQ,OAASD,EAExB,CAOD,SAAUlF,EAAY,IAErB,KAAgB,iBAA0B,EAEpCvI,KAEN,QAAUn2B,EAAI,QAAgB,QAAO,IAAQA,QAE5Cm2B,EAAQ,OAAM,GAAK,eAAe,MAAQ8N,EAAQ,QAAW,IAI9D,WAAa,sBAAwB,KAEpC9N,cAAmB,gBAAe,YAAoB,sBAI9C,OAAM,GAIR,WAAQ,CAAKA,aAAgB,UAEnC,GAAM+N,oBAIAC,CAAe,GAErB,UAAc,EAAGzH,OAAgB,IAAQ18B,EAAI08B,EAAI18B,IAAO,CAEvD,QAAkBokC,EAAYpkC,OAEzBqkC,CAAY,CAEhBC,EAAM,KAAMD,GAEZ,MAAME,EAAM,IAAIvM,IAEXkM,IAAwB,KAE5BK,EAAI,UAAWL,EAAoB,MAAOlkC,KAAM,CAIjDmkC,EAAa,KAAMI,EAExB,MAEK,QAAQ,KAAM,oDAAoDN,CAAQ,OAAQjkC,CAAC,OAMrF,KAAO,EAAIwkC,KAAiBL,WAW9B,QAAeM,EAAiB,CAI/B,OAAMC,CAFO,MAAK,MAEQ,WAA0B,CAE9CC,EAAe,QAEfC,IAAyB,CACzBC,EAAkB,GAClBC,EAAiB,GAEvB,aAAiBpI,CAAKgI,EAAa,SAAS,SAAYhI,WAEvD,EAAMqI,EAAUL,EAAa,SAAU1kC,CAAC,EAClCihC,EAAUyD,EAAa,UAAUK,CAAQ,OAAO,EAChDviC,EAASuiC,SACThhC,OAAc,EACdiB,EAAQ0/B,EAAa,aAAe,SAAyB,gBAAoB,UAAkB,EACnGM,EAASN,EAAa,eAAe,KAAYA,UAAa,GAAYzD,IAAQ,eAExF0D,EAAa,MAAM,IAAK,oBAAe,CAAQ5gC,CAAI,KAC7B,KAAM,UAAK,SAAe,WAAYiB,CAAK,KAC1C,KAAM,cAAK,MAAe,YAAkB,KACnD,cACKxC,EAErB,QAEM,QAAQ,IAAK,CAEnB,kBACA,UAAoC,EACpC,UAAQ,EAAKoiC,CAAwB,EACrC,QAAQ,OACR,QAAQ,IAAKE,CAAgB,CAEhC,OAAM,CAAM,cAET,IAAMG,EAAQ1G,EAAc,OACS,IAC/B2G,CAAkB3G,EAAc,QACP,IACfA,EAAc,SAI9B,OAAUv+B,EAAI,KAAQilC,CAAM,QAAQjlC,CAAI08B,EAAI18B,MAE3C,KAAMmlC,EAAOF,EAAOjlC,GACdolC,EAAgBC,EAAgBrlC,GAChCslC,EAAiBJ,EAAiBllC,GAClCihC,EAAUsE,EAAUvlC,GACpBwC,EAAS6rB,EAASruB,GAExB,IAAKmlC,IAAS,MAAY,SAE1BA,EAAK,aAAY,EAEjB,IAAIK,EAEJ,OAASC,GAAiBjjC,EAAO,IAAM,GAEtC,KAAKijC,GAAgB,QAEpBD,IAAqBE,CACrB,UAED,CAAKD,cAEiBE,GACrB,MAED,MAAKF,GAAgB,QACrB,MAAKA,GAAgB,QACrB,KAECD,MACA,KAIF,YAAwB,KAAOL,CAAK,KAAOA,KAAK,GAE1CS,SAAwB,cAAkB,QAA2B3E,CAAQ,gBAAkB4E,EAE/FxI,GAAc,IAEfoI,EAAiBjjC,KAAO,CAAI,MAAOijC,CAAgB,kBAElD,CAAU,SAAWp4B,EAAS,CAE7BA,EAAO,uBAEXgwB,GAAY,MAAMhwB,CAAO,KAAOA,QAAcA,CAAO,UAQvDgwB,CAAY,QAAMyI,CAInB,IAAIC,sBAEgB,QAEnB,OAAcpI,EAA6BoI,KAAY,SAAW,EAC5DC,MAAS,CAAI,iBAA0B,KAAM,WAEzCC,EAAI,KAAQF,GAAY,iBAAgBE,CAEjDD,GAAQC,IAAMF,aAIDC,CAEd,EAED,OAAUC,EAAI,GAAGC,IAAK7I,CAAY,OAAQ4I,EAAIC,OAAW,CAExD,MAAMC,GAAQ,IAAIX,EACjBnI,GAAa4I,CAAC,EAAK,IAAMR,GAAiBjjC,IAAO,IACjD4iC,EAAc,MACdW,QAKI9E,CAAQ,gBAAkB,gBAE9BkF,GAAM,mBAAoB,oBAMC,eAAgBR,GAA4BjK,GAAuC1B,iBAEjF,SAAK,CAAO,SAAK,GAAQ,KAAK,cAAY,CAAK,EAAG9yB,CAAM,EAE3F,CAGMi/B,MAAM,kBAAkB,uCAA4C,oBAUvE,0CAEO,EAAIC,GAAeriC,EAAM,OAAWsiC,CAAM,CAEpD,KAIC,gBAEC,YAAa,CAAK,SACH,IACTjR,CAAUX,EAAK,OAAgB,EAErC,oBAAsB,GAAmB,MAElCrtB,CAAO,cAAe,OAAQguB,EAAQ,MAAO,SAAM,OAAkB,CAE3E,MAAM+P,EAAO/9B,KAAO,gBAAoB,MAAWguB,CAAQ,OAAM7E,CAGjE,cAAa,SAAY,IAExB4U,YAAe,YAEd,EAAO9zB,KAAE,IAET,QAAUrR,QAAoB,QAAQ,aAAgBA,SAEnD,mBAAwB,CAAKo1B,GAAQ,OAASp1B,EAItD,OAeC,SAAUk1B,EAAY,CAErB,MAAMT,qBACkB,aACT,GAETW,EAAUX,EAAK,WAGJW,EAAQ,OAAc,mBAA0B,WAEjE,OAAS,UAER,KAAMkR,EAAgB,KAEFl/B,EAAO,iBAAY,GAAWk3B,IAEjD,WAAW,iBAAsB,oBAI7BiI,CAEJD,QAAoBC,EAIhBnR,EAAQ,SAAW,cAET,CAAMhuB,EAAO,eAAe,QAAUguB,EAAQ,MAAQ,EAAC,SAAM,OAAoB,CAE9F,SAAc,gBAAoB,UAAaA,EAAQ,OAAQwO,KAE/D,CAIFx8B,QAAO,UAAY,cAEXk3B,EAAI,sBAAwBA,EAAI,yBAE3C,CAAO,SAAS,uBAMb,wBAC4B,CAAY,GAExC,SAAUt+B,CAAI,QAAoB,KAAQA,KAAQA,GAEjDwmC,EAAa,MAAMp/B,CAAO,iBAAe,IAAQq/B,IAAgB,IAIlE,KAAMC,EAAkBtR,EAAQ,OAAS,OACtC,QAAQ,eACRhuB,CAAO,cAAe,OAAQguB,EAAQ,KAAI,CAE7C,OAAO,SAAQ,QACd,KAAQ,GAAKkR,CAAe,aACpB,CAAKE,CAAc,IAE/B,CAEA,OAAQ,EAAM,cAEX,IAAMvR,EAAU4C,OACCA,IAAS,CACpB8O,EAAW9O,QAEjB,CAAIsN,GAqBJ,EAlBK/P,EAAQ,WAAW,CAEvB+P,QAAWyB,CAEA3R,EAAQ,OAAS,EAE5BkQ,EAAO,IAAIzB,GAEAzO,EAAQ,WAEnBkQ,EAAOlQ,GAAS,EAIhBkQ,OAAW0B,EAIP1B,IAASlQ,EAAS,GAEtB,YAAiByH,EAAKzH,EAAQ,OAAQj1B,EAAI08B,OAEzCyI,CAAK,IAAKlQ,EAASj1B,CAAG,GAiBxB,GAXKo1B,GAAQ,MAEZ+P,EAAK,SAAS,KAAO/P,EAAQ,KAC7B+P,MAAK,CAAO2B,GAIbhR,GAAwBqP,EAAM/P,KAEjB,YAAasN,IAAgCtO,CAAY+Q,EAAM/P,UAE/D,KAAW,OAEvB,OAAM2R,CAAS,KAAI/O,EACnB+O,EAAO,cAAmB,MAC1B5B,EAAK,aAAc4B,EAEvB,MAES3R,EAAQ,cAAgB,YAEvB,SAAS,gBAAmB,QAI7BA,CAAQ,aAAa,OAEzB+P,CAAK,aAAW,UAAmB,cAIvB,YAAU,EAEtBA,KAAK,GAAM,aAAmB,UAMlB,WAAa,IAAKA,KAE/B/9B,CAAO,iBAAkB+9B,UAInB,WAAa,aAAoBjQ,IAEnCyR,EAAa,iBAIF,SAAWpW,EAAO,CAEzBA,aAAK,IAEZA,EAAK,OAAgBwN,GAE1B,GAIG,QAAU/9B,SAAqB,SAAY08B,CAAI18B,IAE9CmlC,cAID,QAID,CAOD,WAAW6B,CAAa,GAEvB,IAAM5S,EAAa,SAAK,OAClB6S,EAAW,KAAK,KAAK,QAAkB,EACvC7/B,EAAS,UAID,CAAIs8B,GACbuD,KAAS,OAAa,WAAc,YAAkBA,OAAS,EAEpEnR,GAAwBoR,KAEnBD,EAAS,cAAavE,CAAgCtO,EAAY8S,EAAOD,IAE9E,mBAEM9Q,EAAU,KAEhB,MAAUn2B,EAAI,EAAG08B,EAAKyK,WAAoBzK,EAAI18B,IAE7Cm2B,EAAQ,SAAa,YAAe,OAAQgR,IAAY,IAIzD,MAAO,SAAQ,GAAKhR,CAAS,EAAC,KAAM,oBAEzBn2B,EAAI,IAAQilC,EAAM,OAAQjlC,MAAQA,QAEhCilC,IAAU,EAMtB,MAAMmC,SAEL,GAAMC,IAAsB,IAAI,EAEhC,aAAwB,IAAMjgC,EAAO,cAE/B9D,aAAey+B,KAAYz+B,cAAegkC,MAE1B,GAAKhkC,EAAKZ,GAMhC,cAAK,IAAYyiC,UAEVjG,GAAW93B,CAAO,aAAa,IAAK+9B,CAAI,EAEzCjG,IAAY,KAEhBmI,OAAyBlC,CAAMjG,EAIrC,QAMG,KAAA93B,KAAO,iBAIV,CAEE,GASF,WAAwB+qB,EAAUqL,EAAcp2B,GAE/C,MAAMswB,EAAa8F,EAAa,sBAIhC,CAAK9F,EAAW,gBAAa,GAE5B,MAAME,EAAWxwB,KAAO,EAAK,aAAsB,SAE7CvL,GAAM+7B,CAAS,UACA,EAIrB,KAAK/7B,EAAQ,QAAaC,IAAQ,cAE7B,GACH,QAAkB,CAAG,EAAED,EAAK,CAAG,GAAEA,CAAK,EAAK,EAC3C,IAAIjB,EAASkB,EAAK,CAAG,EAAEA,IAAQ,CAAEA,EAAK,EAAK,CAC/C,EAEQ87B,IAAS,SAAa,GAE1B,IAAM2P,EAAW5J,GAA6BpE,GAAuB3B,EAAS,aAAe,GAC7F4P,EAAI,IAAI,sBACJ,EAAI,eAAgBD,cAMzB,GAAQ,KAAM,+EAMjB,SAEE,IAID,KAAMlZ,UAAuB,IAE7B,CAAKA,QAAY,SAEhB,CAAMoZ,EAAkB,OAClBC,CAAS,KAAI9sC,CAEnB,YAAiB8hC,EAAKrO,EAAQ,QAAQruB,CAAI08B,EAAI18B,IAAO,CAEpD,MAAMwC,EAAS6rB,KAEf,GAAK7rB,GAAO,UAAa,QAExB,MAAMo1B,EAAWxwB,OAAY,UAAW5E,KAAO,OACzC3G,GAAM+7B,CAAS,UACA,EAIrB,KAAK/7B,EAAQ,QAAaC,IAAQ,cAG1B,WAAW,EAAK,OAAK,EAAKD,EAAK,CAAC,GAAM,KAAK,OAAW,CAAI,IACjE6rC,EAAO,KAAM,MAAK,GAAK,KAAK,IAAK7rC,IAAU,KAAE,IAAK,EAAKC,EAAK,CAAC,CAAI,KACjE4rC,CAAO,KAAM,KAAK,IAAK,KAAK,IAAK7rC,IAAU,KAAE,IAAK,EAAKC,EAAK,CAAC,CAAI,KAG5D87B,CAAS,WAAa,CAE1B,MAAM2P,KAAwChO,IAAuB3B,CAAS,aAAe,MACtF,cAAgB2P,WAU7B,OAEK,QAAQ,gBAAM,mEASb,UAAgBE,GAIrBtV,IAAS,WAAcqV,CAEvB,YAAmBG,SAEf,MAAWC,eACR,IAASJ,EAAI,WAAI,QAAgB,CAAK,EAAG,GAEhDrV,CAAS,eAAiByV,CAE3B,CAQA,SAAS9E,OAAgD17B,EAAS,CAEjE,cAAgC,OAE1B+uB,EAAU,GAEhB,cAAiDgC,CAAgB,CAEhE,SAAc,gBAAe,eAC3B,EAAM,YAENhG,EAAS,aAAcgG,EAAeP,aAMzC,EAAYiQ,QAEX,SAA2BzO,SAAqD,kBAGrDjH,EAAS,eAE5B,KAAM2V,CAAyBpQ,EAAYmQ,CAAmB,KAEtE,CAED,IAAKrK,CAAa,iBAAY,CAAa,CAAErL,EAAS,MAAQ,UAE5C/qB,CAAO,cAAe,iBAAyB,GAAS,IAAC,GAAM,SAAWwwB,EAAW,KAE5F,kBAIF,CAAMA,SAIf,CAAA9B,GAAwB3D,OAExB4V,CAAe5V,KAAwB/qB,SAEhC,CAAQ,IAAK+uB,CAAS,QAAO,YAEnC,UAAoB,OAAY,OAC7BqG,GAAiBrK,EAAUqL,OAAa,IAAiB,EACzDrL,CAEL,KC3sIA,SAAmB,EAAI,QAEvB,SAAM6V,QAAoBC,EAAO,EAEhC,YAAaC,CAAU,CAEtB,MAAOA,KAEP,GAAK,YAAc,MACnB,GAAK,uBACA,YAAgB,KACrB,YAAK,QAAiB,cAEjB,QAAc,cACd,KAAa,KAClB,eAAK,KAAmB,CACxB,KAAK,kBAAkB,CAEvB,UAAK,yBACM,uBACF,IACR,wBACI,UAEL,CAAK,yBACJ,OAAU,sBACF,6BACD,UACH,cACP,CAEE,CAED,oBAEC,qBAAK,CAAcpT,GAEZ,cAIR,iBAEC,UAAK,iBAMN,wBAEC,UAAK,mBAMArB,EAAKC,KAAoBK,CAAU,cAErBE,EAAY,QAAK,KAAO,CAE3CD,WAAgB,OAAK,KACd,gBAAiB,qBACjB,gBAAkB,KAAK,mBACvB,cAAoB,oBAAK,KAEzB,cAEN,CAAK,qBAAkC,MAAOD,eAMhD,UAAiBpjB,EAAQ/H,EAAUu/B,KAElC,gBACC,MAAcA,KAAgB,GAAK,sBACnC,eAAgBC,CAAkB,eAAK,4BAE1C,eAEc,8BAIb,aAAgBz3B,CAAQ03B,EAAa,CAEpC,QAAgB,KAAK,eAIrB,CAAKC,GAAW,MAAK33B,CAAW,CAE/B,gBAAyC,EAEzC,GAAK43B,MAAW,EAAQC,KAEvB,UAAkB,IAEZ,GAAK73B,EAAO,cAAe,CAMjC,QAAM,EAAI,MAET,+GAGL,IAQE,UACM83B,SAAc,oBACH93B,CAAO,gBAIA,EAAK,aAAoB+3B,CAAU,EACzD,KAAQC,gBAIG,IAAS,CAAE5T,EAASC,UAEvB,QAAYyT,UAAa,EAAA1T,EAAS,OAAAC,CAAM,EAE/C4T,EAAO,cAAe,IAAM,iBAAsB,YAAY,SAAYj4B,CAAQ,EAIvF,GAEM,WACmB,MAAK,cAAiBk4B,WAAgB,EAI7D,OAAAC,EACE,MAAO,IAAM,KACb,IAAM,IAAM,CAEPF,eAEC,WAAsBH,EAMhC,OAGa,GAAK93B,KAEf,EAAK63B,EACL,SAEH,GAESM,CAEP,CAED,wBAEC,CAAM3W,EAAW,IAAI8Q,GAEhB8F,IAAa,OAER,UAAU,GAAIxI,GAAiBwI,gBAA2B,EAIpE,QAAU/oC,EAAI,GAAGA,CAAI+oC,EAAa,WAAW,SAAQ/oC,IAEpD,KAAM45B,MAAyB,SAAY55B,CAAC,IAC/B45B,IAAU,GACjBtD,EAAQsD,EAAU,YACG,OAE3BzH,EAAS,aAAcpuB,WAAkC27B,CAAQ,EAEjE,CAED,QAEA,CAED,aAAcjM,SAEb,EAAMO,aAAyB,CAAK,QAAO,CAC3C,YAAO,eAAc,WACd,eAAiBgV,OACjB,kBAAoB,KAAK,gBAEzB,eAAwBhU,IAAY,CAE1ChB,mBAA4C,CAE/C,IAIC,gBAEC,KAAK,aAAY,EAEV,IAEP,IAED,WAAe,CAEd,GAAK,SAAK,cAAiB,aAAY,oBAEzB,MAAO,mBAAgB,OAAY,KAAK,eAAc,MAAS,EACvEiV,OAEN,YAEkB,EAAM,OAAK,qBAAc,SAAoB,MAAM,SAInD,EAAM,OAAK,kBAAc,kBAAyB,OAAM,CACzEA,EAAiB,QAAM,KAAK,aAAc,oBAAsB,WAAa,IAI9E,KAAK,kBAAiB,eACpB,KAAuB,CAEvB,aAEOC,IAEN,KAAK,eAAc,YAAwB,CAAC,GAI7C,MAAMC,EAAKC,MAAY,QAEjBC,EAAO,CACZ,8BAGA,YACAF,EAAG,YAAc,QAAS,OAAWA,QAAG,MAAa,IAAO,CACjE,EAAM,OAAM;AAAA,GAER,KAAK,gBAAkB,IAAI,gBAAiB,IAAI,KAAM,CAAEE,CAAM,GAElE,GAES,KAAK,cAEZ,CAED,WAAYZ,EAAQC,EAAW,CAE9B,OAAO,KAAK,eAAe,KAAM,IAAM,CAEtC,GAAK,KAAK,WAAW,OAAS,KAAK,YAAc,CAEhD,MAAME,EAAS,IAAI,OAAQ,KAAK,eAAe,EAE/CA,EAAO,WAAa,GACpBA,EAAO,WAAa,GACpBA,EAAO,UAAY,EAEnBA,EAAO,YAAa,CAAE,KAAM,OAAQ,cAAe,KAAK,aAAa,GAErEA,EAAO,UAAY,SAAWp1B,EAAI,CAEjC,MAAMq1B,EAAUr1B,EAAE,KAElB,OAASq1B,EAAQ,KAAI,CAEpB,IAAK,SACJD,EAAO,WAAYC,EAAQ,EAAE,EAAG,QAASA,GACzC,MAED,IAAK,QACJD,EAAO,WAAYC,EAAQ,EAAE,EAAG,OAAQA,GACxC,MAED,QACC,QAAQ,MAAO,2CAA6CA,EAAQ,KAAO,GAAG,CAE/E,CAEN,EAEI,KAAK,WAAW,KAAMD,EAE1B,MAEI,KAAK,WAAW,KAAM,SAAWt7B,EAAGK,EAAI,CAEvC,OAAOL,EAAE,UAAYK,EAAE,UAAY,GAAM,CAE9C,GAIG,MAAMi7B,EAAS,KAAK,WAAY,KAAK,WAAW,OAAS,GACzD,OAAAA,EAAO,WAAYH,CAAQ,EAAGC,EAC9BE,EAAO,WAAaF,EACbE,CAEV,EAEE,CAED,aAAcA,EAAQH,EAAS,CAE9BG,EAAO,WAAaA,EAAO,WAAYH,CAAM,EAC7C,OAAOG,EAAO,WAAYH,GAC1B,OAAOG,EAAO,WAAYH,EAE1B,CAED,OAAQ,CAEP,QAAQ,IAAK,cAAe,KAAK,WAAW,IAAOG,GAAYA,EAAO,SAAS,EAE/E,CAED,SAAU,CAET,QAAU,EAAI,EAAG,EAAI,KAAK,WAAW,OAAQ,EAAG,EAE/C,KAAK,WAAY,CAAG,EAAC,UAAS,EAI/B,YAAK,WAAW,OAAS,EAEpB,KAAK,kBAAoB,IAE7B,IAAI,gBAAiB,KAAK,iBAIpB,IAEP,CAEF,CAIA,SAASQ,IAAc,CAEtB,IAAIE,EACAC,EAEJ,UAAY,SAAW/1B,EAAI,CAE1B,MAAMq1B,EAAUr1B,EAAE,KAElB,OAASq1B,EAAQ,KAAI,CAEpB,IAAK,OACJS,EAAgBT,EAAQ,cACxBU,EAAiB,IAAI,QAAS,SAAWxU,EAAsB,CAE9DuU,EAAc,eAAiB,SAAWE,EAAQ,CAGjDzU,EAAS,CAAE,MAAOyU,CAAK,EAE7B,EAEK,mBAAoBF,CAAa,CAEtC,GACI,MAED,IAAK,SACJ,MAAM34B,EAASk4B,EAAQ,OACjBR,EAAaQ,EAAQ,WAC3BU,EAAe,KAAQE,GAAY,CAElC,MAAMD,EAAQC,EAAO,MACfrS,EAAU,IAAIoS,EAAM,QACpBE,EAAgB,IAAIF,EAAM,cAChCE,EAAc,KAAM,IAAI,UAAW/4B,CAAM,EAAIA,EAAO,YAEpD,GAAI,CAEH,MAAMwhB,EAAWwX,EAAgBH,EAAOpS,EAASsS,EAAerB,GAE1DuB,EAAUzX,EAAS,WAAW,IAAO0X,GAAUA,EAAK,MAAM,QAE3D1X,EAAS,OAAQyX,EAAQ,KAAMzX,EAAS,MAAM,MAAM,QAEzD,KAAK,YAAa,CAAE,KAAM,SAAU,GAAI0W,EAAQ,GAAI,SAAA1W,GAAYyX,EAEhE,OAAS1W,EAAQ,CAEjB,QAAQ,MAAOA,GAEf,KAAK,YAAa,CAAE,KAAM,QAAS,GAAI2V,EAAQ,GAAI,MAAO3V,EAAM,OAAS,EAE/E,QAAe,CAETsW,EAAM,QAASE,GACfF,EAAM,QAASpS,EAEf,CAEN,GACI,KAED,CAEH,EAEC,SAASuS,EAAgBH,EAAOpS,EAASsS,EAAerB,EAAa,CAEpE,MAAMF,EAAeE,EAAW,aAC1BD,EAAiBC,EAAW,eAElC,IAAIyB,EACAC,EAEJ,MAAMC,EAAe5S,EAAQ,uBAAwBsS,CAAa,EAElE,GAAKM,IAAiBR,EAAM,gBAE3BM,EAAgB,IAAIN,EAAM,KAC1BO,EAAiB3S,EAAQ,mBAAoBsS,EAAeI,CAAa,UAE9DE,IAAiBR,EAAM,YAElCM,EAAgB,IAAIN,EAAM,WAC1BO,EAAiB3S,EAAQ,yBAA0BsS,EAAeI,CAAa,MAI/E,OAAM,IAAI,MAAO,gDAIlB,GAAK,CAAEC,EAAe,GAAE,GAAMD,EAAc,MAAQ,EAEnD,MAAM,IAAI,MAAO,uCAAyCC,EAAe,UAAW,GAIrF,MAAM5X,EAAW,CAAE,MAAO,KAAM,WAAY,CAAE,GAG9C,UAAYgG,KAAiBgQ,EAAe,CAE3C,MAAM8B,EAAgB,KAAM7B,EAAgBjQ,CAAe,GAE3D,IAAIyB,EACAsQ,EAMJ,GAAK7B,EAAW,aAEf6B,EAAc/B,EAAchQ,GAC5ByB,EAAYxC,EAAQ,uBAAwB0S,EAAeI,CAAW,MAEhE,CAIN,GAFAA,EAAc9S,EAAQ,eAAgB0S,EAAeN,EAAOrB,EAAchQ,CAAe,IAEpF+R,IAAgB,GAAM,SAE3BtQ,EAAYxC,EAAQ,aAAc0S,EAAeI,CAAW,CAE5D,CAED/X,EAAS,WAAW,KAAMgY,EAAiBX,EAAOpS,EAAS0S,EAAe3R,EAAe8R,EAAerQ,CAAW,EAEnH,CAGD,OAAKoQ,IAAiBR,EAAM,kBAE3BrX,EAAS,MAAQiY,EAAaZ,EAAOpS,EAAS0S,CAAa,GAI5DN,EAAM,QAASM,GAER3X,CAEP,CAED,SAASiY,EAAaZ,EAAOpS,EAAS0S,EAAgB,CAGrD,MAAMO,EADWP,EAAc,YACD,EACxBtK,EAAa6K,EAAa,EAE1BC,EAAMd,EAAM,QAAShK,CAAU,EACrCpI,EAAQ,wBAAyB0S,EAAetK,EAAY8K,CAAG,EAC/D,MAAMrnC,EAAQ,IAAI,YAAaumC,EAAM,QAAQ,OAAQc,EAAKD,GAAa,QACvE,OAAAb,EAAM,MAAOc,GAEN,CAAE,MAAOrnC,EAAO,SAAU,CAAC,CAElC,CAED,SAASknC,EAAiBX,EAAOpS,EAAS0S,EAAe3R,EAAe8R,EAAerQ,EAAY,CAElG,MAAM2Q,EAAgB3Q,EAAU,iBAE1B4Q,EADYV,EAAc,aACFS,EACxB/K,EAAagL,EAAYP,EAAc,kBACvCQ,EAAWC,EAAkBlB,EAAOS,CAAa,EAEjDK,EAAMd,EAAM,QAAShK,CAAU,EACrCpI,EAAQ,kCAAmC0S,EAAelQ,EAAW6Q,EAAUjL,EAAY8K,GAC3F,MAAMhU,EAAQ,IAAI2T,EAAeT,EAAM,QAAQ,OAAQc,EAAKE,GAAY,QACxE,OAAAhB,EAAM,MAAOc,GAEN,CACN,KAAMnS,EACN,MAAO7B,EACP,SAAUiU,CACb,CAEE,CAED,SAASG,EAAkBlB,EAAOS,EAAgB,CAEjD,OAASA,EAAa,CAErB,KAAK,aAAc,OAAOT,EAAM,WAChC,KAAK,UAAW,OAAOA,EAAM,QAC7B,KAAK,WAAY,OAAOA,EAAM,SAC9B,KAAK,WAAY,OAAOA,EAAM,SAC9B,KAAK,WAAY,OAAOA,EAAM,SAC9B,KAAK,YAAa,OAAOA,EAAM,UAC/B,KAAK,YAAa,OAAOA,EAAM,SAE/B,CAED,CAEF,CC/iBe,MAAMmB,EAAY,CAC7B,aAAc,CACV,KAAK,WAAalZ,GAAW,SAAU,EACvC,KAAK,aAAe,KAAK,WAAW,aACpC,KAAK,eAAiB,KAAK,WAAW,eACtC,KAAK,gBAAkB,CAAE,EAEzB,KAAK,mBAAoB,EACzB,KAAK,aAAc,CACtB,CAED,oBAAqB,CACjB,MAAMmZ,EAAc,IAAI5C,GAElB6C,EAA6C,oBACnDD,EAAY,eAAeC,CAAQ,EAEnC,KAAK,WAAa,IAAIrX,GACtB,KAAK,WAAW,eAAeoX,CAAW,EAC1C,KAAK,cAAgB,IAAIE,EAM5B,CAED,sBAAsBC,EAASC,EAAU,CACrC,KAAK,gBAAgBD,CAAO,EAAIC,EACV,OAAO,OAAO,KAAK,eAAe,EAAE,OAAO,CAAC19B,EAAGK,IAAML,EAAIK,EAAG,CAAC,EAC3C,KAAK,aAAa,MAM7D,CAED,aAAamnB,EAAM,CAEf,MAAoC,aAAaA,CAAI,EACxD,CAED,cAAe,CACX,KAAK,aAAa,QAASmW,GAAU,CACjC,MAAMC,EAAY,KAAK,aAAaD,EAAM,IAAI,EAExClX,EAAWb,GAAU,CACvB,QAAQ,MAAM,uBAAuB+X,EAAM,EAAE,IAAK/X,CAAK,EACnD,KAAK,WAAW,iBAChB,KAAK,WAAW,gBAAgB+X,EAAM,GAAI/X,CAAK,CAEtD,EAEKS,EAAcqX,GAAa,CAC7B,GAAIA,EAAS,iBAAkB,CAC3B,MAAMG,EAAmBH,EAAS,OAASA,EAAS,MAAS,IAC7D,KAAK,sBAAsBC,EAAM,GAAIE,CAAe,CACvD,CACJ,EAEGF,EAAM,OAAS,WACf,KAAK,cAAc,KACfC,EACCE,GAAgB,CACb,KAAK,eAAeA,EAAaH,EAAM,EAAE,EACzC,KAAK,sBAAsBA,EAAM,GAAI,GAAG,CAC3C,EACDtX,EACAI,CACH,EAGDkX,EAAM,OAAS,SACf,KAAK,WAAW,KACZC,EACCE,GAAgB,CACb,KAAK,eAAeA,EAAaH,EAAM,EAAE,EACzC,KAAK,sBAAsBA,EAAM,GAAI,GAAG,CAK3C,EACDtX,EACAI,CACH,CAEjB,CAAS,CACJ,CAGD,oBAAqB,CAEjB,OADoB,OAAO,KAAK,KAAK,WAAW,YAAY,EAAE,SACvC,KAAK,aAAa,MAC5C,CAGD,kBAAmB,CACf,MAAO,CACH,YAAa,KAAK,aAAa,OAC/B,aAAc,OAAO,KAAK,KAAK,WAAW,YAAY,EAAE,OACxD,SAAU,KAAK,gBACf,WAAY,KAAK,mBAAoB,CACxC,CACJ,CACL,CC5Ge,MAAMsX,EAAU,CAC3B,aAAc,CACV,KAAK,WAAa5Z,GAGlB,KAAK,QAAU,SAAS,cAAc,UAAU,EAChD,KAAK,QAAU,SAAS,cAAc,UAAU,EAChD,KAAK,YAAc,SAAS,cAAc,QAAQ,EAElD,KAAK,WAAW,UAAWx2B,GAAS,CAEhC,KAAK,qBAAuB,OAAO,KAAKA,EAAM,YAAY,EAAE,OAC5D,KAAK,qBAAuBA,EAAM,aAAa,OAC/C,KAAK,SAAW,KAAK,qBAAuB,KAAK,qBACjD,KAAK,SAAW,KAAK,MAAM,KAAK,SAAW,GAAG,EAC9C,SAAS,eAAe,oBAAoB,EAAE,UAAW,KAAK,SAE1D,KAAK,WAAa,MAElB8F,GAAc,SAAS,CAAC,YAAa,EAAI,CAAC,EAC1C,KAAK,QAAQ,UAAU,IAAI,MAAM,EACjC,OAAO,WAAW,IAAM,KAAK,MAAK,EAAI,IAAI,EAG1D,CAAS,CAEJ,CAED,OAAQ,CAEJ,KAAK,QAAQ,OAAQ,EAErB,KAAK,YAAY,MAAM,QAAU,SACjC,KAAK,YAAY,UAAU,IAAI,QAAQ,EAEvC,KAAK,YAAY,iBAAiB,QAAS,IAAM,CAC7C,QAAQ,IAAI,SAAS,EACrB,KAAK,QAAQ,UAAU,IAAI,MAAM,EACjC,KAAK,YAAY,UAAU,IAAI,SAAS,EAExC,OAAO,WAAW,IAAM,CACpB,KAAK,QAAQ,OAAQ,EACrB,KAAK,YAAY,OAAQ,CAC5B,EAAE,GAAI,CAInB,EAAU,CAAC,KAAM,EAAI,CAAC,CACjB,CACL,CClDe,MAAMuqC,EAAgB,CACnC,aAAc,CACZ,KAAK,eAAc,EACnB,KAAK,WAAatqC,GAClB,KAAK,WAAa,EACnB,CAED,gBAAiB,CACf,OAAO,iBAAiB,UAAY3D,GAAU,KAAK,UAAUA,CAAK,CAAC,EACnE,OAAO,iBAAiB,QAAUA,GAAU,KAAK,QAAQA,CAAK,CAAC,CAChE,CAED,UAAUA,EAAO,CACf,GAAI,CAAC,KAAK,WAAWA,EAAM,IAAI,EAAG,CAChC,OAAQA,EAAM,KAAI,CAChB,IAAK,OACL,IAAK,UACH,QAAQ,IAAI,SAAS,EACrB2D,GAAW,SAAS,CAAE,QAAS,EAAM,GACrC,MACF,IAAK,OACL,IAAK,YACHA,GAAW,SAAS,CAAE,KAAM,EAAM,GAClC,MACF,IAAK,OACL,IAAK,YACHA,GAAW,SAAS,CAAE,SAAU,EAAM,GACtC,MACF,IAAK,OACL,IAAK,aACHA,GAAW,SAAS,CAAE,MAAO,EAAM,GACnC,KACH,CACD,KAAK,WAAW3D,EAAM,IAAI,EAAI,EAC/B,CACF,CAED,QAAQA,EAAO,CACb,OAAQA,EAAM,KAAI,CAChB,IAAK,OACL,IAAK,UACH2D,GAAW,SAAS,CAAE,QAAS,EAAO,GACtC,MACF,IAAK,OACL,IAAK,YACHA,GAAW,SAAS,CAAE,KAAM,EAAO,GACnC,MACF,IAAK,OACL,IAAK,YACHA,GAAW,SAAS,CAAE,SAAU,EAAO,GACvC,MACF,IAAK,OACL,IAAK,aACHA,GAAW,SAAS,CAAE,MAAO,EAAO,GACpC,KACH,CACD,KAAK,WAAW3D,EAAM,IAAI,EAAI,EAC/B,CACH,CC5De,MAAMkuC,EAAa,CAC9B,aAAc,CACV,KAAK,MAAQ,SAAS,eAAe,SAAS,EAC9C,KAAK,aAAe,SAAS,cAAc,gBAAgB,EAC3D,KAAK,MAAQ,SAAS,cAAc,QAAQ,EAC5C,KAAK,MAAQ,SAAS,eAAe,YAAY,EACjD,KAAK,YAAc,SAAS,eAAe,kBAAkB,EAC7D,KAAK,OAAS,GAGd,KAAK,MAAM,QAAU,IAAM,KAAK,WAAU,EAC1C,KAAK,MAAM,QAAWluC,GAAU,CACxBA,EAAM,SAAW,KAAK,OACtB,KAAK,WAAU,CAE/B,EAGQ,SAAS,iBAAiB,UAAYA,GAAU,CACxCA,EAAM,MAAQ,UAAY,KAAK,QAC/B,KAAK,WAAU,CAE/B,CAAS,EAED,KAAK,SAAW,EACnB,CAED,UAAU+G,EAAOonC,EAAa,CACtB,KAAK,WAGT,KAAK,MAAM,UAAYpnC,EACvB,KAAK,YAAY,UAAYonC,EAG7B,KAAK,MAAM,MAAM,QAAU,QAC3B,KAAK,MAAM,aACX,KAAK,MAAM,UAAU,OAAO,SAAS,EACrC,KAAK,MAAM,UAAU,IAAI,QAAQ,EAEjC,KAAK,OAAS,GAGd,KAAK,SAAW,GAChB,WAAW,IAAM,CACb,KAAK,SAAW,EACnB,EAAE,GAAI,EACV,CAED,YAAa,CACJ,KAAK,SAEV,KAAK,MAAM,UAAU,OAAO,QAAQ,EACpC,KAAK,MAAM,UAAU,IAAI,SAAS,EAElC,WAAW,IAAM,CACb,KAAK,MAAM,MAAM,QAAU,OAC3B,KAAK,MAAM,UAAU,OAAO,SAAS,CACxC,EAAE,GAAG,EAEN,KAAK,OAAS,GACjB,CACL,CClDA,IAAIC,GAAW,KAEA,MAAMhqC,EAAI,CACrB,aAAc,CACV,GAAGgqC,GAAU,OAAOA,GACpBA,GAAW,KAGX,KAAK,OAAS,SAAS,cAAc,gBAAgB,EACrD,KAAK,MAAQ,IAAIC,GAGjB,KAAK,IAAM,IAAI5b,GAGf,KAAK,YAAc,IAAI6a,GAGvB,KAAK,UAAY,IAAIU,GACrB,KAAK,gBAAkB,IAAIC,GAC3B,KAAK,aAAe,IAAIC,GAGxB,KAAK,MAAQ,IAAII,GAGjB,KAAK,OAAS,IAAI1qC,GAClB,KAAK,SAAW,IAAIO,GAGpB,KAAK,KAAO,IAAII,GAChB,KAAK,OAAS,IAAIgqC,EACrB,CACL,CC1CY,IAAInqC","names":["_changeEvent","_startEvent","_endEvent","OrbitControls","EventDispatcher","domElement","Vector3","TOUCH","spherical","onKeyDown","scope","state","STATE","Quaternion","quatInverse","quat","lastPosition","lastQuaternion","twoPI","offset","rotateLeft","getAutoRotationAngle","sphericalDelta","min","max","scale","position","zoomChanged","EPS","Spherical","panOffset","rotateStart","Vector2","rotateEnd","rotateDelta","pointerPositions","angle","rotateUp","panLeft","distance","v","objectMatrix","deltaX","targetDistance","element","deltaY","dollyScale","event","handleMouseDownDolly","handleMouseDownPan","handleMouseMoveRotate","handleMouseMoveDolly","dollyEnd","dollyDelta","dollyStart","dollyIn","getZoomScale","handleMouseMovePan","panEnd","panDelta","handleMouseWheel","dollyOut","handleKeyDown","needsUpdate","handleTouchStartRotate","pointers","x","y","handleTouchStartPan","panStart","handleTouchStartDolly","dx","dy","handleTouchStartDollyPan","getSecondPointerPosition","handleTouchMovePan","handleTouchMoveDolly","handleTouchMoveDollyPan","handleTouchMoveRotate","onTouchStart","onPointerMove","onTouchMove","onPointerUp","removePointer","onPointerCancel","onMouseDown","mouseAction","MOUSE","onMouseWheel","trackPointer","i","pointer","createStoreImpl","setState","partial","replace","nextState","previousState","listeners","listener","getState","api","createState","createStore","sizesStore","appStateStore","inputStore","Camera","THREE.PerspectiveCamera","sizes","characterPosition","characterRotation","THREE.Vector3","targetOffset","Renderer","App","THREE.sRGBEncoding","THREE.ACESFilmicToneMapping","Loop","elapsedTime","deltaTime","global","factory","exports","Semver","text","core","prerelease","coreComps","controller","target","TpChangeEvent","value","presetKey","TpUpdateEvent","TpEvent","TpFoldEvent","expanded","TpTabSelectEvent","index","forceCast","a1","a2","isPropertyWritable","key","d","context","TpError","config","_a","BindingTarget","opt_id","obj","name","valueObj","ButtonApi","BladeApi","label","title","eventName","bh","handler","observers","observer","PREFIX","ClassName","viewName","opt_elementName","opt_modifier","h1","input","ev","bindValue","applyValue","valueMap","applyClass","elem","className","active","valueToClassName","bindValueToTextContent","doc","buttonElem","titleElem","className$q","ButtonController","ButtonView","BoundValue","initialValue","v1","v2","Emitter","rawValue","options","opts","constrainedValue","prevValue","PrimitiveValue","createValue","constraint","equals","ValueMap","parseObject","keyToParserMap","result","tmp","parser","parseArray","parseItem","item","isObject","optional","parse","createParamsParserBuilders","createParamsParserBuilder","itemParser","ParamsParsers","parseParams","warnMissing","info","disposeElement","ReadonlyValue","className$p","valueToModifier","modifier","ViewProps","opt_initialValue","_c","bindValueMap","disabled","callback","disposed","prevParent","BladeController","className$o","pos","SVG_NS","forceReflow","disableTransitionTemporarily","supportsTouch","getWindowDocument","getGlobalObject","getCanvasContext","canvasElement","win","createSvgIconElement","document","iconId","ICON_ID_TO_INNER_HTML_MAP","parentElement","removeElement","removeChildNodes","frag","line","lineNode","LabelView","className$n","labelElem","isEmpty","createLabelNode","valueElem","LabelController","viewProps","ButtonBladePlugin","params","p","args","ValueBladeController","createBlade","deepEqualsArray","Foldable","coreObj","exHeight","expandedClassName","computeExpandedFolderHeight","folder","containerElement","height","applyHeight","foldable","bindFoldable","h","RackLikeApi","rackApi","addButtonAsBlade","addFolderAsBlade","addSeparatorAsBlade","opt_params","addTabAsBlade","opt_index","subList","InputBindingApi","InputBindingController","MonitorBindingApi","MonitorBindingController","apiSet","RackApi","NestedOrderedSet","findSubBladeApiSet","rack","bc","getApiByController","createBindingTarget","object","a","binding","FolderApi","RackLikeController","bcs","b","findSubRack","_b","findSubBladeControllerSet","controllerClass","isRoot","firstVisibleItem","visibleItems","lastVisibleItem","ps","findInputBindingController","findMonitorBindingController","findValueBladeController","RackController","PlainView","BladeRack","bladeContainerClassName","indentElem","markElem","FolderController","rc","FolderView","LabeledValueController","SeparatorApi","className$m","hrElem","SeparatorController","SeparatorView","className$l","selected","TabItemView","TabItemController","TabApi","pc","TabPageController","TabPageApi","s","firstSelIndex","className$k","TabController","tab","Tab","TabView","c","plugin","ac","interval","targetValue","buffer","bufferSize","newValue","createTrimmedBuffer","newBuffer","fillBuffer","constraintClass","sc","tmpResult","origin","o","r","className$j","selectElem","removeChildElements","optionElem","ListView","className$i","PopupView","className$h","inputElem","TextView","parsedValue","boolToString","boolFromUnknown","BooleanFormatter","BINARY_OPERATION_MAP","left","right","op","UNARY_OPERATION_MAP","expr","combineReader","parsers","cursor","readWhitespace","m","readNonZeroDigit","ch","readDecimalDigits","readSignedInteger","ds","sign","sds","readExponentPart","e","si","readDecimalIntegerLiteral","nzd","readDecimalLiteral1","dil","dot","dds","readDecimalLiteral2","readDecimalLiteral3","readDecimalLiteral","parseBinaryDigits","readBinaryIntegerLiteral","prefix","bds","readOctalDigits","readOctalIntegerLiteral","ods","readHexDigits","readHexIntegerLiteral","hds","readNonDecimalIntegerLiteral","readNumericLiteral","parseLiteral","num","NumberLiteralNode","parseParenthesizedExpression","parseExpression","cl","parsePrimaryExpression","parseUnaryExpression","UnaryOperationNode","readBinaryOperator","ops","createBinaryOperationExpressionParser","exprParser","firstExpr","nextExpr","BinaryOperationNode","parseBinaryOperationExpression","parseEcmaNumberExpression","parseNumber","numberFromUnknown","pv","innerFormatter","createNumberFormatter","formatPercentage","stringFromUnknown","changing","primary","preventFeedback","forward","secondary","backward","getStepForKey","baseStep","keys","step","getVerticalStepKeys","rect","PointerHandler","computeOffset$1","touch","start1","end1","start2","end2","getDecimalDigits","constrainRange","loopRange","className$g","NumberTextView","knobElem","bodyElem","headElem","aox","adx","formatter","NumberTextController","ph","SliderView","className$f","trackElem","SliderController","getHorizontalStepKeys","className$e","SliderTextView","sliderElem","writePrimitive","parsePickerLayout","normalizeListOptions","items","createListConstraint","ListConstraint","findStep","findConstraint","StepConstraint","getSuitableDecimalDigits","getBaseStep","base","className$d","wrapperElem","createConstraint$6","constraints","lc","BooleanInputPlugin","_args","ListController","CheckboxController","ColorView","className$c","swatchElem","textElem","pickerElem","g","bp","cmax","rp","gp","cmin","l","hslToRgbInt","sp","lp","hp","rgbToHsvInt","hsvToRgbInt","vp","hslToHsvInt","sd","hsvToHslInt","removeAlphaComponent","comps","appendAlphaComponent","alpha","MODE_CONVERTER_MAP","rgbToHslInt","getColorMaxComponents","mode","type","loopHueRange","hue","constrainColorComponents","components","ms","convertColorType","from","to","fms","tms","convertColor","intComps","isRgbColorComponent","Color","color","comps1","comps2","opt_mode","rgbComps","className$b","ColorPickerView","hsvElem","rgbElem","apElem","aElem","elems","parseColorInputParams","parseColorType","forAlpha","equalsStringColorFormat","f1","f2","parseCssNumberOrPercentage","maxValue","parseCssNumberOrAngle","unit","ANGLE_TO_DEG_MAP","parseFunctionalRgbColorComponents","createFunctionalRgbColorParser","parseFunctionalRgbaColorComponents","createFunctionalRgbaColorParser","parseHslColorComponents","createHslColorParser","parseHslaColorComponents","createHslaColorParser","parseHexRgbColorComponents","mRgb","mRrggbb","parseHexRgbColor","parseHexRgbaColorComponents","mapRange","parseHexRgbaColor","parseObjectRgbColorComponents","createObjectRgbColorParser","parseObjectRgbaColorComponents","createObjectRgbaColorParser","PARSER_AND_RESULT","detectStringColor","prev","detection","TYPE_TO_PARSERS","createColorStringBindingReader","createColorStringParser","zerofill","comp","hex","colorToHexRgbString","colorToHexRgbaString","hexes","rgbaComps","opt_type","aFormatter","rgbFormatter","colorToFunctionalHslString","formatters","colorToFunctionalHslaString","names","FORMAT_AND_STRINGIFIERS","createObjectRgbaColorFormatter","format","fas","className$a","barElem","colorElem","markerElem","leftColor","rightColor","colorToFunctionalRgbaString","gradientComps","APaletteView","getBaseStepForColor","createModeSelectElement","optElem","className$9","modeElem","createConstraint$5","DefiniteRangeConstraint","createComponentController","ccs","cc","cs","connectValues","className$8","colorToFunctionalRgbString","HPaletteView","className$7","CANVAS_RESOL","canvasElem","ctx","width","data","imgData","iy","ix","hsvComps","top","SvPaletteView","saturation","isArrowKey","dv","HPaletteController","SvPaletteController","APaletteController","className$6","ColorSwatchView","ColorSwatchController","TextController","pickerC","nextTarget","findNextTarget","colorToRgbNumber","colorToRgbaNumber","numberToRgbColor","numberToRgbaColor","colorFromRgbNumber","colorFromRgbaNumber","createColorStringWriter","findColorStringifier","stringify","createColorNumberWriter","supportsAlpha","colorToNumber","writeRgbaColorObject","writeRgbColorObject","inValue","shouldSupportAlpha$1","inputParams","createFormatter$1","isForColor","ColorController","shouldSupportAlpha","createColorObjectReader","colorFromObject","createColorObjectFormatter","colorToObjectRgbaString","colorToObjectRgbString","ObjectColorInputPlugin","createColorObjectWriter","extractColorType","detectStringColorFormat","writer","stringifier","PointNdConstraint","className$5","axisElem","createAxisController","_","PointNdTextView","createStepConstraint","createRangeConstraint","RangeConstraint","findNumberRange","drc","createConstraint$4","CompositeConstraint","NumberInputPlugin","Point2d","Point2dAssembly","className$4","Point2dView","padElem","svgElem","xAxisElem","yAxisElem","lineElem","px","py","ipy","computeOffset","baseSteps","invertsY","Point2dPickerController","Point2dPickerView","Point2dController","PopupController","padC","PointNdTextController","z","Point3dAssembly","point3dFromUnknown","Point3d","writePoint3d","createConstraint$3","createDimensionConstraint","createAxis$2","Point3dInputPlugin","Point4d","w","Point4dAssembly","point4dFromUnknown","writePoint4d","createConstraint$2","createAxis$1","Point4dInputPlugin","createConstraint$1","StringInputPlugin","formatString","MultiLogView","textareaElem","lines","shouldScroll","MultiLogController","className$1","SingleLogView","values","lastValue","SingleLogController","BooleanMonitorPlugin","Constants","GraphLogView","tooltipElem","bounds","maxIndex","points","tx","ty","GraphLogController","createFormatter","createTextMonitor","createGraphMonitor","shouldShowGraph","NumberMonitorPlugin","StringMonitorPlugin","createInputBindingController","valueArgs","reader","InputBinding","hidden","createTicker","ManualTicker","IntervalTicker","createMonitorBindingController","bindingArgs","MonitorBinding","initializeBuffer","PluginPool","createBladeController","createDefaultPluginPool","pool","Point2dInputPlugin","StringColorInputPlugin","NumberColorInputPlugin","FolderBladePlugin","SeparatorBladePlugin","TabBladePlugin","point2dFromUnknown","writePoint2d","rs","createConstraint","getSuitableMaxDimensionValue","getSuitableMaxValue","xc","yc","xr","yr","createAxis","getSuitableDraggingScale","shouldInvertY","yParams","parsePointDimensionParams","picker","ListApi","SliderApi","minValue","TextApi","ListBladePlugin","parseListOptions","ic","exportPresetJson","targets","importPresetJson","bindings","preset","RootApi","ibc","mbc","RootController","SliderBladePlugin","vc","SliderTextController","numberToString","TextBladePlugin","createDefaultWrapperElement","embedStyle","id","css","styleElem","Pane","opt_config","rootController","containerElem","parentElem","bundle","VERSION","GUI","Physics","__vitePreload","RAPIER","gravity","collider","rigidBodyType","colliderType","dimensions","mesh","radius","scaledVertices","indices","worldPosition","THREE.Quaternion","worldRotation","size","worldScale","maxScale","vertices","vertex","rigidBody","rotation","THREE.Matrix4","inverseParentMatrix","inverseParentRotation","assetsToLoad","assetStore","environmentScene","physicalObjects","child","keyword","shadowReceivers","ambientLight","THREE.AmbientLight","THREE.DirectionalLight","Character","geometry","THREE.MeshStandardMaterial","THREE.Mesh","avatar","CharacterController","movement","THREE.AnimationMixer","clip","action","Portal","portalData","colliderDesc","portalPos","Environment","portal","error","toTrianglesDrawMode","drawMode","TriangleFanDrawMode","newIndices","numberOfTriangles","GLTFLoader","url","onLoad","onProgress","resourcePath","LoaderUtils","_onError","onError","loader","FileLoader","gltf","ktx2Loader","extensions","plugins","textDecoder","BINARY_EXTENSION_HEADER_MAGIC","EXTENSIONS","json","extensionName","GLTFMaterialsUnlitExtension","GLTFTextureTransformExtension","extensionsRequired","path","resolve","reject","objects","nodeIndex","nodeLength","nodeDef","cacheKey","dependency","lightDef","lightIndex","lightNode","range","DirectionalLight","PointLight","SpotLight","assignExtrasToUserData","self","light","MeshBasicMaterial","materialParams","pending","metallicRoughness","materialDef","array","materialIndex","emissiveStrength","extension","colorArray","GLTFMaterialsIorExtension","GLTFMaterialsSpecularExtension","textureIndex","textureDef","source","image","GLTFMeshoptCompression","bufferView","extensionDef","decoder","count","res","meshDef","primitive","WEBGL_CONSTANTS","attributes","attributesDef","accessor","results","nodeObject","instancedMeshes","Matrix4","q","InstancedMesh","attributeName","instancedMesh","BINARY_EXTENSION_HEADER_LENGTH","BINARY_EXTENSION_CHUNK_TYPES","GLTFBinaryExtension","headerView","chunkContentsLength","chunkView","chunkIndex","chunkType","contentArray","chunkLength","byteOffset","GLTFDracoMeshCompressionExtension","gltfAttributeMap","threeAttributeMap","threeAttributeName","ATTRIBUTES","accessorDef","componentType","WEBGL_COMPONENT_TYPES","attributeTypeMap","attributeNormalizedMap","bufferViewIndex","normalized","attribute","texture","transform","GLTFMeshQuantizationExtension","GLTFCubicSplineInterpolant","sampleSize","resultBuffer","parameterPositions","sampleValues","valueSize","t1","stride2","stride","stride3","t0","pp","i1","ppp","s3","s2","s1","p0","offset0","m0","td","p1","offset1","m1","s0","_q","GLTFCubicSplineQuaternionInterpolant","t","NearestFilter","NearestMipmapNearestFilter","NearestMipmapLinearFilter","WEBGL_WRAPPINGS","MirroredRepeatWrapping","RepeatWrapping","WEBGL_TYPE_SIZES","InterpolateDiscrete","cache","MeshStandardMaterial","objectDef","gltfDef","addMorphTargets","hasMorphNormal","il","hasMorphPosition","hasMorphColor","pendingNormalAccessors","pendingColorAccessors","pendingAccessor","pendingPositionAccessors","accessors","morphColors","morphNormals","updateMorphTargets","targetNames","geometryKey","dracoExtension","primitiveDef","createAttributesKey","attributesKey","getNormalizedComponentScale","constructor","getImageURIMimeType","uri","_identityMatrix","GLTFParser","GLTFRegistry","isFirefox","firefoxVersion","TextureLoader","ImageBitmapLoader","ext","dependencies","skinDefs","meshDefs","skinIndex","skinLength","nodeDefs","joints","ref","updateMappings","clone","original","mappings","func","defs","bufferIndex","bufferDef","bufferViewDef","byteLength","accessorIndex","itemSize","pendingBufferViews","bufferViews","TypedArray","elementBytes","itemBytes","byteStride","bufferAttribute","ibCacheKey","ib","ibSlice","InterleavedBuffer","InterleavedBufferAttribute","BufferAttribute","TypedArrayIndices","byteOffsetIndices","byteOffsetValues","sparseIndices","sparseValues","sourceDef","sourceIndex","promise","WEBGL_FILTERS","sampler","LinearMipmapLinearFilter","URL","sourceURI","isObjectURL","blob","imageBitmap","mapDef","encoding","mapName","material","useDerivativeTangents","useVertexColors","pointsMaterial","Material","lineMaterial","LineBasicMaterial","cachedMaterial","useFlatShading","materialExtensions","kmuExtension","materialType","alphaMode","ALPHA_MODES","sRGBEncoding","addUnknownExtensionsToUserData","PropertyBinding","originalName","sanitizedName","addPrimitiveAttributes","primitives","cached","BufferGeometry","meshIndex","materials","geometries","Mesh","Line","LineLoop","Points","meshes","Group","group","camera","cameraDef","cameraIndex","PerspectiveCamera","OrthographicCamera","skinDef","inverseBindMatrices","boneInverses","jointNodes","jointNode","bones","mat","Skeleton","animationIndex","animationDef","pendingNodes","pendingOutputAccessors","pendingSamplers","pendingTargets","channel","output","nodes","outputAccessors","node","inputAccessor","inputAccessors","outputAccessor","samplers","TypedKeyframeTrack","PATH_PROPERTIES","NumberKeyframeTrack","QuaternionKeyframeTrack","interpolation","InterpolateLinear","targetName","outputArray","scaled","j","jl","track","AnimationClip","tracks","objectPending","meshPromise","childPending","childrenDef","skeletonPending","skeleton","Bone","Object3D","nodeName","matrix","sceneIndex","sceneDef","scene","nodeIds","reduceAssociations","reducedAssociations","Texture","boxScale","box","maxDisplacement","vector","Sphere","sphere","gltfAttributeName","assignAttributeAccessor","computeBounds","DRACOLoader","Loader","manager","attributeIDs","attributeTypes","taskConfig","_taskCache","cachedTask","taskKey","taskID","taskCost","_worker","worker","message","geometryPending","geometryData","responseType","librariesPending","useJS","fn","DRACOWorker","body","decoderConfig","decoderPending","draco","module","decoderBuffer","decodeGeometry","buffers","attr","dracoGeometry","decodingStatus","geometryType","attributeType","attributeID","decodeAttribute","decodeIndex","numIndices","ptr","numComponents","numValues","dataType","getDracoDataType","AssetLoader","dracoLoader","basePath","THREE.TextureLoader","assetId","progress","asset","assetPath","percentComplete","loadedAsset","Preloader","InputController","ModalManager","description","instance","THREE.Scene","World","Resize"],"sources":["../../node_modules/three/examples/jsm/controls/OrbitControls.js","../../node_modules/zustand/esm/vanilla.mjs","../../src/App/Utils/Store.js","../../src/App/Camera.js","../../src/App/Renderer.js","../../src/App/Utils/Loop.js","../../node_modules/tweakpane/dist/tweakpane.js","../../src/App/Utils/GUI.js","../../src/App/World/Physics.js","../../src/App/Utils/AssetStore.js","../../src/App/World/Environment.js","../../src/App/World/Character.js","../../src/App/World/CharacterController.js","../../src/App/World/AnimationController.js","../../src/App/World/Portal.js","../../src/App/World/World.js","../../src/App/Utils/Resize.js","../../node_modules/three/examples/jsm/utils/BufferGeometryUtils.js","../../node_modules/three/examples/jsm/loaders/GLTFLoader.js","../../node_modules/three/examples/jsm/loaders/DRACOLoader.js","../../src/App/Utils/AssetLoader.js","../../src/App/UI/Preloader.js","../../src/App/UI/InputController.js","../../src/App/UI/ModalManager.js","../../src/App/App.js","../../src/index.js"],"sourcesContent":["import {\n\tEventDispatcher,\n\tMOUSE,\n\tQuaternion,\n\tSpherical,\n\tTOUCH,\n\tVector2,\n\tVector3\n} from 'three';\n\n// This set of controls performs orbiting, dollying (zooming), and panning.\n// Unlike TrackballControls, it maintains the \"up\" direction object.up (+Y by default).\n//\n//    Orbit - left mouse / touch: one-finger move\n//    Zoom - middle mouse, or mousewheel / touch: two-finger spread or squish\n//    Pan - right mouse, or left mouse + ctrl/meta/shiftKey, or arrow keys / touch: two-finger move\n\nconst _changeEvent = { type: 'change' };\nconst _startEvent = { type: 'start' };\nconst _endEvent = { type: 'end' };\n\nclass OrbitControls extends EventDispatcher {\n\n\tconstructor( object, domElement ) {\n\n\t\tsuper();\n\n\t\tthis.object = object;\n\t\tthis.domElement = domElement;\n\t\tthis.domElement.style.touchAction = 'none'; // disable touch scroll\n\n\t\t// Set to false to disable this control\n\t\tthis.enabled = true;\n\n\t\t// \"target\" sets the location of focus, where the object orbits around\n\t\tthis.target = new Vector3();\n\n\t\t// How far you can dolly in and out ( PerspectiveCamera only )\n\t\tthis.minDistance = 0;\n\t\tthis.maxDistance = Infinity;\n\n\t\t// How far you can zoom in and out ( OrthographicCamera only )\n\t\tthis.minZoom = 0;\n\t\tthis.maxZoom = Infinity;\n\n\t\t// How far you can orbit vertically, upper and lower limits.\n\t\t// Range is 0 to Math.PI radians.\n\t\tthis.minPolarAngle = 0; // radians\n\t\tthis.maxPolarAngle = Math.PI; // radians\n\n\t\t// How far you can orbit horizontally, upper and lower limits.\n\t\t// If set, the interval [ min, max ] must be a sub-interval of [ - 2 PI, 2 PI ], with ( max - min < 2 PI )\n\t\tthis.minAzimuthAngle = - Infinity; // radians\n\t\tthis.maxAzimuthAngle = Infinity; // radians\n\n\t\t// Set to true to enable damping (inertia)\n\t\t// If damping is enabled, you must call controls.update() in your animation loop\n\t\tthis.enableDamping = false;\n\t\tthis.dampingFactor = 0.05;\n\n\t\t// This option actually enables dollying in and out; left as \"zoom\" for backwards compatibility.\n\t\t// Set to false to disable zooming\n\t\tthis.enableZoom = true;\n\t\tthis.zoomSpeed = 1.0;\n\n\t\t// Set to false to disable rotating\n\t\tthis.enableRotate = true;\n\t\tthis.rotateSpeed = 1.0;\n\n\t\t// Set to false to disable panning\n\t\tthis.enablePan = true;\n\t\tthis.panSpeed = 1.0;\n\t\tthis.screenSpacePanning = true; // if false, pan orthogonal to world-space direction camera.up\n\t\tthis.keyPanSpeed = 7.0;\t// pixels moved per arrow key push\n\n\t\t// Set to true to automatically rotate around the target\n\t\t// If auto-rotate is enabled, you must call controls.update() in your animation loop\n\t\tthis.autoRotate = false;\n\t\tthis.autoRotateSpeed = 2.0; // 30 seconds per orbit when fps is 60\n\n\t\t// The four arrow keys\n\t\tthis.keys = { LEFT: 'ArrowLeft', UP: 'ArrowUp', RIGHT: 'ArrowRight', BOTTOM: 'ArrowDown' };\n\n\t\t// Mouse buttons\n\t\tthis.mouseButtons = { LEFT: MOUSE.ROTATE, MIDDLE: MOUSE.DOLLY, RIGHT: MOUSE.PAN };\n\n\t\t// Touch fingers\n\t\tthis.touches = { ONE: TOUCH.ROTATE, TWO: TOUCH.DOLLY_PAN };\n\n\t\t// for reset\n\t\tthis.target0 = this.target.clone();\n\t\tthis.position0 = this.object.position.clone();\n\t\tthis.zoom0 = this.object.zoom;\n\n\t\t// the target DOM element for key events\n\t\tthis._domElementKeyEvents = null;\n\n\t\t//\n\t\t// public methods\n\t\t//\n\n\t\tthis.getPolarAngle = function () {\n\n\t\t\treturn spherical.phi;\n\n\t\t};\n\n\t\tthis.getAzimuthalAngle = function () {\n\n\t\t\treturn spherical.theta;\n\n\t\t};\n\n\t\tthis.getDistance = function () {\n\n\t\t\treturn this.object.position.distanceTo( this.target );\n\n\t\t};\n\n\t\tthis.listenToKeyEvents = function ( domElement ) {\n\n\t\t\tdomElement.addEventListener( 'keydown', onKeyDown );\n\t\t\tthis._domElementKeyEvents = domElement;\n\n\t\t};\n\n\t\tthis.saveState = function () {\n\n\t\t\tscope.target0.copy( scope.target );\n\t\t\tscope.position0.copy( scope.object.position );\n\t\t\tscope.zoom0 = scope.object.zoom;\n\n\t\t};\n\n\t\tthis.reset = function () {\n\n\t\t\tscope.target.copy( scope.target0 );\n\t\t\tscope.object.position.copy( scope.position0 );\n\t\t\tscope.object.zoom = scope.zoom0;\n\n\t\t\tscope.object.updateProjectionMatrix();\n\t\t\tscope.dispatchEvent( _changeEvent );\n\n\t\t\tscope.update();\n\n\t\t\tstate = STATE.NONE;\n\n\t\t};\n\n\t\t// this method is exposed, but perhaps it would be better if we can make it private...\n\t\tthis.update = function () {\n\n\t\t\tconst offset = new Vector3();\n\n\t\t\t// so camera.up is the orbit axis\n\t\t\tconst quat = new Quaternion().setFromUnitVectors( object.up, new Vector3( 0, 1, 0 ) );\n\t\t\tconst quatInverse = quat.clone().invert();\n\n\t\t\tconst lastPosition = new Vector3();\n\t\t\tconst lastQuaternion = new Quaternion();\n\n\t\t\tconst twoPI = 2 * Math.PI;\n\n\t\t\treturn function update() {\n\n\t\t\t\tconst position = scope.object.position;\n\n\t\t\t\toffset.copy( position ).sub( scope.target );\n\n\t\t\t\t// rotate offset to \"y-axis-is-up\" space\n\t\t\t\toffset.applyQuaternion( quat );\n\n\t\t\t\t// angle from z-axis around y-axis\n\t\t\t\tspherical.setFromVector3( offset );\n\n\t\t\t\tif ( scope.autoRotate && state === STATE.NONE ) {\n\n\t\t\t\t\trotateLeft( getAutoRotationAngle() );\n\n\t\t\t\t}\n\n\t\t\t\tif ( scope.enableDamping ) {\n\n\t\t\t\t\tspherical.theta += sphericalDelta.theta * scope.dampingFactor;\n\t\t\t\t\tspherical.phi += sphericalDelta.phi * scope.dampingFactor;\n\n\t\t\t\t} else {\n\n\t\t\t\t\tspherical.theta += sphericalDelta.theta;\n\t\t\t\t\tspherical.phi += sphericalDelta.phi;\n\n\t\t\t\t}\n\n\t\t\t\t// restrict theta to be between desired limits\n\n\t\t\t\tlet min = scope.minAzimuthAngle;\n\t\t\t\tlet max = scope.maxAzimuthAngle;\n\n\t\t\t\tif ( isFinite( min ) && isFinite( max ) ) {\n\n\t\t\t\t\tif ( min < - Math.PI ) min += twoPI; else if ( min > Math.PI ) min -= twoPI;\n\n\t\t\t\t\tif ( max < - Math.PI ) max += twoPI; else if ( max > Math.PI ) max -= twoPI;\n\n\t\t\t\t\tif ( min <= max ) {\n\n\t\t\t\t\t\tspherical.theta = Math.max( min, Math.min( max, spherical.theta ) );\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tspherical.theta = ( spherical.theta > ( min + max ) / 2 ) ?\n\t\t\t\t\t\t\tMath.max( min, spherical.theta ) :\n\t\t\t\t\t\t\tMath.min( max, spherical.theta );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\t// restrict phi to be between desired limits\n\t\t\t\tspherical.phi = Math.max( scope.minPolarAngle, Math.min( scope.maxPolarAngle, spherical.phi ) );\n\n\t\t\t\tspherical.makeSafe();\n\n\n\t\t\t\tspherical.radius *= scale;\n\n\t\t\t\t// restrict radius to be between desired limits\n\t\t\t\tspherical.radius = Math.max( scope.minDistance, Math.min( scope.maxDistance, spherical.radius ) );\n\n\t\t\t\t// move target to panned location\n\n\t\t\t\tif ( scope.enableDamping === true ) {\n\n\t\t\t\t\tscope.target.addScaledVector( panOffset, scope.dampingFactor );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tscope.target.add( panOffset );\n\n\t\t\t\t}\n\n\t\t\t\toffset.setFromSpherical( spherical );\n\n\t\t\t\t// rotate offset back to \"camera-up-vector-is-up\" space\n\t\t\t\toffset.applyQuaternion( quatInverse );\n\n\t\t\t\tposition.copy( scope.target ).add( offset );\n\n\t\t\t\tscope.object.lookAt( scope.target );\n\n\t\t\t\tif ( scope.enableDamping === true ) {\n\n\t\t\t\t\tsphericalDelta.theta *= ( 1 - scope.dampingFactor );\n\t\t\t\t\tsphericalDelta.phi *= ( 1 - scope.dampingFactor );\n\n\t\t\t\t\tpanOffset.multiplyScalar( 1 - scope.dampingFactor );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tsphericalDelta.set( 0, 0, 0 );\n\n\t\t\t\t\tpanOffset.set( 0, 0, 0 );\n\n\t\t\t\t}\n\n\t\t\t\tscale = 1;\n\n\t\t\t\t// update condition is:\n\t\t\t\t// min(camera displacement, camera rotation in radians)^2 > EPS\n\t\t\t\t// using small-angle approximation cos(x/2) = 1 - x^2 / 8\n\n\t\t\t\tif ( zoomChanged ||\n\t\t\t\t\tlastPosition.distanceToSquared( scope.object.position ) > EPS ||\n\t\t\t\t\t8 * ( 1 - lastQuaternion.dot( scope.object.quaternion ) ) > EPS ) {\n\n\t\t\t\t\tscope.dispatchEvent( _changeEvent );\n\n\t\t\t\t\tlastPosition.copy( scope.object.position );\n\t\t\t\t\tlastQuaternion.copy( scope.object.quaternion );\n\t\t\t\t\tzoomChanged = false;\n\n\t\t\t\t\treturn true;\n\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\n\t\t\t};\n\n\t\t}();\n\n\t\tthis.dispose = function () {\n\n\t\t\tscope.domElement.removeEventListener( 'contextmenu', onContextMenu );\n\n\t\t\tscope.domElement.removeEventListener( 'pointerdown', onPointerDown );\n\t\t\tscope.domElement.removeEventListener( 'pointercancel', onPointerCancel );\n\t\t\tscope.domElement.removeEventListener( 'wheel', onMouseWheel );\n\n\t\t\tscope.domElement.removeEventListener( 'pointermove', onPointerMove );\n\t\t\tscope.domElement.removeEventListener( 'pointerup', onPointerUp );\n\n\n\t\t\tif ( scope._domElementKeyEvents !== null ) {\n\n\t\t\t\tscope._domElementKeyEvents.removeEventListener( 'keydown', onKeyDown );\n\n\t\t\t}\n\n\t\t\t//scope.dispatchEvent( { type: 'dispose' } ); // should this be added here?\n\n\t\t};\n\n\t\t//\n\t\t// internals\n\t\t//\n\n\t\tconst scope = this;\n\n\t\tconst STATE = {\n\t\t\tNONE: - 1,\n\t\t\tROTATE: 0,\n\t\t\tDOLLY: 1,\n\t\t\tPAN: 2,\n\t\t\tTOUCH_ROTATE: 3,\n\t\t\tTOUCH_PAN: 4,\n\t\t\tTOUCH_DOLLY_PAN: 5,\n\t\t\tTOUCH_DOLLY_ROTATE: 6\n\t\t};\n\n\t\tlet state = STATE.NONE;\n\n\t\tconst EPS = 0.000001;\n\n\t\t// current position in spherical coordinates\n\t\tconst spherical = new Spherical();\n\t\tconst sphericalDelta = new Spherical();\n\n\t\tlet scale = 1;\n\t\tconst panOffset = new Vector3();\n\t\tlet zoomChanged = false;\n\n\t\tconst rotateStart = new Vector2();\n\t\tconst rotateEnd = new Vector2();\n\t\tconst rotateDelta = new Vector2();\n\n\t\tconst panStart = new Vector2();\n\t\tconst panEnd = new Vector2();\n\t\tconst panDelta = new Vector2();\n\n\t\tconst dollyStart = new Vector2();\n\t\tconst dollyEnd = new Vector2();\n\t\tconst dollyDelta = new Vector2();\n\n\t\tconst pointers = [];\n\t\tconst pointerPositions = {};\n\n\t\tfunction getAutoRotationAngle() {\n\n\t\t\treturn 2 * Math.PI / 60 / 60 * scope.autoRotateSpeed;\n\n\t\t}\n\n\t\tfunction getZoomScale() {\n\n\t\t\treturn Math.pow( 0.95, scope.zoomSpeed );\n\n\t\t}\n\n\t\tfunction rotateLeft( angle ) {\n\n\t\t\tsphericalDelta.theta -= angle;\n\n\t\t}\n\n\t\tfunction rotateUp( angle ) {\n\n\t\t\tsphericalDelta.phi -= angle;\n\n\t\t}\n\n\t\tconst panLeft = function () {\n\n\t\t\tconst v = new Vector3();\n\n\t\t\treturn function panLeft( distance, objectMatrix ) {\n\n\t\t\t\tv.setFromMatrixColumn( objectMatrix, 0 ); // get X column of objectMatrix\n\t\t\t\tv.multiplyScalar( - distance );\n\n\t\t\t\tpanOffset.add( v );\n\n\t\t\t};\n\n\t\t}();\n\n\t\tconst panUp = function () {\n\n\t\t\tconst v = new Vector3();\n\n\t\t\treturn function panUp( distance, objectMatrix ) {\n\n\t\t\t\tif ( scope.screenSpacePanning === true ) {\n\n\t\t\t\t\tv.setFromMatrixColumn( objectMatrix, 1 );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tv.setFromMatrixColumn( objectMatrix, 0 );\n\t\t\t\t\tv.crossVectors( scope.object.up, v );\n\n\t\t\t\t}\n\n\t\t\t\tv.multiplyScalar( distance );\n\n\t\t\t\tpanOffset.add( v );\n\n\t\t\t};\n\n\t\t}();\n\n\t\t// deltaX and deltaY are in pixels; right and down are positive\n\t\tconst pan = function () {\n\n\t\t\tconst offset = new Vector3();\n\n\t\t\treturn function pan( deltaX, deltaY ) {\n\n\t\t\t\tconst element = scope.domElement;\n\n\t\t\t\tif ( scope.object.isPerspectiveCamera ) {\n\n\t\t\t\t\t// perspective\n\t\t\t\t\tconst position = scope.object.position;\n\t\t\t\t\toffset.copy( position ).sub( scope.target );\n\t\t\t\t\tlet targetDistance = offset.length();\n\n\t\t\t\t\t// half of the fov is center to top of screen\n\t\t\t\t\ttargetDistance *= Math.tan( ( scope.object.fov / 2 ) * Math.PI / 180.0 );\n\n\t\t\t\t\t// we use only clientHeight here so aspect ratio does not distort speed\n\t\t\t\t\tpanLeft( 2 * deltaX * targetDistance / element.clientHeight, scope.object.matrix );\n\t\t\t\t\tpanUp( 2 * deltaY * targetDistance / element.clientHeight, scope.object.matrix );\n\n\t\t\t\t} else if ( scope.object.isOrthographicCamera ) {\n\n\t\t\t\t\t// orthographic\n\t\t\t\t\tpanLeft( deltaX * ( scope.object.right - scope.object.left ) / scope.object.zoom / element.clientWidth, scope.object.matrix );\n\t\t\t\t\tpanUp( deltaY * ( scope.object.top - scope.object.bottom ) / scope.object.zoom / element.clientHeight, scope.object.matrix );\n\n\t\t\t\t} else {\n\n\t\t\t\t\t// camera neither orthographic nor perspective\n\t\t\t\t\tconsole.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.' );\n\t\t\t\t\tscope.enablePan = false;\n\n\t\t\t\t}\n\n\t\t\t};\n\n\t\t}();\n\n\t\tfunction dollyOut( dollyScale ) {\n\n\t\t\tif ( scope.object.isPerspectiveCamera ) {\n\n\t\t\t\tscale /= dollyScale;\n\n\t\t\t} else if ( scope.object.isOrthographicCamera ) {\n\n\t\t\t\tscope.object.zoom = Math.max( scope.minZoom, Math.min( scope.maxZoom, scope.object.zoom * dollyScale ) );\n\t\t\t\tscope.object.updateProjectionMatrix();\n\t\t\t\tzoomChanged = true;\n\n\t\t\t} else {\n\n\t\t\t\tconsole.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.' );\n\t\t\t\tscope.enableZoom = false;\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction dollyIn( dollyScale ) {\n\n\t\t\tif ( scope.object.isPerspectiveCamera ) {\n\n\t\t\t\tscale *= dollyScale;\n\n\t\t\t} else if ( scope.object.isOrthographicCamera ) {\n\n\t\t\t\tscope.object.zoom = Math.max( scope.minZoom, Math.min( scope.maxZoom, scope.object.zoom / dollyScale ) );\n\t\t\t\tscope.object.updateProjectionMatrix();\n\t\t\t\tzoomChanged = true;\n\n\t\t\t} else {\n\n\t\t\t\tconsole.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.' );\n\t\t\t\tscope.enableZoom = false;\n\n\t\t\t}\n\n\t\t}\n\n\t\t//\n\t\t// event callbacks - update the object state\n\t\t//\n\n\t\tfunction handleMouseDownRotate( event ) {\n\n\t\t\trotateStart.set( event.clientX, event.clientY );\n\n\t\t}\n\n\t\tfunction handleMouseDownDolly( event ) {\n\n\t\t\tdollyStart.set( event.clientX, event.clientY );\n\n\t\t}\n\n\t\tfunction handleMouseDownPan( event ) {\n\n\t\t\tpanStart.set( event.clientX, event.clientY );\n\n\t\t}\n\n\t\tfunction handleMouseMoveRotate( event ) {\n\n\t\t\trotateEnd.set( event.clientX, event.clientY );\n\n\t\t\trotateDelta.subVectors( rotateEnd, rotateStart ).multiplyScalar( scope.rotateSpeed );\n\n\t\t\tconst element = scope.domElement;\n\n\t\t\trotateLeft( 2 * Math.PI * rotateDelta.x / element.clientHeight ); // yes, height\n\n\t\t\trotateUp( 2 * Math.PI * rotateDelta.y / element.clientHeight );\n\n\t\t\trotateStart.copy( rotateEnd );\n\n\t\t\tscope.update();\n\n\t\t}\n\n\t\tfunction handleMouseMoveDolly( event ) {\n\n\t\t\tdollyEnd.set( event.clientX, event.clientY );\n\n\t\t\tdollyDelta.subVectors( dollyEnd, dollyStart );\n\n\t\t\tif ( dollyDelta.y > 0 ) {\n\n\t\t\t\tdollyOut( getZoomScale() );\n\n\t\t\t} else if ( dollyDelta.y < 0 ) {\n\n\t\t\t\tdollyIn( getZoomScale() );\n\n\t\t\t}\n\n\t\t\tdollyStart.copy( dollyEnd );\n\n\t\t\tscope.update();\n\n\t\t}\n\n\t\tfunction handleMouseMovePan( event ) {\n\n\t\t\tpanEnd.set( event.clientX, event.clientY );\n\n\t\t\tpanDelta.subVectors( panEnd, panStart ).multiplyScalar( scope.panSpeed );\n\n\t\t\tpan( panDelta.x, panDelta.y );\n\n\t\t\tpanStart.copy( panEnd );\n\n\t\t\tscope.update();\n\n\t\t}\n\n\t\tfunction handleMouseWheel( event ) {\n\n\t\t\tif ( event.deltaY < 0 ) {\n\n\t\t\t\tdollyIn( getZoomScale() );\n\n\t\t\t} else if ( event.deltaY > 0 ) {\n\n\t\t\t\tdollyOut( getZoomScale() );\n\n\t\t\t}\n\n\t\t\tscope.update();\n\n\t\t}\n\n\t\tfunction handleKeyDown( event ) {\n\n\t\t\tlet needsUpdate = false;\n\n\t\t\tswitch ( event.code ) {\n\n\t\t\t\tcase scope.keys.UP:\n\n\t\t\t\t\tif ( event.ctrlKey || event.metaKey || event.shiftKey ) {\n\n\t\t\t\t\t\trotateUp( 2 * Math.PI * scope.rotateSpeed / scope.domElement.clientHeight );\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tpan( 0, scope.keyPanSpeed );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tneedsUpdate = true;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase scope.keys.BOTTOM:\n\n\t\t\t\t\tif ( event.ctrlKey || event.metaKey || event.shiftKey ) {\n\n\t\t\t\t\t\trotateUp( - 2 * Math.PI * scope.rotateSpeed / scope.domElement.clientHeight );\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tpan( 0, - scope.keyPanSpeed );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tneedsUpdate = true;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase scope.keys.LEFT:\n\n\t\t\t\t\tif ( event.ctrlKey || event.metaKey || event.shiftKey ) {\n\n\t\t\t\t\t\trotateLeft( 2 * Math.PI * scope.rotateSpeed / scope.domElement.clientHeight );\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tpan( scope.keyPanSpeed, 0 );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tneedsUpdate = true;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase scope.keys.RIGHT:\n\n\t\t\t\t\tif ( event.ctrlKey || event.metaKey || event.shiftKey ) {\n\n\t\t\t\t\t\trotateLeft( - 2 * Math.PI * scope.rotateSpeed / scope.domElement.clientHeight );\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tpan( - scope.keyPanSpeed, 0 );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tneedsUpdate = true;\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t\tif ( needsUpdate ) {\n\n\t\t\t\t// prevent the browser from scrolling on cursor keys\n\t\t\t\tevent.preventDefault();\n\n\t\t\t\tscope.update();\n\n\t\t\t}\n\n\n\t\t}\n\n\t\tfunction handleTouchStartRotate() {\n\n\t\t\tif ( pointers.length === 1 ) {\n\n\t\t\t\trotateStart.set( pointers[ 0 ].pageX, pointers[ 0 ].pageY );\n\n\t\t\t} else {\n\n\t\t\t\tconst x = 0.5 * ( pointers[ 0 ].pageX + pointers[ 1 ].pageX );\n\t\t\t\tconst y = 0.5 * ( pointers[ 0 ].pageY + pointers[ 1 ].pageY );\n\n\t\t\t\trotateStart.set( x, y );\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction handleTouchStartPan() {\n\n\t\t\tif ( pointers.length === 1 ) {\n\n\t\t\t\tpanStart.set( pointers[ 0 ].pageX, pointers[ 0 ].pageY );\n\n\t\t\t} else {\n\n\t\t\t\tconst x = 0.5 * ( pointers[ 0 ].pageX + pointers[ 1 ].pageX );\n\t\t\t\tconst y = 0.5 * ( pointers[ 0 ].pageY + pointers[ 1 ].pageY );\n\n\t\t\t\tpanStart.set( x, y );\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction handleTouchStartDolly() {\n\n\t\t\tconst dx = pointers[ 0 ].pageX - pointers[ 1 ].pageX;\n\t\t\tconst dy = pointers[ 0 ].pageY - pointers[ 1 ].pageY;\n\n\t\t\tconst distance = Math.sqrt( dx * dx + dy * dy );\n\n\t\t\tdollyStart.set( 0, distance );\n\n\t\t}\n\n\t\tfunction handleTouchStartDollyPan() {\n\n\t\t\tif ( scope.enableZoom ) handleTouchStartDolly();\n\n\t\t\tif ( scope.enablePan ) handleTouchStartPan();\n\n\t\t}\n\n\t\tfunction handleTouchStartDollyRotate() {\n\n\t\t\tif ( scope.enableZoom ) handleTouchStartDolly();\n\n\t\t\tif ( scope.enableRotate ) handleTouchStartRotate();\n\n\t\t}\n\n\t\tfunction handleTouchMoveRotate( event ) {\n\n\t\t\tif ( pointers.length == 1 ) {\n\n\t\t\t\trotateEnd.set( event.pageX, event.pageY );\n\n\t\t\t} else {\n\n\t\t\t\tconst position = getSecondPointerPosition( event );\n\n\t\t\t\tconst x = 0.5 * ( event.pageX + position.x );\n\t\t\t\tconst y = 0.5 * ( event.pageY + position.y );\n\n\t\t\t\trotateEnd.set( x, y );\n\n\t\t\t}\n\n\t\t\trotateDelta.subVectors( rotateEnd, rotateStart ).multiplyScalar( scope.rotateSpeed );\n\n\t\t\tconst element = scope.domElement;\n\n\t\t\trotateLeft( 2 * Math.PI * rotateDelta.x / element.clientHeight ); // yes, height\n\n\t\t\trotateUp( 2 * Math.PI * rotateDelta.y / element.clientHeight );\n\n\t\t\trotateStart.copy( rotateEnd );\n\n\t\t}\n\n\t\tfunction handleTouchMovePan( event ) {\n\n\t\t\tif ( pointers.length === 1 ) {\n\n\t\t\t\tpanEnd.set( event.pageX, event.pageY );\n\n\t\t\t} else {\n\n\t\t\t\tconst position = getSecondPointerPosition( event );\n\n\t\t\t\tconst x = 0.5 * ( event.pageX + position.x );\n\t\t\t\tconst y = 0.5 * ( event.pageY + position.y );\n\n\t\t\t\tpanEnd.set( x, y );\n\n\t\t\t}\n\n\t\t\tpanDelta.subVectors( panEnd, panStart ).multiplyScalar( scope.panSpeed );\n\n\t\t\tpan( panDelta.x, panDelta.y );\n\n\t\t\tpanStart.copy( panEnd );\n\n\t\t}\n\n\t\tfunction handleTouchMoveDolly( event ) {\n\n\t\t\tconst position = getSecondPointerPosition( event );\n\n\t\t\tconst dx = event.pageX - position.x;\n\t\t\tconst dy = event.pageY - position.y;\n\n\t\t\tconst distance = Math.sqrt( dx * dx + dy * dy );\n\n\t\t\tdollyEnd.set( 0, distance );\n\n\t\t\tdollyDelta.set( 0, Math.pow( dollyEnd.y / dollyStart.y, scope.zoomSpeed ) );\n\n\t\t\tdollyOut( dollyDelta.y );\n\n\t\t\tdollyStart.copy( dollyEnd );\n\n\t\t}\n\n\t\tfunction handleTouchMoveDollyPan( event ) {\n\n\t\t\tif ( scope.enableZoom ) handleTouchMoveDolly( event );\n\n\t\t\tif ( scope.enablePan ) handleTouchMovePan( event );\n\n\t\t}\n\n\t\tfunction handleTouchMoveDollyRotate( event ) {\n\n\t\t\tif ( scope.enableZoom ) handleTouchMoveDolly( event );\n\n\t\t\tif ( scope.enableRotate ) handleTouchMoveRotate( event );\n\n\t\t}\n\n\t\t//\n\t\t// event handlers - FSM: listen for events and reset state\n\t\t//\n\n\t\tfunction onPointerDown( event ) {\n\n\t\t\tif ( scope.enabled === false ) return;\n\n\t\t\tif ( pointers.length === 0 ) {\n\n\t\t\t\tscope.domElement.setPointerCapture( event.pointerId );\n\n\t\t\t\tscope.domElement.addEventListener( 'pointermove', onPointerMove );\n\t\t\t\tscope.domElement.addEventListener( 'pointerup', onPointerUp );\n\n\t\t\t}\n\n\t\t\t//\n\n\t\t\taddPointer( event );\n\n\t\t\tif ( event.pointerType === 'touch' ) {\n\n\t\t\t\tonTouchStart( event );\n\n\t\t\t} else {\n\n\t\t\t\tonMouseDown( event );\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction onPointerMove( event ) {\n\n\t\t\tif ( scope.enabled === false ) return;\n\n\t\t\tif ( event.pointerType === 'touch' ) {\n\n\t\t\t\tonTouchMove( event );\n\n\t\t\t} else {\n\n\t\t\t\tonMouseMove( event );\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction onPointerUp( event ) {\n\n\t\t    removePointer( event );\n\n\t\t    if ( pointers.length === 0 ) {\n\n\t\t        scope.domElement.releasePointerCapture( event.pointerId );\n\n\t\t        scope.domElement.removeEventListener( 'pointermove', onPointerMove );\n\t\t        scope.domElement.removeEventListener( 'pointerup', onPointerUp );\n\n\t\t    }\n\n\t\t    scope.dispatchEvent( _endEvent );\n\n\t\t    state = STATE.NONE;\n\n\t\t}\n\n\t\tfunction onPointerCancel( event ) {\n\n\t\t\tremovePointer( event );\n\n\t\t}\n\n\t\tfunction onMouseDown( event ) {\n\n\t\t\tlet mouseAction;\n\n\t\t\tswitch ( event.button ) {\n\n\t\t\t\tcase 0:\n\n\t\t\t\t\tmouseAction = scope.mouseButtons.LEFT;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 1:\n\n\t\t\t\t\tmouseAction = scope.mouseButtons.MIDDLE;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 2:\n\n\t\t\t\t\tmouseAction = scope.mouseButtons.RIGHT;\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\n\t\t\t\t\tmouseAction = - 1;\n\n\t\t\t}\n\n\t\t\tswitch ( mouseAction ) {\n\n\t\t\t\tcase MOUSE.DOLLY:\n\n\t\t\t\t\tif ( scope.enableZoom === false ) return;\n\n\t\t\t\t\thandleMouseDownDolly( event );\n\n\t\t\t\t\tstate = STATE.DOLLY;\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase MOUSE.ROTATE:\n\n\t\t\t\t\tif ( event.ctrlKey || event.metaKey || event.shiftKey ) {\n\n\t\t\t\t\t\tif ( scope.enablePan === false ) return;\n\n\t\t\t\t\t\thandleMouseDownPan( event );\n\n\t\t\t\t\t\tstate = STATE.PAN;\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tif ( scope.enableRotate === false ) return;\n\n\t\t\t\t\t\thandleMouseDownRotate( event );\n\n\t\t\t\t\t\tstate = STATE.ROTATE;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase MOUSE.PAN:\n\n\t\t\t\t\tif ( event.ctrlKey || event.metaKey || event.shiftKey ) {\n\n\t\t\t\t\t\tif ( scope.enableRotate === false ) return;\n\n\t\t\t\t\t\thandleMouseDownRotate( event );\n\n\t\t\t\t\t\tstate = STATE.ROTATE;\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tif ( scope.enablePan === false ) return;\n\n\t\t\t\t\t\thandleMouseDownPan( event );\n\n\t\t\t\t\t\tstate = STATE.PAN;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\n\t\t\t\t\tstate = STATE.NONE;\n\n\t\t\t}\n\n\t\t\tif ( state !== STATE.NONE ) {\n\n\t\t\t\tscope.dispatchEvent( _startEvent );\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction onMouseMove( event ) {\n\n\t\t\tswitch ( state ) {\n\n\t\t\t\tcase STATE.ROTATE:\n\n\t\t\t\t\tif ( scope.enableRotate === false ) return;\n\n\t\t\t\t\thandleMouseMoveRotate( event );\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase STATE.DOLLY:\n\n\t\t\t\t\tif ( scope.enableZoom === false ) return;\n\n\t\t\t\t\thandleMouseMoveDolly( event );\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase STATE.PAN:\n\n\t\t\t\t\tif ( scope.enablePan === false ) return;\n\n\t\t\t\t\thandleMouseMovePan( event );\n\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction onMouseWheel( event ) {\n\n\t\t\tif ( scope.enabled === false || scope.enableZoom === false || state !== STATE.NONE ) return;\n\n\t\t\tevent.preventDefault();\n\n\t\t\tscope.dispatchEvent( _startEvent );\n\n\t\t\thandleMouseWheel( event );\n\n\t\t\tscope.dispatchEvent( _endEvent );\n\n\t\t}\n\n\t\tfunction onKeyDown( event ) {\n\n\t\t\tif ( scope.enabled === false || scope.enablePan === false ) return;\n\n\t\t\thandleKeyDown( event );\n\n\t\t}\n\n\t\tfunction onTouchStart( event ) {\n\n\t\t\ttrackPointer( event );\n\n\t\t\tswitch ( pointers.length ) {\n\n\t\t\t\tcase 1:\n\n\t\t\t\t\tswitch ( scope.touches.ONE ) {\n\n\t\t\t\t\t\tcase TOUCH.ROTATE:\n\n\t\t\t\t\t\t\tif ( scope.enableRotate === false ) return;\n\n\t\t\t\t\t\t\thandleTouchStartRotate();\n\n\t\t\t\t\t\t\tstate = STATE.TOUCH_ROTATE;\n\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase TOUCH.PAN:\n\n\t\t\t\t\t\t\tif ( scope.enablePan === false ) return;\n\n\t\t\t\t\t\t\thandleTouchStartPan();\n\n\t\t\t\t\t\t\tstate = STATE.TOUCH_PAN;\n\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tdefault:\n\n\t\t\t\t\t\t\tstate = STATE.NONE;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 2:\n\n\t\t\t\t\tswitch ( scope.touches.TWO ) {\n\n\t\t\t\t\t\tcase TOUCH.DOLLY_PAN:\n\n\t\t\t\t\t\t\tif ( scope.enableZoom === false && scope.enablePan === false ) return;\n\n\t\t\t\t\t\t\thandleTouchStartDollyPan();\n\n\t\t\t\t\t\t\tstate = STATE.TOUCH_DOLLY_PAN;\n\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase TOUCH.DOLLY_ROTATE:\n\n\t\t\t\t\t\t\tif ( scope.enableZoom === false && scope.enableRotate === false ) return;\n\n\t\t\t\t\t\t\thandleTouchStartDollyRotate();\n\n\t\t\t\t\t\t\tstate = STATE.TOUCH_DOLLY_ROTATE;\n\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tdefault:\n\n\t\t\t\t\t\t\tstate = STATE.NONE;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\n\t\t\t\t\tstate = STATE.NONE;\n\n\t\t\t}\n\n\t\t\tif ( state !== STATE.NONE ) {\n\n\t\t\t\tscope.dispatchEvent( _startEvent );\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction onTouchMove( event ) {\n\n\t\t\ttrackPointer( event );\n\n\t\t\tswitch ( state ) {\n\n\t\t\t\tcase STATE.TOUCH_ROTATE:\n\n\t\t\t\t\tif ( scope.enableRotate === false ) return;\n\n\t\t\t\t\thandleTouchMoveRotate( event );\n\n\t\t\t\t\tscope.update();\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase STATE.TOUCH_PAN:\n\n\t\t\t\t\tif ( scope.enablePan === false ) return;\n\n\t\t\t\t\thandleTouchMovePan( event );\n\n\t\t\t\t\tscope.update();\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase STATE.TOUCH_DOLLY_PAN:\n\n\t\t\t\t\tif ( scope.enableZoom === false && scope.enablePan === false ) return;\n\n\t\t\t\t\thandleTouchMoveDollyPan( event );\n\n\t\t\t\t\tscope.update();\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase STATE.TOUCH_DOLLY_ROTATE:\n\n\t\t\t\t\tif ( scope.enableZoom === false && scope.enableRotate === false ) return;\n\n\t\t\t\t\thandleTouchMoveDollyRotate( event );\n\n\t\t\t\t\tscope.update();\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\n\t\t\t\t\tstate = STATE.NONE;\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction onContextMenu( event ) {\n\n\t\t\tif ( scope.enabled === false ) return;\n\n\t\t\tevent.preventDefault();\n\n\t\t}\n\n\t\tfunction addPointer( event ) {\n\n\t\t\tpointers.push( event );\n\n\t\t}\n\n\t\tfunction removePointer( event ) {\n\n\t\t\tdelete pointerPositions[ event.pointerId ];\n\n\t\t\tfor ( let i = 0; i < pointers.length; i ++ ) {\n\n\t\t\t\tif ( pointers[ i ].pointerId == event.pointerId ) {\n\n\t\t\t\t\tpointers.splice( i, 1 );\n\t\t\t\t\treturn;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction trackPointer( event ) {\n\n\t\t\tlet position = pointerPositions[ event.pointerId ];\n\n\t\t\tif ( position === undefined ) {\n\n\t\t\t\tposition = new Vector2();\n\t\t\t\tpointerPositions[ event.pointerId ] = position;\n\n\t\t\t}\n\n\t\t\tposition.set( event.pageX, event.pageY );\n\n\t\t}\n\n\t\tfunction getSecondPointerPosition( event ) {\n\n\t\t\tconst pointer = ( event.pointerId === pointers[ 0 ].pointerId ) ? pointers[ 1 ] : pointers[ 0 ];\n\n\t\t\treturn pointerPositions[ pointer.pointerId ];\n\n\t\t}\n\n\t\t//\n\n\t\tscope.domElement.addEventListener( 'contextmenu', onContextMenu );\n\n\t\tscope.domElement.addEventListener( 'pointerdown', onPointerDown );\n\t\tscope.domElement.addEventListener( 'pointercancel', onPointerCancel );\n\t\tscope.domElement.addEventListener( 'wheel', onMouseWheel, { passive: false } );\n\n\t\t// force an update at start\n\n\t\tthis.update();\n\n\t}\n\n}\n\n\n// This set of controls performs orbiting, dollying (zooming), and panning.\n// Unlike TrackballControls, it maintains the \"up\" direction object.up (+Y by default).\n// This is very similar to OrbitControls, another set of touch behavior\n//\n//    Orbit - right mouse, or left mouse + ctrl/meta/shiftKey / touch: two-finger rotate\n//    Zoom - middle mouse, or mousewheel / touch: two-finger spread or squish\n//    Pan - left mouse, or arrow keys / touch: one-finger move\n\nclass MapControls extends OrbitControls {\n\n\tconstructor( object, domElement ) {\n\n\t\tsuper( object, domElement );\n\n\t\tthis.screenSpacePanning = false; // pan orthogonal to world-space direction camera.up\n\n\t\tthis.mouseButtons.LEFT = MOUSE.PAN;\n\t\tthis.mouseButtons.RIGHT = MOUSE.ROTATE;\n\n\t\tthis.touches.ONE = TOUCH.PAN;\n\t\tthis.touches.TWO = TOUCH.DOLLY_ROTATE;\n\n\t}\n\n}\n\nexport { OrbitControls, MapControls };\n","const createStoreImpl = (createState) => {\n  let state;\n  const listeners = /* @__PURE__ */ new Set();\n  const setState = (partial, replace) => {\n    const nextState = typeof partial === \"function\" ? partial(state) : partial;\n    if (!Object.is(nextState, state)) {\n      const previousState = state;\n      state = (replace != null ? replace : typeof nextState !== \"object\" || nextState === null) ? nextState : Object.assign({}, state, nextState);\n      listeners.forEach((listener) => listener(state, previousState));\n    }\n  };\n  const getState = () => state;\n  const subscribe = (listener) => {\n    listeners.add(listener);\n    return () => listeners.delete(listener);\n  };\n  const destroy = () => {\n    if ((import.meta.env ? import.meta.env.MODE : void 0) !== \"production\") {\n      console.warn(\n        \"[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected.\"\n      );\n    }\n    listeners.clear();\n  };\n  const api = { setState, getState, subscribe, destroy };\n  state = createState(setState, getState, api);\n  return api;\n};\nconst createStore = (createState) => createState ? createStoreImpl(createState) : createStoreImpl;\nvar vanilla = (createState) => {\n  if ((import.meta.env ? import.meta.env.MODE : void 0) !== \"production\") {\n    console.warn(\n      \"[DEPRECATED] Default export is deprecated. Instead use import { createStore } from 'zustand/vanilla'.\"\n    );\n  }\n  return createStore(createState);\n};\n\nexport { createStore, vanilla as default };\n","import { createStore } from \"zustand/vanilla\";\n\nexport const sizesStore = createStore(() => ({\n    width: window.innerWidth,\n    height: window.innerHeight,\n    pixelRatio: Math.min(window.devicePixelRatio, 2),\n}));\n\nexport const appStateStore = createStore(() => ({\n    physicsReady: false,\n    assetsReady: false,\n}));\n\nexport const inputStore = createStore(() => ({\n    forward: false,\n    backward: false,\n    left: false,\n    right: false,\n}));","import * as THREE from 'three'\nimport { OrbitControls } from \"three/addons/controls/OrbitControls.js\";\nimport { sizesStore } from './Utils/Store.js';\n\n\nimport App from './App.js'\n\nexport default class Camera{\n    constructor() {\n        this.app = new App()\n        this.canvas = this.app.canvas\n\n        this.sizesStore = sizesStore\n\n        this.sizes = this.sizesStore.getState()\n\n        this.setInstance()\n        this.setControls()\n        this.setResizeLister()\n    }\n\n    setInstance() {\n        this.instance = new THREE.PerspectiveCamera(\n            35,\n            this.sizes.width / this.sizes.height,\n            0.1,\n            1000\n        );\n        this.instance.position.set(0, 20, 100);\n    }\n\n    setControls() {\n        this.controls = new OrbitControls(this.instance, this.canvas);\n        this.controls.enableDamping = true;\n    }\n\n    setResizeLister() {\n        this.sizesStore.subscribe((sizes)=>{\n            this.instance.aspect = sizes.width / sizes.height\n            this.instance.updateProjectionMatrix()\n        })\n    }\n\n    loop() {\n        this.controls.update()\n        this.characterController = this.app.world.characterController?.rigidBody\n        if(this.characterController) {\n            const characterPosition = this.characterController.translation()\n            const characterRotation = this.characterController.rotation()\n\n            const cameraOffset = new THREE.Vector3(0, 20, 25)  // Further reduced from (0, 22, 28)\n            cameraOffset.applyQuaternion(characterRotation)\n            cameraOffset.add(characterPosition)\n\n            const targetOffset = new THREE.Vector3(0, 5, 0)  // Slightly lowered from 6\n            targetOffset.applyQuaternion(characterRotation)\n            targetOffset.add(characterPosition)\n\n            this.instance.position.lerp(cameraOffset, 0.1)\n            this.controls.target.lerp(targetOffset, 0.1)\n        }\n    }\n}","import * as THREE from 'three'\nimport App from './App.js'\nimport { sizesStore } from './Utils/Store.js';\n\nexport default class Renderer{\n    constructor() {\n        this.app = new App()\n        this.canvas = this.app.canvas\n        this.camera = this.app.camera\n        this.scene = this.app.scene\n        this.sizesStore = sizesStore\n        this.sizes = this.sizesStore.getState()\n\n        this.setInstance()\n        this.setResizeLister()\n    }\n\n    setInstance() {\n        this.instance = new THREE.WebGLRenderer({\n            canvas: this.canvas,\n            antialias: true,\n          });\n          this.instance.setSize(this.sizes.width, this.sizes.height);\n          this.instance.setPixelRatio(this.sizes.pixelRatio);\n          this.instance.outputEncoding = THREE.sRGBEncoding;\n          this.instance.shadowMap.enabled = true;\n          this.instance.shadowMap.type = THREE.PCFSoftShadowMap;\n\n          this.instance.toneMapping = THREE.ACESFilmicToneMapping\n        this.instance.toneMappingExposure = 0.8\n\n    }\n\n    setResizeLister() {\n        this.sizesStore.subscribe((sizes)=>{\n            this.instance.setSize(sizes.width, sizes.height)\n            this.instance.setPixelRatio(sizes.pixelRatio)\n        })\n    }\n\n    loop() {\n        this.instance.render(this.scene, this.camera.instance)\n    }\n}"," import * as THREE from 'three'\n import App from '../App.js'\n\n export default class Loop {\n    constructor() {\n        this.app = new App()\n        this.camera = this.app.camera\n        this.renderer = this.app.renderer\n        this.world = this.app.world\n\n        this.clock = new THREE.Clock()\n        this.previousElapsedTime = 0\n        this.loop()\n    }\n\n    loop() {\n        const elapsedTime = this.clock.getElapsedTime()\n        const deltaTime = elapsedTime - this.previousElapsedTime\n        this.previousElapsedTime = elapsedTime\n\n        this.world.loop(deltaTime, elapsedTime)\n        this.camera.loop(deltaTime)\n        this.renderer.loop()\n        window.requestAnimationFrame(() => this.loop())\n    }\n}","/*! Tweakpane 3.1.10 (c) 2016 cocopon, licensed under the MIT license. */\n(function (global, factory) {\n    typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :\n    typeof define === 'function' && define.amd ? define(['exports'], factory) :\n    (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global.Tweakpane = {}));\n})(this, (function (exports) { 'use strict';\n\n    /***\n     * A simple semantic versioning perser.\n     */\n    class Semver {\n        /**\n         * @hidden\n         */\n        constructor(text) {\n            const [core, prerelease] = text.split('-');\n            const coreComps = core.split('.');\n            this.major = parseInt(coreComps[0], 10);\n            this.minor = parseInt(coreComps[1], 10);\n            this.patch = parseInt(coreComps[2], 10);\n            this.prerelease = prerelease !== null && prerelease !== void 0 ? prerelease : null;\n        }\n        toString() {\n            const core = [this.major, this.minor, this.patch].join('.');\n            return this.prerelease !== null ? [core, this.prerelease].join('-') : core;\n        }\n    }\n\n    class BladeApi {\n        constructor(controller) {\n            this.controller_ = controller;\n        }\n        get element() {\n            return this.controller_.view.element;\n        }\n        get disabled() {\n            return this.controller_.viewProps.get('disabled');\n        }\n        set disabled(disabled) {\n            this.controller_.viewProps.set('disabled', disabled);\n        }\n        get hidden() {\n            return this.controller_.viewProps.get('hidden');\n        }\n        set hidden(hidden) {\n            this.controller_.viewProps.set('hidden', hidden);\n        }\n        dispose() {\n            this.controller_.viewProps.set('disposed', true);\n        }\n    }\n\n    class TpEvent {\n        constructor(target) {\n            this.target = target;\n        }\n    }\n    class TpChangeEvent extends TpEvent {\n        constructor(target, value, presetKey, last) {\n            super(target);\n            this.value = value;\n            this.presetKey = presetKey;\n            this.last = last !== null && last !== void 0 ? last : true;\n        }\n    }\n    class TpUpdateEvent extends TpEvent {\n        constructor(target, value, presetKey) {\n            super(target);\n            this.value = value;\n            this.presetKey = presetKey;\n        }\n    }\n    class TpFoldEvent extends TpEvent {\n        constructor(target, expanded) {\n            super(target);\n            this.expanded = expanded;\n        }\n    }\n    class TpTabSelectEvent extends TpEvent {\n        constructor(target, index) {\n            super(target);\n            this.index = index;\n        }\n    }\n\n    function forceCast(v) {\n        return v;\n    }\n    function isEmpty(value) {\n        return value === null || value === undefined;\n    }\n    function deepEqualsArray(a1, a2) {\n        if (a1.length !== a2.length) {\n            return false;\n        }\n        for (let i = 0; i < a1.length; i++) {\n            if (a1[i] !== a2[i]) {\n                return false;\n            }\n        }\n        return true;\n    }\n    function isPropertyWritable(obj, key) {\n        let target = obj;\n        do {\n            const d = Object.getOwnPropertyDescriptor(target, key);\n            if (d && (d.set !== undefined || d.writable === true)) {\n                return true;\n            }\n            target = Object.getPrototypeOf(target);\n        } while (target !== null);\n        return false;\n    }\n\n    const CREATE_MESSAGE_MAP = {\n        alreadydisposed: () => 'View has been already disposed',\n        invalidparams: (context) => `Invalid parameters for '${context.name}'`,\n        nomatchingcontroller: (context) => `No matching controller for '${context.key}'`,\n        nomatchingview: (context) => `No matching view for '${JSON.stringify(context.params)}'`,\n        notbindable: () => `Value is not bindable`,\n        propertynotfound: (context) => `Property '${context.name}' not found`,\n        shouldneverhappen: () => 'This error should never happen',\n    };\n    class TpError {\n        static alreadyDisposed() {\n            return new TpError({ type: 'alreadydisposed' });\n        }\n        static notBindable() {\n            return new TpError({\n                type: 'notbindable',\n            });\n        }\n        static propertyNotFound(name) {\n            return new TpError({\n                type: 'propertynotfound',\n                context: {\n                    name: name,\n                },\n            });\n        }\n        static shouldNeverHappen() {\n            return new TpError({ type: 'shouldneverhappen' });\n        }\n        constructor(config) {\n            var _a;\n            this.message =\n                (_a = CREATE_MESSAGE_MAP[config.type](forceCast(config.context))) !== null && _a !== void 0 ? _a : 'Unexpected error';\n            this.name = this.constructor.name;\n            this.stack = new Error(this.message).stack;\n            this.type = config.type;\n        }\n    }\n\n    class BindingTarget {\n        constructor(obj, key, opt_id) {\n            this.obj_ = obj;\n            this.key_ = key;\n            this.presetKey_ = opt_id !== null && opt_id !== void 0 ? opt_id : key;\n        }\n        static isBindable(obj) {\n            if (obj === null) {\n                return false;\n            }\n            if (typeof obj !== 'object' && typeof obj !== 'function') {\n                return false;\n            }\n            return true;\n        }\n        get key() {\n            return this.key_;\n        }\n        get presetKey() {\n            return this.presetKey_;\n        }\n        read() {\n            return this.obj_[this.key_];\n        }\n        write(value) {\n            this.obj_[this.key_] = value;\n        }\n        writeProperty(name, value) {\n            const valueObj = this.read();\n            if (!BindingTarget.isBindable(valueObj)) {\n                throw TpError.notBindable();\n            }\n            if (!(name in valueObj)) {\n                throw TpError.propertyNotFound(name);\n            }\n            valueObj[name] = value;\n        }\n    }\n\n    class ButtonApi extends BladeApi {\n        get label() {\n            return this.controller_.props.get('label');\n        }\n        set label(label) {\n            this.controller_.props.set('label', label);\n        }\n        get title() {\n            var _a;\n            return (_a = this.controller_.valueController.props.get('title')) !== null && _a !== void 0 ? _a : '';\n        }\n        set title(title) {\n            this.controller_.valueController.props.set('title', title);\n        }\n        on(eventName, handler) {\n            const bh = handler.bind(this);\n            const emitter = this.controller_.valueController.emitter;\n            emitter.on(eventName, () => {\n                bh(new TpEvent(this));\n            });\n            return this;\n        }\n    }\n\n    class Emitter {\n        constructor() {\n            this.observers_ = {};\n        }\n        on(eventName, handler) {\n            let observers = this.observers_[eventName];\n            if (!observers) {\n                observers = this.observers_[eventName] = [];\n            }\n            observers.push({\n                handler: handler,\n            });\n            return this;\n        }\n        off(eventName, handler) {\n            const observers = this.observers_[eventName];\n            if (observers) {\n                this.observers_[eventName] = observers.filter((observer) => {\n                    return observer.handler !== handler;\n                });\n            }\n            return this;\n        }\n        emit(eventName, event) {\n            const observers = this.observers_[eventName];\n            if (!observers) {\n                return;\n            }\n            observers.forEach((observer) => {\n                observer.handler(event);\n            });\n        }\n    }\n\n    const PREFIX = 'tp';\n    function ClassName(viewName) {\n        const fn = (opt_elementName, opt_modifier) => {\n            return [\n                PREFIX,\n                '-',\n                viewName,\n                'v',\n                opt_elementName ? `_${opt_elementName}` : '',\n                opt_modifier ? `-${opt_modifier}` : '',\n            ].join('');\n        };\n        return fn;\n    }\n\n    function compose(h1, h2) {\n        return (input) => h2(h1(input));\n    }\n    function extractValue(ev) {\n        return ev.rawValue;\n    }\n    function bindValue(value, applyValue) {\n        value.emitter.on('change', compose(extractValue, applyValue));\n        applyValue(value.rawValue);\n    }\n    function bindValueMap(valueMap, key, applyValue) {\n        bindValue(valueMap.value(key), applyValue);\n    }\n\n    function applyClass(elem, className, active) {\n        if (active) {\n            elem.classList.add(className);\n        }\n        else {\n            elem.classList.remove(className);\n        }\n    }\n    function valueToClassName(elem, className) {\n        return (value) => {\n            applyClass(elem, className, value);\n        };\n    }\n    function bindValueToTextContent(value, elem) {\n        bindValue(value, (text) => {\n            elem.textContent = text !== null && text !== void 0 ? text : '';\n        });\n    }\n\n    const className$q = ClassName('btn');\n    class ButtonView {\n        constructor(doc, config) {\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$q());\n            config.viewProps.bindClassModifiers(this.element);\n            const buttonElem = doc.createElement('button');\n            buttonElem.classList.add(className$q('b'));\n            config.viewProps.bindDisabled(buttonElem);\n            this.element.appendChild(buttonElem);\n            this.buttonElement = buttonElem;\n            const titleElem = doc.createElement('div');\n            titleElem.classList.add(className$q('t'));\n            bindValueToTextContent(config.props.value('title'), titleElem);\n            this.buttonElement.appendChild(titleElem);\n        }\n    }\n\n    class ButtonController {\n        constructor(doc, config) {\n            this.emitter = new Emitter();\n            this.onClick_ = this.onClick_.bind(this);\n            this.props = config.props;\n            this.viewProps = config.viewProps;\n            this.view = new ButtonView(doc, {\n                props: this.props,\n                viewProps: this.viewProps,\n            });\n            this.view.buttonElement.addEventListener('click', this.onClick_);\n        }\n        onClick_() {\n            this.emitter.emit('click', {\n                sender: this,\n            });\n        }\n    }\n\n    class BoundValue {\n        constructor(initialValue, config) {\n            var _a;\n            this.constraint_ = config === null || config === void 0 ? void 0 : config.constraint;\n            this.equals_ = (_a = config === null || config === void 0 ? void 0 : config.equals) !== null && _a !== void 0 ? _a : ((v1, v2) => v1 === v2);\n            this.emitter = new Emitter();\n            this.rawValue_ = initialValue;\n        }\n        get constraint() {\n            return this.constraint_;\n        }\n        get rawValue() {\n            return this.rawValue_;\n        }\n        set rawValue(rawValue) {\n            this.setRawValue(rawValue, {\n                forceEmit: false,\n                last: true,\n            });\n        }\n        setRawValue(rawValue, options) {\n            const opts = options !== null && options !== void 0 ? options : {\n                forceEmit: false,\n                last: true,\n            };\n            const constrainedValue = this.constraint_\n                ? this.constraint_.constrain(rawValue)\n                : rawValue;\n            const prevValue = this.rawValue_;\n            const changed = !this.equals_(prevValue, constrainedValue);\n            if (!changed && !opts.forceEmit) {\n                return;\n            }\n            this.emitter.emit('beforechange', {\n                sender: this,\n            });\n            this.rawValue_ = constrainedValue;\n            this.emitter.emit('change', {\n                options: opts,\n                previousRawValue: prevValue,\n                rawValue: constrainedValue,\n                sender: this,\n            });\n        }\n    }\n\n    class PrimitiveValue {\n        constructor(initialValue) {\n            this.emitter = new Emitter();\n            this.value_ = initialValue;\n        }\n        get rawValue() {\n            return this.value_;\n        }\n        set rawValue(value) {\n            this.setRawValue(value, {\n                forceEmit: false,\n                last: true,\n            });\n        }\n        setRawValue(value, options) {\n            const opts = options !== null && options !== void 0 ? options : {\n                forceEmit: false,\n                last: true,\n            };\n            const prevValue = this.value_;\n            if (prevValue === value && !opts.forceEmit) {\n                return;\n            }\n            this.emitter.emit('beforechange', {\n                sender: this,\n            });\n            this.value_ = value;\n            this.emitter.emit('change', {\n                options: opts,\n                previousRawValue: prevValue,\n                rawValue: this.value_,\n                sender: this,\n            });\n        }\n    }\n\n    function createValue(initialValue, config) {\n        const constraint = config === null || config === void 0 ? void 0 : config.constraint;\n        const equals = config === null || config === void 0 ? void 0 : config.equals;\n        if (!constraint && !equals) {\n            return new PrimitiveValue(initialValue);\n        }\n        return new BoundValue(initialValue, config);\n    }\n\n    class ValueMap {\n        constructor(valueMap) {\n            this.emitter = new Emitter();\n            this.valMap_ = valueMap;\n            for (const key in this.valMap_) {\n                const v = this.valMap_[key];\n                v.emitter.on('change', () => {\n                    this.emitter.emit('change', {\n                        key: key,\n                        sender: this,\n                    });\n                });\n            }\n        }\n        static createCore(initialValue) {\n            const keys = Object.keys(initialValue);\n            return keys.reduce((o, key) => {\n                return Object.assign(o, {\n                    [key]: createValue(initialValue[key]),\n                });\n            }, {});\n        }\n        static fromObject(initialValue) {\n            const core = this.createCore(initialValue);\n            return new ValueMap(core);\n        }\n        get(key) {\n            return this.valMap_[key].rawValue;\n        }\n        set(key, value) {\n            this.valMap_[key].rawValue = value;\n        }\n        value(key) {\n            return this.valMap_[key];\n        }\n    }\n\n    function parseObject(value, keyToParserMap) {\n        const keys = Object.keys(keyToParserMap);\n        const result = keys.reduce((tmp, key) => {\n            if (tmp === undefined) {\n                return undefined;\n            }\n            const parser = keyToParserMap[key];\n            const result = parser(value[key]);\n            return result.succeeded\n                ? Object.assign(Object.assign({}, tmp), { [key]: result.value }) : undefined;\n        }, {});\n        return forceCast(result);\n    }\n    function parseArray(value, parseItem) {\n        return value.reduce((tmp, item) => {\n            if (tmp === undefined) {\n                return undefined;\n            }\n            const result = parseItem(item);\n            if (!result.succeeded || result.value === undefined) {\n                return undefined;\n            }\n            return [...tmp, result.value];\n        }, []);\n    }\n    function isObject(value) {\n        if (value === null) {\n            return false;\n        }\n        return typeof value === 'object';\n    }\n    function createParamsParserBuilder(parse) {\n        return (optional) => (v) => {\n            if (!optional && v === undefined) {\n                return {\n                    succeeded: false,\n                    value: undefined,\n                };\n            }\n            if (optional && v === undefined) {\n                return {\n                    succeeded: true,\n                    value: undefined,\n                };\n            }\n            const result = parse(v);\n            return result !== undefined\n                ? {\n                    succeeded: true,\n                    value: result,\n                }\n                : {\n                    succeeded: false,\n                    value: undefined,\n                };\n        };\n    }\n    function createParamsParserBuilders(optional) {\n        return {\n            custom: (parse) => createParamsParserBuilder(parse)(optional),\n            boolean: createParamsParserBuilder((v) => typeof v === 'boolean' ? v : undefined)(optional),\n            number: createParamsParserBuilder((v) => typeof v === 'number' ? v : undefined)(optional),\n            string: createParamsParserBuilder((v) => typeof v === 'string' ? v : undefined)(optional),\n            function: createParamsParserBuilder((v) =>\n            typeof v === 'function' ? v : undefined)(optional),\n            constant: (value) => createParamsParserBuilder((v) => (v === value ? value : undefined))(optional),\n            raw: createParamsParserBuilder((v) => v)(optional),\n            object: (keyToParserMap) => createParamsParserBuilder((v) => {\n                if (!isObject(v)) {\n                    return undefined;\n                }\n                return parseObject(v, keyToParserMap);\n            })(optional),\n            array: (itemParser) => createParamsParserBuilder((v) => {\n                if (!Array.isArray(v)) {\n                    return undefined;\n                }\n                return parseArray(v, itemParser);\n            })(optional),\n        };\n    }\n    const ParamsParsers = {\n        optional: createParamsParserBuilders(true),\n        required: createParamsParserBuilders(false),\n    };\n    function parseParams(value, keyToParserMap) {\n        const result = ParamsParsers.required.object(keyToParserMap)(value);\n        return result.succeeded ? result.value : undefined;\n    }\n\n    function warnMissing(info) {\n        console.warn([\n            `Missing '${info.key}' of ${info.target} in ${info.place}.`,\n            'Please rebuild plugins with the latest core package.',\n        ].join(' '));\n    }\n\n    function disposeElement(elem) {\n        if (elem && elem.parentElement) {\n            elem.parentElement.removeChild(elem);\n        }\n        return null;\n    }\n\n    class ReadonlyValue {\n        constructor(value) {\n            this.value_ = value;\n        }\n        static create(value) {\n            return [\n                new ReadonlyValue(value),\n                (rawValue, options) => {\n                    value.setRawValue(rawValue, options);\n                },\n            ];\n        }\n        get emitter() {\n            return this.value_.emitter;\n        }\n        get rawValue() {\n            return this.value_.rawValue;\n        }\n    }\n\n    const className$p = ClassName('');\n    function valueToModifier(elem, modifier) {\n        return valueToClassName(elem, className$p(undefined, modifier));\n    }\n    class ViewProps extends ValueMap {\n        constructor(valueMap) {\n            var _a;\n            super(valueMap);\n            this.onDisabledChange_ = this.onDisabledChange_.bind(this);\n            this.onParentChange_ = this.onParentChange_.bind(this);\n            this.onParentGlobalDisabledChange_ =\n                this.onParentGlobalDisabledChange_.bind(this);\n            [this.globalDisabled_, this.setGlobalDisabled_] = ReadonlyValue.create(createValue(this.getGlobalDisabled_()));\n            this.value('disabled').emitter.on('change', this.onDisabledChange_);\n            this.value('parent').emitter.on('change', this.onParentChange_);\n            (_a = this.get('parent')) === null || _a === void 0 ? void 0 : _a.globalDisabled.emitter.on('change', this.onParentGlobalDisabledChange_);\n        }\n        static create(opt_initialValue) {\n            var _a, _b, _c;\n            const initialValue = opt_initialValue !== null && opt_initialValue !== void 0 ? opt_initialValue : {};\n            return new ViewProps(ValueMap.createCore({\n                disabled: (_a = initialValue.disabled) !== null && _a !== void 0 ? _a : false,\n                disposed: false,\n                hidden: (_b = initialValue.hidden) !== null && _b !== void 0 ? _b : false,\n                parent: (_c = initialValue.parent) !== null && _c !== void 0 ? _c : null,\n            }));\n        }\n        get globalDisabled() {\n            return this.globalDisabled_;\n        }\n        bindClassModifiers(elem) {\n            bindValue(this.globalDisabled_, valueToModifier(elem, 'disabled'));\n            bindValueMap(this, 'hidden', valueToModifier(elem, 'hidden'));\n        }\n        bindDisabled(target) {\n            bindValue(this.globalDisabled_, (disabled) => {\n                target.disabled = disabled;\n            });\n        }\n        bindTabIndex(elem) {\n            bindValue(this.globalDisabled_, (disabled) => {\n                elem.tabIndex = disabled ? -1 : 0;\n            });\n        }\n        handleDispose(callback) {\n            this.value('disposed').emitter.on('change', (disposed) => {\n                if (disposed) {\n                    callback();\n                }\n            });\n        }\n        getGlobalDisabled_() {\n            const parent = this.get('parent');\n            const parentDisabled = parent ? parent.globalDisabled.rawValue : false;\n            return parentDisabled || this.get('disabled');\n        }\n        updateGlobalDisabled_() {\n            this.setGlobalDisabled_(this.getGlobalDisabled_());\n        }\n        onDisabledChange_() {\n            this.updateGlobalDisabled_();\n        }\n        onParentGlobalDisabledChange_() {\n            this.updateGlobalDisabled_();\n        }\n        onParentChange_(ev) {\n            var _a;\n            const prevParent = ev.previousRawValue;\n            prevParent === null || prevParent === void 0 ? void 0 : prevParent.globalDisabled.emitter.off('change', this.onParentGlobalDisabledChange_);\n            (_a = this.get('parent')) === null || _a === void 0 ? void 0 : _a.globalDisabled.emitter.on('change', this.onParentGlobalDisabledChange_);\n            this.updateGlobalDisabled_();\n        }\n    }\n\n    function getAllBladePositions() {\n        return ['veryfirst', 'first', 'last', 'verylast'];\n    }\n\n    const className$o = ClassName('');\n    const POS_TO_CLASS_NAME_MAP = {\n        veryfirst: 'vfst',\n        first: 'fst',\n        last: 'lst',\n        verylast: 'vlst',\n    };\n    class BladeController {\n        constructor(config) {\n            this.parent_ = null;\n            this.blade = config.blade;\n            this.view = config.view;\n            this.viewProps = config.viewProps;\n            const elem = this.view.element;\n            this.blade.value('positions').emitter.on('change', () => {\n                getAllBladePositions().forEach((pos) => {\n                    elem.classList.remove(className$o(undefined, POS_TO_CLASS_NAME_MAP[pos]));\n                });\n                this.blade.get('positions').forEach((pos) => {\n                    elem.classList.add(className$o(undefined, POS_TO_CLASS_NAME_MAP[pos]));\n                });\n            });\n            this.viewProps.handleDispose(() => {\n                disposeElement(elem);\n            });\n        }\n        get parent() {\n            return this.parent_;\n        }\n        set parent(parent) {\n            this.parent_ = parent;\n            if (!('parent' in this.viewProps.valMap_)) {\n                warnMissing({\n                    key: 'parent',\n                    target: ViewProps.name,\n                    place: 'BladeController.parent',\n                });\n                return;\n            }\n            this.viewProps.set('parent', this.parent_ ? this.parent_.viewProps : null);\n        }\n    }\n\n    const SVG_NS = 'http://www.w3.org/2000/svg';\n    function forceReflow(element) {\n        element.offsetHeight;\n    }\n    function disableTransitionTemporarily(element, callback) {\n        const t = element.style.transition;\n        element.style.transition = 'none';\n        callback();\n        element.style.transition = t;\n    }\n    function supportsTouch(doc) {\n        return doc.ontouchstart !== undefined;\n    }\n    function getGlobalObject() {\n        return globalThis;\n    }\n    function getWindowDocument() {\n        const globalObj = forceCast(getGlobalObject());\n        return globalObj.document;\n    }\n    function getCanvasContext(canvasElement) {\n        const win = canvasElement.ownerDocument.defaultView;\n        if (!win) {\n            return null;\n        }\n        const isBrowser = 'document' in win;\n        return isBrowser\n            ? canvasElement.getContext('2d', {\n                willReadFrequently: true,\n            })\n            : null;\n    }\n    const ICON_ID_TO_INNER_HTML_MAP = {\n        check: '<path d=\"M2 8l4 4l8 -8\"/>',\n        dropdown: '<path d=\"M5 7h6l-3 3 z\"/>',\n        p2dpad: '<path d=\"M8 4v8\"/><path d=\"M4 8h8\"/><circle cx=\"12\" cy=\"12\" r=\"1.2\"/>',\n    };\n    function createSvgIconElement(document, iconId) {\n        const elem = document.createElementNS(SVG_NS, 'svg');\n        elem.innerHTML = ICON_ID_TO_INNER_HTML_MAP[iconId];\n        return elem;\n    }\n    function insertElementAt(parentElement, element, index) {\n        parentElement.insertBefore(element, parentElement.children[index]);\n    }\n    function removeElement(element) {\n        if (element.parentElement) {\n            element.parentElement.removeChild(element);\n        }\n    }\n    function removeChildElements(element) {\n        while (element.children.length > 0) {\n            element.removeChild(element.children[0]);\n        }\n    }\n    function removeChildNodes(element) {\n        while (element.childNodes.length > 0) {\n            element.removeChild(element.childNodes[0]);\n        }\n    }\n    function findNextTarget(ev) {\n        if (ev.relatedTarget) {\n            return forceCast(ev.relatedTarget);\n        }\n        if ('explicitOriginalTarget' in ev) {\n            return ev.explicitOriginalTarget;\n        }\n        return null;\n    }\n\n    const className$n = ClassName('lbl');\n    function createLabelNode(doc, label) {\n        const frag = doc.createDocumentFragment();\n        const lineNodes = label.split('\\n').map((line) => {\n            return doc.createTextNode(line);\n        });\n        lineNodes.forEach((lineNode, index) => {\n            if (index > 0) {\n                frag.appendChild(doc.createElement('br'));\n            }\n            frag.appendChild(lineNode);\n        });\n        return frag;\n    }\n    class LabelView {\n        constructor(doc, config) {\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$n());\n            config.viewProps.bindClassModifiers(this.element);\n            const labelElem = doc.createElement('div');\n            labelElem.classList.add(className$n('l'));\n            bindValueMap(config.props, 'label', (value) => {\n                if (isEmpty(value)) {\n                    this.element.classList.add(className$n(undefined, 'nol'));\n                }\n                else {\n                    this.element.classList.remove(className$n(undefined, 'nol'));\n                    removeChildNodes(labelElem);\n                    labelElem.appendChild(createLabelNode(doc, value));\n                }\n            });\n            this.element.appendChild(labelElem);\n            this.labelElement = labelElem;\n            const valueElem = doc.createElement('div');\n            valueElem.classList.add(className$n('v'));\n            this.element.appendChild(valueElem);\n            this.valueElement = valueElem;\n        }\n    }\n\n    class LabelController extends BladeController {\n        constructor(doc, config) {\n            const viewProps = config.valueController.viewProps;\n            super(Object.assign(Object.assign({}, config), { view: new LabelView(doc, {\n                    props: config.props,\n                    viewProps: viewProps,\n                }), viewProps: viewProps }));\n            this.props = config.props;\n            this.valueController = config.valueController;\n            this.view.valueElement.appendChild(this.valueController.view.element);\n        }\n    }\n\n    const ButtonBladePlugin = {\n        id: 'button',\n        type: 'blade',\n        accept(params) {\n            const p = ParamsParsers;\n            const result = parseParams(params, {\n                title: p.required.string,\n                view: p.required.constant('button'),\n                label: p.optional.string,\n            });\n            return result ? { params: result } : null;\n        },\n        controller(args) {\n            return new LabelController(args.document, {\n                blade: args.blade,\n                props: ValueMap.fromObject({\n                    label: args.params.label,\n                }),\n                valueController: new ButtonController(args.document, {\n                    props: ValueMap.fromObject({\n                        title: args.params.title,\n                    }),\n                    viewProps: args.viewProps,\n                }),\n            });\n        },\n        api(args) {\n            if (!(args.controller instanceof LabelController)) {\n                return null;\n            }\n            if (!(args.controller.valueController instanceof ButtonController)) {\n                return null;\n            }\n            return new ButtonApi(args.controller);\n        },\n    };\n\n    class ValueBladeController extends BladeController {\n        constructor(config) {\n            super(config);\n            this.value = config.value;\n        }\n    }\n\n    function createBlade() {\n        return new ValueMap({\n            positions: createValue([], {\n                equals: deepEqualsArray,\n            }),\n        });\n    }\n\n    class Foldable extends ValueMap {\n        constructor(valueMap) {\n            super(valueMap);\n        }\n        static create(expanded) {\n            const coreObj = {\n                completed: true,\n                expanded: expanded,\n                expandedHeight: null,\n                shouldFixHeight: false,\n                temporaryExpanded: null,\n            };\n            const core = ValueMap.createCore(coreObj);\n            return new Foldable(core);\n        }\n        get styleExpanded() {\n            var _a;\n            return (_a = this.get('temporaryExpanded')) !== null && _a !== void 0 ? _a : this.get('expanded');\n        }\n        get styleHeight() {\n            if (!this.styleExpanded) {\n                return '0';\n            }\n            const exHeight = this.get('expandedHeight');\n            if (this.get('shouldFixHeight') && !isEmpty(exHeight)) {\n                return `${exHeight}px`;\n            }\n            return 'auto';\n        }\n        bindExpandedClass(elem, expandedClassName) {\n            const onExpand = () => {\n                const expanded = this.styleExpanded;\n                if (expanded) {\n                    elem.classList.add(expandedClassName);\n                }\n                else {\n                    elem.classList.remove(expandedClassName);\n                }\n            };\n            bindValueMap(this, 'expanded', onExpand);\n            bindValueMap(this, 'temporaryExpanded', onExpand);\n        }\n        cleanUpTransition() {\n            this.set('shouldFixHeight', false);\n            this.set('expandedHeight', null);\n            this.set('completed', true);\n        }\n    }\n    function computeExpandedFolderHeight(folder, containerElement) {\n        let height = 0;\n        disableTransitionTemporarily(containerElement, () => {\n            folder.set('expandedHeight', null);\n            folder.set('temporaryExpanded', true);\n            forceReflow(containerElement);\n            height = containerElement.clientHeight;\n            folder.set('temporaryExpanded', null);\n            forceReflow(containerElement);\n        });\n        return height;\n    }\n    function applyHeight(foldable, elem) {\n        elem.style.height = foldable.styleHeight;\n    }\n    function bindFoldable(foldable, elem) {\n        foldable.value('expanded').emitter.on('beforechange', () => {\n            foldable.set('completed', false);\n            if (isEmpty(foldable.get('expandedHeight'))) {\n                const h = computeExpandedFolderHeight(foldable, elem);\n                if (h > 0) {\n                    foldable.set('expandedHeight', h);\n                }\n            }\n            foldable.set('shouldFixHeight', true);\n            forceReflow(elem);\n        });\n        foldable.emitter.on('change', () => {\n            applyHeight(foldable, elem);\n        });\n        applyHeight(foldable, elem);\n        elem.addEventListener('transitionend', (ev) => {\n            if (ev.propertyName !== 'height') {\n                return;\n            }\n            foldable.cleanUpTransition();\n        });\n    }\n\n    class RackLikeApi extends BladeApi {\n        constructor(controller, rackApi) {\n            super(controller);\n            this.rackApi_ = rackApi;\n        }\n    }\n\n    function addButtonAsBlade(api, params) {\n        return api.addBlade(Object.assign(Object.assign({}, params), { view: 'button' }));\n    }\n    function addFolderAsBlade(api, params) {\n        return api.addBlade(Object.assign(Object.assign({}, params), { view: 'folder' }));\n    }\n    function addSeparatorAsBlade(api, opt_params) {\n        const params = opt_params !== null && opt_params !== void 0 ? opt_params : {};\n        return api.addBlade(Object.assign(Object.assign({}, params), { view: 'separator' }));\n    }\n    function addTabAsBlade(api, params) {\n        return api.addBlade(Object.assign(Object.assign({}, params), { view: 'tab' }));\n    }\n\n    class NestedOrderedSet {\n        constructor(extract) {\n            this.emitter = new Emitter();\n            this.items_ = [];\n            this.cache_ = new Set();\n            this.onSubListAdd_ = this.onSubListAdd_.bind(this);\n            this.onSubListRemove_ = this.onSubListRemove_.bind(this);\n            this.extract_ = extract;\n        }\n        get items() {\n            return this.items_;\n        }\n        allItems() {\n            return Array.from(this.cache_);\n        }\n        find(callback) {\n            for (const item of this.allItems()) {\n                if (callback(item)) {\n                    return item;\n                }\n            }\n            return null;\n        }\n        includes(item) {\n            return this.cache_.has(item);\n        }\n        add(item, opt_index) {\n            if (this.includes(item)) {\n                throw TpError.shouldNeverHappen();\n            }\n            const index = opt_index !== undefined ? opt_index : this.items_.length;\n            this.items_.splice(index, 0, item);\n            this.cache_.add(item);\n            const subList = this.extract_(item);\n            if (subList) {\n                subList.emitter.on('add', this.onSubListAdd_);\n                subList.emitter.on('remove', this.onSubListRemove_);\n                subList.allItems().forEach((item) => {\n                    this.cache_.add(item);\n                });\n            }\n            this.emitter.emit('add', {\n                index: index,\n                item: item,\n                root: this,\n                target: this,\n            });\n        }\n        remove(item) {\n            const index = this.items_.indexOf(item);\n            if (index < 0) {\n                return;\n            }\n            this.items_.splice(index, 1);\n            this.cache_.delete(item);\n            const subList = this.extract_(item);\n            if (subList) {\n                subList.emitter.off('add', this.onSubListAdd_);\n                subList.emitter.off('remove', this.onSubListRemove_);\n            }\n            this.emitter.emit('remove', {\n                index: index,\n                item: item,\n                root: this,\n                target: this,\n            });\n        }\n        onSubListAdd_(ev) {\n            this.cache_.add(ev.item);\n            this.emitter.emit('add', {\n                index: ev.index,\n                item: ev.item,\n                root: this,\n                target: ev.target,\n            });\n        }\n        onSubListRemove_(ev) {\n            this.cache_.delete(ev.item);\n            this.emitter.emit('remove', {\n                index: ev.index,\n                item: ev.item,\n                root: this,\n                target: ev.target,\n            });\n        }\n    }\n\n    class InputBindingApi extends BladeApi {\n        constructor(controller) {\n            super(controller);\n            this.onBindingChange_ = this.onBindingChange_.bind(this);\n            this.emitter_ = new Emitter();\n            this.controller_.binding.emitter.on('change', this.onBindingChange_);\n        }\n        get label() {\n            return this.controller_.props.get('label');\n        }\n        set label(label) {\n            this.controller_.props.set('label', label);\n        }\n        on(eventName, handler) {\n            const bh = handler.bind(this);\n            this.emitter_.on(eventName, (ev) => {\n                bh(ev.event);\n            });\n            return this;\n        }\n        refresh() {\n            this.controller_.binding.read();\n        }\n        onBindingChange_(ev) {\n            const value = ev.sender.target.read();\n            this.emitter_.emit('change', {\n                event: new TpChangeEvent(this, forceCast(value), this.controller_.binding.target.presetKey, ev.options.last),\n            });\n        }\n    }\n\n    class InputBindingController extends LabelController {\n        constructor(doc, config) {\n            super(doc, config);\n            this.binding = config.binding;\n        }\n    }\n\n    class MonitorBindingApi extends BladeApi {\n        constructor(controller) {\n            super(controller);\n            this.onBindingUpdate_ = this.onBindingUpdate_.bind(this);\n            this.emitter_ = new Emitter();\n            this.controller_.binding.emitter.on('update', this.onBindingUpdate_);\n        }\n        get label() {\n            return this.controller_.props.get('label');\n        }\n        set label(label) {\n            this.controller_.props.set('label', label);\n        }\n        on(eventName, handler) {\n            const bh = handler.bind(this);\n            this.emitter_.on(eventName, (ev) => {\n                bh(ev.event);\n            });\n            return this;\n        }\n        refresh() {\n            this.controller_.binding.read();\n        }\n        onBindingUpdate_(ev) {\n            const value = ev.sender.target.read();\n            this.emitter_.emit('update', {\n                event: new TpUpdateEvent(this, forceCast(value), this.controller_.binding.target.presetKey),\n            });\n        }\n    }\n\n    class MonitorBindingController extends LabelController {\n        constructor(doc, config) {\n            super(doc, config);\n            this.binding = config.binding;\n            this.viewProps.bindDisabled(this.binding.ticker);\n            this.viewProps.handleDispose(() => {\n                this.binding.dispose();\n            });\n        }\n    }\n\n    function findSubBladeApiSet(api) {\n        if (api instanceof RackApi) {\n            return api['apiSet_'];\n        }\n        if (api instanceof RackLikeApi) {\n            return api['rackApi_']['apiSet_'];\n        }\n        return null;\n    }\n    function getApiByController(apiSet, controller) {\n        const api = apiSet.find((api) => api.controller_ === controller);\n        if (!api) {\n            throw TpError.shouldNeverHappen();\n        }\n        return api;\n    }\n    function createBindingTarget(obj, key, opt_id) {\n        if (!BindingTarget.isBindable(obj)) {\n            throw TpError.notBindable();\n        }\n        return new BindingTarget(obj, key, opt_id);\n    }\n    class RackApi extends BladeApi {\n        constructor(controller, pool) {\n            super(controller);\n            this.onRackAdd_ = this.onRackAdd_.bind(this);\n            this.onRackRemove_ = this.onRackRemove_.bind(this);\n            this.onRackInputChange_ = this.onRackInputChange_.bind(this);\n            this.onRackMonitorUpdate_ = this.onRackMonitorUpdate_.bind(this);\n            this.emitter_ = new Emitter();\n            this.apiSet_ = new NestedOrderedSet(findSubBladeApiSet);\n            this.pool_ = pool;\n            const rack = this.controller_.rack;\n            rack.emitter.on('add', this.onRackAdd_);\n            rack.emitter.on('remove', this.onRackRemove_);\n            rack.emitter.on('inputchange', this.onRackInputChange_);\n            rack.emitter.on('monitorupdate', this.onRackMonitorUpdate_);\n            rack.children.forEach((bc) => {\n                this.setUpApi_(bc);\n            });\n        }\n        get children() {\n            return this.controller_.rack.children.map((bc) => getApiByController(this.apiSet_, bc));\n        }\n        addInput(object, key, opt_params) {\n            const params = opt_params !== null && opt_params !== void 0 ? opt_params : {};\n            const doc = this.controller_.view.element.ownerDocument;\n            const bc = this.pool_.createInput(doc, createBindingTarget(object, key, params.presetKey), params);\n            const api = new InputBindingApi(bc);\n            return this.add(api, params.index);\n        }\n        addMonitor(object, key, opt_params) {\n            const params = opt_params !== null && opt_params !== void 0 ? opt_params : {};\n            const doc = this.controller_.view.element.ownerDocument;\n            const bc = this.pool_.createMonitor(doc, createBindingTarget(object, key), params);\n            const api = new MonitorBindingApi(bc);\n            return forceCast(this.add(api, params.index));\n        }\n        addFolder(params) {\n            return addFolderAsBlade(this, params);\n        }\n        addButton(params) {\n            return addButtonAsBlade(this, params);\n        }\n        addSeparator(opt_params) {\n            return addSeparatorAsBlade(this, opt_params);\n        }\n        addTab(params) {\n            return addTabAsBlade(this, params);\n        }\n        add(api, opt_index) {\n            this.controller_.rack.add(api.controller_, opt_index);\n            const gapi = this.apiSet_.find((a) => a.controller_ === api.controller_);\n            if (gapi) {\n                this.apiSet_.remove(gapi);\n            }\n            this.apiSet_.add(api);\n            return api;\n        }\n        remove(api) {\n            this.controller_.rack.remove(api.controller_);\n        }\n        addBlade(params) {\n            const doc = this.controller_.view.element.ownerDocument;\n            const bc = this.pool_.createBlade(doc, params);\n            const api = this.pool_.createBladeApi(bc);\n            return this.add(api, params.index);\n        }\n        on(eventName, handler) {\n            const bh = handler.bind(this);\n            this.emitter_.on(eventName, (ev) => {\n                bh(ev.event);\n            });\n            return this;\n        }\n        setUpApi_(bc) {\n            const api = this.apiSet_.find((api) => api.controller_ === bc);\n            if (!api) {\n                this.apiSet_.add(this.pool_.createBladeApi(bc));\n            }\n        }\n        onRackAdd_(ev) {\n            this.setUpApi_(ev.bladeController);\n        }\n        onRackRemove_(ev) {\n            if (ev.isRoot) {\n                const api = getApiByController(this.apiSet_, ev.bladeController);\n                this.apiSet_.remove(api);\n            }\n        }\n        onRackInputChange_(ev) {\n            const bc = ev.bladeController;\n            if (bc instanceof InputBindingController) {\n                const api = getApiByController(this.apiSet_, bc);\n                const binding = bc.binding;\n                this.emitter_.emit('change', {\n                    event: new TpChangeEvent(api, forceCast(binding.target.read()), binding.target.presetKey, ev.options.last),\n                });\n            }\n            else if (bc instanceof ValueBladeController) {\n                const api = getApiByController(this.apiSet_, bc);\n                this.emitter_.emit('change', {\n                    event: new TpChangeEvent(api, bc.value.rawValue, undefined, ev.options.last),\n                });\n            }\n        }\n        onRackMonitorUpdate_(ev) {\n            if (!(ev.bladeController instanceof MonitorBindingController)) {\n                throw TpError.shouldNeverHappen();\n            }\n            const api = getApiByController(this.apiSet_, ev.bladeController);\n            const binding = ev.bladeController.binding;\n            this.emitter_.emit('update', {\n                event: new TpUpdateEvent(api, forceCast(binding.target.read()), binding.target.presetKey),\n            });\n        }\n    }\n\n    class FolderApi extends RackLikeApi {\n        constructor(controller, pool) {\n            super(controller, new RackApi(controller.rackController, pool));\n            this.emitter_ = new Emitter();\n            this.controller_.foldable\n                .value('expanded')\n                .emitter.on('change', (ev) => {\n                this.emitter_.emit('fold', {\n                    event: new TpFoldEvent(this, ev.sender.rawValue),\n                });\n            });\n            this.rackApi_.on('change', (ev) => {\n                this.emitter_.emit('change', {\n                    event: ev,\n                });\n            });\n            this.rackApi_.on('update', (ev) => {\n                this.emitter_.emit('update', {\n                    event: ev,\n                });\n            });\n        }\n        get expanded() {\n            return this.controller_.foldable.get('expanded');\n        }\n        set expanded(expanded) {\n            this.controller_.foldable.set('expanded', expanded);\n        }\n        get title() {\n            return this.controller_.props.get('title');\n        }\n        set title(title) {\n            this.controller_.props.set('title', title);\n        }\n        get children() {\n            return this.rackApi_.children;\n        }\n        addInput(object, key, opt_params) {\n            return this.rackApi_.addInput(object, key, opt_params);\n        }\n        addMonitor(object, key, opt_params) {\n            return this.rackApi_.addMonitor(object, key, opt_params);\n        }\n        addFolder(params) {\n            return this.rackApi_.addFolder(params);\n        }\n        addButton(params) {\n            return this.rackApi_.addButton(params);\n        }\n        addSeparator(opt_params) {\n            return this.rackApi_.addSeparator(opt_params);\n        }\n        addTab(params) {\n            return this.rackApi_.addTab(params);\n        }\n        add(api, opt_index) {\n            return this.rackApi_.add(api, opt_index);\n        }\n        remove(api) {\n            this.rackApi_.remove(api);\n        }\n        addBlade(params) {\n            return this.rackApi_.addBlade(params);\n        }\n        on(eventName, handler) {\n            const bh = handler.bind(this);\n            this.emitter_.on(eventName, (ev) => {\n                bh(ev.event);\n            });\n            return this;\n        }\n    }\n\n    class RackLikeController extends BladeController {\n        constructor(config) {\n            super({\n                blade: config.blade,\n                view: config.view,\n                viewProps: config.rackController.viewProps,\n            });\n            this.rackController = config.rackController;\n        }\n    }\n\n    class PlainView {\n        constructor(doc, config) {\n            const className = ClassName(config.viewName);\n            this.element = doc.createElement('div');\n            this.element.classList.add(className());\n            config.viewProps.bindClassModifiers(this.element);\n        }\n    }\n\n    function findInputBindingController(bcs, b) {\n        for (let i = 0; i < bcs.length; i++) {\n            const bc = bcs[i];\n            if (bc instanceof InputBindingController && bc.binding === b) {\n                return bc;\n            }\n        }\n        return null;\n    }\n    function findMonitorBindingController(bcs, b) {\n        for (let i = 0; i < bcs.length; i++) {\n            const bc = bcs[i];\n            if (bc instanceof MonitorBindingController && bc.binding === b) {\n                return bc;\n            }\n        }\n        return null;\n    }\n    function findValueBladeController(bcs, v) {\n        for (let i = 0; i < bcs.length; i++) {\n            const bc = bcs[i];\n            if (bc instanceof ValueBladeController && bc.value === v) {\n                return bc;\n            }\n        }\n        return null;\n    }\n    function findSubRack(bc) {\n        if (bc instanceof RackController) {\n            return bc.rack;\n        }\n        if (bc instanceof RackLikeController) {\n            return bc.rackController.rack;\n        }\n        return null;\n    }\n    function findSubBladeControllerSet(bc) {\n        const rack = findSubRack(bc);\n        return rack ? rack['bcSet_'] : null;\n    }\n    class BladeRack {\n        constructor(config) {\n            var _a, _b;\n            this.onBladePositionsChange_ = this.onBladePositionsChange_.bind(this);\n            this.onSetAdd_ = this.onSetAdd_.bind(this);\n            this.onSetRemove_ = this.onSetRemove_.bind(this);\n            this.onChildDispose_ = this.onChildDispose_.bind(this);\n            this.onChildPositionsChange_ = this.onChildPositionsChange_.bind(this);\n            this.onChildInputChange_ = this.onChildInputChange_.bind(this);\n            this.onChildMonitorUpdate_ = this.onChildMonitorUpdate_.bind(this);\n            this.onChildValueChange_ = this.onChildValueChange_.bind(this);\n            this.onChildViewPropsChange_ = this.onChildViewPropsChange_.bind(this);\n            this.onDescendantLayout_ = this.onDescendantLayout_.bind(this);\n            this.onDescendantInputChange_ = this.onDescendantInputChange_.bind(this);\n            this.onDescendantMonitorUpdate_ =\n                this.onDescendantMonitorUpdate_.bind(this);\n            this.emitter = new Emitter();\n            this.blade_ = (_a = config.blade) !== null && _a !== void 0 ? _a : null;\n            (_b = this.blade_) === null || _b === void 0 ? void 0 : _b.value('positions').emitter.on('change', this.onBladePositionsChange_);\n            this.viewProps = config.viewProps;\n            this.bcSet_ = new NestedOrderedSet(findSubBladeControllerSet);\n            this.bcSet_.emitter.on('add', this.onSetAdd_);\n            this.bcSet_.emitter.on('remove', this.onSetRemove_);\n        }\n        get children() {\n            return this.bcSet_.items;\n        }\n        add(bc, opt_index) {\n            var _a;\n            (_a = bc.parent) === null || _a === void 0 ? void 0 : _a.remove(bc);\n            if (isPropertyWritable(bc, 'parent')) {\n                bc.parent = this;\n            }\n            else {\n                bc['parent_'] = this;\n                warnMissing({\n                    key: 'parent',\n                    target: 'BladeController',\n                    place: 'BladeRack.add',\n                });\n            }\n            this.bcSet_.add(bc, opt_index);\n        }\n        remove(bc) {\n            if (isPropertyWritable(bc, 'parent')) {\n                bc.parent = null;\n            }\n            else {\n                bc['parent_'] = null;\n                warnMissing({\n                    key: 'parent',\n                    target: 'BladeController',\n                    place: 'BladeRack.remove',\n                });\n            }\n            this.bcSet_.remove(bc);\n        }\n        find(controllerClass) {\n            return forceCast(this.bcSet_.allItems().filter((bc) => {\n                return bc instanceof controllerClass;\n            }));\n        }\n        onSetAdd_(ev) {\n            this.updatePositions_();\n            const isRoot = ev.target === ev.root;\n            this.emitter.emit('add', {\n                bladeController: ev.item,\n                index: ev.index,\n                isRoot: isRoot,\n                sender: this,\n            });\n            if (!isRoot) {\n                return;\n            }\n            const bc = ev.item;\n            bc.viewProps.emitter.on('change', this.onChildViewPropsChange_);\n            bc.blade\n                .value('positions')\n                .emitter.on('change', this.onChildPositionsChange_);\n            bc.viewProps.handleDispose(this.onChildDispose_);\n            if (bc instanceof InputBindingController) {\n                bc.binding.emitter.on('change', this.onChildInputChange_);\n            }\n            else if (bc instanceof MonitorBindingController) {\n                bc.binding.emitter.on('update', this.onChildMonitorUpdate_);\n            }\n            else if (bc instanceof ValueBladeController) {\n                bc.value.emitter.on('change', this.onChildValueChange_);\n            }\n            else {\n                const rack = findSubRack(bc);\n                if (rack) {\n                    const emitter = rack.emitter;\n                    emitter.on('layout', this.onDescendantLayout_);\n                    emitter.on('inputchange', this.onDescendantInputChange_);\n                    emitter.on('monitorupdate', this.onDescendantMonitorUpdate_);\n                }\n            }\n        }\n        onSetRemove_(ev) {\n            this.updatePositions_();\n            const isRoot = ev.target === ev.root;\n            this.emitter.emit('remove', {\n                bladeController: ev.item,\n                isRoot: isRoot,\n                sender: this,\n            });\n            if (!isRoot) {\n                return;\n            }\n            const bc = ev.item;\n            if (bc instanceof InputBindingController) {\n                bc.binding.emitter.off('change', this.onChildInputChange_);\n            }\n            else if (bc instanceof MonitorBindingController) {\n                bc.binding.emitter.off('update', this.onChildMonitorUpdate_);\n            }\n            else if (bc instanceof ValueBladeController) {\n                bc.value.emitter.off('change', this.onChildValueChange_);\n            }\n            else {\n                const rack = findSubRack(bc);\n                if (rack) {\n                    const emitter = rack.emitter;\n                    emitter.off('layout', this.onDescendantLayout_);\n                    emitter.off('inputchange', this.onDescendantInputChange_);\n                    emitter.off('monitorupdate', this.onDescendantMonitorUpdate_);\n                }\n            }\n        }\n        updatePositions_() {\n            const visibleItems = this.bcSet_.items.filter((bc) => !bc.viewProps.get('hidden'));\n            const firstVisibleItem = visibleItems[0];\n            const lastVisibleItem = visibleItems[visibleItems.length - 1];\n            this.bcSet_.items.forEach((bc) => {\n                const ps = [];\n                if (bc === firstVisibleItem) {\n                    ps.push('first');\n                    if (!this.blade_ ||\n                        this.blade_.get('positions').includes('veryfirst')) {\n                        ps.push('veryfirst');\n                    }\n                }\n                if (bc === lastVisibleItem) {\n                    ps.push('last');\n                    if (!this.blade_ || this.blade_.get('positions').includes('verylast')) {\n                        ps.push('verylast');\n                    }\n                }\n                bc.blade.set('positions', ps);\n            });\n        }\n        onChildPositionsChange_() {\n            this.updatePositions_();\n            this.emitter.emit('layout', {\n                sender: this,\n            });\n        }\n        onChildViewPropsChange_(_ev) {\n            this.updatePositions_();\n            this.emitter.emit('layout', {\n                sender: this,\n            });\n        }\n        onChildDispose_() {\n            const disposedUcs = this.bcSet_.items.filter((bc) => {\n                return bc.viewProps.get('disposed');\n            });\n            disposedUcs.forEach((bc) => {\n                this.bcSet_.remove(bc);\n            });\n        }\n        onChildInputChange_(ev) {\n            const bc = findInputBindingController(this.find(InputBindingController), ev.sender);\n            if (!bc) {\n                throw TpError.alreadyDisposed();\n            }\n            this.emitter.emit('inputchange', {\n                bladeController: bc,\n                options: ev.options,\n                sender: this,\n            });\n        }\n        onChildMonitorUpdate_(ev) {\n            const bc = findMonitorBindingController(this.find(MonitorBindingController), ev.sender);\n            if (!bc) {\n                throw TpError.alreadyDisposed();\n            }\n            this.emitter.emit('monitorupdate', {\n                bladeController: bc,\n                sender: this,\n            });\n        }\n        onChildValueChange_(ev) {\n            const bc = findValueBladeController(this.find(ValueBladeController), ev.sender);\n            if (!bc) {\n                throw TpError.alreadyDisposed();\n            }\n            this.emitter.emit('inputchange', {\n                bladeController: bc,\n                options: ev.options,\n                sender: this,\n            });\n        }\n        onDescendantLayout_(_) {\n            this.updatePositions_();\n            this.emitter.emit('layout', {\n                sender: this,\n            });\n        }\n        onDescendantInputChange_(ev) {\n            this.emitter.emit('inputchange', {\n                bladeController: ev.bladeController,\n                options: ev.options,\n                sender: this,\n            });\n        }\n        onDescendantMonitorUpdate_(ev) {\n            this.emitter.emit('monitorupdate', {\n                bladeController: ev.bladeController,\n                sender: this,\n            });\n        }\n        onBladePositionsChange_() {\n            this.updatePositions_();\n        }\n    }\n\n    class RackController extends BladeController {\n        constructor(doc, config) {\n            super(Object.assign(Object.assign({}, config), { view: new PlainView(doc, {\n                    viewName: 'brk',\n                    viewProps: config.viewProps,\n                }) }));\n            this.onRackAdd_ = this.onRackAdd_.bind(this);\n            this.onRackRemove_ = this.onRackRemove_.bind(this);\n            const rack = new BladeRack({\n                blade: config.root ? undefined : config.blade,\n                viewProps: config.viewProps,\n            });\n            rack.emitter.on('add', this.onRackAdd_);\n            rack.emitter.on('remove', this.onRackRemove_);\n            this.rack = rack;\n            this.viewProps.handleDispose(() => {\n                for (let i = this.rack.children.length - 1; i >= 0; i--) {\n                    const bc = this.rack.children[i];\n                    bc.viewProps.set('disposed', true);\n                }\n            });\n        }\n        onRackAdd_(ev) {\n            if (!ev.isRoot) {\n                return;\n            }\n            insertElementAt(this.view.element, ev.bladeController.view.element, ev.index);\n        }\n        onRackRemove_(ev) {\n            if (!ev.isRoot) {\n                return;\n            }\n            removeElement(ev.bladeController.view.element);\n        }\n    }\n\n    const bladeContainerClassName = ClassName('cnt');\n\n    class FolderView {\n        constructor(doc, config) {\n            var _a;\n            this.className_ = ClassName((_a = config.viewName) !== null && _a !== void 0 ? _a : 'fld');\n            this.element = doc.createElement('div');\n            this.element.classList.add(this.className_(), bladeContainerClassName());\n            config.viewProps.bindClassModifiers(this.element);\n            this.foldable_ = config.foldable;\n            this.foldable_.bindExpandedClass(this.element, this.className_(undefined, 'expanded'));\n            bindValueMap(this.foldable_, 'completed', valueToClassName(this.element, this.className_(undefined, 'cpl')));\n            const buttonElem = doc.createElement('button');\n            buttonElem.classList.add(this.className_('b'));\n            bindValueMap(config.props, 'title', (title) => {\n                if (isEmpty(title)) {\n                    this.element.classList.add(this.className_(undefined, 'not'));\n                }\n                else {\n                    this.element.classList.remove(this.className_(undefined, 'not'));\n                }\n            });\n            config.viewProps.bindDisabled(buttonElem);\n            this.element.appendChild(buttonElem);\n            this.buttonElement = buttonElem;\n            const indentElem = doc.createElement('div');\n            indentElem.classList.add(this.className_('i'));\n            this.element.appendChild(indentElem);\n            const titleElem = doc.createElement('div');\n            titleElem.classList.add(this.className_('t'));\n            bindValueToTextContent(config.props.value('title'), titleElem);\n            this.buttonElement.appendChild(titleElem);\n            this.titleElement = titleElem;\n            const markElem = doc.createElement('div');\n            markElem.classList.add(this.className_('m'));\n            this.buttonElement.appendChild(markElem);\n            const containerElem = config.containerElement;\n            containerElem.classList.add(this.className_('c'));\n            this.element.appendChild(containerElem);\n            this.containerElement = containerElem;\n        }\n    }\n\n    class FolderController extends RackLikeController {\n        constructor(doc, config) {\n            var _a;\n            const foldable = Foldable.create((_a = config.expanded) !== null && _a !== void 0 ? _a : true);\n            const rc = new RackController(doc, {\n                blade: config.blade,\n                root: config.root,\n                viewProps: config.viewProps,\n            });\n            super(Object.assign(Object.assign({}, config), { rackController: rc, view: new FolderView(doc, {\n                    containerElement: rc.view.element,\n                    foldable: foldable,\n                    props: config.props,\n                    viewName: config.root ? 'rot' : undefined,\n                    viewProps: config.viewProps,\n                }) }));\n            this.onTitleClick_ = this.onTitleClick_.bind(this);\n            this.props = config.props;\n            this.foldable = foldable;\n            bindFoldable(this.foldable, this.view.containerElement);\n            this.rackController.rack.emitter.on('add', () => {\n                this.foldable.cleanUpTransition();\n            });\n            this.rackController.rack.emitter.on('remove', () => {\n                this.foldable.cleanUpTransition();\n            });\n            this.view.buttonElement.addEventListener('click', this.onTitleClick_);\n        }\n        get document() {\n            return this.view.element.ownerDocument;\n        }\n        onTitleClick_() {\n            this.foldable.set('expanded', !this.foldable.get('expanded'));\n        }\n    }\n\n    const FolderBladePlugin = {\n        id: 'folder',\n        type: 'blade',\n        accept(params) {\n            const p = ParamsParsers;\n            const result = parseParams(params, {\n                title: p.required.string,\n                view: p.required.constant('folder'),\n                expanded: p.optional.boolean,\n            });\n            return result ? { params: result } : null;\n        },\n        controller(args) {\n            return new FolderController(args.document, {\n                blade: args.blade,\n                expanded: args.params.expanded,\n                props: ValueMap.fromObject({\n                    title: args.params.title,\n                }),\n                viewProps: args.viewProps,\n            });\n        },\n        api(args) {\n            if (!(args.controller instanceof FolderController)) {\n                return null;\n            }\n            return new FolderApi(args.controller, args.pool);\n        },\n    };\n\n    class LabeledValueController extends ValueBladeController {\n        constructor(doc, config) {\n            const viewProps = config.valueController.viewProps;\n            super(Object.assign(Object.assign({}, config), { value: config.valueController.value, view: new LabelView(doc, {\n                    props: config.props,\n                    viewProps: viewProps,\n                }), viewProps: viewProps }));\n            this.props = config.props;\n            this.valueController = config.valueController;\n            this.view.valueElement.appendChild(this.valueController.view.element);\n        }\n    }\n\n    class SeparatorApi extends BladeApi {\n    }\n\n    const className$m = ClassName('spr');\n    class SeparatorView {\n        constructor(doc, config) {\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$m());\n            config.viewProps.bindClassModifiers(this.element);\n            const hrElem = doc.createElement('hr');\n            hrElem.classList.add(className$m('r'));\n            this.element.appendChild(hrElem);\n        }\n    }\n\n    class SeparatorController extends BladeController {\n        constructor(doc, config) {\n            super(Object.assign(Object.assign({}, config), { view: new SeparatorView(doc, {\n                    viewProps: config.viewProps,\n                }) }));\n        }\n    }\n\n    const SeparatorBladePlugin = {\n        id: 'separator',\n        type: 'blade',\n        accept(params) {\n            const p = ParamsParsers;\n            const result = parseParams(params, {\n                view: p.required.constant('separator'),\n            });\n            return result ? { params: result } : null;\n        },\n        controller(args) {\n            return new SeparatorController(args.document, {\n                blade: args.blade,\n                viewProps: args.viewProps,\n            });\n        },\n        api(args) {\n            if (!(args.controller instanceof SeparatorController)) {\n                return null;\n            }\n            return new SeparatorApi(args.controller);\n        },\n    };\n\n    const className$l = ClassName('tbi');\n    class TabItemView {\n        constructor(doc, config) {\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$l());\n            config.viewProps.bindClassModifiers(this.element);\n            bindValueMap(config.props, 'selected', (selected) => {\n                if (selected) {\n                    this.element.classList.add(className$l(undefined, 'sel'));\n                }\n                else {\n                    this.element.classList.remove(className$l(undefined, 'sel'));\n                }\n            });\n            const buttonElem = doc.createElement('button');\n            buttonElem.classList.add(className$l('b'));\n            config.viewProps.bindDisabled(buttonElem);\n            this.element.appendChild(buttonElem);\n            this.buttonElement = buttonElem;\n            const titleElem = doc.createElement('div');\n            titleElem.classList.add(className$l('t'));\n            bindValueToTextContent(config.props.value('title'), titleElem);\n            this.buttonElement.appendChild(titleElem);\n            this.titleElement = titleElem;\n        }\n    }\n\n    class TabItemController {\n        constructor(doc, config) {\n            this.emitter = new Emitter();\n            this.onClick_ = this.onClick_.bind(this);\n            this.props = config.props;\n            this.viewProps = config.viewProps;\n            this.view = new TabItemView(doc, {\n                props: config.props,\n                viewProps: config.viewProps,\n            });\n            this.view.buttonElement.addEventListener('click', this.onClick_);\n        }\n        onClick_() {\n            this.emitter.emit('click', {\n                sender: this,\n            });\n        }\n    }\n\n    class TabPageController {\n        constructor(doc, config) {\n            this.onItemClick_ = this.onItemClick_.bind(this);\n            this.ic_ = new TabItemController(doc, {\n                props: config.itemProps,\n                viewProps: ViewProps.create(),\n            });\n            this.ic_.emitter.on('click', this.onItemClick_);\n            this.cc_ = new RackController(doc, {\n                blade: createBlade(),\n                viewProps: ViewProps.create(),\n            });\n            this.props = config.props;\n            bindValueMap(this.props, 'selected', (selected) => {\n                this.itemController.props.set('selected', selected);\n                this.contentController.viewProps.set('hidden', !selected);\n            });\n        }\n        get itemController() {\n            return this.ic_;\n        }\n        get contentController() {\n            return this.cc_;\n        }\n        onItemClick_() {\n            this.props.set('selected', true);\n        }\n    }\n\n    class TabPageApi {\n        constructor(controller, contentRackApi) {\n            this.controller_ = controller;\n            this.rackApi_ = contentRackApi;\n        }\n        get title() {\n            var _a;\n            return (_a = this.controller_.itemController.props.get('title')) !== null && _a !== void 0 ? _a : '';\n        }\n        set title(title) {\n            this.controller_.itemController.props.set('title', title);\n        }\n        get selected() {\n            return this.controller_.props.get('selected');\n        }\n        set selected(selected) {\n            this.controller_.props.set('selected', selected);\n        }\n        get children() {\n            return this.rackApi_.children;\n        }\n        addButton(params) {\n            return this.rackApi_.addButton(params);\n        }\n        addFolder(params) {\n            return this.rackApi_.addFolder(params);\n        }\n        addSeparator(opt_params) {\n            return this.rackApi_.addSeparator(opt_params);\n        }\n        addTab(params) {\n            return this.rackApi_.addTab(params);\n        }\n        add(api, opt_index) {\n            this.rackApi_.add(api, opt_index);\n        }\n        remove(api) {\n            this.rackApi_.remove(api);\n        }\n        addInput(object, key, opt_params) {\n            return this.rackApi_.addInput(object, key, opt_params);\n        }\n        addMonitor(object, key, opt_params) {\n            return this.rackApi_.addMonitor(object, key, opt_params);\n        }\n        addBlade(params) {\n            return this.rackApi_.addBlade(params);\n        }\n    }\n\n    class TabApi extends RackLikeApi {\n        constructor(controller, pool) {\n            super(controller, new RackApi(controller.rackController, pool));\n            this.onPageAdd_ = this.onPageAdd_.bind(this);\n            this.onPageRemove_ = this.onPageRemove_.bind(this);\n            this.onSelect_ = this.onSelect_.bind(this);\n            this.emitter_ = new Emitter();\n            this.pageApiMap_ = new Map();\n            this.rackApi_.on('change', (ev) => {\n                this.emitter_.emit('change', {\n                    event: ev,\n                });\n            });\n            this.rackApi_.on('update', (ev) => {\n                this.emitter_.emit('update', {\n                    event: ev,\n                });\n            });\n            this.controller_.tab.selectedIndex.emitter.on('change', this.onSelect_);\n            this.controller_.pageSet.emitter.on('add', this.onPageAdd_);\n            this.controller_.pageSet.emitter.on('remove', this.onPageRemove_);\n            this.controller_.pageSet.items.forEach((pc) => {\n                this.setUpPageApi_(pc);\n            });\n        }\n        get pages() {\n            return this.controller_.pageSet.items.map((pc) => {\n                const api = this.pageApiMap_.get(pc);\n                if (!api) {\n                    throw TpError.shouldNeverHappen();\n                }\n                return api;\n            });\n        }\n        addPage(params) {\n            const doc = this.controller_.view.element.ownerDocument;\n            const pc = new TabPageController(doc, {\n                itemProps: ValueMap.fromObject({\n                    selected: false,\n                    title: params.title,\n                }),\n                props: ValueMap.fromObject({\n                    selected: false,\n                }),\n            });\n            this.controller_.add(pc, params.index);\n            const api = this.pageApiMap_.get(pc);\n            if (!api) {\n                throw TpError.shouldNeverHappen();\n            }\n            return api;\n        }\n        removePage(index) {\n            this.controller_.remove(index);\n        }\n        on(eventName, handler) {\n            const bh = handler.bind(this);\n            this.emitter_.on(eventName, (ev) => {\n                bh(ev.event);\n            });\n            return this;\n        }\n        setUpPageApi_(pc) {\n            const rackApi = this.rackApi_['apiSet_'].find((api) => api.controller_ === pc.contentController);\n            if (!rackApi) {\n                throw TpError.shouldNeverHappen();\n            }\n            const api = new TabPageApi(pc, rackApi);\n            this.pageApiMap_.set(pc, api);\n        }\n        onPageAdd_(ev) {\n            this.setUpPageApi_(ev.item);\n        }\n        onPageRemove_(ev) {\n            const api = this.pageApiMap_.get(ev.item);\n            if (!api) {\n                throw TpError.shouldNeverHappen();\n            }\n            this.pageApiMap_.delete(ev.item);\n        }\n        onSelect_(ev) {\n            this.emitter_.emit('select', {\n                event: new TpTabSelectEvent(this, ev.rawValue),\n            });\n        }\n    }\n\n    const INDEX_NOT_SELECTED = -1;\n    class Tab {\n        constructor() {\n            this.onItemSelectedChange_ = this.onItemSelectedChange_.bind(this);\n            this.empty = createValue(true);\n            this.selectedIndex = createValue(INDEX_NOT_SELECTED);\n            this.items_ = [];\n        }\n        add(item, opt_index) {\n            const index = opt_index !== null && opt_index !== void 0 ? opt_index : this.items_.length;\n            this.items_.splice(index, 0, item);\n            item.emitter.on('change', this.onItemSelectedChange_);\n            this.keepSelection_();\n        }\n        remove(item) {\n            const index = this.items_.indexOf(item);\n            if (index < 0) {\n                return;\n            }\n            this.items_.splice(index, 1);\n            item.emitter.off('change', this.onItemSelectedChange_);\n            this.keepSelection_();\n        }\n        keepSelection_() {\n            if (this.items_.length === 0) {\n                this.selectedIndex.rawValue = INDEX_NOT_SELECTED;\n                this.empty.rawValue = true;\n                return;\n            }\n            const firstSelIndex = this.items_.findIndex((s) => s.rawValue);\n            if (firstSelIndex < 0) {\n                this.items_.forEach((s, i) => {\n                    s.rawValue = i === 0;\n                });\n                this.selectedIndex.rawValue = 0;\n            }\n            else {\n                this.items_.forEach((s, i) => {\n                    s.rawValue = i === firstSelIndex;\n                });\n                this.selectedIndex.rawValue = firstSelIndex;\n            }\n            this.empty.rawValue = false;\n        }\n        onItemSelectedChange_(ev) {\n            if (ev.rawValue) {\n                const index = this.items_.findIndex((s) => s === ev.sender);\n                this.items_.forEach((s, i) => {\n                    s.rawValue = i === index;\n                });\n                this.selectedIndex.rawValue = index;\n            }\n            else {\n                this.keepSelection_();\n            }\n        }\n    }\n\n    const className$k = ClassName('tab');\n    class TabView {\n        constructor(doc, config) {\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$k(), bladeContainerClassName());\n            config.viewProps.bindClassModifiers(this.element);\n            bindValue(config.empty, valueToClassName(this.element, className$k(undefined, 'nop')));\n            const titleElem = doc.createElement('div');\n            titleElem.classList.add(className$k('t'));\n            this.element.appendChild(titleElem);\n            this.itemsElement = titleElem;\n            const indentElem = doc.createElement('div');\n            indentElem.classList.add(className$k('i'));\n            this.element.appendChild(indentElem);\n            const contentsElem = config.contentsElement;\n            contentsElem.classList.add(className$k('c'));\n            this.element.appendChild(contentsElem);\n            this.contentsElement = contentsElem;\n        }\n    }\n\n    class TabController extends RackLikeController {\n        constructor(doc, config) {\n            const cr = new RackController(doc, {\n                blade: config.blade,\n                viewProps: config.viewProps,\n            });\n            const tab = new Tab();\n            super({\n                blade: config.blade,\n                rackController: cr,\n                view: new TabView(doc, {\n                    contentsElement: cr.view.element,\n                    empty: tab.empty,\n                    viewProps: config.viewProps,\n                }),\n            });\n            this.onPageAdd_ = this.onPageAdd_.bind(this);\n            this.onPageRemove_ = this.onPageRemove_.bind(this);\n            this.pageSet_ = new NestedOrderedSet(() => null);\n            this.pageSet_.emitter.on('add', this.onPageAdd_);\n            this.pageSet_.emitter.on('remove', this.onPageRemove_);\n            this.tab = tab;\n        }\n        get pageSet() {\n            return this.pageSet_;\n        }\n        add(pc, opt_index) {\n            this.pageSet_.add(pc, opt_index);\n        }\n        remove(index) {\n            this.pageSet_.remove(this.pageSet_.items[index]);\n        }\n        onPageAdd_(ev) {\n            const pc = ev.item;\n            insertElementAt(this.view.itemsElement, pc.itemController.view.element, ev.index);\n            pc.itemController.viewProps.set('parent', this.viewProps);\n            this.rackController.rack.add(pc.contentController, ev.index);\n            this.tab.add(pc.props.value('selected'));\n        }\n        onPageRemove_(ev) {\n            const pc = ev.item;\n            removeElement(pc.itemController.view.element);\n            pc.itemController.viewProps.set('parent', null);\n            this.rackController.rack.remove(pc.contentController);\n            this.tab.remove(pc.props.value('selected'));\n        }\n    }\n\n    const TabBladePlugin = {\n        id: 'tab',\n        type: 'blade',\n        accept(params) {\n            const p = ParamsParsers;\n            const result = parseParams(params, {\n                pages: p.required.array(p.required.object({ title: p.required.string })),\n                view: p.required.constant('tab'),\n            });\n            if (!result || result.pages.length === 0) {\n                return null;\n            }\n            return { params: result };\n        },\n        controller(args) {\n            const c = new TabController(args.document, {\n                blade: args.blade,\n                viewProps: args.viewProps,\n            });\n            args.params.pages.forEach((p) => {\n                const pc = new TabPageController(args.document, {\n                    itemProps: ValueMap.fromObject({\n                        selected: false,\n                        title: p.title,\n                    }),\n                    props: ValueMap.fromObject({\n                        selected: false,\n                    }),\n                });\n                c.add(pc);\n            });\n            return c;\n        },\n        api(args) {\n            if (!(args.controller instanceof TabController)) {\n                return null;\n            }\n            return new TabApi(args.controller, args.pool);\n        },\n    };\n\n    function createBladeController(plugin, args) {\n        const ac = plugin.accept(args.params);\n        if (!ac) {\n            return null;\n        }\n        const disabled = ParamsParsers.optional.boolean(args.params['disabled']).value;\n        const hidden = ParamsParsers.optional.boolean(args.params['hidden']).value;\n        return plugin.controller({\n            blade: createBlade(),\n            document: args.document,\n            params: forceCast(Object.assign(Object.assign({}, ac.params), { disabled: disabled, hidden: hidden })),\n            viewProps: ViewProps.create({\n                disabled: disabled,\n                hidden: hidden,\n            }),\n        });\n    }\n\n    class ManualTicker {\n        constructor() {\n            this.disabled = false;\n            this.emitter = new Emitter();\n        }\n        dispose() { }\n        tick() {\n            if (this.disabled) {\n                return;\n            }\n            this.emitter.emit('tick', {\n                sender: this,\n            });\n        }\n    }\n\n    class IntervalTicker {\n        constructor(doc, interval) {\n            this.disabled_ = false;\n            this.timerId_ = null;\n            this.onTick_ = this.onTick_.bind(this);\n            this.doc_ = doc;\n            this.emitter = new Emitter();\n            this.interval_ = interval;\n            this.setTimer_();\n        }\n        get disabled() {\n            return this.disabled_;\n        }\n        set disabled(inactive) {\n            this.disabled_ = inactive;\n            if (this.disabled_) {\n                this.clearTimer_();\n            }\n            else {\n                this.setTimer_();\n            }\n        }\n        dispose() {\n            this.clearTimer_();\n        }\n        clearTimer_() {\n            if (this.timerId_ === null) {\n                return;\n            }\n            const win = this.doc_.defaultView;\n            if (win) {\n                win.clearInterval(this.timerId_);\n            }\n            this.timerId_ = null;\n        }\n        setTimer_() {\n            this.clearTimer_();\n            if (this.interval_ <= 0) {\n                return;\n            }\n            const win = this.doc_.defaultView;\n            if (win) {\n                this.timerId_ = win.setInterval(this.onTick_, this.interval_);\n            }\n        }\n        onTick_() {\n            if (this.disabled_) {\n                return;\n            }\n            this.emitter.emit('tick', {\n                sender: this,\n            });\n        }\n    }\n\n    class InputBinding {\n        constructor(config) {\n            this.onValueChange_ = this.onValueChange_.bind(this);\n            this.reader = config.reader;\n            this.writer = config.writer;\n            this.emitter = new Emitter();\n            this.value = config.value;\n            this.value.emitter.on('change', this.onValueChange_);\n            this.target = config.target;\n            this.read();\n        }\n        read() {\n            const targetValue = this.target.read();\n            if (targetValue !== undefined) {\n                this.value.rawValue = this.reader(targetValue);\n            }\n        }\n        write_(rawValue) {\n            this.writer(this.target, rawValue);\n        }\n        onValueChange_(ev) {\n            this.write_(ev.rawValue);\n            this.emitter.emit('change', {\n                options: ev.options,\n                rawValue: ev.rawValue,\n                sender: this,\n            });\n        }\n    }\n\n    function fillBuffer(buffer, bufferSize) {\n        while (buffer.length < bufferSize) {\n            buffer.push(undefined);\n        }\n    }\n    function initializeBuffer(bufferSize) {\n        const buffer = [];\n        fillBuffer(buffer, bufferSize);\n        return createValue(buffer);\n    }\n    function createTrimmedBuffer(buffer) {\n        const index = buffer.indexOf(undefined);\n        return forceCast(index < 0 ? buffer : buffer.slice(0, index));\n    }\n    function createPushedBuffer(buffer, newValue) {\n        const newBuffer = [...createTrimmedBuffer(buffer), newValue];\n        if (newBuffer.length > buffer.length) {\n            newBuffer.splice(0, newBuffer.length - buffer.length);\n        }\n        else {\n            fillBuffer(newBuffer, buffer.length);\n        }\n        return newBuffer;\n    }\n\n    class MonitorBinding {\n        constructor(config) {\n            this.onTick_ = this.onTick_.bind(this);\n            this.reader_ = config.reader;\n            this.target = config.target;\n            this.emitter = new Emitter();\n            this.value = config.value;\n            this.ticker = config.ticker;\n            this.ticker.emitter.on('tick', this.onTick_);\n            this.read();\n        }\n        dispose() {\n            this.ticker.dispose();\n        }\n        read() {\n            const targetValue = this.target.read();\n            if (targetValue === undefined) {\n                return;\n            }\n            const buffer = this.value.rawValue;\n            const newValue = this.reader_(targetValue);\n            this.value.rawValue = createPushedBuffer(buffer, newValue);\n            this.emitter.emit('update', {\n                rawValue: newValue,\n                sender: this,\n            });\n        }\n        onTick_(_) {\n            this.read();\n        }\n    }\n\n    class CompositeConstraint {\n        constructor(constraints) {\n            this.constraints = constraints;\n        }\n        constrain(value) {\n            return this.constraints.reduce((result, c) => {\n                return c.constrain(result);\n            }, value);\n        }\n    }\n    function findConstraint(c, constraintClass) {\n        if (c instanceof constraintClass) {\n            return c;\n        }\n        if (c instanceof CompositeConstraint) {\n            const result = c.constraints.reduce((tmpResult, sc) => {\n                if (tmpResult) {\n                    return tmpResult;\n                }\n                return sc instanceof constraintClass ? sc : null;\n            }, null);\n            if (result) {\n                return result;\n            }\n        }\n        return null;\n    }\n\n    class DefiniteRangeConstraint {\n        constructor(config) {\n            this.values = ValueMap.fromObject({\n                max: config.max,\n                min: config.min,\n            });\n        }\n        constrain(value) {\n            const max = this.values.get('max');\n            const min = this.values.get('min');\n            return Math.min(Math.max(value, min), max);\n        }\n    }\n\n    class ListConstraint {\n        constructor(options) {\n            this.values = ValueMap.fromObject({\n                options: options,\n            });\n        }\n        get options() {\n            return this.values.get('options');\n        }\n        constrain(value) {\n            const opts = this.values.get('options');\n            if (opts.length === 0) {\n                return value;\n            }\n            const matched = opts.filter((item) => {\n                return item.value === value;\n            }).length > 0;\n            return matched ? value : opts[0].value;\n        }\n    }\n\n    class RangeConstraint {\n        constructor(config) {\n            this.values = ValueMap.fromObject({\n                max: config.max,\n                min: config.min,\n            });\n        }\n        get maxValue() {\n            return this.values.get('max');\n        }\n        get minValue() {\n            return this.values.get('min');\n        }\n        constrain(value) {\n            const max = this.values.get('max');\n            const min = this.values.get('min');\n            let result = value;\n            if (!isEmpty(min)) {\n                result = Math.max(result, min);\n            }\n            if (!isEmpty(max)) {\n                result = Math.min(result, max);\n            }\n            return result;\n        }\n    }\n\n    class StepConstraint {\n        constructor(step, origin = 0) {\n            this.step = step;\n            this.origin = origin;\n        }\n        constrain(value) {\n            const o = this.origin % this.step;\n            const r = Math.round((value - o) / this.step);\n            return o + r * this.step;\n        }\n    }\n\n    const className$j = ClassName('lst');\n    class ListView {\n        constructor(doc, config) {\n            this.onValueChange_ = this.onValueChange_.bind(this);\n            this.props_ = config.props;\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$j());\n            config.viewProps.bindClassModifiers(this.element);\n            const selectElem = doc.createElement('select');\n            selectElem.classList.add(className$j('s'));\n            config.viewProps.bindDisabled(selectElem);\n            this.element.appendChild(selectElem);\n            this.selectElement = selectElem;\n            const markElem = doc.createElement('div');\n            markElem.classList.add(className$j('m'));\n            markElem.appendChild(createSvgIconElement(doc, 'dropdown'));\n            this.element.appendChild(markElem);\n            config.value.emitter.on('change', this.onValueChange_);\n            this.value_ = config.value;\n            bindValueMap(this.props_, 'options', (opts) => {\n                removeChildElements(this.selectElement);\n                opts.forEach((item) => {\n                    const optionElem = doc.createElement('option');\n                    optionElem.textContent = item.text;\n                    this.selectElement.appendChild(optionElem);\n                });\n                this.update_();\n            });\n        }\n        update_() {\n            const values = this.props_.get('options').map((o) => o.value);\n            this.selectElement.selectedIndex = values.indexOf(this.value_.rawValue);\n        }\n        onValueChange_() {\n            this.update_();\n        }\n    }\n\n    class ListController {\n        constructor(doc, config) {\n            this.onSelectChange_ = this.onSelectChange_.bind(this);\n            this.props = config.props;\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.view = new ListView(doc, {\n                props: this.props,\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            this.view.selectElement.addEventListener('change', this.onSelectChange_);\n        }\n        onSelectChange_(e) {\n            const selectElem = forceCast(e.currentTarget);\n            this.value.rawValue =\n                this.props.get('options')[selectElem.selectedIndex].value;\n        }\n    }\n\n    const className$i = ClassName('pop');\n    class PopupView {\n        constructor(doc, config) {\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$i());\n            config.viewProps.bindClassModifiers(this.element);\n            bindValue(config.shows, valueToClassName(this.element, className$i(undefined, 'v')));\n        }\n    }\n\n    class PopupController {\n        constructor(doc, config) {\n            this.shows = createValue(false);\n            this.viewProps = config.viewProps;\n            this.view = new PopupView(doc, {\n                shows: this.shows,\n                viewProps: this.viewProps,\n            });\n        }\n    }\n\n    const className$h = ClassName('txt');\n    class TextView {\n        constructor(doc, config) {\n            this.onChange_ = this.onChange_.bind(this);\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$h());\n            config.viewProps.bindClassModifiers(this.element);\n            this.props_ = config.props;\n            this.props_.emitter.on('change', this.onChange_);\n            const inputElem = doc.createElement('input');\n            inputElem.classList.add(className$h('i'));\n            inputElem.type = 'text';\n            config.viewProps.bindDisabled(inputElem);\n            this.element.appendChild(inputElem);\n            this.inputElement = inputElem;\n            config.value.emitter.on('change', this.onChange_);\n            this.value_ = config.value;\n            this.refresh();\n        }\n        refresh() {\n            const formatter = this.props_.get('formatter');\n            this.inputElement.value = formatter(this.value_.rawValue);\n        }\n        onChange_() {\n            this.refresh();\n        }\n    }\n\n    class TextController {\n        constructor(doc, config) {\n            this.onInputChange_ = this.onInputChange_.bind(this);\n            this.parser_ = config.parser;\n            this.props = config.props;\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.view = new TextView(doc, {\n                props: config.props,\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            this.view.inputElement.addEventListener('change', this.onInputChange_);\n        }\n        onInputChange_(e) {\n            const inputElem = forceCast(e.currentTarget);\n            const value = inputElem.value;\n            const parsedValue = this.parser_(value);\n            if (!isEmpty(parsedValue)) {\n                this.value.rawValue = parsedValue;\n            }\n            this.view.refresh();\n        }\n    }\n\n    function boolToString(value) {\n        return String(value);\n    }\n    function boolFromUnknown(value) {\n        if (value === 'false') {\n            return false;\n        }\n        return !!value;\n    }\n    function BooleanFormatter(value) {\n        return boolToString(value);\n    }\n\n    class NumberLiteralNode {\n        constructor(text) {\n            this.text = text;\n        }\n        evaluate() {\n            return Number(this.text);\n        }\n        toString() {\n            return this.text;\n        }\n    }\n    const BINARY_OPERATION_MAP = {\n        '**': (v1, v2) => Math.pow(v1, v2),\n        '*': (v1, v2) => v1 * v2,\n        '/': (v1, v2) => v1 / v2,\n        '%': (v1, v2) => v1 % v2,\n        '+': (v1, v2) => v1 + v2,\n        '-': (v1, v2) => v1 - v2,\n        '<<': (v1, v2) => v1 << v2,\n        '>>': (v1, v2) => v1 >> v2,\n        '>>>': (v1, v2) => v1 >>> v2,\n        '&': (v1, v2) => v1 & v2,\n        '^': (v1, v2) => v1 ^ v2,\n        '|': (v1, v2) => v1 | v2,\n    };\n    class BinaryOperationNode {\n        constructor(operator, left, right) {\n            this.left = left;\n            this.operator = operator;\n            this.right = right;\n        }\n        evaluate() {\n            const op = BINARY_OPERATION_MAP[this.operator];\n            if (!op) {\n                throw new Error(`unexpected binary operator: '${this.operator}`);\n            }\n            return op(this.left.evaluate(), this.right.evaluate());\n        }\n        toString() {\n            return [\n                'b(',\n                this.left.toString(),\n                this.operator,\n                this.right.toString(),\n                ')',\n            ].join(' ');\n        }\n    }\n    const UNARY_OPERATION_MAP = {\n        '+': (v) => v,\n        '-': (v) => -v,\n        '~': (v) => ~v,\n    };\n    class UnaryOperationNode {\n        constructor(operator, expr) {\n            this.operator = operator;\n            this.expression = expr;\n        }\n        evaluate() {\n            const op = UNARY_OPERATION_MAP[this.operator];\n            if (!op) {\n                throw new Error(`unexpected unary operator: '${this.operator}`);\n            }\n            return op(this.expression.evaluate());\n        }\n        toString() {\n            return ['u(', this.operator, this.expression.toString(), ')'].join(' ');\n        }\n    }\n\n    function combineReader(parsers) {\n        return (text, cursor) => {\n            for (let i = 0; i < parsers.length; i++) {\n                const result = parsers[i](text, cursor);\n                if (result !== '') {\n                    return result;\n                }\n            }\n            return '';\n        };\n    }\n    function readWhitespace(text, cursor) {\n        var _a;\n        const m = text.substr(cursor).match(/^\\s+/);\n        return (_a = (m && m[0])) !== null && _a !== void 0 ? _a : '';\n    }\n    function readNonZeroDigit(text, cursor) {\n        const ch = text.substr(cursor, 1);\n        return ch.match(/^[1-9]$/) ? ch : '';\n    }\n    function readDecimalDigits(text, cursor) {\n        var _a;\n        const m = text.substr(cursor).match(/^[0-9]+/);\n        return (_a = (m && m[0])) !== null && _a !== void 0 ? _a : '';\n    }\n    function readSignedInteger(text, cursor) {\n        const ds = readDecimalDigits(text, cursor);\n        if (ds !== '') {\n            return ds;\n        }\n        const sign = text.substr(cursor, 1);\n        cursor += 1;\n        if (sign !== '-' && sign !== '+') {\n            return '';\n        }\n        const sds = readDecimalDigits(text, cursor);\n        if (sds === '') {\n            return '';\n        }\n        return sign + sds;\n    }\n    function readExponentPart(text, cursor) {\n        const e = text.substr(cursor, 1);\n        cursor += 1;\n        if (e.toLowerCase() !== 'e') {\n            return '';\n        }\n        const si = readSignedInteger(text, cursor);\n        if (si === '') {\n            return '';\n        }\n        return e + si;\n    }\n    function readDecimalIntegerLiteral(text, cursor) {\n        const ch = text.substr(cursor, 1);\n        if (ch === '0') {\n            return ch;\n        }\n        const nzd = readNonZeroDigit(text, cursor);\n        cursor += nzd.length;\n        if (nzd === '') {\n            return '';\n        }\n        return nzd + readDecimalDigits(text, cursor);\n    }\n    function readDecimalLiteral1(text, cursor) {\n        const dil = readDecimalIntegerLiteral(text, cursor);\n        cursor += dil.length;\n        if (dil === '') {\n            return '';\n        }\n        const dot = text.substr(cursor, 1);\n        cursor += dot.length;\n        if (dot !== '.') {\n            return '';\n        }\n        const dds = readDecimalDigits(text, cursor);\n        cursor += dds.length;\n        return dil + dot + dds + readExponentPart(text, cursor);\n    }\n    function readDecimalLiteral2(text, cursor) {\n        const dot = text.substr(cursor, 1);\n        cursor += dot.length;\n        if (dot !== '.') {\n            return '';\n        }\n        const dds = readDecimalDigits(text, cursor);\n        cursor += dds.length;\n        if (dds === '') {\n            return '';\n        }\n        return dot + dds + readExponentPart(text, cursor);\n    }\n    function readDecimalLiteral3(text, cursor) {\n        const dil = readDecimalIntegerLiteral(text, cursor);\n        cursor += dil.length;\n        if (dil === '') {\n            return '';\n        }\n        return dil + readExponentPart(text, cursor);\n    }\n    const readDecimalLiteral = combineReader([\n        readDecimalLiteral1,\n        readDecimalLiteral2,\n        readDecimalLiteral3,\n    ]);\n    function parseBinaryDigits(text, cursor) {\n        var _a;\n        const m = text.substr(cursor).match(/^[01]+/);\n        return (_a = (m && m[0])) !== null && _a !== void 0 ? _a : '';\n    }\n    function readBinaryIntegerLiteral(text, cursor) {\n        const prefix = text.substr(cursor, 2);\n        cursor += prefix.length;\n        if (prefix.toLowerCase() !== '0b') {\n            return '';\n        }\n        const bds = parseBinaryDigits(text, cursor);\n        if (bds === '') {\n            return '';\n        }\n        return prefix + bds;\n    }\n    function readOctalDigits(text, cursor) {\n        var _a;\n        const m = text.substr(cursor).match(/^[0-7]+/);\n        return (_a = (m && m[0])) !== null && _a !== void 0 ? _a : '';\n    }\n    function readOctalIntegerLiteral(text, cursor) {\n        const prefix = text.substr(cursor, 2);\n        cursor += prefix.length;\n        if (prefix.toLowerCase() !== '0o') {\n            return '';\n        }\n        const ods = readOctalDigits(text, cursor);\n        if (ods === '') {\n            return '';\n        }\n        return prefix + ods;\n    }\n    function readHexDigits(text, cursor) {\n        var _a;\n        const m = text.substr(cursor).match(/^[0-9a-f]+/i);\n        return (_a = (m && m[0])) !== null && _a !== void 0 ? _a : '';\n    }\n    function readHexIntegerLiteral(text, cursor) {\n        const prefix = text.substr(cursor, 2);\n        cursor += prefix.length;\n        if (prefix.toLowerCase() !== '0x') {\n            return '';\n        }\n        const hds = readHexDigits(text, cursor);\n        if (hds === '') {\n            return '';\n        }\n        return prefix + hds;\n    }\n    const readNonDecimalIntegerLiteral = combineReader([\n        readBinaryIntegerLiteral,\n        readOctalIntegerLiteral,\n        readHexIntegerLiteral,\n    ]);\n    const readNumericLiteral = combineReader([\n        readNonDecimalIntegerLiteral,\n        readDecimalLiteral,\n    ]);\n\n    function parseLiteral(text, cursor) {\n        const num = readNumericLiteral(text, cursor);\n        cursor += num.length;\n        if (num === '') {\n            return null;\n        }\n        return {\n            evaluable: new NumberLiteralNode(num),\n            cursor: cursor,\n        };\n    }\n    function parseParenthesizedExpression(text, cursor) {\n        const op = text.substr(cursor, 1);\n        cursor += op.length;\n        if (op !== '(') {\n            return null;\n        }\n        const expr = parseExpression(text, cursor);\n        if (!expr) {\n            return null;\n        }\n        cursor = expr.cursor;\n        cursor += readWhitespace(text, cursor).length;\n        const cl = text.substr(cursor, 1);\n        cursor += cl.length;\n        if (cl !== ')') {\n            return null;\n        }\n        return {\n            evaluable: expr.evaluable,\n            cursor: cursor,\n        };\n    }\n    function parsePrimaryExpression(text, cursor) {\n        var _a;\n        return ((_a = parseLiteral(text, cursor)) !== null && _a !== void 0 ? _a : parseParenthesizedExpression(text, cursor));\n    }\n    function parseUnaryExpression(text, cursor) {\n        const expr = parsePrimaryExpression(text, cursor);\n        if (expr) {\n            return expr;\n        }\n        const op = text.substr(cursor, 1);\n        cursor += op.length;\n        if (op !== '+' && op !== '-' && op !== '~') {\n            return null;\n        }\n        const num = parseUnaryExpression(text, cursor);\n        if (!num) {\n            return null;\n        }\n        cursor = num.cursor;\n        return {\n            cursor: cursor,\n            evaluable: new UnaryOperationNode(op, num.evaluable),\n        };\n    }\n    function readBinaryOperator(ops, text, cursor) {\n        cursor += readWhitespace(text, cursor).length;\n        const op = ops.filter((op) => text.startsWith(op, cursor))[0];\n        if (!op) {\n            return null;\n        }\n        cursor += op.length;\n        cursor += readWhitespace(text, cursor).length;\n        return {\n            cursor: cursor,\n            operator: op,\n        };\n    }\n    function createBinaryOperationExpressionParser(exprParser, ops) {\n        return (text, cursor) => {\n            const firstExpr = exprParser(text, cursor);\n            if (!firstExpr) {\n                return null;\n            }\n            cursor = firstExpr.cursor;\n            let expr = firstExpr.evaluable;\n            for (;;) {\n                const op = readBinaryOperator(ops, text, cursor);\n                if (!op) {\n                    break;\n                }\n                cursor = op.cursor;\n                const nextExpr = exprParser(text, cursor);\n                if (!nextExpr) {\n                    return null;\n                }\n                cursor = nextExpr.cursor;\n                expr = new BinaryOperationNode(op.operator, expr, nextExpr.evaluable);\n            }\n            return expr\n                ? {\n                    cursor: cursor,\n                    evaluable: expr,\n                }\n                : null;\n        };\n    }\n    const parseBinaryOperationExpression = [\n        ['**'],\n        ['*', '/', '%'],\n        ['+', '-'],\n        ['<<', '>>>', '>>'],\n        ['&'],\n        ['^'],\n        ['|'],\n    ].reduce((parser, ops) => {\n        return createBinaryOperationExpressionParser(parser, ops);\n    }, parseUnaryExpression);\n    function parseExpression(text, cursor) {\n        cursor += readWhitespace(text, cursor).length;\n        return parseBinaryOperationExpression(text, cursor);\n    }\n    function parseEcmaNumberExpression(text) {\n        const expr = parseExpression(text, 0);\n        if (!expr) {\n            return null;\n        }\n        const cursor = expr.cursor + readWhitespace(text, expr.cursor).length;\n        if (cursor !== text.length) {\n            return null;\n        }\n        return expr.evaluable;\n    }\n\n    function parseNumber(text) {\n        var _a;\n        const r = parseEcmaNumberExpression(text);\n        return (_a = r === null || r === void 0 ? void 0 : r.evaluate()) !== null && _a !== void 0 ? _a : null;\n    }\n    function numberFromUnknown(value) {\n        if (typeof value === 'number') {\n            return value;\n        }\n        if (typeof value === 'string') {\n            const pv = parseNumber(value);\n            if (!isEmpty(pv)) {\n                return pv;\n            }\n        }\n        return 0;\n    }\n    function numberToString(value) {\n        return String(value);\n    }\n    function createNumberFormatter(digits) {\n        return (value) => {\n            return value.toFixed(Math.max(Math.min(digits, 20), 0));\n        };\n    }\n\n    const innerFormatter = createNumberFormatter(0);\n    function formatPercentage(value) {\n        return innerFormatter(value) + '%';\n    }\n\n    function stringFromUnknown(value) {\n        return String(value);\n    }\n    function formatString(value) {\n        return value;\n    }\n\n    function connectValues({ primary, secondary, forward, backward, }) {\n        let changing = false;\n        function preventFeedback(callback) {\n            if (changing) {\n                return;\n            }\n            changing = true;\n            callback();\n            changing = false;\n        }\n        primary.emitter.on('change', (ev) => {\n            preventFeedback(() => {\n                secondary.setRawValue(forward(primary, secondary), ev.options);\n            });\n        });\n        secondary.emitter.on('change', (ev) => {\n            preventFeedback(() => {\n                primary.setRawValue(backward(primary, secondary), ev.options);\n            });\n            preventFeedback(() => {\n                secondary.setRawValue(forward(primary, secondary), ev.options);\n            });\n        });\n        preventFeedback(() => {\n            secondary.setRawValue(forward(primary, secondary), {\n                forceEmit: false,\n                last: true,\n            });\n        });\n    }\n\n    function getStepForKey(baseStep, keys) {\n        const step = baseStep * (keys.altKey ? 0.1 : 1) * (keys.shiftKey ? 10 : 1);\n        if (keys.upKey) {\n            return +step;\n        }\n        else if (keys.downKey) {\n            return -step;\n        }\n        return 0;\n    }\n    function getVerticalStepKeys(ev) {\n        return {\n            altKey: ev.altKey,\n            downKey: ev.key === 'ArrowDown',\n            shiftKey: ev.shiftKey,\n            upKey: ev.key === 'ArrowUp',\n        };\n    }\n    function getHorizontalStepKeys(ev) {\n        return {\n            altKey: ev.altKey,\n            downKey: ev.key === 'ArrowLeft',\n            shiftKey: ev.shiftKey,\n            upKey: ev.key === 'ArrowRight',\n        };\n    }\n    function isVerticalArrowKey(key) {\n        return key === 'ArrowUp' || key === 'ArrowDown';\n    }\n    function isArrowKey(key) {\n        return isVerticalArrowKey(key) || key === 'ArrowLeft' || key === 'ArrowRight';\n    }\n\n    function computeOffset$1(ev, elem) {\n        var _a, _b;\n        const win = elem.ownerDocument.defaultView;\n        const rect = elem.getBoundingClientRect();\n        return {\n            x: ev.pageX - (((_a = (win && win.scrollX)) !== null && _a !== void 0 ? _a : 0) + rect.left),\n            y: ev.pageY - (((_b = (win && win.scrollY)) !== null && _b !== void 0 ? _b : 0) + rect.top),\n        };\n    }\n    class PointerHandler {\n        constructor(element) {\n            this.lastTouch_ = null;\n            this.onDocumentMouseMove_ = this.onDocumentMouseMove_.bind(this);\n            this.onDocumentMouseUp_ = this.onDocumentMouseUp_.bind(this);\n            this.onMouseDown_ = this.onMouseDown_.bind(this);\n            this.onTouchEnd_ = this.onTouchEnd_.bind(this);\n            this.onTouchMove_ = this.onTouchMove_.bind(this);\n            this.onTouchStart_ = this.onTouchStart_.bind(this);\n            this.elem_ = element;\n            this.emitter = new Emitter();\n            element.addEventListener('touchstart', this.onTouchStart_, {\n                passive: false,\n            });\n            element.addEventListener('touchmove', this.onTouchMove_, {\n                passive: true,\n            });\n            element.addEventListener('touchend', this.onTouchEnd_);\n            element.addEventListener('mousedown', this.onMouseDown_);\n        }\n        computePosition_(offset) {\n            const rect = this.elem_.getBoundingClientRect();\n            return {\n                bounds: {\n                    width: rect.width,\n                    height: rect.height,\n                },\n                point: offset\n                    ? {\n                        x: offset.x,\n                        y: offset.y,\n                    }\n                    : null,\n            };\n        }\n        onMouseDown_(ev) {\n            var _a;\n            ev.preventDefault();\n            (_a = ev.currentTarget) === null || _a === void 0 ? void 0 : _a.focus();\n            const doc = this.elem_.ownerDocument;\n            doc.addEventListener('mousemove', this.onDocumentMouseMove_);\n            doc.addEventListener('mouseup', this.onDocumentMouseUp_);\n            this.emitter.emit('down', {\n                altKey: ev.altKey,\n                data: this.computePosition_(computeOffset$1(ev, this.elem_)),\n                sender: this,\n                shiftKey: ev.shiftKey,\n            });\n        }\n        onDocumentMouseMove_(ev) {\n            this.emitter.emit('move', {\n                altKey: ev.altKey,\n                data: this.computePosition_(computeOffset$1(ev, this.elem_)),\n                sender: this,\n                shiftKey: ev.shiftKey,\n            });\n        }\n        onDocumentMouseUp_(ev) {\n            const doc = this.elem_.ownerDocument;\n            doc.removeEventListener('mousemove', this.onDocumentMouseMove_);\n            doc.removeEventListener('mouseup', this.onDocumentMouseUp_);\n            this.emitter.emit('up', {\n                altKey: ev.altKey,\n                data: this.computePosition_(computeOffset$1(ev, this.elem_)),\n                sender: this,\n                shiftKey: ev.shiftKey,\n            });\n        }\n        onTouchStart_(ev) {\n            ev.preventDefault();\n            const touch = ev.targetTouches.item(0);\n            const rect = this.elem_.getBoundingClientRect();\n            this.emitter.emit('down', {\n                altKey: ev.altKey,\n                data: this.computePosition_(touch\n                    ? {\n                        x: touch.clientX - rect.left,\n                        y: touch.clientY - rect.top,\n                    }\n                    : undefined),\n                sender: this,\n                shiftKey: ev.shiftKey,\n            });\n            this.lastTouch_ = touch;\n        }\n        onTouchMove_(ev) {\n            const touch = ev.targetTouches.item(0);\n            const rect = this.elem_.getBoundingClientRect();\n            this.emitter.emit('move', {\n                altKey: ev.altKey,\n                data: this.computePosition_(touch\n                    ? {\n                        x: touch.clientX - rect.left,\n                        y: touch.clientY - rect.top,\n                    }\n                    : undefined),\n                sender: this,\n                shiftKey: ev.shiftKey,\n            });\n            this.lastTouch_ = touch;\n        }\n        onTouchEnd_(ev) {\n            var _a;\n            const touch = (_a = ev.targetTouches.item(0)) !== null && _a !== void 0 ? _a : this.lastTouch_;\n            const rect = this.elem_.getBoundingClientRect();\n            this.emitter.emit('up', {\n                altKey: ev.altKey,\n                data: this.computePosition_(touch\n                    ? {\n                        x: touch.clientX - rect.left,\n                        y: touch.clientY - rect.top,\n                    }\n                    : undefined),\n                sender: this,\n                shiftKey: ev.shiftKey,\n            });\n        }\n    }\n\n    function mapRange(value, start1, end1, start2, end2) {\n        const p = (value - start1) / (end1 - start1);\n        return start2 + p * (end2 - start2);\n    }\n    function getDecimalDigits(value) {\n        const text = String(value.toFixed(10));\n        const frac = text.split('.')[1];\n        return frac.replace(/0+$/, '').length;\n    }\n    function constrainRange(value, min, max) {\n        return Math.min(Math.max(value, min), max);\n    }\n    function loopRange(value, max) {\n        return ((value % max) + max) % max;\n    }\n\n    const className$g = ClassName('txt');\n    class NumberTextView {\n        constructor(doc, config) {\n            this.onChange_ = this.onChange_.bind(this);\n            this.props_ = config.props;\n            this.props_.emitter.on('change', this.onChange_);\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$g(), className$g(undefined, 'num'));\n            if (config.arrayPosition) {\n                this.element.classList.add(className$g(undefined, config.arrayPosition));\n            }\n            config.viewProps.bindClassModifiers(this.element);\n            const inputElem = doc.createElement('input');\n            inputElem.classList.add(className$g('i'));\n            inputElem.type = 'text';\n            config.viewProps.bindDisabled(inputElem);\n            this.element.appendChild(inputElem);\n            this.inputElement = inputElem;\n            this.onDraggingChange_ = this.onDraggingChange_.bind(this);\n            this.dragging_ = config.dragging;\n            this.dragging_.emitter.on('change', this.onDraggingChange_);\n            this.element.classList.add(className$g());\n            this.inputElement.classList.add(className$g('i'));\n            const knobElem = doc.createElement('div');\n            knobElem.classList.add(className$g('k'));\n            this.element.appendChild(knobElem);\n            this.knobElement = knobElem;\n            const guideElem = doc.createElementNS(SVG_NS, 'svg');\n            guideElem.classList.add(className$g('g'));\n            this.knobElement.appendChild(guideElem);\n            const bodyElem = doc.createElementNS(SVG_NS, 'path');\n            bodyElem.classList.add(className$g('gb'));\n            guideElem.appendChild(bodyElem);\n            this.guideBodyElem_ = bodyElem;\n            const headElem = doc.createElementNS(SVG_NS, 'path');\n            headElem.classList.add(className$g('gh'));\n            guideElem.appendChild(headElem);\n            this.guideHeadElem_ = headElem;\n            const tooltipElem = doc.createElement('div');\n            tooltipElem.classList.add(ClassName('tt')());\n            this.knobElement.appendChild(tooltipElem);\n            this.tooltipElem_ = tooltipElem;\n            config.value.emitter.on('change', this.onChange_);\n            this.value = config.value;\n            this.refresh();\n        }\n        onDraggingChange_(ev) {\n            if (ev.rawValue === null) {\n                this.element.classList.remove(className$g(undefined, 'drg'));\n                return;\n            }\n            this.element.classList.add(className$g(undefined, 'drg'));\n            const x = ev.rawValue / this.props_.get('draggingScale');\n            const aox = x + (x > 0 ? -1 : x < 0 ? +1 : 0);\n            const adx = constrainRange(-aox, -4, +4);\n            this.guideHeadElem_.setAttributeNS(null, 'd', [`M ${aox + adx},0 L${aox},4 L${aox + adx},8`, `M ${x},-1 L${x},9`].join(' '));\n            this.guideBodyElem_.setAttributeNS(null, 'd', `M 0,4 L${x},4`);\n            const formatter = this.props_.get('formatter');\n            this.tooltipElem_.textContent = formatter(this.value.rawValue);\n            this.tooltipElem_.style.left = `${x}px`;\n        }\n        refresh() {\n            const formatter = this.props_.get('formatter');\n            this.inputElement.value = formatter(this.value.rawValue);\n        }\n        onChange_() {\n            this.refresh();\n        }\n    }\n\n    class NumberTextController {\n        constructor(doc, config) {\n            var _a;\n            this.originRawValue_ = 0;\n            this.onInputChange_ = this.onInputChange_.bind(this);\n            this.onInputKeyDown_ = this.onInputKeyDown_.bind(this);\n            this.onInputKeyUp_ = this.onInputKeyUp_.bind(this);\n            this.onPointerDown_ = this.onPointerDown_.bind(this);\n            this.onPointerMove_ = this.onPointerMove_.bind(this);\n            this.onPointerUp_ = this.onPointerUp_.bind(this);\n            this.baseStep_ = config.baseStep;\n            this.parser_ = config.parser;\n            this.props = config.props;\n            this.sliderProps_ = (_a = config.sliderProps) !== null && _a !== void 0 ? _a : null;\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.dragging_ = createValue(null);\n            this.view = new NumberTextView(doc, {\n                arrayPosition: config.arrayPosition,\n                dragging: this.dragging_,\n                props: this.props,\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            this.view.inputElement.addEventListener('change', this.onInputChange_);\n            this.view.inputElement.addEventListener('keydown', this.onInputKeyDown_);\n            this.view.inputElement.addEventListener('keyup', this.onInputKeyUp_);\n            const ph = new PointerHandler(this.view.knobElement);\n            ph.emitter.on('down', this.onPointerDown_);\n            ph.emitter.on('move', this.onPointerMove_);\n            ph.emitter.on('up', this.onPointerUp_);\n        }\n        constrainValue_(value) {\n            var _a, _b;\n            const min = (_a = this.sliderProps_) === null || _a === void 0 ? void 0 : _a.get('minValue');\n            const max = (_b = this.sliderProps_) === null || _b === void 0 ? void 0 : _b.get('maxValue');\n            let v = value;\n            if (min !== undefined) {\n                v = Math.max(v, min);\n            }\n            if (max !== undefined) {\n                v = Math.min(v, max);\n            }\n            return v;\n        }\n        onInputChange_(e) {\n            const inputElem = forceCast(e.currentTarget);\n            const value = inputElem.value;\n            const parsedValue = this.parser_(value);\n            if (!isEmpty(parsedValue)) {\n                this.value.rawValue = this.constrainValue_(parsedValue);\n            }\n            this.view.refresh();\n        }\n        onInputKeyDown_(ev) {\n            const step = getStepForKey(this.baseStep_, getVerticalStepKeys(ev));\n            if (step === 0) {\n                return;\n            }\n            this.value.setRawValue(this.constrainValue_(this.value.rawValue + step), {\n                forceEmit: false,\n                last: false,\n            });\n        }\n        onInputKeyUp_(ev) {\n            const step = getStepForKey(this.baseStep_, getVerticalStepKeys(ev));\n            if (step === 0) {\n                return;\n            }\n            this.value.setRawValue(this.value.rawValue, {\n                forceEmit: true,\n                last: true,\n            });\n        }\n        onPointerDown_() {\n            this.originRawValue_ = this.value.rawValue;\n            this.dragging_.rawValue = 0;\n        }\n        computeDraggingValue_(data) {\n            if (!data.point) {\n                return null;\n            }\n            const dx = data.point.x - data.bounds.width / 2;\n            return this.constrainValue_(this.originRawValue_ + dx * this.props.get('draggingScale'));\n        }\n        onPointerMove_(ev) {\n            const v = this.computeDraggingValue_(ev.data);\n            if (v === null) {\n                return;\n            }\n            this.value.setRawValue(v, {\n                forceEmit: false,\n                last: false,\n            });\n            this.dragging_.rawValue = this.value.rawValue - this.originRawValue_;\n        }\n        onPointerUp_(ev) {\n            const v = this.computeDraggingValue_(ev.data);\n            if (v === null) {\n                return;\n            }\n            this.value.setRawValue(v, {\n                forceEmit: true,\n                last: true,\n            });\n            this.dragging_.rawValue = null;\n        }\n    }\n\n    const className$f = ClassName('sld');\n    class SliderView {\n        constructor(doc, config) {\n            this.onChange_ = this.onChange_.bind(this);\n            this.props_ = config.props;\n            this.props_.emitter.on('change', this.onChange_);\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$f());\n            config.viewProps.bindClassModifiers(this.element);\n            const trackElem = doc.createElement('div');\n            trackElem.classList.add(className$f('t'));\n            config.viewProps.bindTabIndex(trackElem);\n            this.element.appendChild(trackElem);\n            this.trackElement = trackElem;\n            const knobElem = doc.createElement('div');\n            knobElem.classList.add(className$f('k'));\n            this.trackElement.appendChild(knobElem);\n            this.knobElement = knobElem;\n            config.value.emitter.on('change', this.onChange_);\n            this.value = config.value;\n            this.update_();\n        }\n        update_() {\n            const p = constrainRange(mapRange(this.value.rawValue, this.props_.get('minValue'), this.props_.get('maxValue'), 0, 100), 0, 100);\n            this.knobElement.style.width = `${p}%`;\n        }\n        onChange_() {\n            this.update_();\n        }\n    }\n\n    class SliderController {\n        constructor(doc, config) {\n            this.onKeyDown_ = this.onKeyDown_.bind(this);\n            this.onKeyUp_ = this.onKeyUp_.bind(this);\n            this.onPointerDownOrMove_ = this.onPointerDownOrMove_.bind(this);\n            this.onPointerUp_ = this.onPointerUp_.bind(this);\n            this.baseStep_ = config.baseStep;\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.props = config.props;\n            this.view = new SliderView(doc, {\n                props: this.props,\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            this.ptHandler_ = new PointerHandler(this.view.trackElement);\n            this.ptHandler_.emitter.on('down', this.onPointerDownOrMove_);\n            this.ptHandler_.emitter.on('move', this.onPointerDownOrMove_);\n            this.ptHandler_.emitter.on('up', this.onPointerUp_);\n            this.view.trackElement.addEventListener('keydown', this.onKeyDown_);\n            this.view.trackElement.addEventListener('keyup', this.onKeyUp_);\n        }\n        handlePointerEvent_(d, opts) {\n            if (!d.point) {\n                return;\n            }\n            this.value.setRawValue(mapRange(constrainRange(d.point.x, 0, d.bounds.width), 0, d.bounds.width, this.props.get('minValue'), this.props.get('maxValue')), opts);\n        }\n        onPointerDownOrMove_(ev) {\n            this.handlePointerEvent_(ev.data, {\n                forceEmit: false,\n                last: false,\n            });\n        }\n        onPointerUp_(ev) {\n            this.handlePointerEvent_(ev.data, {\n                forceEmit: true,\n                last: true,\n            });\n        }\n        onKeyDown_(ev) {\n            const step = getStepForKey(this.baseStep_, getHorizontalStepKeys(ev));\n            if (step === 0) {\n                return;\n            }\n            this.value.setRawValue(this.value.rawValue + step, {\n                forceEmit: false,\n                last: false,\n            });\n        }\n        onKeyUp_(ev) {\n            const step = getStepForKey(this.baseStep_, getHorizontalStepKeys(ev));\n            if (step === 0) {\n                return;\n            }\n            this.value.setRawValue(this.value.rawValue, {\n                forceEmit: true,\n                last: true,\n            });\n        }\n    }\n\n    const className$e = ClassName('sldtxt');\n    class SliderTextView {\n        constructor(doc, config) {\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$e());\n            const sliderElem = doc.createElement('div');\n            sliderElem.classList.add(className$e('s'));\n            this.sliderView_ = config.sliderView;\n            sliderElem.appendChild(this.sliderView_.element);\n            this.element.appendChild(sliderElem);\n            const textElem = doc.createElement('div');\n            textElem.classList.add(className$e('t'));\n            this.textView_ = config.textView;\n            textElem.appendChild(this.textView_.element);\n            this.element.appendChild(textElem);\n        }\n    }\n\n    class SliderTextController {\n        constructor(doc, config) {\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.sliderC_ = new SliderController(doc, {\n                baseStep: config.baseStep,\n                props: config.sliderProps,\n                value: config.value,\n                viewProps: this.viewProps,\n            });\n            this.textC_ = new NumberTextController(doc, {\n                baseStep: config.baseStep,\n                parser: config.parser,\n                props: config.textProps,\n                sliderProps: config.sliderProps,\n                value: config.value,\n                viewProps: config.viewProps,\n            });\n            this.view = new SliderTextView(doc, {\n                sliderView: this.sliderC_.view,\n                textView: this.textC_.view,\n            });\n        }\n        get sliderController() {\n            return this.sliderC_;\n        }\n        get textController() {\n            return this.textC_;\n        }\n    }\n\n    function writePrimitive(target, value) {\n        target.write(value);\n    }\n\n    function parseListOptions(value) {\n        const p = ParamsParsers;\n        if (Array.isArray(value)) {\n            return p.required.array(p.required.object({\n                text: p.required.string,\n                value: p.required.raw,\n            }))(value).value;\n        }\n        if (typeof value === 'object') {\n            return p.required.raw(value)\n                .value;\n        }\n        return undefined;\n    }\n    function parsePickerLayout(value) {\n        if (value === 'inline' || value === 'popup') {\n            return value;\n        }\n        return undefined;\n    }\n    function parsePointDimensionParams(value) {\n        const p = ParamsParsers;\n        return p.required.object({\n            max: p.optional.number,\n            min: p.optional.number,\n            step: p.optional.number,\n        })(value).value;\n    }\n    function normalizeListOptions(options) {\n        if (Array.isArray(options)) {\n            return options;\n        }\n        const items = [];\n        Object.keys(options).forEach((text) => {\n            items.push({ text: text, value: options[text] });\n        });\n        return items;\n    }\n    function createListConstraint(options) {\n        return !isEmpty(options)\n            ? new ListConstraint(normalizeListOptions(forceCast(options)))\n            : null;\n    }\n    function findStep(constraint) {\n        const c = constraint ? findConstraint(constraint, StepConstraint) : null;\n        if (!c) {\n            return null;\n        }\n        return c.step;\n    }\n    function getSuitableDecimalDigits(constraint, rawValue) {\n        const sc = constraint && findConstraint(constraint, StepConstraint);\n        if (sc) {\n            return getDecimalDigits(sc.step);\n        }\n        return Math.max(getDecimalDigits(rawValue), 2);\n    }\n    function getBaseStep(constraint) {\n        const step = findStep(constraint);\n        return step !== null && step !== void 0 ? step : 1;\n    }\n    function getSuitableDraggingScale(constraint, rawValue) {\n        var _a;\n        const sc = constraint && findConstraint(constraint, StepConstraint);\n        const base = Math.abs((_a = sc === null || sc === void 0 ? void 0 : sc.step) !== null && _a !== void 0 ? _a : rawValue);\n        return base === 0 ? 0.1 : Math.pow(10, Math.floor(Math.log10(base)) - 1);\n    }\n\n    const className$d = ClassName('ckb');\n    class CheckboxView {\n        constructor(doc, config) {\n            this.onValueChange_ = this.onValueChange_.bind(this);\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$d());\n            config.viewProps.bindClassModifiers(this.element);\n            const labelElem = doc.createElement('label');\n            labelElem.classList.add(className$d('l'));\n            this.element.appendChild(labelElem);\n            const inputElem = doc.createElement('input');\n            inputElem.classList.add(className$d('i'));\n            inputElem.type = 'checkbox';\n            labelElem.appendChild(inputElem);\n            this.inputElement = inputElem;\n            config.viewProps.bindDisabled(this.inputElement);\n            const wrapperElem = doc.createElement('div');\n            wrapperElem.classList.add(className$d('w'));\n            labelElem.appendChild(wrapperElem);\n            const markElem = createSvgIconElement(doc, 'check');\n            wrapperElem.appendChild(markElem);\n            config.value.emitter.on('change', this.onValueChange_);\n            this.value = config.value;\n            this.update_();\n        }\n        update_() {\n            this.inputElement.checked = this.value.rawValue;\n        }\n        onValueChange_() {\n            this.update_();\n        }\n    }\n\n    class CheckboxController {\n        constructor(doc, config) {\n            this.onInputChange_ = this.onInputChange_.bind(this);\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.view = new CheckboxView(doc, {\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            this.view.inputElement.addEventListener('change', this.onInputChange_);\n        }\n        onInputChange_(e) {\n            const inputElem = forceCast(e.currentTarget);\n            this.value.rawValue = inputElem.checked;\n        }\n    }\n\n    function createConstraint$6(params) {\n        const constraints = [];\n        const lc = createListConstraint(params.options);\n        if (lc) {\n            constraints.push(lc);\n        }\n        return new CompositeConstraint(constraints);\n    }\n    const BooleanInputPlugin = {\n        id: 'input-bool',\n        type: 'input',\n        accept: (value, params) => {\n            if (typeof value !== 'boolean') {\n                return null;\n            }\n            const p = ParamsParsers;\n            const result = parseParams(params, {\n                options: p.optional.custom(parseListOptions),\n            });\n            return result\n                ? {\n                    initialValue: value,\n                    params: result,\n                }\n                : null;\n        },\n        binding: {\n            reader: (_args) => boolFromUnknown,\n            constraint: (args) => createConstraint$6(args.params),\n            writer: (_args) => writePrimitive,\n        },\n        controller: (args) => {\n            const doc = args.document;\n            const value = args.value;\n            const c = args.constraint;\n            const lc = c && findConstraint(c, ListConstraint);\n            if (lc) {\n                return new ListController(doc, {\n                    props: new ValueMap({\n                        options: lc.values.value('options'),\n                    }),\n                    value: value,\n                    viewProps: args.viewProps,\n                });\n            }\n            return new CheckboxController(doc, {\n                value: value,\n                viewProps: args.viewProps,\n            });\n        },\n    };\n\n    const className$c = ClassName('col');\n    class ColorView {\n        constructor(doc, config) {\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$c());\n            config.foldable.bindExpandedClass(this.element, className$c(undefined, 'expanded'));\n            bindValueMap(config.foldable, 'completed', valueToClassName(this.element, className$c(undefined, 'cpl')));\n            const headElem = doc.createElement('div');\n            headElem.classList.add(className$c('h'));\n            this.element.appendChild(headElem);\n            const swatchElem = doc.createElement('div');\n            swatchElem.classList.add(className$c('s'));\n            headElem.appendChild(swatchElem);\n            this.swatchElement = swatchElem;\n            const textElem = doc.createElement('div');\n            textElem.classList.add(className$c('t'));\n            headElem.appendChild(textElem);\n            this.textElement = textElem;\n            if (config.pickerLayout === 'inline') {\n                const pickerElem = doc.createElement('div');\n                pickerElem.classList.add(className$c('p'));\n                this.element.appendChild(pickerElem);\n                this.pickerElement = pickerElem;\n            }\n            else {\n                this.pickerElement = null;\n            }\n        }\n    }\n\n    function rgbToHslInt(r, g, b) {\n        const rp = constrainRange(r / 255, 0, 1);\n        const gp = constrainRange(g / 255, 0, 1);\n        const bp = constrainRange(b / 255, 0, 1);\n        const cmax = Math.max(rp, gp, bp);\n        const cmin = Math.min(rp, gp, bp);\n        const c = cmax - cmin;\n        let h = 0;\n        let s = 0;\n        const l = (cmin + cmax) / 2;\n        if (c !== 0) {\n            s = c / (1 - Math.abs(cmax + cmin - 1));\n            if (rp === cmax) {\n                h = (gp - bp) / c;\n            }\n            else if (gp === cmax) {\n                h = 2 + (bp - rp) / c;\n            }\n            else {\n                h = 4 + (rp - gp) / c;\n            }\n            h = h / 6 + (h < 0 ? 1 : 0);\n        }\n        return [h * 360, s * 100, l * 100];\n    }\n    function hslToRgbInt(h, s, l) {\n        const hp = ((h % 360) + 360) % 360;\n        const sp = constrainRange(s / 100, 0, 1);\n        const lp = constrainRange(l / 100, 0, 1);\n        const c = (1 - Math.abs(2 * lp - 1)) * sp;\n        const x = c * (1 - Math.abs(((hp / 60) % 2) - 1));\n        const m = lp - c / 2;\n        let rp, gp, bp;\n        if (hp >= 0 && hp < 60) {\n            [rp, gp, bp] = [c, x, 0];\n        }\n        else if (hp >= 60 && hp < 120) {\n            [rp, gp, bp] = [x, c, 0];\n        }\n        else if (hp >= 120 && hp < 180) {\n            [rp, gp, bp] = [0, c, x];\n        }\n        else if (hp >= 180 && hp < 240) {\n            [rp, gp, bp] = [0, x, c];\n        }\n        else if (hp >= 240 && hp < 300) {\n            [rp, gp, bp] = [x, 0, c];\n        }\n        else {\n            [rp, gp, bp] = [c, 0, x];\n        }\n        return [(rp + m) * 255, (gp + m) * 255, (bp + m) * 255];\n    }\n    function rgbToHsvInt(r, g, b) {\n        const rp = constrainRange(r / 255, 0, 1);\n        const gp = constrainRange(g / 255, 0, 1);\n        const bp = constrainRange(b / 255, 0, 1);\n        const cmax = Math.max(rp, gp, bp);\n        const cmin = Math.min(rp, gp, bp);\n        const d = cmax - cmin;\n        let h;\n        if (d === 0) {\n            h = 0;\n        }\n        else if (cmax === rp) {\n            h = 60 * (((((gp - bp) / d) % 6) + 6) % 6);\n        }\n        else if (cmax === gp) {\n            h = 60 * ((bp - rp) / d + 2);\n        }\n        else {\n            h = 60 * ((rp - gp) / d + 4);\n        }\n        const s = cmax === 0 ? 0 : d / cmax;\n        const v = cmax;\n        return [h, s * 100, v * 100];\n    }\n    function hsvToRgbInt(h, s, v) {\n        const hp = loopRange(h, 360);\n        const sp = constrainRange(s / 100, 0, 1);\n        const vp = constrainRange(v / 100, 0, 1);\n        const c = vp * sp;\n        const x = c * (1 - Math.abs(((hp / 60) % 2) - 1));\n        const m = vp - c;\n        let rp, gp, bp;\n        if (hp >= 0 && hp < 60) {\n            [rp, gp, bp] = [c, x, 0];\n        }\n        else if (hp >= 60 && hp < 120) {\n            [rp, gp, bp] = [x, c, 0];\n        }\n        else if (hp >= 120 && hp < 180) {\n            [rp, gp, bp] = [0, c, x];\n        }\n        else if (hp >= 180 && hp < 240) {\n            [rp, gp, bp] = [0, x, c];\n        }\n        else if (hp >= 240 && hp < 300) {\n            [rp, gp, bp] = [x, 0, c];\n        }\n        else {\n            [rp, gp, bp] = [c, 0, x];\n        }\n        return [(rp + m) * 255, (gp + m) * 255, (bp + m) * 255];\n    }\n    function hslToHsvInt(h, s, l) {\n        const sd = l + (s * (100 - Math.abs(2 * l - 100))) / (2 * 100);\n        return [\n            h,\n            sd !== 0 ? (s * (100 - Math.abs(2 * l - 100))) / sd : 0,\n            l + (s * (100 - Math.abs(2 * l - 100))) / (2 * 100),\n        ];\n    }\n    function hsvToHslInt(h, s, v) {\n        const sd = 100 - Math.abs((v * (200 - s)) / 100 - 100);\n        return [h, sd !== 0 ? (s * v) / sd : 0, (v * (200 - s)) / (2 * 100)];\n    }\n    function removeAlphaComponent(comps) {\n        return [comps[0], comps[1], comps[2]];\n    }\n    function appendAlphaComponent(comps, alpha) {\n        return [comps[0], comps[1], comps[2], alpha];\n    }\n    const MODE_CONVERTER_MAP = {\n        hsl: {\n            hsl: (h, s, l) => [h, s, l],\n            hsv: hslToHsvInt,\n            rgb: hslToRgbInt,\n        },\n        hsv: {\n            hsl: hsvToHslInt,\n            hsv: (h, s, v) => [h, s, v],\n            rgb: hsvToRgbInt,\n        },\n        rgb: {\n            hsl: rgbToHslInt,\n            hsv: rgbToHsvInt,\n            rgb: (r, g, b) => [r, g, b],\n        },\n    };\n    function getColorMaxComponents(mode, type) {\n        return [\n            type === 'float' ? 1 : mode === 'rgb' ? 255 : 360,\n            type === 'float' ? 1 : mode === 'rgb' ? 255 : 100,\n            type === 'float' ? 1 : mode === 'rgb' ? 255 : 100,\n        ];\n    }\n    function loopHueRange(hue, max) {\n        return hue === max ? max : loopRange(hue, max);\n    }\n    function constrainColorComponents(components, mode, type) {\n        var _a;\n        const ms = getColorMaxComponents(mode, type);\n        return [\n            mode === 'rgb'\n                ? constrainRange(components[0], 0, ms[0])\n                : loopHueRange(components[0], ms[0]),\n            constrainRange(components[1], 0, ms[1]),\n            constrainRange(components[2], 0, ms[2]),\n            constrainRange((_a = components[3]) !== null && _a !== void 0 ? _a : 1, 0, 1),\n        ];\n    }\n    function convertColorType(comps, mode, from, to) {\n        const fms = getColorMaxComponents(mode, from);\n        const tms = getColorMaxComponents(mode, to);\n        return comps.map((c, index) => (c / fms[index]) * tms[index]);\n    }\n    function convertColor(components, from, to) {\n        const intComps = convertColorType(components, from.mode, from.type, 'int');\n        const result = MODE_CONVERTER_MAP[from.mode][to.mode](...intComps);\n        return convertColorType(result, to.mode, 'int', to.type);\n    }\n\n    function isRgbColorComponent(obj, key) {\n        if (typeof obj !== 'object' || isEmpty(obj)) {\n            return false;\n        }\n        return key in obj && typeof obj[key] === 'number';\n    }\n    class Color {\n        static black(type = 'int') {\n            return new Color([0, 0, 0], 'rgb', type);\n        }\n        static fromObject(obj, type = 'int') {\n            const comps = 'a' in obj ? [obj.r, obj.g, obj.b, obj.a] : [obj.r, obj.g, obj.b];\n            return new Color(comps, 'rgb', type);\n        }\n        static toRgbaObject(color, type = 'int') {\n            return color.toRgbaObject(type);\n        }\n        static isRgbColorObject(obj) {\n            return (isRgbColorComponent(obj, 'r') &&\n                isRgbColorComponent(obj, 'g') &&\n                isRgbColorComponent(obj, 'b'));\n        }\n        static isRgbaColorObject(obj) {\n            return this.isRgbColorObject(obj) && isRgbColorComponent(obj, 'a');\n        }\n        static isColorObject(obj) {\n            return this.isRgbColorObject(obj);\n        }\n        static equals(v1, v2) {\n            if (v1.mode !== v2.mode) {\n                return false;\n            }\n            const comps1 = v1.comps_;\n            const comps2 = v2.comps_;\n            for (let i = 0; i < comps1.length; i++) {\n                if (comps1[i] !== comps2[i]) {\n                    return false;\n                }\n            }\n            return true;\n        }\n        constructor(comps, mode, type = 'int') {\n            this.mode = mode;\n            this.type = type;\n            this.comps_ = constrainColorComponents(comps, mode, type);\n        }\n        getComponents(opt_mode, type = 'int') {\n            return appendAlphaComponent(convertColor(removeAlphaComponent(this.comps_), { mode: this.mode, type: this.type }, { mode: opt_mode !== null && opt_mode !== void 0 ? opt_mode : this.mode, type }), this.comps_[3]);\n        }\n        toRgbaObject(type = 'int') {\n            const rgbComps = this.getComponents('rgb', type);\n            return {\n                r: rgbComps[0],\n                g: rgbComps[1],\n                b: rgbComps[2],\n                a: rgbComps[3],\n            };\n        }\n    }\n\n    const className$b = ClassName('colp');\n    class ColorPickerView {\n        constructor(doc, config) {\n            this.alphaViews_ = null;\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$b());\n            config.viewProps.bindClassModifiers(this.element);\n            const hsvElem = doc.createElement('div');\n            hsvElem.classList.add(className$b('hsv'));\n            const svElem = doc.createElement('div');\n            svElem.classList.add(className$b('sv'));\n            this.svPaletteView_ = config.svPaletteView;\n            svElem.appendChild(this.svPaletteView_.element);\n            hsvElem.appendChild(svElem);\n            const hElem = doc.createElement('div');\n            hElem.classList.add(className$b('h'));\n            this.hPaletteView_ = config.hPaletteView;\n            hElem.appendChild(this.hPaletteView_.element);\n            hsvElem.appendChild(hElem);\n            this.element.appendChild(hsvElem);\n            const rgbElem = doc.createElement('div');\n            rgbElem.classList.add(className$b('rgb'));\n            this.textView_ = config.textView;\n            rgbElem.appendChild(this.textView_.element);\n            this.element.appendChild(rgbElem);\n            if (config.alphaViews) {\n                this.alphaViews_ = {\n                    palette: config.alphaViews.palette,\n                    text: config.alphaViews.text,\n                };\n                const aElem = doc.createElement('div');\n                aElem.classList.add(className$b('a'));\n                const apElem = doc.createElement('div');\n                apElem.classList.add(className$b('ap'));\n                apElem.appendChild(this.alphaViews_.palette.element);\n                aElem.appendChild(apElem);\n                const atElem = doc.createElement('div');\n                atElem.classList.add(className$b('at'));\n                atElem.appendChild(this.alphaViews_.text.element);\n                aElem.appendChild(atElem);\n                this.element.appendChild(aElem);\n            }\n        }\n        get allFocusableElements() {\n            const elems = [\n                this.svPaletteView_.element,\n                this.hPaletteView_.element,\n                this.textView_.modeSelectElement,\n                ...this.textView_.textViews.map((v) => v.inputElement),\n            ];\n            if (this.alphaViews_) {\n                elems.push(this.alphaViews_.palette.element, this.alphaViews_.text.inputElement);\n            }\n            return elems;\n        }\n    }\n\n    function parseColorType(value) {\n        return value === 'int' ? 'int' : value === 'float' ? 'float' : undefined;\n    }\n    function parseColorInputParams(params) {\n        const p = ParamsParsers;\n        return parseParams(params, {\n            alpha: p.optional.boolean,\n            color: p.optional.object({\n                alpha: p.optional.boolean,\n                type: p.optional.custom(parseColorType),\n            }),\n            expanded: p.optional.boolean,\n            picker: p.optional.custom(parsePickerLayout),\n        });\n    }\n    function getBaseStepForColor(forAlpha) {\n        return forAlpha ? 0.1 : 1;\n    }\n    function extractColorType(params) {\n        var _a;\n        return (_a = params.color) === null || _a === void 0 ? void 0 : _a.type;\n    }\n\n    function equalsStringColorFormat(f1, f2) {\n        return (f1.alpha === f2.alpha &&\n            f1.mode === f2.mode &&\n            f1.notation === f2.notation &&\n            f1.type === f2.type);\n    }\n    function parseCssNumberOrPercentage(text, maxValue) {\n        const m = text.match(/^(.+)%$/);\n        if (!m) {\n            return Math.min(parseFloat(text), maxValue);\n        }\n        return Math.min(parseFloat(m[1]) * 0.01 * maxValue, maxValue);\n    }\n    const ANGLE_TO_DEG_MAP = {\n        deg: (angle) => angle,\n        grad: (angle) => (angle * 360) / 400,\n        rad: (angle) => (angle * 360) / (2 * Math.PI),\n        turn: (angle) => angle * 360,\n    };\n    function parseCssNumberOrAngle(text) {\n        const m = text.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);\n        if (!m) {\n            return parseFloat(text);\n        }\n        const angle = parseFloat(m[1]);\n        const unit = m[2];\n        return ANGLE_TO_DEG_MAP[unit](angle);\n    }\n    function parseFunctionalRgbColorComponents(text) {\n        const m = text.match(/^rgb\\(\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*([0-9A-Fa-f.]+%?)\\s*\\)$/);\n        if (!m) {\n            return null;\n        }\n        const comps = [\n            parseCssNumberOrPercentage(m[1], 255),\n            parseCssNumberOrPercentage(m[2], 255),\n            parseCssNumberOrPercentage(m[3], 255),\n        ];\n        if (isNaN(comps[0]) || isNaN(comps[1]) || isNaN(comps[2])) {\n            return null;\n        }\n        return comps;\n    }\n    function createFunctionalRgbColorParser(type) {\n        return (text) => {\n            const comps = parseFunctionalRgbColorComponents(text);\n            return comps ? new Color(comps, 'rgb', type) : null;\n        };\n    }\n    function parseFunctionalRgbaColorComponents(text) {\n        const m = text.match(/^rgba\\(\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*([0-9A-Fa-f.]+%?)\\s*\\)$/);\n        if (!m) {\n            return null;\n        }\n        const comps = [\n            parseCssNumberOrPercentage(m[1], 255),\n            parseCssNumberOrPercentage(m[2], 255),\n            parseCssNumberOrPercentage(m[3], 255),\n            parseCssNumberOrPercentage(m[4], 1),\n        ];\n        if (isNaN(comps[0]) ||\n            isNaN(comps[1]) ||\n            isNaN(comps[2]) ||\n            isNaN(comps[3])) {\n            return null;\n        }\n        return comps;\n    }\n    function createFunctionalRgbaColorParser(type) {\n        return (text) => {\n            const comps = parseFunctionalRgbaColorComponents(text);\n            return comps ? new Color(comps, 'rgb', type) : null;\n        };\n    }\n    function parseHslColorComponents(text) {\n        const m = text.match(/^hsl\\(\\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\\s*,\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*([0-9A-Fa-f.]+%?)\\s*\\)$/);\n        if (!m) {\n            return null;\n        }\n        const comps = [\n            parseCssNumberOrAngle(m[1]),\n            parseCssNumberOrPercentage(m[2], 100),\n            parseCssNumberOrPercentage(m[3], 100),\n        ];\n        if (isNaN(comps[0]) || isNaN(comps[1]) || isNaN(comps[2])) {\n            return null;\n        }\n        return comps;\n    }\n    function createHslColorParser(type) {\n        return (text) => {\n            const comps = parseHslColorComponents(text);\n            return comps ? new Color(comps, 'hsl', type) : null;\n        };\n    }\n    function parseHslaColorComponents(text) {\n        const m = text.match(/^hsla\\(\\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\\s*,\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*([0-9A-Fa-f.]+%?)\\s*\\)$/);\n        if (!m) {\n            return null;\n        }\n        const comps = [\n            parseCssNumberOrAngle(m[1]),\n            parseCssNumberOrPercentage(m[2], 100),\n            parseCssNumberOrPercentage(m[3], 100),\n            parseCssNumberOrPercentage(m[4], 1),\n        ];\n        if (isNaN(comps[0]) ||\n            isNaN(comps[1]) ||\n            isNaN(comps[2]) ||\n            isNaN(comps[3])) {\n            return null;\n        }\n        return comps;\n    }\n    function createHslaColorParser(type) {\n        return (text) => {\n            const comps = parseHslaColorComponents(text);\n            return comps ? new Color(comps, 'hsl', type) : null;\n        };\n    }\n    function parseHexRgbColorComponents(text) {\n        const mRgb = text.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);\n        if (mRgb) {\n            return [\n                parseInt(mRgb[1] + mRgb[1], 16),\n                parseInt(mRgb[2] + mRgb[2], 16),\n                parseInt(mRgb[3] + mRgb[3], 16),\n            ];\n        }\n        const mRrggbb = text.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);\n        if (mRrggbb) {\n            return [\n                parseInt(mRrggbb[1], 16),\n                parseInt(mRrggbb[2], 16),\n                parseInt(mRrggbb[3], 16),\n            ];\n        }\n        return null;\n    }\n    function parseHexRgbColor(text) {\n        const comps = parseHexRgbColorComponents(text);\n        return comps ? new Color(comps, 'rgb', 'int') : null;\n    }\n    function parseHexRgbaColorComponents(text) {\n        const mRgb = text.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);\n        if (mRgb) {\n            return [\n                parseInt(mRgb[1] + mRgb[1], 16),\n                parseInt(mRgb[2] + mRgb[2], 16),\n                parseInt(mRgb[3] + mRgb[3], 16),\n                mapRange(parseInt(mRgb[4] + mRgb[4], 16), 0, 255, 0, 1),\n            ];\n        }\n        const mRrggbb = text.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);\n        if (mRrggbb) {\n            return [\n                parseInt(mRrggbb[1], 16),\n                parseInt(mRrggbb[2], 16),\n                parseInt(mRrggbb[3], 16),\n                mapRange(parseInt(mRrggbb[4], 16), 0, 255, 0, 1),\n            ];\n        }\n        return null;\n    }\n    function parseHexRgbaColor(text) {\n        const comps = parseHexRgbaColorComponents(text);\n        return comps ? new Color(comps, 'rgb', 'int') : null;\n    }\n    function parseObjectRgbColorComponents(text) {\n        const m = text.match(/^\\{\\s*r\\s*:\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*g\\s*:\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*b\\s*:\\s*([0-9A-Fa-f.]+%?)\\s*\\}$/);\n        if (!m) {\n            return null;\n        }\n        const comps = [\n            parseFloat(m[1]),\n            parseFloat(m[2]),\n            parseFloat(m[3]),\n        ];\n        if (isNaN(comps[0]) || isNaN(comps[1]) || isNaN(comps[2])) {\n            return null;\n        }\n        return comps;\n    }\n    function createObjectRgbColorParser(type) {\n        return (text) => {\n            const comps = parseObjectRgbColorComponents(text);\n            return comps ? new Color(comps, 'rgb', type) : null;\n        };\n    }\n    function parseObjectRgbaColorComponents(text) {\n        const m = text.match(/^\\{\\s*r\\s*:\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*g\\s*:\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*b\\s*:\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*a\\s*:\\s*([0-9A-Fa-f.]+%?)\\s*\\}$/);\n        if (!m) {\n            return null;\n        }\n        const comps = [\n            parseFloat(m[1]),\n            parseFloat(m[2]),\n            parseFloat(m[3]),\n            parseFloat(m[4]),\n        ];\n        if (isNaN(comps[0]) ||\n            isNaN(comps[1]) ||\n            isNaN(comps[2]) ||\n            isNaN(comps[3])) {\n            return null;\n        }\n        return comps;\n    }\n    function createObjectRgbaColorParser(type) {\n        return (text) => {\n            const comps = parseObjectRgbaColorComponents(text);\n            return comps ? new Color(comps, 'rgb', type) : null;\n        };\n    }\n    const PARSER_AND_RESULT = [\n        {\n            parser: parseHexRgbColorComponents,\n            result: {\n                alpha: false,\n                mode: 'rgb',\n                notation: 'hex',\n            },\n        },\n        {\n            parser: parseHexRgbaColorComponents,\n            result: {\n                alpha: true,\n                mode: 'rgb',\n                notation: 'hex',\n            },\n        },\n        {\n            parser: parseFunctionalRgbColorComponents,\n            result: {\n                alpha: false,\n                mode: 'rgb',\n                notation: 'func',\n            },\n        },\n        {\n            parser: parseFunctionalRgbaColorComponents,\n            result: {\n                alpha: true,\n                mode: 'rgb',\n                notation: 'func',\n            },\n        },\n        {\n            parser: parseHslColorComponents,\n            result: {\n                alpha: false,\n                mode: 'hsl',\n                notation: 'func',\n            },\n        },\n        {\n            parser: parseHslaColorComponents,\n            result: {\n                alpha: true,\n                mode: 'hsl',\n                notation: 'func',\n            },\n        },\n        {\n            parser: parseObjectRgbColorComponents,\n            result: {\n                alpha: false,\n                mode: 'rgb',\n                notation: 'object',\n            },\n        },\n        {\n            parser: parseObjectRgbaColorComponents,\n            result: {\n                alpha: true,\n                mode: 'rgb',\n                notation: 'object',\n            },\n        },\n    ];\n    function detectStringColor(text) {\n        return PARSER_AND_RESULT.reduce((prev, { parser, result: detection }) => {\n            if (prev) {\n                return prev;\n            }\n            return parser(text) ? detection : null;\n        }, null);\n    }\n    function detectStringColorFormat(text, type = 'int') {\n        const r = detectStringColor(text);\n        if (!r) {\n            return null;\n        }\n        if (r.notation === 'hex' && type !== 'float') {\n            return Object.assign(Object.assign({}, r), { type: 'int' });\n        }\n        if (r.notation === 'func') {\n            return Object.assign(Object.assign({}, r), { type: type });\n        }\n        return null;\n    }\n    const TYPE_TO_PARSERS = {\n        int: [\n            parseHexRgbColor,\n            parseHexRgbaColor,\n            createFunctionalRgbColorParser('int'),\n            createFunctionalRgbaColorParser('int'),\n            createHslColorParser('int'),\n            createHslaColorParser('int'),\n            createObjectRgbColorParser('int'),\n            createObjectRgbaColorParser('int'),\n        ],\n        float: [\n            createFunctionalRgbColorParser('float'),\n            createFunctionalRgbaColorParser('float'),\n            createHslColorParser('float'),\n            createHslaColorParser('float'),\n            createObjectRgbColorParser('float'),\n            createObjectRgbaColorParser('float'),\n        ],\n    };\n    function createColorStringBindingReader(type) {\n        const parsers = TYPE_TO_PARSERS[type];\n        return (value) => {\n            if (typeof value !== 'string') {\n                return Color.black(type);\n            }\n            const result = parsers.reduce((prev, parser) => {\n                if (prev) {\n                    return prev;\n                }\n                return parser(value);\n            }, null);\n            return result !== null && result !== void 0 ? result : Color.black(type);\n        };\n    }\n    function createColorStringParser(type) {\n        const parsers = TYPE_TO_PARSERS[type];\n        return (value) => {\n            return parsers.reduce((prev, parser) => {\n                if (prev) {\n                    return prev;\n                }\n                return parser(value);\n            }, null);\n        };\n    }\n    function zerofill(comp) {\n        const hex = constrainRange(Math.floor(comp), 0, 255).toString(16);\n        return hex.length === 1 ? `0${hex}` : hex;\n    }\n    function colorToHexRgbString(value, prefix = '#') {\n        const hexes = removeAlphaComponent(value.getComponents('rgb'))\n            .map(zerofill)\n            .join('');\n        return `${prefix}${hexes}`;\n    }\n    function colorToHexRgbaString(value, prefix = '#') {\n        const rgbaComps = value.getComponents('rgb');\n        const hexes = [rgbaComps[0], rgbaComps[1], rgbaComps[2], rgbaComps[3] * 255]\n            .map(zerofill)\n            .join('');\n        return `${prefix}${hexes}`;\n    }\n    function colorToFunctionalRgbString(value, opt_type) {\n        const formatter = createNumberFormatter(opt_type === 'float' ? 2 : 0);\n        const comps = removeAlphaComponent(value.getComponents('rgb', opt_type)).map((comp) => formatter(comp));\n        return `rgb(${comps.join(', ')})`;\n    }\n    function createFunctionalRgbColorFormatter(type) {\n        return (value) => {\n            return colorToFunctionalRgbString(value, type);\n        };\n    }\n    function colorToFunctionalRgbaString(value, opt_type) {\n        const aFormatter = createNumberFormatter(2);\n        const rgbFormatter = createNumberFormatter(opt_type === 'float' ? 2 : 0);\n        const comps = value.getComponents('rgb', opt_type).map((comp, index) => {\n            const formatter = index === 3 ? aFormatter : rgbFormatter;\n            return formatter(comp);\n        });\n        return `rgba(${comps.join(', ')})`;\n    }\n    function createFunctionalRgbaColorFormatter(type) {\n        return (value) => {\n            return colorToFunctionalRgbaString(value, type);\n        };\n    }\n    function colorToFunctionalHslString(value) {\n        const formatters = [\n            createNumberFormatter(0),\n            formatPercentage,\n            formatPercentage,\n        ];\n        const comps = removeAlphaComponent(value.getComponents('hsl')).map((comp, index) => formatters[index](comp));\n        return `hsl(${comps.join(', ')})`;\n    }\n    function colorToFunctionalHslaString(value) {\n        const formatters = [\n            createNumberFormatter(0),\n            formatPercentage,\n            formatPercentage,\n            createNumberFormatter(2),\n        ];\n        const comps = value\n            .getComponents('hsl')\n            .map((comp, index) => formatters[index](comp));\n        return `hsla(${comps.join(', ')})`;\n    }\n    function colorToObjectRgbString(value, type) {\n        const formatter = createNumberFormatter(type === 'float' ? 2 : 0);\n        const names = ['r', 'g', 'b'];\n        const comps = removeAlphaComponent(value.getComponents('rgb', type)).map((comp, index) => `${names[index]}: ${formatter(comp)}`);\n        return `{${comps.join(', ')}}`;\n    }\n    function createObjectRgbColorFormatter(type) {\n        return (value) => colorToObjectRgbString(value, type);\n    }\n    function colorToObjectRgbaString(value, type) {\n        const aFormatter = createNumberFormatter(2);\n        const rgbFormatter = createNumberFormatter(type === 'float' ? 2 : 0);\n        const names = ['r', 'g', 'b', 'a'];\n        const comps = value.getComponents('rgb', type).map((comp, index) => {\n            const formatter = index === 3 ? aFormatter : rgbFormatter;\n            return `${names[index]}: ${formatter(comp)}`;\n        });\n        return `{${comps.join(', ')}}`;\n    }\n    function createObjectRgbaColorFormatter(type) {\n        return (value) => colorToObjectRgbaString(value, type);\n    }\n    const FORMAT_AND_STRINGIFIERS = [\n        {\n            format: {\n                alpha: false,\n                mode: 'rgb',\n                notation: 'hex',\n                type: 'int',\n            },\n            stringifier: colorToHexRgbString,\n        },\n        {\n            format: {\n                alpha: true,\n                mode: 'rgb',\n                notation: 'hex',\n                type: 'int',\n            },\n            stringifier: colorToHexRgbaString,\n        },\n        {\n            format: {\n                alpha: false,\n                mode: 'hsl',\n                notation: 'func',\n                type: 'int',\n            },\n            stringifier: colorToFunctionalHslString,\n        },\n        {\n            format: {\n                alpha: true,\n                mode: 'hsl',\n                notation: 'func',\n                type: 'int',\n            },\n            stringifier: colorToFunctionalHslaString,\n        },\n        ...['int', 'float'].reduce((prev, type) => {\n            return [\n                ...prev,\n                {\n                    format: {\n                        alpha: false,\n                        mode: 'rgb',\n                        notation: 'func',\n                        type: type,\n                    },\n                    stringifier: createFunctionalRgbColorFormatter(type),\n                },\n                {\n                    format: {\n                        alpha: true,\n                        mode: 'rgb',\n                        notation: 'func',\n                        type: type,\n                    },\n                    stringifier: createFunctionalRgbaColorFormatter(type),\n                },\n                {\n                    format: {\n                        alpha: false,\n                        mode: 'rgb',\n                        notation: 'object',\n                        type: type,\n                    },\n                    stringifier: createObjectRgbColorFormatter(type),\n                },\n                {\n                    format: {\n                        alpha: true,\n                        mode: 'rgb',\n                        notation: 'object',\n                        type: type,\n                    },\n                    stringifier: createObjectRgbaColorFormatter(type),\n                },\n            ];\n        }, []),\n    ];\n    function findColorStringifier(format) {\n        return FORMAT_AND_STRINGIFIERS.reduce((prev, fas) => {\n            if (prev) {\n                return prev;\n            }\n            return equalsStringColorFormat(fas.format, format)\n                ? fas.stringifier\n                : null;\n        }, null);\n    }\n\n    const className$a = ClassName('apl');\n    class APaletteView {\n        constructor(doc, config) {\n            this.onValueChange_ = this.onValueChange_.bind(this);\n            this.value = config.value;\n            this.value.emitter.on('change', this.onValueChange_);\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$a());\n            config.viewProps.bindClassModifiers(this.element);\n            config.viewProps.bindTabIndex(this.element);\n            const barElem = doc.createElement('div');\n            barElem.classList.add(className$a('b'));\n            this.element.appendChild(barElem);\n            const colorElem = doc.createElement('div');\n            colorElem.classList.add(className$a('c'));\n            barElem.appendChild(colorElem);\n            this.colorElem_ = colorElem;\n            const markerElem = doc.createElement('div');\n            markerElem.classList.add(className$a('m'));\n            this.element.appendChild(markerElem);\n            this.markerElem_ = markerElem;\n            const previewElem = doc.createElement('div');\n            previewElem.classList.add(className$a('p'));\n            this.markerElem_.appendChild(previewElem);\n            this.previewElem_ = previewElem;\n            this.update_();\n        }\n        update_() {\n            const c = this.value.rawValue;\n            const rgbaComps = c.getComponents('rgb');\n            const leftColor = new Color([rgbaComps[0], rgbaComps[1], rgbaComps[2], 0], 'rgb');\n            const rightColor = new Color([rgbaComps[0], rgbaComps[1], rgbaComps[2], 255], 'rgb');\n            const gradientComps = [\n                'to right',\n                colorToFunctionalRgbaString(leftColor),\n                colorToFunctionalRgbaString(rightColor),\n            ];\n            this.colorElem_.style.background = `linear-gradient(${gradientComps.join(',')})`;\n            this.previewElem_.style.backgroundColor = colorToFunctionalRgbaString(c);\n            const left = mapRange(rgbaComps[3], 0, 1, 0, 100);\n            this.markerElem_.style.left = `${left}%`;\n        }\n        onValueChange_() {\n            this.update_();\n        }\n    }\n\n    class APaletteController {\n        constructor(doc, config) {\n            this.onKeyDown_ = this.onKeyDown_.bind(this);\n            this.onKeyUp_ = this.onKeyUp_.bind(this);\n            this.onPointerDown_ = this.onPointerDown_.bind(this);\n            this.onPointerMove_ = this.onPointerMove_.bind(this);\n            this.onPointerUp_ = this.onPointerUp_.bind(this);\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.view = new APaletteView(doc, {\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            this.ptHandler_ = new PointerHandler(this.view.element);\n            this.ptHandler_.emitter.on('down', this.onPointerDown_);\n            this.ptHandler_.emitter.on('move', this.onPointerMove_);\n            this.ptHandler_.emitter.on('up', this.onPointerUp_);\n            this.view.element.addEventListener('keydown', this.onKeyDown_);\n            this.view.element.addEventListener('keyup', this.onKeyUp_);\n        }\n        handlePointerEvent_(d, opts) {\n            if (!d.point) {\n                return;\n            }\n            const alpha = d.point.x / d.bounds.width;\n            const c = this.value.rawValue;\n            const [h, s, v] = c.getComponents('hsv');\n            this.value.setRawValue(new Color([h, s, v, alpha], 'hsv'), opts);\n        }\n        onPointerDown_(ev) {\n            this.handlePointerEvent_(ev.data, {\n                forceEmit: false,\n                last: false,\n            });\n        }\n        onPointerMove_(ev) {\n            this.handlePointerEvent_(ev.data, {\n                forceEmit: false,\n                last: false,\n            });\n        }\n        onPointerUp_(ev) {\n            this.handlePointerEvent_(ev.data, {\n                forceEmit: true,\n                last: true,\n            });\n        }\n        onKeyDown_(ev) {\n            const step = getStepForKey(getBaseStepForColor(true), getHorizontalStepKeys(ev));\n            if (step === 0) {\n                return;\n            }\n            const c = this.value.rawValue;\n            const [h, s, v, a] = c.getComponents('hsv');\n            this.value.setRawValue(new Color([h, s, v, a + step], 'hsv'), {\n                forceEmit: false,\n                last: false,\n            });\n        }\n        onKeyUp_(ev) {\n            const step = getStepForKey(getBaseStepForColor(true), getHorizontalStepKeys(ev));\n            if (step === 0) {\n                return;\n            }\n            this.value.setRawValue(this.value.rawValue, {\n                forceEmit: true,\n                last: true,\n            });\n        }\n    }\n\n    const className$9 = ClassName('coltxt');\n    function createModeSelectElement(doc) {\n        const selectElem = doc.createElement('select');\n        const items = [\n            { text: 'RGB', value: 'rgb' },\n            { text: 'HSL', value: 'hsl' },\n            { text: 'HSV', value: 'hsv' },\n        ];\n        selectElem.appendChild(items.reduce((frag, item) => {\n            const optElem = doc.createElement('option');\n            optElem.textContent = item.text;\n            optElem.value = item.value;\n            frag.appendChild(optElem);\n            return frag;\n        }, doc.createDocumentFragment()));\n        return selectElem;\n    }\n    class ColorTextView {\n        constructor(doc, config) {\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$9());\n            config.viewProps.bindClassModifiers(this.element);\n            const modeElem = doc.createElement('div');\n            modeElem.classList.add(className$9('m'));\n            this.modeElem_ = createModeSelectElement(doc);\n            this.modeElem_.classList.add(className$9('ms'));\n            modeElem.appendChild(this.modeSelectElement);\n            config.viewProps.bindDisabled(this.modeElem_);\n            const modeMarkerElem = doc.createElement('div');\n            modeMarkerElem.classList.add(className$9('mm'));\n            modeMarkerElem.appendChild(createSvgIconElement(doc, 'dropdown'));\n            modeElem.appendChild(modeMarkerElem);\n            this.element.appendChild(modeElem);\n            const textsElem = doc.createElement('div');\n            textsElem.classList.add(className$9('w'));\n            this.element.appendChild(textsElem);\n            this.textsElem_ = textsElem;\n            this.textViews_ = config.textViews;\n            this.applyTextViews_();\n            bindValue(config.colorMode, (mode) => {\n                this.modeElem_.value = mode;\n            });\n        }\n        get modeSelectElement() {\n            return this.modeElem_;\n        }\n        get textViews() {\n            return this.textViews_;\n        }\n        set textViews(textViews) {\n            this.textViews_ = textViews;\n            this.applyTextViews_();\n        }\n        applyTextViews_() {\n            removeChildElements(this.textsElem_);\n            const doc = this.element.ownerDocument;\n            this.textViews_.forEach((v) => {\n                const compElem = doc.createElement('div');\n                compElem.classList.add(className$9('c'));\n                compElem.appendChild(v.element);\n                this.textsElem_.appendChild(compElem);\n            });\n        }\n    }\n\n    function createFormatter$2(type) {\n        return createNumberFormatter(type === 'float' ? 2 : 0);\n    }\n    function createConstraint$5(mode, type, index) {\n        const max = getColorMaxComponents(mode, type)[index];\n        return new DefiniteRangeConstraint({\n            min: 0,\n            max: max,\n        });\n    }\n    function createComponentController(doc, config, index) {\n        return new NumberTextController(doc, {\n            arrayPosition: index === 0 ? 'fst' : index === 3 - 1 ? 'lst' : 'mid',\n            baseStep: getBaseStepForColor(false),\n            parser: config.parser,\n            props: ValueMap.fromObject({\n                draggingScale: config.colorType === 'float' ? 0.01 : 1,\n                formatter: createFormatter$2(config.colorType),\n            }),\n            value: createValue(0, {\n                constraint: createConstraint$5(config.colorMode, config.colorType, index),\n            }),\n            viewProps: config.viewProps,\n        });\n    }\n    class ColorTextController {\n        constructor(doc, config) {\n            this.onModeSelectChange_ = this.onModeSelectChange_.bind(this);\n            this.colorType_ = config.colorType;\n            this.parser_ = config.parser;\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.colorMode = createValue(this.value.rawValue.mode);\n            this.ccs_ = this.createComponentControllers_(doc);\n            this.view = new ColorTextView(doc, {\n                colorMode: this.colorMode,\n                textViews: [this.ccs_[0].view, this.ccs_[1].view, this.ccs_[2].view],\n                viewProps: this.viewProps,\n            });\n            this.view.modeSelectElement.addEventListener('change', this.onModeSelectChange_);\n        }\n        createComponentControllers_(doc) {\n            const cc = {\n                colorMode: this.colorMode.rawValue,\n                colorType: this.colorType_,\n                parser: this.parser_,\n                viewProps: this.viewProps,\n            };\n            const ccs = [\n                createComponentController(doc, cc, 0),\n                createComponentController(doc, cc, 1),\n                createComponentController(doc, cc, 2),\n            ];\n            ccs.forEach((cs, index) => {\n                connectValues({\n                    primary: this.value,\n                    secondary: cs.value,\n                    forward: (p) => {\n                        return p.rawValue.getComponents(this.colorMode.rawValue, this.colorType_)[index];\n                    },\n                    backward: (p, s) => {\n                        const pickedMode = this.colorMode.rawValue;\n                        const comps = p.rawValue.getComponents(pickedMode, this.colorType_);\n                        comps[index] = s.rawValue;\n                        return new Color(appendAlphaComponent(removeAlphaComponent(comps), comps[3]), pickedMode, this.colorType_);\n                    },\n                });\n            });\n            return ccs;\n        }\n        onModeSelectChange_(ev) {\n            const selectElem = ev.currentTarget;\n            this.colorMode.rawValue = selectElem.value;\n            this.ccs_ = this.createComponentControllers_(this.view.element.ownerDocument);\n            this.view.textViews = [\n                this.ccs_[0].view,\n                this.ccs_[1].view,\n                this.ccs_[2].view,\n            ];\n        }\n    }\n\n    const className$8 = ClassName('hpl');\n    class HPaletteView {\n        constructor(doc, config) {\n            this.onValueChange_ = this.onValueChange_.bind(this);\n            this.value = config.value;\n            this.value.emitter.on('change', this.onValueChange_);\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$8());\n            config.viewProps.bindClassModifiers(this.element);\n            config.viewProps.bindTabIndex(this.element);\n            const colorElem = doc.createElement('div');\n            colorElem.classList.add(className$8('c'));\n            this.element.appendChild(colorElem);\n            const markerElem = doc.createElement('div');\n            markerElem.classList.add(className$8('m'));\n            this.element.appendChild(markerElem);\n            this.markerElem_ = markerElem;\n            this.update_();\n        }\n        update_() {\n            const c = this.value.rawValue;\n            const [h] = c.getComponents('hsv');\n            this.markerElem_.style.backgroundColor = colorToFunctionalRgbString(new Color([h, 100, 100], 'hsv'));\n            const left = mapRange(h, 0, 360, 0, 100);\n            this.markerElem_.style.left = `${left}%`;\n        }\n        onValueChange_() {\n            this.update_();\n        }\n    }\n\n    class HPaletteController {\n        constructor(doc, config) {\n            this.onKeyDown_ = this.onKeyDown_.bind(this);\n            this.onKeyUp_ = this.onKeyUp_.bind(this);\n            this.onPointerDown_ = this.onPointerDown_.bind(this);\n            this.onPointerMove_ = this.onPointerMove_.bind(this);\n            this.onPointerUp_ = this.onPointerUp_.bind(this);\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.view = new HPaletteView(doc, {\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            this.ptHandler_ = new PointerHandler(this.view.element);\n            this.ptHandler_.emitter.on('down', this.onPointerDown_);\n            this.ptHandler_.emitter.on('move', this.onPointerMove_);\n            this.ptHandler_.emitter.on('up', this.onPointerUp_);\n            this.view.element.addEventListener('keydown', this.onKeyDown_);\n            this.view.element.addEventListener('keyup', this.onKeyUp_);\n        }\n        handlePointerEvent_(d, opts) {\n            if (!d.point) {\n                return;\n            }\n            const hue = mapRange(constrainRange(d.point.x, 0, d.bounds.width), 0, d.bounds.width, 0, 360);\n            const c = this.value.rawValue;\n            const [, s, v, a] = c.getComponents('hsv');\n            this.value.setRawValue(new Color([hue, s, v, a], 'hsv'), opts);\n        }\n        onPointerDown_(ev) {\n            this.handlePointerEvent_(ev.data, {\n                forceEmit: false,\n                last: false,\n            });\n        }\n        onPointerMove_(ev) {\n            this.handlePointerEvent_(ev.data, {\n                forceEmit: false,\n                last: false,\n            });\n        }\n        onPointerUp_(ev) {\n            this.handlePointerEvent_(ev.data, {\n                forceEmit: true,\n                last: true,\n            });\n        }\n        onKeyDown_(ev) {\n            const step = getStepForKey(getBaseStepForColor(false), getHorizontalStepKeys(ev));\n            if (step === 0) {\n                return;\n            }\n            const c = this.value.rawValue;\n            const [h, s, v, a] = c.getComponents('hsv');\n            this.value.setRawValue(new Color([h + step, s, v, a], 'hsv'), {\n                forceEmit: false,\n                last: false,\n            });\n        }\n        onKeyUp_(ev) {\n            const step = getStepForKey(getBaseStepForColor(false), getHorizontalStepKeys(ev));\n            if (step === 0) {\n                return;\n            }\n            this.value.setRawValue(this.value.rawValue, {\n                forceEmit: true,\n                last: true,\n            });\n        }\n    }\n\n    const className$7 = ClassName('svp');\n    const CANVAS_RESOL = 64;\n    class SvPaletteView {\n        constructor(doc, config) {\n            this.onValueChange_ = this.onValueChange_.bind(this);\n            this.value = config.value;\n            this.value.emitter.on('change', this.onValueChange_);\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$7());\n            config.viewProps.bindClassModifiers(this.element);\n            config.viewProps.bindTabIndex(this.element);\n            const canvasElem = doc.createElement('canvas');\n            canvasElem.height = CANVAS_RESOL;\n            canvasElem.width = CANVAS_RESOL;\n            canvasElem.classList.add(className$7('c'));\n            this.element.appendChild(canvasElem);\n            this.canvasElement = canvasElem;\n            const markerElem = doc.createElement('div');\n            markerElem.classList.add(className$7('m'));\n            this.element.appendChild(markerElem);\n            this.markerElem_ = markerElem;\n            this.update_();\n        }\n        update_() {\n            const ctx = getCanvasContext(this.canvasElement);\n            if (!ctx) {\n                return;\n            }\n            const c = this.value.rawValue;\n            const hsvComps = c.getComponents('hsv');\n            const width = this.canvasElement.width;\n            const height = this.canvasElement.height;\n            const imgData = ctx.getImageData(0, 0, width, height);\n            const data = imgData.data;\n            for (let iy = 0; iy < height; iy++) {\n                for (let ix = 0; ix < width; ix++) {\n                    const s = mapRange(ix, 0, width, 0, 100);\n                    const v = mapRange(iy, 0, height, 100, 0);\n                    const rgbComps = hsvToRgbInt(hsvComps[0], s, v);\n                    const i = (iy * width + ix) * 4;\n                    data[i] = rgbComps[0];\n                    data[i + 1] = rgbComps[1];\n                    data[i + 2] = rgbComps[2];\n                    data[i + 3] = 255;\n                }\n            }\n            ctx.putImageData(imgData, 0, 0);\n            const left = mapRange(hsvComps[1], 0, 100, 0, 100);\n            this.markerElem_.style.left = `${left}%`;\n            const top = mapRange(hsvComps[2], 0, 100, 100, 0);\n            this.markerElem_.style.top = `${top}%`;\n        }\n        onValueChange_() {\n            this.update_();\n        }\n    }\n\n    class SvPaletteController {\n        constructor(doc, config) {\n            this.onKeyDown_ = this.onKeyDown_.bind(this);\n            this.onKeyUp_ = this.onKeyUp_.bind(this);\n            this.onPointerDown_ = this.onPointerDown_.bind(this);\n            this.onPointerMove_ = this.onPointerMove_.bind(this);\n            this.onPointerUp_ = this.onPointerUp_.bind(this);\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.view = new SvPaletteView(doc, {\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            this.ptHandler_ = new PointerHandler(this.view.element);\n            this.ptHandler_.emitter.on('down', this.onPointerDown_);\n            this.ptHandler_.emitter.on('move', this.onPointerMove_);\n            this.ptHandler_.emitter.on('up', this.onPointerUp_);\n            this.view.element.addEventListener('keydown', this.onKeyDown_);\n            this.view.element.addEventListener('keyup', this.onKeyUp_);\n        }\n        handlePointerEvent_(d, opts) {\n            if (!d.point) {\n                return;\n            }\n            const saturation = mapRange(d.point.x, 0, d.bounds.width, 0, 100);\n            const value = mapRange(d.point.y, 0, d.bounds.height, 100, 0);\n            const [h, , , a] = this.value.rawValue.getComponents('hsv');\n            this.value.setRawValue(new Color([h, saturation, value, a], 'hsv'), opts);\n        }\n        onPointerDown_(ev) {\n            this.handlePointerEvent_(ev.data, {\n                forceEmit: false,\n                last: false,\n            });\n        }\n        onPointerMove_(ev) {\n            this.handlePointerEvent_(ev.data, {\n                forceEmit: false,\n                last: false,\n            });\n        }\n        onPointerUp_(ev) {\n            this.handlePointerEvent_(ev.data, {\n                forceEmit: true,\n                last: true,\n            });\n        }\n        onKeyDown_(ev) {\n            if (isArrowKey(ev.key)) {\n                ev.preventDefault();\n            }\n            const [h, s, v, a] = this.value.rawValue.getComponents('hsv');\n            const baseStep = getBaseStepForColor(false);\n            const ds = getStepForKey(baseStep, getHorizontalStepKeys(ev));\n            const dv = getStepForKey(baseStep, getVerticalStepKeys(ev));\n            if (ds === 0 && dv === 0) {\n                return;\n            }\n            this.value.setRawValue(new Color([h, s + ds, v + dv, a], 'hsv'), {\n                forceEmit: false,\n                last: false,\n            });\n        }\n        onKeyUp_(ev) {\n            const baseStep = getBaseStepForColor(false);\n            const ds = getStepForKey(baseStep, getHorizontalStepKeys(ev));\n            const dv = getStepForKey(baseStep, getVerticalStepKeys(ev));\n            if (ds === 0 && dv === 0) {\n                return;\n            }\n            this.value.setRawValue(this.value.rawValue, {\n                forceEmit: true,\n                last: true,\n            });\n        }\n    }\n\n    class ColorPickerController {\n        constructor(doc, config) {\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.hPaletteC_ = new HPaletteController(doc, {\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            this.svPaletteC_ = new SvPaletteController(doc, {\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            this.alphaIcs_ = config.supportsAlpha\n                ? {\n                    palette: new APaletteController(doc, {\n                        value: this.value,\n                        viewProps: this.viewProps,\n                    }),\n                    text: new NumberTextController(doc, {\n                        parser: parseNumber,\n                        baseStep: 0.1,\n                        props: ValueMap.fromObject({\n                            draggingScale: 0.01,\n                            formatter: createNumberFormatter(2),\n                        }),\n                        value: createValue(0, {\n                            constraint: new DefiniteRangeConstraint({ min: 0, max: 1 }),\n                        }),\n                        viewProps: this.viewProps,\n                    }),\n                }\n                : null;\n            if (this.alphaIcs_) {\n                connectValues({\n                    primary: this.value,\n                    secondary: this.alphaIcs_.text.value,\n                    forward: (p) => {\n                        return p.rawValue.getComponents()[3];\n                    },\n                    backward: (p, s) => {\n                        const comps = p.rawValue.getComponents();\n                        comps[3] = s.rawValue;\n                        return new Color(comps, p.rawValue.mode);\n                    },\n                });\n            }\n            this.textC_ = new ColorTextController(doc, {\n                colorType: config.colorType,\n                parser: parseNumber,\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            this.view = new ColorPickerView(doc, {\n                alphaViews: this.alphaIcs_\n                    ? {\n                        palette: this.alphaIcs_.palette.view,\n                        text: this.alphaIcs_.text.view,\n                    }\n                    : null,\n                hPaletteView: this.hPaletteC_.view,\n                supportsAlpha: config.supportsAlpha,\n                svPaletteView: this.svPaletteC_.view,\n                textView: this.textC_.view,\n                viewProps: this.viewProps,\n            });\n        }\n        get textController() {\n            return this.textC_;\n        }\n    }\n\n    const className$6 = ClassName('colsw');\n    class ColorSwatchView {\n        constructor(doc, config) {\n            this.onValueChange_ = this.onValueChange_.bind(this);\n            config.value.emitter.on('change', this.onValueChange_);\n            this.value = config.value;\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$6());\n            config.viewProps.bindClassModifiers(this.element);\n            const swatchElem = doc.createElement('div');\n            swatchElem.classList.add(className$6('sw'));\n            this.element.appendChild(swatchElem);\n            this.swatchElem_ = swatchElem;\n            const buttonElem = doc.createElement('button');\n            buttonElem.classList.add(className$6('b'));\n            config.viewProps.bindDisabled(buttonElem);\n            this.element.appendChild(buttonElem);\n            this.buttonElement = buttonElem;\n            this.update_();\n        }\n        update_() {\n            const value = this.value.rawValue;\n            this.swatchElem_.style.backgroundColor = colorToHexRgbaString(value);\n        }\n        onValueChange_() {\n            this.update_();\n        }\n    }\n\n    class ColorSwatchController {\n        constructor(doc, config) {\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.view = new ColorSwatchView(doc, {\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n        }\n    }\n\n    class ColorController {\n        constructor(doc, config) {\n            this.onButtonBlur_ = this.onButtonBlur_.bind(this);\n            this.onButtonClick_ = this.onButtonClick_.bind(this);\n            this.onPopupChildBlur_ = this.onPopupChildBlur_.bind(this);\n            this.onPopupChildKeydown_ = this.onPopupChildKeydown_.bind(this);\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.foldable_ = Foldable.create(config.expanded);\n            this.swatchC_ = new ColorSwatchController(doc, {\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            const buttonElem = this.swatchC_.view.buttonElement;\n            buttonElem.addEventListener('blur', this.onButtonBlur_);\n            buttonElem.addEventListener('click', this.onButtonClick_);\n            this.textC_ = new TextController(doc, {\n                parser: config.parser,\n                props: ValueMap.fromObject({\n                    formatter: config.formatter,\n                }),\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            this.view = new ColorView(doc, {\n                foldable: this.foldable_,\n                pickerLayout: config.pickerLayout,\n            });\n            this.view.swatchElement.appendChild(this.swatchC_.view.element);\n            this.view.textElement.appendChild(this.textC_.view.element);\n            this.popC_ =\n                config.pickerLayout === 'popup'\n                    ? new PopupController(doc, {\n                        viewProps: this.viewProps,\n                    })\n                    : null;\n            const pickerC = new ColorPickerController(doc, {\n                colorType: config.colorType,\n                supportsAlpha: config.supportsAlpha,\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            pickerC.view.allFocusableElements.forEach((elem) => {\n                elem.addEventListener('blur', this.onPopupChildBlur_);\n                elem.addEventListener('keydown', this.onPopupChildKeydown_);\n            });\n            this.pickerC_ = pickerC;\n            if (this.popC_) {\n                this.view.element.appendChild(this.popC_.view.element);\n                this.popC_.view.element.appendChild(pickerC.view.element);\n                connectValues({\n                    primary: this.foldable_.value('expanded'),\n                    secondary: this.popC_.shows,\n                    forward: (p) => p.rawValue,\n                    backward: (_, s) => s.rawValue,\n                });\n            }\n            else if (this.view.pickerElement) {\n                this.view.pickerElement.appendChild(this.pickerC_.view.element);\n                bindFoldable(this.foldable_, this.view.pickerElement);\n            }\n        }\n        get textController() {\n            return this.textC_;\n        }\n        onButtonBlur_(e) {\n            if (!this.popC_) {\n                return;\n            }\n            const elem = this.view.element;\n            const nextTarget = forceCast(e.relatedTarget);\n            if (!nextTarget || !elem.contains(nextTarget)) {\n                this.popC_.shows.rawValue = false;\n            }\n        }\n        onButtonClick_() {\n            this.foldable_.set('expanded', !this.foldable_.get('expanded'));\n            if (this.foldable_.get('expanded')) {\n                this.pickerC_.view.allFocusableElements[0].focus();\n            }\n        }\n        onPopupChildBlur_(ev) {\n            if (!this.popC_) {\n                return;\n            }\n            const elem = this.popC_.view.element;\n            const nextTarget = findNextTarget(ev);\n            if (nextTarget && elem.contains(nextTarget)) {\n                return;\n            }\n            if (nextTarget &&\n                nextTarget === this.swatchC_.view.buttonElement &&\n                !supportsTouch(elem.ownerDocument)) {\n                return;\n            }\n            this.popC_.shows.rawValue = false;\n        }\n        onPopupChildKeydown_(ev) {\n            if (this.popC_) {\n                if (ev.key === 'Escape') {\n                    this.popC_.shows.rawValue = false;\n                }\n            }\n            else if (this.view.pickerElement) {\n                if (ev.key === 'Escape') {\n                    this.swatchC_.view.buttonElement.focus();\n                }\n            }\n        }\n    }\n\n    function colorFromObject(value, opt_type) {\n        if (Color.isColorObject(value)) {\n            return Color.fromObject(value, opt_type);\n        }\n        return Color.black(opt_type);\n    }\n    function colorToRgbNumber(value) {\n        return removeAlphaComponent(value.getComponents('rgb')).reduce((result, comp) => {\n            return (result << 8) | (Math.floor(comp) & 0xff);\n        }, 0);\n    }\n    function colorToRgbaNumber(value) {\n        return (value.getComponents('rgb').reduce((result, comp, index) => {\n            const hex = Math.floor(index === 3 ? comp * 255 : comp) & 0xff;\n            return (result << 8) | hex;\n        }, 0) >>> 0);\n    }\n    function numberToRgbColor(num) {\n        return new Color([(num >> 16) & 0xff, (num >> 8) & 0xff, num & 0xff], 'rgb');\n    }\n    function numberToRgbaColor(num) {\n        return new Color([\n            (num >> 24) & 0xff,\n            (num >> 16) & 0xff,\n            (num >> 8) & 0xff,\n            mapRange(num & 0xff, 0, 255, 0, 1),\n        ], 'rgb');\n    }\n    function colorFromRgbNumber(value) {\n        if (typeof value !== 'number') {\n            return Color.black();\n        }\n        return numberToRgbColor(value);\n    }\n    function colorFromRgbaNumber(value) {\n        if (typeof value !== 'number') {\n            return Color.black();\n        }\n        return numberToRgbaColor(value);\n    }\n\n    function createColorStringWriter(format) {\n        const stringify = findColorStringifier(format);\n        return stringify\n            ? (target, value) => {\n                writePrimitive(target, stringify(value));\n            }\n            : null;\n    }\n    function createColorNumberWriter(supportsAlpha) {\n        const colorToNumber = supportsAlpha ? colorToRgbaNumber : colorToRgbNumber;\n        return (target, value) => {\n            writePrimitive(target, colorToNumber(value));\n        };\n    }\n    function writeRgbaColorObject(target, value, opt_type) {\n        const obj = value.toRgbaObject(opt_type);\n        target.writeProperty('r', obj.r);\n        target.writeProperty('g', obj.g);\n        target.writeProperty('b', obj.b);\n        target.writeProperty('a', obj.a);\n    }\n    function writeRgbColorObject(target, value, opt_type) {\n        const obj = value.toRgbaObject(opt_type);\n        target.writeProperty('r', obj.r);\n        target.writeProperty('g', obj.g);\n        target.writeProperty('b', obj.b);\n    }\n    function createColorObjectWriter(supportsAlpha, opt_type) {\n        return (target, inValue) => {\n            if (supportsAlpha) {\n                writeRgbaColorObject(target, inValue, opt_type);\n            }\n            else {\n                writeRgbColorObject(target, inValue, opt_type);\n            }\n        };\n    }\n\n    function shouldSupportAlpha$1(inputParams) {\n        var _a;\n        if ((inputParams === null || inputParams === void 0 ? void 0 : inputParams.alpha) || ((_a = inputParams === null || inputParams === void 0 ? void 0 : inputParams.color) === null || _a === void 0 ? void 0 : _a.alpha)) {\n            return true;\n        }\n        return false;\n    }\n    function createFormatter$1(supportsAlpha) {\n        return supportsAlpha\n            ? (v) => colorToHexRgbaString(v, '0x')\n            : (v) => colorToHexRgbString(v, '0x');\n    }\n    function isForColor(params) {\n        if ('color' in params) {\n            return true;\n        }\n        if ('view' in params && params.view === 'color') {\n            return true;\n        }\n        return false;\n    }\n    const NumberColorInputPlugin = {\n        id: 'input-color-number',\n        type: 'input',\n        accept: (value, params) => {\n            if (typeof value !== 'number') {\n                return null;\n            }\n            if (!isForColor(params)) {\n                return null;\n            }\n            const result = parseColorInputParams(params);\n            return result\n                ? {\n                    initialValue: value,\n                    params: result,\n                }\n                : null;\n        },\n        binding: {\n            reader: (args) => {\n                return shouldSupportAlpha$1(args.params)\n                    ? colorFromRgbaNumber\n                    : colorFromRgbNumber;\n            },\n            equals: Color.equals,\n            writer: (args) => {\n                return createColorNumberWriter(shouldSupportAlpha$1(args.params));\n            },\n        },\n        controller: (args) => {\n            const supportsAlpha = shouldSupportAlpha$1(args.params);\n            const expanded = 'expanded' in args.params ? args.params.expanded : undefined;\n            const picker = 'picker' in args.params ? args.params.picker : undefined;\n            return new ColorController(args.document, {\n                colorType: 'int',\n                expanded: expanded !== null && expanded !== void 0 ? expanded : false,\n                formatter: createFormatter$1(supportsAlpha),\n                parser: createColorStringParser('int'),\n                pickerLayout: picker !== null && picker !== void 0 ? picker : 'popup',\n                supportsAlpha: supportsAlpha,\n                value: args.value,\n                viewProps: args.viewProps,\n            });\n        },\n    };\n\n    function shouldSupportAlpha(initialValue) {\n        return Color.isRgbaColorObject(initialValue);\n    }\n    function createColorObjectReader(opt_type) {\n        return (value) => {\n            return colorFromObject(value, opt_type);\n        };\n    }\n    function createColorObjectFormatter(supportsAlpha, type) {\n        return (value) => {\n            if (supportsAlpha) {\n                return colorToObjectRgbaString(value, type);\n            }\n            return colorToObjectRgbString(value, type);\n        };\n    }\n    const ObjectColorInputPlugin = {\n        id: 'input-color-object',\n        type: 'input',\n        accept: (value, params) => {\n            if (!Color.isColorObject(value)) {\n                return null;\n            }\n            const result = parseColorInputParams(params);\n            return result\n                ? {\n                    initialValue: value,\n                    params: result,\n                }\n                : null;\n        },\n        binding: {\n            reader: (args) => createColorObjectReader(extractColorType(args.params)),\n            equals: Color.equals,\n            writer: (args) => createColorObjectWriter(shouldSupportAlpha(args.initialValue), extractColorType(args.params)),\n        },\n        controller: (args) => {\n            var _a;\n            const supportsAlpha = Color.isRgbaColorObject(args.initialValue);\n            const expanded = 'expanded' in args.params ? args.params.expanded : undefined;\n            const picker = 'picker' in args.params ? args.params.picker : undefined;\n            const type = (_a = extractColorType(args.params)) !== null && _a !== void 0 ? _a : 'int';\n            return new ColorController(args.document, {\n                colorType: type,\n                expanded: expanded !== null && expanded !== void 0 ? expanded : false,\n                formatter: createColorObjectFormatter(supportsAlpha, type),\n                parser: createColorStringParser(type),\n                pickerLayout: picker !== null && picker !== void 0 ? picker : 'popup',\n                supportsAlpha: supportsAlpha,\n                value: args.value,\n                viewProps: args.viewProps,\n            });\n        },\n    };\n\n    const StringColorInputPlugin = {\n        id: 'input-color-string',\n        type: 'input',\n        accept: (value, params) => {\n            if (typeof value !== 'string') {\n                return null;\n            }\n            if ('view' in params && params.view === 'text') {\n                return null;\n            }\n            const format = detectStringColorFormat(value, extractColorType(params));\n            if (!format) {\n                return null;\n            }\n            const stringifier = findColorStringifier(format);\n            if (!stringifier) {\n                return null;\n            }\n            const result = parseColorInputParams(params);\n            return result\n                ? {\n                    initialValue: value,\n                    params: result,\n                }\n                : null;\n        },\n        binding: {\n            reader: (args) => { var _a; return createColorStringBindingReader((_a = extractColorType(args.params)) !== null && _a !== void 0 ? _a : 'int'); },\n            equals: Color.equals,\n            writer: (args) => {\n                const format = detectStringColorFormat(args.initialValue, extractColorType(args.params));\n                if (!format) {\n                    throw TpError.shouldNeverHappen();\n                }\n                const writer = createColorStringWriter(format);\n                if (!writer) {\n                    throw TpError.notBindable();\n                }\n                return writer;\n            },\n        },\n        controller: (args) => {\n            const format = detectStringColorFormat(args.initialValue, extractColorType(args.params));\n            if (!format) {\n                throw TpError.shouldNeverHappen();\n            }\n            const stringifier = findColorStringifier(format);\n            if (!stringifier) {\n                throw TpError.shouldNeverHappen();\n            }\n            const expanded = 'expanded' in args.params ? args.params.expanded : undefined;\n            const picker = 'picker' in args.params ? args.params.picker : undefined;\n            return new ColorController(args.document, {\n                colorType: format.type,\n                expanded: expanded !== null && expanded !== void 0 ? expanded : false,\n                formatter: stringifier,\n                parser: createColorStringParser(format.type),\n                pickerLayout: picker !== null && picker !== void 0 ? picker : 'popup',\n                supportsAlpha: format.alpha,\n                value: args.value,\n                viewProps: args.viewProps,\n            });\n        },\n    };\n\n    class PointNdConstraint {\n        constructor(config) {\n            this.components = config.components;\n            this.asm_ = config.assembly;\n        }\n        constrain(value) {\n            const comps = this.asm_\n                .toComponents(value)\n                .map((comp, index) => { var _a, _b; return (_b = (_a = this.components[index]) === null || _a === void 0 ? void 0 : _a.constrain(comp)) !== null && _b !== void 0 ? _b : comp; });\n            return this.asm_.fromComponents(comps);\n        }\n    }\n\n    const className$5 = ClassName('pndtxt');\n    class PointNdTextView {\n        constructor(doc, config) {\n            this.textViews = config.textViews;\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$5());\n            this.textViews.forEach((v) => {\n                const axisElem = doc.createElement('div');\n                axisElem.classList.add(className$5('a'));\n                axisElem.appendChild(v.element);\n                this.element.appendChild(axisElem);\n            });\n        }\n    }\n\n    function createAxisController(doc, config, index) {\n        return new NumberTextController(doc, {\n            arrayPosition: index === 0 ? 'fst' : index === config.axes.length - 1 ? 'lst' : 'mid',\n            baseStep: config.axes[index].baseStep,\n            parser: config.parser,\n            props: config.axes[index].textProps,\n            value: createValue(0, {\n                constraint: config.axes[index].constraint,\n            }),\n            viewProps: config.viewProps,\n        });\n    }\n    class PointNdTextController {\n        constructor(doc, config) {\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.acs_ = config.axes.map((_, index) => createAxisController(doc, config, index));\n            this.acs_.forEach((c, index) => {\n                connectValues({\n                    primary: this.value,\n                    secondary: c.value,\n                    forward: (p) => {\n                        return config.assembly.toComponents(p.rawValue)[index];\n                    },\n                    backward: (p, s) => {\n                        const comps = config.assembly.toComponents(p.rawValue);\n                        comps[index] = s.rawValue;\n                        return config.assembly.fromComponents(comps);\n                    },\n                });\n            });\n            this.view = new PointNdTextView(doc, {\n                textViews: this.acs_.map((ac) => ac.view),\n            });\n        }\n    }\n\n    function createStepConstraint(params, initialValue) {\n        if ('step' in params && !isEmpty(params.step)) {\n            return new StepConstraint(params.step, initialValue);\n        }\n        return null;\n    }\n    function createRangeConstraint(params) {\n        if (!isEmpty(params.max) && !isEmpty(params.min)) {\n            return new DefiniteRangeConstraint({\n                max: params.max,\n                min: params.min,\n            });\n        }\n        if (!isEmpty(params.max) || !isEmpty(params.min)) {\n            return new RangeConstraint({\n                max: params.max,\n                min: params.min,\n            });\n        }\n        return null;\n    }\n    function findNumberRange(c) {\n        const drc = findConstraint(c, DefiniteRangeConstraint);\n        if (drc) {\n            return [drc.values.get('min'), drc.values.get('max')];\n        }\n        const rc = findConstraint(c, RangeConstraint);\n        if (rc) {\n            return [rc.minValue, rc.maxValue];\n        }\n        return [undefined, undefined];\n    }\n    function createConstraint$4(params,\n    initialValue) {\n        const constraints = [];\n        const sc = createStepConstraint(params, initialValue);\n        if (sc) {\n            constraints.push(sc);\n        }\n        const rc = createRangeConstraint(params);\n        if (rc) {\n            constraints.push(rc);\n        }\n        const lc = createListConstraint(params.options);\n        if (lc) {\n            constraints.push(lc);\n        }\n        return new CompositeConstraint(constraints);\n    }\n    const NumberInputPlugin = {\n        id: 'input-number',\n        type: 'input',\n        accept: (value, params) => {\n            if (typeof value !== 'number') {\n                return null;\n            }\n            const p = ParamsParsers;\n            const result = parseParams(params, {\n                format: p.optional.function,\n                max: p.optional.number,\n                min: p.optional.number,\n                options: p.optional.custom(parseListOptions),\n                step: p.optional.number,\n            });\n            return result\n                ? {\n                    initialValue: value,\n                    params: result,\n                }\n                : null;\n        },\n        binding: {\n            reader: (_args) => numberFromUnknown,\n            constraint: (args) => createConstraint$4(args.params, args.initialValue),\n            writer: (_args) => writePrimitive,\n        },\n        controller: (args) => {\n            var _a;\n            const value = args.value;\n            const c = args.constraint;\n            const lc = c && findConstraint(c, ListConstraint);\n            if (lc) {\n                return new ListController(args.document, {\n                    props: new ValueMap({\n                        options: lc.values.value('options'),\n                    }),\n                    value: value,\n                    viewProps: args.viewProps,\n                });\n            }\n            const formatter = (_a = ('format' in args.params ? args.params.format : undefined)) !== null && _a !== void 0 ? _a : createNumberFormatter(getSuitableDecimalDigits(c, value.rawValue));\n            const drc = c && findConstraint(c, DefiniteRangeConstraint);\n            if (drc) {\n                return new SliderTextController(args.document, {\n                    baseStep: getBaseStep(c),\n                    parser: parseNumber,\n                    sliderProps: new ValueMap({\n                        maxValue: drc.values.value('max'),\n                        minValue: drc.values.value('min'),\n                    }),\n                    textProps: ValueMap.fromObject({\n                        draggingScale: getSuitableDraggingScale(c, value.rawValue),\n                        formatter: formatter,\n                    }),\n                    value: value,\n                    viewProps: args.viewProps,\n                });\n            }\n            return new NumberTextController(args.document, {\n                baseStep: getBaseStep(c),\n                parser: parseNumber,\n                props: ValueMap.fromObject({\n                    draggingScale: getSuitableDraggingScale(c, value.rawValue),\n                    formatter: formatter,\n                }),\n                value: value,\n                viewProps: args.viewProps,\n            });\n        },\n    };\n\n    class Point2d {\n        constructor(x = 0, y = 0) {\n            this.x = x;\n            this.y = y;\n        }\n        getComponents() {\n            return [this.x, this.y];\n        }\n        static isObject(obj) {\n            if (isEmpty(obj)) {\n                return false;\n            }\n            const x = obj.x;\n            const y = obj.y;\n            if (typeof x !== 'number' || typeof y !== 'number') {\n                return false;\n            }\n            return true;\n        }\n        static equals(v1, v2) {\n            return v1.x === v2.x && v1.y === v2.y;\n        }\n        toObject() {\n            return {\n                x: this.x,\n                y: this.y,\n            };\n        }\n    }\n    const Point2dAssembly = {\n        toComponents: (p) => p.getComponents(),\n        fromComponents: (comps) => new Point2d(...comps),\n    };\n\n    const className$4 = ClassName('p2d');\n    class Point2dView {\n        constructor(doc, config) {\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$4());\n            config.viewProps.bindClassModifiers(this.element);\n            bindValue(config.expanded, valueToClassName(this.element, className$4(undefined, 'expanded')));\n            const headElem = doc.createElement('div');\n            headElem.classList.add(className$4('h'));\n            this.element.appendChild(headElem);\n            const buttonElem = doc.createElement('button');\n            buttonElem.classList.add(className$4('b'));\n            buttonElem.appendChild(createSvgIconElement(doc, 'p2dpad'));\n            config.viewProps.bindDisabled(buttonElem);\n            headElem.appendChild(buttonElem);\n            this.buttonElement = buttonElem;\n            const textElem = doc.createElement('div');\n            textElem.classList.add(className$4('t'));\n            headElem.appendChild(textElem);\n            this.textElement = textElem;\n            if (config.pickerLayout === 'inline') {\n                const pickerElem = doc.createElement('div');\n                pickerElem.classList.add(className$4('p'));\n                this.element.appendChild(pickerElem);\n                this.pickerElement = pickerElem;\n            }\n            else {\n                this.pickerElement = null;\n            }\n        }\n    }\n\n    const className$3 = ClassName('p2dp');\n    class Point2dPickerView {\n        constructor(doc, config) {\n            this.onFoldableChange_ = this.onFoldableChange_.bind(this);\n            this.onValueChange_ = this.onValueChange_.bind(this);\n            this.invertsY_ = config.invertsY;\n            this.maxValue_ = config.maxValue;\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$3());\n            if (config.layout === 'popup') {\n                this.element.classList.add(className$3(undefined, 'p'));\n            }\n            config.viewProps.bindClassModifiers(this.element);\n            const padElem = doc.createElement('div');\n            padElem.classList.add(className$3('p'));\n            config.viewProps.bindTabIndex(padElem);\n            this.element.appendChild(padElem);\n            this.padElement = padElem;\n            const svgElem = doc.createElementNS(SVG_NS, 'svg');\n            svgElem.classList.add(className$3('g'));\n            this.padElement.appendChild(svgElem);\n            this.svgElem_ = svgElem;\n            const xAxisElem = doc.createElementNS(SVG_NS, 'line');\n            xAxisElem.classList.add(className$3('ax'));\n            xAxisElem.setAttributeNS(null, 'x1', '0');\n            xAxisElem.setAttributeNS(null, 'y1', '50%');\n            xAxisElem.setAttributeNS(null, 'x2', '100%');\n            xAxisElem.setAttributeNS(null, 'y2', '50%');\n            this.svgElem_.appendChild(xAxisElem);\n            const yAxisElem = doc.createElementNS(SVG_NS, 'line');\n            yAxisElem.classList.add(className$3('ax'));\n            yAxisElem.setAttributeNS(null, 'x1', '50%');\n            yAxisElem.setAttributeNS(null, 'y1', '0');\n            yAxisElem.setAttributeNS(null, 'x2', '50%');\n            yAxisElem.setAttributeNS(null, 'y2', '100%');\n            this.svgElem_.appendChild(yAxisElem);\n            const lineElem = doc.createElementNS(SVG_NS, 'line');\n            lineElem.classList.add(className$3('l'));\n            lineElem.setAttributeNS(null, 'x1', '50%');\n            lineElem.setAttributeNS(null, 'y1', '50%');\n            this.svgElem_.appendChild(lineElem);\n            this.lineElem_ = lineElem;\n            const markerElem = doc.createElement('div');\n            markerElem.classList.add(className$3('m'));\n            this.padElement.appendChild(markerElem);\n            this.markerElem_ = markerElem;\n            config.value.emitter.on('change', this.onValueChange_);\n            this.value = config.value;\n            this.update_();\n        }\n        get allFocusableElements() {\n            return [this.padElement];\n        }\n        update_() {\n            const [x, y] = this.value.rawValue.getComponents();\n            const max = this.maxValue_;\n            const px = mapRange(x, -max, +max, 0, 100);\n            const py = mapRange(y, -max, +max, 0, 100);\n            const ipy = this.invertsY_ ? 100 - py : py;\n            this.lineElem_.setAttributeNS(null, 'x2', `${px}%`);\n            this.lineElem_.setAttributeNS(null, 'y2', `${ipy}%`);\n            this.markerElem_.style.left = `${px}%`;\n            this.markerElem_.style.top = `${ipy}%`;\n        }\n        onValueChange_() {\n            this.update_();\n        }\n        onFoldableChange_() {\n            this.update_();\n        }\n    }\n\n    function computeOffset(ev, baseSteps, invertsY) {\n        return [\n            getStepForKey(baseSteps[0], getHorizontalStepKeys(ev)),\n            getStepForKey(baseSteps[1], getVerticalStepKeys(ev)) * (invertsY ? 1 : -1),\n        ];\n    }\n    class Point2dPickerController {\n        constructor(doc, config) {\n            this.onPadKeyDown_ = this.onPadKeyDown_.bind(this);\n            this.onPadKeyUp_ = this.onPadKeyUp_.bind(this);\n            this.onPointerDown_ = this.onPointerDown_.bind(this);\n            this.onPointerMove_ = this.onPointerMove_.bind(this);\n            this.onPointerUp_ = this.onPointerUp_.bind(this);\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.baseSteps_ = config.baseSteps;\n            this.maxValue_ = config.maxValue;\n            this.invertsY_ = config.invertsY;\n            this.view = new Point2dPickerView(doc, {\n                invertsY: this.invertsY_,\n                layout: config.layout,\n                maxValue: this.maxValue_,\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            this.ptHandler_ = new PointerHandler(this.view.padElement);\n            this.ptHandler_.emitter.on('down', this.onPointerDown_);\n            this.ptHandler_.emitter.on('move', this.onPointerMove_);\n            this.ptHandler_.emitter.on('up', this.onPointerUp_);\n            this.view.padElement.addEventListener('keydown', this.onPadKeyDown_);\n            this.view.padElement.addEventListener('keyup', this.onPadKeyUp_);\n        }\n        handlePointerEvent_(d, opts) {\n            if (!d.point) {\n                return;\n            }\n            const max = this.maxValue_;\n            const px = mapRange(d.point.x, 0, d.bounds.width, -max, +max);\n            const py = mapRange(this.invertsY_ ? d.bounds.height - d.point.y : d.point.y, 0, d.bounds.height, -max, +max);\n            this.value.setRawValue(new Point2d(px, py), opts);\n        }\n        onPointerDown_(ev) {\n            this.handlePointerEvent_(ev.data, {\n                forceEmit: false,\n                last: false,\n            });\n        }\n        onPointerMove_(ev) {\n            this.handlePointerEvent_(ev.data, {\n                forceEmit: false,\n                last: false,\n            });\n        }\n        onPointerUp_(ev) {\n            this.handlePointerEvent_(ev.data, {\n                forceEmit: true,\n                last: true,\n            });\n        }\n        onPadKeyDown_(ev) {\n            if (isArrowKey(ev.key)) {\n                ev.preventDefault();\n            }\n            const [dx, dy] = computeOffset(ev, this.baseSteps_, this.invertsY_);\n            if (dx === 0 && dy === 0) {\n                return;\n            }\n            this.value.setRawValue(new Point2d(this.value.rawValue.x + dx, this.value.rawValue.y + dy), {\n                forceEmit: false,\n                last: false,\n            });\n        }\n        onPadKeyUp_(ev) {\n            const [dx, dy] = computeOffset(ev, this.baseSteps_, this.invertsY_);\n            if (dx === 0 && dy === 0) {\n                return;\n            }\n            this.value.setRawValue(this.value.rawValue, {\n                forceEmit: true,\n                last: true,\n            });\n        }\n    }\n\n    class Point2dController {\n        constructor(doc, config) {\n            var _a, _b;\n            this.onPopupChildBlur_ = this.onPopupChildBlur_.bind(this);\n            this.onPopupChildKeydown_ = this.onPopupChildKeydown_.bind(this);\n            this.onPadButtonBlur_ = this.onPadButtonBlur_.bind(this);\n            this.onPadButtonClick_ = this.onPadButtonClick_.bind(this);\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.foldable_ = Foldable.create(config.expanded);\n            this.popC_ =\n                config.pickerLayout === 'popup'\n                    ? new PopupController(doc, {\n                        viewProps: this.viewProps,\n                    })\n                    : null;\n            const padC = new Point2dPickerController(doc, {\n                baseSteps: [config.axes[0].baseStep, config.axes[1].baseStep],\n                invertsY: config.invertsY,\n                layout: config.pickerLayout,\n                maxValue: config.maxValue,\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            padC.view.allFocusableElements.forEach((elem) => {\n                elem.addEventListener('blur', this.onPopupChildBlur_);\n                elem.addEventListener('keydown', this.onPopupChildKeydown_);\n            });\n            this.pickerC_ = padC;\n            this.textC_ = new PointNdTextController(doc, {\n                assembly: Point2dAssembly,\n                axes: config.axes,\n                parser: config.parser,\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            this.view = new Point2dView(doc, {\n                expanded: this.foldable_.value('expanded'),\n                pickerLayout: config.pickerLayout,\n                viewProps: this.viewProps,\n            });\n            this.view.textElement.appendChild(this.textC_.view.element);\n            (_a = this.view.buttonElement) === null || _a === void 0 ? void 0 : _a.addEventListener('blur', this.onPadButtonBlur_);\n            (_b = this.view.buttonElement) === null || _b === void 0 ? void 0 : _b.addEventListener('click', this.onPadButtonClick_);\n            if (this.popC_) {\n                this.view.element.appendChild(this.popC_.view.element);\n                this.popC_.view.element.appendChild(this.pickerC_.view.element);\n                connectValues({\n                    primary: this.foldable_.value('expanded'),\n                    secondary: this.popC_.shows,\n                    forward: (p) => p.rawValue,\n                    backward: (_, s) => s.rawValue,\n                });\n            }\n            else if (this.view.pickerElement) {\n                this.view.pickerElement.appendChild(this.pickerC_.view.element);\n                bindFoldable(this.foldable_, this.view.pickerElement);\n            }\n        }\n        onPadButtonBlur_(e) {\n            if (!this.popC_) {\n                return;\n            }\n            const elem = this.view.element;\n            const nextTarget = forceCast(e.relatedTarget);\n            if (!nextTarget || !elem.contains(nextTarget)) {\n                this.popC_.shows.rawValue = false;\n            }\n        }\n        onPadButtonClick_() {\n            this.foldable_.set('expanded', !this.foldable_.get('expanded'));\n            if (this.foldable_.get('expanded')) {\n                this.pickerC_.view.allFocusableElements[0].focus();\n            }\n        }\n        onPopupChildBlur_(ev) {\n            if (!this.popC_) {\n                return;\n            }\n            const elem = this.popC_.view.element;\n            const nextTarget = findNextTarget(ev);\n            if (nextTarget && elem.contains(nextTarget)) {\n                return;\n            }\n            if (nextTarget &&\n                nextTarget === this.view.buttonElement &&\n                !supportsTouch(elem.ownerDocument)) {\n                return;\n            }\n            this.popC_.shows.rawValue = false;\n        }\n        onPopupChildKeydown_(ev) {\n            if (this.popC_) {\n                if (ev.key === 'Escape') {\n                    this.popC_.shows.rawValue = false;\n                }\n            }\n            else if (this.view.pickerElement) {\n                if (ev.key === 'Escape') {\n                    this.view.buttonElement.focus();\n                }\n            }\n        }\n    }\n\n    class Point3d {\n        constructor(x = 0, y = 0, z = 0) {\n            this.x = x;\n            this.y = y;\n            this.z = z;\n        }\n        getComponents() {\n            return [this.x, this.y, this.z];\n        }\n        static isObject(obj) {\n            if (isEmpty(obj)) {\n                return false;\n            }\n            const x = obj.x;\n            const y = obj.y;\n            const z = obj.z;\n            if (typeof x !== 'number' ||\n                typeof y !== 'number' ||\n                typeof z !== 'number') {\n                return false;\n            }\n            return true;\n        }\n        static equals(v1, v2) {\n            return v1.x === v2.x && v1.y === v2.y && v1.z === v2.z;\n        }\n        toObject() {\n            return {\n                x: this.x,\n                y: this.y,\n                z: this.z,\n            };\n        }\n    }\n    const Point3dAssembly = {\n        toComponents: (p) => p.getComponents(),\n        fromComponents: (comps) => new Point3d(...comps),\n    };\n\n    function point3dFromUnknown(value) {\n        return Point3d.isObject(value)\n            ? new Point3d(value.x, value.y, value.z)\n            : new Point3d();\n    }\n    function writePoint3d(target, value) {\n        target.writeProperty('x', value.x);\n        target.writeProperty('y', value.y);\n        target.writeProperty('z', value.z);\n    }\n\n    function createConstraint$3(params, initialValue) {\n        return new PointNdConstraint({\n            assembly: Point3dAssembly,\n            components: [\n                createDimensionConstraint('x' in params ? params.x : undefined, initialValue.x),\n                createDimensionConstraint('y' in params ? params.y : undefined, initialValue.y),\n                createDimensionConstraint('z' in params ? params.z : undefined, initialValue.z),\n            ],\n        });\n    }\n    function createAxis$2(initialValue, constraint) {\n        return {\n            baseStep: getBaseStep(constraint),\n            constraint: constraint,\n            textProps: ValueMap.fromObject({\n                draggingScale: getSuitableDraggingScale(constraint, initialValue),\n                formatter: createNumberFormatter(getSuitableDecimalDigits(constraint, initialValue)),\n            }),\n        };\n    }\n    const Point3dInputPlugin = {\n        id: 'input-point3d',\n        type: 'input',\n        accept: (value, params) => {\n            if (!Point3d.isObject(value)) {\n                return null;\n            }\n            const p = ParamsParsers;\n            const result = parseParams(params, {\n                x: p.optional.custom(parsePointDimensionParams),\n                y: p.optional.custom(parsePointDimensionParams),\n                z: p.optional.custom(parsePointDimensionParams),\n            });\n            return result\n                ? {\n                    initialValue: value,\n                    params: result,\n                }\n                : null;\n        },\n        binding: {\n            reader: (_args) => point3dFromUnknown,\n            constraint: (args) => createConstraint$3(args.params, args.initialValue),\n            equals: Point3d.equals,\n            writer: (_args) => writePoint3d,\n        },\n        controller: (args) => {\n            const value = args.value;\n            const c = args.constraint;\n            if (!(c instanceof PointNdConstraint)) {\n                throw TpError.shouldNeverHappen();\n            }\n            return new PointNdTextController(args.document, {\n                assembly: Point3dAssembly,\n                axes: [\n                    createAxis$2(value.rawValue.x, c.components[0]),\n                    createAxis$2(value.rawValue.y, c.components[1]),\n                    createAxis$2(value.rawValue.z, c.components[2]),\n                ],\n                parser: parseNumber,\n                value: value,\n                viewProps: args.viewProps,\n            });\n        },\n    };\n\n    class Point4d {\n        constructor(x = 0, y = 0, z = 0, w = 0) {\n            this.x = x;\n            this.y = y;\n            this.z = z;\n            this.w = w;\n        }\n        getComponents() {\n            return [this.x, this.y, this.z, this.w];\n        }\n        static isObject(obj) {\n            if (isEmpty(obj)) {\n                return false;\n            }\n            const x = obj.x;\n            const y = obj.y;\n            const z = obj.z;\n            const w = obj.w;\n            if (typeof x !== 'number' ||\n                typeof y !== 'number' ||\n                typeof z !== 'number' ||\n                typeof w !== 'number') {\n                return false;\n            }\n            return true;\n        }\n        static equals(v1, v2) {\n            return v1.x === v2.x && v1.y === v2.y && v1.z === v2.z && v1.w === v2.w;\n        }\n        toObject() {\n            return {\n                x: this.x,\n                y: this.y,\n                z: this.z,\n                w: this.w,\n            };\n        }\n    }\n    const Point4dAssembly = {\n        toComponents: (p) => p.getComponents(),\n        fromComponents: (comps) => new Point4d(...comps),\n    };\n\n    function point4dFromUnknown(value) {\n        return Point4d.isObject(value)\n            ? new Point4d(value.x, value.y, value.z, value.w)\n            : new Point4d();\n    }\n    function writePoint4d(target, value) {\n        target.writeProperty('x', value.x);\n        target.writeProperty('y', value.y);\n        target.writeProperty('z', value.z);\n        target.writeProperty('w', value.w);\n    }\n\n    function createConstraint$2(params, initialValue) {\n        return new PointNdConstraint({\n            assembly: Point4dAssembly,\n            components: [\n                createDimensionConstraint('x' in params ? params.x : undefined, initialValue.x),\n                createDimensionConstraint('y' in params ? params.y : undefined, initialValue.y),\n                createDimensionConstraint('z' in params ? params.z : undefined, initialValue.z),\n                createDimensionConstraint('w' in params ? params.w : undefined, initialValue.w),\n            ],\n        });\n    }\n    function createAxis$1(initialValue, constraint) {\n        return {\n            baseStep: getBaseStep(constraint),\n            constraint: constraint,\n            textProps: ValueMap.fromObject({\n                draggingScale: getSuitableDraggingScale(constraint, initialValue),\n                formatter: createNumberFormatter(getSuitableDecimalDigits(constraint, initialValue)),\n            }),\n        };\n    }\n    const Point4dInputPlugin = {\n        id: 'input-point4d',\n        type: 'input',\n        accept: (value, params) => {\n            if (!Point4d.isObject(value)) {\n                return null;\n            }\n            const p = ParamsParsers;\n            const result = parseParams(params, {\n                x: p.optional.custom(parsePointDimensionParams),\n                y: p.optional.custom(parsePointDimensionParams),\n                z: p.optional.custom(parsePointDimensionParams),\n                w: p.optional.custom(parsePointDimensionParams),\n            });\n            return result\n                ? {\n                    initialValue: value,\n                    params: result,\n                }\n                : null;\n        },\n        binding: {\n            reader: (_args) => point4dFromUnknown,\n            constraint: (args) => createConstraint$2(args.params, args.initialValue),\n            equals: Point4d.equals,\n            writer: (_args) => writePoint4d,\n        },\n        controller: (args) => {\n            const value = args.value;\n            const c = args.constraint;\n            if (!(c instanceof PointNdConstraint)) {\n                throw TpError.shouldNeverHappen();\n            }\n            return new PointNdTextController(args.document, {\n                assembly: Point4dAssembly,\n                axes: value.rawValue\n                    .getComponents()\n                    .map((comp, index) => createAxis$1(comp, c.components[index])),\n                parser: parseNumber,\n                value: value,\n                viewProps: args.viewProps,\n            });\n        },\n    };\n\n    function createConstraint$1(params) {\n        const constraints = [];\n        const lc = createListConstraint(params.options);\n        if (lc) {\n            constraints.push(lc);\n        }\n        return new CompositeConstraint(constraints);\n    }\n    const StringInputPlugin = {\n        id: 'input-string',\n        type: 'input',\n        accept: (value, params) => {\n            if (typeof value !== 'string') {\n                return null;\n            }\n            const p = ParamsParsers;\n            const result = parseParams(params, {\n                options: p.optional.custom(parseListOptions),\n            });\n            return result\n                ? {\n                    initialValue: value,\n                    params: result,\n                }\n                : null;\n        },\n        binding: {\n            reader: (_args) => stringFromUnknown,\n            constraint: (args) => createConstraint$1(args.params),\n            writer: (_args) => writePrimitive,\n        },\n        controller: (args) => {\n            const doc = args.document;\n            const value = args.value;\n            const c = args.constraint;\n            const lc = c && findConstraint(c, ListConstraint);\n            if (lc) {\n                return new ListController(doc, {\n                    props: new ValueMap({\n                        options: lc.values.value('options'),\n                    }),\n                    value: value,\n                    viewProps: args.viewProps,\n                });\n            }\n            return new TextController(doc, {\n                parser: (v) => v,\n                props: ValueMap.fromObject({\n                    formatter: formatString,\n                }),\n                value: value,\n                viewProps: args.viewProps,\n            });\n        },\n    };\n\n    const Constants = {\n        monitor: {\n            defaultInterval: 200,\n            defaultLineCount: 3,\n        },\n    };\n\n    const className$2 = ClassName('mll');\n    class MultiLogView {\n        constructor(doc, config) {\n            this.onValueUpdate_ = this.onValueUpdate_.bind(this);\n            this.formatter_ = config.formatter;\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$2());\n            config.viewProps.bindClassModifiers(this.element);\n            const textareaElem = doc.createElement('textarea');\n            textareaElem.classList.add(className$2('i'));\n            textareaElem.style.height = `calc(var(--bld-us) * ${config.lineCount})`;\n            textareaElem.readOnly = true;\n            config.viewProps.bindDisabled(textareaElem);\n            this.element.appendChild(textareaElem);\n            this.textareaElem_ = textareaElem;\n            config.value.emitter.on('change', this.onValueUpdate_);\n            this.value = config.value;\n            this.update_();\n        }\n        update_() {\n            const elem = this.textareaElem_;\n            const shouldScroll = elem.scrollTop === elem.scrollHeight - elem.clientHeight;\n            const lines = [];\n            this.value.rawValue.forEach((value) => {\n                if (value !== undefined) {\n                    lines.push(this.formatter_(value));\n                }\n            });\n            elem.textContent = lines.join('\\n');\n            if (shouldScroll) {\n                elem.scrollTop = elem.scrollHeight;\n            }\n        }\n        onValueUpdate_() {\n            this.update_();\n        }\n    }\n\n    class MultiLogController {\n        constructor(doc, config) {\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.view = new MultiLogView(doc, {\n                formatter: config.formatter,\n                lineCount: config.lineCount,\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n        }\n    }\n\n    const className$1 = ClassName('sgl');\n    class SingleLogView {\n        constructor(doc, config) {\n            this.onValueUpdate_ = this.onValueUpdate_.bind(this);\n            this.formatter_ = config.formatter;\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$1());\n            config.viewProps.bindClassModifiers(this.element);\n            const inputElem = doc.createElement('input');\n            inputElem.classList.add(className$1('i'));\n            inputElem.readOnly = true;\n            inputElem.type = 'text';\n            config.viewProps.bindDisabled(inputElem);\n            this.element.appendChild(inputElem);\n            this.inputElement = inputElem;\n            config.value.emitter.on('change', this.onValueUpdate_);\n            this.value = config.value;\n            this.update_();\n        }\n        update_() {\n            const values = this.value.rawValue;\n            const lastValue = values[values.length - 1];\n            this.inputElement.value =\n                lastValue !== undefined ? this.formatter_(lastValue) : '';\n        }\n        onValueUpdate_() {\n            this.update_();\n        }\n    }\n\n    class SingleLogController {\n        constructor(doc, config) {\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.view = new SingleLogView(doc, {\n                formatter: config.formatter,\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n        }\n    }\n\n    const BooleanMonitorPlugin = {\n        id: 'monitor-bool',\n        type: 'monitor',\n        accept: (value, params) => {\n            if (typeof value !== 'boolean') {\n                return null;\n            }\n            const p = ParamsParsers;\n            const result = parseParams(params, {\n                lineCount: p.optional.number,\n            });\n            return result\n                ? {\n                    initialValue: value,\n                    params: result,\n                }\n                : null;\n        },\n        binding: {\n            reader: (_args) => boolFromUnknown,\n        },\n        controller: (args) => {\n            var _a;\n            if (args.value.rawValue.length === 1) {\n                return new SingleLogController(args.document, {\n                    formatter: BooleanFormatter,\n                    value: args.value,\n                    viewProps: args.viewProps,\n                });\n            }\n            return new MultiLogController(args.document, {\n                formatter: BooleanFormatter,\n                lineCount: (_a = args.params.lineCount) !== null && _a !== void 0 ? _a : Constants.monitor.defaultLineCount,\n                value: args.value,\n                viewProps: args.viewProps,\n            });\n        },\n    };\n\n    const className = ClassName('grl');\n    class GraphLogView {\n        constructor(doc, config) {\n            this.onCursorChange_ = this.onCursorChange_.bind(this);\n            this.onValueUpdate_ = this.onValueUpdate_.bind(this);\n            this.element = doc.createElement('div');\n            this.element.classList.add(className());\n            config.viewProps.bindClassModifiers(this.element);\n            this.formatter_ = config.formatter;\n            this.props_ = config.props;\n            this.cursor_ = config.cursor;\n            this.cursor_.emitter.on('change', this.onCursorChange_);\n            const svgElem = doc.createElementNS(SVG_NS, 'svg');\n            svgElem.classList.add(className('g'));\n            svgElem.style.height = `calc(var(--bld-us) * ${config.lineCount})`;\n            this.element.appendChild(svgElem);\n            this.svgElem_ = svgElem;\n            const lineElem = doc.createElementNS(SVG_NS, 'polyline');\n            this.svgElem_.appendChild(lineElem);\n            this.lineElem_ = lineElem;\n            const tooltipElem = doc.createElement('div');\n            tooltipElem.classList.add(className('t'), ClassName('tt')());\n            this.element.appendChild(tooltipElem);\n            this.tooltipElem_ = tooltipElem;\n            config.value.emitter.on('change', this.onValueUpdate_);\n            this.value = config.value;\n            this.update_();\n        }\n        get graphElement() {\n            return this.svgElem_;\n        }\n        update_() {\n            const bounds = this.svgElem_.getBoundingClientRect();\n            const maxIndex = this.value.rawValue.length - 1;\n            const min = this.props_.get('minValue');\n            const max = this.props_.get('maxValue');\n            const points = [];\n            this.value.rawValue.forEach((v, index) => {\n                if (v === undefined) {\n                    return;\n                }\n                const x = mapRange(index, 0, maxIndex, 0, bounds.width);\n                const y = mapRange(v, min, max, bounds.height, 0);\n                points.push([x, y].join(','));\n            });\n            this.lineElem_.setAttributeNS(null, 'points', points.join(' '));\n            const tooltipElem = this.tooltipElem_;\n            const value = this.value.rawValue[this.cursor_.rawValue];\n            if (value === undefined) {\n                tooltipElem.classList.remove(className('t', 'a'));\n                return;\n            }\n            const tx = mapRange(this.cursor_.rawValue, 0, maxIndex, 0, bounds.width);\n            const ty = mapRange(value, min, max, bounds.height, 0);\n            tooltipElem.style.left = `${tx}px`;\n            tooltipElem.style.top = `${ty}px`;\n            tooltipElem.textContent = `${this.formatter_(value)}`;\n            if (!tooltipElem.classList.contains(className('t', 'a'))) {\n                tooltipElem.classList.add(className('t', 'a'), className('t', 'in'));\n                forceReflow(tooltipElem);\n                tooltipElem.classList.remove(className('t', 'in'));\n            }\n        }\n        onValueUpdate_() {\n            this.update_();\n        }\n        onCursorChange_() {\n            this.update_();\n        }\n    }\n\n    class GraphLogController {\n        constructor(doc, config) {\n            this.onGraphMouseMove_ = this.onGraphMouseMove_.bind(this);\n            this.onGraphMouseLeave_ = this.onGraphMouseLeave_.bind(this);\n            this.onGraphPointerDown_ = this.onGraphPointerDown_.bind(this);\n            this.onGraphPointerMove_ = this.onGraphPointerMove_.bind(this);\n            this.onGraphPointerUp_ = this.onGraphPointerUp_.bind(this);\n            this.props_ = config.props;\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.cursor_ = createValue(-1);\n            this.view = new GraphLogView(doc, {\n                cursor: this.cursor_,\n                formatter: config.formatter,\n                lineCount: config.lineCount,\n                props: this.props_,\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            if (!supportsTouch(doc)) {\n                this.view.element.addEventListener('mousemove', this.onGraphMouseMove_);\n                this.view.element.addEventListener('mouseleave', this.onGraphMouseLeave_);\n            }\n            else {\n                const ph = new PointerHandler(this.view.element);\n                ph.emitter.on('down', this.onGraphPointerDown_);\n                ph.emitter.on('move', this.onGraphPointerMove_);\n                ph.emitter.on('up', this.onGraphPointerUp_);\n            }\n        }\n        onGraphMouseLeave_() {\n            this.cursor_.rawValue = -1;\n        }\n        onGraphMouseMove_(ev) {\n            const bounds = this.view.element.getBoundingClientRect();\n            this.cursor_.rawValue = Math.floor(mapRange(ev.offsetX, 0, bounds.width, 0, this.value.rawValue.length));\n        }\n        onGraphPointerDown_(ev) {\n            this.onGraphPointerMove_(ev);\n        }\n        onGraphPointerMove_(ev) {\n            if (!ev.data.point) {\n                this.cursor_.rawValue = -1;\n                return;\n            }\n            this.cursor_.rawValue = Math.floor(mapRange(ev.data.point.x, 0, ev.data.bounds.width, 0, this.value.rawValue.length));\n        }\n        onGraphPointerUp_() {\n            this.cursor_.rawValue = -1;\n        }\n    }\n\n    function createFormatter(params) {\n        return 'format' in params && !isEmpty(params.format)\n            ? params.format\n            : createNumberFormatter(2);\n    }\n    function createTextMonitor(args) {\n        var _a;\n        if (args.value.rawValue.length === 1) {\n            return new SingleLogController(args.document, {\n                formatter: createFormatter(args.params),\n                value: args.value,\n                viewProps: args.viewProps,\n            });\n        }\n        return new MultiLogController(args.document, {\n            formatter: createFormatter(args.params),\n            lineCount: (_a = args.params.lineCount) !== null && _a !== void 0 ? _a : Constants.monitor.defaultLineCount,\n            value: args.value,\n            viewProps: args.viewProps,\n        });\n    }\n    function createGraphMonitor(args) {\n        var _a, _b, _c;\n        return new GraphLogController(args.document, {\n            formatter: createFormatter(args.params),\n            lineCount: (_a = args.params.lineCount) !== null && _a !== void 0 ? _a : Constants.monitor.defaultLineCount,\n            props: ValueMap.fromObject({\n                maxValue: (_b = ('max' in args.params ? args.params.max : null)) !== null && _b !== void 0 ? _b : 100,\n                minValue: (_c = ('min' in args.params ? args.params.min : null)) !== null && _c !== void 0 ? _c : 0,\n            }),\n            value: args.value,\n            viewProps: args.viewProps,\n        });\n    }\n    function shouldShowGraph(params) {\n        return 'view' in params && params.view === 'graph';\n    }\n    const NumberMonitorPlugin = {\n        id: 'monitor-number',\n        type: 'monitor',\n        accept: (value, params) => {\n            if (typeof value !== 'number') {\n                return null;\n            }\n            const p = ParamsParsers;\n            const result = parseParams(params, {\n                format: p.optional.function,\n                lineCount: p.optional.number,\n                max: p.optional.number,\n                min: p.optional.number,\n                view: p.optional.string,\n            });\n            return result\n                ? {\n                    initialValue: value,\n                    params: result,\n                }\n                : null;\n        },\n        binding: {\n            defaultBufferSize: (params) => (shouldShowGraph(params) ? 64 : 1),\n            reader: (_args) => numberFromUnknown,\n        },\n        controller: (args) => {\n            if (shouldShowGraph(args.params)) {\n                return createGraphMonitor(args);\n            }\n            return createTextMonitor(args);\n        },\n    };\n\n    const StringMonitorPlugin = {\n        id: 'monitor-string',\n        type: 'monitor',\n        accept: (value, params) => {\n            if (typeof value !== 'string') {\n                return null;\n            }\n            const p = ParamsParsers;\n            const result = parseParams(params, {\n                lineCount: p.optional.number,\n                multiline: p.optional.boolean,\n            });\n            return result\n                ? {\n                    initialValue: value,\n                    params: result,\n                }\n                : null;\n        },\n        binding: {\n            reader: (_args) => stringFromUnknown,\n        },\n        controller: (args) => {\n            var _a;\n            const value = args.value;\n            const multiline = value.rawValue.length > 1 ||\n                ('multiline' in args.params && args.params.multiline);\n            if (multiline) {\n                return new MultiLogController(args.document, {\n                    formatter: formatString,\n                    lineCount: (_a = args.params.lineCount) !== null && _a !== void 0 ? _a : Constants.monitor.defaultLineCount,\n                    value: value,\n                    viewProps: args.viewProps,\n                });\n            }\n            return new SingleLogController(args.document, {\n                formatter: formatString,\n                value: value,\n                viewProps: args.viewProps,\n            });\n        },\n    };\n\n    function createInputBindingController(plugin, args) {\n        var _a;\n        const result = plugin.accept(args.target.read(), args.params);\n        if (isEmpty(result)) {\n            return null;\n        }\n        const p = ParamsParsers;\n        const valueArgs = {\n            target: args.target,\n            initialValue: result.initialValue,\n            params: result.params,\n        };\n        const reader = plugin.binding.reader(valueArgs);\n        const constraint = plugin.binding.constraint\n            ? plugin.binding.constraint(valueArgs)\n            : undefined;\n        const value = createValue(reader(result.initialValue), {\n            constraint: constraint,\n            equals: plugin.binding.equals,\n        });\n        const binding = new InputBinding({\n            reader: reader,\n            target: args.target,\n            value: value,\n            writer: plugin.binding.writer(valueArgs),\n        });\n        const disabled = p.optional.boolean(args.params.disabled).value;\n        const hidden = p.optional.boolean(args.params.hidden).value;\n        const controller = plugin.controller({\n            constraint: constraint,\n            document: args.document,\n            initialValue: result.initialValue,\n            params: result.params,\n            value: binding.value,\n            viewProps: ViewProps.create({\n                disabled: disabled,\n                hidden: hidden,\n            }),\n        });\n        return new InputBindingController(args.document, {\n            binding: binding,\n            blade: createBlade(),\n            props: ValueMap.fromObject({\n                label: 'label' in args.params\n                    ? (_a = p.optional.string(args.params.label).value) !== null && _a !== void 0 ? _a : null\n                    : args.target.key,\n            }),\n            valueController: controller,\n        });\n    }\n\n    function createTicker(document, interval) {\n        return interval === 0\n            ? new ManualTicker()\n            : new IntervalTicker(document, interval !== null && interval !== void 0 ? interval : Constants.monitor.defaultInterval);\n    }\n    function createMonitorBindingController(plugin, args) {\n        var _a, _b, _c;\n        const p = ParamsParsers;\n        const result = plugin.accept(args.target.read(), args.params);\n        if (isEmpty(result)) {\n            return null;\n        }\n        const bindingArgs = {\n            target: args.target,\n            initialValue: result.initialValue,\n            params: result.params,\n        };\n        const reader = plugin.binding.reader(bindingArgs);\n        const bufferSize = (_b = (_a = p.optional.number(args.params.bufferSize).value) !== null && _a !== void 0 ? _a : (plugin.binding.defaultBufferSize &&\n            plugin.binding.defaultBufferSize(result.params))) !== null && _b !== void 0 ? _b : 1;\n        const interval = p.optional.number(args.params.interval).value;\n        const binding = new MonitorBinding({\n            reader: reader,\n            target: args.target,\n            ticker: createTicker(args.document, interval),\n            value: initializeBuffer(bufferSize),\n        });\n        const disabled = p.optional.boolean(args.params.disabled).value;\n        const hidden = p.optional.boolean(args.params.hidden).value;\n        const controller = plugin.controller({\n            document: args.document,\n            params: result.params,\n            value: binding.value,\n            viewProps: ViewProps.create({\n                disabled: disabled,\n                hidden: hidden,\n            }),\n        });\n        return new MonitorBindingController(args.document, {\n            binding: binding,\n            blade: createBlade(),\n            props: ValueMap.fromObject({\n                label: 'label' in args.params\n                    ? (_c = p.optional.string(args.params.label).value) !== null && _c !== void 0 ? _c : null\n                    : args.target.key,\n            }),\n            valueController: controller,\n        });\n    }\n\n    class PluginPool {\n        constructor() {\n            this.pluginsMap_ = {\n                blades: [],\n                inputs: [],\n                monitors: [],\n            };\n        }\n        getAll() {\n            return [\n                ...this.pluginsMap_.blades,\n                ...this.pluginsMap_.inputs,\n                ...this.pluginsMap_.monitors,\n            ];\n        }\n        register(r) {\n            if (r.type === 'blade') {\n                this.pluginsMap_.blades.unshift(r);\n            }\n            else if (r.type === 'input') {\n                this.pluginsMap_.inputs.unshift(r);\n            }\n            else if (r.type === 'monitor') {\n                this.pluginsMap_.monitors.unshift(r);\n            }\n        }\n        createInput(document, target, params) {\n            const initialValue = target.read();\n            if (isEmpty(initialValue)) {\n                throw new TpError({\n                    context: {\n                        key: target.key,\n                    },\n                    type: 'nomatchingcontroller',\n                });\n            }\n            const bc = this.pluginsMap_.inputs.reduce((result, plugin) => result !== null && result !== void 0 ? result : createInputBindingController(plugin, {\n                document: document,\n                target: target,\n                params: params,\n            }), null);\n            if (bc) {\n                return bc;\n            }\n            throw new TpError({\n                context: {\n                    key: target.key,\n                },\n                type: 'nomatchingcontroller',\n            });\n        }\n        createMonitor(document, target, params) {\n            const bc = this.pluginsMap_.monitors.reduce((result, plugin) => result !== null && result !== void 0 ? result : createMonitorBindingController(plugin, {\n                document: document,\n                params: params,\n                target: target,\n            }), null);\n            if (bc) {\n                return bc;\n            }\n            throw new TpError({\n                context: {\n                    key: target.key,\n                },\n                type: 'nomatchingcontroller',\n            });\n        }\n        createBlade(document, params) {\n            const bc = this.pluginsMap_.blades.reduce((result, plugin) => result !== null && result !== void 0 ? result : createBladeController(plugin, {\n                document: document,\n                params: params,\n            }), null);\n            if (!bc) {\n                throw new TpError({\n                    type: 'nomatchingview',\n                    context: {\n                        params: params,\n                    },\n                });\n            }\n            return bc;\n        }\n        createBladeApi(bc) {\n            if (bc instanceof InputBindingController) {\n                return new InputBindingApi(bc);\n            }\n            if (bc instanceof MonitorBindingController) {\n                return new MonitorBindingApi(bc);\n            }\n            if (bc instanceof RackController) {\n                return new RackApi(bc, this);\n            }\n            const api = this.pluginsMap_.blades.reduce((result, plugin) => result !== null && result !== void 0 ? result : plugin.api({\n                controller: bc,\n                pool: this,\n            }), null);\n            if (!api) {\n                throw TpError.shouldNeverHappen();\n            }\n            return api;\n        }\n    }\n\n    function createDefaultPluginPool() {\n        const pool = new PluginPool();\n        [\n            Point2dInputPlugin,\n            Point3dInputPlugin,\n            Point4dInputPlugin,\n            StringInputPlugin,\n            NumberInputPlugin,\n            StringColorInputPlugin,\n            ObjectColorInputPlugin,\n            NumberColorInputPlugin,\n            BooleanInputPlugin,\n            BooleanMonitorPlugin,\n            StringMonitorPlugin,\n            NumberMonitorPlugin,\n            ButtonBladePlugin,\n            FolderBladePlugin,\n            SeparatorBladePlugin,\n            TabBladePlugin,\n        ].forEach((p) => {\n            pool.register(p);\n        });\n        return pool;\n    }\n\n    function point2dFromUnknown(value) {\n        return Point2d.isObject(value)\n            ? new Point2d(value.x, value.y)\n            : new Point2d();\n    }\n    function writePoint2d(target, value) {\n        target.writeProperty('x', value.x);\n        target.writeProperty('y', value.y);\n    }\n\n    function createDimensionConstraint(params, initialValue) {\n        if (!params) {\n            return undefined;\n        }\n        const constraints = [];\n        const cs = createStepConstraint(params, initialValue);\n        if (cs) {\n            constraints.push(cs);\n        }\n        const rs = createRangeConstraint(params);\n        if (rs) {\n            constraints.push(rs);\n        }\n        return new CompositeConstraint(constraints);\n    }\n    function createConstraint(params, initialValue) {\n        return new PointNdConstraint({\n            assembly: Point2dAssembly,\n            components: [\n                createDimensionConstraint('x' in params ? params.x : undefined, initialValue.x),\n                createDimensionConstraint('y' in params ? params.y : undefined, initialValue.y),\n            ],\n        });\n    }\n    function getSuitableMaxDimensionValue(constraint, rawValue) {\n        const [min, max] = constraint ? findNumberRange(constraint) : [];\n        if (!isEmpty(min) || !isEmpty(max)) {\n            return Math.max(Math.abs(min !== null && min !== void 0 ? min : 0), Math.abs(max !== null && max !== void 0 ? max : 0));\n        }\n        const step = getBaseStep(constraint);\n        return Math.max(Math.abs(step) * 10, Math.abs(rawValue) * 10);\n    }\n    function getSuitableMaxValue(initialValue, constraint) {\n        const xc = constraint instanceof PointNdConstraint\n            ? constraint.components[0]\n            : undefined;\n        const yc = constraint instanceof PointNdConstraint\n            ? constraint.components[1]\n            : undefined;\n        const xr = getSuitableMaxDimensionValue(xc, initialValue.x);\n        const yr = getSuitableMaxDimensionValue(yc, initialValue.y);\n        return Math.max(xr, yr);\n    }\n    function createAxis(initialValue, constraint) {\n        return {\n            baseStep: getBaseStep(constraint),\n            constraint: constraint,\n            textProps: ValueMap.fromObject({\n                draggingScale: getSuitableDraggingScale(constraint, initialValue),\n                formatter: createNumberFormatter(getSuitableDecimalDigits(constraint, initialValue)),\n            }),\n        };\n    }\n    function shouldInvertY(params) {\n        if (!('y' in params)) {\n            return false;\n        }\n        const yParams = params.y;\n        if (!yParams) {\n            return false;\n        }\n        return 'inverted' in yParams ? !!yParams.inverted : false;\n    }\n    const Point2dInputPlugin = {\n        id: 'input-point2d',\n        type: 'input',\n        accept: (value, params) => {\n            if (!Point2d.isObject(value)) {\n                return null;\n            }\n            const p = ParamsParsers;\n            const result = parseParams(params, {\n                expanded: p.optional.boolean,\n                picker: p.optional.custom(parsePickerLayout),\n                x: p.optional.custom(parsePointDimensionParams),\n                y: p.optional.object({\n                    inverted: p.optional.boolean,\n                    max: p.optional.number,\n                    min: p.optional.number,\n                    step: p.optional.number,\n                }),\n            });\n            return result\n                ? {\n                    initialValue: value,\n                    params: result,\n                }\n                : null;\n        },\n        binding: {\n            reader: (_args) => point2dFromUnknown,\n            constraint: (args) => createConstraint(args.params, args.initialValue),\n            equals: Point2d.equals,\n            writer: (_args) => writePoint2d,\n        },\n        controller: (args) => {\n            const doc = args.document;\n            const value = args.value;\n            const c = args.constraint;\n            if (!(c instanceof PointNdConstraint)) {\n                throw TpError.shouldNeverHappen();\n            }\n            const expanded = 'expanded' in args.params ? args.params.expanded : undefined;\n            const picker = 'picker' in args.params ? args.params.picker : undefined;\n            return new Point2dController(doc, {\n                axes: [\n                    createAxis(value.rawValue.x, c.components[0]),\n                    createAxis(value.rawValue.y, c.components[1]),\n                ],\n                expanded: expanded !== null && expanded !== void 0 ? expanded : false,\n                invertsY: shouldInvertY(args.params),\n                maxValue: getSuitableMaxValue(value.rawValue, c),\n                parser: parseNumber,\n                pickerLayout: picker !== null && picker !== void 0 ? picker : 'popup',\n                value: value,\n                viewProps: args.viewProps,\n            });\n        },\n    };\n\n    class ListApi extends BladeApi {\n        constructor(controller) {\n            super(controller);\n            this.emitter_ = new Emitter();\n            this.controller_.valueController.value.emitter.on('change', (ev) => {\n                this.emitter_.emit('change', {\n                    event: new TpChangeEvent(this, ev.rawValue),\n                });\n            });\n        }\n        get label() {\n            return this.controller_.props.get('label');\n        }\n        set label(label) {\n            this.controller_.props.set('label', label);\n        }\n        get options() {\n            return this.controller_.valueController.props.get('options');\n        }\n        set options(options) {\n            this.controller_.valueController.props.set('options', options);\n        }\n        get value() {\n            return this.controller_.valueController.value.rawValue;\n        }\n        set value(value) {\n            this.controller_.valueController.value.rawValue = value;\n        }\n        on(eventName, handler) {\n            const bh = handler.bind(this);\n            this.emitter_.on(eventName, (ev) => {\n                bh(ev.event);\n            });\n            return this;\n        }\n    }\n\n    class SliderApi extends BladeApi {\n        constructor(controller) {\n            super(controller);\n            this.emitter_ = new Emitter();\n            this.controller_.valueController.value.emitter.on('change', (ev) => {\n                this.emitter_.emit('change', {\n                    event: new TpChangeEvent(this, ev.rawValue),\n                });\n            });\n        }\n        get label() {\n            return this.controller_.props.get('label');\n        }\n        set label(label) {\n            this.controller_.props.set('label', label);\n        }\n        get maxValue() {\n            return this.controller_.valueController.sliderController.props.get('maxValue');\n        }\n        set maxValue(maxValue) {\n            this.controller_.valueController.sliderController.props.set('maxValue', maxValue);\n        }\n        get minValue() {\n            return this.controller_.valueController.sliderController.props.get('minValue');\n        }\n        set minValue(minValue) {\n            this.controller_.valueController.sliderController.props.set('minValue', minValue);\n        }\n        get value() {\n            return this.controller_.valueController.value.rawValue;\n        }\n        set value(value) {\n            this.controller_.valueController.value.rawValue = value;\n        }\n        on(eventName, handler) {\n            const bh = handler.bind(this);\n            this.emitter_.on(eventName, (ev) => {\n                bh(ev.event);\n            });\n            return this;\n        }\n    }\n\n    class TextApi extends BladeApi {\n        constructor(controller) {\n            super(controller);\n            this.emitter_ = new Emitter();\n            this.controller_.valueController.value.emitter.on('change', (ev) => {\n                this.emitter_.emit('change', {\n                    event: new TpChangeEvent(this, ev.rawValue),\n                });\n            });\n        }\n        get label() {\n            return this.controller_.props.get('label');\n        }\n        set label(label) {\n            this.controller_.props.set('label', label);\n        }\n        get formatter() {\n            return this.controller_.valueController.props.get('formatter');\n        }\n        set formatter(formatter) {\n            this.controller_.valueController.props.set('formatter', formatter);\n        }\n        get value() {\n            return this.controller_.valueController.value.rawValue;\n        }\n        set value(value) {\n            this.controller_.valueController.value.rawValue = value;\n        }\n        on(eventName, handler) {\n            const bh = handler.bind(this);\n            this.emitter_.on(eventName, (ev) => {\n                bh(ev.event);\n            });\n            return this;\n        }\n    }\n\n    const ListBladePlugin = (function () {\n        return {\n            id: 'list',\n            type: 'blade',\n            accept(params) {\n                const p = ParamsParsers;\n                const result = parseParams(params, {\n                    options: p.required.custom(parseListOptions),\n                    value: p.required.raw,\n                    view: p.required.constant('list'),\n                    label: p.optional.string,\n                });\n                return result ? { params: result } : null;\n            },\n            controller(args) {\n                const lc = new ListConstraint(normalizeListOptions(args.params.options));\n                const value = createValue(args.params.value, {\n                    constraint: lc,\n                });\n                const ic = new ListController(args.document, {\n                    props: new ValueMap({\n                        options: lc.values.value('options'),\n                    }),\n                    value: value,\n                    viewProps: args.viewProps,\n                });\n                return new LabeledValueController(args.document, {\n                    blade: args.blade,\n                    props: ValueMap.fromObject({\n                        label: args.params.label,\n                    }),\n                    valueController: ic,\n                });\n            },\n            api(args) {\n                if (!(args.controller instanceof LabeledValueController)) {\n                    return null;\n                }\n                if (!(args.controller.valueController instanceof ListController)) {\n                    return null;\n                }\n                return new ListApi(args.controller);\n            },\n        };\n    })();\n\n    /**\n     * @hidden\n     */\n    function exportPresetJson(targets) {\n        return targets.reduce((result, target) => {\n            return Object.assign(result, {\n                [target.presetKey]: target.read(),\n            });\n        }, {});\n    }\n    /**\n     * @hidden\n     */\n    function importPresetJson(bindings, preset) {\n        bindings.forEach((binding) => {\n            const value = preset[binding.target.presetKey];\n            if (value !== undefined) {\n                binding.writer(binding.target, binding.reader(value));\n            }\n        });\n    }\n\n    class RootApi extends FolderApi {\n        /**\n         * @hidden\n         */\n        constructor(controller, pool) {\n            super(controller, pool);\n        }\n        get element() {\n            return this.controller_.view.element;\n        }\n        /**\n         * Imports a preset of all inputs.\n         * @param preset The preset object to import.\n         */\n        importPreset(preset) {\n            const bindings = this.controller_.rackController.rack\n                .find(InputBindingController)\n                .map((ibc) => {\n                return ibc.binding;\n            });\n            importPresetJson(bindings, preset);\n            this.refresh();\n        }\n        /**\n         * Exports a preset of all inputs.\n         * @return An exported preset object.\n         */\n        exportPreset() {\n            const targets = this.controller_.rackController.rack\n                .find(InputBindingController)\n                .map((ibc) => {\n                return ibc.binding.target;\n            });\n            return exportPresetJson(targets);\n        }\n        /**\n         * Refreshes all bindings of the pane.\n         */\n        refresh() {\n            // Force-read all input bindings\n            this.controller_.rackController.rack\n                .find(InputBindingController)\n                .forEach((ibc) => {\n                ibc.binding.read();\n            });\n            // Force-read all monitor bindings\n            this.controller_.rackController.rack\n                .find(MonitorBindingController)\n                .forEach((mbc) => {\n                mbc.binding.read();\n            });\n        }\n    }\n\n    class RootController extends FolderController {\n        constructor(doc, config) {\n            super(doc, {\n                expanded: config.expanded,\n                blade: config.blade,\n                props: config.props,\n                root: true,\n                viewProps: config.viewProps,\n            });\n        }\n    }\n\n    const SliderBladePlugin = {\n        id: 'slider',\n        type: 'blade',\n        accept(params) {\n            const p = ParamsParsers;\n            const result = parseParams(params, {\n                max: p.required.number,\n                min: p.required.number,\n                view: p.required.constant('slider'),\n                format: p.optional.function,\n                label: p.optional.string,\n                value: p.optional.number,\n            });\n            return result ? { params: result } : null;\n        },\n        controller(args) {\n            var _a, _b;\n            const initialValue = (_a = args.params.value) !== null && _a !== void 0 ? _a : 0;\n            const drc = new DefiniteRangeConstraint({\n                max: args.params.max,\n                min: args.params.min,\n            });\n            const vc = new SliderTextController(args.document, {\n                baseStep: 1,\n                parser: parseNumber,\n                sliderProps: new ValueMap({\n                    maxValue: drc.values.value('max'),\n                    minValue: drc.values.value('min'),\n                }),\n                textProps: ValueMap.fromObject({\n                    draggingScale: getSuitableDraggingScale(undefined, initialValue),\n                    formatter: (_b = args.params.format) !== null && _b !== void 0 ? _b : numberToString,\n                }),\n                value: createValue(initialValue, {\n                    constraint: drc,\n                }),\n                viewProps: args.viewProps,\n            });\n            return new LabeledValueController(args.document, {\n                blade: args.blade,\n                props: ValueMap.fromObject({\n                    label: args.params.label,\n                }),\n                valueController: vc,\n            });\n        },\n        api(args) {\n            if (!(args.controller instanceof LabeledValueController)) {\n                return null;\n            }\n            if (!(args.controller.valueController instanceof SliderTextController)) {\n                return null;\n            }\n            return new SliderApi(args.controller);\n        },\n    };\n\n    const TextBladePlugin = (function () {\n        return {\n            id: 'text',\n            type: 'blade',\n            accept(params) {\n                const p = ParamsParsers;\n                const result = parseParams(params, {\n                    parse: p.required.function,\n                    value: p.required.raw,\n                    view: p.required.constant('text'),\n                    format: p.optional.function,\n                    label: p.optional.string,\n                });\n                return result ? { params: result } : null;\n            },\n            controller(args) {\n                var _a;\n                const ic = new TextController(args.document, {\n                    parser: args.params.parse,\n                    props: ValueMap.fromObject({\n                        formatter: (_a = args.params.format) !== null && _a !== void 0 ? _a : ((v) => String(v)),\n                    }),\n                    value: createValue(args.params.value),\n                    viewProps: args.viewProps,\n                });\n                return new LabeledValueController(args.document, {\n                    blade: args.blade,\n                    props: ValueMap.fromObject({\n                        label: args.params.label,\n                    }),\n                    valueController: ic,\n                });\n            },\n            api(args) {\n                if (!(args.controller instanceof LabeledValueController)) {\n                    return null;\n                }\n                if (!(args.controller.valueController instanceof TextController)) {\n                    return null;\n                }\n                return new TextApi(args.controller);\n            },\n        };\n    })();\n\n    function createDefaultWrapperElement(doc) {\n        const elem = doc.createElement('div');\n        elem.classList.add(ClassName('dfw')());\n        if (doc.body) {\n            doc.body.appendChild(elem);\n        }\n        return elem;\n    }\n    function embedStyle(doc, id, css) {\n        if (doc.querySelector(`style[data-tp-style=${id}]`)) {\n            return;\n        }\n        const styleElem = doc.createElement('style');\n        styleElem.dataset.tpStyle = id;\n        styleElem.textContent = css;\n        doc.head.appendChild(styleElem);\n    }\n    /**\n     * The root pane of Tweakpane.\n     */\n    class Pane extends RootApi {\n        constructor(opt_config) {\n            var _a, _b;\n            const config = opt_config !== null && opt_config !== void 0 ? opt_config : {};\n            const doc = (_a = config.document) !== null && _a !== void 0 ? _a : getWindowDocument();\n            const pool = createDefaultPluginPool();\n            const rootController = new RootController(doc, {\n                expanded: config.expanded,\n                blade: createBlade(),\n                props: ValueMap.fromObject({\n                    title: config.title,\n                }),\n                viewProps: ViewProps.create(),\n            });\n            super(rootController, pool);\n            this.pool_ = pool;\n            this.containerElem_ = (_b = config.container) !== null && _b !== void 0 ? _b : createDefaultWrapperElement(doc);\n            this.containerElem_.appendChild(this.element);\n            this.doc_ = doc;\n            this.usesDefaultWrapper_ = !config.container;\n            this.setUpDefaultPlugins_();\n        }\n        get document() {\n            if (!this.doc_) {\n                throw TpError.alreadyDisposed();\n            }\n            return this.doc_;\n        }\n        dispose() {\n            const containerElem = this.containerElem_;\n            if (!containerElem) {\n                throw TpError.alreadyDisposed();\n            }\n            if (this.usesDefaultWrapper_) {\n                const parentElem = containerElem.parentElement;\n                if (parentElem) {\n                    parentElem.removeChild(containerElem);\n                }\n            }\n            this.containerElem_ = null;\n            this.doc_ = null;\n            super.dispose();\n        }\n        registerPlugin(bundle) {\n            const plugins = 'plugin' in bundle\n                ? [bundle.plugin]\n                : 'plugins' in bundle\n                    ? bundle.plugins\n                    : [];\n            plugins.forEach((p) => {\n                this.pool_.register(p);\n                this.embedPluginStyle_(p);\n            });\n        }\n        embedPluginStyle_(plugin) {\n            if (plugin.css) {\n                embedStyle(this.document, `plugin-${plugin.id}`, plugin.css);\n            }\n        }\n        setUpDefaultPlugins_() {\n            // NOTE: This string literal will be replaced with the default CSS by Rollup at the compilation time\n            embedStyle(this.document, 'default', '.tp-tbiv_b,.tp-coltxtv_ms,.tp-ckbv_i,.tp-rotv_b,.tp-fldv_b,.tp-mllv_i,.tp-sglv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-mllv_i,.tp-sglv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--mo-fg);height:var(--bld-us);scrollbar-color:currentColor rgba(0,0,0,0);scrollbar-width:thin;width:100%}.tp-mllv_i::-webkit-scrollbar,.tp-sglv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-mllv_i::-webkit-scrollbar-corner,.tp-sglv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:rgba(0,0,0,0)}.tp-mllv_i::-webkit-scrollbar-thumb,.tp-sglv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:rgba(0,0,0,0) solid 2px;border-radius:4px}.tp-rotv{--font-family: var(--tp-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-br: var(--tp-base-border-radius, 6px);--cnt-h-p: var(--tp-container-horizontal-padding, 4px);--cnt-v-p: var(--tp-container-vertical-padding, 4px);--elm-br: var(--tp-element-border-radius, 2px);--bld-s: var(--tp-blade-spacing, 4px);--bld-us: var(--tp-blade-unit-size, 20px);--bs-bg: var(--tp-base-background-color, hsl(230, 7%, 17%));--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--btn-bg: var(--tp-button-background-color, hsl(230, 7%, 70%));--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, hsl(230, 7%, 17%));--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, hsl(230, 7%, 75%));--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, hsl(230, 7%, 75%));--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tabv_c .tp-brkv>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-v-p))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tabv_c .tp-brkv>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--bld-s)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tabv_c .tp-brkv>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tabv_c .tp-brkv>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--elm-br);border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tabv_c .tp-brkv .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-cntv+.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-cntv+.tp-fldv>.tp-fldv_b{border-top-left-radius:0}.tp-tabv_c .tp-brkv>.tp-cntv+.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-cntv+.tp-tabv>.tp-tabv_t{border-top-left-radius:0}.tp-tabv_c .tp-brkv>.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-tabv>.tp-tabv_t{border-top-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--elm-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);overflow:hidden;padding-left:var(--cnt-h-p);padding-right:calc(4px + var(--bld-us) + var(--cnt-h-p));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:\"\";display:block;height:6px;right:calc(var(--cnt-h-p) + (var(--bld-us) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--elm-br);cursor:pointer;display:block;height:var(--bld-us);position:relative;width:var(--bld-us)}.tp-ckbv_w svg{bottom:0;display:block;height:16px;left:0;margin:auto;opacity:0;position:absolute;right:0;top:0;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--bld-us)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-expanded.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--bld-s);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--bld-s)}.tp-colpv_rgb{display:flex;margin-top:var(--bld-s);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-v-p);padding-top:calc(var(--cnt-v-p) + 2px);position:relative}.tp-colpv_a::before{background-color:var(--grv-fg);content:\"\";height:2px;left:calc(-1*var(--cnt-h-p));position:absolute;right:calc(-1*var(--cnt-h-p));top:0}.tp-colpv.tp-v-disabled .tp-colpv_a::before{opacity:.5}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--elm-br);outline:none;overflow:hidden;position:relative}.tp-svpv.tp-v-disabled{opacity:.5}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--bld-us)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative}.tp-hplv.tp-v-disabled{opacity:.5}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative;width:100%}.tp-aplv.tp-v-disabled{opacity:.5}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--elm-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--elm-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;cursor:pointer;display:block;height:var(--bld-us);left:0;margin:0;outline:none;padding:0;position:absolute;top:0;width:var(--bld-us)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--elm-br);bottom:0;content:\"\";display:block;left:0;position:absolute;right:0;top:0}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--elm-br);color:var(--lbl-fg);cursor:pointer;height:var(--bld-us);line-height:var(--bld-us);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv.tp-v-disabled .tp-coltxtv_mm{opacity:.5}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv{position:relative}.tp-fldv.tp-fldv-not .tp-fldv_b{display:none}.tp-fldv_t{padding-left:4px}.tp-fldv_b:disabled .tp-fldv_m{display:none}.tp-fldv_c{padding-left:4px}.tp-fldv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--bld-us) + 4px);width:var(--bs-br)}.tp-fldv_i::before{background-color:currentColor;bottom:0;content:\"\";left:0;position:absolute;top:0;width:4px}.tp-fldv_b:hover+.tp-fldv_i{color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_i{color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_i{color:var(--cnt-bg-a)}.tp-fldv.tp-v-disabled>.tp-fldv_i{opacity:.5}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--bld-us)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-h-p);padding-right:var(--cnt-h-p)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:160px}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding:0 4px}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--bld-us)*3);line-height:var(--bld-us);padding:0 4px;resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--bld-us);margin-right:4px;position:relative;width:var(--bld-us)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--bld-s);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-p2dpv{padding-left:calc(var(--bld-us) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv.tp-v-disabled .tp-p2dpv_p{opacity:.5}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:6px;box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:168px;padding:var(--cnt-v-p) var(--cnt-h-p);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sprv.tp-v-disabled .tp-sprv_r{opacity:.5}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--bld-us);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;bottom:0;content:\"\";display:block;height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:\"\";display:block;height:2px;left:0;margin-bottom:auto;margin-top:auto;position:absolute;right:0;top:0}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--elm-br);bottom:0;content:\"\";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv{position:relative}.tp-tabv_t{align-items:flex-end;color:var(--cnt-bg);display:flex;overflow:hidden;position:relative}.tp-tabv_t:hover{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus){color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active){color:var(--cnt-bg-a)}.tp-tabv_t::before{background-color:currentColor;bottom:0;content:\"\";height:2px;left:0;pointer-events:none;position:absolute;right:0}.tp-tabv.tp-v-disabled .tp-tabv_t::before{opacity:.5}.tp-tabv.tp-tabv-nop .tp-tabv_t{height:calc(var(--bld-us) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_t::before{background-color:var(--cnt-bg);bottom:0;content:\"\";height:2px;left:0;position:absolute;right:0}.tp-tabv_c{padding-bottom:var(--cnt-v-p);padding-left:4px;padding-top:var(--cnt-v-p)}.tp-tabv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--bld-us) + 4px);width:var(--bs-br)}.tp-tabv_i::before{background-color:currentColor;bottom:0;content:\"\";left:0;position:absolute;top:0;width:4px}.tp-tabv_t:hover+.tp-tabv_i{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus)+.tp-tabv_i{color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active)+.tp-tabv_i{color:var(--cnt-bg-a)}.tp-tabv.tp-v-disabled>.tp-tabv_i{opacity:.5}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv.tp-v-disabled::before{opacity:.5}.tp-tbiv_b{display:block;padding-left:calc(var(--cnt-h-p) + 4px);padding-right:calc(var(--cnt-h-p) + 4px);position:relative;width:100%}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_b::before{background-color:var(--cnt-bg);bottom:2px;content:\"\";left:0;pointer-events:none;position:absolute;right:0;top:0}.tp-tbiv_b:hover::before{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus::before{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active::before{background-color:var(--cnt-bg-a)}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);opacity:.5;overflow:hidden;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-txtv{position:relative}.tp-txtv_i{padding:0 4px}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:-3px;position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:\"\";height:calc(var(--bld-us) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--elm-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) rgba(0,0,0,0) rgba(0,0,0,0) rgba(0,0,0,0);border-style:solid;border-width:2px;box-sizing:border-box;content:\"\";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--font-family);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--bld-us) + var(--cnt-h-p));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0}.tp-rotv.tp-rotv-not .tp-rotv_b{display:none}.tp-rotv_b:disabled .tp-rotv_m{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_t{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}');\n            this.pool_.getAll().forEach((plugin) => {\n                this.embedPluginStyle_(plugin);\n            });\n            this.registerPlugin({\n                plugins: [\n                    SliderBladePlugin,\n                    ListBladePlugin,\n                    TabBladePlugin,\n                    TextBladePlugin,\n                ],\n            });\n        }\n    }\n\n    const VERSION = new Semver('3.1.10');\n\n    exports.BladeApi = BladeApi;\n    exports.ButtonApi = ButtonApi;\n    exports.FolderApi = FolderApi;\n    exports.InputBindingApi = InputBindingApi;\n    exports.ListApi = ListApi;\n    exports.MonitorBindingApi = MonitorBindingApi;\n    exports.Pane = Pane;\n    exports.SeparatorApi = SeparatorApi;\n    exports.SliderApi = SliderApi;\n    exports.TabApi = TabApi;\n    exports.TabPageApi = TabPageApi;\n    exports.TextApi = TextApi;\n    exports.TpChangeEvent = TpChangeEvent;\n    exports.VERSION = VERSION;\n\n    Object.defineProperty(exports, '__esModule', { value: true });\n\n}));\n","import { Pane } from 'tweakpane';\n\nexport default class GUI {\n    constructor() {\n        this.pane = new Pane();\n    }\n\n}","import * as THREE from \"three\";\nimport App from \"../App.js\";\nimport { appStateStore } from \"../Utils/Store.js\";\n\n/**\n * Class representing a physics simulation\n */\nexport default class Physics {\n  /**\n   * Creates an instance of Physics.\n   */\n  constructor() {\n    // getting the app instance\n    this.app = new App();\n    this.scene = this.app.scene;\n\n    // setting the physics map\n    this.meshMap = new Map();\n\n    // setting the physics world\n    import(\"@dimforge/rapier3d\").then((RAPIER) => {\n      const gravity = { x: 0, y: -9.81, z: 0 };\n      this.world = new RAPIER.World(gravity);\n      this.rapier = RAPIER;\n\n      this.rapierLoaded = true;\n      appStateStore.setState({ physicsReady: true });\n    });\n  }\n\n  /**\n   * Adds a mesh to the physics simulation with a given rigid body type and collider type\n   * @param {THREE.Mesh} mesh - The mesh to add to the physics simulation\n   * @param {string} type - The rigid body type (\"dynamic\" or \"fixed\")\n   * @param {string} collider - The collider type (\"cuboid\", \"ball\", or \"trimesh\")\n   */\n  add(mesh, type, collider) {\n    // defining the rigid body type\n    let rigidBodyType;\n    switch(type) {\n      case \"dynamic\":\n      rigidBodyType = this.rapier.RigidBodyDesc.dynamic();\n      break;\n    case \"fixed\":\n      rigidBodyType = this.rapier.RigidBodyDesc.fixed();\n      break\n    case 'kinematic':\n      rigidBodyType = this.rapier.RigidBodyDesc.kinematicPositionBased();\n      break;\n    }\n    this.rigidBody = this.world.createRigidBody(rigidBodyType);\n\n    // defining the collider type\n    let colliderType;\n\n    switch (collider) {\n      case \"cuboid\":\n        const dimensions = this.computeCuboidDimensions(mesh);\n        colliderType = this.rapier.ColliderDesc.cuboid(\n          dimensions.x / 2,\n          dimensions.y / 2,\n          dimensions.z / 2\n        );\n        this.world.createCollider(colliderType, this.rigidBody);\n        break;\n      case \"ball\":\n        const radius = this.computeBallDimensions(mesh);\n        colliderType = this.rapier.ColliderDesc.ball(radius);\n        this.world.createCollider(colliderType, this.rigidBody);\n        break;\n      case \"trimesh\":\n        const { scaledVertices, indices } = this.computeTrimeshDimensions(mesh);\n        colliderType = this.rapier.ColliderDesc.trimesh(\n          scaledVertices,\n          indices\n        );\n        this.world.createCollider(colliderType, this.rigidBody);\n\n        break;\n    }\n\n    // setting the rigid body position and rotation\n    const worldPosition = mesh.getWorldPosition(new THREE.Vector3());\n    const worldRotation = mesh.getWorldQuaternion(new THREE.Quaternion());\n    this.rigidBody.setTranslation(worldPosition);\n    this.rigidBody.setRotation(worldRotation);\n\n    this.meshMap.set(mesh, this.rigidBody);\n    return this.rigidBody;\n  }\n\n  /**\n   * Computes the dimensions of a cuboid collider for a given mesh\n   * @param {THREE.Mesh} mesh - The mesh to compute the dimensions for\n   * @returns {THREE.Vector3} The dimensions of the cuboid collider\n   */\n  computeCuboidDimensions(mesh) {\n    mesh.geometry.computeBoundingBox();\n    const size = mesh.geometry.boundingBox.getSize(new THREE.Vector3());\n    const worldScale = mesh.getWorldScale(new THREE.Vector3());\n    size.multiply(worldScale);\n    return size;\n  }\n\n  /**\n   * Computes the radius of a\n   /**\n\nComputes the radius of a sphere collider for a given mesh\n@param {THREE.Mesh} mesh - The mesh to compute the radius for\n@returns {number} The radius of the sphere collider\n*/\n  computeBallDimensions(mesh) {\n    mesh.geometry.computeBoundingSphere();\n    const radius = mesh.geometry.boundingSphere.radius;\n    const worldScale = mesh.getWorldScale(new THREE.Vector3());\n    const maxScale = Math.max(worldScale.x, worldScale.y, worldScale.z);\n    return radius * maxScale;\n  }\n\n  /**\n  Computes the scaled vertices and indices of a trimesh collider for a given mesh\n  @param {THREE.Mesh} mesh - The mesh to compute the scaled vertices and indices for\n  @returns {{scaledVertices: number[], indices: number[]}} The scaled vertices and indices of the trimesh collider\n  */\n  computeTrimeshDimensions(mesh) {\n    const vertices = mesh.geometry.attributes.position.array;\n    const indices = mesh.geometry.index.array;\n    const worldScale = mesh.getWorldScale(new THREE.Vector3());\n    const scaledVertices = vertices.map((vertex, index) => {\n      return vertex * worldScale.getComponent(index % 3);\n    });\n    return { scaledVertices, indices };\n  }\n  /**\n  \n  The loop function that updates the physics simulation and the mesh positions and rotations\n  */\n  loop() {\n    if (!this.rapierLoaded) return;\n    this.world.step();\n    this.meshMap.forEach((rigidBody, mesh) => {\n\n      // extracting the position and rotation from the rigid body\n      const position = new THREE.Vector3().copy(rigidBody.translation());\n      const rotation = new THREE.Quaternion().copy(rigidBody.rotation());\n\n      // transforming the position to the parent mesh's local space\n      position.applyMatrix4(\n        new THREE.Matrix4().copy(mesh.parent.matrixWorld).invert()\n      );\n\n      // transforming the rotation to the parent mesh's local space\n      const inverseParentMatrix = new THREE.Matrix4()\n        .extractRotation(mesh.parent.matrixWorld)\n        .invert();\n      const inverseParentRotation =\n        new THREE.Quaternion().setFromRotationMatrix(inverseParentMatrix);\n      rotation.premultiply(inverseParentRotation);\n\n      \n      mesh.position.copy(position);\n      mesh.quaternion.copy(rotation);\n    });\n  }\n}\n","import { createStore } from \"zustand/vanilla\";\n\nconst assetsToLoad = [\n  {\n    id:'avatar',\n    path:'/models/avatar.glb',\n    type: 'model' \n  },\n  {\n    id:'environment',\n    path:'/models/environment.glb',\n    type: 'model' \n  }\n];\n\nconst assetStore = createStore((set) => ({\n  assetsToLoad,\n  loadedAssets: {},\n  addLoadedAsset: (asset, id) =>\n    set((state) => ({\n      loadedAssets: {\n        ...state.loadedAssets,\n        [id]: asset,\n      },\n    })),\n}));\n\nexport default assetStore;\n","import * as THREE from \"three\";\nimport App from \"../App.js\";\nimport assetStore from \"../Utils/AssetStore.js\";\n\nexport default class Environment {\n  constructor() {\n    this.app = new App();\n    this.scene = this.app.scene;\n    this.physics = this.app.world.physics;\n    this.pane = this.app.gui.pane;\n\n    this.assetStore = assetStore.getState()\n    this.environment = this.assetStore.loadedAssets.environment\n\n    this.loadEnvironment();\n    this.addLights();\n  }\n\n  loadEnvironment() {\n    // load environment here\n    const environmentScene = this.environment.scene;\n    this.scene.add(environmentScene);\n\n    environmentScene.position.set(-4.8, 0, -7.4)\n    environmentScene.rotation.set(0, -.60, 0)\n    environmentScene.scale.setScalar(1.3)\n\n    const physicalObjects = ['trees',\n      'terrain',\n      'rocks',\n      'stairs',\n      'gates',\n      'floor',\n      'bushes'\n    ]\n\n    const shadowCasters = ['trees',\n      'terrain',\n      'rocks',\n      'stairs',\n      'gates',\n      'bushes'\n    ]\n\n    const shadowReceivers = ['floor',\n    'terrain'\n  ]\n\n  for (const child of environmentScene.children) {\n    child.traverse((obj) => {\n      if (obj.isMesh) {\n        obj.castShadow = shadowCasters.some((keyword) => child.name.includes(keyword))\n        obj.receiveShadow = shadowReceivers.some((keyword) => child.name.includes(keyword))\n        if (physicalObjects.some((keyword) => child.name.includes(keyword))) {\n          this.physics.add(obj, \"fixed\", \"cuboid\")\n        }\n      }\n    })\n  }\n}\n\n\n  addLights() {\n    const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);\n    this.scene.add(ambientLight);\n\n    this.directionalLight = new THREE.DirectionalLight(0xffffff, 0.5);\n    this.directionalLight.position.set(1, 1, 1);\n    this.directionalLight.castShadow = true;\n    this.directionalLight.shadow.camera.top = 30\n    this.directionalLight.shadow.camera.right = 30\n    this.directionalLight.shadow.camera.left = -30\n    this.directionalLight.shadow.camera.bottom = -30\n    this.directionalLight.shadow.bias = -0.002\n    this.directionalLight.shadow.normalBias = 0.072\n     this.scene.add(this.directionalLight);\n  }\n\n}\n","import * as THREE from \"three\";\nimport assetStore from \"../Utils/AssetStore.js\";\n\nimport App from \"../App.js\";\nexport default class Character {\n  constructor() {\n    this.app = new App();\n    this.scene = this.app.scene;\n    this.assetStore = assetStore.getState()\n    this.avatar = this.assetStore.loadedAssets.avatar\n    // console.log(this.avatar)\n\n    this.instantiateCharacter();\n  }\n\n  instantiateCharacter() {\n    // create character and add to scene\n    const geometry = new THREE.BoxGeometry(.6, 2, .6);\n    const material = new THREE.MeshStandardMaterial({\n      color: 0x00ff00,\n      wireframe: true,\n      visible: false,\n    });\n    this.instance = new THREE.Mesh(geometry, material);\n    this.instance.position.set(0, 4, 0);\n    this.scene.add(this.instance);\n\n    // add avatar to character\n    const avatar = this.avatar.scene\n    avatar.rotation.y = Math.PI\n    avatar.position.y = -1\n    this.instance.add(avatar)\n  }\n}\n","import * as THREE from \"three\";\nimport App from \"../App.js\";\nimport { inputStore } from \"../Utils/Store.js\";\n\nexport default class CharacterController {\n    constructor() {\n        this.app = new App();\n        this.scene = this.app.scene;\n        this.physics = this.app.world.physics;\n        this.character = this.app.world.character.instance;\n\n        inputStore.subscribe((state) => {\n            this.forward = state.forward;\n            this.backward = state.backward;\n            this.left = state.left;\n            this.right = state.right;\n        });\n\n        this.instantiateController();\n    }\n\n    instantiateController() {\n        this.rigidBodyType = this.physics.rapier.RigidBodyDesc.kinematicPositionBased();\n        this.rigidBody = this.physics.world.createRigidBody(this.rigidBodyType);\n\n        this.colliderType = this.physics.rapier.ColliderDesc.cuboid(.3, 1, .3);\n        this.collider = this.physics.world.createCollider(\n            this.colliderType,\n            this.rigidBody\n        );\n\n        const worldPosition = this.character.getWorldPosition(new THREE.Vector3());\n        const worldRotation = this.character.getWorldQuaternion(new THREE.Quaternion());\n        this.rigidBody.setTranslation(worldPosition);\n        this.rigidBody.setRotation(worldRotation);\n\n        this.characterController = this.physics.world.createCharacterController(0.01);\n        this.characterController.setApplyImpulsesToDynamicBodies(true);\n        this.characterController.enableAutostep(1, 0.1, false);\n        this.characterController.enableSnapToGround(1);\n    }\n\n    loop() {\n        const movement = new THREE.Vector3();\n        if (this.forward) movement.z -= 1;\n        if (this.backward) movement.z += 1;\n        if (this.left) movement.x -= 1;\n        if (this.right) movement.x += 1;\n\n        if (movement.length() !== 0) {\n            const angle = Math.atan2(movement.x, movement.z) + Math.PI;\n            const characterRotation = new THREE.Quaternion().setFromAxisAngle(\n                new THREE.Vector3(0, 1, 0),\n                angle\n            );\n            this.character.quaternion.slerp(characterRotation, 0.1);\n        }\n\n        movement.normalize().multiplyScalar(0.18);\n        movement.y = -1;\n\n        this.characterController.computeColliderMovement(this.collider, movement);\n        const newPosition = new THREE.Vector3()\n            .copy(this.rigidBody.translation())\n            .add(this.characterController.computedMovement());\n\n        this.rigidBody.setNextKinematicTranslation(newPosition);\n        this.character.position.lerp(this.rigidBody.translation(), 0.1);\n    }\n}","import * as THREE from 'three';\n\nimport App from '../App';\nimport { inputStore } from '../Utils/Store.js';\n\nexport default class AnimationController {\n    constructor() {\n        this.app = new App();\n        this.scene = this.app.scene;\n        this.avatar = this.app.world.character.avatar;\n\n        inputStore.subscribe((input) => this.onInput(input))\n\n        this.instantiatedAnimations()\n    }\n\n    instantiatedAnimations() {\n        const idle = this.avatar.animations[0]\n        this.mixer = new THREE.AnimationMixer(this.avatar.scene)\n\n\n        this.animations = new Map()\n        this.avatar.animations.forEach((clip) => {\n            this.animations.set(clip.name, this.mixer.clipAction(clip))\n        })\n\n        this.currentAction = this.animations.get('Idle')\n        this.currentAction.play()\n    }\n\n    playAnimation(name) {\n        if (this.currentAction === this.animations.get(name)) return\n        const action = this.animations.get(name)\n        action.reset()\n        action.play()\n        action.crossFadeFrom(this.currentAction, 0.2)\n\n        this.currentAction = action\n    }\n\n    onInput(input) {\n        if(\n            input.forward ||\n            input.backward ||\n            input.left ||\n            input.right\n        ) {\n            this.playAnimation('Run')\n        } else {\n            this.playAnimation('Idle')\n\n        }\n    }\n\n    loop(deltaTime) {\n        this.mixer.update(deltaTime)\n    } \n\n}","import * as THREE from \"three\";\nimport App from \"../App.js\";\n\nexport default class Portal {\n    constructor(position, portalData) {\n        this.app = new App();\n        this.scene = this.app.scene;\n        this.physics = this.app.world.physics;\n        \n        this.title = portalData.title;\n        this.description = portalData.description;\n        this.color = portalData.color;\n        this.position = position;\n        \n        this.createTriggerZone();\n        \n        this.playerInTrigger = false;\n        this.cooldown = false;\n    }\n\n    createTriggerZone() {\n        const colliderDesc = this.physics.rapier.ColliderDesc.cuboid(1.5, 2, 0.1)\n            .setTranslation(this.position.x, this.position.y, this.position.z)\n            .setSensor(true)\n            .setActiveEvents(this.physics.rapier.ActiveEvents.COLLISION_EVENTS);\n            \n        this.triggerCollider = this.physics.world.createCollider(colliderDesc);\n        this.triggerCollider.parent = this;\n    }\n\n    update() {\n        if (this.app.world.characterController && !this.cooldown) {\n            const playerPos = this.app.world.characterController.rigidBody.translation();\n            const portalPos = this.position;\n            \n            const distance = Math.sqrt(\n                Math.pow(portalPos.x - playerPos.x, 2) + \n                Math.pow(portalPos.z - playerPos.z, 2)\n            );\n\n            if (distance < 1.2 && !this.playerInTrigger) {\n                this.handlePlayerEnter(this.app.modalManager);\n            } else if (distance >= 1.8 && this.playerInTrigger) {\n                this.handlePlayerExit();\n            }\n        }\n    }\n\n    handlePlayerEnter(modalManager) {\n        if (!this.cooldown && !this.playerInTrigger) {\n            this.playerInTrigger = true;\n            modalManager?.openModal(this.title, this.description);\n            \n            this.cooldown = true;\n            setTimeout(() => {\n                this.cooldown = false;\n            }, 1000);\n        }\n    }\n\n    handlePlayerExit() {\n        this.playerInTrigger = false;\n    }\n\n    dispose() {\n        if (this.triggerCollider) {\n            this.physics.world.removeCollider(this.triggerCollider);\n        }\n    }\n}","import * as THREE from \"three\";\n\nimport App from \"../App.js\";\nimport Physics from \"./Physics.js\";\nimport Environment from \"./Environment.js\";\nimport Character from \"./Character.js\";\nimport CharacterController from \"./CharacterController.js\";\nimport AnimationController from \"./AnimationController.js\";\nimport Portal from \"./Portal.js\";\n\nimport { appStateStore } from \"../Utils/Store.js\";\n\nexport default class World {\n    constructor() {\n        this.app = new App();\n        this.scene = this.app.scene;\n        \n        this.physics = new Physics();\n\n        this.portalData = [\n            {\n                position: new THREE.Vector3(-1.52, 3.04 - 0.61, -12.12 - 0.33),\n                data: {\n                    title: \"Welcome to My World\",\n                    description: \n                        \"<div class='intro'>\" +\n                        \"<h2>Hi, I'm William Curry</h2>\" +\n                        \"<p>I'm a full-stack developer who transforms complex challenges into elegant solutions. \" +\n                        \"With a foundation in modern JavaScript and React, I blend technical expertise with \" +\n                        \"entrepreneurial insight to create impactful applications.</p>\" +\n                        \"<p>What sets me apart is my innovative approach to development  I leverage AI tools \" +\n                        \"to accelerate development while maintaining high code quality. This portfolio itself \" +\n                        \"showcases my passion for interactive experiences, built with Three.js and modern web technologies.</p>\" +\n                        \"<p>My journey from EMT to software engineer has given me a unique perspective on \" +\n                        \"problem-solving and crisis management, skills that prove invaluable in today's fast-paced \" +\n                        \"development environment.</p>\" +\n                        \"<p>Explore my work history and projects through the portals above!</p>\" +\n                        \"</div>\",\n                    color: 0x00ff00\n                }\n            },\n            {\n                position: new THREE.Vector3(-5.65, 15.00 - 10.30, -22.01 - 4.67),\n                data: {\n                    title: \"Professional Journey\",\n                    description: \n                        \"<div class='work-history'>\" +\n                        \"<div class='work-entry'>\" +\n                        \"<h3>Web Developer at Tree Three</h3>\" +\n                        \"<p class='company'>Mar 2023 - Sep 2023</p>\" +\n                        \"<p>Founded and managed an innovative print-on-demand e-commerce platform, combining \" +\n                        \"technical expertise with entrepreneurial vision. Integrated AI services for unique product \" +\n                        \"designs and implemented digital marketing strategies for growth.</p>\" +\n                        \"</div>\" +\n                        \"<div class='work-entry'>\" +\n                        \"<h3>Software Engineer at Guaranteed Rate</h3>\" +\n                        \"<p class='company'>Jan 2022 - Apr 2022</p>\" +\n                        \"<p>Developed frontend solutions using ReactJS and GraphQL, notably contributing to a credit \" +\n                        \"score calculation tool. Enhanced loan processing efficiency through real-time monitoring \" +\n                        \"features and intuitive interfaces.</p>\" +\n                        \"</div>\" +\n                        \"<div class='work-entry'>\" +\n                        \"<h3>Software Developer at Virtual Service Operations</h3>\" +\n                        \"<p class='company'>Sep 2020 - Feb 2021</p>\" +\n                        \"<p>Contributed to Kaiser Permanente's Operations Manager software, working with a \" +\n                        \"microservices architecture. Leveraged TypeScript, Angular, and GraphQL to enhance hospital \" +\n                        \"server monitoring systems.</p>\" +\n                        \"</div>\" +\n                        \"</div>\",\n                    color: 0x0000ff\n                }\n            },\n            {\n                position: new THREE.Vector3(8.48, 12.17 - 8.72, -21.25 - 0.54),\n                data: {\n                    title: \"Featured Projects\",\n                    description: \n                        \"<div class='projects-grid'>\" +\n                        \"<div class='project-card'>\" +\n                        \"<h3>3D Interactive Portfolio</h3>\" +\n                        \"<p>A creative approach to showcasing my work through an immersive 3D environment. \" +\n                        \"Built with Three.js and Rapier physics, featuring dynamic character movement and \" +\n                        \"interactive portals.</p>\" +\n                        \"<div class='tech-stack'>Three.js  Rapier Physics  JavaScript</div>\" +\n                        \"</div>\" +\n                        \"<div class='project-card'>\" +\n                        \"<h3>E-commerce Platform</h3>\" +\n                        \"<p>Full-stack print-on-demand platform integrating AI for design generation. \" +\n                        \"Implemented robust ordering system and analytics dashboard.</p>\" +\n                        \"<div class='tech-stack'>JavaScript  AI Integration  Full-Stack Development</div>\" +\n                        \"</div>\" +\n                        \"<div class='project-card'>\" +\n                        \"<h3>Credit Score Calculator</h3>\" +\n                        \"<p>Developed at Guaranteed Rate, this tool streamlined loan officer workflows by \" +\n                        \"providing real-time credit assessment capabilities.</p>\" +\n                        \"<div class='tech-stack'>React  GraphQL  Tailwind CSS</div>\" +\n                        \"</div>\" +\n                        \"</div>\",\n                    color: 0xff0000\n                }\n            }\n        ];\n\n        const unsub = appStateStore.subscribe((state) => {\n            if (state.physicsReady && state.assetsReady) {\n                this.environment = new Environment();\n                this.character = new Character();\n                this.characterController = new CharacterController();\n                this.animationController = new AnimationController();\n                \n                if (this.physics.rapierLoaded) {\n                    this.createPortals();\n                }\n                \n                unsub();\n            }\n        });\n\n        this.loop();\n    }\n\n    createPortals() {\n        try {\n            this.portals = [];\n            this.portalData.forEach(({ position, data }) => {\n                try {\n                    const portal = new Portal(position, data);\n                    this.portals.push(portal);\n                } catch (error) {\n                    console.error('Error creating portal:', error);\n                }\n            });\n        } catch (error) {\n            console.error('Error in createPortals:', error);\n        }\n    }\n\n    loop(deltaTime, elapsedTime) {\n        if (this.physics) this.physics.loop();\n        if (this.characterController) this.characterController.loop();\n        if (this.animationController) this.animationController.loop(deltaTime);\n        \n        if (this.portals && this.portals.length > 0) {\n            this.portals.forEach(portal => portal.update());\n        }\n    }\n}","import { sizesStore } from \"./Store.js\";\n\nexport default class Resize {\n    constructor() {\n\n        const { setState } = sizesStore\n\n        window.addEventListener(\"resize\", () => {\n            setState({\n                width: window.innerWidth,\n                height: window.innerHeight,\n                pixelRatio: Math.min(window.devicePixelRatio, 2),\n            })\n          \n          });\n\n    }\n}","import {\n\tBufferAttribute,\n\tBufferGeometry,\n\tFloat32BufferAttribute,\n\tInstancedBufferAttribute,\n\tInterleavedBuffer,\n\tInterleavedBufferAttribute,\n\tTriangleFanDrawMode,\n\tTriangleStripDrawMode,\n\tTrianglesDrawMode,\n\tVector3,\n} from 'three';\n\nfunction computeTangents() {\n\n\tthrow new Error( 'BufferGeometryUtils: computeTangents renamed to computeMikkTSpaceTangents.' );\n\n}\n\nfunction computeMikkTSpaceTangents( geometry, MikkTSpace, negateSign = true ) {\n\n\tif ( ! MikkTSpace || ! MikkTSpace.isReady ) {\n\n\t\tthrow new Error( 'BufferGeometryUtils: Initialized MikkTSpace library required.' );\n\n\t}\n\n\tif ( ! geometry.hasAttribute( 'position' ) || ! geometry.hasAttribute( 'normal' ) || ! geometry.hasAttribute( 'uv' ) ) {\n\n\t\tthrow new Error( 'BufferGeometryUtils: Tangents require \"position\", \"normal\", and \"uv\" attributes.' );\n\n\t}\n\n\tfunction getAttributeArray( attribute ) {\n\n\t\tif ( attribute.normalized || attribute.isInterleavedBufferAttribute ) {\n\n\t\t\tconst dstArray = new Float32Array( attribute.getCount() * attribute.itemSize );\n\n\t\t\tfor ( let i = 0, j = 0; i < attribute.getCount(); i ++ ) {\n\n\t\t\t\tdstArray[ j ++ ] = attribute.getX( i );\n\t\t\t\tdstArray[ j ++ ] = attribute.getY( i );\n\n\t\t\t\tif ( attribute.itemSize > 2 ) {\n\n\t\t\t\t\tdstArray[ j ++ ] = attribute.getZ( i );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn dstArray;\n\n\t\t}\n\n\t\tif ( attribute.array instanceof Float32Array ) {\n\n\t\t\treturn attribute.array;\n\n\t\t}\n\n\t\treturn new Float32Array( attribute.array );\n\n\t}\n\n\t// MikkTSpace algorithm requires non-indexed input.\n\n\tconst _geometry = geometry.index ? geometry.toNonIndexed() : geometry;\n\n\t// Compute vertex tangents.\n\n\tconst tangents = MikkTSpace.generateTangents(\n\n\t\tgetAttributeArray( _geometry.attributes.position ),\n\t\tgetAttributeArray( _geometry.attributes.normal ),\n\t\tgetAttributeArray( _geometry.attributes.uv )\n\n\t);\n\n\t// Texture coordinate convention of glTF differs from the apparent\n\t// default of the MikkTSpace library; .w component must be flipped.\n\n\tif ( negateSign ) {\n\n\t\tfor ( let i = 3; i < tangents.length; i += 4 ) {\n\n\t\t\ttangents[ i ] *= - 1;\n\n\t\t}\n\n\t}\n\n\t//\n\n\t_geometry.setAttribute( 'tangent', new BufferAttribute( tangents, 4 ) );\n\n\tif ( geometry !== _geometry ) {\n\n\t\tgeometry.copy( _geometry );\n\n\t}\n\n\treturn geometry;\n\n}\n\n/**\n * @param  {Array<BufferGeometry>} geometries\n * @param  {Boolean} useGroups\n * @return {BufferGeometry}\n */\nfunction mergeBufferGeometries( geometries, useGroups = false ) {\n\n\tconst isIndexed = geometries[ 0 ].index !== null;\n\n\tconst attributesUsed = new Set( Object.keys( geometries[ 0 ].attributes ) );\n\tconst morphAttributesUsed = new Set( Object.keys( geometries[ 0 ].morphAttributes ) );\n\n\tconst attributes = {};\n\tconst morphAttributes = {};\n\n\tconst morphTargetsRelative = geometries[ 0 ].morphTargetsRelative;\n\n\tconst mergedGeometry = new BufferGeometry();\n\n\tlet offset = 0;\n\n\tfor ( let i = 0; i < geometries.length; ++ i ) {\n\n\t\tconst geometry = geometries[ i ];\n\t\tlet attributesCount = 0;\n\n\t\t// ensure that all geometries are indexed, or none\n\n\t\tif ( isIndexed !== ( geometry.index !== null ) ) {\n\n\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index ' + i + '. All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them.' );\n\t\t\treturn null;\n\n\t\t}\n\n\t\t// gather attributes, exit early if they're different\n\n\t\tfor ( const name in geometry.attributes ) {\n\n\t\t\tif ( ! attributesUsed.has( name ) ) {\n\n\t\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index ' + i + '. All geometries must have compatible attributes; make sure \"' + name + '\" attribute exists among all geometries, or in none of them.' );\n\t\t\t\treturn null;\n\n\t\t\t}\n\n\t\t\tif ( attributes[ name ] === undefined ) attributes[ name ] = [];\n\n\t\t\tattributes[ name ].push( geometry.attributes[ name ] );\n\n\t\t\tattributesCount ++;\n\n\t\t}\n\n\t\t// ensure geometries have the same number of attributes\n\n\t\tif ( attributesCount !== attributesUsed.size ) {\n\n\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index ' + i + '. Make sure all geometries have the same number of attributes.' );\n\t\t\treturn null;\n\n\t\t}\n\n\t\t// gather morph attributes, exit early if they're different\n\n\t\tif ( morphTargetsRelative !== geometry.morphTargetsRelative ) {\n\n\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index ' + i + '. .morphTargetsRelative must be consistent throughout all geometries.' );\n\t\t\treturn null;\n\n\t\t}\n\n\t\tfor ( const name in geometry.morphAttributes ) {\n\n\t\t\tif ( ! morphAttributesUsed.has( name ) ) {\n\n\t\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index ' + i + '.  .morphAttributes must be consistent throughout all geometries.' );\n\t\t\t\treturn null;\n\n\t\t\t}\n\n\t\t\tif ( morphAttributes[ name ] === undefined ) morphAttributes[ name ] = [];\n\n\t\t\tmorphAttributes[ name ].push( geometry.morphAttributes[ name ] );\n\n\t\t}\n\n\t\tif ( useGroups ) {\n\n\t\t\tlet count;\n\n\t\t\tif ( isIndexed ) {\n\n\t\t\t\tcount = geometry.index.count;\n\n\t\t\t} else if ( geometry.attributes.position !== undefined ) {\n\n\t\t\t\tcount = geometry.attributes.position.count;\n\n\t\t\t} else {\n\n\t\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index ' + i + '. The geometry must have either an index or a position attribute' );\n\t\t\t\treturn null;\n\n\t\t\t}\n\n\t\t\tmergedGeometry.addGroup( offset, count, i );\n\n\t\t\toffset += count;\n\n\t\t}\n\n\t}\n\n\t// merge indices\n\n\tif ( isIndexed ) {\n\n\t\tlet indexOffset = 0;\n\t\tconst mergedIndex = [];\n\n\t\tfor ( let i = 0; i < geometries.length; ++ i ) {\n\n\t\t\tconst index = geometries[ i ].index;\n\n\t\t\tfor ( let j = 0; j < index.count; ++ j ) {\n\n\t\t\t\tmergedIndex.push( index.getX( j ) + indexOffset );\n\n\t\t\t}\n\n\t\t\tindexOffset += geometries[ i ].attributes.position.count;\n\n\t\t}\n\n\t\tmergedGeometry.setIndex( mergedIndex );\n\n\t}\n\n\t// merge attributes\n\n\tfor ( const name in attributes ) {\n\n\t\tconst mergedAttribute = mergeBufferAttributes( attributes[ name ] );\n\n\t\tif ( ! mergedAttribute ) {\n\n\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the ' + name + ' attribute.' );\n\t\t\treturn null;\n\n\t\t}\n\n\t\tmergedGeometry.setAttribute( name, mergedAttribute );\n\n\t}\n\n\t// merge morph attributes\n\n\tfor ( const name in morphAttributes ) {\n\n\t\tconst numMorphTargets = morphAttributes[ name ][ 0 ].length;\n\n\t\tif ( numMorphTargets === 0 ) break;\n\n\t\tmergedGeometry.morphAttributes = mergedGeometry.morphAttributes || {};\n\t\tmergedGeometry.morphAttributes[ name ] = [];\n\n\t\tfor ( let i = 0; i < numMorphTargets; ++ i ) {\n\n\t\t\tconst morphAttributesToMerge = [];\n\n\t\t\tfor ( let j = 0; j < morphAttributes[ name ].length; ++ j ) {\n\n\t\t\t\tmorphAttributesToMerge.push( morphAttributes[ name ][ j ][ i ] );\n\n\t\t\t}\n\n\t\t\tconst mergedMorphAttribute = mergeBufferAttributes( morphAttributesToMerge );\n\n\t\t\tif ( ! mergedMorphAttribute ) {\n\n\t\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the ' + name + ' morphAttribute.' );\n\t\t\t\treturn null;\n\n\t\t\t}\n\n\t\t\tmergedGeometry.morphAttributes[ name ].push( mergedMorphAttribute );\n\n\t\t}\n\n\t}\n\n\treturn mergedGeometry;\n\n}\n\n/**\n * @param {Array<BufferAttribute>} attributes\n * @return {BufferAttribute}\n */\nfunction mergeBufferAttributes( attributes ) {\n\n\tlet TypedArray;\n\tlet itemSize;\n\tlet normalized;\n\tlet arrayLength = 0;\n\n\tfor ( let i = 0; i < attributes.length; ++ i ) {\n\n\t\tconst attribute = attributes[ i ];\n\n\t\tif ( attribute.isInterleavedBufferAttribute ) {\n\n\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported.' );\n\t\t\treturn null;\n\n\t\t}\n\n\t\tif ( TypedArray === undefined ) TypedArray = attribute.array.constructor;\n\t\tif ( TypedArray !== attribute.array.constructor ) {\n\n\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes.' );\n\t\t\treturn null;\n\n\t\t}\n\n\t\tif ( itemSize === undefined ) itemSize = attribute.itemSize;\n\t\tif ( itemSize !== attribute.itemSize ) {\n\n\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes.' );\n\t\t\treturn null;\n\n\t\t}\n\n\t\tif ( normalized === undefined ) normalized = attribute.normalized;\n\t\tif ( normalized !== attribute.normalized ) {\n\n\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes.' );\n\t\t\treturn null;\n\n\t\t}\n\n\t\tarrayLength += attribute.array.length;\n\n\t}\n\n\tconst array = new TypedArray( arrayLength );\n\tlet offset = 0;\n\n\tfor ( let i = 0; i < attributes.length; ++ i ) {\n\n\t\tarray.set( attributes[ i ].array, offset );\n\n\t\toffset += attributes[ i ].array.length;\n\n\t}\n\n\treturn new BufferAttribute( array, itemSize, normalized );\n\n}\n\n/**\n * @param {BufferAttribute}\n * @return {BufferAttribute}\n */\nexport function deepCloneAttribute( attribute ) {\n\n\tif ( attribute.isInstancedInterleavedBufferAttribute || attribute.isInterleavedBufferAttribute ) {\n\n\t\treturn deinterleaveAttribute( attribute );\n\n\t}\n\n\tif ( attribute.isInstancedBufferAttribute ) {\n\n\t\treturn new InstancedBufferAttribute().copy( attribute );\n\n\t}\n\n\treturn new BufferAttribute().copy( attribute );\n\n}\n\n/**\n * @param {Array<BufferAttribute>} attributes\n * @return {Array<InterleavedBufferAttribute>}\n */\nfunction interleaveAttributes( attributes ) {\n\n\t// Interleaves the provided attributes into an InterleavedBuffer and returns\n\t// a set of InterleavedBufferAttributes for each attribute\n\tlet TypedArray;\n\tlet arrayLength = 0;\n\tlet stride = 0;\n\n\t// calculate the length and type of the interleavedBuffer\n\tfor ( let i = 0, l = attributes.length; i < l; ++ i ) {\n\n\t\tconst attribute = attributes[ i ];\n\n\t\tif ( TypedArray === undefined ) TypedArray = attribute.array.constructor;\n\t\tif ( TypedArray !== attribute.array.constructor ) {\n\n\t\t\tconsole.error( 'AttributeBuffers of different types cannot be interleaved' );\n\t\t\treturn null;\n\n\t\t}\n\n\t\tarrayLength += attribute.array.length;\n\t\tstride += attribute.itemSize;\n\n\t}\n\n\t// Create the set of buffer attributes\n\tconst interleavedBuffer = new InterleavedBuffer( new TypedArray( arrayLength ), stride );\n\tlet offset = 0;\n\tconst res = [];\n\tconst getters = [ 'getX', 'getY', 'getZ', 'getW' ];\n\tconst setters = [ 'setX', 'setY', 'setZ', 'setW' ];\n\n\tfor ( let j = 0, l = attributes.length; j < l; j ++ ) {\n\n\t\tconst attribute = attributes[ j ];\n\t\tconst itemSize = attribute.itemSize;\n\t\tconst count = attribute.count;\n\t\tconst iba = new InterleavedBufferAttribute( interleavedBuffer, itemSize, offset, attribute.normalized );\n\t\tres.push( iba );\n\n\t\toffset += itemSize;\n\n\t\t// Move the data for each attribute into the new interleavedBuffer\n\t\t// at the appropriate offset\n\t\tfor ( let c = 0; c < count; c ++ ) {\n\n\t\t\tfor ( let k = 0; k < itemSize; k ++ ) {\n\n\t\t\t\tiba[ setters[ k ] ]( c, attribute[ getters[ k ] ]( c ) );\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\treturn res;\n\n}\n\n// returns a new, non-interleaved version of the provided attribute\nexport function deinterleaveAttribute( attribute ) {\n\n\tconst cons = attribute.data.array.constructor;\n\tconst count = attribute.count;\n\tconst itemSize = attribute.itemSize;\n\tconst normalized = attribute.normalized;\n\n\tconst array = new cons( count * itemSize );\n\tlet newAttribute;\n\tif ( attribute.isInstancedInterleavedBufferAttribute ) {\n\n\t\tnewAttribute = new InstancedBufferAttribute( array, itemSize, normalized, attribute.meshPerAttribute );\n\n\t} else {\n\n\t\tnewAttribute = new BufferAttribute( array, itemSize, normalized );\n\n\t}\n\n\tfor ( let i = 0; i < count; i ++ ) {\n\n\t\tnewAttribute.setX( i, attribute.getX( i ) );\n\n\t\tif ( itemSize >= 2 ) {\n\n\t\t\tnewAttribute.setY( i, attribute.getY( i ) );\n\n\t\t}\n\n\t\tif ( itemSize >= 3 ) {\n\n\t\t\tnewAttribute.setZ( i, attribute.getZ( i ) );\n\n\t\t}\n\n\t\tif ( itemSize >= 4 ) {\n\n\t\t\tnewAttribute.setW( i, attribute.getW( i ) );\n\n\t\t}\n\n\t}\n\n\treturn newAttribute;\n\n}\n\n// deinterleaves all attributes on the geometry\nexport function deinterleaveGeometry( geometry ) {\n\n\tconst attributes = geometry.attributes;\n\tconst morphTargets = geometry.morphTargets;\n\tconst attrMap = new Map();\n\n\tfor ( const key in attributes ) {\n\n\t\tconst attr = attributes[ key ];\n\t\tif ( attr.isInterleavedBufferAttribute ) {\n\n\t\t\tif ( ! attrMap.has( attr ) ) {\n\n\t\t\t\tattrMap.set( attr, deinterleaveAttribute( attr ) );\n\n\t\t\t}\n\n\t\t\tattributes[ key ] = attrMap.get( attr );\n\n\t\t}\n\n\t}\n\n\tfor ( const key in morphTargets ) {\n\n\t\tconst attr = morphTargets[ key ];\n\t\tif ( attr.isInterleavedBufferAttribute ) {\n\n\t\t\tif ( ! attrMap.has( attr ) ) {\n\n\t\t\t\tattrMap.set( attr, deinterleaveAttribute( attr ) );\n\n\t\t\t}\n\n\t\t\tmorphTargets[ key ] = attrMap.get( attr );\n\n\t\t}\n\n\t}\n\n}\n\n/**\n * @param {Array<BufferGeometry>} geometry\n * @return {number}\n */\nfunction estimateBytesUsed( geometry ) {\n\n\t// Return the estimated memory used by this geometry in bytes\n\t// Calculate using itemSize, count, and BYTES_PER_ELEMENT to account\n\t// for InterleavedBufferAttributes.\n\tlet mem = 0;\n\tfor ( const name in geometry.attributes ) {\n\n\t\tconst attr = geometry.getAttribute( name );\n\t\tmem += attr.count * attr.itemSize * attr.array.BYTES_PER_ELEMENT;\n\n\t}\n\n\tconst indices = geometry.getIndex();\n\tmem += indices ? indices.count * indices.itemSize * indices.array.BYTES_PER_ELEMENT : 0;\n\treturn mem;\n\n}\n\n/**\n * @param {BufferGeometry} geometry\n * @param {number} tolerance\n * @return {BufferGeometry}\n */\nfunction mergeVertices( geometry, tolerance = 1e-4 ) {\n\n\ttolerance = Math.max( tolerance, Number.EPSILON );\n\n\t// Generate an index buffer if the geometry doesn't have one, or optimize it\n\t// if it's already available.\n\tconst hashToIndex = {};\n\tconst indices = geometry.getIndex();\n\tconst positions = geometry.getAttribute( 'position' );\n\tconst vertexCount = indices ? indices.count : positions.count;\n\n\t// next value for triangle indices\n\tlet nextIndex = 0;\n\n\t// attributes and new attribute arrays\n\tconst attributeNames = Object.keys( geometry.attributes );\n\tconst tmpAttributes = {};\n\tconst tmpMorphAttributes = {};\n\tconst newIndices = [];\n\tconst getters = [ 'getX', 'getY', 'getZ', 'getW' ];\n\tconst setters = [ 'setX', 'setY', 'setZ', 'setW' ];\n\n\t// Initialize the arrays, allocating space conservatively. Extra\n\t// space will be trimmed in the last step.\n\tfor ( let i = 0, l = attributeNames.length; i < l; i ++ ) {\n\n\t\tconst name = attributeNames[ i ];\n\t\tconst attr = geometry.attributes[ name ];\n\n\t\ttmpAttributes[ name ] = new BufferAttribute(\n\t\t\tnew attr.array.constructor( attr.count * attr.itemSize ),\n\t\t\tattr.itemSize,\n\t\t\tattr.normalized\n\t\t);\n\n\t\tconst morphAttr = geometry.morphAttributes[ name ];\n\t\tif ( morphAttr ) {\n\n\t\t\ttmpMorphAttributes[ name ] = new BufferAttribute(\n\t\t\t\tnew morphAttr.array.constructor( morphAttr.count * morphAttr.itemSize ),\n\t\t\t\tmorphAttr.itemSize,\n\t\t\t\tmorphAttr.normalized\n\t\t\t);\n\n\t\t}\n\n\t}\n\n\t// convert the error tolerance to an amount of decimal places to truncate to\n\tconst decimalShift = Math.log10( 1 / tolerance );\n\tconst shiftMultiplier = Math.pow( 10, decimalShift );\n\tfor ( let i = 0; i < vertexCount; i ++ ) {\n\n\t\tconst index = indices ? indices.getX( i ) : i;\n\n\t\t// Generate a hash for the vertex attributes at the current index 'i'\n\t\tlet hash = '';\n\t\tfor ( let j = 0, l = attributeNames.length; j < l; j ++ ) {\n\n\t\t\tconst name = attributeNames[ j ];\n\t\t\tconst attribute = geometry.getAttribute( name );\n\t\t\tconst itemSize = attribute.itemSize;\n\n\t\t\tfor ( let k = 0; k < itemSize; k ++ ) {\n\n\t\t\t\t// double tilde truncates the decimal value\n\t\t\t\thash += `${ ~ ~ ( attribute[ getters[ k ] ]( index ) * shiftMultiplier ) },`;\n\n\t\t\t}\n\n\t\t}\n\n\t\t// Add another reference to the vertex if it's already\n\t\t// used by another index\n\t\tif ( hash in hashToIndex ) {\n\n\t\t\tnewIndices.push( hashToIndex[ hash ] );\n\n\t\t} else {\n\n\t\t\t// copy data to the new index in the temporary attributes\n\t\t\tfor ( let j = 0, l = attributeNames.length; j < l; j ++ ) {\n\n\t\t\t\tconst name = attributeNames[ j ];\n\t\t\t\tconst attribute = geometry.getAttribute( name );\n\t\t\t\tconst morphAttr = geometry.morphAttributes[ name ];\n\t\t\t\tconst itemSize = attribute.itemSize;\n\t\t\t\tconst newarray = tmpAttributes[ name ];\n\t\t\t\tconst newMorphArrays = tmpMorphAttributes[ name ];\n\n\t\t\t\tfor ( let k = 0; k < itemSize; k ++ ) {\n\n\t\t\t\t\tconst getterFunc = getters[ k ];\n\t\t\t\t\tconst setterFunc = setters[ k ];\n\t\t\t\t\tnewarray[ setterFunc ]( nextIndex, attribute[ getterFunc ]( index ) );\n\n\t\t\t\t\tif ( morphAttr ) {\n\n\t\t\t\t\t\tfor ( let m = 0, ml = morphAttr.length; m < ml; m ++ ) {\n\n\t\t\t\t\t\t\tnewMorphArrays[ m ][ setterFunc ]( nextIndex, morphAttr[ m ][ getterFunc ]( index ) );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\thashToIndex[ hash ] = nextIndex;\n\t\t\tnewIndices.push( nextIndex );\n\t\t\tnextIndex ++;\n\n\t\t}\n\n\t}\n\n\t// generate result BufferGeometry\n\tconst result = geometry.clone();\n\tfor ( const name in geometry.attributes ) {\n\n\t\tconst tmpAttribute = tmpAttributes[ name ];\n\n\t\tresult.setAttribute( name, new BufferAttribute(\n\t\t\ttmpAttribute.array.slice( 0, nextIndex * tmpAttribute.itemSize ),\n\t\t\ttmpAttribute.itemSize,\n\t\t\ttmpAttribute.normalized,\n\t\t) );\n\n\t\tif ( ! ( name in tmpMorphAttributes ) ) continue;\n\n\t\tfor ( let j = 0; j < tmpMorphAttributes[ name ].length; j ++ ) {\n\n\t\t\tconst tmpMorphAttribute = tmpMorphAttributes[ name ][ j ];\n\n\t\t\tresult.morphAttributes[ name ][ j ] = new BufferAttribute(\n\t\t\t\ttmpMorphAttribute.array.slice( 0, nextIndex * tmpMorphAttribute.itemSize ),\n\t\t\t\ttmpMorphAttribute.itemSize,\n\t\t\t\ttmpMorphAttribute.normalized,\n\t\t\t);\n\n\t\t}\n\n\t}\n\n\t// indices\n\n\tresult.setIndex( newIndices );\n\n\treturn result;\n\n}\n\n/**\n * @param {BufferGeometry} geometry\n * @param {number} drawMode\n * @return {BufferGeometry}\n */\nfunction toTrianglesDrawMode( geometry, drawMode ) {\n\n\tif ( drawMode === TrianglesDrawMode ) {\n\n\t\tconsole.warn( 'THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles.' );\n\t\treturn geometry;\n\n\t}\n\n\tif ( drawMode === TriangleFanDrawMode || drawMode === TriangleStripDrawMode ) {\n\n\t\tlet index = geometry.getIndex();\n\n\t\t// generate index if not present\n\n\t\tif ( index === null ) {\n\n\t\t\tconst indices = [];\n\n\t\t\tconst position = geometry.getAttribute( 'position' );\n\n\t\t\tif ( position !== undefined ) {\n\n\t\t\t\tfor ( let i = 0; i < position.count; i ++ ) {\n\n\t\t\t\t\tindices.push( i );\n\n\t\t\t\t}\n\n\t\t\t\tgeometry.setIndex( indices );\n\t\t\t\tindex = geometry.getIndex();\n\n\t\t\t} else {\n\n\t\t\t\tconsole.error( 'THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible.' );\n\t\t\t\treturn geometry;\n\n\t\t\t}\n\n\t\t}\n\n\t\t//\n\n\t\tconst numberOfTriangles = index.count - 2;\n\t\tconst newIndices = [];\n\n\t\tif ( drawMode === TriangleFanDrawMode ) {\n\n\t\t\t// gl.TRIANGLE_FAN\n\n\t\t\tfor ( let i = 1; i <= numberOfTriangles; i ++ ) {\n\n\t\t\t\tnewIndices.push( index.getX( 0 ) );\n\t\t\t\tnewIndices.push( index.getX( i ) );\n\t\t\t\tnewIndices.push( index.getX( i + 1 ) );\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\t// gl.TRIANGLE_STRIP\n\n\t\t\tfor ( let i = 0; i < numberOfTriangles; i ++ ) {\n\n\t\t\t\tif ( i % 2 === 0 ) {\n\n\t\t\t\t\tnewIndices.push( index.getX( i ) );\n\t\t\t\t\tnewIndices.push( index.getX( i + 1 ) );\n\t\t\t\t\tnewIndices.push( index.getX( i + 2 ) );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tnewIndices.push( index.getX( i + 2 ) );\n\t\t\t\t\tnewIndices.push( index.getX( i + 1 ) );\n\t\t\t\t\tnewIndices.push( index.getX( i ) );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( ( newIndices.length / 3 ) !== numberOfTriangles ) {\n\n\t\t\tconsole.error( 'THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.' );\n\n\t\t}\n\n\t\t// build final geometry\n\n\t\tconst newGeometry = geometry.clone();\n\t\tnewGeometry.setIndex( newIndices );\n\t\tnewGeometry.clearGroups();\n\n\t\treturn newGeometry;\n\n\t} else {\n\n\t\tconsole.error( 'THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:', drawMode );\n\t\treturn geometry;\n\n\t}\n\n}\n\n/**\n * Calculates the morphed attributes of a morphed/skinned BufferGeometry.\n * Helpful for Raytracing or Decals.\n * @param {Mesh | Line | Points} object An instance of Mesh, Line or Points.\n * @return {Object} An Object with original position/normal attributes and morphed ones.\n */\nfunction computeMorphedAttributes( object ) {\n\n\tif ( object.geometry.isBufferGeometry !== true ) {\n\n\t\tconsole.error( 'THREE.BufferGeometryUtils: Geometry is not of type BufferGeometry.' );\n\t\treturn null;\n\n\t}\n\n\tconst _vA = new Vector3();\n\tconst _vB = new Vector3();\n\tconst _vC = new Vector3();\n\n\tconst _tempA = new Vector3();\n\tconst _tempB = new Vector3();\n\tconst _tempC = new Vector3();\n\n\tconst _morphA = new Vector3();\n\tconst _morphB = new Vector3();\n\tconst _morphC = new Vector3();\n\n\tfunction _calculateMorphedAttributeData(\n\t\tobject,\n\t\tattribute,\n\t\tmorphAttribute,\n\t\tmorphTargetsRelative,\n\t\ta,\n\t\tb,\n\t\tc,\n\t\tmodifiedAttributeArray\n\t) {\n\n\t\t_vA.fromBufferAttribute( attribute, a );\n\t\t_vB.fromBufferAttribute( attribute, b );\n\t\t_vC.fromBufferAttribute( attribute, c );\n\n\t\tconst morphInfluences = object.morphTargetInfluences;\n\n\t\tif ( morphAttribute && morphInfluences ) {\n\n\t\t\t_morphA.set( 0, 0, 0 );\n\t\t\t_morphB.set( 0, 0, 0 );\n\t\t\t_morphC.set( 0, 0, 0 );\n\n\t\t\tfor ( let i = 0, il = morphAttribute.length; i < il; i ++ ) {\n\n\t\t\t\tconst influence = morphInfluences[ i ];\n\t\t\t\tconst morph = morphAttribute[ i ];\n\n\t\t\t\tif ( influence === 0 ) continue;\n\n\t\t\t\t_tempA.fromBufferAttribute( morph, a );\n\t\t\t\t_tempB.fromBufferAttribute( morph, b );\n\t\t\t\t_tempC.fromBufferAttribute( morph, c );\n\n\t\t\t\tif ( morphTargetsRelative ) {\n\n\t\t\t\t\t_morphA.addScaledVector( _tempA, influence );\n\t\t\t\t\t_morphB.addScaledVector( _tempB, influence );\n\t\t\t\t\t_morphC.addScaledVector( _tempC, influence );\n\n\t\t\t\t} else {\n\n\t\t\t\t\t_morphA.addScaledVector( _tempA.sub( _vA ), influence );\n\t\t\t\t\t_morphB.addScaledVector( _tempB.sub( _vB ), influence );\n\t\t\t\t\t_morphC.addScaledVector( _tempC.sub( _vC ), influence );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t_vA.add( _morphA );\n\t\t\t_vB.add( _morphB );\n\t\t\t_vC.add( _morphC );\n\n\t\t}\n\n\t\tif ( object.isSkinnedMesh ) {\n\n\t\t\tobject.boneTransform( a, _vA );\n\t\t\tobject.boneTransform( b, _vB );\n\t\t\tobject.boneTransform( c, _vC );\n\n\t\t}\n\n\t\tmodifiedAttributeArray[ a * 3 + 0 ] = _vA.x;\n\t\tmodifiedAttributeArray[ a * 3 + 1 ] = _vA.y;\n\t\tmodifiedAttributeArray[ a * 3 + 2 ] = _vA.z;\n\t\tmodifiedAttributeArray[ b * 3 + 0 ] = _vB.x;\n\t\tmodifiedAttributeArray[ b * 3 + 1 ] = _vB.y;\n\t\tmodifiedAttributeArray[ b * 3 + 2 ] = _vB.z;\n\t\tmodifiedAttributeArray[ c * 3 + 0 ] = _vC.x;\n\t\tmodifiedAttributeArray[ c * 3 + 1 ] = _vC.y;\n\t\tmodifiedAttributeArray[ c * 3 + 2 ] = _vC.z;\n\n\t}\n\n\tconst geometry = object.geometry;\n\tconst material = object.material;\n\n\tlet a, b, c;\n\tconst index = geometry.index;\n\tconst positionAttribute = geometry.attributes.position;\n\tconst morphPosition = geometry.morphAttributes.position;\n\tconst morphTargetsRelative = geometry.morphTargetsRelative;\n\tconst normalAttribute = geometry.attributes.normal;\n\tconst morphNormal = geometry.morphAttributes.position;\n\n\tconst groups = geometry.groups;\n\tconst drawRange = geometry.drawRange;\n\tlet i, j, il, jl;\n\tlet group;\n\tlet start, end;\n\n\tconst modifiedPosition = new Float32Array( positionAttribute.count * positionAttribute.itemSize );\n\tconst modifiedNormal = new Float32Array( normalAttribute.count * normalAttribute.itemSize );\n\n\tif ( index !== null ) {\n\n\t\t// indexed buffer geometry\n\n\t\tif ( Array.isArray( material ) ) {\n\n\t\t\tfor ( i = 0, il = groups.length; i < il; i ++ ) {\n\n\t\t\t\tgroup = groups[ i ];\n\n\t\t\t\tstart = Math.max( group.start, drawRange.start );\n\t\t\t\tend = Math.min( ( group.start + group.count ), ( drawRange.start + drawRange.count ) );\n\n\t\t\t\tfor ( j = start, jl = end; j < jl; j += 3 ) {\n\n\t\t\t\t\ta = index.getX( j );\n\t\t\t\t\tb = index.getX( j + 1 );\n\t\t\t\t\tc = index.getX( j + 2 );\n\n\t\t\t\t\t_calculateMorphedAttributeData(\n\t\t\t\t\t\tobject,\n\t\t\t\t\t\tpositionAttribute,\n\t\t\t\t\t\tmorphPosition,\n\t\t\t\t\t\tmorphTargetsRelative,\n\t\t\t\t\t\ta, b, c,\n\t\t\t\t\t\tmodifiedPosition\n\t\t\t\t\t);\n\n\t\t\t\t\t_calculateMorphedAttributeData(\n\t\t\t\t\t\tobject,\n\t\t\t\t\t\tnormalAttribute,\n\t\t\t\t\t\tmorphNormal,\n\t\t\t\t\t\tmorphTargetsRelative,\n\t\t\t\t\t\ta, b, c,\n\t\t\t\t\t\tmodifiedNormal\n\t\t\t\t\t);\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tstart = Math.max( 0, drawRange.start );\n\t\t\tend = Math.min( index.count, ( drawRange.start + drawRange.count ) );\n\n\t\t\tfor ( i = start, il = end; i < il; i += 3 ) {\n\n\t\t\t\ta = index.getX( i );\n\t\t\t\tb = index.getX( i + 1 );\n\t\t\t\tc = index.getX( i + 2 );\n\n\t\t\t\t_calculateMorphedAttributeData(\n\t\t\t\t\tobject,\n\t\t\t\t\tpositionAttribute,\n\t\t\t\t\tmorphPosition,\n\t\t\t\t\tmorphTargetsRelative,\n\t\t\t\t\ta, b, c,\n\t\t\t\t\tmodifiedPosition\n\t\t\t\t);\n\n\t\t\t\t_calculateMorphedAttributeData(\n\t\t\t\t\tobject,\n\t\t\t\t\tnormalAttribute,\n\t\t\t\t\tmorphNormal,\n\t\t\t\t\tmorphTargetsRelative,\n\t\t\t\t\ta, b, c,\n\t\t\t\t\tmodifiedNormal\n\t\t\t\t);\n\n\t\t\t}\n\n\t\t}\n\n\t} else {\n\n\t\t// non-indexed buffer geometry\n\n\t\tif ( Array.isArray( material ) ) {\n\n\t\t\tfor ( i = 0, il = groups.length; i < il; i ++ ) {\n\n\t\t\t\tgroup = groups[ i ];\n\n\t\t\t\tstart = Math.max( group.start, drawRange.start );\n\t\t\t\tend = Math.min( ( group.start + group.count ), ( drawRange.start + drawRange.count ) );\n\n\t\t\t\tfor ( j = start, jl = end; j < jl; j += 3 ) {\n\n\t\t\t\t\ta = j;\n\t\t\t\t\tb = j + 1;\n\t\t\t\t\tc = j + 2;\n\n\t\t\t\t\t_calculateMorphedAttributeData(\n\t\t\t\t\t\tobject,\n\t\t\t\t\t\tpositionAttribute,\n\t\t\t\t\t\tmorphPosition,\n\t\t\t\t\t\tmorphTargetsRelative,\n\t\t\t\t\t\ta, b, c,\n\t\t\t\t\t\tmodifiedPosition\n\t\t\t\t\t);\n\n\t\t\t\t\t_calculateMorphedAttributeData(\n\t\t\t\t\t\tobject,\n\t\t\t\t\t\tnormalAttribute,\n\t\t\t\t\t\tmorphNormal,\n\t\t\t\t\t\tmorphTargetsRelative,\n\t\t\t\t\t\ta, b, c,\n\t\t\t\t\t\tmodifiedNormal\n\t\t\t\t\t);\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tstart = Math.max( 0, drawRange.start );\n\t\t\tend = Math.min( positionAttribute.count, ( drawRange.start + drawRange.count ) );\n\n\t\t\tfor ( i = start, il = end; i < il; i += 3 ) {\n\n\t\t\t\ta = i;\n\t\t\t\tb = i + 1;\n\t\t\t\tc = i + 2;\n\n\t\t\t\t_calculateMorphedAttributeData(\n\t\t\t\t\tobject,\n\t\t\t\t\tpositionAttribute,\n\t\t\t\t\tmorphPosition,\n\t\t\t\t\tmorphTargetsRelative,\n\t\t\t\t\ta, b, c,\n\t\t\t\t\tmodifiedPosition\n\t\t\t\t);\n\n\t\t\t\t_calculateMorphedAttributeData(\n\t\t\t\t\tobject,\n\t\t\t\t\tnormalAttribute,\n\t\t\t\t\tmorphNormal,\n\t\t\t\t\tmorphTargetsRelative,\n\t\t\t\t\ta, b, c,\n\t\t\t\t\tmodifiedNormal\n\t\t\t\t);\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\tconst morphedPositionAttribute = new Float32BufferAttribute( modifiedPosition, 3 );\n\tconst morphedNormalAttribute = new Float32BufferAttribute( modifiedNormal, 3 );\n\n\treturn {\n\n\t\tpositionAttribute: positionAttribute,\n\t\tnormalAttribute: normalAttribute,\n\t\tmorphedPositionAttribute: morphedPositionAttribute,\n\t\tmorphedNormalAttribute: morphedNormalAttribute\n\n\t};\n\n}\n\nfunction mergeGroups( geometry ) {\n\n\tif ( geometry.groups.length === 0 ) {\n\n\t\tconsole.warn( 'THREE.BufferGeometryUtils.mergeGroups(): No groups are defined. Nothing to merge.' );\n\t\treturn geometry;\n\n\t}\n\n\tlet groups = geometry.groups;\n\n\t// sort groups by material index\n\n\tgroups = groups.sort( ( a, b ) => {\n\n\t\tif ( a.materialIndex !== b.materialIndex ) return a.materialIndex - b.materialIndex;\n\n\t\treturn a.start - b.start;\n\n\t} );\n\n\t// create index for non-indexed geometries\n\n\tif ( geometry.getIndex() === null ) {\n\n\t\tconst positionAttribute = geometry.getAttribute( 'position' );\n\t\tconst indices = [];\n\n\t\tfor ( let i = 0; i < positionAttribute.count; i += 3 ) {\n\n\t\t\tindices.push( i, i + 1, i + 2 );\n\n\t\t}\n\n\t\tgeometry.setIndex( indices );\n\n\t}\n\n\t// sort index\n\n\tconst index = geometry.getIndex();\n\n\tconst newIndices = [];\n\n\tfor ( let i = 0; i < groups.length; i ++ ) {\n\n\t\tconst group = groups[ i ];\n\n\t\tconst groupStart = group.start;\n\t\tconst groupLength = groupStart + group.count;\n\n\t\tfor ( let j = groupStart; j < groupLength; j ++ ) {\n\n\t\t\tnewIndices.push( index.getX( j ) );\n\n\t\t}\n\n\t}\n\n\tgeometry.dispose(); // Required to force buffer recreation\n\tgeometry.setIndex( newIndices );\n\n\t// update groups indices\n\n\tlet start = 0;\n\n\tfor ( let i = 0; i < groups.length; i ++ ) {\n\n\t\tconst group = groups[ i ];\n\n\t\tgroup.start = start;\n\t\tstart += group.count;\n\n\t}\n\n\t// merge groups\n\n\tlet currentGroup = groups[ 0 ];\n\n\tgeometry.groups = [ currentGroup ];\n\n\tfor ( let i = 1; i < groups.length; i ++ ) {\n\n\t\tconst group = groups[ i ];\n\n\t\tif ( currentGroup.materialIndex === group.materialIndex ) {\n\n\t\t\tcurrentGroup.count += group.count;\n\n\t\t} else {\n\n\t\t\tcurrentGroup = group;\n\t\t\tgeometry.groups.push( currentGroup );\n\n\t\t}\n\n\t}\n\n\treturn geometry;\n\n}\n\n\n// Creates a new, non-indexed geometry with smooth normals everywhere except faces that meet at\n// an angle greater than the crease angle.\nfunction toCreasedNormals( geometry, creaseAngle = Math.PI / 3 /* 60 degrees */ ) {\n\n\tconst creaseDot = Math.cos( creaseAngle );\n\tconst hashMultiplier = ( 1 + 1e-10 ) * 1e2;\n\n\t// reusable vertors\n\tconst verts = [ new Vector3(), new Vector3(), new Vector3() ];\n\tconst tempVec1 = new Vector3();\n\tconst tempVec2 = new Vector3();\n\tconst tempNorm = new Vector3();\n\tconst tempNorm2 = new Vector3();\n\n\t// hashes a vector\n\tfunction hashVertex( v ) {\n\n\t\tconst x = ~ ~ ( v.x * hashMultiplier );\n\t\tconst y = ~ ~ ( v.y * hashMultiplier );\n\t\tconst z = ~ ~ ( v.z * hashMultiplier );\n\t\treturn `${x},${y},${z}`;\n\n\t}\n\n\tconst resultGeometry = geometry.toNonIndexed();\n\tconst posAttr = resultGeometry.attributes.position;\n\tconst vertexMap = {};\n\n\t// find all the normals shared by commonly located vertices\n\tfor ( let i = 0, l = posAttr.count / 3; i < l; i ++ ) {\n\n\t\tconst i3 = 3 * i;\n\t\tconst a = verts[ 0 ].fromBufferAttribute( posAttr, i3 + 0 );\n\t\tconst b = verts[ 1 ].fromBufferAttribute( posAttr, i3 + 1 );\n\t\tconst c = verts[ 2 ].fromBufferAttribute( posAttr, i3 + 2 );\n\n\t\ttempVec1.subVectors( c, b );\n\t\ttempVec2.subVectors( a, b );\n\n\t\t// add the normal to the map for all vertices\n\t\tconst normal = new Vector3().crossVectors( tempVec1, tempVec2 ).normalize();\n\t\tfor ( let n = 0; n < 3; n ++ ) {\n\n\t\t\tconst vert = verts[ n ];\n\t\t\tconst hash = hashVertex( vert );\n\t\t\tif ( ! ( hash in vertexMap ) ) {\n\n\t\t\t\tvertexMap[ hash ] = [];\n\n\t\t\t}\n\n\t\t\tvertexMap[ hash ].push( normal );\n\n\t\t}\n\n\t}\n\n\t// average normals from all vertices that share a common location if they are within the\n\t// provided crease threshold\n\tconst normalArray = new Float32Array( posAttr.count * 3 );\n\tconst normAttr = new BufferAttribute( normalArray, 3, false );\n\tfor ( let i = 0, l = posAttr.count / 3; i < l; i ++ ) {\n\n\t\t// get the face normal for this vertex\n\t\tconst i3 = 3 * i;\n\t\tconst a = verts[ 0 ].fromBufferAttribute( posAttr, i3 + 0 );\n\t\tconst b = verts[ 1 ].fromBufferAttribute( posAttr, i3 + 1 );\n\t\tconst c = verts[ 2 ].fromBufferAttribute( posAttr, i3 + 2 );\n\n\t\ttempVec1.subVectors( c, b );\n\t\ttempVec2.subVectors( a, b );\n\n\t\ttempNorm.crossVectors( tempVec1, tempVec2 ).normalize();\n\n\t\t// average all normals that meet the threshold and set the normal value\n\t\tfor ( let n = 0; n < 3; n ++ ) {\n\n\t\t\tconst vert = verts[ n ];\n\t\t\tconst hash = hashVertex( vert );\n\t\t\tconst otherNormals = vertexMap[ hash ];\n\t\t\ttempNorm2.set( 0, 0, 0 );\n\n\t\t\tfor ( let k = 0, lk = otherNormals.length; k < lk; k ++ ) {\n\n\t\t\t\tconst otherNorm = otherNormals[ k ];\n\t\t\t\tif ( tempNorm.dot( otherNorm ) > creaseDot ) {\n\n\t\t\t\t\ttempNorm2.add( otherNorm );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\ttempNorm2.normalize();\n\t\t\tnormAttr.setXYZ( i3 + n, tempNorm2.x, tempNorm2.y, tempNorm2.z );\n\n\t\t}\n\n\t}\n\n\tresultGeometry.setAttribute( 'normal', normAttr );\n\treturn resultGeometry;\n\n}\n\nexport {\n\tcomputeTangents,\n\tcomputeMikkTSpaceTangents,\n\tmergeBufferGeometries,\n\tmergeBufferAttributes,\n\tinterleaveAttributes,\n\testimateBytesUsed,\n\tmergeVertices,\n\ttoTrianglesDrawMode,\n\tcomputeMorphedAttributes,\n\tmergeGroups,\n\ttoCreasedNormals\n};\n","import {\n\tAnimationClip,\n\tBone,\n\tBox3,\n\tBufferAttribute,\n\tBufferGeometry,\n\tClampToEdgeWrapping,\n\tColor,\n\tDirectionalLight,\n\tDoubleSide,\n\tFileLoader,\n\tFrontSide,\n\tGroup,\n\tImageBitmapLoader,\n\tInstancedMesh,\n\tInterleavedBuffer,\n\tInterleavedBufferAttribute,\n\tInterpolant,\n\tInterpolateDiscrete,\n\tInterpolateLinear,\n\tLine,\n\tLineBasicMaterial,\n\tLineLoop,\n\tLineSegments,\n\tLinearFilter,\n\tLinearMipmapLinearFilter,\n\tLinearMipmapNearestFilter,\n\tLoader,\n\tLoaderUtils,\n\tMaterial,\n\tMathUtils,\n\tMatrix4,\n\tMesh,\n\tMeshBasicMaterial,\n\tMeshPhysicalMaterial,\n\tMeshStandardMaterial,\n\tMirroredRepeatWrapping,\n\tNearestFilter,\n\tNearestMipmapLinearFilter,\n\tNearestMipmapNearestFilter,\n\tNumberKeyframeTrack,\n\tObject3D,\n\tOrthographicCamera,\n\tPerspectiveCamera,\n\tPointLight,\n\tPoints,\n\tPointsMaterial,\n\tPropertyBinding,\n\tQuaternion,\n\tQuaternionKeyframeTrack,\n\tRepeatWrapping,\n\tSkeleton,\n\tSkinnedMesh,\n\tSphere,\n\tSpotLight,\n\tTexture,\n\tTextureLoader,\n\tTriangleFanDrawMode,\n\tTriangleStripDrawMode,\n\tVector2,\n\tVector3,\n\tVectorKeyframeTrack,\n\tsRGBEncoding\n} from 'three';\nimport { toTrianglesDrawMode } from '../utils/BufferGeometryUtils.js';\n\nclass GLTFLoader extends Loader {\n\n\tconstructor( manager ) {\n\n\t\tsuper( manager );\n\n\t\tthis.dracoLoader = null;\n\t\tthis.ktx2Loader = null;\n\t\tthis.meshoptDecoder = null;\n\n\t\tthis.pluginCallbacks = [];\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsClearcoatExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFTextureBasisUExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFTextureWebPExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsSheenExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsTransmissionExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsVolumeExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsIorExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsEmissiveStrengthExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsSpecularExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsIridescenceExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFLightsExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMeshoptCompression( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMeshGpuInstancing( parser );\n\n\t\t} );\n\n\t}\n\n\tload( url, onLoad, onProgress, onError ) {\n\n\t\tconst scope = this;\n\n\t\tlet resourcePath;\n\n\t\tif ( this.resourcePath !== '' ) {\n\n\t\t\tresourcePath = this.resourcePath;\n\n\t\t} else if ( this.path !== '' ) {\n\n\t\t\tresourcePath = this.path;\n\n\t\t} else {\n\n\t\t\tresourcePath = LoaderUtils.extractUrlBase( url );\n\n\t\t}\n\n\t\t// Tells the LoadingManager to track an extra item, which resolves after\n\t\t// the model is fully loaded. This means the count of items loaded will\n\t\t// be incorrect, but ensures manager.onLoad() does not fire early.\n\t\tthis.manager.itemStart( url );\n\n\t\tconst _onError = function ( e ) {\n\n\t\t\tif ( onError ) {\n\n\t\t\t\tonError( e );\n\n\t\t\t} else {\n\n\t\t\t\tconsole.error( e );\n\n\t\t\t}\n\n\t\t\tscope.manager.itemError( url );\n\t\t\tscope.manager.itemEnd( url );\n\n\t\t};\n\n\t\tconst loader = new FileLoader( this.manager );\n\n\t\tloader.setPath( this.path );\n\t\tloader.setResponseType( 'arraybuffer' );\n\t\tloader.setRequestHeader( this.requestHeader );\n\t\tloader.setWithCredentials( this.withCredentials );\n\n\t\tloader.load( url, function ( data ) {\n\n\t\t\ttry {\n\n\t\t\t\tscope.parse( data, resourcePath, function ( gltf ) {\n\n\t\t\t\t\tonLoad( gltf );\n\n\t\t\t\t\tscope.manager.itemEnd( url );\n\n\t\t\t\t}, _onError );\n\n\t\t\t} catch ( e ) {\n\n\t\t\t\t_onError( e );\n\n\t\t\t}\n\n\t\t}, onProgress, _onError );\n\n\t}\n\n\tsetDRACOLoader( dracoLoader ) {\n\n\t\tthis.dracoLoader = dracoLoader;\n\t\treturn this;\n\n\t}\n\n\tsetDDSLoader() {\n\n\t\tthrow new Error(\n\n\t\t\t'THREE.GLTFLoader: \"MSFT_texture_dds\" no longer supported. Please update to \"KHR_texture_basisu\".'\n\n\t\t);\n\n\t}\n\n\tsetKTX2Loader( ktx2Loader ) {\n\n\t\tthis.ktx2Loader = ktx2Loader;\n\t\treturn this;\n\n\t}\n\n\tsetMeshoptDecoder( meshoptDecoder ) {\n\n\t\tthis.meshoptDecoder = meshoptDecoder;\n\t\treturn this;\n\n\t}\n\n\tregister( callback ) {\n\n\t\tif ( this.pluginCallbacks.indexOf( callback ) === - 1 ) {\n\n\t\t\tthis.pluginCallbacks.push( callback );\n\n\t\t}\n\n\t\treturn this;\n\n\t}\n\n\tunregister( callback ) {\n\n\t\tif ( this.pluginCallbacks.indexOf( callback ) !== - 1 ) {\n\n\t\t\tthis.pluginCallbacks.splice( this.pluginCallbacks.indexOf( callback ), 1 );\n\n\t\t}\n\n\t\treturn this;\n\n\t}\n\n\tparse( data, path, onLoad, onError ) {\n\n\t\tlet json;\n\t\tconst extensions = {};\n\t\tconst plugins = {};\n\t\tconst textDecoder = new TextDecoder();\n\n\t\tif ( typeof data === 'string' ) {\n\n\t\t\tjson = JSON.parse( data );\n\n\t\t} else if ( data instanceof ArrayBuffer ) {\n\n\t\t\tconst magic = textDecoder.decode( new Uint8Array( data, 0, 4 ) );\n\n\t\t\tif ( magic === BINARY_EXTENSION_HEADER_MAGIC ) {\n\n\t\t\t\ttry {\n\n\t\t\t\t\textensions[ EXTENSIONS.KHR_BINARY_GLTF ] = new GLTFBinaryExtension( data );\n\n\t\t\t\t} catch ( error ) {\n\n\t\t\t\t\tif ( onError ) onError( error );\n\t\t\t\t\treturn;\n\n\t\t\t\t}\n\n\t\t\t\tjson = JSON.parse( extensions[ EXTENSIONS.KHR_BINARY_GLTF ].content );\n\n\t\t\t} else {\n\n\t\t\t\tjson = JSON.parse( textDecoder.decode( data ) );\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tjson = data;\n\n\t\t}\n\n\t\tif ( json.asset === undefined || json.asset.version[ 0 ] < 2 ) {\n\n\t\t\tif ( onError ) onError( new Error( 'THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.' ) );\n\t\t\treturn;\n\n\t\t}\n\n\t\tconst parser = new GLTFParser( json, {\n\n\t\t\tpath: path || this.resourcePath || '',\n\t\t\tcrossOrigin: this.crossOrigin,\n\t\t\trequestHeader: this.requestHeader,\n\t\t\tmanager: this.manager,\n\t\t\tktx2Loader: this.ktx2Loader,\n\t\t\tmeshoptDecoder: this.meshoptDecoder\n\n\t\t} );\n\n\t\tparser.fileLoader.setRequestHeader( this.requestHeader );\n\n\t\tfor ( let i = 0; i < this.pluginCallbacks.length; i ++ ) {\n\n\t\t\tconst plugin = this.pluginCallbacks[ i ]( parser );\n\t\t\tplugins[ plugin.name ] = plugin;\n\n\t\t\t// Workaround to avoid determining as unknown extension\n\t\t\t// in addUnknownExtensionsToUserData().\n\t\t\t// Remove this workaround if we move all the existing\n\t\t\t// extension handlers to plugin system\n\t\t\textensions[ plugin.name ] = true;\n\n\t\t}\n\n\t\tif ( json.extensionsUsed ) {\n\n\t\t\tfor ( let i = 0; i < json.extensionsUsed.length; ++ i ) {\n\n\t\t\t\tconst extensionName = json.extensionsUsed[ i ];\n\t\t\t\tconst extensionsRequired = json.extensionsRequired || [];\n\n\t\t\t\tswitch ( extensionName ) {\n\n\t\t\t\t\tcase EXTENSIONS.KHR_MATERIALS_UNLIT:\n\t\t\t\t\t\textensions[ extensionName ] = new GLTFMaterialsUnlitExtension();\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase EXTENSIONS.KHR_DRACO_MESH_COMPRESSION:\n\t\t\t\t\t\textensions[ extensionName ] = new GLTFDracoMeshCompressionExtension( json, this.dracoLoader );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase EXTENSIONS.KHR_TEXTURE_TRANSFORM:\n\t\t\t\t\t\textensions[ extensionName ] = new GLTFTextureTransformExtension();\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase EXTENSIONS.KHR_MESH_QUANTIZATION:\n\t\t\t\t\t\textensions[ extensionName ] = new GLTFMeshQuantizationExtension();\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\n\t\t\t\t\t\tif ( extensionsRequired.indexOf( extensionName ) >= 0 && plugins[ extensionName ] === undefined ) {\n\n\t\t\t\t\t\t\tconsole.warn( 'THREE.GLTFLoader: Unknown extension \"' + extensionName + '\".' );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tparser.setExtensions( extensions );\n\t\tparser.setPlugins( plugins );\n\t\tparser.parse( onLoad, onError );\n\n\t}\n\n\tparseAsync( data, path ) {\n\n\t\tconst scope = this;\n\n\t\treturn new Promise( function ( resolve, reject ) {\n\n\t\t\tscope.parse( data, path, resolve, reject );\n\n\t\t} );\n\n\t}\n\n}\n\n/* GLTFREGISTRY */\n\nfunction GLTFRegistry() {\n\n\tlet objects = {};\n\n\treturn\t{\n\n\t\tget: function ( key ) {\n\n\t\t\treturn objects[ key ];\n\n\t\t},\n\n\t\tadd: function ( key, object ) {\n\n\t\t\tobjects[ key ] = object;\n\n\t\t},\n\n\t\tremove: function ( key ) {\n\n\t\t\tdelete objects[ key ];\n\n\t\t},\n\n\t\tremoveAll: function () {\n\n\t\t\tobjects = {};\n\n\t\t}\n\n\t};\n\n}\n\n/*********************************/\n/********** EXTENSIONS ***********/\n/*********************************/\n\nconst EXTENSIONS = {\n\tKHR_BINARY_GLTF: 'KHR_binary_glTF',\n\tKHR_DRACO_MESH_COMPRESSION: 'KHR_draco_mesh_compression',\n\tKHR_LIGHTS_PUNCTUAL: 'KHR_lights_punctual',\n\tKHR_MATERIALS_CLEARCOAT: 'KHR_materials_clearcoat',\n\tKHR_MATERIALS_IOR: 'KHR_materials_ior',\n\tKHR_MATERIALS_SHEEN: 'KHR_materials_sheen',\n\tKHR_MATERIALS_SPECULAR: 'KHR_materials_specular',\n\tKHR_MATERIALS_TRANSMISSION: 'KHR_materials_transmission',\n\tKHR_MATERIALS_IRIDESCENCE: 'KHR_materials_iridescence',\n\tKHR_MATERIALS_UNLIT: 'KHR_materials_unlit',\n\tKHR_MATERIALS_VOLUME: 'KHR_materials_volume',\n\tKHR_TEXTURE_BASISU: 'KHR_texture_basisu',\n\tKHR_TEXTURE_TRANSFORM: 'KHR_texture_transform',\n\tKHR_MESH_QUANTIZATION: 'KHR_mesh_quantization',\n\tKHR_MATERIALS_EMISSIVE_STRENGTH: 'KHR_materials_emissive_strength',\n\tEXT_TEXTURE_WEBP: 'EXT_texture_webp',\n\tEXT_MESHOPT_COMPRESSION: 'EXT_meshopt_compression',\n\tEXT_MESH_GPU_INSTANCING: 'EXT_mesh_gpu_instancing'\n};\n\n/**\n * Punctual Lights Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_lights_punctual\n */\nclass GLTFLightsExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_LIGHTS_PUNCTUAL;\n\n\t\t// Object3D instance caches\n\t\tthis.cache = { refs: {}, uses: {} };\n\n\t}\n\n\t_markDefs() {\n\n\t\tconst parser = this.parser;\n\t\tconst nodeDefs = this.parser.json.nodes || [];\n\n\t\tfor ( let nodeIndex = 0, nodeLength = nodeDefs.length; nodeIndex < nodeLength; nodeIndex ++ ) {\n\n\t\t\tconst nodeDef = nodeDefs[ nodeIndex ];\n\n\t\t\tif ( nodeDef.extensions\n\t\t\t\t\t&& nodeDef.extensions[ this.name ]\n\t\t\t\t\t&& nodeDef.extensions[ this.name ].light !== undefined ) {\n\n\t\t\t\tparser._addNodeRef( this.cache, nodeDef.extensions[ this.name ].light );\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\t_loadLight( lightIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst cacheKey = 'light:' + lightIndex;\n\t\tlet dependency = parser.cache.get( cacheKey );\n\n\t\tif ( dependency ) return dependency;\n\n\t\tconst json = parser.json;\n\t\tconst extensions = ( json.extensions && json.extensions[ this.name ] ) || {};\n\t\tconst lightDefs = extensions.lights || [];\n\t\tconst lightDef = lightDefs[ lightIndex ];\n\t\tlet lightNode;\n\n\t\tconst color = new Color( 0xffffff );\n\n\t\tif ( lightDef.color !== undefined ) color.fromArray( lightDef.color );\n\n\t\tconst range = lightDef.range !== undefined ? lightDef.range : 0;\n\n\t\tswitch ( lightDef.type ) {\n\n\t\t\tcase 'directional':\n\t\t\t\tlightNode = new DirectionalLight( color );\n\t\t\t\tlightNode.target.position.set( 0, 0, - 1 );\n\t\t\t\tlightNode.add( lightNode.target );\n\t\t\t\tbreak;\n\n\t\t\tcase 'point':\n\t\t\t\tlightNode = new PointLight( color );\n\t\t\t\tlightNode.distance = range;\n\t\t\t\tbreak;\n\n\t\t\tcase 'spot':\n\t\t\t\tlightNode = new SpotLight( color );\n\t\t\t\tlightNode.distance = range;\n\t\t\t\t// Handle spotlight properties.\n\t\t\t\tlightDef.spot = lightDef.spot || {};\n\t\t\t\tlightDef.spot.innerConeAngle = lightDef.spot.innerConeAngle !== undefined ? lightDef.spot.innerConeAngle : 0;\n\t\t\t\tlightDef.spot.outerConeAngle = lightDef.spot.outerConeAngle !== undefined ? lightDef.spot.outerConeAngle : Math.PI / 4.0;\n\t\t\t\tlightNode.angle = lightDef.spot.outerConeAngle;\n\t\t\t\tlightNode.penumbra = 1.0 - lightDef.spot.innerConeAngle / lightDef.spot.outerConeAngle;\n\t\t\t\tlightNode.target.position.set( 0, 0, - 1 );\n\t\t\t\tlightNode.add( lightNode.target );\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tthrow new Error( 'THREE.GLTFLoader: Unexpected light type: ' + lightDef.type );\n\n\t\t}\n\n\t\t// Some lights (e.g. spot) default to a position other than the origin. Reset the position\n\t\t// here, because node-level parsing will only override position if explicitly specified.\n\t\tlightNode.position.set( 0, 0, 0 );\n\n\t\tlightNode.decay = 2;\n\n\t\tassignExtrasToUserData( lightNode, lightDef );\n\n\t\tif ( lightDef.intensity !== undefined ) lightNode.intensity = lightDef.intensity;\n\n\t\tlightNode.name = parser.createUniqueName( lightDef.name || ( 'light_' + lightIndex ) );\n\n\t\tdependency = Promise.resolve( lightNode );\n\n\t\tparser.cache.add( cacheKey, dependency );\n\n\t\treturn dependency;\n\n\t}\n\n\tgetDependency( type, index ) {\n\n\t\tif ( type !== 'light' ) return;\n\n\t\treturn this._loadLight( index );\n\n\t}\n\n\tcreateNodeAttachment( nodeIndex ) {\n\n\t\tconst self = this;\n\t\tconst parser = this.parser;\n\t\tconst json = parser.json;\n\t\tconst nodeDef = json.nodes[ nodeIndex ];\n\t\tconst lightDef = ( nodeDef.extensions && nodeDef.extensions[ this.name ] ) || {};\n\t\tconst lightIndex = lightDef.light;\n\n\t\tif ( lightIndex === undefined ) return null;\n\n\t\treturn this._loadLight( lightIndex ).then( function ( light ) {\n\n\t\t\treturn parser._getNodeRef( self.cache, lightIndex, light );\n\n\t\t} );\n\n\t}\n\n}\n\n/**\n * Unlit Materials Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_unlit\n */\nclass GLTFMaterialsUnlitExtension {\n\n\tconstructor() {\n\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_UNLIT;\n\n\t}\n\n\tgetMaterialType() {\n\n\t\treturn MeshBasicMaterial;\n\n\t}\n\n\textendParams( materialParams, materialDef, parser ) {\n\n\t\tconst pending = [];\n\n\t\tmaterialParams.color = new Color( 1.0, 1.0, 1.0 );\n\t\tmaterialParams.opacity = 1.0;\n\n\t\tconst metallicRoughness = materialDef.pbrMetallicRoughness;\n\n\t\tif ( metallicRoughness ) {\n\n\t\t\tif ( Array.isArray( metallicRoughness.baseColorFactor ) ) {\n\n\t\t\t\tconst array = metallicRoughness.baseColorFactor;\n\n\t\t\t\tmaterialParams.color.fromArray( array );\n\t\t\t\tmaterialParams.opacity = array[ 3 ];\n\n\t\t\t}\n\n\t\t\tif ( metallicRoughness.baseColorTexture !== undefined ) {\n\n\t\t\t\tpending.push( parser.assignTexture( materialParams, 'map', metallicRoughness.baseColorTexture, sRGBEncoding ) );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n}\n\n/**\n * Materials Emissive Strength Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/blob/5768b3ce0ef32bc39cdf1bef10b948586635ead3/extensions/2.0/Khronos/KHR_materials_emissive_strength/README.md\n */\nclass GLTFMaterialsEmissiveStrengthExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_EMISSIVE_STRENGTH;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst emissiveStrength = materialDef.extensions[ this.name ].emissiveStrength;\n\n\t\tif ( emissiveStrength !== undefined ) {\n\n\t\t\tmaterialParams.emissiveIntensity = emissiveStrength;\n\n\t\t}\n\n\t\treturn Promise.resolve();\n\n\t}\n\n}\n\n/**\n * Clearcoat Materials Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_clearcoat\n */\nclass GLTFMaterialsClearcoatExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_CLEARCOAT;\n\n\t}\n\n\tgetMaterialType( materialIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\n\n\t\treturn MeshPhysicalMaterial;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst pending = [];\n\n\t\tconst extension = materialDef.extensions[ this.name ];\n\n\t\tif ( extension.clearcoatFactor !== undefined ) {\n\n\t\t\tmaterialParams.clearcoat = extension.clearcoatFactor;\n\n\t\t}\n\n\t\tif ( extension.clearcoatTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'clearcoatMap', extension.clearcoatTexture ) );\n\n\t\t}\n\n\t\tif ( extension.clearcoatRoughnessFactor !== undefined ) {\n\n\t\t\tmaterialParams.clearcoatRoughness = extension.clearcoatRoughnessFactor;\n\n\t\t}\n\n\t\tif ( extension.clearcoatRoughnessTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'clearcoatRoughnessMap', extension.clearcoatRoughnessTexture ) );\n\n\t\t}\n\n\t\tif ( extension.clearcoatNormalTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'clearcoatNormalMap', extension.clearcoatNormalTexture ) );\n\n\t\t\tif ( extension.clearcoatNormalTexture.scale !== undefined ) {\n\n\t\t\t\tconst scale = extension.clearcoatNormalTexture.scale;\n\n\t\t\t\tmaterialParams.clearcoatNormalScale = new Vector2( scale, scale );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n}\n\n/**\n * Iridescence Materials Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_iridescence\n */\nclass GLTFMaterialsIridescenceExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_IRIDESCENCE;\n\n\t}\n\n\tgetMaterialType( materialIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\n\n\t\treturn MeshPhysicalMaterial;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst pending = [];\n\n\t\tconst extension = materialDef.extensions[ this.name ];\n\n\t\tif ( extension.iridescenceFactor !== undefined ) {\n\n\t\t\tmaterialParams.iridescence = extension.iridescenceFactor;\n\n\t\t}\n\n\t\tif ( extension.iridescenceTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'iridescenceMap', extension.iridescenceTexture ) );\n\n\t\t}\n\n\t\tif ( extension.iridescenceIor !== undefined ) {\n\n\t\t\tmaterialParams.iridescenceIOR = extension.iridescenceIor;\n\n\t\t}\n\n\t\tif ( materialParams.iridescenceThicknessRange === undefined ) {\n\n\t\t\tmaterialParams.iridescenceThicknessRange = [ 100, 400 ];\n\n\t\t}\n\n\t\tif ( extension.iridescenceThicknessMinimum !== undefined ) {\n\n\t\t\tmaterialParams.iridescenceThicknessRange[ 0 ] = extension.iridescenceThicknessMinimum;\n\n\t\t}\n\n\t\tif ( extension.iridescenceThicknessMaximum !== undefined ) {\n\n\t\t\tmaterialParams.iridescenceThicknessRange[ 1 ] = extension.iridescenceThicknessMaximum;\n\n\t\t}\n\n\t\tif ( extension.iridescenceThicknessTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'iridescenceThicknessMap', extension.iridescenceThicknessTexture ) );\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n}\n\n/**\n * Sheen Materials Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/main/extensions/2.0/Khronos/KHR_materials_sheen\n */\nclass GLTFMaterialsSheenExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_SHEEN;\n\n\t}\n\n\tgetMaterialType( materialIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\n\n\t\treturn MeshPhysicalMaterial;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst pending = [];\n\n\t\tmaterialParams.sheenColor = new Color( 0, 0, 0 );\n\t\tmaterialParams.sheenRoughness = 0;\n\t\tmaterialParams.sheen = 1;\n\n\t\tconst extension = materialDef.extensions[ this.name ];\n\n\t\tif ( extension.sheenColorFactor !== undefined ) {\n\n\t\t\tmaterialParams.sheenColor.fromArray( extension.sheenColorFactor );\n\n\t\t}\n\n\t\tif ( extension.sheenRoughnessFactor !== undefined ) {\n\n\t\t\tmaterialParams.sheenRoughness = extension.sheenRoughnessFactor;\n\n\t\t}\n\n\t\tif ( extension.sheenColorTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'sheenColorMap', extension.sheenColorTexture, sRGBEncoding ) );\n\n\t\t}\n\n\t\tif ( extension.sheenRoughnessTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'sheenRoughnessMap', extension.sheenRoughnessTexture ) );\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n}\n\n/**\n * Transmission Materials Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_transmission\n * Draft: https://github.com/KhronosGroup/glTF/pull/1698\n */\nclass GLTFMaterialsTransmissionExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_TRANSMISSION;\n\n\t}\n\n\tgetMaterialType( materialIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\n\n\t\treturn MeshPhysicalMaterial;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst pending = [];\n\n\t\tconst extension = materialDef.extensions[ this.name ];\n\n\t\tif ( extension.transmissionFactor !== undefined ) {\n\n\t\t\tmaterialParams.transmission = extension.transmissionFactor;\n\n\t\t}\n\n\t\tif ( extension.transmissionTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'transmissionMap', extension.transmissionTexture ) );\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n}\n\n/**\n * Materials Volume Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_volume\n */\nclass GLTFMaterialsVolumeExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_VOLUME;\n\n\t}\n\n\tgetMaterialType( materialIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\n\n\t\treturn MeshPhysicalMaterial;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst pending = [];\n\n\t\tconst extension = materialDef.extensions[ this.name ];\n\n\t\tmaterialParams.thickness = extension.thicknessFactor !== undefined ? extension.thicknessFactor : 0;\n\n\t\tif ( extension.thicknessTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'thicknessMap', extension.thicknessTexture ) );\n\n\t\t}\n\n\t\tmaterialParams.attenuationDistance = extension.attenuationDistance || Infinity;\n\n\t\tconst colorArray = extension.attenuationColor || [ 1, 1, 1 ];\n\t\tmaterialParams.attenuationColor = new Color( colorArray[ 0 ], colorArray[ 1 ], colorArray[ 2 ] );\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n}\n\n/**\n * Materials ior Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_ior\n */\nclass GLTFMaterialsIorExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_IOR;\n\n\t}\n\n\tgetMaterialType( materialIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\n\n\t\treturn MeshPhysicalMaterial;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst extension = materialDef.extensions[ this.name ];\n\n\t\tmaterialParams.ior = extension.ior !== undefined ? extension.ior : 1.5;\n\n\t\treturn Promise.resolve();\n\n\t}\n\n}\n\n/**\n * Materials specular Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_specular\n */\nclass GLTFMaterialsSpecularExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_SPECULAR;\n\n\t}\n\n\tgetMaterialType( materialIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\n\n\t\treturn MeshPhysicalMaterial;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst pending = [];\n\n\t\tconst extension = materialDef.extensions[ this.name ];\n\n\t\tmaterialParams.specularIntensity = extension.specularFactor !== undefined ? extension.specularFactor : 1.0;\n\n\t\tif ( extension.specularTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'specularIntensityMap', extension.specularTexture ) );\n\n\t\t}\n\n\t\tconst colorArray = extension.specularColorFactor || [ 1, 1, 1 ];\n\t\tmaterialParams.specularColor = new Color( colorArray[ 0 ], colorArray[ 1 ], colorArray[ 2 ] );\n\n\t\tif ( extension.specularColorTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'specularColorMap', extension.specularColorTexture, sRGBEncoding ) );\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n}\n\n/**\n * BasisU Texture Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_texture_basisu\n */\nclass GLTFTextureBasisUExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_TEXTURE_BASISU;\n\n\t}\n\n\tloadTexture( textureIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst json = parser.json;\n\n\t\tconst textureDef = json.textures[ textureIndex ];\n\n\t\tif ( ! textureDef.extensions || ! textureDef.extensions[ this.name ] ) {\n\n\t\t\treturn null;\n\n\t\t}\n\n\t\tconst extension = textureDef.extensions[ this.name ];\n\t\tconst loader = parser.options.ktx2Loader;\n\n\t\tif ( ! loader ) {\n\n\t\t\tif ( json.extensionsRequired && json.extensionsRequired.indexOf( this.name ) >= 0 ) {\n\n\t\t\t\tthrow new Error( 'THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures' );\n\n\t\t\t} else {\n\n\t\t\t\t// Assumes that the extension is optional and that a fallback texture is present\n\t\t\t\treturn null;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn parser.loadTextureImage( textureIndex, extension.source, loader );\n\n\t}\n\n}\n\n/**\n * WebP Texture Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/EXT_texture_webp\n */\nclass GLTFTextureWebPExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.EXT_TEXTURE_WEBP;\n\t\tthis.isSupported = null;\n\n\t}\n\n\tloadTexture( textureIndex ) {\n\n\t\tconst name = this.name;\n\t\tconst parser = this.parser;\n\t\tconst json = parser.json;\n\n\t\tconst textureDef = json.textures[ textureIndex ];\n\n\t\tif ( ! textureDef.extensions || ! textureDef.extensions[ name ] ) {\n\n\t\t\treturn null;\n\n\t\t}\n\n\t\tconst extension = textureDef.extensions[ name ];\n\t\tconst source = json.images[ extension.source ];\n\n\t\tlet loader = parser.textureLoader;\n\t\tif ( source.uri ) {\n\n\t\t\tconst handler = parser.options.manager.getHandler( source.uri );\n\t\t\tif ( handler !== null ) loader = handler;\n\n\t\t}\n\n\t\treturn this.detectSupport().then( function ( isSupported ) {\n\n\t\t\tif ( isSupported ) return parser.loadTextureImage( textureIndex, extension.source, loader );\n\n\t\t\tif ( json.extensionsRequired && json.extensionsRequired.indexOf( name ) >= 0 ) {\n\n\t\t\t\tthrow new Error( 'THREE.GLTFLoader: WebP required by asset but unsupported.' );\n\n\t\t\t}\n\n\t\t\t// Fall back to PNG or JPEG.\n\t\t\treturn parser.loadTexture( textureIndex );\n\n\t\t} );\n\n\t}\n\n\tdetectSupport() {\n\n\t\tif ( ! this.isSupported ) {\n\n\t\t\tthis.isSupported = new Promise( function ( resolve ) {\n\n\t\t\t\tconst image = new Image();\n\n\t\t\t\t// Lossy test image. Support for lossy images doesn't guarantee support for all\n\t\t\t\t// WebP images, unfortunately.\n\t\t\t\timage.src = 'data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA';\n\n\t\t\t\timage.onload = image.onerror = function () {\n\n\t\t\t\t\tresolve( image.height === 1 );\n\n\t\t\t\t};\n\n\t\t\t} );\n\n\t\t}\n\n\t\treturn this.isSupported;\n\n\t}\n\n}\n\n/**\n * meshopt BufferView Compression Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/EXT_meshopt_compression\n */\nclass GLTFMeshoptCompression {\n\n\tconstructor( parser ) {\n\n\t\tthis.name = EXTENSIONS.EXT_MESHOPT_COMPRESSION;\n\t\tthis.parser = parser;\n\n\t}\n\n\tloadBufferView( index ) {\n\n\t\tconst json = this.parser.json;\n\t\tconst bufferView = json.bufferViews[ index ];\n\n\t\tif ( bufferView.extensions && bufferView.extensions[ this.name ] ) {\n\n\t\t\tconst extensionDef = bufferView.extensions[ this.name ];\n\n\t\t\tconst buffer = this.parser.getDependency( 'buffer', extensionDef.buffer );\n\t\t\tconst decoder = this.parser.options.meshoptDecoder;\n\n\t\t\tif ( ! decoder || ! decoder.supported ) {\n\n\t\t\t\tif ( json.extensionsRequired && json.extensionsRequired.indexOf( this.name ) >= 0 ) {\n\n\t\t\t\t\tthrow new Error( 'THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files' );\n\n\t\t\t\t} else {\n\n\t\t\t\t\t// Assumes that the extension is optional and that fallback buffer data is present\n\t\t\t\t\treturn null;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn buffer.then( function ( res ) {\n\n\t\t\t\tconst byteOffset = extensionDef.byteOffset || 0;\n\t\t\t\tconst byteLength = extensionDef.byteLength || 0;\n\n\t\t\t\tconst count = extensionDef.count;\n\t\t\t\tconst stride = extensionDef.byteStride;\n\n\t\t\t\tconst source = new Uint8Array( res, byteOffset, byteLength );\n\n\t\t\t\tif ( decoder.decodeGltfBufferAsync ) {\n\n\t\t\t\t\treturn decoder.decodeGltfBufferAsync( count, stride, source, extensionDef.mode, extensionDef.filter ).then( function ( res ) {\n\n\t\t\t\t\t\treturn res.buffer;\n\n\t\t\t\t\t} );\n\n\t\t\t\t} else {\n\n\t\t\t\t\t// Support for MeshoptDecoder 0.18 or earlier, without decodeGltfBufferAsync\n\t\t\t\t\treturn decoder.ready.then( function () {\n\n\t\t\t\t\t\tconst result = new ArrayBuffer( count * stride );\n\t\t\t\t\t\tdecoder.decodeGltfBuffer( new Uint8Array( result ), count, stride, source, extensionDef.mode, extensionDef.filter );\n\t\t\t\t\t\treturn result;\n\n\t\t\t\t\t} );\n\n\t\t\t\t}\n\n\t\t\t} );\n\n\t\t} else {\n\n\t\t\treturn null;\n\n\t\t}\n\n\t}\n\n}\n\n/**\n * GPU Instancing Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/EXT_mesh_gpu_instancing\n *\n */\nclass GLTFMeshGpuInstancing {\n\n\tconstructor( parser ) {\n\n\t\tthis.name = EXTENSIONS.EXT_MESH_GPU_INSTANCING;\n\t\tthis.parser = parser;\n\n\t}\n\n\tcreateNodeMesh( nodeIndex ) {\n\n\t\tconst json = this.parser.json;\n\t\tconst nodeDef = json.nodes[ nodeIndex ];\n\n\t\tif ( ! nodeDef.extensions || ! nodeDef.extensions[ this.name ] ||\n\t\t\tnodeDef.mesh === undefined ) {\n\n\t\t\treturn null;\n\n\t\t}\n\n\t\tconst meshDef = json.meshes[ nodeDef.mesh ];\n\n\t\t// No Points or Lines + Instancing support yet\n\n\t\tfor ( const primitive of meshDef.primitives ) {\n\n\t\t\tif ( primitive.mode !== WEBGL_CONSTANTS.TRIANGLES &&\n\t\t\t\t primitive.mode !== WEBGL_CONSTANTS.TRIANGLE_STRIP &&\n\t\t\t\t primitive.mode !== WEBGL_CONSTANTS.TRIANGLE_FAN &&\n\t\t\t\t primitive.mode !== undefined ) {\n\n\t\t\t\treturn null;\n\n\t\t\t}\n\n\t\t}\n\n\t\tconst extensionDef = nodeDef.extensions[ this.name ];\n\t\tconst attributesDef = extensionDef.attributes;\n\n\t\t// @TODO: Can we support InstancedMesh + SkinnedMesh?\n\n\t\tconst pending = [];\n\t\tconst attributes = {};\n\n\t\tfor ( const key in attributesDef ) {\n\n\t\t\tpending.push( this.parser.getDependency( 'accessor', attributesDef[ key ] ).then( accessor => {\n\n\t\t\t\tattributes[ key ] = accessor;\n\t\t\t\treturn attributes[ key ];\n\n\t\t\t} ) );\n\n\t\t}\n\n\t\tif ( pending.length < 1 ) {\n\n\t\t\treturn null;\n\n\t\t}\n\n\t\tpending.push( this.parser.createNodeMesh( nodeIndex ) );\n\n\t\treturn Promise.all( pending ).then( results => {\n\n\t\t\tconst nodeObject = results.pop();\n\t\t\tconst meshes = nodeObject.isGroup ? nodeObject.children : [ nodeObject ];\n\t\t\tconst count = results[ 0 ].count; // All attribute counts should be same\n\t\t\tconst instancedMeshes = [];\n\n\t\t\tfor ( const mesh of meshes ) {\n\n\t\t\t\t// Temporal variables\n\t\t\t\tconst m = new Matrix4();\n\t\t\t\tconst p = new Vector3();\n\t\t\t\tconst q = new Quaternion();\n\t\t\t\tconst s = new Vector3( 1, 1, 1 );\n\n\t\t\t\tconst instancedMesh = new InstancedMesh( mesh.geometry, mesh.material, count );\n\n\t\t\t\tfor ( let i = 0; i < count; i ++ ) {\n\n\t\t\t\t\tif ( attributes.TRANSLATION ) {\n\n\t\t\t\t\t\tp.fromBufferAttribute( attributes.TRANSLATION, i );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( attributes.ROTATION ) {\n\n\t\t\t\t\t\tq.fromBufferAttribute( attributes.ROTATION, i );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( attributes.SCALE ) {\n\n\t\t\t\t\t\ts.fromBufferAttribute( attributes.SCALE, i );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tinstancedMesh.setMatrixAt( i, m.compose( p, q, s ) );\n\n\t\t\t\t}\n\n\t\t\t\t// Add instance attributes to the geometry, excluding TRS.\n\t\t\t\tfor ( const attributeName in attributes ) {\n\n\t\t\t\t\tif ( attributeName !== 'TRANSLATION' &&\n\t\t\t\t\t\t attributeName !== 'ROTATION' &&\n\t\t\t\t\t\t attributeName !== 'SCALE' ) {\n\n\t\t\t\t\t\tmesh.geometry.setAttribute( attributeName, attributes[ attributeName ] );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\t// Just in case\n\t\t\t\tObject3D.prototype.copy.call( instancedMesh, mesh );\n\n\t\t\t\t// https://github.com/mrdoob/three.js/issues/18334\n\t\t\t\tinstancedMesh.frustumCulled = false;\n\t\t\t\tthis.parser.assignFinalMaterial( instancedMesh );\n\n\t\t\t\tinstancedMeshes.push( instancedMesh );\n\n\t\t\t}\n\n\t\t\tif ( nodeObject.isGroup ) {\n\n\t\t\t\tnodeObject.clear();\n\n\t\t\t\tnodeObject.add( ... instancedMeshes );\n\n\t\t\t\treturn nodeObject;\n\n\t\t\t}\n\n\t\t\treturn instancedMeshes[ 0 ];\n\n\t\t} );\n\n\t}\n\n}\n\n/* BINARY EXTENSION */\nconst BINARY_EXTENSION_HEADER_MAGIC = 'glTF';\nconst BINARY_EXTENSION_HEADER_LENGTH = 12;\nconst BINARY_EXTENSION_CHUNK_TYPES = { JSON: 0x4E4F534A, BIN: 0x004E4942 };\n\nclass GLTFBinaryExtension {\n\n\tconstructor( data ) {\n\n\t\tthis.name = EXTENSIONS.KHR_BINARY_GLTF;\n\t\tthis.content = null;\n\t\tthis.body = null;\n\n\t\tconst headerView = new DataView( data, 0, BINARY_EXTENSION_HEADER_LENGTH );\n\t\tconst textDecoder = new TextDecoder();\n\n\t\tthis.header = {\n\t\t\tmagic: textDecoder.decode( new Uint8Array( data.slice( 0, 4 ) ) ),\n\t\t\tversion: headerView.getUint32( 4, true ),\n\t\t\tlength: headerView.getUint32( 8, true )\n\t\t};\n\n\t\tif ( this.header.magic !== BINARY_EXTENSION_HEADER_MAGIC ) {\n\n\t\t\tthrow new Error( 'THREE.GLTFLoader: Unsupported glTF-Binary header.' );\n\n\t\t} else if ( this.header.version < 2.0 ) {\n\n\t\t\tthrow new Error( 'THREE.GLTFLoader: Legacy binary file detected.' );\n\n\t\t}\n\n\t\tconst chunkContentsLength = this.header.length - BINARY_EXTENSION_HEADER_LENGTH;\n\t\tconst chunkView = new DataView( data, BINARY_EXTENSION_HEADER_LENGTH );\n\t\tlet chunkIndex = 0;\n\n\t\twhile ( chunkIndex < chunkContentsLength ) {\n\n\t\t\tconst chunkLength = chunkView.getUint32( chunkIndex, true );\n\t\t\tchunkIndex += 4;\n\n\t\t\tconst chunkType = chunkView.getUint32( chunkIndex, true );\n\t\t\tchunkIndex += 4;\n\n\t\t\tif ( chunkType === BINARY_EXTENSION_CHUNK_TYPES.JSON ) {\n\n\t\t\t\tconst contentArray = new Uint8Array( data, BINARY_EXTENSION_HEADER_LENGTH + chunkIndex, chunkLength );\n\t\t\t\tthis.content = textDecoder.decode( contentArray );\n\n\t\t\t} else if ( chunkType === BINARY_EXTENSION_CHUNK_TYPES.BIN ) {\n\n\t\t\t\tconst byteOffset = BINARY_EXTENSION_HEADER_LENGTH + chunkIndex;\n\t\t\t\tthis.body = data.slice( byteOffset, byteOffset + chunkLength );\n\n\t\t\t}\n\n\t\t\t// Clients must ignore chunks with unknown types.\n\n\t\t\tchunkIndex += chunkLength;\n\n\t\t}\n\n\t\tif ( this.content === null ) {\n\n\t\t\tthrow new Error( 'THREE.GLTFLoader: JSON content not found.' );\n\n\t\t}\n\n\t}\n\n}\n\n/**\n * DRACO Mesh Compression Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_draco_mesh_compression\n */\nclass GLTFDracoMeshCompressionExtension {\n\n\tconstructor( json, dracoLoader ) {\n\n\t\tif ( ! dracoLoader ) {\n\n\t\t\tthrow new Error( 'THREE.GLTFLoader: No DRACOLoader instance provided.' );\n\n\t\t}\n\n\t\tthis.name = EXTENSIONS.KHR_DRACO_MESH_COMPRESSION;\n\t\tthis.json = json;\n\t\tthis.dracoLoader = dracoLoader;\n\t\tthis.dracoLoader.preload();\n\n\t}\n\n\tdecodePrimitive( primitive, parser ) {\n\n\t\tconst json = this.json;\n\t\tconst dracoLoader = this.dracoLoader;\n\t\tconst bufferViewIndex = primitive.extensions[ this.name ].bufferView;\n\t\tconst gltfAttributeMap = primitive.extensions[ this.name ].attributes;\n\t\tconst threeAttributeMap = {};\n\t\tconst attributeNormalizedMap = {};\n\t\tconst attributeTypeMap = {};\n\n\t\tfor ( const attributeName in gltfAttributeMap ) {\n\n\t\t\tconst threeAttributeName = ATTRIBUTES[ attributeName ] || attributeName.toLowerCase();\n\n\t\t\tthreeAttributeMap[ threeAttributeName ] = gltfAttributeMap[ attributeName ];\n\n\t\t}\n\n\t\tfor ( const attributeName in primitive.attributes ) {\n\n\t\t\tconst threeAttributeName = ATTRIBUTES[ attributeName ] || attributeName.toLowerCase();\n\n\t\t\tif ( gltfAttributeMap[ attributeName ] !== undefined ) {\n\n\t\t\t\tconst accessorDef = json.accessors[ primitive.attributes[ attributeName ] ];\n\t\t\t\tconst componentType = WEBGL_COMPONENT_TYPES[ accessorDef.componentType ];\n\n\t\t\t\tattributeTypeMap[ threeAttributeName ] = componentType.name;\n\t\t\t\tattributeNormalizedMap[ threeAttributeName ] = accessorDef.normalized === true;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn parser.getDependency( 'bufferView', bufferViewIndex ).then( function ( bufferView ) {\n\n\t\t\treturn new Promise( function ( resolve ) {\n\n\t\t\t\tdracoLoader.decodeDracoFile( bufferView, function ( geometry ) {\n\n\t\t\t\t\tfor ( const attributeName in geometry.attributes ) {\n\n\t\t\t\t\t\tconst attribute = geometry.attributes[ attributeName ];\n\t\t\t\t\t\tconst normalized = attributeNormalizedMap[ attributeName ];\n\n\t\t\t\t\t\tif ( normalized !== undefined ) attribute.normalized = normalized;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tresolve( geometry );\n\n\t\t\t\t}, threeAttributeMap, attributeTypeMap );\n\n\t\t\t} );\n\n\t\t} );\n\n\t}\n\n}\n\n/**\n * Texture Transform Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_texture_transform\n */\nclass GLTFTextureTransformExtension {\n\n\tconstructor() {\n\n\t\tthis.name = EXTENSIONS.KHR_TEXTURE_TRANSFORM;\n\n\t}\n\n\textendTexture( texture, transform ) {\n\n\t\tif ( transform.texCoord !== undefined ) {\n\n\t\t\tconsole.warn( 'THREE.GLTFLoader: Custom UV sets in \"' + this.name + '\" extension not yet supported.' );\n\n\t\t}\n\n\t\tif ( transform.offset === undefined && transform.rotation === undefined && transform.scale === undefined ) {\n\n\t\t\t// See https://github.com/mrdoob/three.js/issues/21819.\n\t\t\treturn texture;\n\n\t\t}\n\n\t\ttexture = texture.clone();\n\n\t\tif ( transform.offset !== undefined ) {\n\n\t\t\ttexture.offset.fromArray( transform.offset );\n\n\t\t}\n\n\t\tif ( transform.rotation !== undefined ) {\n\n\t\t\ttexture.rotation = transform.rotation;\n\n\t\t}\n\n\t\tif ( transform.scale !== undefined ) {\n\n\t\t\ttexture.repeat.fromArray( transform.scale );\n\n\t\t}\n\n\t\ttexture.needsUpdate = true;\n\n\t\treturn texture;\n\n\t}\n\n}\n\n/**\n * Mesh Quantization Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_mesh_quantization\n */\nclass GLTFMeshQuantizationExtension {\n\n\tconstructor() {\n\n\t\tthis.name = EXTENSIONS.KHR_MESH_QUANTIZATION;\n\n\t}\n\n}\n\n/*********************************/\n/********** INTERPOLATION ********/\n/*********************************/\n\n// Spline Interpolation\n// Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#appendix-c-spline-interpolation\nclass GLTFCubicSplineInterpolant extends Interpolant {\n\n\tconstructor( parameterPositions, sampleValues, sampleSize, resultBuffer ) {\n\n\t\tsuper( parameterPositions, sampleValues, sampleSize, resultBuffer );\n\n\t}\n\n\tcopySampleValue_( index ) {\n\n\t\t// Copies a sample value to the result buffer. See description of glTF\n\t\t// CUBICSPLINE values layout in interpolate_() function below.\n\n\t\tconst result = this.resultBuffer,\n\t\t\tvalues = this.sampleValues,\n\t\t\tvalueSize = this.valueSize,\n\t\t\toffset = index * valueSize * 3 + valueSize;\n\n\t\tfor ( let i = 0; i !== valueSize; i ++ ) {\n\n\t\t\tresult[ i ] = values[ offset + i ];\n\n\t\t}\n\n\t\treturn result;\n\n\t}\n\n\tinterpolate_( i1, t0, t, t1 ) {\n\n\t\tconst result = this.resultBuffer;\n\t\tconst values = this.sampleValues;\n\t\tconst stride = this.valueSize;\n\n\t\tconst stride2 = stride * 2;\n\t\tconst stride3 = stride * 3;\n\n\t\tconst td = t1 - t0;\n\n\t\tconst p = ( t - t0 ) / td;\n\t\tconst pp = p * p;\n\t\tconst ppp = pp * p;\n\n\t\tconst offset1 = i1 * stride3;\n\t\tconst offset0 = offset1 - stride3;\n\n\t\tconst s2 = - 2 * ppp + 3 * pp;\n\t\tconst s3 = ppp - pp;\n\t\tconst s0 = 1 - s2;\n\t\tconst s1 = s3 - pp + p;\n\n\t\t// Layout of keyframe output values for CUBICSPLINE animations:\n\t\t//   [ inTangent_1, splineVertex_1, outTangent_1, inTangent_2, splineVertex_2, ... ]\n\t\tfor ( let i = 0; i !== stride; i ++ ) {\n\n\t\t\tconst p0 = values[ offset0 + i + stride ]; // splineVertex_k\n\t\t\tconst m0 = values[ offset0 + i + stride2 ] * td; // outTangent_k * (t_k+1 - t_k)\n\t\t\tconst p1 = values[ offset1 + i + stride ]; // splineVertex_k+1\n\t\t\tconst m1 = values[ offset1 + i ] * td; // inTangent_k+1 * (t_k+1 - t_k)\n\n\t\t\tresult[ i ] = s0 * p0 + s1 * m0 + s2 * p1 + s3 * m1;\n\n\t\t}\n\n\t\treturn result;\n\n\t}\n\n}\n\nconst _q = new Quaternion();\n\nclass GLTFCubicSplineQuaternionInterpolant extends GLTFCubicSplineInterpolant {\n\n\tinterpolate_( i1, t0, t, t1 ) {\n\n\t\tconst result = super.interpolate_( i1, t0, t, t1 );\n\n\t\t_q.fromArray( result ).normalize().toArray( result );\n\n\t\treturn result;\n\n\t}\n\n}\n\n\n/*********************************/\n/********** INTERNALS ************/\n/*********************************/\n\n/* CONSTANTS */\n\nconst WEBGL_CONSTANTS = {\n\tFLOAT: 5126,\n\t//FLOAT_MAT2: 35674,\n\tFLOAT_MAT3: 35675,\n\tFLOAT_MAT4: 35676,\n\tFLOAT_VEC2: 35664,\n\tFLOAT_VEC3: 35665,\n\tFLOAT_VEC4: 35666,\n\tLINEAR: 9729,\n\tREPEAT: 10497,\n\tSAMPLER_2D: 35678,\n\tPOINTS: 0,\n\tLINES: 1,\n\tLINE_LOOP: 2,\n\tLINE_STRIP: 3,\n\tTRIANGLES: 4,\n\tTRIANGLE_STRIP: 5,\n\tTRIANGLE_FAN: 6,\n\tUNSIGNED_BYTE: 5121,\n\tUNSIGNED_SHORT: 5123\n};\n\nconst WEBGL_COMPONENT_TYPES = {\n\t5120: Int8Array,\n\t5121: Uint8Array,\n\t5122: Int16Array,\n\t5123: Uint16Array,\n\t5125: Uint32Array,\n\t5126: Float32Array\n};\n\nconst WEBGL_FILTERS = {\n\t9728: NearestFilter,\n\t9729: LinearFilter,\n\t9984: NearestMipmapNearestFilter,\n\t9985: LinearMipmapNearestFilter,\n\t9986: NearestMipmapLinearFilter,\n\t9987: LinearMipmapLinearFilter\n};\n\nconst WEBGL_WRAPPINGS = {\n\t33071: ClampToEdgeWrapping,\n\t33648: MirroredRepeatWrapping,\n\t10497: RepeatWrapping\n};\n\nconst WEBGL_TYPE_SIZES = {\n\t'SCALAR': 1,\n\t'VEC2': 2,\n\t'VEC3': 3,\n\t'VEC4': 4,\n\t'MAT2': 4,\n\t'MAT3': 9,\n\t'MAT4': 16\n};\n\nconst ATTRIBUTES = {\n\tPOSITION: 'position',\n\tNORMAL: 'normal',\n\tTANGENT: 'tangent',\n\tTEXCOORD_0: 'uv',\n\tTEXCOORD_1: 'uv2',\n\tCOLOR_0: 'color',\n\tWEIGHTS_0: 'skinWeight',\n\tJOINTS_0: 'skinIndex',\n};\n\nconst PATH_PROPERTIES = {\n\tscale: 'scale',\n\ttranslation: 'position',\n\trotation: 'quaternion',\n\tweights: 'morphTargetInfluences'\n};\n\nconst INTERPOLATION = {\n\tCUBICSPLINE: undefined, // We use a custom interpolant (GLTFCubicSplineInterpolation) for CUBICSPLINE tracks. Each\n\t\t                        // keyframe track will be initialized with a default interpolation type, then modified.\n\tLINEAR: InterpolateLinear,\n\tSTEP: InterpolateDiscrete\n};\n\nconst ALPHA_MODES = {\n\tOPAQUE: 'OPAQUE',\n\tMASK: 'MASK',\n\tBLEND: 'BLEND'\n};\n\n/**\n * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#default-material\n */\nfunction createDefaultMaterial( cache ) {\n\n\tif ( cache[ 'DefaultMaterial' ] === undefined ) {\n\n\t\tcache[ 'DefaultMaterial' ] = new MeshStandardMaterial( {\n\t\t\tcolor: 0xFFFFFF,\n\t\t\temissive: 0x000000,\n\t\t\tmetalness: 1,\n\t\t\troughness: 1,\n\t\t\ttransparent: false,\n\t\t\tdepthTest: true,\n\t\t\tside: FrontSide\n\t\t} );\n\n\t}\n\n\treturn cache[ 'DefaultMaterial' ];\n\n}\n\nfunction addUnknownExtensionsToUserData( knownExtensions, object, objectDef ) {\n\n\t// Add unknown glTF extensions to an object's userData.\n\n\tfor ( const name in objectDef.extensions ) {\n\n\t\tif ( knownExtensions[ name ] === undefined ) {\n\n\t\t\tobject.userData.gltfExtensions = object.userData.gltfExtensions || {};\n\t\t\tobject.userData.gltfExtensions[ name ] = objectDef.extensions[ name ];\n\n\t\t}\n\n\t}\n\n}\n\n/**\n * @param {Object3D|Material|BufferGeometry} object\n * @param {GLTF.definition} gltfDef\n */\nfunction assignExtrasToUserData( object, gltfDef ) {\n\n\tif ( gltfDef.extras !== undefined ) {\n\n\t\tif ( typeof gltfDef.extras === 'object' ) {\n\n\t\t\tObject.assign( object.userData, gltfDef.extras );\n\n\t\t} else {\n\n\t\t\tconsole.warn( 'THREE.GLTFLoader: Ignoring primitive type .extras, ' + gltfDef.extras );\n\n\t\t}\n\n\t}\n\n}\n\n/**\n * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#morph-targets\n *\n * @param {BufferGeometry} geometry\n * @param {Array<GLTF.Target>} targets\n * @param {GLTFParser} parser\n * @return {Promise<BufferGeometry>}\n */\nfunction addMorphTargets( geometry, targets, parser ) {\n\n\tlet hasMorphPosition = false;\n\tlet hasMorphNormal = false;\n\tlet hasMorphColor = false;\n\n\tfor ( let i = 0, il = targets.length; i < il; i ++ ) {\n\n\t\tconst target = targets[ i ];\n\n\t\tif ( target.POSITION !== undefined ) hasMorphPosition = true;\n\t\tif ( target.NORMAL !== undefined ) hasMorphNormal = true;\n\t\tif ( target.COLOR_0 !== undefined ) hasMorphColor = true;\n\n\t\tif ( hasMorphPosition && hasMorphNormal && hasMorphColor ) break;\n\n\t}\n\n\tif ( ! hasMorphPosition && ! hasMorphNormal && ! hasMorphColor ) return Promise.resolve( geometry );\n\n\tconst pendingPositionAccessors = [];\n\tconst pendingNormalAccessors = [];\n\tconst pendingColorAccessors = [];\n\n\tfor ( let i = 0, il = targets.length; i < il; i ++ ) {\n\n\t\tconst target = targets[ i ];\n\n\t\tif ( hasMorphPosition ) {\n\n\t\t\tconst pendingAccessor = target.POSITION !== undefined\n\t\t\t\t? parser.getDependency( 'accessor', target.POSITION )\n\t\t\t\t: geometry.attributes.position;\n\n\t\t\tpendingPositionAccessors.push( pendingAccessor );\n\n\t\t}\n\n\t\tif ( hasMorphNormal ) {\n\n\t\t\tconst pendingAccessor = target.NORMAL !== undefined\n\t\t\t\t? parser.getDependency( 'accessor', target.NORMAL )\n\t\t\t\t: geometry.attributes.normal;\n\n\t\t\tpendingNormalAccessors.push( pendingAccessor );\n\n\t\t}\n\n\t\tif ( hasMorphColor ) {\n\n\t\t\tconst pendingAccessor = target.COLOR_0 !== undefined\n\t\t\t\t? parser.getDependency( 'accessor', target.COLOR_0 )\n\t\t\t\t: geometry.attributes.color;\n\n\t\t\tpendingColorAccessors.push( pendingAccessor );\n\n\t\t}\n\n\t}\n\n\treturn Promise.all( [\n\t\tPromise.all( pendingPositionAccessors ),\n\t\tPromise.all( pendingNormalAccessors ),\n\t\tPromise.all( pendingColorAccessors )\n\t] ).then( function ( accessors ) {\n\n\t\tconst morphPositions = accessors[ 0 ];\n\t\tconst morphNormals = accessors[ 1 ];\n\t\tconst morphColors = accessors[ 2 ];\n\n\t\tif ( hasMorphPosition ) geometry.morphAttributes.position = morphPositions;\n\t\tif ( hasMorphNormal ) geometry.morphAttributes.normal = morphNormals;\n\t\tif ( hasMorphColor ) geometry.morphAttributes.color = morphColors;\n\t\tgeometry.morphTargetsRelative = true;\n\n\t\treturn geometry;\n\n\t} );\n\n}\n\n/**\n * @param {Mesh} mesh\n * @param {GLTF.Mesh} meshDef\n */\nfunction updateMorphTargets( mesh, meshDef ) {\n\n\tmesh.updateMorphTargets();\n\n\tif ( meshDef.weights !== undefined ) {\n\n\t\tfor ( let i = 0, il = meshDef.weights.length; i < il; i ++ ) {\n\n\t\t\tmesh.morphTargetInfluences[ i ] = meshDef.weights[ i ];\n\n\t\t}\n\n\t}\n\n\t// .extras has user-defined data, so check that .extras.targetNames is an array.\n\tif ( meshDef.extras && Array.isArray( meshDef.extras.targetNames ) ) {\n\n\t\tconst targetNames = meshDef.extras.targetNames;\n\n\t\tif ( mesh.morphTargetInfluences.length === targetNames.length ) {\n\n\t\t\tmesh.morphTargetDictionary = {};\n\n\t\t\tfor ( let i = 0, il = targetNames.length; i < il; i ++ ) {\n\n\t\t\t\tmesh.morphTargetDictionary[ targetNames[ i ] ] = i;\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tconsole.warn( 'THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.' );\n\n\t\t}\n\n\t}\n\n}\n\nfunction createPrimitiveKey( primitiveDef ) {\n\n\tconst dracoExtension = primitiveDef.extensions && primitiveDef.extensions[ EXTENSIONS.KHR_DRACO_MESH_COMPRESSION ];\n\tlet geometryKey;\n\n\tif ( dracoExtension ) {\n\n\t\tgeometryKey = 'draco:' + dracoExtension.bufferView\n\t\t\t\t+ ':' + dracoExtension.indices\n\t\t\t\t+ ':' + createAttributesKey( dracoExtension.attributes );\n\n\t} else {\n\n\t\tgeometryKey = primitiveDef.indices + ':' + createAttributesKey( primitiveDef.attributes ) + ':' + primitiveDef.mode;\n\n\t}\n\n\treturn geometryKey;\n\n}\n\nfunction createAttributesKey( attributes ) {\n\n\tlet attributesKey = '';\n\n\tconst keys = Object.keys( attributes ).sort();\n\n\tfor ( let i = 0, il = keys.length; i < il; i ++ ) {\n\n\t\tattributesKey += keys[ i ] + ':' + attributes[ keys[ i ] ] + ';';\n\n\t}\n\n\treturn attributesKey;\n\n}\n\nfunction getNormalizedComponentScale( constructor ) {\n\n\t// Reference:\n\t// https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_mesh_quantization#encoding-quantized-data\n\n\tswitch ( constructor ) {\n\n\t\tcase Int8Array:\n\t\t\treturn 1 / 127;\n\n\t\tcase Uint8Array:\n\t\t\treturn 1 / 255;\n\n\t\tcase Int16Array:\n\t\t\treturn 1 / 32767;\n\n\t\tcase Uint16Array:\n\t\t\treturn 1 / 65535;\n\n\t\tdefault:\n\t\t\tthrow new Error( 'THREE.GLTFLoader: Unsupported normalized accessor component type.' );\n\n\t}\n\n}\n\nfunction getImageURIMimeType( uri ) {\n\n\tif ( uri.search( /\\.jpe?g($|\\?)/i ) > 0 || uri.search( /^data\\:image\\/jpeg/ ) === 0 ) return 'image/jpeg';\n\tif ( uri.search( /\\.webp($|\\?)/i ) > 0 || uri.search( /^data\\:image\\/webp/ ) === 0 ) return 'image/webp';\n\n\treturn 'image/png';\n\n}\n\nconst _identityMatrix = new Matrix4();\n\n/* GLTF PARSER */\n\nclass GLTFParser {\n\n\tconstructor( json = {}, options = {} ) {\n\n\t\tthis.json = json;\n\t\tthis.extensions = {};\n\t\tthis.plugins = {};\n\t\tthis.options = options;\n\n\t\t// loader object cache\n\t\tthis.cache = new GLTFRegistry();\n\n\t\t// associations between Three.js objects and glTF elements\n\t\tthis.associations = new Map();\n\n\t\t// BufferGeometry caching\n\t\tthis.primitiveCache = {};\n\n\t\t// Object3D instance caches\n\t\tthis.meshCache = { refs: {}, uses: {} };\n\t\tthis.cameraCache = { refs: {}, uses: {} };\n\t\tthis.lightCache = { refs: {}, uses: {} };\n\n\t\tthis.sourceCache = {};\n\t\tthis.textureCache = {};\n\n\t\t// Track node names, to ensure no duplicates\n\t\tthis.nodeNamesUsed = {};\n\n\t\t// Use an ImageBitmapLoader if imageBitmaps are supported. Moves much of the\n\t\t// expensive work of uploading a texture to the GPU off the main thread.\n\n\t\tlet isSafari = false;\n\t\tlet isFirefox = false;\n\t\tlet firefoxVersion = - 1;\n\n\t\tif ( typeof navigator !== 'undefined' ) {\n\n\t\t\tisSafari = /^((?!chrome|android).)*safari/i.test( navigator.userAgent ) === true;\n\t\t\tisFirefox = navigator.userAgent.indexOf( 'Firefox' ) > - 1;\n\t\t\tfirefoxVersion = isFirefox ? navigator.userAgent.match( /Firefox\\/([0-9]+)\\./ )[ 1 ] : - 1;\n\n\t\t}\n\n\t\tif ( typeof createImageBitmap === 'undefined' || isSafari || ( isFirefox && firefoxVersion < 98 ) ) {\n\n\t\t\tthis.textureLoader = new TextureLoader( this.options.manager );\n\n\t\t} else {\n\n\t\t\tthis.textureLoader = new ImageBitmapLoader( this.options.manager );\n\n\t\t}\n\n\t\tthis.textureLoader.setCrossOrigin( this.options.crossOrigin );\n\t\tthis.textureLoader.setRequestHeader( this.options.requestHeader );\n\n\t\tthis.fileLoader = new FileLoader( this.options.manager );\n\t\tthis.fileLoader.setResponseType( 'arraybuffer' );\n\n\t\tif ( this.options.crossOrigin === 'use-credentials' ) {\n\n\t\t\tthis.fileLoader.setWithCredentials( true );\n\n\t\t}\n\n\t}\n\n\tsetExtensions( extensions ) {\n\n\t\tthis.extensions = extensions;\n\n\t}\n\n\tsetPlugins( plugins ) {\n\n\t\tthis.plugins = plugins;\n\n\t}\n\n\tparse( onLoad, onError ) {\n\n\t\tconst parser = this;\n\t\tconst json = this.json;\n\t\tconst extensions = this.extensions;\n\n\t\t// Clear the loader cache\n\t\tthis.cache.removeAll();\n\n\t\t// Mark the special nodes/meshes in json for efficient parse\n\t\tthis._invokeAll( function ( ext ) {\n\n\t\t\treturn ext._markDefs && ext._markDefs();\n\n\t\t} );\n\n\t\tPromise.all( this._invokeAll( function ( ext ) {\n\n\t\t\treturn ext.beforeRoot && ext.beforeRoot();\n\n\t\t} ) ).then( function () {\n\n\t\t\treturn Promise.all( [\n\n\t\t\t\tparser.getDependencies( 'scene' ),\n\t\t\t\tparser.getDependencies( 'animation' ),\n\t\t\t\tparser.getDependencies( 'camera' ),\n\n\t\t\t] );\n\n\t\t} ).then( function ( dependencies ) {\n\n\t\t\tconst result = {\n\t\t\t\tscene: dependencies[ 0 ][ json.scene || 0 ],\n\t\t\t\tscenes: dependencies[ 0 ],\n\t\t\t\tanimations: dependencies[ 1 ],\n\t\t\t\tcameras: dependencies[ 2 ],\n\t\t\t\tasset: json.asset,\n\t\t\t\tparser: parser,\n\t\t\t\tuserData: {}\n\t\t\t};\n\n\t\t\taddUnknownExtensionsToUserData( extensions, result, json );\n\n\t\t\tassignExtrasToUserData( result, json );\n\n\t\t\tPromise.all( parser._invokeAll( function ( ext ) {\n\n\t\t\t\treturn ext.afterRoot && ext.afterRoot( result );\n\n\t\t\t} ) ).then( function () {\n\n\t\t\t\tonLoad( result );\n\n\t\t\t} );\n\n\t\t} ).catch( onError );\n\n\t}\n\n\t/**\n\t * Marks the special nodes/meshes in json for efficient parse.\n\t */\n\t_markDefs() {\n\n\t\tconst nodeDefs = this.json.nodes || [];\n\t\tconst skinDefs = this.json.skins || [];\n\t\tconst meshDefs = this.json.meshes || [];\n\n\t\t// Nothing in the node definition indicates whether it is a Bone or an\n\t\t// Object3D. Use the skins' joint references to mark bones.\n\t\tfor ( let skinIndex = 0, skinLength = skinDefs.length; skinIndex < skinLength; skinIndex ++ ) {\n\n\t\t\tconst joints = skinDefs[ skinIndex ].joints;\n\n\t\t\tfor ( let i = 0, il = joints.length; i < il; i ++ ) {\n\n\t\t\t\tnodeDefs[ joints[ i ] ].isBone = true;\n\n\t\t\t}\n\n\t\t}\n\n\t\t// Iterate over all nodes, marking references to shared resources,\n\t\t// as well as skeleton joints.\n\t\tfor ( let nodeIndex = 0, nodeLength = nodeDefs.length; nodeIndex < nodeLength; nodeIndex ++ ) {\n\n\t\t\tconst nodeDef = nodeDefs[ nodeIndex ];\n\n\t\t\tif ( nodeDef.mesh !== undefined ) {\n\n\t\t\t\tthis._addNodeRef( this.meshCache, nodeDef.mesh );\n\n\t\t\t\t// Nothing in the mesh definition indicates whether it is\n\t\t\t\t// a SkinnedMesh or Mesh. Use the node's mesh reference\n\t\t\t\t// to mark SkinnedMesh if node has skin.\n\t\t\t\tif ( nodeDef.skin !== undefined ) {\n\n\t\t\t\t\tmeshDefs[ nodeDef.mesh ].isSkinnedMesh = true;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( nodeDef.camera !== undefined ) {\n\n\t\t\t\tthis._addNodeRef( this.cameraCache, nodeDef.camera );\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\t/**\n\t * Counts references to shared node / Object3D resources. These resources\n\t * can be reused, or \"instantiated\", at multiple nodes in the scene\n\t * hierarchy. Mesh, Camera, and Light instances are instantiated and must\n\t * be marked. Non-scenegraph resources (like Materials, Geometries, and\n\t * Textures) can be reused directly and are not marked here.\n\t *\n\t * Example: CesiumMilkTruck sample model reuses \"Wheel\" meshes.\n\t */\n\t_addNodeRef( cache, index ) {\n\n\t\tif ( index === undefined ) return;\n\n\t\tif ( cache.refs[ index ] === undefined ) {\n\n\t\t\tcache.refs[ index ] = cache.uses[ index ] = 0;\n\n\t\t}\n\n\t\tcache.refs[ index ] ++;\n\n\t}\n\n\t/** Returns a reference to a shared resource, cloning it if necessary. */\n\t_getNodeRef( cache, index, object ) {\n\n\t\tif ( cache.refs[ index ] <= 1 ) return object;\n\n\t\tconst ref = object.clone();\n\n\t\t// Propagates mappings to the cloned object, prevents mappings on the\n\t\t// original object from being lost.\n\t\tconst updateMappings = ( original, clone ) => {\n\n\t\t\tconst mappings = this.associations.get( original );\n\t\t\tif ( mappings != null ) {\n\n\t\t\t\tthis.associations.set( clone, mappings );\n\n\t\t\t}\n\n\t\t\tfor ( const [ i, child ] of original.children.entries() ) {\n\n\t\t\t\tupdateMappings( child, clone.children[ i ] );\n\n\t\t\t}\n\n\t\t};\n\n\t\tupdateMappings( object, ref );\n\n\t\tref.name += '_instance_' + ( cache.uses[ index ] ++ );\n\n\t\treturn ref;\n\n\t}\n\n\t_invokeOne( func ) {\n\n\t\tconst extensions = Object.values( this.plugins );\n\t\textensions.push( this );\n\n\t\tfor ( let i = 0; i < extensions.length; i ++ ) {\n\n\t\t\tconst result = func( extensions[ i ] );\n\n\t\t\tif ( result ) return result;\n\n\t\t}\n\n\t\treturn null;\n\n\t}\n\n\t_invokeAll( func ) {\n\n\t\tconst extensions = Object.values( this.plugins );\n\t\textensions.unshift( this );\n\n\t\tconst pending = [];\n\n\t\tfor ( let i = 0; i < extensions.length; i ++ ) {\n\n\t\t\tconst result = func( extensions[ i ] );\n\n\t\t\tif ( result ) pending.push( result );\n\n\t\t}\n\n\t\treturn pending;\n\n\t}\n\n\t/**\n\t * Requests the specified dependency asynchronously, with caching.\n\t * @param {string} type\n\t * @param {number} index\n\t * @return {Promise<Object3D|Material|THREE.Texture|AnimationClip|ArrayBuffer|Object>}\n\t */\n\tgetDependency( type, index ) {\n\n\t\tconst cacheKey = type + ':' + index;\n\t\tlet dependency = this.cache.get( cacheKey );\n\n\t\tif ( ! dependency ) {\n\n\t\t\tswitch ( type ) {\n\n\t\t\t\tcase 'scene':\n\t\t\t\t\tdependency = this.loadScene( index );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'node':\n\t\t\t\t\tdependency = this._invokeOne( function ( ext ) {\n\n\t\t\t\t\t\treturn ext.loadNode && ext.loadNode( index );\n\n\t\t\t\t\t} );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'mesh':\n\t\t\t\t\tdependency = this._invokeOne( function ( ext ) {\n\n\t\t\t\t\t\treturn ext.loadMesh && ext.loadMesh( index );\n\n\t\t\t\t\t} );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'accessor':\n\t\t\t\t\tdependency = this.loadAccessor( index );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'bufferView':\n\t\t\t\t\tdependency = this._invokeOne( function ( ext ) {\n\n\t\t\t\t\t\treturn ext.loadBufferView && ext.loadBufferView( index );\n\n\t\t\t\t\t} );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'buffer':\n\t\t\t\t\tdependency = this.loadBuffer( index );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'material':\n\t\t\t\t\tdependency = this._invokeOne( function ( ext ) {\n\n\t\t\t\t\t\treturn ext.loadMaterial && ext.loadMaterial( index );\n\n\t\t\t\t\t} );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'texture':\n\t\t\t\t\tdependency = this._invokeOne( function ( ext ) {\n\n\t\t\t\t\t\treturn ext.loadTexture && ext.loadTexture( index );\n\n\t\t\t\t\t} );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'skin':\n\t\t\t\t\tdependency = this.loadSkin( index );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'animation':\n\t\t\t\t\tdependency = this._invokeOne( function ( ext ) {\n\n\t\t\t\t\t\treturn ext.loadAnimation && ext.loadAnimation( index );\n\n\t\t\t\t\t} );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'camera':\n\t\t\t\t\tdependency = this.loadCamera( index );\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tdependency = this._invokeOne( function ( ext ) {\n\n\t\t\t\t\t\treturn ext != this && ext.getDependency && ext.getDependency( type, index );\n\n\t\t\t\t\t} );\n\n\t\t\t\t\tif ( ! dependency ) {\n\n\t\t\t\t\t\tthrow new Error( 'Unknown type: ' + type );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t\tthis.cache.add( cacheKey, dependency );\n\n\t\t}\n\n\t\treturn dependency;\n\n\t}\n\n\t/**\n\t * Requests all dependencies of the specified type asynchronously, with caching.\n\t * @param {string} type\n\t * @return {Promise<Array<Object>>}\n\t */\n\tgetDependencies( type ) {\n\n\t\tlet dependencies = this.cache.get( type );\n\n\t\tif ( ! dependencies ) {\n\n\t\t\tconst parser = this;\n\t\t\tconst defs = this.json[ type + ( type === 'mesh' ? 'es' : 's' ) ] || [];\n\n\t\t\tdependencies = Promise.all( defs.map( function ( def, index ) {\n\n\t\t\t\treturn parser.getDependency( type, index );\n\n\t\t\t} ) );\n\n\t\t\tthis.cache.add( type, dependencies );\n\n\t\t}\n\n\t\treturn dependencies;\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#buffers-and-buffer-views\n\t * @param {number} bufferIndex\n\t * @return {Promise<ArrayBuffer>}\n\t */\n\tloadBuffer( bufferIndex ) {\n\n\t\tconst bufferDef = this.json.buffers[ bufferIndex ];\n\t\tconst loader = this.fileLoader;\n\n\t\tif ( bufferDef.type && bufferDef.type !== 'arraybuffer' ) {\n\n\t\t\tthrow new Error( 'THREE.GLTFLoader: ' + bufferDef.type + ' buffer type is not supported.' );\n\n\t\t}\n\n\t\t// If present, GLB container is required to be the first buffer.\n\t\tif ( bufferDef.uri === undefined && bufferIndex === 0 ) {\n\n\t\t\treturn Promise.resolve( this.extensions[ EXTENSIONS.KHR_BINARY_GLTF ].body );\n\n\t\t}\n\n\t\tconst options = this.options;\n\n\t\treturn new Promise( function ( resolve, reject ) {\n\n\t\t\tloader.load( LoaderUtils.resolveURL( bufferDef.uri, options.path ), resolve, undefined, function () {\n\n\t\t\t\treject( new Error( 'THREE.GLTFLoader: Failed to load buffer \"' + bufferDef.uri + '\".' ) );\n\n\t\t\t} );\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#buffers-and-buffer-views\n\t * @param {number} bufferViewIndex\n\t * @return {Promise<ArrayBuffer>}\n\t */\n\tloadBufferView( bufferViewIndex ) {\n\n\t\tconst bufferViewDef = this.json.bufferViews[ bufferViewIndex ];\n\n\t\treturn this.getDependency( 'buffer', bufferViewDef.buffer ).then( function ( buffer ) {\n\n\t\t\tconst byteLength = bufferViewDef.byteLength || 0;\n\t\t\tconst byteOffset = bufferViewDef.byteOffset || 0;\n\t\t\treturn buffer.slice( byteOffset, byteOffset + byteLength );\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#accessors\n\t * @param {number} accessorIndex\n\t * @return {Promise<BufferAttribute|InterleavedBufferAttribute>}\n\t */\n\tloadAccessor( accessorIndex ) {\n\n\t\tconst parser = this;\n\t\tconst json = this.json;\n\n\t\tconst accessorDef = this.json.accessors[ accessorIndex ];\n\n\t\tif ( accessorDef.bufferView === undefined && accessorDef.sparse === undefined ) {\n\n\t\t\tconst itemSize = WEBGL_TYPE_SIZES[ accessorDef.type ];\n\t\t\tconst TypedArray = WEBGL_COMPONENT_TYPES[ accessorDef.componentType ];\n\t\t\tconst normalized = accessorDef.normalized === true;\n\n\t\t\tconst array = new TypedArray( accessorDef.count * itemSize );\n\t\t\treturn Promise.resolve( new BufferAttribute( array, itemSize, normalized ) );\n\n\t\t}\n\n\t\tconst pendingBufferViews = [];\n\n\t\tif ( accessorDef.bufferView !== undefined ) {\n\n\t\t\tpendingBufferViews.push( this.getDependency( 'bufferView', accessorDef.bufferView ) );\n\n\t\t} else {\n\n\t\t\tpendingBufferViews.push( null );\n\n\t\t}\n\n\t\tif ( accessorDef.sparse !== undefined ) {\n\n\t\t\tpendingBufferViews.push( this.getDependency( 'bufferView', accessorDef.sparse.indices.bufferView ) );\n\t\t\tpendingBufferViews.push( this.getDependency( 'bufferView', accessorDef.sparse.values.bufferView ) );\n\n\t\t}\n\n\t\treturn Promise.all( pendingBufferViews ).then( function ( bufferViews ) {\n\n\t\t\tconst bufferView = bufferViews[ 0 ];\n\n\t\t\tconst itemSize = WEBGL_TYPE_SIZES[ accessorDef.type ];\n\t\t\tconst TypedArray = WEBGL_COMPONENT_TYPES[ accessorDef.componentType ];\n\n\t\t\t// For VEC3: itemSize is 3, elementBytes is 4, itemBytes is 12.\n\t\t\tconst elementBytes = TypedArray.BYTES_PER_ELEMENT;\n\t\t\tconst itemBytes = elementBytes * itemSize;\n\t\t\tconst byteOffset = accessorDef.byteOffset || 0;\n\t\t\tconst byteStride = accessorDef.bufferView !== undefined ? json.bufferViews[ accessorDef.bufferView ].byteStride : undefined;\n\t\t\tconst normalized = accessorDef.normalized === true;\n\t\t\tlet array, bufferAttribute;\n\n\t\t\t// The buffer is not interleaved if the stride is the item size in bytes.\n\t\t\tif ( byteStride && byteStride !== itemBytes ) {\n\n\t\t\t\t// Each \"slice\" of the buffer, as defined by 'count' elements of 'byteStride' bytes, gets its own InterleavedBuffer\n\t\t\t\t// This makes sure that IBA.count reflects accessor.count properly\n\t\t\t\tconst ibSlice = Math.floor( byteOffset / byteStride );\n\t\t\t\tconst ibCacheKey = 'InterleavedBuffer:' + accessorDef.bufferView + ':' + accessorDef.componentType + ':' + ibSlice + ':' + accessorDef.count;\n\t\t\t\tlet ib = parser.cache.get( ibCacheKey );\n\n\t\t\t\tif ( ! ib ) {\n\n\t\t\t\t\tarray = new TypedArray( bufferView, ibSlice * byteStride, accessorDef.count * byteStride / elementBytes );\n\n\t\t\t\t\t// Integer parameters to IB/IBA are in array elements, not bytes.\n\t\t\t\t\tib = new InterleavedBuffer( array, byteStride / elementBytes );\n\n\t\t\t\t\tparser.cache.add( ibCacheKey, ib );\n\n\t\t\t\t}\n\n\t\t\t\tbufferAttribute = new InterleavedBufferAttribute( ib, itemSize, ( byteOffset % byteStride ) / elementBytes, normalized );\n\n\t\t\t} else {\n\n\t\t\t\tif ( bufferView === null ) {\n\n\t\t\t\t\tarray = new TypedArray( accessorDef.count * itemSize );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tarray = new TypedArray( bufferView, byteOffset, accessorDef.count * itemSize );\n\n\t\t\t\t}\n\n\t\t\t\tbufferAttribute = new BufferAttribute( array, itemSize, normalized );\n\n\t\t\t}\n\n\t\t\t// https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#sparse-accessors\n\t\t\tif ( accessorDef.sparse !== undefined ) {\n\n\t\t\t\tconst itemSizeIndices = WEBGL_TYPE_SIZES.SCALAR;\n\t\t\t\tconst TypedArrayIndices = WEBGL_COMPONENT_TYPES[ accessorDef.sparse.indices.componentType ];\n\n\t\t\t\tconst byteOffsetIndices = accessorDef.sparse.indices.byteOffset || 0;\n\t\t\t\tconst byteOffsetValues = accessorDef.sparse.values.byteOffset || 0;\n\n\t\t\t\tconst sparseIndices = new TypedArrayIndices( bufferViews[ 1 ], byteOffsetIndices, accessorDef.sparse.count * itemSizeIndices );\n\t\t\t\tconst sparseValues = new TypedArray( bufferViews[ 2 ], byteOffsetValues, accessorDef.sparse.count * itemSize );\n\n\t\t\t\tif ( bufferView !== null ) {\n\n\t\t\t\t\t// Avoid modifying the original ArrayBuffer, if the bufferView wasn't initialized with zeroes.\n\t\t\t\t\tbufferAttribute = new BufferAttribute( bufferAttribute.array.slice(), bufferAttribute.itemSize, bufferAttribute.normalized );\n\n\t\t\t\t}\n\n\t\t\t\tfor ( let i = 0, il = sparseIndices.length; i < il; i ++ ) {\n\n\t\t\t\t\tconst index = sparseIndices[ i ];\n\n\t\t\t\t\tbufferAttribute.setX( index, sparseValues[ i * itemSize ] );\n\t\t\t\t\tif ( itemSize >= 2 ) bufferAttribute.setY( index, sparseValues[ i * itemSize + 1 ] );\n\t\t\t\t\tif ( itemSize >= 3 ) bufferAttribute.setZ( index, sparseValues[ i * itemSize + 2 ] );\n\t\t\t\t\tif ( itemSize >= 4 ) bufferAttribute.setW( index, sparseValues[ i * itemSize + 3 ] );\n\t\t\t\t\tif ( itemSize >= 5 ) throw new Error( 'THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.' );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn bufferAttribute;\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#textures\n\t * @param {number} textureIndex\n\t * @return {Promise<THREE.Texture|null>}\n\t */\n\tloadTexture( textureIndex ) {\n\n\t\tconst json = this.json;\n\t\tconst options = this.options;\n\t\tconst textureDef = json.textures[ textureIndex ];\n\t\tconst sourceIndex = textureDef.source;\n\t\tconst sourceDef = json.images[ sourceIndex ];\n\n\t\tlet loader = this.textureLoader;\n\n\t\tif ( sourceDef.uri ) {\n\n\t\t\tconst handler = options.manager.getHandler( sourceDef.uri );\n\t\t\tif ( handler !== null ) loader = handler;\n\n\t\t}\n\n\t\treturn this.loadTextureImage( textureIndex, sourceIndex, loader );\n\n\t}\n\n\tloadTextureImage( textureIndex, sourceIndex, loader ) {\n\n\t\tconst parser = this;\n\t\tconst json = this.json;\n\n\t\tconst textureDef = json.textures[ textureIndex ];\n\t\tconst sourceDef = json.images[ sourceIndex ];\n\n\t\tconst cacheKey = ( sourceDef.uri || sourceDef.bufferView ) + ':' + textureDef.sampler;\n\n\t\tif ( this.textureCache[ cacheKey ] ) {\n\n\t\t\t// See https://github.com/mrdoob/three.js/issues/21559.\n\t\t\treturn this.textureCache[ cacheKey ];\n\n\t\t}\n\n\t\tconst promise = this.loadImageSource( sourceIndex, loader ).then( function ( texture ) {\n\n\t\t\ttexture.flipY = false;\n\n\t\t\ttexture.name = textureDef.name || sourceDef.name || '';\n\n\t\t\tconst samplers = json.samplers || {};\n\t\t\tconst sampler = samplers[ textureDef.sampler ] || {};\n\n\t\t\ttexture.magFilter = WEBGL_FILTERS[ sampler.magFilter ] || LinearFilter;\n\t\t\ttexture.minFilter = WEBGL_FILTERS[ sampler.minFilter ] || LinearMipmapLinearFilter;\n\t\t\ttexture.wrapS = WEBGL_WRAPPINGS[ sampler.wrapS ] || RepeatWrapping;\n\t\t\ttexture.wrapT = WEBGL_WRAPPINGS[ sampler.wrapT ] || RepeatWrapping;\n\n\t\t\tparser.associations.set( texture, { textures: textureIndex } );\n\n\t\t\treturn texture;\n\n\t\t} ).catch( function () {\n\n\t\t\treturn null;\n\n\t\t} );\n\n\t\tthis.textureCache[ cacheKey ] = promise;\n\n\t\treturn promise;\n\n\t}\n\n\tloadImageSource( sourceIndex, loader ) {\n\n\t\tconst parser = this;\n\t\tconst json = this.json;\n\t\tconst options = this.options;\n\n\t\tif ( this.sourceCache[ sourceIndex ] !== undefined ) {\n\n\t\t\treturn this.sourceCache[ sourceIndex ].then( ( texture ) => texture.clone() );\n\n\t\t}\n\n\t\tconst sourceDef = json.images[ sourceIndex ];\n\n\t\tconst URL = self.URL || self.webkitURL;\n\n\t\tlet sourceURI = sourceDef.uri || '';\n\t\tlet isObjectURL = false;\n\n\t\tif ( sourceDef.bufferView !== undefined ) {\n\n\t\t\t// Load binary image data from bufferView, if provided.\n\n\t\t\tsourceURI = parser.getDependency( 'bufferView', sourceDef.bufferView ).then( function ( bufferView ) {\n\n\t\t\t\tisObjectURL = true;\n\t\t\t\tconst blob = new Blob( [ bufferView ], { type: sourceDef.mimeType } );\n\t\t\t\tsourceURI = URL.createObjectURL( blob );\n\t\t\t\treturn sourceURI;\n\n\t\t\t} );\n\n\t\t} else if ( sourceDef.uri === undefined ) {\n\n\t\t\tthrow new Error( 'THREE.GLTFLoader: Image ' + sourceIndex + ' is missing URI and bufferView' );\n\n\t\t}\n\n\t\tconst promise = Promise.resolve( sourceURI ).then( function ( sourceURI ) {\n\n\t\t\treturn new Promise( function ( resolve, reject ) {\n\n\t\t\t\tlet onLoad = resolve;\n\n\t\t\t\tif ( loader.isImageBitmapLoader === true ) {\n\n\t\t\t\t\tonLoad = function ( imageBitmap ) {\n\n\t\t\t\t\t\tconst texture = new Texture( imageBitmap );\n\t\t\t\t\t\ttexture.needsUpdate = true;\n\n\t\t\t\t\t\tresolve( texture );\n\n\t\t\t\t\t};\n\n\t\t\t\t}\n\n\t\t\t\tloader.load( LoaderUtils.resolveURL( sourceURI, options.path ), onLoad, undefined, reject );\n\n\t\t\t} );\n\n\t\t} ).then( function ( texture ) {\n\n\t\t\t// Clean up resources and configure Texture.\n\n\t\t\tif ( isObjectURL === true ) {\n\n\t\t\t\tURL.revokeObjectURL( sourceURI );\n\n\t\t\t}\n\n\t\t\ttexture.userData.mimeType = sourceDef.mimeType || getImageURIMimeType( sourceDef.uri );\n\n\t\t\treturn texture;\n\n\t\t} ).catch( function ( error ) {\n\n\t\t\tconsole.error( 'THREE.GLTFLoader: Couldn\\'t load texture', sourceURI );\n\t\t\tthrow error;\n\n\t\t} );\n\n\t\tthis.sourceCache[ sourceIndex ] = promise;\n\t\treturn promise;\n\n\t}\n\n\t/**\n\t * Asynchronously assigns a texture to the given material parameters.\n\t * @param {Object} materialParams\n\t * @param {string} mapName\n\t * @param {Object} mapDef\n\t * @return {Promise<Texture>}\n\t */\n\tassignTexture( materialParams, mapName, mapDef, encoding ) {\n\n\t\tconst parser = this;\n\n\t\treturn this.getDependency( 'texture', mapDef.index ).then( function ( texture ) {\n\n\t\t\tif ( ! texture ) return null;\n\n\t\t\t// Materials sample aoMap from UV set 1 and other maps from UV set 0 - this can't be configured\n\t\t\t// However, we will copy UV set 0 to UV set 1 on demand for aoMap\n\t\t\tif ( mapDef.texCoord !== undefined && mapDef.texCoord != 0 && ! ( mapName === 'aoMap' && mapDef.texCoord == 1 ) ) {\n\n\t\t\t\tconsole.warn( 'THREE.GLTFLoader: Custom UV set ' + mapDef.texCoord + ' for texture ' + mapName + ' not yet supported.' );\n\n\t\t\t}\n\n\t\t\tif ( parser.extensions[ EXTENSIONS.KHR_TEXTURE_TRANSFORM ] ) {\n\n\t\t\t\tconst transform = mapDef.extensions !== undefined ? mapDef.extensions[ EXTENSIONS.KHR_TEXTURE_TRANSFORM ] : undefined;\n\n\t\t\t\tif ( transform ) {\n\n\t\t\t\t\tconst gltfReference = parser.associations.get( texture );\n\t\t\t\t\ttexture = parser.extensions[ EXTENSIONS.KHR_TEXTURE_TRANSFORM ].extendTexture( texture, transform );\n\t\t\t\t\tparser.associations.set( texture, gltfReference );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( encoding !== undefined ) {\n\n\t\t\t\ttexture.encoding = encoding;\n\n\t\t\t}\n\n\t\t\tmaterialParams[ mapName ] = texture;\n\n\t\t\treturn texture;\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Assigns final material to a Mesh, Line, or Points instance. The instance\n\t * already has a material (generated from the glTF material options alone)\n\t * but reuse of the same glTF material may require multiple threejs materials\n\t * to accommodate different primitive types, defines, etc. New materials will\n\t * be created if necessary, and reused from a cache.\n\t * @param  {Object3D} mesh Mesh, Line, or Points instance.\n\t */\n\tassignFinalMaterial( mesh ) {\n\n\t\tconst geometry = mesh.geometry;\n\t\tlet material = mesh.material;\n\n\t\tconst useDerivativeTangents = geometry.attributes.tangent === undefined;\n\t\tconst useVertexColors = geometry.attributes.color !== undefined;\n\t\tconst useFlatShading = geometry.attributes.normal === undefined;\n\n\t\tif ( mesh.isPoints ) {\n\n\t\t\tconst cacheKey = 'PointsMaterial:' + material.uuid;\n\n\t\t\tlet pointsMaterial = this.cache.get( cacheKey );\n\n\t\t\tif ( ! pointsMaterial ) {\n\n\t\t\t\tpointsMaterial = new PointsMaterial();\n\t\t\t\tMaterial.prototype.copy.call( pointsMaterial, material );\n\t\t\t\tpointsMaterial.color.copy( material.color );\n\t\t\t\tpointsMaterial.map = material.map;\n\t\t\t\tpointsMaterial.sizeAttenuation = false; // glTF spec says points should be 1px\n\n\t\t\t\tthis.cache.add( cacheKey, pointsMaterial );\n\n\t\t\t}\n\n\t\t\tmaterial = pointsMaterial;\n\n\t\t} else if ( mesh.isLine ) {\n\n\t\t\tconst cacheKey = 'LineBasicMaterial:' + material.uuid;\n\n\t\t\tlet lineMaterial = this.cache.get( cacheKey );\n\n\t\t\tif ( ! lineMaterial ) {\n\n\t\t\t\tlineMaterial = new LineBasicMaterial();\n\t\t\t\tMaterial.prototype.copy.call( lineMaterial, material );\n\t\t\t\tlineMaterial.color.copy( material.color );\n\n\t\t\t\tthis.cache.add( cacheKey, lineMaterial );\n\n\t\t\t}\n\n\t\t\tmaterial = lineMaterial;\n\n\t\t}\n\n\t\t// Clone the material if it will be modified\n\t\tif ( useDerivativeTangents || useVertexColors || useFlatShading ) {\n\n\t\t\tlet cacheKey = 'ClonedMaterial:' + material.uuid + ':';\n\n\t\t\tif ( useDerivativeTangents ) cacheKey += 'derivative-tangents:';\n\t\t\tif ( useVertexColors ) cacheKey += 'vertex-colors:';\n\t\t\tif ( useFlatShading ) cacheKey += 'flat-shading:';\n\n\t\t\tlet cachedMaterial = this.cache.get( cacheKey );\n\n\t\t\tif ( ! cachedMaterial ) {\n\n\t\t\t\tcachedMaterial = material.clone();\n\n\t\t\t\tif ( useVertexColors ) cachedMaterial.vertexColors = true;\n\t\t\t\tif ( useFlatShading ) cachedMaterial.flatShading = true;\n\n\t\t\t\tif ( useDerivativeTangents ) {\n\n\t\t\t\t\t// https://github.com/mrdoob/three.js/issues/11438#issuecomment-507003995\n\t\t\t\t\tif ( cachedMaterial.normalScale ) cachedMaterial.normalScale.y *= - 1;\n\t\t\t\t\tif ( cachedMaterial.clearcoatNormalScale ) cachedMaterial.clearcoatNormalScale.y *= - 1;\n\n\t\t\t\t}\n\n\t\t\t\tthis.cache.add( cacheKey, cachedMaterial );\n\n\t\t\t\tthis.associations.set( cachedMaterial, this.associations.get( material ) );\n\n\t\t\t}\n\n\t\t\tmaterial = cachedMaterial;\n\n\t\t}\n\n\t\t// workarounds for mesh and geometry\n\n\t\tif ( material.aoMap && geometry.attributes.uv2 === undefined && geometry.attributes.uv !== undefined ) {\n\n\t\t\tgeometry.setAttribute( 'uv2', geometry.attributes.uv );\n\n\t\t}\n\n\t\tmesh.material = material;\n\n\t}\n\n\tgetMaterialType( /* materialIndex */ ) {\n\n\t\treturn MeshStandardMaterial;\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#materials\n\t * @param {number} materialIndex\n\t * @return {Promise<Material>}\n\t */\n\tloadMaterial( materialIndex ) {\n\n\t\tconst parser = this;\n\t\tconst json = this.json;\n\t\tconst extensions = this.extensions;\n\t\tconst materialDef = json.materials[ materialIndex ];\n\n\t\tlet materialType;\n\t\tconst materialParams = {};\n\t\tconst materialExtensions = materialDef.extensions || {};\n\n\t\tconst pending = [];\n\n\t\tif ( materialExtensions[ EXTENSIONS.KHR_MATERIALS_UNLIT ] ) {\n\n\t\t\tconst kmuExtension = extensions[ EXTENSIONS.KHR_MATERIALS_UNLIT ];\n\t\t\tmaterialType = kmuExtension.getMaterialType();\n\t\t\tpending.push( kmuExtension.extendParams( materialParams, materialDef, parser ) );\n\n\t\t} else {\n\n\t\t\t// Specification:\n\t\t\t// https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#metallic-roughness-material\n\n\t\t\tconst metallicRoughness = materialDef.pbrMetallicRoughness || {};\n\n\t\t\tmaterialParams.color = new Color( 1.0, 1.0, 1.0 );\n\t\t\tmaterialParams.opacity = 1.0;\n\n\t\t\tif ( Array.isArray( metallicRoughness.baseColorFactor ) ) {\n\n\t\t\t\tconst array = metallicRoughness.baseColorFactor;\n\n\t\t\t\tmaterialParams.color.fromArray( array );\n\t\t\t\tmaterialParams.opacity = array[ 3 ];\n\n\t\t\t}\n\n\t\t\tif ( metallicRoughness.baseColorTexture !== undefined ) {\n\n\t\t\t\tpending.push( parser.assignTexture( materialParams, 'map', metallicRoughness.baseColorTexture, sRGBEncoding ) );\n\n\t\t\t}\n\n\t\t\tmaterialParams.metalness = metallicRoughness.metallicFactor !== undefined ? metallicRoughness.metallicFactor : 1.0;\n\t\t\tmaterialParams.roughness = metallicRoughness.roughnessFactor !== undefined ? metallicRoughness.roughnessFactor : 1.0;\n\n\t\t\tif ( metallicRoughness.metallicRoughnessTexture !== undefined ) {\n\n\t\t\t\tpending.push( parser.assignTexture( materialParams, 'metalnessMap', metallicRoughness.metallicRoughnessTexture ) );\n\t\t\t\tpending.push( parser.assignTexture( materialParams, 'roughnessMap', metallicRoughness.metallicRoughnessTexture ) );\n\n\t\t\t}\n\n\t\t\tmaterialType = this._invokeOne( function ( ext ) {\n\n\t\t\t\treturn ext.getMaterialType && ext.getMaterialType( materialIndex );\n\n\t\t\t} );\n\n\t\t\tpending.push( Promise.all( this._invokeAll( function ( ext ) {\n\n\t\t\t\treturn ext.extendMaterialParams && ext.extendMaterialParams( materialIndex, materialParams );\n\n\t\t\t} ) ) );\n\n\t\t}\n\n\t\tif ( materialDef.doubleSided === true ) {\n\n\t\t\tmaterialParams.side = DoubleSide;\n\n\t\t}\n\n\t\tconst alphaMode = materialDef.alphaMode || ALPHA_MODES.OPAQUE;\n\n\t\tif ( alphaMode === ALPHA_MODES.BLEND ) {\n\n\t\t\tmaterialParams.transparent = true;\n\n\t\t\t// See: https://github.com/mrdoob/three.js/issues/17706\n\t\t\tmaterialParams.depthWrite = false;\n\n\t\t} else {\n\n\t\t\tmaterialParams.transparent = false;\n\n\t\t\tif ( alphaMode === ALPHA_MODES.MASK ) {\n\n\t\t\t\tmaterialParams.alphaTest = materialDef.alphaCutoff !== undefined ? materialDef.alphaCutoff : 0.5;\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( materialDef.normalTexture !== undefined && materialType !== MeshBasicMaterial ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'normalMap', materialDef.normalTexture ) );\n\n\t\t\tmaterialParams.normalScale = new Vector2( 1, 1 );\n\n\t\t\tif ( materialDef.normalTexture.scale !== undefined ) {\n\n\t\t\t\tconst scale = materialDef.normalTexture.scale;\n\n\t\t\t\tmaterialParams.normalScale.set( scale, scale );\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( materialDef.occlusionTexture !== undefined && materialType !== MeshBasicMaterial ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'aoMap', materialDef.occlusionTexture ) );\n\n\t\t\tif ( materialDef.occlusionTexture.strength !== undefined ) {\n\n\t\t\t\tmaterialParams.aoMapIntensity = materialDef.occlusionTexture.strength;\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( materialDef.emissiveFactor !== undefined && materialType !== MeshBasicMaterial ) {\n\n\t\t\tmaterialParams.emissive = new Color().fromArray( materialDef.emissiveFactor );\n\n\t\t}\n\n\t\tif ( materialDef.emissiveTexture !== undefined && materialType !== MeshBasicMaterial ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'emissiveMap', materialDef.emissiveTexture, sRGBEncoding ) );\n\n\t\t}\n\n\t\treturn Promise.all( pending ).then( function () {\n\n\t\t\tconst material = new materialType( materialParams );\n\n\t\t\tif ( materialDef.name ) material.name = materialDef.name;\n\n\t\t\tassignExtrasToUserData( material, materialDef );\n\n\t\t\tparser.associations.set( material, { materials: materialIndex } );\n\n\t\t\tif ( materialDef.extensions ) addUnknownExtensionsToUserData( extensions, material, materialDef );\n\n\t\t\treturn material;\n\n\t\t} );\n\n\t}\n\n\t/** When Object3D instances are targeted by animation, they need unique names. */\n\tcreateUniqueName( originalName ) {\n\n\t\tconst sanitizedName = PropertyBinding.sanitizeNodeName( originalName || '' );\n\n\t\tlet name = sanitizedName;\n\n\t\tfor ( let i = 1; this.nodeNamesUsed[ name ]; ++ i ) {\n\n\t\t\tname = sanitizedName + '_' + i;\n\n\t\t}\n\n\t\tthis.nodeNamesUsed[ name ] = true;\n\n\t\treturn name;\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#geometry\n\t *\n\t * Creates BufferGeometries from primitives.\n\t *\n\t * @param {Array<GLTF.Primitive>} primitives\n\t * @return {Promise<Array<BufferGeometry>>}\n\t */\n\tloadGeometries( primitives ) {\n\n\t\tconst parser = this;\n\t\tconst extensions = this.extensions;\n\t\tconst cache = this.primitiveCache;\n\n\t\tfunction createDracoPrimitive( primitive ) {\n\n\t\t\treturn extensions[ EXTENSIONS.KHR_DRACO_MESH_COMPRESSION ]\n\t\t\t\t.decodePrimitive( primitive, parser )\n\t\t\t\t.then( function ( geometry ) {\n\n\t\t\t\t\treturn addPrimitiveAttributes( geometry, primitive, parser );\n\n\t\t\t\t} );\n\n\t\t}\n\n\t\tconst pending = [];\n\n\t\tfor ( let i = 0, il = primitives.length; i < il; i ++ ) {\n\n\t\t\tconst primitive = primitives[ i ];\n\t\t\tconst cacheKey = createPrimitiveKey( primitive );\n\n\t\t\t// See if we've already created this geometry\n\t\t\tconst cached = cache[ cacheKey ];\n\n\t\t\tif ( cached ) {\n\n\t\t\t\t// Use the cached geometry if it exists\n\t\t\t\tpending.push( cached.promise );\n\n\t\t\t} else {\n\n\t\t\t\tlet geometryPromise;\n\n\t\t\t\tif ( primitive.extensions && primitive.extensions[ EXTENSIONS.KHR_DRACO_MESH_COMPRESSION ] ) {\n\n\t\t\t\t\t// Use DRACO geometry if available\n\t\t\t\t\tgeometryPromise = createDracoPrimitive( primitive );\n\n\t\t\t\t} else {\n\n\t\t\t\t\t// Otherwise create a new geometry\n\t\t\t\t\tgeometryPromise = addPrimitiveAttributes( new BufferGeometry(), primitive, parser );\n\n\t\t\t\t}\n\n\t\t\t\t// Cache this geometry\n\t\t\t\tcache[ cacheKey ] = { primitive: primitive, promise: geometryPromise };\n\n\t\t\t\tpending.push( geometryPromise );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#meshes\n\t * @param {number} meshIndex\n\t * @return {Promise<Group|Mesh|SkinnedMesh>}\n\t */\n\tloadMesh( meshIndex ) {\n\n\t\tconst parser = this;\n\t\tconst json = this.json;\n\t\tconst extensions = this.extensions;\n\n\t\tconst meshDef = json.meshes[ meshIndex ];\n\t\tconst primitives = meshDef.primitives;\n\n\t\tconst pending = [];\n\n\t\tfor ( let i = 0, il = primitives.length; i < il; i ++ ) {\n\n\t\t\tconst material = primitives[ i ].material === undefined\n\t\t\t\t? createDefaultMaterial( this.cache )\n\t\t\t\t: this.getDependency( 'material', primitives[ i ].material );\n\n\t\t\tpending.push( material );\n\n\t\t}\n\n\t\tpending.push( parser.loadGeometries( primitives ) );\n\n\t\treturn Promise.all( pending ).then( function ( results ) {\n\n\t\t\tconst materials = results.slice( 0, results.length - 1 );\n\t\t\tconst geometries = results[ results.length - 1 ];\n\n\t\t\tconst meshes = [];\n\n\t\t\tfor ( let i = 0, il = geometries.length; i < il; i ++ ) {\n\n\t\t\t\tconst geometry = geometries[ i ];\n\t\t\t\tconst primitive = primitives[ i ];\n\n\t\t\t\t// 1. create Mesh\n\n\t\t\t\tlet mesh;\n\n\t\t\t\tconst material = materials[ i ];\n\n\t\t\t\tif ( primitive.mode === WEBGL_CONSTANTS.TRIANGLES ||\n\t\t\t\t\t\tprimitive.mode === WEBGL_CONSTANTS.TRIANGLE_STRIP ||\n\t\t\t\t\t\tprimitive.mode === WEBGL_CONSTANTS.TRIANGLE_FAN ||\n\t\t\t\t\t\tprimitive.mode === undefined ) {\n\n\t\t\t\t\t// .isSkinnedMesh isn't in glTF spec. See ._markDefs()\n\t\t\t\t\tmesh = meshDef.isSkinnedMesh === true\n\t\t\t\t\t\t? new SkinnedMesh( geometry, material )\n\t\t\t\t\t\t: new Mesh( geometry, material );\n\n\t\t\t\t\tif ( mesh.isSkinnedMesh === true && ! mesh.geometry.attributes.skinWeight.normalized ) {\n\n\t\t\t\t\t\t// we normalize floating point skin weight array to fix malformed assets (see #15319)\n\t\t\t\t\t\t// it's important to skip this for non-float32 data since normalizeSkinWeights assumes non-normalized inputs\n\t\t\t\t\t\tmesh.normalizeSkinWeights();\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( primitive.mode === WEBGL_CONSTANTS.TRIANGLE_STRIP ) {\n\n\t\t\t\t\t\tmesh.geometry = toTrianglesDrawMode( mesh.geometry, TriangleStripDrawMode );\n\n\t\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.TRIANGLE_FAN ) {\n\n\t\t\t\t\t\tmesh.geometry = toTrianglesDrawMode( mesh.geometry, TriangleFanDrawMode );\n\n\t\t\t\t\t}\n\n\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.LINES ) {\n\n\t\t\t\t\tmesh = new LineSegments( geometry, material );\n\n\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.LINE_STRIP ) {\n\n\t\t\t\t\tmesh = new Line( geometry, material );\n\n\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.LINE_LOOP ) {\n\n\t\t\t\t\tmesh = new LineLoop( geometry, material );\n\n\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.POINTS ) {\n\n\t\t\t\t\tmesh = new Points( geometry, material );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tthrow new Error( 'THREE.GLTFLoader: Primitive mode unsupported: ' + primitive.mode );\n\n\t\t\t\t}\n\n\t\t\t\tif ( Object.keys( mesh.geometry.morphAttributes ).length > 0 ) {\n\n\t\t\t\t\tupdateMorphTargets( mesh, meshDef );\n\n\t\t\t\t}\n\n\t\t\t\tmesh.name = parser.createUniqueName( meshDef.name || ( 'mesh_' + meshIndex ) );\n\n\t\t\t\tassignExtrasToUserData( mesh, meshDef );\n\n\t\t\t\tif ( primitive.extensions ) addUnknownExtensionsToUserData( extensions, mesh, primitive );\n\n\t\t\t\tparser.assignFinalMaterial( mesh );\n\n\t\t\t\tmeshes.push( mesh );\n\n\t\t\t}\n\n\t\t\tfor ( let i = 0, il = meshes.length; i < il; i ++ ) {\n\n\t\t\t\tparser.associations.set( meshes[ i ], {\n\t\t\t\t\tmeshes: meshIndex,\n\t\t\t\t\tprimitives: i\n\t\t\t\t} );\n\n\t\t\t}\n\n\t\t\tif ( meshes.length === 1 ) {\n\n\t\t\t\treturn meshes[ 0 ];\n\n\t\t\t}\n\n\t\t\tconst group = new Group();\n\n\t\t\tparser.associations.set( group, { meshes: meshIndex } );\n\n\t\t\tfor ( let i = 0, il = meshes.length; i < il; i ++ ) {\n\n\t\t\t\tgroup.add( meshes[ i ] );\n\n\t\t\t}\n\n\t\t\treturn group;\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#cameras\n\t * @param {number} cameraIndex\n\t * @return {Promise<THREE.Camera>}\n\t */\n\tloadCamera( cameraIndex ) {\n\n\t\tlet camera;\n\t\tconst cameraDef = this.json.cameras[ cameraIndex ];\n\t\tconst params = cameraDef[ cameraDef.type ];\n\n\t\tif ( ! params ) {\n\n\t\t\tconsole.warn( 'THREE.GLTFLoader: Missing camera parameters.' );\n\t\t\treturn;\n\n\t\t}\n\n\t\tif ( cameraDef.type === 'perspective' ) {\n\n\t\t\tcamera = new PerspectiveCamera( MathUtils.radToDeg( params.yfov ), params.aspectRatio || 1, params.znear || 1, params.zfar || 2e6 );\n\n\t\t} else if ( cameraDef.type === 'orthographic' ) {\n\n\t\t\tcamera = new OrthographicCamera( - params.xmag, params.xmag, params.ymag, - params.ymag, params.znear, params.zfar );\n\n\t\t}\n\n\t\tif ( cameraDef.name ) camera.name = this.createUniqueName( cameraDef.name );\n\n\t\tassignExtrasToUserData( camera, cameraDef );\n\n\t\treturn Promise.resolve( camera );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#skins\n\t * @param {number} skinIndex\n\t * @return {Promise<Skeleton>}\n\t */\n\tloadSkin( skinIndex ) {\n\n\t\tconst skinDef = this.json.skins[ skinIndex ];\n\n\t\tconst pending = [];\n\n\t\tfor ( let i = 0, il = skinDef.joints.length; i < il; i ++ ) {\n\n\t\t\tpending.push( this.getDependency( 'node', skinDef.joints[ i ] ) );\n\n\t\t}\n\n\t\tif ( skinDef.inverseBindMatrices !== undefined ) {\n\n\t\t\tpending.push( this.getDependency( 'accessor', skinDef.inverseBindMatrices ) );\n\n\t\t} else {\n\n\t\t\tpending.push( null );\n\n\t\t}\n\n\t\treturn Promise.all( pending ).then( function ( results ) {\n\n\t\t\tconst inverseBindMatrices = results.pop();\n\t\t\tconst jointNodes = results;\n\n\t\t\tconst bones = [];\n\t\t\tconst boneInverses = [];\n\n\t\t\tfor ( let i = 0, il = jointNodes.length; i < il; i ++ ) {\n\n\t\t\t\tconst jointNode = jointNodes[ i ];\n\n\t\t\t\tif ( jointNode ) {\n\n\t\t\t\t\tbones.push( jointNode );\n\n\t\t\t\t\tconst mat = new Matrix4();\n\n\t\t\t\t\tif ( inverseBindMatrices !== null ) {\n\n\t\t\t\t\t\tmat.fromArray( inverseBindMatrices.array, i * 16 );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tboneInverses.push( mat );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tconsole.warn( 'THREE.GLTFLoader: Joint \"%s\" could not be found.', skinDef.joints[ i ] );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn new Skeleton( bones, boneInverses );\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#animations\n\t * @param {number} animationIndex\n\t * @return {Promise<AnimationClip>}\n\t */\n\tloadAnimation( animationIndex ) {\n\n\t\tconst json = this.json;\n\n\t\tconst animationDef = json.animations[ animationIndex ];\n\n\t\tconst pendingNodes = [];\n\t\tconst pendingInputAccessors = [];\n\t\tconst pendingOutputAccessors = [];\n\t\tconst pendingSamplers = [];\n\t\tconst pendingTargets = [];\n\n\t\tfor ( let i = 0, il = animationDef.channels.length; i < il; i ++ ) {\n\n\t\t\tconst channel = animationDef.channels[ i ];\n\t\t\tconst sampler = animationDef.samplers[ channel.sampler ];\n\t\t\tconst target = channel.target;\n\t\t\tconst name = target.node;\n\t\t\tconst input = animationDef.parameters !== undefined ? animationDef.parameters[ sampler.input ] : sampler.input;\n\t\t\tconst output = animationDef.parameters !== undefined ? animationDef.parameters[ sampler.output ] : sampler.output;\n\n\t\t\tpendingNodes.push( this.getDependency( 'node', name ) );\n\t\t\tpendingInputAccessors.push( this.getDependency( 'accessor', input ) );\n\t\t\tpendingOutputAccessors.push( this.getDependency( 'accessor', output ) );\n\t\t\tpendingSamplers.push( sampler );\n\t\t\tpendingTargets.push( target );\n\n\t\t}\n\n\t\treturn Promise.all( [\n\n\t\t\tPromise.all( pendingNodes ),\n\t\t\tPromise.all( pendingInputAccessors ),\n\t\t\tPromise.all( pendingOutputAccessors ),\n\t\t\tPromise.all( pendingSamplers ),\n\t\t\tPromise.all( pendingTargets )\n\n\t\t] ).then( function ( dependencies ) {\n\n\t\t\tconst nodes = dependencies[ 0 ];\n\t\t\tconst inputAccessors = dependencies[ 1 ];\n\t\t\tconst outputAccessors = dependencies[ 2 ];\n\t\t\tconst samplers = dependencies[ 3 ];\n\t\t\tconst targets = dependencies[ 4 ];\n\n\t\t\tconst tracks = [];\n\n\t\t\tfor ( let i = 0, il = nodes.length; i < il; i ++ ) {\n\n\t\t\t\tconst node = nodes[ i ];\n\t\t\t\tconst inputAccessor = inputAccessors[ i ];\n\t\t\t\tconst outputAccessor = outputAccessors[ i ];\n\t\t\t\tconst sampler = samplers[ i ];\n\t\t\t\tconst target = targets[ i ];\n\n\t\t\t\tif ( node === undefined ) continue;\n\n\t\t\t\tnode.updateMatrix();\n\n\t\t\t\tlet TypedKeyframeTrack;\n\n\t\t\t\tswitch ( PATH_PROPERTIES[ target.path ] ) {\n\n\t\t\t\t\tcase PATH_PROPERTIES.weights:\n\n\t\t\t\t\t\tTypedKeyframeTrack = NumberKeyframeTrack;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase PATH_PROPERTIES.rotation:\n\n\t\t\t\t\t\tTypedKeyframeTrack = QuaternionKeyframeTrack;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase PATH_PROPERTIES.position:\n\t\t\t\t\tcase PATH_PROPERTIES.scale:\n\t\t\t\t\tdefault:\n\n\t\t\t\t\t\tTypedKeyframeTrack = VectorKeyframeTrack;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t\tconst targetName = node.name ? node.name : node.uuid;\n\n\t\t\t\tconst interpolation = sampler.interpolation !== undefined ? INTERPOLATION[ sampler.interpolation ] : InterpolateLinear;\n\n\t\t\t\tconst targetNames = [];\n\n\t\t\t\tif ( PATH_PROPERTIES[ target.path ] === PATH_PROPERTIES.weights ) {\n\n\t\t\t\t\tnode.traverse( function ( object ) {\n\n\t\t\t\t\t\tif ( object.morphTargetInfluences ) {\n\n\t\t\t\t\t\t\ttargetNames.push( object.name ? object.name : object.uuid );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t} );\n\n\t\t\t\t} else {\n\n\t\t\t\t\ttargetNames.push( targetName );\n\n\t\t\t\t}\n\n\t\t\t\tlet outputArray = outputAccessor.array;\n\n\t\t\t\tif ( outputAccessor.normalized ) {\n\n\t\t\t\t\tconst scale = getNormalizedComponentScale( outputArray.constructor );\n\t\t\t\t\tconst scaled = new Float32Array( outputArray.length );\n\n\t\t\t\t\tfor ( let j = 0, jl = outputArray.length; j < jl; j ++ ) {\n\n\t\t\t\t\t\tscaled[ j ] = outputArray[ j ] * scale;\n\n\t\t\t\t\t}\n\n\t\t\t\t\toutputArray = scaled;\n\n\t\t\t\t}\n\n\t\t\t\tfor ( let j = 0, jl = targetNames.length; j < jl; j ++ ) {\n\n\t\t\t\t\tconst track = new TypedKeyframeTrack(\n\t\t\t\t\t\ttargetNames[ j ] + '.' + PATH_PROPERTIES[ target.path ],\n\t\t\t\t\t\tinputAccessor.array,\n\t\t\t\t\t\toutputArray,\n\t\t\t\t\t\tinterpolation\n\t\t\t\t\t);\n\n\t\t\t\t\t// Override interpolation with custom factory method.\n\t\t\t\t\tif ( sampler.interpolation === 'CUBICSPLINE' ) {\n\n\t\t\t\t\t\ttrack.createInterpolant = function InterpolantFactoryMethodGLTFCubicSpline( result ) {\n\n\t\t\t\t\t\t\t// A CUBICSPLINE keyframe in glTF has three output values for each input value,\n\t\t\t\t\t\t\t// representing inTangent, splineVertex, and outTangent. As a result, track.getValueSize()\n\t\t\t\t\t\t\t// must be divided by three to get the interpolant's sampleSize argument.\n\n\t\t\t\t\t\t\tconst interpolantType = ( this instanceof QuaternionKeyframeTrack ) ? GLTFCubicSplineQuaternionInterpolant : GLTFCubicSplineInterpolant;\n\n\t\t\t\t\t\t\treturn new interpolantType( this.times, this.values, this.getValueSize() / 3, result );\n\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\t// Mark as CUBICSPLINE. `track.getInterpolation()` doesn't support custom interpolants.\n\t\t\t\t\t\ttrack.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline = true;\n\n\t\t\t\t\t}\n\n\t\t\t\t\ttracks.push( track );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tconst name = animationDef.name ? animationDef.name : 'animation_' + animationIndex;\n\n\t\t\treturn new AnimationClip( name, undefined, tracks );\n\n\t\t} );\n\n\t}\n\n\tcreateNodeMesh( nodeIndex ) {\n\n\t\tconst json = this.json;\n\t\tconst parser = this;\n\t\tconst nodeDef = json.nodes[ nodeIndex ];\n\n\t\tif ( nodeDef.mesh === undefined ) return null;\n\n\t\treturn parser.getDependency( 'mesh', nodeDef.mesh ).then( function ( mesh ) {\n\n\t\t\tconst node = parser._getNodeRef( parser.meshCache, nodeDef.mesh, mesh );\n\n\t\t\t// if weights are provided on the node, override weights on the mesh.\n\t\t\tif ( nodeDef.weights !== undefined ) {\n\n\t\t\t\tnode.traverse( function ( o ) {\n\n\t\t\t\t\tif ( ! o.isMesh ) return;\n\n\t\t\t\t\tfor ( let i = 0, il = nodeDef.weights.length; i < il; i ++ ) {\n\n\t\t\t\t\t\to.morphTargetInfluences[ i ] = nodeDef.weights[ i ];\n\n\t\t\t\t\t}\n\n\t\t\t\t} );\n\n\t\t\t}\n\n\t\t\treturn node;\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#nodes-and-hierarchy\n\t * @param {number} nodeIndex\n\t * @return {Promise<Object3D>}\n\t */\n\tloadNode( nodeIndex ) {\n\n\t\tconst json = this.json;\n\t\tconst extensions = this.extensions;\n\t\tconst parser = this;\n\n\t\tconst nodeDef = json.nodes[ nodeIndex ];\n\n\t\t// reserve node's name before its dependencies, so the root has the intended name.\n\t\tconst nodeName = nodeDef.name ? parser.createUniqueName( nodeDef.name ) : '';\n\n\t\treturn ( function () {\n\n\t\t\tconst objectPending = [];\n\n\t\t\tconst meshPromise = parser._invokeOne( function ( ext ) {\n\n\t\t\t\treturn ext.createNodeMesh && ext.createNodeMesh( nodeIndex );\n\n\t\t\t} );\n\n\t\t\tif ( meshPromise ) {\n\n\t\t\t\tobjectPending.push( meshPromise );\n\n\t\t\t}\n\n\t\t\tif ( nodeDef.camera !== undefined ) {\n\n\t\t\t\tobjectPending.push( parser.getDependency( 'camera', nodeDef.camera ).then( function ( camera ) {\n\n\t\t\t\t\treturn parser._getNodeRef( parser.cameraCache, nodeDef.camera, camera );\n\n\t\t\t\t} ) );\n\n\t\t\t}\n\n\t\t\tparser._invokeAll( function ( ext ) {\n\n\t\t\t\treturn ext.createNodeAttachment && ext.createNodeAttachment( nodeIndex );\n\n\t\t\t} ).forEach( function ( promise ) {\n\n\t\t\t\tobjectPending.push( promise );\n\n\t\t\t} );\n\n\t\t\tconst childPending = [];\n\t\t\tconst childrenDef = nodeDef.children || [];\n\n\t\t\tfor ( let i = 0, il = childrenDef.length; i < il; i ++ ) {\n\n\t\t\t\tchildPending.push( parser.getDependency( 'node', childrenDef[ i ] ) );\n\n\t\t\t}\n\n\t\t\tconst skeletonPending = nodeDef.skin === undefined\n\t\t\t\t? Promise.resolve( null )\n\t\t\t\t: parser.getDependency( 'skin', nodeDef.skin );\n\n\t\t\treturn Promise.all( [\n\t\t\t\tPromise.all( objectPending ),\n\t\t\t\tPromise.all( childPending ),\n\t\t\t\tskeletonPending\n\t\t\t] );\n\n\t\t}() ).then( function ( results ) {\n\n\t\t\tconst objects = results[ 0 ];\n\t\t\tconst children = results[ 1 ];\n\t\t\tconst skeleton = results[ 2 ];\n\n\t\t\tlet node;\n\n\t\t\t// .isBone isn't in glTF spec. See ._markDefs\n\t\t\tif ( nodeDef.isBone === true ) {\n\n\t\t\t\tnode = new Bone();\n\n\t\t\t} else if ( objects.length > 1 ) {\n\n\t\t\t\tnode = new Group();\n\n\t\t\t} else if ( objects.length === 1 ) {\n\n\t\t\t\tnode = objects[ 0 ];\n\n\t\t\t} else {\n\n\t\t\t\tnode = new Object3D();\n\n\t\t\t}\n\n\t\t\tif ( node !== objects[ 0 ] ) {\n\n\t\t\t\tfor ( let i = 0, il = objects.length; i < il; i ++ ) {\n\n\t\t\t\t\tnode.add( objects[ i ] );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( nodeDef.name ) {\n\n\t\t\t\tnode.userData.name = nodeDef.name;\n\t\t\t\tnode.name = nodeName;\n\n\t\t\t}\n\n\t\t\tassignExtrasToUserData( node, nodeDef );\n\n\t\t\tif ( nodeDef.extensions ) addUnknownExtensionsToUserData( extensions, node, nodeDef );\n\n\t\t\tif ( nodeDef.matrix !== undefined ) {\n\n\t\t\t\tconst matrix = new Matrix4();\n\t\t\t\tmatrix.fromArray( nodeDef.matrix );\n\t\t\t\tnode.applyMatrix4( matrix );\n\n\t\t\t} else {\n\n\t\t\t\tif ( nodeDef.translation !== undefined ) {\n\n\t\t\t\t\tnode.position.fromArray( nodeDef.translation );\n\n\t\t\t\t}\n\n\t\t\t\tif ( nodeDef.rotation !== undefined ) {\n\n\t\t\t\t\tnode.quaternion.fromArray( nodeDef.rotation );\n\n\t\t\t\t}\n\n\t\t\t\tif ( nodeDef.scale !== undefined ) {\n\n\t\t\t\t\tnode.scale.fromArray( nodeDef.scale );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( ! parser.associations.has( node ) ) {\n\n\t\t\t\tparser.associations.set( node, {} );\n\n\t\t\t}\n\n\t\t\tparser.associations.get( node ).nodes = nodeIndex;\n\n\t\t\tif ( skeleton !== null ) {\n\n\t\t\t\t// This full traverse should be fine because\n\t\t\t\t// child glTF nodes have not been added to this node yet.\n\t\t\t\tnode.traverse( function ( mesh ) {\n\n\t\t\t\t\tif ( ! mesh.isSkinnedMesh ) return;\n\n\t\t\t\t\tmesh.bind( skeleton, _identityMatrix );\n\n\t\t\t\t} );\n\n\t\t\t}\n\n\t\t\tfor ( let i = 0, il = children.length; i < il; i ++ ) {\n\n\t\t\t\tnode.add( children[ i ] );\n\n\t\t\t}\n\n\t\t\treturn node;\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#scenes\n\t * @param {number} sceneIndex\n\t * @return {Promise<Group>}\n\t */\n\tloadScene( sceneIndex ) {\n\n\t\tconst extensions = this.extensions;\n\t\tconst sceneDef = this.json.scenes[ sceneIndex ];\n\t\tconst parser = this;\n\n\t\t// Loader returns Group, not Scene.\n\t\t// See: https://github.com/mrdoob/three.js/issues/18342#issuecomment-578981172\n\t\tconst scene = new Group();\n\t\tif ( sceneDef.name ) scene.name = parser.createUniqueName( sceneDef.name );\n\n\t\tassignExtrasToUserData( scene, sceneDef );\n\n\t\tif ( sceneDef.extensions ) addUnknownExtensionsToUserData( extensions, scene, sceneDef );\n\n\t\tconst nodeIds = sceneDef.nodes || [];\n\n\t\tconst pending = [];\n\n\t\tfor ( let i = 0, il = nodeIds.length; i < il; i ++ ) {\n\n\t\t\tpending.push( parser.getDependency( 'node', nodeIds[ i ] ) );\n\n\t\t}\n\n\t\treturn Promise.all( pending ).then( function ( nodes ) {\n\n\t\t\tfor ( let i = 0, il = nodes.length; i < il; i ++ ) {\n\n\t\t\t\tscene.add( nodes[ i ] );\n\n\t\t\t}\n\n\t\t\t// Removes dangling associations, associations that reference a node that\n\t\t\t// didn't make it into the scene.\n\t\t\tconst reduceAssociations = ( node ) => {\n\n\t\t\t\tconst reducedAssociations = new Map();\n\n\t\t\t\tfor ( const [ key, value ] of parser.associations ) {\n\n\t\t\t\t\tif ( key instanceof Material || key instanceof Texture ) {\n\n\t\t\t\t\t\treducedAssociations.set( key, value );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tnode.traverse( ( node ) => {\n\n\t\t\t\t\tconst mappings = parser.associations.get( node );\n\n\t\t\t\t\tif ( mappings != null ) {\n\n\t\t\t\t\t\treducedAssociations.set( node, mappings );\n\n\t\t\t\t\t}\n\n\t\t\t\t} );\n\n\t\t\t\treturn reducedAssociations;\n\n\t\t\t};\n\n\t\t\tparser.associations = reduceAssociations( scene );\n\n\t\t\treturn scene;\n\n\t\t} );\n\n\t}\n\n}\n\n/**\n * @param {BufferGeometry} geometry\n * @param {GLTF.Primitive} primitiveDef\n * @param {GLTFParser} parser\n */\nfunction computeBounds( geometry, primitiveDef, parser ) {\n\n\tconst attributes = primitiveDef.attributes;\n\n\tconst box = new Box3();\n\n\tif ( attributes.POSITION !== undefined ) {\n\n\t\tconst accessor = parser.json.accessors[ attributes.POSITION ];\n\n\t\tconst min = accessor.min;\n\t\tconst max = accessor.max;\n\n\t\t// glTF requires 'min' and 'max', but VRM (which extends glTF) currently ignores that requirement.\n\n\t\tif ( min !== undefined && max !== undefined ) {\n\n\t\t\tbox.set(\n\t\t\t\tnew Vector3( min[ 0 ], min[ 1 ], min[ 2 ] ),\n\t\t\t\tnew Vector3( max[ 0 ], max[ 1 ], max[ 2 ] )\n\t\t\t);\n\n\t\t\tif ( accessor.normalized ) {\n\n\t\t\t\tconst boxScale = getNormalizedComponentScale( WEBGL_COMPONENT_TYPES[ accessor.componentType ] );\n\t\t\t\tbox.min.multiplyScalar( boxScale );\n\t\t\t\tbox.max.multiplyScalar( boxScale );\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tconsole.warn( 'THREE.GLTFLoader: Missing min/max properties for accessor POSITION.' );\n\n\t\t\treturn;\n\n\t\t}\n\n\t} else {\n\n\t\treturn;\n\n\t}\n\n\tconst targets = primitiveDef.targets;\n\n\tif ( targets !== undefined ) {\n\n\t\tconst maxDisplacement = new Vector3();\n\t\tconst vector = new Vector3();\n\n\t\tfor ( let i = 0, il = targets.length; i < il; i ++ ) {\n\n\t\t\tconst target = targets[ i ];\n\n\t\t\tif ( target.POSITION !== undefined ) {\n\n\t\t\t\tconst accessor = parser.json.accessors[ target.POSITION ];\n\t\t\t\tconst min = accessor.min;\n\t\t\t\tconst max = accessor.max;\n\n\t\t\t\t// glTF requires 'min' and 'max', but VRM (which extends glTF) currently ignores that requirement.\n\n\t\t\t\tif ( min !== undefined && max !== undefined ) {\n\n\t\t\t\t\t// we need to get max of absolute components because target weight is [-1,1]\n\t\t\t\t\tvector.setX( Math.max( Math.abs( min[ 0 ] ), Math.abs( max[ 0 ] ) ) );\n\t\t\t\t\tvector.setY( Math.max( Math.abs( min[ 1 ] ), Math.abs( max[ 1 ] ) ) );\n\t\t\t\t\tvector.setZ( Math.max( Math.abs( min[ 2 ] ), Math.abs( max[ 2 ] ) ) );\n\n\n\t\t\t\t\tif ( accessor.normalized ) {\n\n\t\t\t\t\t\tconst boxScale = getNormalizedComponentScale( WEBGL_COMPONENT_TYPES[ accessor.componentType ] );\n\t\t\t\t\t\tvector.multiplyScalar( boxScale );\n\n\t\t\t\t\t}\n\n\t\t\t\t\t// Note: this assumes that the sum of all weights is at most 1. This isn't quite correct - it's more conservative\n\t\t\t\t\t// to assume that each target can have a max weight of 1. However, for some use cases - notably, when morph targets\n\t\t\t\t\t// are used to implement key-frame animations and as such only two are active at a time - this results in very large\n\t\t\t\t\t// boxes. So for now we make a box that's sometimes a touch too small but is hopefully mostly of reasonable size.\n\t\t\t\t\tmaxDisplacement.max( vector );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tconsole.warn( 'THREE.GLTFLoader: Missing min/max properties for accessor POSITION.' );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\t// As per comment above this box isn't conservative, but has a reasonable size for a very large number of morph targets.\n\t\tbox.expandByVector( maxDisplacement );\n\n\t}\n\n\tgeometry.boundingBox = box;\n\n\tconst sphere = new Sphere();\n\n\tbox.getCenter( sphere.center );\n\tsphere.radius = box.min.distanceTo( box.max ) / 2;\n\n\tgeometry.boundingSphere = sphere;\n\n}\n\n/**\n * @param {BufferGeometry} geometry\n * @param {GLTF.Primitive} primitiveDef\n * @param {GLTFParser} parser\n * @return {Promise<BufferGeometry>}\n */\nfunction addPrimitiveAttributes( geometry, primitiveDef, parser ) {\n\n\tconst attributes = primitiveDef.attributes;\n\n\tconst pending = [];\n\n\tfunction assignAttributeAccessor( accessorIndex, attributeName ) {\n\n\t\treturn parser.getDependency( 'accessor', accessorIndex )\n\t\t\t.then( function ( accessor ) {\n\n\t\t\t\tgeometry.setAttribute( attributeName, accessor );\n\n\t\t\t} );\n\n\t}\n\n\tfor ( const gltfAttributeName in attributes ) {\n\n\t\tconst threeAttributeName = ATTRIBUTES[ gltfAttributeName ] || gltfAttributeName.toLowerCase();\n\n\t\t// Skip attributes already provided by e.g. Draco extension.\n\t\tif ( threeAttributeName in geometry.attributes ) continue;\n\n\t\tpending.push( assignAttributeAccessor( attributes[ gltfAttributeName ], threeAttributeName ) );\n\n\t}\n\n\tif ( primitiveDef.indices !== undefined && ! geometry.index ) {\n\n\t\tconst accessor = parser.getDependency( 'accessor', primitiveDef.indices ).then( function ( accessor ) {\n\n\t\t\tgeometry.setIndex( accessor );\n\n\t\t} );\n\n\t\tpending.push( accessor );\n\n\t}\n\n\tassignExtrasToUserData( geometry, primitiveDef );\n\n\tcomputeBounds( geometry, primitiveDef, parser );\n\n\treturn Promise.all( pending ).then( function () {\n\n\t\treturn primitiveDef.targets !== undefined\n\t\t\t? addMorphTargets( geometry, primitiveDef.targets, parser )\n\t\t\t: geometry;\n\n\t} );\n\n}\n\nexport { GLTFLoader };\n","import {\n\tBufferAttribute,\n\tBufferGeometry,\n\tFileLoader,\n\tLoader\n} from 'three';\n\nconst _taskCache = new WeakMap();\n\nclass DRACOLoader extends Loader {\n\n\tconstructor( manager ) {\n\n\t\tsuper( manager );\n\n\t\tthis.decoderPath = '';\n\t\tthis.decoderConfig = {};\n\t\tthis.decoderBinary = null;\n\t\tthis.decoderPending = null;\n\n\t\tthis.workerLimit = 4;\n\t\tthis.workerPool = [];\n\t\tthis.workerNextTaskID = 1;\n\t\tthis.workerSourceURL = '';\n\n\t\tthis.defaultAttributeIDs = {\n\t\t\tposition: 'POSITION',\n\t\t\tnormal: 'NORMAL',\n\t\t\tcolor: 'COLOR',\n\t\t\tuv: 'TEX_COORD'\n\t\t};\n\t\tthis.defaultAttributeTypes = {\n\t\t\tposition: 'Float32Array',\n\t\t\tnormal: 'Float32Array',\n\t\t\tcolor: 'Float32Array',\n\t\t\tuv: 'Float32Array'\n\t\t};\n\n\t}\n\n\tsetDecoderPath( path ) {\n\n\t\tthis.decoderPath = path;\n\n\t\treturn this;\n\n\t}\n\n\tsetDecoderConfig( config ) {\n\n\t\tthis.decoderConfig = config;\n\n\t\treturn this;\n\n\t}\n\n\tsetWorkerLimit( workerLimit ) {\n\n\t\tthis.workerLimit = workerLimit;\n\n\t\treturn this;\n\n\t}\n\n\tload( url, onLoad, onProgress, onError ) {\n\n\t\tconst loader = new FileLoader( this.manager );\n\n\t\tloader.setPath( this.path );\n\t\tloader.setResponseType( 'arraybuffer' );\n\t\tloader.setRequestHeader( this.requestHeader );\n\t\tloader.setWithCredentials( this.withCredentials );\n\n\t\tloader.load( url, ( buffer ) => {\n\n\t\t\tthis.decodeDracoFile( buffer, onLoad ).catch( onError );\n\n\t\t}, onProgress, onError );\n\n\t}\n\n\tdecodeDracoFile( buffer, callback, attributeIDs, attributeTypes ) {\n\n\t\tconst taskConfig = {\n\t\t\tattributeIDs: attributeIDs || this.defaultAttributeIDs,\n\t\t\tattributeTypes: attributeTypes || this.defaultAttributeTypes,\n\t\t\tuseUniqueIDs: !! attributeIDs\n\t\t};\n\n\t\treturn this.decodeGeometry( buffer, taskConfig ).then( callback );\n\n\t}\n\n\tdecodeGeometry( buffer, taskConfig ) {\n\n\t\tconst taskKey = JSON.stringify( taskConfig );\n\n\t\t// Check for an existing task using this buffer. A transferred buffer cannot be transferred\n\t\t// again from this thread.\n\t\tif ( _taskCache.has( buffer ) ) {\n\n\t\t\tconst cachedTask = _taskCache.get( buffer );\n\n\t\t\tif ( cachedTask.key === taskKey ) {\n\n\t\t\t\treturn cachedTask.promise;\n\n\t\t\t} else if ( buffer.byteLength === 0 ) {\n\n\t\t\t\t// Technically, it would be possible to wait for the previous task to complete,\n\t\t\t\t// transfer the buffer back, and decode again with the second configuration. That\n\t\t\t\t// is complex, and I don't know of any reason to decode a Draco buffer twice in\n\t\t\t\t// different ways, so this is left unimplemented.\n\t\t\t\tthrow new Error(\n\n\t\t\t\t\t'THREE.DRACOLoader: Unable to re-decode a buffer with different ' +\n\t\t\t\t\t'settings. Buffer has already been transferred.'\n\n\t\t\t\t);\n\n\t\t\t}\n\n\t\t}\n\n\t\t//\n\n\t\tlet worker;\n\t\tconst taskID = this.workerNextTaskID ++;\n\t\tconst taskCost = buffer.byteLength;\n\n\t\t// Obtain a worker and assign a task, and construct a geometry instance\n\t\t// when the task completes.\n\t\tconst geometryPending = this._getWorker( taskID, taskCost )\n\t\t\t.then( ( _worker ) => {\n\n\t\t\t\tworker = _worker;\n\n\t\t\t\treturn new Promise( ( resolve, reject ) => {\n\n\t\t\t\t\tworker._callbacks[ taskID ] = { resolve, reject };\n\n\t\t\t\t\tworker.postMessage( { type: 'decode', id: taskID, taskConfig, buffer }, [ buffer ] );\n\n\t\t\t\t\t// this.debug();\n\n\t\t\t\t} );\n\n\t\t\t} )\n\t\t\t.then( ( message ) => this._createGeometry( message.geometry ) );\n\n\t\t// Remove task from the task list.\n\t\t// Note: replaced '.finally()' with '.catch().then()' block - iOS 11 support (#19416)\n\t\tgeometryPending\n\t\t\t.catch( () => true )\n\t\t\t.then( () => {\n\n\t\t\t\tif ( worker && taskID ) {\n\n\t\t\t\t\tthis._releaseTask( worker, taskID );\n\n\t\t\t\t\t// this.debug();\n\n\t\t\t\t}\n\n\t\t\t} );\n\n\t\t// Cache the task result.\n\t\t_taskCache.set( buffer, {\n\n\t\t\tkey: taskKey,\n\t\t\tpromise: geometryPending\n\n\t\t} );\n\n\t\treturn geometryPending;\n\n\t}\n\n\t_createGeometry( geometryData ) {\n\n\t\tconst geometry = new BufferGeometry();\n\n\t\tif ( geometryData.index ) {\n\n\t\t\tgeometry.setIndex( new BufferAttribute( geometryData.index.array, 1 ) );\n\n\t\t}\n\n\t\tfor ( let i = 0; i < geometryData.attributes.length; i ++ ) {\n\n\t\t\tconst attribute = geometryData.attributes[ i ];\n\t\t\tconst name = attribute.name;\n\t\t\tconst array = attribute.array;\n\t\t\tconst itemSize = attribute.itemSize;\n\n\t\t\tgeometry.setAttribute( name, new BufferAttribute( array, itemSize ) );\n\n\t\t}\n\n\t\treturn geometry;\n\n\t}\n\n\t_loadLibrary( url, responseType ) {\n\n\t\tconst loader = new FileLoader( this.manager );\n\t\tloader.setPath( this.decoderPath );\n\t\tloader.setResponseType( responseType );\n\t\tloader.setWithCredentials( this.withCredentials );\n\n\t\treturn new Promise( ( resolve, reject ) => {\n\n\t\t\tloader.load( url, resolve, undefined, reject );\n\n\t\t} );\n\n\t}\n\n\tpreload() {\n\n\t\tthis._initDecoder();\n\n\t\treturn this;\n\n\t}\n\n\t_initDecoder() {\n\n\t\tif ( this.decoderPending ) return this.decoderPending;\n\n\t\tconst useJS = typeof WebAssembly !== 'object' || this.decoderConfig.type === 'js';\n\t\tconst librariesPending = [];\n\n\t\tif ( useJS ) {\n\n\t\t\tlibrariesPending.push( this._loadLibrary( 'draco_decoder.js', 'text' ) );\n\n\t\t} else {\n\n\t\t\tlibrariesPending.push( this._loadLibrary( 'draco_wasm_wrapper.js', 'text' ) );\n\t\t\tlibrariesPending.push( this._loadLibrary( 'draco_decoder.wasm', 'arraybuffer' ) );\n\n\t\t}\n\n\t\tthis.decoderPending = Promise.all( librariesPending )\n\t\t\t.then( ( libraries ) => {\n\n\t\t\t\tconst jsContent = libraries[ 0 ];\n\n\t\t\t\tif ( ! useJS ) {\n\n\t\t\t\t\tthis.decoderConfig.wasmBinary = libraries[ 1 ];\n\n\t\t\t\t}\n\n\t\t\t\tconst fn = DRACOWorker.toString();\n\n\t\t\t\tconst body = [\n\t\t\t\t\t'/* draco decoder */',\n\t\t\t\t\tjsContent,\n\t\t\t\t\t'',\n\t\t\t\t\t'/* worker */',\n\t\t\t\t\tfn.substring( fn.indexOf( '{' ) + 1, fn.lastIndexOf( '}' ) )\n\t\t\t\t].join( '\\n' );\n\n\t\t\t\tthis.workerSourceURL = URL.createObjectURL( new Blob( [ body ] ) );\n\n\t\t\t} );\n\n\t\treturn this.decoderPending;\n\n\t}\n\n\t_getWorker( taskID, taskCost ) {\n\n\t\treturn this._initDecoder().then( () => {\n\n\t\t\tif ( this.workerPool.length < this.workerLimit ) {\n\n\t\t\t\tconst worker = new Worker( this.workerSourceURL );\n\n\t\t\t\tworker._callbacks = {};\n\t\t\t\tworker._taskCosts = {};\n\t\t\t\tworker._taskLoad = 0;\n\n\t\t\t\tworker.postMessage( { type: 'init', decoderConfig: this.decoderConfig } );\n\n\t\t\t\tworker.onmessage = function ( e ) {\n\n\t\t\t\t\tconst message = e.data;\n\n\t\t\t\t\tswitch ( message.type ) {\n\n\t\t\t\t\t\tcase 'decode':\n\t\t\t\t\t\t\tworker._callbacks[ message.id ].resolve( message );\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'error':\n\t\t\t\t\t\t\tworker._callbacks[ message.id ].reject( message );\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tconsole.error( 'THREE.DRACOLoader: Unexpected message, \"' + message.type + '\"' );\n\n\t\t\t\t\t}\n\n\t\t\t\t};\n\n\t\t\t\tthis.workerPool.push( worker );\n\n\t\t\t} else {\n\n\t\t\t\tthis.workerPool.sort( function ( a, b ) {\n\n\t\t\t\t\treturn a._taskLoad > b._taskLoad ? - 1 : 1;\n\n\t\t\t\t} );\n\n\t\t\t}\n\n\t\t\tconst worker = this.workerPool[ this.workerPool.length - 1 ];\n\t\t\tworker._taskCosts[ taskID ] = taskCost;\n\t\t\tworker._taskLoad += taskCost;\n\t\t\treturn worker;\n\n\t\t} );\n\n\t}\n\n\t_releaseTask( worker, taskID ) {\n\n\t\tworker._taskLoad -= worker._taskCosts[ taskID ];\n\t\tdelete worker._callbacks[ taskID ];\n\t\tdelete worker._taskCosts[ taskID ];\n\n\t}\n\n\tdebug() {\n\n\t\tconsole.log( 'Task load: ', this.workerPool.map( ( worker ) => worker._taskLoad ) );\n\n\t}\n\n\tdispose() {\n\n\t\tfor ( let i = 0; i < this.workerPool.length; ++ i ) {\n\n\t\t\tthis.workerPool[ i ].terminate();\n\n\t\t}\n\n\t\tthis.workerPool.length = 0;\n\n\t\tif ( this.workerSourceURL !== '' ) {\n\n\t\t\tURL.revokeObjectURL( this.workerSourceURL );\n\n\t\t}\n\n\t\treturn this;\n\n\t}\n\n}\n\n/* WEB WORKER */\n\nfunction DRACOWorker() {\n\n\tlet decoderConfig;\n\tlet decoderPending;\n\n\tonmessage = function ( e ) {\n\n\t\tconst message = e.data;\n\n\t\tswitch ( message.type ) {\n\n\t\t\tcase 'init':\n\t\t\t\tdecoderConfig = message.decoderConfig;\n\t\t\t\tdecoderPending = new Promise( function ( resolve/*, reject*/ ) {\n\n\t\t\t\t\tdecoderConfig.onModuleLoaded = function ( draco ) {\n\n\t\t\t\t\t\t// Module is Promise-like. Wrap before resolving to avoid loop.\n\t\t\t\t\t\tresolve( { draco: draco } );\n\n\t\t\t\t\t};\n\n\t\t\t\t\tDracoDecoderModule( decoderConfig ); // eslint-disable-line no-undef\n\n\t\t\t\t} );\n\t\t\t\tbreak;\n\n\t\t\tcase 'decode':\n\t\t\t\tconst buffer = message.buffer;\n\t\t\t\tconst taskConfig = message.taskConfig;\n\t\t\t\tdecoderPending.then( ( module ) => {\n\n\t\t\t\t\tconst draco = module.draco;\n\t\t\t\t\tconst decoder = new draco.Decoder();\n\t\t\t\t\tconst decoderBuffer = new draco.DecoderBuffer();\n\t\t\t\t\tdecoderBuffer.Init( new Int8Array( buffer ), buffer.byteLength );\n\n\t\t\t\t\ttry {\n\n\t\t\t\t\t\tconst geometry = decodeGeometry( draco, decoder, decoderBuffer, taskConfig );\n\n\t\t\t\t\t\tconst buffers = geometry.attributes.map( ( attr ) => attr.array.buffer );\n\n\t\t\t\t\t\tif ( geometry.index ) buffers.push( geometry.index.array.buffer );\n\n\t\t\t\t\t\tself.postMessage( { type: 'decode', id: message.id, geometry }, buffers );\n\n\t\t\t\t\t} catch ( error ) {\n\n\t\t\t\t\t\tconsole.error( error );\n\n\t\t\t\t\t\tself.postMessage( { type: 'error', id: message.id, error: error.message } );\n\n\t\t\t\t\t} finally {\n\n\t\t\t\t\t\tdraco.destroy( decoderBuffer );\n\t\t\t\t\t\tdraco.destroy( decoder );\n\n\t\t\t\t\t}\n\n\t\t\t\t} );\n\t\t\t\tbreak;\n\n\t\t}\n\n\t};\n\n\tfunction decodeGeometry( draco, decoder, decoderBuffer, taskConfig ) {\n\n\t\tconst attributeIDs = taskConfig.attributeIDs;\n\t\tconst attributeTypes = taskConfig.attributeTypes;\n\n\t\tlet dracoGeometry;\n\t\tlet decodingStatus;\n\n\t\tconst geometryType = decoder.GetEncodedGeometryType( decoderBuffer );\n\n\t\tif ( geometryType === draco.TRIANGULAR_MESH ) {\n\n\t\t\tdracoGeometry = new draco.Mesh();\n\t\t\tdecodingStatus = decoder.DecodeBufferToMesh( decoderBuffer, dracoGeometry );\n\n\t\t} else if ( geometryType === draco.POINT_CLOUD ) {\n\n\t\t\tdracoGeometry = new draco.PointCloud();\n\t\t\tdecodingStatus = decoder.DecodeBufferToPointCloud( decoderBuffer, dracoGeometry );\n\n\t\t} else {\n\n\t\t\tthrow new Error( 'THREE.DRACOLoader: Unexpected geometry type.' );\n\n\t\t}\n\n\t\tif ( ! decodingStatus.ok() || dracoGeometry.ptr === 0 ) {\n\n\t\t\tthrow new Error( 'THREE.DRACOLoader: Decoding failed: ' + decodingStatus.error_msg() );\n\n\t\t}\n\n\t\tconst geometry = { index: null, attributes: [] };\n\n\t\t// Gather all vertex attributes.\n\t\tfor ( const attributeName in attributeIDs ) {\n\n\t\t\tconst attributeType = self[ attributeTypes[ attributeName ] ];\n\n\t\t\tlet attribute;\n\t\t\tlet attributeID;\n\n\t\t\t// A Draco file may be created with default vertex attributes, whose attribute IDs\n\t\t\t// are mapped 1:1 from their semantic name (POSITION, NORMAL, ...). Alternatively,\n\t\t\t// a Draco file may contain a custom set of attributes, identified by known unique\n\t\t\t// IDs. glTF files always do the latter, and `.drc` files typically do the former.\n\t\t\tif ( taskConfig.useUniqueIDs ) {\n\n\t\t\t\tattributeID = attributeIDs[ attributeName ];\n\t\t\t\tattribute = decoder.GetAttributeByUniqueId( dracoGeometry, attributeID );\n\n\t\t\t} else {\n\n\t\t\t\tattributeID = decoder.GetAttributeId( dracoGeometry, draco[ attributeIDs[ attributeName ] ] );\n\n\t\t\t\tif ( attributeID === - 1 ) continue;\n\n\t\t\t\tattribute = decoder.GetAttribute( dracoGeometry, attributeID );\n\n\t\t\t}\n\n\t\t\tgeometry.attributes.push( decodeAttribute( draco, decoder, dracoGeometry, attributeName, attributeType, attribute ) );\n\n\t\t}\n\n\t\t// Add index.\n\t\tif ( geometryType === draco.TRIANGULAR_MESH ) {\n\n\t\t\tgeometry.index = decodeIndex( draco, decoder, dracoGeometry );\n\n\t\t}\n\n\t\tdraco.destroy( dracoGeometry );\n\n\t\treturn geometry;\n\n\t}\n\n\tfunction decodeIndex( draco, decoder, dracoGeometry ) {\n\n\t\tconst numFaces = dracoGeometry.num_faces();\n\t\tconst numIndices = numFaces * 3;\n\t\tconst byteLength = numIndices * 4;\n\n\t\tconst ptr = draco._malloc( byteLength );\n\t\tdecoder.GetTrianglesUInt32Array( dracoGeometry, byteLength, ptr );\n\t\tconst index = new Uint32Array( draco.HEAPF32.buffer, ptr, numIndices ).slice();\n\t\tdraco._free( ptr );\n\n\t\treturn { array: index, itemSize: 1 };\n\n\t}\n\n\tfunction decodeAttribute( draco, decoder, dracoGeometry, attributeName, attributeType, attribute ) {\n\n\t\tconst numComponents = attribute.num_components();\n\t\tconst numPoints = dracoGeometry.num_points();\n\t\tconst numValues = numPoints * numComponents;\n\t\tconst byteLength = numValues * attributeType.BYTES_PER_ELEMENT;\n\t\tconst dataType = getDracoDataType( draco, attributeType );\n\n\t\tconst ptr = draco._malloc( byteLength );\n\t\tdecoder.GetAttributeDataArrayForAllPoints( dracoGeometry, attribute, dataType, byteLength, ptr );\n\t\tconst array = new attributeType( draco.HEAPF32.buffer, ptr, numValues ).slice();\n\t\tdraco._free( ptr );\n\n\t\treturn {\n\t\t\tname: attributeName,\n\t\t\tarray: array,\n\t\t\titemSize: numComponents\n\t\t};\n\n\t}\n\n\tfunction getDracoDataType( draco, attributeType ) {\n\n\t\tswitch ( attributeType ) {\n\n\t\t\tcase Float32Array: return draco.DT_FLOAT32;\n\t\t\tcase Int8Array: return draco.DT_INT8;\n\t\t\tcase Int16Array: return draco.DT_INT16;\n\t\t\tcase Int32Array: return draco.DT_INT32;\n\t\t\tcase Uint8Array: return draco.DT_UINT8;\n\t\t\tcase Uint16Array: return draco.DT_UINT16;\n\t\t\tcase Uint32Array: return draco.DT_UINT32;\n\n\t\t}\n\n\t}\n\n}\n\nexport { DRACOLoader };\n","import * as THREE from 'three'\nimport { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js'\nimport { DRACOLoader } from 'three/addons/loaders/DRACOLoader.js'\nimport assetStore from './AssetStore.js'\n\nexport default class AssetLoader {\n    constructor() {\n        this.assetStore = assetStore.getState()\n        this.assetsToLoad = this.assetStore.assetsToLoad\n        this.addLoadedAsset = this.assetStore.addLoadedAsset\n        this.loadingProgress = {}\n        \n        this.instantiateLoaders()\n        this.startLoading()\n    }\n\n    instantiateLoaders() {\n        const dracoLoader = new DRACOLoader()\n        // Update path to match GitHub Pages structure\n        const basePath = import.meta.env.DEV ? '/draco/' : '/folio_3js/draco/'\n        dracoLoader.setDecoderPath(basePath)\n\n        this.gltfLoader = new GLTFLoader()\n        this.gltfLoader.setDRACOLoader(dracoLoader)\n        this.textureLoader = new THREE.TextureLoader()\n\n        // Optional: Log decoder path in development\n        if (import.meta.env.DEV) {\n            console.log('Draco decoder path:', basePath)\n        }\n    }\n\n    updateLoadingProgress(assetId, progress) {\n        this.loadingProgress[assetId] = progress\n        const totalProgress = Object.values(this.loadingProgress).reduce((a, b) => a + b, 0)\n        const averageProgress = totalProgress / this.assetsToLoad.length\n        \n        // If you have a loading UI, you can update it here\n        if (import.meta.env.DEV) {\n            console.log(`Overall loading progress: ${Math.round(averageProgress)}%`)\n        }\n    }\n\n    getAssetPath(path) {\n        // Handle paths for both development and production\n        return import.meta.env.DEV ? path : `/folio_3js${path}`\n    }\n\n    startLoading() {\n        this.assetsToLoad.forEach((asset) => {\n            const assetPath = this.getAssetPath(asset.path)\n            \n            const onError = (error) => {\n                console.error(`Error loading asset ${asset.id}:`, error)\n                if (this.assetStore.setLoadingError) {\n                    this.assetStore.setLoadingError(asset.id, error)\n                }\n            }\n\n            const onProgress = (progress) => {\n                if (progress.lengthComputable) {\n                    const percentComplete = (progress.loaded / progress.total) * 100\n                    this.updateLoadingProgress(asset.id, percentComplete)\n                }\n            }\n\n            if (asset.type === 'texture') {\n                this.textureLoader.load(\n                    assetPath,\n                    (loadedAsset) => {\n                        this.addLoadedAsset(loadedAsset, asset.id)\n                        this.updateLoadingProgress(asset.id, 100)\n                    },\n                    onProgress,\n                    onError\n                )\n            }\n\n            if (asset.type === 'model') {\n                this.gltfLoader.load(\n                    assetPath,\n                    (loadedAsset) => {\n                        this.addLoadedAsset(loadedAsset, asset.id)\n                        this.updateLoadingProgress(asset.id, 100)\n                        \n                        if (import.meta.env.DEV) {\n                            console.log(`Loaded model: ${asset.id}`)\n                        }\n                    },\n                    onProgress,\n                    onError\n                )\n            }\n        })\n    }\n\n    // Utility method to check if all assets are loaded\n    areAllAssetsLoaded() {\n        const loadedCount = Object.keys(this.assetStore.loadedAssets).length\n        return loadedCount === this.assetsToLoad.length\n    }\n\n    // Utility method to get loading status\n    getLoadingStatus() {\n        return {\n            totalAssets: this.assetsToLoad.length,\n            loadedAssets: Object.keys(this.assetStore.loadedAssets).length,\n            progress: this.loadingProgress,\n            isComplete: this.areAllAssetsLoaded()\n        }\n    }\n}","import assetStore from '../Utils/AssetStore.js'\nimport { appStateStore } from '../Utils/Store.js'\n\nexport default class Preloader {\n    constructor() {\n        this.assetStore = assetStore\n\n        // access to DOM elements\n        this.overlay = document.querySelector('.overlay')\n        this.loading = document.querySelector('.loading')\n        this.startButton = document.querySelector('.start')\n\n        this.assetStore.subscribe((state) =>{\n\n            this.numberOfLoadedAssets = Object.keys(state.loadedAssets).length\n            this.numberOfAssetsToLoad = state.assetsToLoad.length\n            this.progress = this.numberOfLoadedAssets / this.numberOfAssetsToLoad\n            this.progress = Math.trunc(this.progress * 100)\n            document.getElementById('progressPercentage').innerHTML= this.progress\n\n            if (this.progress === 100)\n            {   \n                appStateStore.setState({assetsReady: true})\n                this.loading.classList.add('fade')\n                window.setTimeout(() => this.ready(), 1200)\n                \n            }\n        })\n        \n    }\n\n    ready() {\n\n        this.loading.remove()\n\n        this.startButton.style.display = 'inline'\n        this.startButton.classList.add('fadeIn')\n\n        this.startButton.addEventListener('click', () => {\n            console.log('started')\n            this.overlay.classList.add('fade')\n            this.startButton.classList.add('fadeOut')\n\n            window.setTimeout(() => {\n                this.overlay.remove()\n                this.startButton.remove()\n            }, 2000)\n\n\n\n        },{once: true})\n    }\n}","import { inputStore } from \"../Utils/Store.js\";\n\nexport default class InputController {\n  constructor() {\n    this.startListening();\n    this.inputStore = inputStore;\n    this.keyPressed = {};\n  }\n\n  startListening() {\n    window.addEventListener(\"keydown\", (event) => this.onKeyDown(event));\n    window.addEventListener(\"keyup\", (event) => this.onKeyUp(event));\n  }\n\n  onKeyDown(event) {\n    if (!this.keyPressed[event.code]) {\n      switch (event.code) {\n        case \"KeyW\":\n        case \"ArrowUp\":\n          console.log(\"forward\");\n          inputStore.setState({ forward: true });\n          break;\n        case \"KeyA\":\n        case \"ArrowLeft\":\n          inputStore.setState({ left: true });\n          break;\n        case \"KeyS\":\n        case \"ArrowDown\":\n          inputStore.setState({ backward: true });\n          break;\n        case \"KeyD\":\n        case \"ArrowRight\":\n          inputStore.setState({ right: true });\n          break;\n      }\n      this.keyPressed[event.code] = true;\n    }\n  }\n\n  onKeyUp(event) {\n    switch (event.code) {\n      case \"KeyW\":\n      case \"ArrowUp\":\n        inputStore.setState({ forward: false });\n        break;\n      case \"KeyA\":\n      case \"ArrowLeft\":\n        inputStore.setState({ left: false });\n        break;\n      case \"KeyS\":\n      case \"ArrowDown\":\n        inputStore.setState({ backward: false });\n        break;\n      case \"KeyD\":\n      case \"ArrowRight\":\n        inputStore.setState({ right: false });\n        break;\n    }\n    this.keyPressed[event.code] = false;\n  }\n}\n","export default class ModalManager {\n    constructor() {\n        this.modal = document.getElementById(\"myModal\");\n        this.modalWrapper = document.querySelector(\".modal-wrapper\");\n        this.close = document.querySelector(\".close\");\n        this.title = document.getElementById(\"modalTitle\");\n        this.description = document.getElementById(\"modalDescription\");\n        this.isOpen = false;\n\n        // Bind event handlers\n        this.close.onclick = () => this.closeModal();\n        this.modal.onclick = (event) => {\n            if (event.target === this.modal) {\n                this.closeModal();\n            }\n        };\n\n        // Handle escape key\n        document.addEventListener('keydown', (event) => {\n            if (event.key === 'Escape' && this.isOpen) {\n                this.closeModal();\n            }\n        });\n\n        this.cooldown = false;\n    }\n\n    openModal(title, description) {\n        if (this.cooldown) return;\n        \n        // Update content\n        this.title.innerHTML = title;\n        this.description.innerHTML = description;\n\n        // Show modal with animation\n        this.modal.style.display = \"block\";\n        this.modal.offsetHeight; // Force reflow\n        this.modal.classList.remove('fadeOut');\n        this.modal.classList.add('fadeIn');\n        \n        this.isOpen = true;\n\n        // Add cooldown to prevent spam\n        this.cooldown = true;\n        setTimeout(() => {\n            this.cooldown = false;\n        }, 1000);\n    }\n\n    closeModal() {\n        if (!this.isOpen) return;\n\n        this.modal.classList.remove('fadeIn');\n        this.modal.classList.add('fadeOut');\n\n        setTimeout(() => {\n            this.modal.style.display = \"none\";\n            this.modal.classList.remove('fadeOut');\n        }, 600);\n\n        this.isOpen = false;\n    }\n}","import * as THREE from 'three'\nimport Camera from './Camera.js'\nimport Renderer from './Renderer.js'\nimport Loop from './Utils/Loop.js'\nimport GUI from './Utils/GUI.js'\nimport World from './World/World.js'\nimport Resize from './Utils/Resize.js'\nimport AssetLoader from './Utils/AssetLoader.js'\nimport Preloader from './UI/Preloader.js'\nimport InputController from './UI/InputController.js'\nimport ModalManager from './UI/ModalManager.js'\n\nlet instance = null\n\nexport default class App {\n    constructor() {\n        if(instance) return instance\n        instance = this\n\n        // threejs elements\n        this.canvas = document.querySelector(\"canvas.threejs\");\n        this.scene = new THREE.Scene()\n\n        // add debug GUI\n        this.gui = new GUI()\n\n        // Asset Loader\n        this.assetLoader = new AssetLoader()\n\n        // UI\n        this.preloader = new Preloader()\n        this.inputController = new InputController()\n        this.modalManager = new ModalManager()  // Add this line\n\n        // World\n        this.world = new World()\n\n        // Camera and Renderer\n        this.camera = new Camera()\n        this.renderer = new Renderer()\n\n        // extra utils\n        this.loop = new Loop()\n        this.resize = new Resize()\n    }\n}","import './style.css'\nimport App from './App/App.js'\n\nconst app = new App()\n"],"file":"assets/index-c35c2d76.js"}